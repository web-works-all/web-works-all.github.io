function CourseCompletion(_,EventManager,AuthEvents,ChannelManager,CourseConfig,GenericApiFactory,PusherService,CourseEvents,EventManagerUtility,courseStream,UrlService,$filter){var ctrl=this;ctrl.channel=CourseConfig.COURSE_COMPLETION_CHANNEL;var ChannelEventManager=ChannelManager.subscribe(ctrl.channel),listeners=[],enrollmentApi=new GenericApiFactory(CourseConfig.ENROLLMENT_API_ENDPOINT,{slug:ctrl.slug,decorate:"certificate",expired:"null"}),getEnrollmentData=function(){enrollmentApi.get().then(function(response){if(courseStream.COURSE_ENROLLMENT_DATA.onNext(response.data),!response.data.certificate||response.data.certificate.length<=0)return void redirectToCourseDetails();initShareButtons({enrollmentId:response.data.course_enrollment_id,text:response.data.course_title,slug:ctrl.slug,shareUrl:response.data.certificate.share_url,linkedInProfileUrl:response.data.certificate.linkedin_add_certificate_url}),_.forEach(response.data.certificate.assets,function(asset){sendImage({bucket:asset.asset_bucket,path:asset.asset_path,width:asset.asset_width,height:asset.asset_height,shareType:asset.course_certificate_share_type_key})})}).catch(function(){redirectToCourseDetails()})},handleUserChanged=function(user){if(user.isLoggedIn()){getEnrollmentData(),PusherService.init(window.PusherKey,"/auth/pusher");var pusherInstance=PusherService.subscribe(CourseConfig.CERTIFICATE_PUSHER_CHANNEL_PREFIX+user.id);listeners.push(pusherInstance.onFresh(CourseEvents.COURSE_CERTIFICATE_GENERATED,handleImageFromPusher))}},handleImageFromPusher=function(events){var asset=events[0];sendImage({bucket:asset.asset_bucket,path:asset.asset_path,width:asset.asset_width,height:asset.asset_height,shareType:asset.share_type})},sendImage=function(image){ChannelEventManager.emit(CourseEvents.COURSE_CERTIFICATE_IMAGE,{src:"http://"+image.bucket+".s3.amazonaws.com/"+image.path,shareType:image.shareType})},initShareButtons=function(enrollment){ChannelEventManager.emit(CourseEvents.COURSE_ENROLLMENT,enrollment)},redirectToCourseDetails=function(){UrlService.changeUrl(ctrl.courseDetailsUrl)};ctrl.$onInit=function(){listeners.push(EventManager.on(AuthEvents.USER_CHANGED,handleUserChanged))},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}CourseCompletion.$inject=["_","EventManager","AuthEvents","ChannelManager","CourseConfig","GenericApiFactory","PusherService","CourseEvents","EventManagerUtility","courseStream","UrlService","$filter"],function(){function addMapEntry(map,pair){return map.set(pair[0],pair[1]),map}function addSetEntry(set,value){return set.add(value),set}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayConcat(array,other){for(var index=-1,length=array.length,othIndex=-1,othLength=other.length,result=Array(length+othLength);++index<length;)result[index]=array[index];for(;++othIndex<othLength;)result[index++]=other[othIndex];return result}function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}function arrayEachRight(array,iteratee){for(var length=array.length;length--&&!1!==iteratee(array[length],length,array););return array}function arrayEvery(array,predicate){for(var index=-1,length=array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}function arrayFilter(array,predicate){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[++resIndex]=value)}return result}function arrayIncludes(array,value){return!!array.length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){for(var index=-1,length=array.length;++index<length;)if(comparator(value,array[index]))return!0;return!1}function arrayMap(array,iteratee){for(var index=-1,length=array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array.length;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array.length;for(initAccum&&length&&(accumulator=array[--length]);length--;)accumulator=iteratee(accumulator,array[length],length,array);return accumulator}function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function baseExtremum(array,iteratee,comparator){for(var index=-1,length=array.length;++index<length;){var value=array[index],current=iteratee(value);if(null!=current&&(computed===undefined?current===current:comparator(current,computed)))var computed=current,result=value}return result}function baseFind(collection,predicate,eachFunc,retKey){var result;return eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection))return result=retKey?key:value,!1}),result}function baseFindIndex(array,predicate,fromRight){for(var length=array.length,index=fromRight?length:-1;fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){if(value!==value)return indexOfNaN(array,fromIndex);for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}function baseSortBy(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}function baseSum(array,iteratee){for(var result,index=-1,length=array.length;++index<length;){var current=iteratee(array[index]);current!==undefined&&(result=result===undefined?current:result+current)}return result}function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function charsStartIndex(strSymbols,chrSymbols){for(var index=-1,length=strSymbols.length;++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function charsEndIndex(strSymbols,chrSymbols){for(var index=strSymbols.length;index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function checkGlobal(value){return value&&value.Object===Object?value:null}function compareAscending(value,other){if(value!==other){var valIsNull=null===value,valIsUndef=value===undefined,valIsReflexive=value===value,othIsNull=null===other,othIsUndef=other===undefined,othIsReflexive=other===other;if(value>other&&!othIsNull||!valIsReflexive||valIsNull&&!othIsUndef&&othIsReflexive||valIsUndef&&othIsReflexive)return 1;if(value<other&&!valIsNull||!othIsReflexive||othIsNull&&!valIsUndef&&valIsReflexive||othIsUndef&&valIsReflexive)return-1}return 0}function compareMultiple(object,other,orders){for(var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;++index<length;){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength)return result;return result*("desc"==orders[index]?-1:1)}}return object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?0:-1);fromRight?index--:++index<length;){var other=array[index];if(other!==other)return index}return-1}function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}function isIndex(value,length){return value="number"==typeof value||reIsUint.test(value)?+value:-1,length=null==length?MAX_SAFE_INTEGER:length,value>-1&&value%1==0&&value<length}function iteratorToArray(iterator){for(var data,result=[];!(data=iterator.next()).done;)result.push(data.value);return result}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result}function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;)array[index]===placeholder&&(array[index]=PLACEHOLDER,result[++resIndex]=index);return result}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result}function stringSize(string){if(!string||!reHasComplexSymbol.test(string))return string.length;for(var result=reComplexSymbol.lastIndex=0;reComplexSymbol.test(string);)result++;return result}function stringToArray(string){return string.match(reComplexSymbol)}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}function runInContext(context){function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value,this.__actions__=[],this.__chain__=!!chainAll,this.__index__=0,this.__values__=undefined}function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=MAX_ARRAY_LENGTH,this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);return result.__actions__=copyArray(this.__actions__),result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=copyArray(this.__iteratees__),result.__takeCount__=this.__takeCount__,result.__views__=copyArray(this.__views__),result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else result=this.clone(),result.__dir__*=-1;return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||arrLength<LARGE_ARRAY_SIZE||arrLength==length&&takeCount==length)return baseWrapperValue(array,this.__actions__);var result=[];outer:for(;length--&&resIndex<takeCount;){index+=dir;for(var iterIndex=-1,value=array[index];++iterIndex<iterLength;){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG)value=computed;else if(!computed){if(type==LAZY_FILTER_FLAG)continue outer;break outer}}result[resIndex++]=value}return result}function Hash(){}function hashDelete(hash,key){return hashHas(hash,key)&&delete hash[key]}function hashGet(hash,key){if(nativeCreate){var result=hash[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(hash,key)?hash[key]:undefined}function hashHas(hash,key){return nativeCreate?hash[key]!==undefined:hasOwnProperty.call(hash,key)}function hashSet(hash,key,value){hash[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value}function MapCache(values){var index=-1,length=values?values.length:0;for(this.clear();++index<length;){var entry=values[index];this.set(entry[0],entry[1])}}function mapClear(){this.__data__={hash:new Hash,map:Map?new Map:[],string:new Hash}}function mapDelete(key){var data=this.__data__;return isKeyable(key)?hashDelete("string"==typeof key?data.string:data.hash,key):Map?data.map.delete(key):assocDelete(data.map,key)}function mapGet(key){var data=this.__data__;return isKeyable(key)?hashGet("string"==typeof key?data.string:data.hash,key):Map?data.map.get(key):assocGet(data.map,key)}function mapHas(key){var data=this.__data__;return isKeyable(key)?hashHas("string"==typeof key?data.string:data.hash,key):Map?data.map.has(key):assocHas(data.map,key)}function mapSet(key,value){var data=this.__data__;return isKeyable(key)?hashSet("string"==typeof key?data.string:data.hash,key,value):Map?data.map.set(key,value):assocSet(data.map,key,value),this}function SetCache(values){var index=-1,length=values?values.length:0;for(this.__data__=new MapCache;++index<length;)this.push(values[index])}function cacheHas(cache,value){var map=cache.__data__;if(isKeyable(value)){var data=map.__data__;return("string"==typeof value?data.string:data.hash)[value]===HASH_UNDEFINED}return map.has(value)}function cachePush(value){var map=this.__data__;if(isKeyable(value)){var data=map.__data__;("string"==typeof value?data.string:data.hash)[value]=HASH_UNDEFINED}else map.set(value,HASH_UNDEFINED)}function Stack(values){var index=-1,length=values?values.length:0;for(this.clear();++index<length;){var entry=values[index];this.set(entry[0],entry[1])}}function stackClear(){this.__data__={array:[],map:null}}function stackDelete(key){var data=this.__data__,array=data.array;return array?assocDelete(array,key):data.map.delete(key)}function stackGet(key){var data=this.__data__,array=data.array;return array?assocGet(array,key):data.map.get(key)}function stackHas(key){var data=this.__data__,array=data.array;return array?assocHas(array,key):data.map.has(key)}function stackSet(key,value){var data=this.__data__,array=data.array;array&&(array.length<LARGE_ARRAY_SIZE-1?assocSet(array,key,value):(data.array=null,data.map=new MapCache(array)));var map=data.map;return map&&map.set(key,value),this}function assocDelete(array,key){var index=assocIndexOf(array,key);return!(index<0)&&(index==array.length-1?array.pop():splice.call(array,index,1),!0)}function assocGet(array,key){var index=assocIndexOf(array,key);return index<0?undefined:array[index][1]}function assocHas(array,key){return assocIndexOf(array,key)>-1}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function assocSet(array,key,value){var index=assocIndexOf(array,key);index<0?array.push([key,value]):array[index][1]=value}function assignInDefaults(objValue,srcValue,key,object){return objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)?srcValue:objValue}function assignMergeValue(object,key,value){(value===undefined||eq(object[key],value))&&("number"!=typeof key||value!==undefined||key in object)||(object[key]=value)}function assignValue(object,key,value){var objValue=object[key];eq(objValue,value)&&(!eq(objValue,objectProto[key])||hasOwnProperty.call(object,key))&&(value!==undefined||key in object)||(object[key]=value)}function baseAggregator(collection,setter,iteratee,accumulator){return baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)}),accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAt(object,paths){for(var index=-1,isNil=null==object,length=paths.length,result=Array(length);++index<length;)result[index]=isNil?undefined:get(object,paths[index]);return result}function baseClamp(number,lower,upper){return number===number&&(upper!==undefined&&(number=number<=upper?number:upper),lower!==undefined&&(number=number>=lower?number:lower)),number}function baseClone(value,isDeep,customizer,key,object,stack){var result;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),result!==undefined)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return copyArray(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(tag!=objectTag&&tag!=argsTag&&(!isFunc||object))return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{};if(isHostObject(value))return object?value:{};if(result=initCloneObject(isFunc?{}:value),!isDeep)return copySymbols(value,baseAssign(result,value))}stack||(stack=new Stack);var stacked=stack.get(value);return stacked||(stack.set(value,result),(isArr?arrayEach:baseForOwn)(value,function(subValue,key){assignValue(result,key,baseClone(subValue,isDeep,customizer,key,value,stack))}),isArr?result:copySymbols(value,result))}function baseConforms(source){var props=keys(source),length=props.length;return function(object){if(null==object)return!length;for(var index=length;index--;){var key=props[index],predicate=source[key],value=object[key];if(value===undefined&&!(key in Object(object))||!predicate(value))return!1}return!0}}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=!0,length=array.length,result=[],valuesLength=values.length;if(!length)return result;iteratee&&(values=arrayMap(values,baseUnary(iteratee))),comparator?(includes=arrayIncludesWith,isCommon=!1):values.length>=LARGE_ARRAY_SIZE&&(includes=cacheHas,isCommon=!1,values=new SetCache(values));outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(isCommon&&computed===computed){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===computed)continue outer;result.push(value)}else includes(values,computed,comparator)||result.push(value)}return result}function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection)}),result}function baseFill(array,value,start,end){var length=array.length;for(start=toInteger(start),start<0&&(start=-start>length?0:length+start),end=end===undefined||end>length?length:toInteger(end),end<0&&(end+=length),end=start>end?0:toLength(end);start<end;)array[start++]=value;return array}function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}function baseFlatten(array,isDeep,isStrict,result){result||(result=[]);for(var index=-1,length=array.length;++index<length;){var value=array[index];isArrayLikeObject(value)&&(isStrict||isArray(value)||isArguments(value))?isDeep?baseFlatten(value,isDeep,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}function baseForIn(object,iteratee){return null==object?object:baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=isKey(path,object)?[path+""]:baseToPath(path);for(var index=0,length=path.length;null!=object&&index<length;)object=object[path[index++]];return index&&index==length?object:undefined}function baseHas(object,key){return hasOwnProperty.call(object,key)||"object"==typeof object&&key in object&&null===getPrototypeOf(object)}function baseHasIn(object,key){return key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){for(var includes=comparator?arrayIncludesWith:arrayIncludes,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),result=[];othIndex--;){var array=arrays[othIndex];othIndex&&iteratee&&(array=arrayMap(array,baseUnary(iteratee))),caches[othIndex]=!comparator&&(iteratee||array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,length=array.length,seen=caches[0];outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){for(var othIndex=othLength;--othIndex;){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator)))continue outer}seen&&seen.push(computed),result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){return baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)}),accumulator}function baseInvoke(object,path,args){isKey(path,object)||(path=baseToPath(path),object=parent(object,path),path=last(path));var func=null==object?object:object[path];return null==func?undefined:apply(func,object,args)}function baseIsEqual(value,other,customizer,bitmask,stack){return value===other||(null==value||null==other||!isObject(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,baseIsEqual,customizer,bitmask,stack))}function baseIsEqualDeep(object,other,equalFunc,customizer,bitmask,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;objIsArr||(objTag=getTag(object),objTag==argsTag?objTag=objectTag:objTag!=objectTag&&(objIsArr=isTypedArray(object))),othIsArr||(othTag=getTag(other),othTag==argsTag?othTag=objectTag:othTag!=objectTag&&(othIsArr=isTypedArray(other)));var objIsObj=objTag==objectTag&&!isHostObject(object),othIsObj=othTag==objectTag&&!isHostObject(other),isSameTag=objTag==othTag;if(isSameTag&&!objIsArr&&!objIsObj)return equalByTag(object,other,objTag,equalFunc,customizer,bitmask);if(!(bitmask&PARTIAL_COMPARE_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped)return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,bitmask,stack)}return!!isSameTag&&(stack||(stack=new Stack),(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,bitmask,stack))}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=Object(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object))return!1}else{var stack=new Stack,result=customizer?customizer(objValue,srcValue,key,object,source,stack):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG,stack):result))return!1}}return!0}function baseIteratee(value){var type=typeof value;return"function"==type?value:null==value?identity:"object"==type?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}function baseKeys(object){return nativeKeys(Object(object))}function baseKeysIn(object){object=null==object?object:Object(object);var result=[];for(var key in object)result.push(key);return result}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}function baseMatches(source){var matchData=getMatchData(source);if(1==matchData.length&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){return null!=object&&(object[key]===value&&(value!==undefined||key in Object(object)))}}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,undefined,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){if(object!==source){var props=isArray(source)||isTypedArray(source)?undefined:keysIn(source);arrayEach(props||source,function(srcValue,key){if(props&&(key=srcValue,srcValue=source[key]),isObject(srcValue))stack||(stack=new Stack),baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):undefined;newValue===undefined&&(newValue=srcValue),assignMergeValue(object,key,newValue)}})}}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked)return void assignMergeValue(object,key,stacked);var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined,isCommon=newValue===undefined;isCommon&&(newValue=srcValue,isArray(srcValue)||isTypedArray(srcValue)?isArray(objValue)?newValue=srcIndex?copyArray(objValue):objValue:isArrayLikeObject(objValue)?newValue=copyArray(objValue):(isCommon=!1,newValue=baseClone(srcValue)):isPlainObject(srcValue)||isArguments(srcValue)?isArguments(objValue)?newValue=toPlainObject(objValue):!isObject(objValue)||srcIndex&&isFunction(objValue)?(isCommon=!1,newValue=baseClone(srcValue)):newValue=srcIndex?baseClone(objValue):objValue:isCommon=!1),stack.set(srcValue,newValue),isCommon&&mergeFunc(newValue,srcValue,srcIndex,customizer,stack),assignMergeValue(object,key,newValue)}function baseOrderBy(collection,iteratees,orders){var index=-1,toIteratee=getIteratee();return iteratees=arrayMap(iteratees.length?iteratees:Array(1),function(iteratee){return toIteratee(iteratee)}),baseSortBy(baseMap(collection,function(value,key,collection){return{criteria:arrayMap(iteratees,function(iteratee){return iteratee(value)}),index:++index,value:value}}),function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,props){return object=Object(object),arrayReduce(props,function(result,key){return key in object&&(result[key]=object[key]),result},{})}function basePickBy(object,predicate){var result={};return baseForIn(object,function(value,key){predicate(value,key)&&(result[key]=value)}),result}function baseProperty(key){return function(object){return null==object?undefined:object[key]}}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values){return basePullAllBy(array,values)}function basePullAllBy(array,values,iteratee){var index=-1,length=values.length,seen=array;for(iteratee&&(seen=arrayMap(array,function(value){return iteratee(value)}));++index<length;)for(var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;(fromIndex=baseIndexOf(seen,computed,fromIndex))>-1;)seen!==array&&splice.call(seen,fromIndex,1),splice.call(array,fromIndex,1);return array}function basePullAt(array,indexes){for(var length=array?indexes.length:0,lastIndex=length-1;length--;){var index=indexes[length];if(lastIndex==length||index!=previous){var previous=index;if(isIndex(index))splice.call(array,index,1);else if(isKey(index,array))delete array[index];else{var path=baseToPath(index),object=parent(array,path);null!=object&&delete object[last(path)]}}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){for(var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);length--;)result[fromRight?length:++index]=start,start+=step;return result}function baseSet(object,path,value,customizer){path=isKey(path,object)?[path+""]:baseToPath(path);for(var index=-1,length=path.length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=path[index];if(isObject(nested)){var newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined,newValue===undefined&&(newValue=null==objValue?isIndex(path[index+1])?[]:{}:objValue)}assignValue(nested,key,newValue)}nested=nested[key]}return object}function baseSlice(array,start,end){var index=-1,length=array.length;start<0&&(start=-start>length?0:length+start),end=end>length?length:end,end<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return!(result=predicate(value,index,collection))}),!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=array?array.length:low;if("number"==typeof value&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){for(;low<high;){var mid=low+high>>>1,computed=array[mid];(retHighest?computed<=value:computed<value)&&null!==computed?low=mid+1:high=mid}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);for(var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsNull=null===value,valIsUndef=value===undefined;low<high;){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),isDef=computed!==undefined,isReflexive=computed===computed;if(valIsNaN)var setLow=isReflexive||retHighest;else setLow=valIsNull?isReflexive&&isDef&&(retHighest||null!=computed):valIsUndef?isReflexive&&(retHighest||isDef):null!=computed&&(retHighest?computed<=value:computed<value);setLow?low=mid+1:high=mid}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array){return baseSortedUniqBy(array)}function baseSortedUniqBy(array,iteratee){for(var index=0,length=array.length,value=array[0],computed=iteratee?iteratee(value):value,seen=computed,resIndex=0,result=[value];++index<length;)value=array[index],computed=iteratee?iteratee(value):value,eq(computed,seen)||(seen=computed,result[++resIndex]=value);return result}function baseToPath(value){return isArray(value)?value:stringToPath(value)}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(isCommon&&computed===computed){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}function baseUnset(object,path){path=isKey(path,object)?[path+""]:baseToPath(path),object=parent(object,path);var key=last(path);return null==object||!has(object,key)||delete object[key]}function baseWhile(array,predicate,isDrop,fromRight){for(var length=array.length,index=fromRight?length:-1;(fromRight?index--:++index<length)&&predicate(array[index],index,array););return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;return result instanceof LazyWrapper&&(result=result.value()),arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){for(var index=-1,length=arrays.length;++index<length;)var result=result?arrayPush(baseDifference(result,arrays[index],iteratee,comparator),baseDifference(arrays[index],result,iteratee,comparator)):arrays[index];return result&&result.length?baseUniq(result,iteratee,comparator):[]}function baseZipObject(props,values,assignFunc){for(var index=-1,length=props.length,valsLength=values.length,result={};++index<length;)assignFunc(result,props[index],index<valsLength?values[index]:undefined);return result}function cloneBuffer(buffer){var Ctor=buffer.constructor,result=new Ctor(buffer.byteLength);return new Uint8Array(result).set(new Uint8Array(buffer)),result}function cloneMap(map){var Ctor=map.constructor;return arrayReduce(mapToArray(map),addMapEntry,new Ctor)}function cloneRegExp(regexp){var Ctor=regexp.constructor,result=new Ctor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result}function cloneSet(set){var Ctor=set.constructor;return arrayReduce(setToArray(set),addSetEntry,new Ctor)}function cloneSymbol(symbol){return Symbol?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=typedArray.buffer;return new(0,typedArray.constructor)(isDeep?cloneBuffer(buffer):buffer,typedArray.byteOffset,typedArray.length)}function composeArgs(args,partials,holders){for(var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)result[holders[argsIndex]]=args[argsIndex];for(;argsLength--;)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders){for(var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);++argsIndex<argsLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)result[offset+holders[holdersIndex]]=args[argsIndex++];return result}function copyArray(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}function copyObject(source,props,object){return copyObjectWith(source,props,object)}function copyObjectWith(source,props,object,customizer){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index];assignValue(object,key,customizer?customizer(object[key],source[key],key,object,source):source[key])}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee),accumulator)}}function createAssigner(assigner){return rest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;for(customizer="function"==typeof customizer?(length--,customizer):undefined,guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?undefined:customizer,length=1),object=Object(object);++index<length;){var source=sources[index];source&&assigner(object,source,index,customizer)}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}function createBaseWrapper(func,bitmask,thisArg){function wrapper(){return(this&&this!==root&&this instanceof wrapper?Ctor:func).apply(isBind?thisArg:this,arguments)}var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=reHasComplexSymbol.test(string)?stringToArray(string):undefined,chr=strSymbols?strSymbols[0]:string.charAt(0),trailing=strSymbols?strSymbols.slice(1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string)),callback,"")}}function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurryWrapper(func,bitmask,arity){function wrapper(){for(var length=arguments.length,index=length,args=Array(length),fn=this&&this!==root&&this instanceof wrapper?Ctor:func,placeholder=lodash.placeholder||wrapper.placeholder;index--;)args[index]=arguments[index];var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);return length-=holders.length,length<arity?createRecurryWrapper(func,bitmask,createHybridWrapper,placeholder,undefined,args,holders,undefined,undefined,arity-length):apply(fn,this,args)}var Ctor=createCtorWrapper(func);return wrapper}function createFlow(fromRight){return rest(function(funcs){funcs=baseFlatten(funcs);var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;for(fromRight&&funcs.reverse();index--;){var func=funcs[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(prereq&&!wrapper&&"wrapper"==getFuncName(func))var wrapper=new LodashWrapper([],!0)}for(index=wrapper?index:length;++index<length;){func=funcs[index];var funcName=getFuncName(func),data="wrapper"==funcName?getData(func):undefined;wrapper=data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value)&&value.length>=LARGE_ARRAY_SIZE)return wrapper.plant(value).value();for(var index=0,result=length?funcs[index].apply(this,args):value;++index<length;)result=funcs[index].call(this,result);return result}})}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){function wrapper(){for(var length=arguments.length,index=length,args=Array(length);index--;)args[index]=arguments[index];if(partials&&(args=composeArgs(args,partials,holders)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight)),isCurry||isCurryRight){var placeholder=lodash.placeholder||wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);if((length-=argsHolders.length)<arity)return createRecurryWrapper(func,bitmask,createHybridWrapper,placeholder,thisArg,args,argsHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return argPos?args=reorder(args,argPos):isFlip&&args.length>1&&args.reverse(),isAry&&ary<args.length&&(args.length=ary),this&&this!==root&&this instanceof wrapper&&(fn=Ctor||createCtorWrapper(fn)),fn.apply(thisBinding,args)}var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,isFlip=bitmask&FLIP_FLAG,Ctor=isBindKey?undefined:createCtorWrapper(func);return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createOver(arrayFunc){return rest(function(iteratees){return iteratees=arrayMap(baseFlatten(iteratees),getIteratee()),rest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(string,length,chars){length=toInteger(length);var strLength=stringSize(string);if(!length||strLength>=length)return"";var padLength=length-strLength;chars=chars===undefined?" ":chars+"";var result=repeat(chars,nativeCeil(padLength/stringSize(chars)));return reHasComplexSymbol.test(chars)?stringToArray(result).slice(0,padLength).join(""):result.slice(0,padLength)}function createPartialWrapper(func,bitmask,thisArg,partials){function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];return apply(fn,isBind?thisArg:this,args)}var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);return wrapper}function createRange(fromRight){return function(start,end,step){return step&&"number"!=typeof step&&isIterateeCall(start,end,step)&&(end=step=undefined),start=toNumber(start),start=start===start?start:0,end===undefined?(end=start,start=0):end=toNumber(end)||0,step=step===undefined?start<end?1:-1:toNumber(step)||0,baseRange(start,end,step,fromRight)}}function createRecurryWrapper(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&CURRY_FLAG,newArgPos=argPos?copyArray(argPos):undefined,newsHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG,(bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG))&CURRY_BOUND_FLAG||(bitmask&=~(BIND_FLAG|BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,arity],result=wrapFunc.apply(undefined,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,result}function createRound(methodName){var func=Math[methodName];return function(number,precision){if(number=toNumber(number),precision=toInteger(precision)){var pair=(toString(number)+"e").split("e");return pair=(toString(func(pair[0]+"e"+(+pair[1]+precision)))+"e").split("e"),+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG),partials=holders=undefined),ary=ary===undefined?ary:nativeMax(toInteger(ary),0),arity=arity===undefined?arity:toInteger(arity),length-=holders?holders.length:0,bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&mergeData(newData,data),func=newData[0],bitmask=newData[1],thisArg=newData[2],partials=newData[3],holders=newData[4],arity=newData[9]=null==newData[9]?isBindKey?0:func.length:nativeMax(newData[9]-length,0),!arity&&bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG)&&(bitmask&=~(CURRY_FLAG|CURRY_RIGHT_FLAG)),bitmask&&bitmask!=BIND_FLAG)result=bitmask==CURRY_FLAG||bitmask==CURRY_RIGHT_FLAG?createCurryWrapper(func,bitmask,arity):bitmask!=PARTIAL_FLAG&&bitmask!=(BIND_FLAG|PARTIAL_FLAG)||holders.length?createHybridWrapper.apply(undefined,newData):createPartialWrapper(func,bitmask,thisArg,partials);else var result=createBaseWrapper(func,bitmask,thisArg);return(data?baseSetData:setData)(result,newData)}function equalArrays(array,other,equalFunc,customizer,bitmask,stack){var index=-1,isPartial=bitmask&PARTIAL_COMPARE_FLAG,isUnordered=bitmask&UNORDERED_COMPARE_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked)return stacked==other;var result=!0;for(stack.set(array,other);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(compared!==undefined){if(compared)continue;result=!1;break}if(isUnordered){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,customizer,bitmask,stack)){result=!1;break}}return stack.delete(array),result}function equalByTag(object,other,tag,equalFunc,customizer,bitmask){switch(tag){case arrayBufferTag:return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&PARTIAL_COMPARE_FLAG;return convert||(convert=setToArray),(isPartial||object.size==other.size)&&equalFunc(convert(object),convert(other),customizer,bitmask|UNORDERED_COMPARE_FLAG);case symbolTag:return!!Symbol&&symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}function equalObjects(object,other,equalFunc,customizer,bitmask,stack){var isPartial=bitmask&PARTIAL_COMPARE_FLAG,objProps=keys(object),objLength=objProps.length;if(objLength!=keys(other).length&&!isPartial)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isPartial?key in other:baseHas(other,key)))return!1}var stacked=stack.get(object);if(stacked)return stacked==other;var result=!0;stack.set(object,other);for(var skipCtor=isPartial;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,customizer,bitmask,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor)&&(result=!1)}return stack.delete(object),result}function getFuncName(func){for(var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}function getIteratee(){var result=lodash.iteratee||iteratee;return result=result===iteratee?baseIteratee:result,arguments.length?result(arguments[0],arguments[1]):result}function getMatchData(object){for(var result=toPairs(object),length=result.length;length--;)result[length][2]=isStrictComparable(result[length][1]);return result}function getNative(object,key){var value=null==object?undefined:object[key];return isNative(value)?value:undefined}function getTag(value){return objectToString.call(value)}function getView(start,end,transforms){for(var index=-1,length=transforms.length;++index<length;){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start:start,end:end}}function hasPath(object,path,hasFunc){if(null==object)return!1;var result=hasFunc(object,path);result||isKey(path)||(path=baseToPath(path),null!=(object=parent(object,path))&&(path=last(path),result=hasFunc(object,path)));var length=object?object.length:undefined;return result||!!length&&isLength(length)&&isIndex(path,length)&&(isArray(object)||isString(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}function initCloneObject(object){if(isPrototype(object))return{};var Ctor=object.constructor;return baseCreate(isFunction(Ctor)?Ctor.prototype:undefined)}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object);case symbolTag:return cloneSymbol(object)}}function indexKeys(object){var length=object?object.length:undefined;return isLength(length)&&(isArray(object)||isString(object)||isArguments(object))?baseTimes(length,String):null}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}function isKey(value,object){return"number"==typeof value||!isArray(value)&&(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}function isKeyable(value){var type=typeof value;return"number"==type||"boolean"==type||"string"==type&&"__proto__"!==value||null==value}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}function isStrictComparable(value){return value===value&&!isObject(value)}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(BIND_FLAG|BIND_KEY_FLAG|ARY_FLAG),isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&source[7].length<=source[8]&&bitmask==CURRY_FLAG;if(!isCommon&&!isCombo)return data;srcBitmask&BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):copyArray(value),data[4]=partials?replaceHolders(data[3],PLACEHOLDER):copyArray(source[4])}return value=source[5],value&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):copyArray(value),data[6]=partials?replaceHolders(data[5],PLACEHOLDER):copyArray(source[6])),value=source[7],value&&(data[7]=copyArray(value)),srcBitmask&ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask,data}function mergeDefaults(objValue,srcValue,key,object,source,stack){return isObject(objValue)&&isObject(srcValue)&&(stack.set(srcValue,objValue),baseMerge(objValue,srcValue,undefined,mergeDefaults,stack)),objValue}function parent(object,path){return 1==path.length?object:get(object,baseSlice(path,0,-1))}function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}function stringToPath(string){var result=[];return toString(string).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)}),result}function toArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function toFunction(value){return"function"==typeof value?value:identity}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper)return wrapper.clone();var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);return result.__actions__=copyArray(wrapper.__actions__),result.__index__=wrapper.__index__,result.__values__=wrapper.__values__,result}function chunk(array,size){size=nativeMax(toInteger(size),0);var length=array?array.length:0;if(!length||size<1)return[];for(var index=0,resIndex=-1,result=Array(nativeCeil(length/size));index<length;)result[++resIndex]=baseSlice(array,index,index+=size);return result}function compact(array){for(var index=-1,length=array?array.length:0,resIndex=-1,result=[];++index<length;){var value=array[index];value&&(result[++resIndex]=value)}return result}function drop(array,n,guard){var length=array?array.length:0;return length?(n=guard||n===undefined?1:toInteger(n),baseSlice(array,n<0?0:n,length)):[]}function dropRight(array,n,guard){var length=array?array.length:0;return length?(n=guard||n===undefined?1:toInteger(n),n=length-n,baseSlice(array,0,n<0?0:n)):[]}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0,!0):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0):[]}function fill(array,value,start,end){var length=array?array.length:0;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),baseFill(array,value,start,end)):[]}function findIndex(array,predicate){return array&&array.length?baseFindIndex(array,getIteratee(predicate,3)):-1}function findLastIndex(array,predicate){return array&&array.length?baseFindIndex(array,getIteratee(predicate,3),!0):-1}function flatten(array){return(array?array.length:0)?baseFlatten(array):[]}function flattenDeep(array){return(array?array.length:0)?baseFlatten(array,!0):[]}function fromPairs(pairs){for(var index=-1,length=pairs?pairs.length:0,result={};++index<length;){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array?array.length:0;return length?(fromIndex=toInteger(fromIndex),fromIndex<0&&(fromIndex=nativeMax(length+fromIndex,0)),baseIndexOf(array,value,fromIndex)):-1}function initial(array){return dropRight(array,1)}function join(array,separator){return array?nativeJoin.call(array,separator):""}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;var index=length;if(fromIndex!==undefined&&(index=toInteger(fromIndex),index=(index<0?nativeMax(length+index,0):nativeMin(index,length-1))+1),value!==value)return indexOfNaN(array,index,!0);for(;index--;)if(array[index]===value)return index;return-1}function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAllBy(array,values,getIteratee(iteratee)):array}function remove(array,predicate){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;for(predicate=getIteratee(predicate,3);++index<length;){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result}function reverse(array){return array?nativeReverse.call(array):array}function slice(array,start,end){var length=array?array.length:0;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)?(start=0,end=length):(start=null==start?0:toInteger(start),end=end===undefined?length:toInteger(end)),baseSlice(array,start,end)):[]}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee))}function sortedIndexOf(array,value){var length=array?array.length:0;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value))return index}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,!0)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee),!0)}function sortedLastIndexOf(array,value){if(array?array.length:0){var index=baseSortedIndex(array,value,!0)-1;if(eq(array[index],value))return index}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniqBy(array,getIteratee(iteratee)):[]}function tail(array){return drop(array,1)}function take(array,n,guard){return array&&array.length?(n=guard||n===undefined?1:toInteger(n),baseSlice(array,0,n<0?0:n)):[]}function takeRight(array,n,guard){var length=array?array.length:0;return length?(n=guard||n===undefined?1:toInteger(n),n=length-n,baseSlice(array,n<0?0:n,length)):[]}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!1,!0):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee)):[]}function uniqWith(array,comparator){return array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!array||!array.length)return[];var length=0;return array=arrayFilter(array,function(group){if(isArrayLikeObject(group))return length=nativeMax(group.length,length),!0}),baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!array||!array.length)return[];var result=unzip(array);return null==iteratee?result:arrayMap(result,function(group){return apply(iteratee,undefined,group)})}function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}function chain(value){var result=lodash(value);return result.__chain__=!0,result}function tap(value,interceptor){return interceptor(value),value}function thru(value,interceptor){return interceptor(value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperFlatMap(iteratee){return this.map(iteratee).flatten()}function wrapperNext(){this.__values__===undefined&&(this.__values__=toArray(this.value()));var done=this.__index__>=this.__values__.length;return{done:done,value:done?undefined:this.__values__[this.__index__++]}}function wrapperToIterator(){return this}function wrapperPlant(value){for(var result,parent=this;parent instanceof baseLodash;){var clone=wrapperClone(parent);clone.__index__=0,clone.__values__=undefined,result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;return this.__actions__.length&&(wrapped=new LazyWrapper(this)),wrapped=wrapped.reverse(),wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined}),new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))}function filter(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,getIteratee(predicate,3))}function find(collection,predicate){if(predicate=getIteratee(predicate,3),isArray(collection)){var index=baseFindIndex(collection,predicate);return index>-1?collection[index]:undefined}return baseFind(collection,predicate,baseEach)}function findLast(collection,predicate){if(predicate=getIteratee(predicate,3),isArray(collection)){var index=baseFindIndex(collection,predicate,!0);return index>-1?collection[index]:undefined}return baseFind(collection,predicate,baseEachRight)}function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee))}function forEach(collection,iteratee){return"function"==typeof iteratee&&isArray(collection)?arrayEach(collection,iteratee):baseEach(collection,toFunction(iteratee))}function forEachRight(collection,iteratee){return"function"==typeof iteratee&&isArray(collection)?arrayEachRight(collection,iteratee):baseEachRight(collection,toFunction(iteratee))}function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection),fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;return fromIndex<0&&(fromIndex=nativeMax(length+fromIndex,0)),isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}function map(collection,iteratee){return(isArray(collection)?arrayMap:baseMap)(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){return null==collection?[]:(isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),orders=guard?undefined:orders,isArray(orders)||(orders=null==orders?[]:[orders]),baseOrderBy(collection,iteratees,orders))}function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=getIteratee(predicate,3),func(collection,function(value,index,collection){return!predicate(value,index,collection)})}function sample(collection){var array=isArrayLike(collection)?collection:values(collection),length=array.length;return length>0?array[baseRandom(0,length-1)]:undefined}function sampleSize(collection,n){var index=-1,result=toArray(collection),length=result.length,lastIndex=length-1;for(n=baseClamp(toInteger(n),0,length);++index<n;){var rand=baseRandom(index,lastIndex),value=result[rand];result[rand]=result[index],result[index]=value}
return result.length=n,result}function shuffle(collection){return sampleSize(collection,MAX_ARRAY_LENGTH)}function size(collection){if(null==collection)return 0;if(isArrayLike(collection)){var result=collection.length;return result&&isString(collection)?stringSize(collection):result}return keys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))}function after(n,func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){if(--n<1)return func.apply(this,arguments)}}function ary(func,n,guard){return n=guard?undefined:n,n=func&&null==n?func.length:n,createWrapper(func,ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){return--n>0&&(result=func.apply(this,arguments)),n<=1&&(func=undefined),result}}function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrapper(func,CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=lodash.placeholder||curry.placeholder,result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrapper(func,CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=lodash.placeholder||curryRight.placeholder,result}function debounce(func,wait,options){function cancel(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId&&clearTimeout(maxTimeoutId),lastCalled=0,args=maxTimeoutId=thisArg=timeoutId=trailingCall=undefined}function complete(isCalled,id){id&&clearTimeout(id),maxTimeoutId=timeoutId=trailingCall=undefined,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=undefined))}function delayed(){var remaining=wait-(now()-stamp);remaining<=0||remaining>wait?complete(trailingCall,maxTimeoutId):timeoutId=setTimeout(delayed,remaining)}function flush(){return(timeoutId&&trailingCall||maxTimeoutId&&trailing)&&(result=func.apply(thisArg,args)),cancel(),result}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),!1===maxWait)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=undefined),result}var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,leading=!1,maxWait=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait="maxWait"in options&&nativeMax(toNumber(options.maxWait)||0,wait),trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=cancel,debounced.flush=flush,debounced}function flip(func){return createWrapper(func,FLIP_FLAG)}function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result),result};return memoized.cache=new memoize.Cache,memoized}function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){return!predicate.apply(this,arguments)}}function once(func){return before(2,func)}function rest(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=nativeMax(start===undefined?func.length-1:toInteger(start),0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];switch(start){case 0:return func.call(this,array);case 1:return func.call(this,args[0],array);case 2:return func.call(this,args[0],args[1],array)}var otherArgs=Array(start+1);for(index=-1;++index<start;)otherArgs[index]=args[index];return otherArgs[start]=array,apply(func,this,otherArgs)}}function spread(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=start===undefined?0:nativeMax(toInteger(start),0),rest(function(args){var array=args[start],otherArgs=args.slice(0,start);return array&&arrayPush(otherArgs,array),apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){return wrapper=null==wrapper?identity:wrapper,partial(wrapper,value)}function clone(value){return baseClone(value)}function cloneWith(value,customizer){return baseClone(value,!1,customizer)}function cloneDeep(value){return baseClone(value,!0)}function cloneDeepWith(value,customizer){return baseClone(value,!0,customizer)}function eq(value,other){return value===other||value!==value&&other!==other}function gt(value,other){return value>other}function gte(value,other){return value>=other}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}function isArrayLike(value){return null!=value&&!("function"==typeof value&&isFunction(value))&&isLength(getLength(value))}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return!0===value||!1===value||isObjectLike(value)&&objectToString.call(value)==boolTag}function isDate(value){return isObjectLike(value)&&objectToString.call(value)==dateTag}function isElement(value){return!!value&&1===value.nodeType&&isObjectLike(value)&&!isPlainObject(value)}function isEmpty(value){if(isArrayLike(value)&&(isArray(value)||isString(value)||isFunction(value.splice)||isArguments(value)))return!value.length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer="function"==typeof customizer?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&"string"==typeof value.message&&objectToString.call(value)==errorTag}function isFinite(value){return"number"==typeof value&&nativeIsFinite(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isInteger(value){return"number"==typeof value&&value==toInteger(value)}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function isObjectLike(value){return!!value&&"object"==typeof value}function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){return null!=value&&(isFunction(value)?reIsNative.test(funcToString.call(value)):isObjectLike(value)&&(isHostObject(value)?reIsNative:reIsHostCtor).test(value))}function isNull(value){return null===value}function isNil(value){return null==value}function isNumber(value){return"number"==typeof value||isObjectLike(value)&&objectToString.call(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||objectToString.call(value)!=objectTag||isHostObject(value))return!1;var proto=objectProto;if("function"==typeof value.constructor&&(proto=getPrototypeOf(value)),null===proto)return!0;var Ctor=proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}function isRegExp(value){return isObject(value)&&objectToString.call(value)==regexpTag}function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}function isString(value){return"string"==typeof value||!isArray(value)&&isObjectLike(value)&&objectToString.call(value)==stringTag}function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&objectToString.call(value)==symbolTag}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)]}function isUndefined(value){return value===undefined}function lt(value,other){return value<other}function lte(value,other){return value<=other}function toArray(value){if(!value)return[];if(isArrayLike(value))return isString(value)?stringToArray(value):copyArray(value);if(iteratorSymbol&&value[iteratorSymbol])return iteratorToArray(value[iteratorSymbol]());var tag=getTag(value);return(tag==mapTag?mapToArray:tag==setTag?setToArray:values)(value)}function toInteger(value){if(!value)return 0===value?value:0;if((value=toNumber(value))===INFINITY||value===-INFINITY){return(value<0?-1:1)*MAX_INTEGER}var remainder=value%1;return value===value?remainder?value-remainder:value:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if(isObject(value)){var other=isFunction(value.valueOf)?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER)}function toString(value){if("string"==typeof value)return value;if(null==value)return"";if(isSymbol(value))return Symbol?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function create(prototype,properties){var result=baseCreate(prototype);return properties?baseAssign(result,properties):result}function findKey(object,predicate){return baseFind(object,getIteratee(predicate,3),baseForOwn,!0)}function findLastKey(object,predicate){return baseFind(object,getIteratee(predicate,3),baseForOwnRight,!0)}function forIn(object,iteratee){return null==object?object:baseFor(object,toFunction(iteratee),keysIn)}function forInRight(object,iteratee){return null==object?object:baseForRight(object,toFunction(iteratee),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,toFunction(iteratee))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,toFunction(iteratee))}function functions(object){return null==object?[]:baseFunctions(object,keys(object))}function functionsIn(object){return null==object?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=null==object?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return hasPath(object,path,baseHas)}function hasIn(object,path){return hasPath(object,path,baseHasIn)}function keys(object){var isProto=isPrototype(object);if(!isProto&&!isArrayLike(object))return baseKeys(object);var indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;for(var key in object)!baseHas(object,key)||skipIndexes&&("length"==key||isIndex(key,length))||isProto&&"constructor"==key||result.push(key);return result}function keysIn(object){for(var index=-1,isProto=isPrototype(object),props=baseKeysIn(object),propsLength=props.length,indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;++index<propsLength;){var key=props[index];skipIndexes&&("length"==key||isIndex(key,length))||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key)}return result}function mapKeys(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,function(value,key,object){result[iteratee(value,key,object)]=value}),result}function mapValues(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,function(value,key,object){result[key]=iteratee(value,key,object)}),result}function omitBy(object,predicate){return predicate=getIteratee(predicate,2),basePickBy(object,function(value,key){return!predicate(value,key)})}function pickBy(object,predicate){return null==object?{}:basePickBy(object,getIteratee(predicate,2))}function result(object,path,defaultValue){if(isKey(path,object))result=null==object?undefined:object[path];else{path=baseToPath(path);var result=get(object,path);object=parent(object,path)}return result===undefined&&(result=defaultValue),isFunction(result)?result.call(object):result}function set(object,path,value){return null==object?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){return customizer="function"==typeof customizer?customizer:undefined,null==object?object:baseSet(object,path,value,customizer)}function toPairs(object){return baseToPairs(object,keys(object))}function toPairsIn(object){return baseToPairs(object,keysIn(object))}function transform(object,iteratee,accumulator){var isArr=isArray(object)||isTypedArray(object);if(iteratee=getIteratee(iteratee,4),null==accumulator)if(isArr||isObject(object)){var Ctor=object.constructor;accumulator=isArr?isArray(object)?new Ctor:[]:baseCreate(isFunction(Ctor)?Ctor.prototype:undefined)}else accumulator={};return(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator}function unset(object,path){return null==object||baseUnset(object,path)}function values(object){return object?baseValues(object,keys(object)):[]}function valuesIn(object){return null==object?baseValues(object,keysIn(object)):[]}function clamp(number,lower,upper){return upper===undefined&&(upper=lower,lower=undefined),upper!==undefined&&(upper=toNumber(upper),upper=upper===upper?upper:0),lower!==undefined&&(lower=toNumber(lower),lower=lower===lower?lower:0),baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){return start=toNumber(start)||0,end===undefined?(end=start,start=0):end=toNumber(end)||0,number=toNumber(number),baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&"boolean"!=typeof floating&&isIterateeCall(lower,upper,floating)&&(upper=floating=undefined),floating===undefined&&("boolean"==typeof upper?(floating=upper,upper=undefined):"boolean"==typeof lower&&(floating=lower,lower=undefined)),lower===undefined&&upper===undefined?(lower=0,upper=1):(lower=toNumber(lower)||0,upper===undefined?(upper=lower,lower=0):upper=toNumber(upper)||0),lower>upper){var temp=lower;lower=upper,upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){return(string=toString(string))&&string.replace(reLatin1,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string),target="string"==typeof target?target:target+"";var length=string.length;return position=position===undefined?length:baseClamp(toInteger(position),0,length),(position-=target.length)>=0&&string.indexOf(target,position)==position}function escape(string){return string=toString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){return string=toString(string),string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}function pad(string,length,chars){string=toString(string),length=toInteger(length);var strLength=stringSize(string);if(!length||strLength>=length)return string;var mid=(length-strLength)/2,leftLength=nativeFloor(mid),rightLength=nativeCeil(mid);return createPadding("",leftLength,chars)+string+createPadding("",rightLength,chars)}function padEnd(string,length,chars){return(string=toString(string))+createPadding(string,length,chars)}function padStart(string,length,chars){return string=toString(string),createPadding(string,length,chars)+string}function parseInt(string,radix,guard){return guard||null==radix?radix=0:radix&&(radix=+radix),string=toString(string).replace(reTrim,""),nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10))}function repeat(string,n){string=toString(string),n=toInteger(n);var result="";if(!string||n<1||n>MAX_SAFE_INTEGER)return result;do{n%2&&(result+=string),n=nativeFloor(n/2),string+=string}while(n);return result}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])}function split(string,separator,limit){return toString(string).split(separator,limit)}function startsWith(string,target,position){return string=toString(string),position=baseClamp(toInteger(position),0,string.length),string.lastIndexOf(target,position)==position}function template(string,options,guard){var settings=lodash.templateSettings;guard&&isIterateeCall(string,options,guard)&&(options=undefined),string=toString(string),options=assignInWith({},options,settings,assignInDefaults);var isEscaping,isEvaluating,imports=assignInWith({},options.imports,settings.imports,assignInDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});if(result.source=source,isError(result))throw result;return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){if(!(string=toString(string)))return string;if(guard||chars===undefined)return string.replace(reTrim,"");if(!(chars+=""))return string;var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars);return strSymbols.slice(charsStartIndex(strSymbols,chrSymbols),charsEndIndex(strSymbols,chrSymbols)+1).join("")}function trimEnd(string,chars,guard){if(!(string=toString(string)))return string;if(guard||chars===undefined)return string.replace(reTrimEnd,"");if(!(chars+=""))return string;var strSymbols=stringToArray(string);return strSymbols.slice(0,charsEndIndex(strSymbols,stringToArray(chars))+1).join("")}function trimStart(string,chars,guard){if(!(string=toString(string)))return string;if(guard||chars===undefined)return string.replace(reTrimStart,"");if(!(chars+=""))return string;var strSymbols=stringToArray(string);return strSymbols.slice(charsStartIndex(strSymbols,stringToArray(chars))).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length,omission="omission"in options?toString(options.omission):omission}string=toString(string);var strLength=string.length;if(reHasComplexSymbol.test(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength)return string;var end=length-stringSize(omission);if(end<1)return omission;var result=strSymbols?strSymbols.slice(0,end).join(""):string.slice(0,end);if(separator===undefined)return result+omission;if(strSymbols&&(end+=result.length-end),isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;for(separator.global||(separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")),separator.lastIndex=0;match=separator.exec(substring);)var newEnd=match.index;result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission}function unescape(string){return string=toString(string),string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){return string=toString(string),pattern=guard?undefined:pattern,pattern===undefined&&(pattern=reHasComplexWord.test(string)?reComplexWord:reBasicWord),string.match(pattern)||[]}function cond(pairs){var length=pairs?pairs.length:0,toIteratee=getIteratee();return pairs=length?arrayMap(pairs,function(pair){if("function"!=typeof pair[1])throw new TypeError(FUNC_ERROR_TEXT);return[toIteratee(pair[0]),pair[1]]}):[],rest(function(args){for(var index=-1;++index<length;){var pair=pairs[index];if(apply(pair[0],this,args))return apply(pair[1],this,args)}})}function conforms(source){return baseConforms(baseClone(source,!0))}function constant(value){return function(){return value}}function identity(value){return value}function iteratee(func){return baseIteratee("function"==typeof func?func:baseClone(func,!0))}function matches(source){return baseMatches(baseClone(source,!0))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,!0))}function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);null!=options||isObject(source)&&(methodNames.length||!props.length)||(options=source,source=object,object=this,methodNames=baseFunctions(source,keys(source)));var chain=!(isObject(options)&&"chain"in options)||options.chain,isFunc=isFunction(object);return arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__);return(result.__actions__=copyArray(this.__actions__)).push({func:func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}return func.apply(object,arrayPush([this.value()],arguments))})}),object}function noConflict(){return root._===this&&(root._=oldDash),this}function noop(){}function nthArg(n){return n=toInteger(n),function(){return arguments[n]}}function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}function propertyOf(object){return function(path){return null==object?undefined:baseGet(object,path)}}function times(n,iteratee){if((n=toInteger(n))<1||n>MAX_SAFE_INTEGER)return[];var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=toFunction(iteratee),n-=MAX_ARRAY_LENGTH;for(var result=baseTimes(length,iteratee);++index<n;)iteratee(index);return result}function toPath(value){return isArray(value)?arrayMap(value,String):stringToPath(value)}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}function add(augend,addend){var result;return augend!==undefined&&(result=augend),addend!==undefined&&(result=result===undefined?addend:result+addend),result}function max(array){return array&&array.length?baseExtremum(array,identity,gt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee),gt):undefined}function mean(array){return sum(array)/(array?array.length:0)}function min(array){return array&&array.length?baseExtremum(array,identity,lt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee),lt):undefined}function subtract(minuend,subtrahend){var result;return minuend!==undefined&&(result=minuend),subtrahend!==undefined&&(result=result===undefined?subtrahend:result-subtrahend),result}function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee)):0}context=context?_.defaults({},context,_.pick(root,contextProps)):root;var Date=context.Date,Error=context.Error,Math=context.Math,RegExp=context.RegExp,TypeError=context.TypeError,arrayProto=context.Array.prototype,objectProto=context.Object.prototype,funcToString=context.Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,objectCtorString=funcToString.call(Object),objectToString=objectProto.toString,oldDash=root._,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Reflect=context.Reflect,Symbol=context.Symbol,Uint8Array=context.Uint8Array,clearTimeout=context.clearTimeout,enumerate=Reflect?Reflect.enumerate:undefined,getPrototypeOf=Object.getPrototypeOf,getOwnPropertySymbols=Object.getOwnPropertySymbols,iteratorSymbol="symbol"==typeof(iteratorSymbol=Symbol&&Symbol.iterator)?iteratorSymbol:undefined,propertyIsEnumerable=objectProto.propertyIsEnumerable,setTimeout=context.setTimeout,splice=arrayProto.splice,nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=Object.keys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse,Map=getNative(context,"Map"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create"),metaMap=WeakMap&&new WeakMap,mapCtorString=Map?funcToString.call(Map):"",setCtorString=Set?funcToString.call(Set):"",symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=Symbol?symbolProto.valueOf:undefined,symbolToString=Symbol?symbolProto.toString:undefined,realNames={};lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};var baseCreate=function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=undefined}return result||{}}}(),baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0),baseFor=createBaseFor(),baseForRight=createBaseFor(!0);enumerate&&!propertyIsEnumerable.call({valueOf:1},"valueOf")&&(baseKeysIn=function(object){return iteratorToArray(enumerate(object))});var baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity,createSet=Set&&2===new Set([1,2]).size?function(values){return new Set(values)}:noop,getData=metaMap?function(func){return metaMap.get(func)}:noop,getLength=baseProperty("length"),getSymbols=getOwnPropertySymbols||function(){return[]};(Map&&getTag(new Map)!=mapTag||Set&&getTag(new Set)!=setTag)&&(getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:null,ctorString="function"==typeof Ctor?funcToString.call(Ctor):"";if(ctorString){if(ctorString==mapCtorString)return mapTag;if(ctorString==setCtorString)return setTag}return result});var setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=HOT_COUNT)return key}else count=0;return baseSetData(key,value)}}(),concat=rest(function(array,values){return isArray(array)||(array=null==array?[]:[Object(array)]),values=baseFlatten(values),arrayConcat(array,values)}),difference=rest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,!1,!0)):[]}),differenceBy=rest(function(array,values){var iteratee=last(values);return isArrayLikeObject(iteratee)&&(iteratee=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,!1,!0),getIteratee(iteratee)):[]}),differenceWith=rest(function(array,values){var comparator=last(values);return isArrayLikeObject(comparator)&&(comparator=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,!1,!0),undefined,comparator):[]}),intersection=rest(function(arrays){var mapped=arrayMap(arrays,toArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]}),intersectionBy=rest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,toArrayLikeObject);return iteratee===last(mapped)?iteratee=undefined:mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee)):[]}),intersectionWith=rest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,toArrayLikeObject);return comparator===last(mapped)?comparator=undefined:mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]}),pull=rest(pullAll),pullAt=rest(function(array,indexes){indexes=arrayMap(baseFlatten(indexes),String);var result=baseAt(array,indexes);return basePullAt(array,indexes.sort(compareAscending)),result}),union=rest(function(arrays){return baseUniq(baseFlatten(arrays,!1,!0))}),unionBy=rest(function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseUniq(baseFlatten(arrays,!1,!0),getIteratee(iteratee))}),unionWith=rest(function(arrays){var comparator=last(arrays);return isArrayLikeObject(comparator)&&(comparator=undefined),baseUniq(baseFlatten(arrays,!1,!0),undefined,comparator)}),without=rest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]}),xor=rest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))}),xorBy=rest(function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee))}),xorWith=rest(function(arrays){var comparator=last(arrays);return isArrayLikeObject(comparator)&&(comparator=undefined),baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)}),zip=rest(unzip),zipWith=rest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;return iteratee="function"==typeof iteratee?(arrays.pop(),iteratee):undefined,unzipWith(arrays,iteratee)}),wrapperAt=rest(function(paths){paths=baseFlatten(paths);var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};return!(length>1||this.__actions__.length)&&value instanceof LazyWrapper&&isIndex(start)?(value=value.slice(start,+start+(length?1:0)),value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(value,this.__chain__).thru(function(array){return length&&!array.length&&array.push(undefined),array})):this.thru(interceptor)}),countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1}),groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):result[key]=[value]}),invokeMap=rest(function(collection,path,args){var index=-1,isFunc="function"==typeof path,isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value){var func=isFunc?path:isProp&&null!=value?value[path]:undefined;result[++index]=func?apply(func,value,args):baseInvoke(value,path,args)}),result}),keyBy=createAggregator(function(result,value,key){result[key]=value}),partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]}),sortBy=rest(function(collection,iteratees){if(null==collection)return[];var length=iteratees.length;return length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])?iteratees=[]:length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])&&(iteratees.length=1),baseOrderBy(collection,baseFlatten(iteratees),[])}),now=Date.now,bind=rest(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var placeholder=lodash.placeholder||bind.placeholder,holders=replaceHolders(partials,placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)}),bindKey=rest(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var placeholder=lodash.placeholder||bindKey.placeholder,holders=replaceHolders(partials,placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)}),defer=rest(function(func,args){return baseDelay(func,1,args)}),delay=rest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)}),overArgs=rest(function(func,transforms){transforms=arrayMap(baseFlatten(transforms),getIteratee());var funcsLength=transforms.length;return rest(function(args){for(var index=-1,length=nativeMin(args.length,funcsLength);++index<length;)args[index]=transforms[index].call(this,args[index]);return apply(func,this,args)})}),partial=rest(function(func,partials){var placeholder=lodash.placeholder||partial.placeholder,holders=replaceHolders(partials,placeholder);return createWrapper(func,PARTIAL_FLAG,undefined,partials,holders)}),partialRight=rest(function(func,partials){var placeholder=lodash.placeholder||partialRight.placeholder,holders=replaceHolders(partials,placeholder);return createWrapper(func,PARTIAL_RIGHT_FLAG,undefined,partials,holders)}),rearg=rest(function(func,indexes){return createWrapper(func,REARG_FLAG,undefined,undefined,undefined,baseFlatten(indexes))}),isArray=Array.isArray,assign=createAssigner(function(object,source){copyObject(source,keys(source),object)}),assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object)}),assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObjectWith(source,keysIn(source),object,customizer)}),assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObjectWith(source,keys(source),object,customizer)}),at=rest(function(object,paths){return baseAt(object,baseFlatten(paths))}),defaults=rest(function(args){return args.push(undefined,assignInDefaults),apply(assignInWith,undefined,args)}),defaultsDeep=rest(function(args){return args.push(undefined,mergeDefaults),apply(mergeWith,undefined,args)}),invert=createInverter(function(result,value,key){result[value]=key},constant(identity)),invertBy=createInverter(function(result,value,key){hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]},getIteratee),invoke=rest(baseInvoke),merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)}),mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)}),omit=rest(function(object,props){return null==object?{}:(props=arrayMap(baseFlatten(props),String),basePick(object,baseDifference(keysIn(object),props)))}),pick=rest(function(object,props){return null==object?{}:basePick(object,baseFlatten(props))}),camelCase=createCompounder(function(result,word,index){return word=word.toLowerCase(),result+(index?capitalize(word):word)}),kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()}),lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()}),lowerFirst=createCaseFirst("toLowerCase"),upperFirst=createCaseFirst("toUpperCase"),snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()}),startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+capitalize(word)}),upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()}),attempt=rest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isObject(e)?e:new Error(e)}}),bindAll=rest(function(object,methodNames){return arrayEach(baseFlatten(methodNames),function(key){object[key]=bind(object[key],object)}),object}),flow=createFlow(),flowRight=createFlow(!0),method=rest(function(path,args){return function(object){return baseInvoke(object,path,args)}}),methodOf=rest(function(object,args){return function(path){return baseInvoke(object,path,args)}}),over=createOver(arrayMap),overEvery=createOver(arrayEvery),overSome=createOver(arraySome),range=createRange(),rangeRight=createRange(!0),ceil=createRound("ceil"),floor=createRound("floor"),round=createRound("round");return lodash.prototype=baseLodash.prototype,LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype=nativeCreate?nativeCreate(null):objectProto,MapCache.prototype.clear=mapClear,MapCache.prototype.delete=mapDelete,MapCache.prototype.get=mapGet,MapCache.prototype.has=mapHas,MapCache.prototype.set=mapSet,SetCache.prototype.push=cachePush,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet,memoize.Cache=MapCache,lodash.after=after,lodash.ary=ary,lodash.assign=assign,lodash.assignIn=assignIn,lodash.assignInWith=assignInWith,lodash.assignWith=assignWith,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.concat=concat,lodash.cond=cond,lodash.conforms=conforms,lodash.constant=constant,lodash.countBy=countBy,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defaultsDeep=defaultsDeep,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.differenceBy=differenceBy,lodash.differenceWith=differenceWith,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatMap=flatMap,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flip=flip,lodash.flow=flow,lodash.flowRight=flowRight,lodash.fromPairs=fromPairs,lodash.functions=functions,lodash.functionsIn=functionsIn,lodash.groupBy=groupBy,lodash.initial=initial,lodash.intersection=intersection,lodash.intersectionBy=intersectionBy,lodash.intersectionWith=intersectionWith,lodash.invert=invert,lodash.invertBy=invertBy,lodash.invokeMap=invokeMap,lodash.iteratee=iteratee,lodash.keyBy=keyBy,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=merge,lodash.mergeWith=mergeWith,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=nthArg,lodash.omit=omit,lodash.omitBy=omitBy,lodash.once=once,lodash.orderBy=orderBy,lodash.over=over,lodash.overArgs=overArgs,lodash.overEvery=overEvery,lodash.overSome=overSome,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=pull,lodash.pullAll=pullAll,lodash.pullAllBy=pullAllBy,lodash.pullAt=pullAt,lodash.range=range,lodash.rangeRight=rangeRight,lodash.rearg=rearg,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.reverse=reverse,lodash.sampleSize=sampleSize,lodash.set=set,lodash.setWith=setWith,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=sortBy,lodash.sortedUniq=sortedUniq,lodash.sortedUniqBy=sortedUniqBy,lodash.split=split,lodash.spread=spread,lodash.tail=tail,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=toPairs,lodash.toPairsIn=toPairsIn,lodash.toPath=toPath,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.unary=unary,lodash.union=union,lodash.unionBy=unionBy,lodash.unionWith=unionWith,lodash.uniq=uniq,lodash.uniqBy=uniqBy,lodash.uniqWith=uniqWith,lodash.unset=unset,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.without=without,lodash.words=words,lodash.wrap=wrap,lodash.xor=xor,lodash.xorBy=xorBy,lodash.xorWith=xorWith,lodash.zip=zip,lodash.zipObject=zipObject,lodash.zipObjectDeep=zipObjectDeep,lodash.zipWith=zipWith,lodash.extend=assignIn,lodash.extendWith=assignInWith,mixin(lodash,lodash),lodash.add=add,lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=capitalize,lodash.ceil=ceil,lodash.clamp=clamp,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.cloneDeepWith=cloneDeepWith,lodash.cloneWith=cloneWith,lodash.deburr=deburr,lodash.endsWith=endsWith,lodash.eq=eq,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.floor=floor,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.get=get,lodash.gt=gt,lodash.gte=gte,lodash.has=has,lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.invoke=invoke,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=isBoolean,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isEqualWith=isEqualWith,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMatch=isMatch,lodash.isMatchWith=isMatchWith,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNil=isNil,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isSafeInteger=isSafeInteger,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=isTypedArray,lodash.isUndefined=isUndefined,lodash.join=join,lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lowerCase=lowerCase,lodash.lowerFirst=lowerFirst,lodash.lt=lt,lodash.lte=lte,lodash.max=max,lodash.maxBy=maxBy,lodash.mean=mean,lodash.min=min,lodash.minBy=minBy,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=now,lodash.pad=pad,lodash.padEnd=padEnd,lodash.padStart=padStart,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.replace=replace,lodash.result=result,lodash.round=round,lodash.runInContext=runInContext,lodash.sample=sample,lodash.size=size,lodash.snakeCase=snakeCase,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedIndexBy=sortedIndexBy,lodash.sortedIndexOf=sortedIndexOf,lodash.sortedLastIndex=sortedLastIndex,lodash.sortedLastIndexBy=sortedLastIndexBy,lodash.sortedLastIndexOf=sortedLastIndexOf,lodash.startCase=startCase,lodash.startsWith=startsWith,lodash.subtract=subtract,lodash.sum=sum,lodash.sumBy=sumBy,lodash.template=template,lodash.times=times,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=toLower,lodash.toNumber=toNumber,lodash.toSafeInteger=toSafeInteger,lodash.toString=toString,lodash.toUpper=toUpper,lodash.trim=trim,lodash.trimEnd=trimEnd,lodash.trimStart=trimStart,lodash.truncate=truncate,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.upperCase=upperCase,lodash.upperFirst=upperFirst,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,function(){var source={};return baseForOwn(lodash,function(func,methodName){hasOwnProperty.call(lodash.prototype,methodName)||(source[methodName]=func)}),source}(),{chain:!1}),lodash.VERSION=VERSION,arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash}),arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__;if(filtered&&!index)return new LazyWrapper(this);n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.clone();return filtered?result.__takeCount__=nativeMin(n,result.__takeCount__):result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")}),result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}}),arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();return result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type}),result.__filtered__=result.__filtered__||isFilter,result}}),arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}}),arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}}),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()},LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)},LazyWrapper.prototype.invokeMap=rest(function(path,args){return"function"==typeof path?new LazyWrapper(this):this.map(function(value){return baseInvoke(value,path,args)})}),LazyWrapper.prototype.reject=function(predicate){return predicate=getIteratee(predicate,3),this.filter(function(value){return!predicate(value)})},LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;return result.__filtered__&&(start>0||end<0)?new LazyWrapper(result):(start<0?result=result.takeRight(-start):start&&(result=result.drop(start)),end!==undefined&&(end=toInteger(end),result=end<0?result.dropRight(-end):result.take(end-start)),result)},LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)},baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+("last"==methodName?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);lodashFunc&&(lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value),interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);return result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(result,chainAll)}return isUnwrapped&&onlyLazy?func.apply(this,args):(result=this.thru(interceptor),isUnwrapped?isTaker?result.value()[0]:result.value():result)})}),arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;return retUnwrapped&&!this.__chain__?func.apply(this.value(),args):this[chainName](function(value){return func.apply(value,args)})}}),baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"";(realNames[key]||(realNames[key]=[])).push({name:methodName,func:lodashFunc})}}),realNames[createHybridWrapper(undefined,BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.at=wrapperAt,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.flatMap=wrapperFlatMap,lodash.prototype.next=wrapperNext,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,iteratorSymbol&&(lodash.prototype[iteratorSymbol]=wrapperToIterator),lodash}var undefined,VERSION="4.2.1",BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256,FLIP_FLAG=512,UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2,DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",HOT_COUNT=150,HOT_SPAN=16,LARGE_ARRAY_SIZE=200,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3,FUNC_ERROR_TEXT="Expected a function",HASH_UNDEFINED="__lodash_hash_undefined__",INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=NaN,MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1,PLACEHOLDER="__lodash_placeholder__",argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source),reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reHasHexPrefix=/^0x/i,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsOctal=/^0o[0-7]+$/i,reIsUint=/^(?:0|[1-9]\d*)$/,reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,rsBreakRange="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsBreak="["+rsBreakRange+"]",rsCombo="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",rsLower="[a-z\\xdf-\\xf6\\xf8-\\xff]",rsMisc="[^\\ud800-\\udfff"+rsBreakRange+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",rsLowerMisc="(?:"+rsLower+"|"+rsMisc+")",reOptMod="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",rsOptJoin="(?:\\u200d(?:"+["[^\\ud800-\\udfff]",rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+rsOptJoin,rsEmoji="(?:"+["[\\u2700-\\u27bf]",rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+["[^\\ud800-\\udfff]"+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,"[\\ud800-\\udfff]"].join("|")+")",reComboMark=RegExp(rsCombo,"g"),reComplexSymbol=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g"),reHasComplexSymbol=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),reBasicWord=/[a-zA-Z0-9]+/g,reComplexWord=RegExp([rsUpper+"?"+rsLower+"+(?="+[rsBreak,rsUpper,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?="+[rsBreak,rsUpper+rsLowerMisc,"$"].join("|")+")",rsUpper+"?"+rsLowerMisc+"+",rsUpper+"+","\\d+",rsEmoji].join("|"),"g"),reHasComplexWord=/[a-z][A-Z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,contextProps=["Array","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags["[object WeakMap]"]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags["[object WeakMap]"]=!1;var deburredLetters={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},objectTypes={function:!0,object:!0},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeParseFloat=parseFloat,freeParseInt=parseInt,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:null,freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:null,freeGlobal=checkGlobal(freeExports&&freeModule&&"object"==typeof global&&global),freeSelf=checkGlobal(objectTypes[typeof self]&&self),freeWindow=checkGlobal(objectTypes[typeof window]&&window),moduleExports=freeModule&&freeModule.exports===freeExports?freeExports:null,thisGlobal=checkGlobal(objectTypes[typeof this]&&this),root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")(),_=runInContext();(freeWindow||freeSelf||{})._=_,"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return _}):freeExports&&freeModule?(moduleExports&&((freeModule.exports=_)._=_),freeExports._=_):root._=_}.call(this),function(){_.contains=_.indexOf}(),function(undefined){function dfl(a,b,c){switch(arguments.length){case 2:return null!=a?a:b;case 3:return null!=a?a:null!=b?b:c;default:throw new Error("Implement me")}}function hasOwnProp(a,b){return hasOwnProperty.call(a,b)}function defaultParsingFlags(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function printMsg(msg){!1===moment.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+msg)}function deprecate(msg,fn){var firstTime=!0;return extend(function(){return firstTime&&(printMsg(msg),firstTime=!1),fn.apply(this,arguments)},fn)}function deprecateSimple(name,msg){deprecations[name]||(printMsg(msg),deprecations[name]=!0)}function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function monthDiff(a,b){var anchor2,adjust,wholeMonthDiff=12*(b.year()-a.year())+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months");return b-anchor<0?(anchor2=a.clone().add(wholeMonthDiff-1,"months"),adjust=(b-anchor)/(anchor-anchor2)):(anchor2=a.clone().add(wholeMonthDiff+1,"months"),adjust=(b-anchor)/(anchor2-anchor)),-(wholeMonthDiff+adjust)}function meridiemFixWrap(locale,hour,meridiem){var isPm;return null==meridiem?hour:null!=locale.meridiemHour?locale.meridiemHour(hour,meridiem):null!=locale.isPM?(isPm=locale.isPM(meridiem),isPm&&hour<12&&(hour+=12),isPm||12!==hour||(hour=0),hour):hour}function Locale(){}function Moment(config,skipOverflow){!1!==skipOverflow&&checkOverflow(config),copyConfig(this,config),this._d=new Date(+config._d),!1===updateInProgress&&(updateInProgress=!0,moment.updateOffset(this),updateInProgress=!1)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+36e5*hours,this._days=+days+7*weeks,this._months=+months+3*quarters+12*years,this._data={},this._locale=moment.localeData(),this._bubble()}function extend(a,b){for(var i in b)hasOwnProp(b,i)&&(a[i]=b[i]);return hasOwnProp(b,"toString")&&(a.toString=b.toString),hasOwnProp(b,"valueOf")&&(a.valueOf=b.valueOf),a}function copyConfig(to,from){var i,prop,val;if(void 0!==from._isAMomentObject&&(to._isAMomentObject=from._isAMomentObject),void 0!==from._i&&(to._i=from._i),void 0!==from._f&&(to._f=from._f),void 0!==from._l&&(to._l=from._l),void 0!==from._strict&&(to._strict=from._strict),void 0!==from._tzm&&(to._tzm=from._tzm),void 0!==from._isUTC&&(to._isUTC=from._isUTC),void 0!==from._offset&&(to._offset=from._offset),void 0!==from._pf&&(to._pf=from._pf),void 0!==from._locale&&(to._locale=from._locale),momentProperties.length>0)for(i in momentProperties)prop=momentProperties[i],void 0!==(val=from[prop])&&(to[prop]=val);return to}function absRound(number){return number<0?Math.ceil(number):Math.floor(number)}function leftZeroFill(number,targetLength,forceSign){for(var output=""+Math.abs(number),sign=number>=0;output.length<targetLength;)output="0"+output;return(sign?forceSign?"+":"":"-")+output}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};return res.months=other.month()-base.month()+12*(other.year()-base.year()),base.clone().add(res.months,"M").isAfter(other)&&--res.months,res.milliseconds=+other-+base.clone().add(res.months,"M"),res}function momentsDifference(base,other){var res;return other=makeAs(other,base),base.isBefore(other)?res=positiveMomentsDifference(base,other):(res=positiveMomentsDifference(other,base),res.milliseconds=-res.milliseconds,res.months=-res.months),res}function createAdder(direction,name){return function(val,period){var dur,tmp;return null===period||isNaN(+period)||(deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period)."),tmp=val,val=period,period=tmp),val="string"==typeof val?+val:val,dur=moment.duration(val,period),addOrSubtractDurationFromMoment(this,dur,direction),this}}function addOrSubtractDurationFromMoment(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=duration._days,months=duration._months;updateOffset=null==updateOffset||updateOffset,milliseconds&&mom._d.setTime(+mom._d+milliseconds*isAdding),days&&rawSetter(mom,"Date",rawGetter(mom,"Date")+days*isAdding),months&&rawMonthSetter(mom,rawGetter(mom,"Month")+months*isAdding),updateOffset&&moment.updateOffset(mom,days||months)}function isArray(input){return"[object Array]"===Object.prototype.toString.call(input)}function isDate(input){return"[object Date]"===Object.prototype.toString.call(input)||input instanceof Date}function compareArrays(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;i<len;i++)(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i]))&&diffs++;return diffs+lengthDiff}function normalizeUnits(units){if(units){var lowered=units.toLowerCase().replace(/(.)s$/,"$1");units=unitAliases[units]||camelFunctions[lowered]||lowered}return units}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)hasOwnProp(inputObject,prop)&&(normalizedProp=normalizeUnits(prop))&&(normalizedInput[normalizedProp]=inputObject[prop]);return normalizedInput}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=coercedNumber>=0?Math.floor(coercedNumber):Math.ceil(coercedNumber)),value}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}function weeksInYear(year,dow,doy){return weekOfYear(moment([year,11,31+dow-doy]),dow,doy).week}function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4==0&&year%100!=0||year%400==0}function checkOverflow(m){var overflow;m._a&&-2===m._pf.overflow&&(overflow=m._a[MONTH]<0||m._a[MONTH]>11?MONTH:m._a[DATE]<1||m._a[DATE]>daysInMonth(m._a[YEAR],m._a[MONTH])?DATE:m._a[HOUR]<0||m._a[HOUR]>24||24===m._a[HOUR]&&(0!==m._a[MINUTE]||0!==m._a[SECOND]||0!==m._a[MILLISECOND])?HOUR:m._a[MINUTE]<0||m._a[MINUTE]>59?MINUTE:m._a[SECOND]<0||m._a[SECOND]>59?SECOND:m._a[MILLISECOND]<0||m._a[MILLISECOND]>999?MILLISECOND:-1,m._pf._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)&&(overflow=DATE),m._pf.overflow=overflow)}function isValid(m){return null==m._isValid&&(m._isValid=!isNaN(m._d.getTime())&&m._pf.overflow<0&&!m._pf.empty&&!m._pf.invalidMonth&&!m._pf.nullInput&&!m._pf.invalidFormat&&!m._pf.userInvalidated,m._strict&&(m._isValid=m._isValid&&0===m._pf.charsLeftOver&&0===m._pf.unusedTokens.length&&m._pf.bigHour===undefined)),m._isValid}function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){for(var j,next,locale,split,i=0;i<names.length;){for(split=normalizeLocale(names[i]).split("-"),j=split.length,next=normalizeLocale(names[i+1]),next=next?next.split("-"):null;j>0;){if(locale=loadLocale(split.slice(0,j).join("-")))return locale;if(next&&next.length>=j&&compareArrays(split,next,!0)>=j-1)break;j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&hasModule)try{oldLocale=moment.locale(),require("./locale/"+name),moment.locale(oldLocale)}catch(e){}return locales[name]}function makeAs(input,model){var res,diff;return model._isUTC?(res=model.clone(),diff=(moment.isMoment(input)||isDate(input)?+input:+moment(input))-+res,res._d.setTime(+res._d+diff),moment.updateOffset(res,!1),res):moment(input).local()}function removeFormattingTokens(input){return input.match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;i<length;i++)formatTokenFunctions[array[i]]?array[i]=formatTokenFunctions[array[i]]:array[i]=removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;i<length;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.localeData()),formatFunctions[format]||(formatFunctions[format]=makeFormatFunction(format)),formatFunctions[format](m)):m.localeData().invalidDate()}function expandFormat(format,locale){function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}var i=5;for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens),localFormattingTokens.lastIndex=0,i-=1;return format}function getParseRegexForToken(token,config){var strict=config._strict;switch(token){case"Q":return parseTokenOneDigit;case"DDDD":return parseTokenThreeDigits;case"YYYY":case"GGGG":case"gggg":return strict?parseTokenFourDigits:parseTokenOneToFourDigits;case"Y":case"G":case"g":return parseTokenSignedNumber;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return strict?parseTokenSixDigits:parseTokenOneToSixDigits;case"S":if(strict)return parseTokenOneDigit;case"SS":if(strict)return parseTokenTwoDigits;case"SSS":if(strict)return parseTokenThreeDigits;case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return parseTokenWord;case"a":case"A":return config._locale._meridiemParse;case"x":return parseTokenOffsetMs;case"X":return parseTokenTimestampMs;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"SSSS":return parseTokenDigits;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return strict?parseTokenTwoDigits:parseTokenOneOrTwoDigits;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return parseTokenOneOrTwoDigits;case"Do":return strict?config._locale._ordinalParse:config._locale._ordinalParseLenient;default:return new RegExp(regexpEscape(unescapeFormat(token.replace("\\",""))))}}function utcOffsetFromString(string){string=string||"";var possibleTzMatches=string.match(parseTokenTimezone)||[],tzChunk=possibleTzMatches[possibleTzMatches.length-1]||[],parts=(tzChunk+"").match(parseTimezoneChunker)||["-",0,0],minutes=60*parts[1]+toInt(parts[2]);return"+"===parts[0]?minutes:-minutes}function addTimeToArrayFromToken(token,input,config){var a,datePartArray=config._a;switch(token){case"Q":null!=input&&(datePartArray[MONTH]=3*(toInt(input)-1));break;case"M":case"MM":null!=input&&(datePartArray[MONTH]=toInt(input)-1);break;case"MMM":case"MMMM":a=config._locale.monthsParse(input,token,config._strict),null!=a?datePartArray[MONTH]=a:config._pf.invalidMonth=input;break;case"D":case"DD":null!=input&&(datePartArray[DATE]=toInt(input));break;case"Do":null!=input&&(datePartArray[DATE]=toInt(parseInt(input.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=input&&(config._dayOfYear=toInt(input));break;case"YY":datePartArray[YEAR]=moment.parseTwoDigitYear(input);break;case"YYYY":case"YYYYY":case"YYYYYY":datePartArray[YEAR]=toInt(input);break;case"a":case"A":config._meridiem=input;break;case"h":case"hh":config._pf.bigHour=!0;case"H":case"HH":datePartArray[HOUR]=toInt(input);break;case"m":case"mm":datePartArray[MINUTE]=toInt(input);break;case"s":case"ss":datePartArray[SECOND]=toInt(input);break;case"S":case"SS":case"SSS":case"SSSS":datePartArray[MILLISECOND]=toInt(1e3*("0."+input));break;case"x":config._d=new Date(toInt(input));break;case"X":config._d=new Date(1e3*parseFloat(input));break;case"Z":case"ZZ":config._useUTC=!0,config._tzm=utcOffsetFromString(input);break;case"dd":case"ddd":case"dddd":a=config._locale.weekdaysParse(input),null!=a?(config._w=config._w||{},config._w.d=a):config._pf.invalidWeekday=input;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":token=token.substr(0,1);case"gggg":case"GGGG":case"GGGGG":token=token.substr(0,2),input&&(config._w=config._w||{},config._w[token]=toInt(input));break;case"gg":case"GG":config._w=config._w||{},config._w[token]=moment.parseTwoDigitYear(input)}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp;w=config._w,null!=w.GG||null!=w.W||null!=w.E?(dow=1,doy=4,weekYear=dfl(w.GG,config._a[YEAR],weekOfYear(moment(),1,4).year),week=dfl(w.W,1),weekday=dfl(w.E,1)):(dow=config._locale._week.dow,doy=config._locale._week.doy,weekYear=dfl(w.gg,config._a[YEAR],weekOfYear(moment(),dow,doy).year),week=dfl(w.w,1),null!=w.d?(weekday=w.d)<dow&&++week:weekday=null!=w.e?w.e+dow:dow),temp=dayOfYearFromWeeks(weekYear,week,weekday,doy,dow),config._a[YEAR]=temp.year,config._dayOfYear=temp.dayOfYear}function dateFromConfig(config){var i,date,currentDate,yearToUse,input=[];if(!config._d){for(currentDate=currentDateArray(config),config._w&&null==config._a[DATE]&&null==config._a[MONTH]&&dayOfYearFromWeekInfo(config),config._dayOfYear&&(yearToUse=dfl(config._a[YEAR],currentDate[YEAR]),config._dayOfYear>daysInYear(yearToUse)&&(config._pf._overflowDayOfYear=!0),date=makeUTCDate(yearToUse,0,config._dayOfYear),config._a[MONTH]=date.getUTCMonth(),config._a[DATE]=date.getUTCDate()),i=0;i<3&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;i<7;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];24===config._a[HOUR]&&0===config._a[MINUTE]&&0===config._a[SECOND]&&0===config._a[MILLISECOND]&&(config._nextDay=!0,config._a[HOUR]=0),config._d=(config._useUTC?makeUTCDate:makeDate).apply(null,input),null!=config._tzm&&config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm),config._nextDay&&(config._a[HOUR]=24)}}function dateFromObject(config){var normalizedInput;config._d||(normalizedInput=normalizeObjectUnits(config._i),config._a=[normalizedInput.year,normalizedInput.month,normalizedInput.day||normalizedInput.date,normalizedInput.hour,normalizedInput.minute,normalizedInput.second,normalizedInput.millisecond],dateFromConfig(config))}function currentDateArray(config){var now=new Date;return config._useUTC?[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]:[now.getFullYear(),now.getMonth(),now.getDate()]}function makeDateFromStringAndFormat(config){if(config._f===moment.ISO_8601)return void parseISO(config);config._a=[],config._pf.empty=!0;var i,parsedInput,tokens,token,skipped,string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0],parsedInput&&(skipped=string.substr(0,string.indexOf(parsedInput)),skipped.length>0&&config._pf.unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?config._pf.empty=!1:config._pf.unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&config._pf.unusedTokens.push(token);config._pf.charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&config._pf.unusedInput.push(string),!0===config._pf.bigHour&&config._a[HOUR]<=12&&(config._pf.bigHour=undefined),config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem),dateFromConfig(config),checkOverflow(config)}function unescapeFormat(s){return s.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4})}function regexpEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function makeDateFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(0===config._f.length)return config._pf.invalidFormat=!0,void(config._d=new Date(NaN));for(i=0;i<config._f.length;i++)currentScore=0,tempConfig=copyConfig({},config),null!=config._useUTC&&(tempConfig._useUTC=config._useUTC),tempConfig._pf=defaultParsingFlags(),tempConfig._f=config._f[i],makeDateFromStringAndFormat(tempConfig),isValid(tempConfig)&&(currentScore+=tempConfig._pf.charsLeftOver,currentScore+=10*tempConfig._pf.unusedTokens.length,tempConfig._pf.score=currentScore,(null==scoreToBeat||currentScore<scoreToBeat)&&(scoreToBeat=currentScore,bestMoment=tempConfig));extend(config,bestMoment||tempConfig)}function parseISO(config){var i,l,string=config._i,match=isoRegex.exec(string);if(match){for(config._pf.iso=!0,i=0,l=isoDates.length;i<l;i++)if(isoDates[i][1].exec(string)){config._f=isoDates[i][0]+(match[6]||" ");break}for(i=0,l=isoTimes.length;i<l;i++)if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}string.match(parseTokenTimezone)&&(config._f+="Z"),makeDateFromStringAndFormat(config)}else config._isValid=!1}function makeDateFromString(config){parseISO(config),!1===config._isValid&&(delete config._isValid,moment.createFromInputFallback(config))}function map(arr,fn){var i,res=[];for(i=0;i<arr.length;++i)res.push(fn(arr[i],i));return res}function makeDateFromInput(config){var matched,input=config._i;input===undefined?config._d=new Date:isDate(input)?config._d=new Date(+input):null!==(matched=aspNetJsonRegex.exec(input))?config._d=new Date(+matched[1]):"string"==typeof input?makeDateFromString(config):isArray(input)?(config._a=map(input.slice(0),function(obj){return parseInt(obj,10)}),dateFromConfig(config)):"object"==typeof input?dateFromObject(config):"number"==typeof input?config._d=new Date(input):moment.createFromInputFallback(config)}function makeDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);return y<1970&&date.setFullYear(y),date}function makeUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));return y<1970&&date.setUTCFullYear(y),date}function parseWeekday(input,locale){if("string"==typeof input)if(isNaN(input)){if("number"!=typeof(input=locale.weekdaysParse(input)))return null}else input=parseInt(input,10);return input}function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime(posNegDuration,withoutSuffix,locale){var duration=moment.duration(posNegDuration).abs(),seconds=round(duration.as("s")),minutes=round(duration.as("m")),hours=round(duration.as("h")),days=round(duration.as("d")),months=round(duration.as("M")),years=round(duration.as("y")),args=seconds<relativeTimeThresholds.s&&["s",seconds]||1===minutes&&["m"]||minutes<relativeTimeThresholds.m&&["mm",minutes]||1===hours&&["h"]||hours<relativeTimeThresholds.h&&["hh",hours]||1===days&&["d"]||days<relativeTimeThresholds.d&&["dd",days]||1===months&&["M"]||months<relativeTimeThresholds.M&&["MM",months]||1===years&&["y"]||["yy",years];return args[2]=withoutSuffix,args[3]=+posNegDuration>0,args[4]=locale,substituteTimeAgo.apply({},args)}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var adjustedMoment,end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();return daysToDayOfWeek>end&&(daysToDayOfWeek-=7),daysToDayOfWeek<end-7&&(daysToDayOfWeek+=7),adjustedMoment=moment(mom).add(daysToDayOfWeek,"d"),{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var daysToAdd,dayOfYear,d=makeUTCDate(year,0,1).getUTCDay();return d=0===d?7:d,weekday=null!=weekday?weekday:firstDayOfWeek,daysToAdd=firstDayOfWeek-d+(d>firstDayOfWeekOfYear?7:0)-(d<firstDayOfWeek?7:0),dayOfYear=7*(week-1)+(weekday-firstDayOfWeek)+daysToAdd+1,{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function makeMoment(config){var res,input=config._i,format=config._f;return config._locale=config._locale||moment.localeData(config._l),null===input||format===undefined&&""===input?moment.invalid({nullInput:!0}):("string"==typeof input&&(config._i=input=config._locale.preparse(input)),moment.isMoment(input)?new Moment(input,!0):(format?isArray(format)?makeDateFromStringAndArray(config):makeDateFromStringAndFormat(config):makeDateFromInput(config),res=new Moment(config),res._nextDay&&(res.add(1,"d"),res._nextDay=undefined),res))}function pickBy(fn,moments){var res,i;if(1===moments.length&&isArray(moments[0])&&(moments=moments[0]),!moments.length)return moment();for(res=moments[0],i=1;i<moments.length;++i)moments[i][fn](res)&&(res=moments[i]);return res}function rawMonthSetter(mom,value){var dayOfMonth;return"string"==typeof value&&"number"!=typeof(value=mom.localeData().monthsParse(value))?mom:(dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value)),mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth),mom)}function rawGetter(mom,unit){return mom._d["get"+(mom._isUTC?"UTC":"")+unit]()}function rawSetter(mom,unit,value){return"Month"===unit?rawMonthSetter(mom,value):mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}function makeAccessor(unit,keepTime){return function(value){return null!=value?(rawSetter(this,unit,value),moment.updateOffset(this,keepTime),this):rawGetter(this,unit)}}function daysToYears(days){return 400*days/146097}function yearsToDays(years){return 146097*years/400}function makeGlobal(shouldDeprecate){"undefined"==typeof ender&&(oldGlobalMoment=globalScope.moment,globalScope.moment=shouldDeprecate?deprecate("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",moment):moment)}for(var moment,oldGlobalMoment,i,globalScope="undefined"==typeof global||"undefined"!=typeof window&&window!==global.window?this:global,round=Math.round,hasOwnProperty=Object.prototype.hasOwnProperty,YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6,locales={},momentProperties=[],hasModule="undefined"!=typeof module&&module&&module.exports,aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,aspNetTimeSpanJsonRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,isoDurationRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenOneToFourDigits=/\d{1,4}/,parseTokenOneToSixDigits=/[+\-]?\d{1,6}/,parseTokenDigits=/\d+/,parseTokenWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/gi,parseTokenT=/T/i,parseTokenOffsetMs=/[\+\-]?\d+/,parseTokenTimestampMs=/[\+\-]?\d+(\.\d{1,3})?/,parseTokenOneDigit=/\d/,parseTokenTwoDigits=/\d\d/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{4}/,parseTokenSixDigits=/[+-]?\d{6}/,parseTokenSignedNumber=/[+-]?\d+/,isoRegex=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,unitMillisecondFactors=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),unitAliases={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},camelFunctions={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},formatFunctions={},relativeTimeThresholds={s:45,m:45,h:22,d:26,M:11},ordinalizeTokens="DDD w W M D d".split(" "),paddedTokens="M D H h m s w W".split(" "),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return this.localeData().monthsShort(this,format)},MMMM:function(format){return this.localeData().months(this,format)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(format){return this.localeData().weekdaysMin(this,format)},ddd:function(format){return this.localeData().weekdaysShort(this,format)},dddd:function(format){return this.localeData().weekdays(this,format)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},YYYYY:function(){return leftZeroFill(this.year(),5)},YYYYYY:function(){var y=this.year();return(y>=0?"+":"-")+leftZeroFill(Math.abs(y),6)},gg:function(){return leftZeroFill(this.weekYear()%100,2)},gggg:function(){return leftZeroFill(this.weekYear(),4)},ggggg:function(){return leftZeroFill(this.weekYear(),5)},GG:function(){return leftZeroFill(this.isoWeekYear()%100,2)},GGGG:function(){return leftZeroFill(this.isoWeekYear(),4)},GGGGG:function(){return leftZeroFill(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return toInt(this.milliseconds()/100)},SS:function(){return leftZeroFill(toInt(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},SSSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=this.utcOffset(),b="+";return a<0&&(a=-a,b="-"),b+leftZeroFill(toInt(a/60),2)+":"+leftZeroFill(toInt(a)%60,2)},ZZ:function(){var a=this.utcOffset(),b="+";return a<0&&(a=-a,b="-"),b+leftZeroFill(toInt(a/60),2)+leftZeroFill(toInt(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},deprecations={},lists=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"],updateInProgress=!1;ordinalizeTokens.length;)i=ordinalizeTokens.pop(),formatTokenFunctions[i+"o"]=function(func,period){return function(a){return this.localeData().ordinal(func.call(this,a),period)}}(formatTokenFunctions[i],i);for(;paddedTokens.length;)i=paddedTokens.pop(),formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2);formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3),extend(Locale.prototype,{set:function(config){var prop,i;for(i in config)prop=config[i],"function"==typeof prop?this[i]=prop:this["_"+i]=prop;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(m){return this._months[m.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(m){return this._monthsShort[m.month()]},monthsParse:function(monthName,format,strict){var i,mom,regex;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(mom=moment.utc([2e3,i]),strict&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")),strict||this._monthsParse[i]||(regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),strict&&"MMMM"===format&&this._longMonthsParse[i].test(monthName))return i;if(strict&&"MMM"===format&&this._shortMonthsParse[i].test(monthName))return i;if(!strict&&this._monthsParse[i].test(monthName))return i}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(m){return this._weekdays[m.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(m){return this._weekdaysShort[m.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(m){return this._weekdaysMin[m.day()]},weekdaysParse:function(weekdayName){var i,mom,regex;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;i<7;i++)if(this._weekdaysParse[i]||(mom=moment([2e3,1]).day(i),regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),this._weekdaysParse[i].test(weekdayName))return i},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(key){var output=this._longDateFormat[key];return!output&&this._longDateFormat[key.toUpperCase()]&&(output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)}),this._longDateFormat[key]=output),output},isPM:function(input){return"p"===(input+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(key,mom,now){var output=this._calendar[key];return"function"==typeof output?output.apply(mom,[now]):output},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},pastFuture:function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return"function"==typeof format?format(output):format.replace(/%s/i,output)},ordinal:function(number){return this._ordinal.replace("%d",number)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(string){return string},postformat:function(string){return string},week:function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},firstDayOfWeek:function(){return this._week.dow},firstDayOfYear:function(){return this._week.doy},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),moment=function(input,format,locale,strict){var c;return"boolean"==typeof locale&&(strict=locale,locale=undefined),c={},c._isAMomentObject=!0,c._i=input,c._f=format,c._l=locale,c._strict=strict,c._isUTC=!1,c._pf=defaultParsingFlags(),makeMoment(c)},moment.suppressDeprecationWarnings=!1,moment.createFromInputFallback=deprecate("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))}),moment.min=function(){return pickBy("isBefore",[].slice.call(arguments,0))},moment.max=function(){return pickBy("isAfter",[].slice.call(arguments,0))},moment.utc=function(input,format,locale,strict){var c;return"boolean"==typeof locale&&(strict=locale,locale=undefined),c={},c._isAMomentObject=!0,c._useUTC=!0,c._isUTC=!0,c._l=locale,c._i=input,c._f=format,c._strict=strict,c._pf=defaultParsingFlags(),makeMoment(c).utc()},moment.unix=function(input){return moment(1e3*input)},moment.duration=function(input,key){var sign,ret,parseIso,diffRes,duration=input,match=null;return moment.isDuration(input)?duration={ms:input._milliseconds,d:input._days,M:input._months}:"number"==typeof input?(duration={},key?duration[key]=input:duration.milliseconds=input):(match=aspNetTimeSpanJsonRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}):(match=isoDurationRegex.exec(input))?(sign="-"===match[1]?-1:1,parseIso=function(inp){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign},duration={y:parseIso(match[2]),M:parseIso(match[3]),d:parseIso(match[4]),h:parseIso(match[5]),m:parseIso(match[6]),s:parseIso(match[7]),w:parseIso(match[8])}):null==duration?duration={}:"object"==typeof duration&&("from"in duration||"to"in duration)&&(diffRes=momentsDifference(moment(duration.from),moment(duration.to)),duration={},duration.ms=diffRes.milliseconds,duration.M=diffRes.months),ret=new Duration(duration),moment.isDuration(input)&&hasOwnProp(input,"_locale")&&(ret._locale=input._locale),ret},moment.version="2.9.0",moment.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",moment.ISO_8601=function(){},moment.momentProperties=momentProperties,moment.updateOffset=function(){},moment.relativeTimeThreshold=function(threshold,limit){return relativeTimeThresholds[threshold]!==undefined&&(limit===undefined?relativeTimeThresholds[threshold]:(relativeTimeThresholds[threshold]=limit,!0))},moment.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",function(key,value){return moment.locale(key,value)}),moment.locale=function(key,values){var data;return key&&(data=void 0!==values?moment.defineLocale(key,values):moment.localeData(key))&&(moment.duration._locale=moment._locale=data),moment._locale._abbr},moment.defineLocale=function(name,values){return null!==values?(values.abbr=name,locales[name]||(locales[name]=new Locale),locales[name].set(values),moment.locale(name),locales[name]):(delete locales[name],null)},moment.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",function(key){return moment.localeData(key)}),moment.localeData=function(key){var locale;if(key&&key._locale&&key._locale._abbr&&(key=key._locale._abbr),!key)return moment._locale;if(!isArray(key)){if(locale=loadLocale(key))return locale;key=[key]}return chooseLocale(key)},moment.isMoment=function(obj){return obj instanceof Moment||null!=obj&&hasOwnProp(obj,"_isAMomentObject")},moment.isDuration=function(obj){return obj instanceof Duration};for(i=lists.length-1;i>=0;--i)!function(field){var count,setter;if(0===field.indexOf("week"))count=7,setter="day";else{if(0!==field.indexOf("month"))return;count=12,setter="month"}moment[field]=function(format,index){var i,getter,method=moment._locale[field],results=[];if("number"==typeof format&&(index=format,format=undefined),getter=function(i){var m=moment().utc().set(setter,i);return method.call(moment._locale,m,format||"")},null!=index)return getter(index);for(i=0;i<count;i++)results.push(getter(i));return results}}(lists[i]);moment.normalizeUnits=function(units){return normalizeUnits(units)},moment.invalid=function(flags){var m=moment.utc(NaN);return null!=flags?extend(m._pf,flags):m._pf.userInvalidated=!0,m},moment.parseZone=function(){return moment.apply(null,arguments).parseZone()},moment.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)},moment.isDate=isDate,extend(moment.fn=Moment.prototype,{clone:function(){return moment(this)},valueOf:function(){return+this._d-6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var m=moment(this).utc();return 0<m.year()&&m.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds()]},isValid:function(){return isValid(this)},isDSTShifted:function(){return!!this._a&&(this.isValid()&&compareArrays(this._a,(this._isUTC?moment.utc(this._a):moment(this._a)).toArray())>0)},parsingFlags:function(){return extend({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(keepLocalTime){return this.utcOffset(0,keepLocalTime)},local:function(keepLocalTime){return this._isUTC&&(this.utcOffset(0,keepLocalTime),this._isUTC=!1,keepLocalTime&&this.subtract(this._dateUtcOffset(),"m")),this},format:function(inputString){var output=formatMoment(this,inputString||moment.defaultFormat);return this.localeData().postformat(output)},add:createAdder(1,"add"),subtract:createAdder(-1,"subtract"),diff:function(input,units,asFloat){var diff,output,that=makeAs(input,this),zoneDiff=6e4*(that.utcOffset()-this.utcOffset());return units=normalizeUnits(units),"year"===units||"month"===units||"quarter"===units?(output=monthDiff(this,that),"quarter"===units?output/=3:"year"===units&&(output/=12)):(diff=this-that,output="second"===units?diff/1e3:"minute"===units?diff/6e4:"hour"===units?diff/36e5:"day"===units?(diff-zoneDiff)/864e5:"week"===units?(diff-zoneDiff)/6048e5:diff),asFloat?output:absRound(output)},from:function(time,withoutSuffix){return moment.duration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(time){var now=time||moment(),sod=makeAs(now,this).startOf("day"),diff=this.diff(sod,"days",!0),format=diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse";return this.format(this.localeData().calendar(format,this,moment(now)))},isLeapYear:function(){return isLeapYear(this.year())},isDST:function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=parseWeekday(input,this.localeData()),this.add(input-day,"d")):day},month:makeAccessor("Month",!0),startOf:function(units){switch(units=normalizeUnits(units)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===units?this.weekday(0):"isoWeek"===units&&this.isoWeekday(1),"quarter"===units&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(units){return units=normalizeUnits(units),units===undefined||"millisecond"===units?this:this.startOf(units).add(1,"isoWeek"===units?"week":units).subtract(1,"ms")},isAfter:function(input,units){return units=normalizeUnits(void 0!==units?units:"millisecond"),"millisecond"===units?(input=moment.isMoment(input)?input:moment(input),+this>+input):(moment.isMoment(input)?+input:+moment(input))<+this.clone().startOf(units)},isBefore:function(input,units){var inputMs;return units=normalizeUnits(void 0!==units?units:"millisecond"),"millisecond"===units?(input=moment.isMoment(input)?input:moment(input),+this<+input):(inputMs=moment.isMoment(input)?+input:+moment(input),+this.clone().endOf(units)<inputMs)},isBetween:function(from,to,units){return this.isAfter(from,units)&&this.isBefore(to,units)},isSame:function(input,units){var inputMs;return units=normalizeUnits(units||"millisecond"),"millisecond"===units?(input=moment.isMoment(input)?input:moment(input),+this==+input):(inputMs=+moment(input),+this.clone().startOf(units)<=inputMs&&inputMs<=+this.clone().endOf(units))},min:deprecate("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(other){return other=moment.apply(null,arguments),other<this?this:other}),max:deprecate("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(other){return other=moment.apply(null,arguments),other>this?this:other}),zone:deprecate("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",function(input,keepLocalTime){return null!=input?("string"!=typeof input&&(input=-input),this.utcOffset(input,keepLocalTime),this):-this.utcOffset()}),utcOffset:function(input,keepLocalTime){var localAdjust,offset=this._offset||0;return null!=input?("string"==typeof input&&(input=utcOffsetFromString(input)),Math.abs(input)<16&&(input*=60),!this._isUTC&&keepLocalTime&&(localAdjust=this._dateUtcOffset()),this._offset=input,this._isUTC=!0,null!=localAdjust&&this.add(localAdjust,"m"),offset!==input&&(!keepLocalTime||this._changeInProgress?addOrSubtractDurationFromMoment(this,moment.duration(input-offset,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,moment.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?offset:this._dateUtcOffset()},isLocal:function(){return!this._isUTC},isUtcOffset:function(){return this._isUTC},isUtc:function(){return this._isUTC&&0===this._offset},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(utcOffsetFromString(this._i)),this},hasAlignedHourOffset:function(input){return input=input?moment(input).utcOffset():0,(this.utcOffset()-input)%60==0},daysInMonth:function(){return daysInMonth(this.year(),this.month())},dayOfYear:function(input){var dayOfYear=round((moment(this).startOf("day")-moment(this).startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add(input-dayOfYear,"d")},quarter:function(input){return null==input?Math.ceil((this.month()+1)/3):this.month(3*(input-1)+this.month()%3)},weekYear:function(input){var year=weekOfYear(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==input?year:this.add(input-year,"y")},isoWeekYear:function(input){var year=weekOfYear(this,1,4).year;return null==input?year:this.add(input-year,"y")},week:function(input){var week=this.localeData().week(this);return null==input?week:this.add(7*(input-week),"d")},isoWeek:function(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add(7*(input-week),"d")},weekday:function(input){var weekday=(this.day()+7-this.localeData()._week.dow)%7;return null==input?weekday:this.add(input-weekday,"d")},isoWeekday:function(input){return null==input?this.day()||7:this.day(this.day()%7?input:input-7)},isoWeeksInYear:function(){return weeksInYear(this.year(),1,4)},weeksInYear:function(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)},get:function(units){return units=normalizeUnits(units),this[units]()},set:function(units,value){var unit;if("object"==typeof units)for(unit in units)this.set(unit,units[unit]);else units=normalizeUnits(units),"function"==typeof this[units]&&this[units](value);return this},locale:function(key){var newLocaleData;return key===undefined?this._locale._abbr:(newLocaleData=moment.localeData(key),null!=newLocaleData&&(this._locale=newLocaleData),this)},lang:deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){return key===undefined?this.localeData():this.locale(key)}),localeData:function(){return this._locale},_dateUtcOffset:function(){return 15*-Math.round(this._d.getTimezoneOffset()/15)}}),moment.fn.millisecond=moment.fn.milliseconds=makeAccessor("Milliseconds",!1),moment.fn.second=moment.fn.seconds=makeAccessor("Seconds",!1),moment.fn.minute=moment.fn.minutes=makeAccessor("Minutes",!1),moment.fn.hour=moment.fn.hours=makeAccessor("Hours",!0),moment.fn.date=makeAccessor("Date",!0),moment.fn.dates=deprecate("dates accessor is deprecated. Use date instead.",makeAccessor("Date",!0)),moment.fn.year=makeAccessor("FullYear",!0),moment.fn.years=deprecate("years accessor is deprecated. Use year instead.",makeAccessor("FullYear",!0)),moment.fn.days=moment.fn.day,moment.fn.months=moment.fn.month,moment.fn.weeks=moment.fn.week,moment.fn.isoWeeks=moment.fn.isoWeek,moment.fn.quarters=moment.fn.quarter,moment.fn.toJSON=moment.fn.toISOString,moment.fn.isUTC=moment.fn.isUtc,extend(moment.duration.fn=Duration.prototype,{_bubble:function(){var seconds,minutes,hours,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data,years=0;data.milliseconds=milliseconds%1e3,seconds=absRound(milliseconds/1e3),data.seconds=seconds%60,minutes=absRound(seconds/60),data.minutes=minutes%60,hours=absRound(minutes/60),data.hours=hours%24,days+=absRound(hours/24),years=absRound(daysToYears(days)),days-=absRound(yearsToDays(years)),months+=absRound(days/30),days%=30,years+=absRound(months/12),months%=12,data.days=days,data.months=months,data.years=years},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12)},humanize:function(withSuffix){var output=relativeTime(this,!withSuffix,this.localeData());return withSuffix&&(output=this.localeData().pastFuture(+this,output)),this.localeData().postformat(output)},add:function(input,val){var dur=moment.duration(input,val);return this._milliseconds+=dur._milliseconds,this._days+=dur._days,this._months+=dur._months,this._bubble(),this},subtract:function(input,val){var dur=moment.duration(input,val);return this._milliseconds-=dur._milliseconds,this._days-=dur._days,this._months-=dur._months,this._bubble(),this},get:function(units){return units=normalizeUnits(units),this[units.toLowerCase()+"s"]()},as:function(units){var days,months;if("month"===(units=normalizeUnits(units))||"year"===units)return days=this._days+this._milliseconds/864e5,months=this._months+12*daysToYears(days),"month"===units?months:months/12;switch(days=this._days+Math.round(yearsToDays(this._months/12)),units){case"week":return days/7+this._milliseconds/6048e5;case"day":return days+this._milliseconds/864e5;case"hour":return 24*days+this._milliseconds/36e5;case"minute":return 24*days*60+this._milliseconds/6e4;case"second":return 24*days*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*days*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+units)}},lang:moment.fn.lang,locale:moment.fn.locale,toIsoString:deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var years=Math.abs(this.years()),months=Math.abs(this.months()),days=Math.abs(this.days()),hours=Math.abs(this.hours()),minutes=Math.abs(this.minutes()),seconds=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(years?years+"Y":"")+(months?months+"M":"")+(days?days+"D":"")+(hours||minutes||seconds?"T":"")+(hours?hours+"H":"")+(minutes?minutes+"M":"")+(seconds?seconds+"S":""):"P0D"},localeData:function(){return this._locale},toJSON:function(){return this.toISOString()}}),moment.duration.fn.toString=moment.duration.fn.toISOString;for(i in unitMillisecondFactors)hasOwnProp(unitMillisecondFactors,i)&&function(name){moment.duration.fn[name]=function(){return this._data[name]}}(i.toLowerCase());moment.duration.fn.asMilliseconds=function(){return this.as("ms")},moment.duration.fn.asSeconds=function(){return this.as("s")},moment.duration.fn.asMinutes=function(){return this.as("m")},moment.duration.fn.asHours=function(){return this.as("h")},moment.duration.fn.asDays=function(){return this.as("d")},moment.duration.fn.asWeeks=function(){return this.as("weeks")},moment.duration.fn.asMonths=function(){return this.as("M")},moment.duration.fn.asYears=function(){return this.as("y")},moment.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10;return number+(1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}}),hasModule?module.exports=moment:"function"==typeof define&&define.amd?(define(function(require,exports,module){return module.config&&module.config()&&!0===module.config().noGlobal&&(globalScope.moment=oldGlobalMoment),moment}),makeGlobal(!0)):makeGlobal()}.call(this),function(){"use strict";var root=this,previous=root.Chart,Chart=function(context){this.canvas=context.canvas,this.ctx=context;var computeDimension=function(element,dimension){return element["offset"+dimension]?element["offset"+dimension]:document.defaultView.getComputedStyle(element).getPropertyValue(dimension)},width=this.width=computeDimension(context.canvas,"Width"),height=this.height=computeDimension(context.canvas,"Height");context.canvas.width=width,context.canvas.height=height;var width=this.width=context.canvas.width,height=this.height=context.canvas.height;return this.aspectRatio=this.width/this.height,helpers.retinaScale(this),this};Chart.defaults={global:{animation:!0,animationSteps:60,animationEasing:"easeOutQuart",showScale:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleIntegersOnly:!0,scaleBeginAtZero:!1,scaleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",responsive:!1,maintainAspectRatio:!0,showTooltips:!0,customTooltips:!1,tooltipEvents:["mousemove","touchstart","touchmove","mouseout"],tooltipFillColor:"rgba(0,0,0,0.8)",tooltipFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontSize:14,tooltipFontStyle:"normal",tooltipFontColor:"#fff",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTitleFontSize:14,tooltipTitleFontStyle:"bold",tooltipTitleFontColor:"#fff",tooltipYPadding:6,tooltipXPadding:6,tooltipCaretSize:8,tooltipCornerRadius:6,tooltipXOffset:10,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",multiTooltipTemplate:"<%= value %>",multiTooltipKeyBackground:"#fff",onAnimationProgress:function(){},onAnimationComplete:function(){}}},Chart.types={};var helpers=Chart.helpers={},each=helpers.each=function(loopable,callback,self){var additionalArgs=Array.prototype.slice.call(arguments,3);if(loopable)if(loopable.length===+loopable.length){var i;for(i=0;i<loopable.length;i++)callback.apply(self,[loopable[i],i].concat(additionalArgs))}else for(var item in loopable)callback.apply(self,[loopable[item],item].concat(additionalArgs))},clone=helpers.clone=function(obj){var objClone={};return each(obj,function(value,key){obj.hasOwnProperty(key)&&(objClone[key]=value)}),objClone},extend=helpers.extend=function(base){return each(Array.prototype.slice.call(arguments,1),function(extensionObject){each(extensionObject,function(value,key){extensionObject.hasOwnProperty(key)&&(base[key]=value)})}),base},merge=helpers.merge=function(base,master){var args=Array.prototype.slice.call(arguments,0);return args.unshift({}),extend.apply(null,args)},indexOf=helpers.indexOf=function(arrayToSearch,item){if(Array.prototype.indexOf)return arrayToSearch.indexOf(item);for(var i=0;i<arrayToSearch.length;i++)if(arrayToSearch[i]===item)return i;return-1},inherits=(helpers.where=function(collection,filterCallback){var filtered=[];return helpers.each(collection,function(item){filterCallback(item)&&filtered.push(item)}),filtered},helpers.findNextWhere=function(arrayToSearch,filterCallback,startIndex){startIndex||(startIndex=-1);for(var i=startIndex+1;i<arrayToSearch.length;i++){var currentItem=arrayToSearch[i];if(filterCallback(currentItem))return currentItem}},helpers.findPreviousWhere=function(arrayToSearch,filterCallback,startIndex){startIndex||(startIndex=arrayToSearch.length);for(var i=startIndex-1;i>=0;i--){var currentItem=arrayToSearch[i];if(filterCallback(currentItem))return currentItem}},helpers.inherits=function(extensions){var parent=this,ChartElement=extensions&&extensions.hasOwnProperty("constructor")?extensions.constructor:function(){return parent.apply(this,arguments)},Surrogate=function(){this.constructor=ChartElement};return Surrogate.prototype=parent.prototype,ChartElement.prototype=new Surrogate,ChartElement.extend=inherits,extensions&&extend(ChartElement.prototype,extensions),ChartElement.__super__=parent.prototype,ChartElement}),noop=helpers.noop=function(){},uid=helpers.uid=function(){var id=0;return function(){return"chart-"+id++}}(),warn=helpers.warn=function(str){window.console&&"function"==typeof window.console.warn&&console.warn(str)},amd=helpers.amd="function"==typeof define&&define.amd,isNumber=helpers.isNumber=function(n){return!isNaN(parseFloat(n))&&isFinite(n)},max=helpers.max=function(array){return Math.max.apply(Math,array)},min=helpers.min=function(array){return Math.min.apply(Math,array)},getDecimalPlaces=(helpers.cap=function(valueToCap,maxValue,minValue){if(isNumber(maxValue)){if(valueToCap>maxValue)return maxValue}else if(isNumber(minValue)&&valueToCap<minValue)return minValue;return valueToCap},helpers.getDecimalPlaces=function(num){return num%1!=0&&isNumber(num)?num.toString().split(".")[1].length:0}),toRadians=helpers.radians=function(degrees){return degrees*(Math.PI/180)},aliasPixel=(helpers.getAngleFromPoint=function(centrePoint,anglePoint){var distanceFromXCenter=anglePoint.x-centrePoint.x,distanceFromYCenter=anglePoint.y-centrePoint.y,radialDistanceFromCenter=Math.sqrt(distanceFromXCenter*distanceFromXCenter+distanceFromYCenter*distanceFromYCenter),angle=2*Math.PI+Math.atan2(distanceFromYCenter,distanceFromXCenter);return distanceFromXCenter<0&&distanceFromYCenter<0&&(angle+=2*Math.PI),{angle:angle,distance:radialDistanceFromCenter}},helpers.aliasPixel=function(pixelWidth){return pixelWidth%2==0?0:.5}),calculateOrderOfMagnitude=(helpers.splineCurve=function(FirstPoint,MiddlePoint,AfterPoint,t){var d01=Math.sqrt(Math.pow(MiddlePoint.x-FirstPoint.x,2)+Math.pow(MiddlePoint.y-FirstPoint.y,2)),d12=Math.sqrt(Math.pow(AfterPoint.x-MiddlePoint.x,2)+Math.pow(AfterPoint.y-MiddlePoint.y,2)),fa=t*d01/(d01+d12),fb=t*d12/(d01+d12);return{inner:{x:MiddlePoint.x-fa*(AfterPoint.x-FirstPoint.x),y:MiddlePoint.y-fa*(AfterPoint.y-FirstPoint.y)},outer:{x:MiddlePoint.x+fb*(AfterPoint.x-FirstPoint.x),y:MiddlePoint.y+fb*(AfterPoint.y-FirstPoint.y)}}},helpers.calculateOrderOfMagnitude=function(val){return Math.floor(Math.log(val)/Math.LN10)}),template=(helpers.calculateScaleRange=function(valuesArray,drawingSize,textSize,startFromZero,integersOnly){var maxSteps=Math.floor(drawingSize/(1.5*textSize)),skipFitting=2>=maxSteps,maxValue=max(valuesArray),minValue=min(valuesArray);maxValue===minValue&&(maxValue+=.5,minValue>=.5&&!startFromZero?minValue-=.5:maxValue+=.5);for(var valueRange=Math.abs(maxValue-minValue),rangeOrderOfMagnitude=calculateOrderOfMagnitude(valueRange),graphMax=Math.ceil(maxValue/(1*Math.pow(10,rangeOrderOfMagnitude)))*Math.pow(10,rangeOrderOfMagnitude),graphMin=startFromZero?0:Math.floor(minValue/(1*Math.pow(10,rangeOrderOfMagnitude)))*Math.pow(10,rangeOrderOfMagnitude),graphRange=graphMax-graphMin,stepValue=Math.pow(10,rangeOrderOfMagnitude),numberOfSteps=Math.round(graphRange/stepValue);(numberOfSteps>maxSteps||2*numberOfSteps<maxSteps)&&!skipFitting;)if(numberOfSteps>maxSteps)stepValue*=2,(numberOfSteps=Math.round(graphRange/stepValue))%1!=0&&(skipFitting=!0);else if(integersOnly&&rangeOrderOfMagnitude>=0){if(stepValue/2%1!=0)break;stepValue/=2,numberOfSteps=Math.round(graphRange/stepValue)}else stepValue/=2,numberOfSteps=Math.round(graphRange/stepValue);return skipFitting&&(numberOfSteps=2,stepValue=graphRange/numberOfSteps),{steps:numberOfSteps,stepValue:stepValue,min:graphMin,max:graphMin+numberOfSteps*stepValue}},helpers.template=function(templateString,valuesObject){if(templateString instanceof Function)return templateString(valuesObject);var cache={};return function(str,data){var fn=/\W/.test(str)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):cache[str]=cache[str];return data?fn(data):fn}(templateString,valuesObject)}),easingEffects=(helpers.generateLabels=function(templateString,numberOfSteps,graphMin,stepValue){var labelsArray=new Array(numberOfSteps);return labelTemplateString&&each(labelsArray,function(val,index){labelsArray[index]=template(templateString,{value:graphMin+stepValue*(index+1)})}),labelsArray},helpers.easingEffects={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return-1*t*(t-2)},easeInOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return 1*((t=t/1-1)*t*t+1)},easeInOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return-1*((t=t/1-1)*t*t*t-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},easeInQuint:function(t){return 1*(t/=1)*t*t*t*t},easeOutQuint:function(t){return 1*((t=t/1-1)*t*t*t*t+1)},easeInOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},easeInSine:function(t){return-1*Math.cos(t/1*(Math.PI/2))+1},easeOutSine:function(t){return 1*Math.sin(t/1*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t/1)-1)},easeInExpo:function(t){return 0===t?1:1*Math.pow(2,10*(t/1-1))},easeOutExpo:function(t){return 1===t?1:1*(1-Math.pow(2,-10*t/1))},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},easeInCirc:function(t){return t>=1?t:-1*(Math.sqrt(1-(t/=1)*t)-1)},easeOutCirc:function(t){return 1*Math.sqrt(1-(t=t/1-1)*t)},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInElastic:function(t){var s=1.70158,p=0,a=1;return 0===t?0:1==(t/=1)?1:(p||(p=.3),a<Math.abs(1)?(a=1,s=p/4):s=p/(2*Math.PI)*Math.asin(1/a),-a*Math.pow(2,10*(t-=1))*Math.sin((1*t-s)*(2*Math.PI)/p))},easeOutElastic:function(t){var s=1.70158,p=0,a=1;return 0===t?0:1==(t/=1)?1:(p||(p=.3),a<Math.abs(1)?(a=1,s=p/4):s=p/(2*Math.PI)*Math.asin(1/a),a*Math.pow(2,-10*t)*Math.sin((1*t-s)*(2*Math.PI)/p)+1)},easeInOutElastic:function(t){var s=1.70158,p=0,a=1;return 0===t?0:2==(t/=.5)?1:(p||(p=.3*1.5*1),a<Math.abs(1)?(a=1,s=p/4):s=p/(2*Math.PI)*Math.asin(1/a),t<1?a*Math.pow(2,10*(t-=1))*Math.sin((1*t-s)*(2*Math.PI)/p)*-.5:a*Math.pow(2,-10*(t-=1))*Math.sin((1*t-s)*(2*Math.PI)/p)*.5+1)},easeInBack:function(t){var s=1.70158;return 1*(t/=1)*t*((s+1)*t-s)},easeOutBack:function(t){var s=1.70158;return 1*((t=t/1-1)*t*((s+1)*t+s)+1)},easeInOutBack:function(t){var s=1.70158;return(t/=.5)<1?t*t*((1+(s*=1.525))*t-s)*.5:.5*((t-=2)*t*((1+(s*=1.525))*t+s)+2)},easeInBounce:function(t){return 1-easingEffects.easeOutBounce(1-t)},easeOutBounce:function(t){return(t/=1)<1/2.75?7.5625*t*t*1:t<2/2.75?1*(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1*(7.5625*(t-=2.25/2.75)*t+.9375):1*(7.5625*(t-=2.625/2.75)*t+.984375)},easeInOutBounce:function(t){return t<.5?.5*easingEffects.easeInBounce(2*t):.5*easingEffects.easeOutBounce(2*t-1)+.5}}),requestAnimFrame=helpers.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return window.setTimeout(callback,1e3/60)}}(),cancelAnimFrame=helpers.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(callback){return window.clearTimeout(callback,1e3/60)}}(),addEvent=(helpers.animationLoop=function(callback,totalSteps,easingString,onProgress,onComplete,chartInstance){var currentStep=0,easingFunction=easingEffects[easingString]||easingEffects.linear,animationFrame=function(){currentStep++;var stepDecimal=currentStep/totalSteps,easeDecimal=easingFunction(stepDecimal);callback.call(chartInstance,easeDecimal,stepDecimal,currentStep),onProgress.call(chartInstance,easeDecimal,stepDecimal),currentStep<totalSteps?chartInstance.animationFrame=requestAnimFrame(animationFrame):onComplete.apply(chartInstance)};requestAnimFrame(animationFrame)},helpers.getRelativePosition=function(evt){var mouseX,mouseY,e=evt.originalEvent||evt,canvas=evt.currentTarget||evt.srcElement,boundingRect=canvas.getBoundingClientRect();return e.touches?(mouseX=e.touches[0].clientX-boundingRect.left,mouseY=e.touches[0].clientY-boundingRect.top):(mouseX=e.clientX-boundingRect.left,mouseY=e.clientY-boundingRect.top),{x:mouseX,y:mouseY}},helpers.addEvent=function(node,eventType,method){node.addEventListener?node.addEventListener(eventType,method):node.attachEvent?node.attachEvent("on"+eventType,method):node["on"+eventType]=method}),removeEvent=helpers.removeEvent=function(node,eventType,handler){node.removeEventListener?node.removeEventListener(eventType,handler,!1):node.detachEvent?node.detachEvent("on"+eventType,handler):node["on"+eventType]=noop},unbindEvents=(helpers.bindEvents=function(chartInstance,arrayOfEvents,handler){chartInstance.events||(chartInstance.events={}),each(arrayOfEvents,function(eventName){chartInstance.events[eventName]=function(){handler.apply(chartInstance,arguments)},addEvent(chartInstance.chart.canvas,eventName,chartInstance.events[eventName])})},helpers.unbindEvents=function(chartInstance,arrayOfEvents){each(arrayOfEvents,function(handler,eventName){removeEvent(chartInstance.chart.canvas,eventName,handler)})}),getMaximumWidth=helpers.getMaximumWidth=function(domNode){return domNode.parentNode.clientWidth},getMaximumHeight=helpers.getMaximumHeight=function(domNode){return domNode.parentNode.clientHeight},retinaScale=(helpers.getMaximumSize=helpers.getMaximumWidth,helpers.retinaScale=function(chart){var ctx=chart.ctx,width=chart.canvas.width,height=chart.canvas.height;window.devicePixelRatio&&(ctx.canvas.style.width=width+"px",ctx.canvas.style.height=height+"px",ctx.canvas.height=height*window.devicePixelRatio,ctx.canvas.width=width*window.devicePixelRatio,ctx.scale(window.devicePixelRatio,window.devicePixelRatio))}),clear=helpers.clear=function(chart){chart.ctx.clearRect(0,0,chart.width,chart.height)},fontString=helpers.fontString=function(pixelSize,fontStyle,fontFamily){return fontStyle+" "+pixelSize+"px "+fontFamily},longestText=helpers.longestText=function(ctx,font,arrayOfStrings){ctx.font=font;var longest=0;return each(arrayOfStrings,function(string){var textWidth=ctx.measureText(string).width;longest=textWidth>longest?textWidth:longest}),longest},drawRoundedRectangle=helpers.drawRoundedRectangle=function(ctx,x,y,width,height,radius){ctx.beginPath(),ctx.moveTo(x+radius,y),ctx.lineTo(x+width-radius,y),ctx.quadraticCurveTo(x+width,y,x+width,y+radius),ctx.lineTo(x+width,y+height-radius),ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height),ctx.lineTo(x+radius,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-radius),ctx.lineTo(x,y+radius),ctx.quadraticCurveTo(x,y,x+radius,y),ctx.closePath()};Chart.instances={},Chart.Type=function(data,options,chart){this.options=options,this.chart=chart,this.id=uid(),Chart.instances[this.id]=this,options.responsive&&this.resize(),this.initialize.call(this,data)},extend(Chart.Type.prototype,{initialize:function(){return this},clear:function(){return clear(this.chart),this},stop:function(){return cancelAnimFrame(this.animationFrame),this},resize:function(callback){this.stop();var canvas=this.chart.canvas,newWidth=getMaximumWidth(this.chart.canvas),newHeight=this.options.maintainAspectRatio?newWidth/this.chart.aspectRatio:getMaximumHeight(this.chart.canvas);return canvas.width=this.chart.width=newWidth,canvas.height=this.chart.height=newHeight,retinaScale(this.chart),"function"==typeof callback&&callback.apply(this,Array.prototype.slice.call(arguments,1)),this},reflow:noop,render:function(reflow){return reflow&&this.reflow(),this.options.animation&&!reflow?helpers.animationLoop(this.draw,this.options.animationSteps,this.options.animationEasing,this.options.onAnimationProgress,this.options.onAnimationComplete,this):(this.draw(),this.options.onAnimationComplete.call(this)),this},generateLegend:function(){return template(this.options.legendTemplate,this)},destroy:function(){this.clear(),unbindEvents(this,this.events);var canvas=this.chart.canvas;canvas.width=this.chart.width,canvas.height=this.chart.height,canvas.style.removeProperty?(canvas.style.removeProperty("width"),canvas.style.removeProperty("height")):(canvas.style.removeAttribute("width"),canvas.style.removeAttribute("height")),delete Chart.instances[this.id]},showTooltip:function(ChartElements,forceRedraw){if(void 0===this.activeElements&&(this.activeElements=[]),function(Elements){var changed=!1;return Elements.length!==this.activeElements.length?changed=!0:(each(Elements,function(element,index){element!==this.activeElements[index]&&(changed=!0)},this),changed)}.call(this,ChartElements)||forceRedraw){if(this.activeElements=ChartElements,this.draw(),this.options.customTooltips&&this.options.customTooltips(!1),ChartElements.length>0)if(this.datasets&&this.datasets.length>1){for(var dataArray,dataIndex,i=this.datasets.length-1;i>=0&&(dataArray=this.datasets[i].points||this.datasets[i].bars||this.datasets[i].segments,-1===(dataIndex=indexOf(dataArray,ChartElements[0])));i--);var tooltipLabels=[],tooltipColors=[],medianPosition=function(index){var dataCollection,xMax,yMax,xMin,yMin,Elements=[],xPositions=[],yPositions=[];return helpers.each(this.datasets,function(dataset){dataCollection=dataset.points||dataset.bars||dataset.segments,dataCollection[dataIndex]&&dataCollection[dataIndex].hasValue()&&Elements.push(dataCollection[dataIndex])}),helpers.each(Elements,function(element){xPositions.push(element.x),yPositions.push(element.y),tooltipLabels.push(helpers.template(this.options.multiTooltipTemplate,element)),tooltipColors.push({fill:element._saved.fillColor||element.fillColor,stroke:element._saved.strokeColor||element.strokeColor})},this),yMin=min(yPositions),yMax=max(yPositions),xMin=min(xPositions),xMax=max(xPositions),{x:xMin>this.chart.width/2?xMin:xMax,y:(yMin+yMax)/2}}.call(this,dataIndex);new Chart.MultiTooltip({x:medianPosition.x,y:medianPosition.y,xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:tooltipLabels,legendColors:tooltipColors,legendColorBackground:this.options.multiTooltipKeyBackground,title:ChartElements[0].label,chart:this.chart,ctx:this.chart.ctx,custom:this.options.customTooltips}).draw()}else each(ChartElements,function(Element){var tooltipPosition=Element.tooltipPosition();new Chart.Tooltip({x:Math.round(tooltipPosition.x),y:Math.round(tooltipPosition.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:template(this.options.tooltipTemplate,Element),chart:this.chart,custom:this.options.customTooltips}).draw()},this);return this}},toBase64Image:function(){return this.chart.canvas.toDataURL.apply(this.chart.canvas,arguments)}}),Chart.Type.extend=function(extensions){var parent=this,ChartType=function(){return parent.apply(this,arguments)};if(ChartType.prototype=clone(parent.prototype),extend(ChartType.prototype,extensions),ChartType.extend=Chart.Type.extend,extensions.name||parent.prototype.name){var chartName=extensions.name||parent.prototype.name,baseDefaults=Chart.defaults[parent.prototype.name]?clone(Chart.defaults[parent.prototype.name]):{};Chart.defaults[chartName]=extend(baseDefaults,extensions.defaults),Chart.types[chartName]=ChartType,Chart.prototype[chartName]=function(data,options){var config=merge(Chart.defaults.global,Chart.defaults[chartName],options||{});return new ChartType(data,config,this)}}else warn("Name not provided for this chart, so it hasn't been registered");return parent},Chart.Element=function(configuration){extend(this,configuration),this.initialize.apply(this,arguments),this.save()},extend(Chart.Element.prototype,{initialize:function(){},restore:function(props){return props?each(props,function(key){this[key]=this._saved[key]},this):extend(this,this._saved),this},save:function(){return this._saved=clone(this),delete this._saved._saved,this},update:function(newProps){return each(newProps,function(value,key){this._saved[key]=this[key],this[key]=value},this),this},transition:function(props,ease){return each(props,function(value,key){this[key]=(value-this._saved[key])*ease+this._saved[key]},this),this},tooltipPosition:function(){return{x:this.x,y:this.y}},hasValue:function(){return isNumber(this.value)}}),Chart.Element.extend=inherits,Chart.Point=Chart.Element.extend({display:!0,inRange:function(chartX,chartY){var hitDetectionRange=this.hitDetectionRadius+this.radius;return Math.pow(chartX-this.x,2)+Math.pow(chartY-this.y,2)<Math.pow(hitDetectionRange,2)},draw:function(){if(this.display){var ctx=this.ctx;ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.closePath(),ctx.strokeStyle=this.strokeColor,ctx.lineWidth=this.strokeWidth,ctx.fillStyle=this.fillColor,ctx.fill(),ctx.stroke()}}}),Chart.Arc=Chart.Element.extend({inRange:function(chartX,chartY){var pointRelativePosition=helpers.getAngleFromPoint(this,{x:chartX,y:chartY}),betweenAngles=pointRelativePosition.angle>=this.startAngle&&pointRelativePosition.angle<=this.endAngle,withinRadius=pointRelativePosition.distance>=this.innerRadius&&pointRelativePosition.distance<=this.outerRadius;return betweenAngles&&withinRadius},tooltipPosition:function(){var centreAngle=this.startAngle+(this.endAngle-this.startAngle)/2,rangeFromCentre=(this.outerRadius-this.innerRadius)/2+this.innerRadius;return{x:this.x+Math.cos(centreAngle)*rangeFromCentre,y:this.y+Math.sin(centreAngle)*rangeFromCentre}},draw:function(animationPercent){var ctx=this.ctx;ctx.beginPath(),ctx.arc(this.x,this.y,this.outerRadius,this.startAngle,this.endAngle),ctx.arc(this.x,this.y,this.innerRadius,this.endAngle,this.startAngle,!0),ctx.closePath(),ctx.strokeStyle=this.strokeColor,ctx.lineWidth=this.strokeWidth,ctx.fillStyle=this.fillColor,ctx.fill(),ctx.lineJoin="bevel",this.showStroke&&ctx.stroke()}}),Chart.Rectangle=Chart.Element.extend({draw:function(){var ctx=this.ctx,halfWidth=this.width/2,leftX=this.x-halfWidth,rightX=this.x+halfWidth,top=this.base-(this.base-this.y),halfStroke=this.strokeWidth/2;this.showStroke&&(leftX+=halfStroke,rightX-=halfStroke,top+=halfStroke),ctx.beginPath(),ctx.fillStyle=this.fillColor,ctx.strokeStyle=this.strokeColor,ctx.lineWidth=this.strokeWidth,ctx.moveTo(leftX,this.base),ctx.lineTo(leftX,top),ctx.lineTo(rightX,top),ctx.lineTo(rightX,this.base),ctx.fill(),this.showStroke&&ctx.stroke()},height:function(){return this.base-this.y},inRange:function(chartX,chartY){return chartX>=this.x-this.width/2&&chartX<=this.x+this.width/2&&chartY>=this.y&&chartY<=this.base}}),Chart.Tooltip=Chart.Element.extend({draw:function(){var ctx=this.chart.ctx;ctx.font=fontString(this.fontSize,this.fontStyle,this.fontFamily),this.xAlign="center",this.yAlign="above";var caretPadding=this.caretPadding=2,tooltipWidth=ctx.measureText(this.text).width+2*this.xPadding,tooltipRectHeight=this.fontSize+2*this.yPadding,tooltipHeight=tooltipRectHeight+this.caretHeight+caretPadding;this.x+tooltipWidth/2>this.chart.width?this.xAlign="left":this.x-tooltipWidth/2<0&&(this.xAlign="right"),this.y-tooltipHeight<0&&(this.yAlign="below");var tooltipX=this.x-tooltipWidth/2,tooltipY=this.y-tooltipHeight;if(ctx.fillStyle=this.fillColor,this.custom)this.custom(this);else{switch(this.yAlign){case"above":ctx.beginPath(),ctx.moveTo(this.x,this.y-caretPadding),ctx.lineTo(this.x+this.caretHeight,this.y-(caretPadding+this.caretHeight)),ctx.lineTo(this.x-this.caretHeight,this.y-(caretPadding+this.caretHeight)),ctx.closePath(),ctx.fill();break;case"below":tooltipY=this.y+caretPadding+this.caretHeight,ctx.beginPath(),ctx.moveTo(this.x,this.y+caretPadding),ctx.lineTo(this.x+this.caretHeight,this.y+caretPadding+this.caretHeight),ctx.lineTo(this.x-this.caretHeight,this.y+caretPadding+this.caretHeight),ctx.closePath(),ctx.fill()}switch(this.xAlign){case"left":tooltipX=this.x-tooltipWidth+(this.cornerRadius+this.caretHeight);break;case"right":tooltipX=this.x-(this.cornerRadius+this.caretHeight)}drawRoundedRectangle(ctx,tooltipX,tooltipY,tooltipWidth,tooltipRectHeight,this.cornerRadius),ctx.fill(),ctx.fillStyle=this.textColor,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(this.text,tooltipX+tooltipWidth/2,tooltipY+tooltipRectHeight/2)}}}),Chart.MultiTooltip=Chart.Element.extend({initialize:function(){this.font=fontString(this.fontSize,this.fontStyle,this.fontFamily),this.titleFont=fontString(this.titleFontSize,this.titleFontStyle,this.titleFontFamily),this.height=this.labels.length*this.fontSize+(this.labels.length-1)*(this.fontSize/2)+2*this.yPadding+1.5*this.titleFontSize,this.ctx.font=this.titleFont;var titleWidth=this.ctx.measureText(this.title).width,labelWidth=longestText(this.ctx,this.font,this.labels)+this.fontSize+3,longestTextWidth=max([labelWidth,titleWidth]);this.width=longestTextWidth+2*this.xPadding;var halfHeight=this.height/2;this.y-halfHeight<0?this.y=halfHeight:this.y+halfHeight>this.chart.height&&(this.y=this.chart.height-halfHeight),this.x>this.chart.width/2?this.x-=this.xOffset+this.width:this.x+=this.xOffset},getLineHeight:function(index){var baseLineHeight=this.y-this.height/2+this.yPadding,afterTitleIndex=index-1;return 0===index?baseLineHeight+this.titleFontSize/2:baseLineHeight+(1.5*this.fontSize*afterTitleIndex+this.fontSize/2)+1.5*this.titleFontSize},draw:function(){if(this.custom)this.custom(this);else{drawRoundedRectangle(this.ctx,this.x,this.y-this.height/2,this.width,this.height,this.cornerRadius);var ctx=this.ctx;ctx.fillStyle=this.fillColor,ctx.fill(),ctx.closePath(),ctx.textAlign="left",ctx.textBaseline="middle",ctx.fillStyle=this.titleTextColor,ctx.font=this.titleFont,ctx.fillText(this.title,this.x+this.xPadding,this.getLineHeight(0)),ctx.font=this.font,helpers.each(this.labels,function(label,index){ctx.fillStyle=this.textColor,ctx.fillText(label,this.x+this.xPadding+this.fontSize+3,this.getLineHeight(index+1)),ctx.fillStyle=this.legendColorBackground,ctx.fillRect(this.x+this.xPadding,this.getLineHeight(index+1)-this.fontSize/2,this.fontSize,this.fontSize),ctx.fillStyle=this.legendColors[index].fill,ctx.fillRect(this.x+this.xPadding,this.getLineHeight(index+1)-this.fontSize/2,this.fontSize,this.fontSize)},this)}}}),Chart.Scale=Chart.Element.extend({initialize:function(){this.fit()},buildYLabels:function(){this.yLabels=[];for(var stepDecimalPlaces=getDecimalPlaces(this.stepValue),i=0;i<=this.steps;i++)this.yLabels.push(template(this.templateString,{value:(this.min+i*this.stepValue).toFixed(stepDecimalPlaces)}));this.yLabelWidth=this.display&&this.showLabels?longestText(this.ctx,this.font,this.yLabels):0},addXLabel:function(label){this.xLabels.push(label),this.valuesCount++,this.fit()},removeXLabel:function(){this.xLabels.shift(),this.valuesCount--,this.fit()},fit:function(){this.startPoint=this.display?this.fontSize:0,this.endPoint=this.display?this.height-1.5*this.fontSize-5:this.height,this.startPoint+=this.padding,this.endPoint-=this.padding;var cachedYLabelWidth,cachedHeight=this.endPoint-this.startPoint;for(this.calculateYRange(cachedHeight),this.buildYLabels(),this.calculateXLabelRotation();cachedHeight>this.endPoint-this.startPoint;)cachedHeight=this.endPoint-this.startPoint,cachedYLabelWidth=this.yLabelWidth,this.calculateYRange(cachedHeight),this.buildYLabels(),cachedYLabelWidth<this.yLabelWidth&&this.calculateXLabelRotation()},calculateXLabelRotation:function(){this.ctx.font=this.font;var firstRotated,firstWidth=this.ctx.measureText(this.xLabels[0]).width,lastWidth=this.ctx.measureText(this.xLabels[this.xLabels.length-1]).width;if(this.xScalePaddingRight=lastWidth/2+3,this.xScalePaddingLeft=firstWidth/2>this.yLabelWidth+10?firstWidth/2:this.yLabelWidth+10,this.xLabelRotation=0,this.display){var cosRotation,originalLabelWidth=longestText(this.ctx,this.font,this.xLabels);this.xLabelWidth=originalLabelWidth;for(var xGridWidth=Math.floor(this.calculateX(1)-this.calculateX(0))-6;this.xLabelWidth>xGridWidth&&0===this.xLabelRotation||this.xLabelWidth>xGridWidth&&this.xLabelRotation<=90&&this.xLabelRotation>0;)cosRotation=Math.cos(toRadians(this.xLabelRotation)),firstRotated=cosRotation*firstWidth,cosRotation*lastWidth,firstRotated+this.fontSize/2>this.yLabelWidth+8&&(this.xScalePaddingLeft=firstRotated+this.fontSize/2),this.xScalePaddingRight=this.fontSize/2,this.xLabelRotation++,this.xLabelWidth=cosRotation*originalLabelWidth;this.xLabelRotation>0&&(this.endPoint-=Math.sin(toRadians(this.xLabelRotation))*originalLabelWidth+3)}else this.xLabelWidth=0,this.xScalePaddingRight=this.padding,this.xScalePaddingLeft=this.padding},calculateYRange:noop,drawingArea:function(){return this.startPoint-this.endPoint},calculateY:function(value){var scalingFactor=this.drawingArea()/(this.min-this.max);return this.endPoint-scalingFactor*(value-this.min)},calculateX:function(index){var innerWidth=(this.xLabelRotation,this.width-(this.xScalePaddingLeft+this.xScalePaddingRight)),valueWidth=innerWidth/Math.max(this.valuesCount-(this.offsetGridLines?0:1),1),valueOffset=valueWidth*index+this.xScalePaddingLeft;return this.offsetGridLines&&(valueOffset+=valueWidth/2),Math.round(valueOffset)},update:function(newProps){helpers.extend(this,newProps),this.fit()},draw:function(){var ctx=this.ctx,yLabelGap=(this.endPoint-this.startPoint)/this.steps,xStart=Math.round(this.xScalePaddingLeft);this.display&&(ctx.fillStyle=this.textColor,ctx.font=this.font,each(this.yLabels,function(labelString,index){var yLabelCenter=this.endPoint-yLabelGap*index,linePositionY=Math.round(yLabelCenter),drawHorizontalLine=this.showHorizontalLines;ctx.textAlign="right",ctx.textBaseline="middle",this.showLabels&&ctx.fillText(labelString,xStart-10,yLabelCenter),0!==index||drawHorizontalLine||(drawHorizontalLine=!0),drawHorizontalLine&&ctx.beginPath(),index>0?(ctx.lineWidth=this.gridLineWidth,ctx.strokeStyle=this.gridLineColor):(ctx.lineWidth=this.lineWidth,ctx.strokeStyle=this.lineColor),linePositionY+=helpers.aliasPixel(ctx.lineWidth),drawHorizontalLine&&(ctx.moveTo(xStart,linePositionY),ctx.lineTo(this.width,linePositionY),ctx.stroke(),ctx.closePath()),ctx.lineWidth=this.lineWidth,ctx.strokeStyle=this.lineColor,ctx.beginPath(),ctx.moveTo(xStart-5,linePositionY),ctx.lineTo(xStart,linePositionY),ctx.stroke(),ctx.closePath()},this),each(this.xLabels,function(label,index){var xPos=this.calculateX(index)+aliasPixel(this.lineWidth),linePos=this.calculateX(index-(this.offsetGridLines?.5:0))+aliasPixel(this.lineWidth),isRotated=this.xLabelRotation>0,drawVerticalLine=this.showVerticalLines;0!==index||drawVerticalLine||(drawVerticalLine=!0),drawVerticalLine&&ctx.beginPath(),index>0?(ctx.lineWidth=this.gridLineWidth,ctx.strokeStyle=this.gridLineColor):(ctx.lineWidth=this.lineWidth,ctx.strokeStyle=this.lineColor),drawVerticalLine&&(ctx.moveTo(linePos,this.endPoint),ctx.lineTo(linePos,this.startPoint-3),ctx.stroke(),ctx.closePath()),ctx.lineWidth=this.lineWidth,ctx.strokeStyle=this.lineColor,ctx.beginPath(),ctx.moveTo(linePos,this.endPoint),ctx.lineTo(linePos,this.endPoint+5),ctx.stroke(),ctx.closePath(),ctx.save(),ctx.translate(xPos,isRotated?this.endPoint+12:this.endPoint+8),ctx.rotate(-1*toRadians(this.xLabelRotation)),ctx.font=this.font,ctx.textAlign=isRotated?"right":"center",ctx.textBaseline=isRotated?"middle":"top",ctx.fillText(label,0,0),ctx.restore()},this))}}),Chart.RadialScale=Chart.Element.extend({initialize:function(){this.size=min([this.height,this.width]),this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2},calculateCenterOffset:function(value){var scalingFactor=this.drawingArea/(this.max-this.min);return(value-this.min)*scalingFactor},update:function(){this.lineArc?this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2:this.setScaleSize(),this.buildYLabels()},buildYLabels:function(){this.yLabels=[];for(var stepDecimalPlaces=getDecimalPlaces(this.stepValue),i=0;i<=this.steps;i++)this.yLabels.push(template(this.templateString,{value:(this.min+i*this.stepValue).toFixed(stepDecimalPlaces)}))},getCircumference:function(){return 2*Math.PI/this.valuesCount},setScaleSize:function(){var pointPosition,i,textWidth,halfTextWidth,furthestRightIndex,furthestRightAngle,furthestLeftIndex,furthestLeftAngle,xProtrusionLeft,xProtrusionRight,radiusReductionRight,radiusReductionLeft,largestPossibleRadius=min([this.height/2-this.pointLabelFontSize-5,this.width/2]),furthestRight=this.width,furthestLeft=0;for(this.ctx.font=fontString(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily),i=0;i<this.valuesCount;i++)pointPosition=this.getPointPosition(i,largestPossibleRadius),textWidth=this.ctx.measureText(template(this.templateString,{value:this.labels[i]})).width+5,0===i||i===this.valuesCount/2?(halfTextWidth=textWidth/2,pointPosition.x+halfTextWidth>furthestRight&&(furthestRight=pointPosition.x+halfTextWidth,furthestRightIndex=i),pointPosition.x-halfTextWidth<furthestLeft&&(furthestLeft=pointPosition.x-halfTextWidth,furthestLeftIndex=i)):i<this.valuesCount/2?pointPosition.x+textWidth>furthestRight&&(furthestRight=pointPosition.x+textWidth,furthestRightIndex=i):i>this.valuesCount/2&&pointPosition.x-textWidth<furthestLeft&&(furthestLeft=pointPosition.x-textWidth,furthestLeftIndex=i);xProtrusionLeft=furthestLeft,xProtrusionRight=Math.ceil(furthestRight-this.width),furthestRightAngle=this.getIndexAngle(furthestRightIndex),furthestLeftAngle=this.getIndexAngle(furthestLeftIndex),radiusReductionRight=xProtrusionRight/Math.sin(furthestRightAngle+Math.PI/2),radiusReductionLeft=xProtrusionLeft/Math.sin(furthestLeftAngle+Math.PI/2),radiusReductionRight=isNumber(radiusReductionRight)?radiusReductionRight:0,radiusReductionLeft=isNumber(radiusReductionLeft)?radiusReductionLeft:0,this.drawingArea=largestPossibleRadius-(radiusReductionLeft+radiusReductionRight)/2,this.setCenterPoint(radiusReductionLeft,radiusReductionRight)},setCenterPoint:function(leftMovement,rightMovement){var maxRight=this.width-rightMovement-this.drawingArea,maxLeft=leftMovement+this.drawingArea;this.xCenter=(maxLeft+maxRight)/2,this.yCenter=this.height/2},getIndexAngle:function(index){return index*(2*Math.PI/this.valuesCount)-Math.PI/2},getPointPosition:function(index,distanceFromCenter){var thisAngle=this.getIndexAngle(index);return{x:Math.cos(thisAngle)*distanceFromCenter+this.xCenter,y:Math.sin(thisAngle)*distanceFromCenter+this.yCenter}},draw:function(){if(this.display){var ctx=this.ctx;if(each(this.yLabels,function(label,index){if(index>0){var pointPosition,yCenterOffset=index*(this.drawingArea/this.steps),yHeight=this.yCenter-yCenterOffset;if(this.lineWidth>0)if(ctx.strokeStyle=this.lineColor,ctx.lineWidth=this.lineWidth,this.lineArc)ctx.beginPath(),ctx.arc(this.xCenter,this.yCenter,yCenterOffset,0,2*Math.PI),ctx.closePath(),ctx.stroke();else{ctx.beginPath();for(var i=0;i<this.valuesCount;i++)pointPosition=this.getPointPosition(i,this.calculateCenterOffset(this.min+index*this.stepValue)),0===i?ctx.moveTo(pointPosition.x,pointPosition.y):ctx.lineTo(pointPosition.x,pointPosition.y);ctx.closePath(),ctx.stroke()}if(this.showLabels){if(ctx.font=fontString(this.fontSize,this.fontStyle,this.fontFamily),this.showLabelBackdrop){var labelWidth=ctx.measureText(label).width;ctx.fillStyle=this.backdropColor,ctx.fillRect(this.xCenter-labelWidth/2-this.backdropPaddingX,yHeight-this.fontSize/2-this.backdropPaddingY,labelWidth+2*this.backdropPaddingX,this.fontSize+2*this.backdropPaddingY)}ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle=this.fontColor,ctx.fillText(label,this.xCenter,yHeight)}}},this),!this.lineArc){ctx.lineWidth=this.angleLineWidth,ctx.strokeStyle=this.angleLineColor;for(var i=this.valuesCount-1;i>=0;i--){if(this.angleLineWidth>0){var outerPosition=this.getPointPosition(i,this.calculateCenterOffset(this.max));ctx.beginPath(),ctx.moveTo(this.xCenter,this.yCenter),ctx.lineTo(outerPosition.x,outerPosition.y),ctx.stroke(),ctx.closePath()}var pointLabelPosition=this.getPointPosition(i,this.calculateCenterOffset(this.max)+5);ctx.font=fontString(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily),ctx.fillStyle=this.pointLabelFontColor;var labelsCount=this.labels.length,halfLabelsCount=this.labels.length/2,quarterLabelsCount=halfLabelsCount/2,upperHalf=i<quarterLabelsCount||i>labelsCount-quarterLabelsCount,exactQuarter=i===quarterLabelsCount||i===labelsCount-quarterLabelsCount;ctx.textAlign=0===i?"center":i===halfLabelsCount?"center":i<halfLabelsCount?"left":"right",ctx.textBaseline=exactQuarter?"middle":upperHalf?"bottom":"top",ctx.fillText(this.labels[i],pointLabelPosition.x,pointLabelPosition.y)}}}}}),helpers.addEvent(window,"resize",function(){var timeout;return function(){clearTimeout(timeout),timeout=setTimeout(function(){each(Chart.instances,function(instance){instance.options.responsive&&instance.resize(instance.render,!0)})},50)}}()),amd?define(function(){return Chart}):"object"==typeof module&&module.exports&&(module.exports=Chart),root.Chart=Chart,Chart.noConflict=function(){return root.Chart=previous,Chart}}.call(this),function(){"use strict";var root=this,Chart=root.Chart,helpers=Chart.helpers,defaultConfig={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"Bar",defaults:defaultConfig,initialize:function(data){var options=this.options;this.ScaleClass=Chart.Scale.extend({offsetGridLines:!0,calculateBarX:function(datasetCount,datasetIndex,barIndex){var xWidth=this.calculateBaseWidth(),xAbsolute=this.calculateX(barIndex)-xWidth/2,barWidth=this.calculateBarWidth(datasetCount);return xAbsolute+barWidth*datasetIndex+datasetIndex*options.barDatasetSpacing+barWidth/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*options.barValueSpacing},calculateBarWidth:function(datasetCount){return(this.calculateBaseWidth()-(datasetCount-1)*options.barDatasetSpacing)/datasetCount}}),this.datasets=[],this.options.showTooltips&&helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activeBars="mouseout"!==evt.type?this.getBarsAtEvent(evt):[];this.eachBars(function(bar){bar.restore(["fillColor","strokeColor"])}),helpers.each(activeBars,function(activeBar){activeBar.fillColor=activeBar.highlightFill,activeBar.strokeColor=activeBar.highlightStroke}),this.showTooltip(activeBars)}),this.BarClass=Chart.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx}),helpers.each(data.datasets,function(dataset,datasetIndex){var datasetObject={label:dataset.label||null,fillColor:dataset.fillColor,strokeColor:dataset.strokeColor,bars:[]};this.datasets.push(datasetObject),helpers.each(dataset.data,function(dataPoint,index){datasetObject.bars.push(new this.BarClass({value:dataPoint,label:data.labels[index],datasetLabel:dataset.label,strokeColor:dataset.strokeColor,fillColor:dataset.fillColor,highlightFill:dataset.highlightFill||dataset.fillColor,highlightStroke:dataset.highlightStroke||dataset.strokeColor}))},this)},this),this.buildScale(data.labels),this.BarClass.prototype.base=this.scale.endPoint,this.eachBars(function(bar,index,datasetIndex){helpers.extend(bar,{width:this.scale.calculateBarWidth(this.datasets.length),x:this.scale.calculateBarX(this.datasets.length,datasetIndex,index),y:this.scale.endPoint}),bar.save()},this),this.render()},update:function(){this.scale.update(),helpers.each(this.activeElements,function(activeElement){activeElement.restore(["fillColor","strokeColor"])}),this.eachBars(function(bar){bar.save()}),this.render()},eachBars:function(callback){helpers.each(this.datasets,function(dataset,datasetIndex){helpers.each(dataset.bars,callback,this,datasetIndex)},this)},getBarsAtEvent:function(e){for(var barIndex,barsArray=[],eventPosition=helpers.getRelativePosition(e),datasetIterator=function(dataset){barsArray.push(dataset.bars[barIndex])},datasetIndex=0;datasetIndex<this.datasets.length;datasetIndex++)for(barIndex=0;barIndex<this.datasets[datasetIndex].bars.length;barIndex++)if(this.datasets[datasetIndex].bars[barIndex].inRange(eventPosition.x,eventPosition.y))return helpers.each(this.datasets,datasetIterator),barsArray;return barsArray},buildScale:function(labels){var self=this,dataTotal=function(){var values=[];return self.eachBars(function(bar){values.push(bar.value)}),values},scaleOptions={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:labels.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(currentHeight){var updatedRanges=helpers.calculateScaleRange(dataTotal(),currentHeight,this.fontSize,this.beginAtZero,this.integersOnly);helpers.extend(this,updatedRanges)},xLabels:labels,font:helpers.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&helpers.extend(scaleOptions,{calculateYRange:helpers.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new this.ScaleClass(scaleOptions)},addData:function(valuesArray,label){helpers.each(valuesArray,function(value,datasetIndex){this.datasets[datasetIndex].bars.push(new this.BarClass({value:value,label:label,x:this.scale.calculateBarX(this.datasets.length,datasetIndex,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[datasetIndex].strokeColor,fillColor:this.datasets[datasetIndex].fillColor}))},this),this.scale.addXLabel(label),this.update()},removeData:function(){this.scale.removeXLabel(),helpers.each(this.datasets,function(dataset){dataset.bars.shift()},this),this.update()},reflow:function(){helpers.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var newScaleProps=helpers.extend({height:this.chart.height,width:this.chart.width});this.scale.update(newScaleProps)},draw:function(ease){var easingDecimal=ease||1;this.clear();this.chart.ctx;this.scale.draw(easingDecimal),helpers.each(this.datasets,function(dataset,datasetIndex){helpers.each(dataset.bars,function(bar,index){bar.hasValue()&&(bar.base=this.scale.endPoint,bar.transition({x:this.scale.calculateBarX(this.datasets.length,datasetIndex,index),y:this.scale.calculateY(bar.value),width:this.scale.calculateBarWidth(this.datasets.length)},easingDecimal).draw())},this)},this)}})}.call(this),function(){"use strict";var root=this,Chart=root.Chart,helpers=Chart.helpers,defaultConfig={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"Doughnut",defaults:defaultConfig,initialize:function(data){this.segments=[],this.outerRadius=(helpers.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,this.SegmentArc=Chart.Arc.extend({ctx:this.chart.ctx,x:this.chart.width/2,y:this.chart.height/2}),this.options.showTooltips&&helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activeSegments="mouseout"!==evt.type?this.getSegmentsAtEvent(evt):[];helpers.each(this.segments,function(segment){segment.restore(["fillColor"])}),helpers.each(activeSegments,function(activeSegment){activeSegment.fillColor=activeSegment.highlightColor}),this.showTooltip(activeSegments)}),this.calculateTotal(data),helpers.each(data,function(datapoint,index){this.addData(datapoint,index,!0)},this),this.render()},getSegmentsAtEvent:function(e){var segmentsArray=[],location=helpers.getRelativePosition(e);return helpers.each(this.segments,function(segment){segment.inRange(location.x,location.y)&&segmentsArray.push(segment)},this),segmentsArray},addData:function(segment,atIndex,silent){var index=atIndex||this.segments.length;this.segments.splice(index,0,new this.SegmentArc({value:segment.value,outerRadius:this.options.animateScale?0:this.outerRadius,innerRadius:this.options.animateScale?0:this.outerRadius/100*this.options.percentageInnerCutout,fillColor:segment.color,highlightColor:segment.highlight||segment.color,showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,startAngle:1.5*Math.PI,circumference:this.options.animateRotate?0:this.calculateCircumference(segment.value),label:segment.label})),silent||(this.reflow(),this.update())},calculateCircumference:function(value){return 2*Math.PI*(Math.abs(value)/this.total)},calculateTotal:function(data){this.total=0,helpers.each(data,function(segment){this.total+=Math.abs(segment.value)},this)},update:function(){this.calculateTotal(this.segments),helpers.each(this.activeElements,function(activeElement){activeElement.restore(["fillColor"])}),helpers.each(this.segments,function(segment){segment.save()}),this.render()},removeData:function(atIndex){var indexToDelete=helpers.isNumber(atIndex)?atIndex:this.segments.length-1;this.segments.splice(indexToDelete,1),this.reflow(),this.update()},reflow:function(){helpers.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2}),this.outerRadius=(helpers.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,helpers.each(this.segments,function(segment){segment.update({outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout})},this)},draw:function(easeDecimal){var animDecimal=easeDecimal||1;this.clear(),helpers.each(this.segments,function(segment,index){segment.transition({circumference:this.calculateCircumference(segment.value),outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout},animDecimal),segment.endAngle=segment.startAngle+segment.circumference,segment.draw(),0===index&&(segment.startAngle=1.5*Math.PI),index<this.segments.length-1&&(this.segments[index+1].startAngle=segment.endAngle)},this)}}),Chart.types.Doughnut.extend({name:"Pie",defaults:helpers.merge(defaultConfig,{percentageInnerCutout:0})})}.call(this),function(){"use strict";var root=this,Chart=root.Chart,helpers=Chart.helpers,defaultConfig={scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"Line",defaults:defaultConfig,initialize:function(data){this.PointClass=Chart.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(mouseX){return Math.pow(mouseX-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}}),this.datasets=[],this.options.showTooltips&&helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activePoints="mouseout"!==evt.type?this.getPointsAtEvent(evt):[];this.eachPoints(function(point){point.restore(["fillColor","strokeColor"])}),helpers.each(activePoints,function(activePoint){activePoint.fillColor=activePoint.highlightFill,activePoint.strokeColor=activePoint.highlightStroke}),this.showTooltip(activePoints)}),helpers.each(data.datasets,function(dataset){var datasetObject={label:dataset.label||null,fillColor:dataset.fillColor,strokeColor:dataset.strokeColor,pointColor:dataset.pointColor,pointStrokeColor:dataset.pointStrokeColor,points:[]};this.datasets.push(datasetObject),helpers.each(dataset.data,function(dataPoint,index){datasetObject.points.push(new this.PointClass({value:dataPoint,label:data.labels[index],datasetLabel:dataset.label,strokeColor:dataset.pointStrokeColor,fillColor:dataset.pointColor,highlightFill:dataset.pointHighlightFill||dataset.pointColor,highlightStroke:dataset.pointHighlightStroke||dataset.pointStrokeColor}))},this),this.buildScale(data.labels),this.eachPoints(function(point,index){helpers.extend(point,{x:this.scale.calculateX(index),y:this.scale.endPoint}),point.save()},this)},this),this.render()},update:function(){this.scale.update(),helpers.each(this.activeElements,function(activeElement){activeElement.restore(["fillColor","strokeColor"])}),this.eachPoints(function(point){point.save()}),this.render()},eachPoints:function(callback){helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,callback,this)},this)},getPointsAtEvent:function(e){var pointsArray=[],eventPosition=helpers.getRelativePosition(e);return helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,function(point){point.inRange(eventPosition.x,eventPosition.y)&&pointsArray.push(point)})},this),pointsArray},buildScale:function(labels){var self=this,dataTotal=function(){var values=[];return self.eachPoints(function(point){values.push(point.value)}),values},scaleOptions={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:labels.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(currentHeight){var updatedRanges=helpers.calculateScaleRange(dataTotal(),currentHeight,this.fontSize,this.beginAtZero,this.integersOnly);helpers.extend(this,updatedRanges)},xLabels:labels,font:helpers.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&helpers.extend(scaleOptions,{calculateYRange:helpers.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new Chart.Scale(scaleOptions)},addData:function(valuesArray,label){helpers.each(valuesArray,function(value,datasetIndex){this.datasets[datasetIndex].points.push(new this.PointClass({value:value,label:label,x:this.scale.calculateX(this.scale.valuesCount+1),y:this.scale.endPoint,strokeColor:this.datasets[datasetIndex].pointStrokeColor,fillColor:this.datasets[datasetIndex].pointColor}))},this),this.scale.addXLabel(label),this.update()},removeData:function(){this.scale.removeXLabel(),helpers.each(this.datasets,function(dataset){dataset.points.shift()},this),this.update()},reflow:function(){var newScaleProps=helpers.extend({height:this.chart.height,width:this.chart.width});this.scale.update(newScaleProps)},draw:function(ease){var easingDecimal=ease||1;this.clear();var ctx=this.chart.ctx,hasValue=function(item){return null!==item.value},nextPoint=function(point,collection,index){return helpers.findNextWhere(collection,hasValue,index)||point},previousPoint=function(point,collection,index){return helpers.findPreviousWhere(collection,hasValue,index)||point};this.scale.draw(easingDecimal),helpers.each(this.datasets,function(dataset){var pointsWithValues=helpers.where(dataset.points,hasValue);helpers.each(dataset.points,function(point,index){point.hasValue()&&point.transition({y:this.scale.calculateY(point.value),x:this.scale.calculateX(index)},easingDecimal)},this),this.options.bezierCurve&&helpers.each(pointsWithValues,function(point,index){var tension=index>0&&index<pointsWithValues.length-1?this.options.bezierCurveTension:0;point.controlPoints=helpers.splineCurve(previousPoint(point,pointsWithValues,index),point,nextPoint(point,pointsWithValues,index),tension),point.controlPoints.outer.y>this.scale.endPoint?point.controlPoints.outer.y=this.scale.endPoint:point.controlPoints.outer.y<this.scale.startPoint&&(point.controlPoints.outer.y=this.scale.startPoint),point.controlPoints.inner.y>this.scale.endPoint?point.controlPoints.inner.y=this.scale.endPoint:point.controlPoints.inner.y<this.scale.startPoint&&(point.controlPoints.inner.y=this.scale.startPoint)},this),ctx.lineWidth=this.options.datasetStrokeWidth,ctx.strokeStyle=dataset.strokeColor,ctx.beginPath(),helpers.each(pointsWithValues,function(point,index){if(0===index)ctx.moveTo(point.x,point.y);else if(this.options.bezierCurve){var previous=previousPoint(point,pointsWithValues,index);ctx.bezierCurveTo(previous.controlPoints.outer.x,previous.controlPoints.outer.y,point.controlPoints.inner.x,point.controlPoints.inner.y,point.x,point.y)}else ctx.lineTo(point.x,point.y)},this),ctx.stroke(),this.options.datasetFill&&pointsWithValues.length>0&&(ctx.lineTo(pointsWithValues[pointsWithValues.length-1].x,this.scale.endPoint),ctx.lineTo(pointsWithValues[0].x,this.scale.endPoint),ctx.fillStyle=dataset.fillColor,ctx.closePath(),ctx.fill()),helpers.each(pointsWithValues,function(point){point.draw()})},this)}})}.call(this),function(){"use strict";var root=this,Chart=root.Chart,helpers=Chart.helpers,defaultConfig={scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBeginAtZero:!0,scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,scaleShowLine:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"PolarArea",defaults:defaultConfig,initialize:function(data){this.segments=[],this.SegmentArc=Chart.Arc.extend({showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,ctx:this.chart.ctx,innerRadius:0,x:this.chart.width/2,y:this.chart.height/2}),this.scale=new Chart.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,lineArc:!0,width:this.chart.width,height:this.chart.height,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,valuesCount:data.length}),this.updateScaleRange(data),this.scale.update(),helpers.each(data,function(segment,index){this.addData(segment,index,!0)},this),this.options.showTooltips&&helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activeSegments="mouseout"!==evt.type?this.getSegmentsAtEvent(evt):[];helpers.each(this.segments,function(segment){segment.restore(["fillColor"])}),helpers.each(activeSegments,function(activeSegment){activeSegment.fillColor=activeSegment.highlightColor}),this.showTooltip(activeSegments)}),this.render()},getSegmentsAtEvent:function(e){var segmentsArray=[],location=helpers.getRelativePosition(e);return helpers.each(this.segments,function(segment){segment.inRange(location.x,location.y)&&segmentsArray.push(segment)},this),segmentsArray},addData:function(segment,atIndex,silent){var index=atIndex||this.segments.length;this.segments.splice(index,0,new this.SegmentArc({fillColor:segment.color,highlightColor:segment.highlight||segment.color,label:segment.label,value:segment.value,outerRadius:this.options.animateScale?0:this.scale.calculateCenterOffset(segment.value),circumference:this.options.animateRotate?0:this.scale.getCircumference(),startAngle:1.5*Math.PI})),silent||(this.reflow(),this.update())},removeData:function(atIndex){var indexToDelete=helpers.isNumber(atIndex)?atIndex:this.segments.length-1;this.segments.splice(indexToDelete,1),this.reflow(),this.update()},calculateTotal:function(data){this.total=0,helpers.each(data,function(segment){this.total+=segment.value},this),this.scale.valuesCount=this.segments.length},updateScaleRange:function(datapoints){var valuesArray=[];helpers.each(datapoints,function(segment){valuesArray.push(segment.value)});var scaleSizes=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:helpers.calculateScaleRange(valuesArray,helpers.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);helpers.extend(this.scale,scaleSizes,{size:helpers.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2})},update:function(){this.calculateTotal(this.segments),helpers.each(this.segments,function(segment){segment.save()}),this.reflow(),this.render()},reflow:function(){helpers.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2}),this.updateScaleRange(this.segments),this.scale.update(),helpers.extend(this.scale,{xCenter:this.chart.width/2,yCenter:this.chart.height/2}),helpers.each(this.segments,function(segment){segment.update({outerRadius:this.scale.calculateCenterOffset(segment.value)})},this)},draw:function(ease){var easingDecimal=ease||1;this.clear(),helpers.each(this.segments,function(segment,index){segment.transition({circumference:this.scale.getCircumference(),outerRadius:this.scale.calculateCenterOffset(segment.value)},easingDecimal),segment.endAngle=segment.startAngle+segment.circumference,0===index&&(segment.startAngle=1.5*Math.PI),index<this.segments.length-1&&(this.segments[index+1].startAngle=segment.endAngle),segment.draw()},this),this.scale.draw()}})}.call(this),function(){"use strict";var root=this,Chart=root.Chart,helpers=Chart.helpers;Chart.Type.extend({name:"Radar",defaults:{scaleShowLine:!0,angleShowLineOut:!0,scaleShowLabels:!1,scaleBeginAtZero:!0,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:10,pointLabelFontColor:"#666",pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},initialize:function(data){this.PointClass=Chart.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx}),this.datasets=[],this.buildScale(data),this.options.showTooltips&&helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activePointsCollection="mouseout"!==evt.type?this.getPointsAtEvent(evt):[];this.eachPoints(function(point){point.restore(["fillColor","strokeColor"])}),helpers.each(activePointsCollection,function(activePoint){activePoint.fillColor=activePoint.highlightFill,activePoint.strokeColor=activePoint.highlightStroke}),this.showTooltip(activePointsCollection)}),helpers.each(data.datasets,function(dataset){var datasetObject={label:dataset.label||null,fillColor:dataset.fillColor,strokeColor:dataset.strokeColor,pointColor:dataset.pointColor,pointStrokeColor:dataset.pointStrokeColor,points:[]};this.datasets.push(datasetObject),helpers.each(dataset.data,function(dataPoint,index){var pointPosition;this.scale.animation||(pointPosition=this.scale.getPointPosition(index,this.scale.calculateCenterOffset(dataPoint))),datasetObject.points.push(new this.PointClass({value:dataPoint,label:data.labels[index],datasetLabel:dataset.label,x:this.options.animation?this.scale.xCenter:pointPosition.x,y:this.options.animation?this.scale.yCenter:pointPosition.y,strokeColor:dataset.pointStrokeColor,fillColor:dataset.pointColor,highlightFill:dataset.pointHighlightFill||dataset.pointColor,highlightStroke:dataset.pointHighlightStroke||dataset.pointStrokeColor}))},this)},this),this.render()},eachPoints:function(callback){helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,callback,this)},this)},getPointsAtEvent:function(evt){var mousePosition=helpers.getRelativePosition(evt),fromCenter=helpers.getAngleFromPoint({x:this.scale.xCenter,y:this.scale.yCenter},mousePosition),anglePerIndex=2*Math.PI/this.scale.valuesCount,pointIndex=Math.round((fromCenter.angle-1.5*Math.PI)/anglePerIndex),activePointsCollection=[];return(pointIndex>=this.scale.valuesCount||pointIndex<0)&&(pointIndex=0),fromCenter.distance<=this.scale.drawingArea&&helpers.each(this.datasets,function(dataset){activePointsCollection.push(dataset.points[pointIndex])}),activePointsCollection},buildScale:function(data){this.scale=new Chart.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,angleLineColor:this.options.angleLineColor,angleLineWidth:this.options.angleShowLineOut?this.options.angleLineWidth:0,pointLabelFontColor:this.options.pointLabelFontColor,pointLabelFontSize:this.options.pointLabelFontSize,pointLabelFontFamily:this.options.pointLabelFontFamily,pointLabelFontStyle:this.options.pointLabelFontStyle,height:this.chart.height,width:this.chart.width,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,labels:data.labels,valuesCount:data.datasets[0].data.length}),this.scale.setScaleSize(),this.updateScaleRange(data.datasets),this.scale.buildYLabels()},updateScaleRange:function(datasets){var valuesArray=function(){var totalDataArray=[];return helpers.each(datasets,function(dataset){dataset.data?totalDataArray=totalDataArray.concat(dataset.data):helpers.each(dataset.points,function(point){totalDataArray.push(point.value)})}),totalDataArray}(),scaleSizes=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:helpers.calculateScaleRange(valuesArray,helpers.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);helpers.extend(this.scale,scaleSizes)},addData:function(valuesArray,label){this.scale.valuesCount++,helpers.each(valuesArray,function(value,datasetIndex){var pointPosition=this.scale.getPointPosition(this.scale.valuesCount,this.scale.calculateCenterOffset(value));this.datasets[datasetIndex].points.push(new this.PointClass({value:value,label:label,x:pointPosition.x,y:pointPosition.y,strokeColor:this.datasets[datasetIndex].pointStrokeColor,fillColor:this.datasets[datasetIndex].pointColor}))},this),this.scale.labels.push(label),this.reflow(),this.update()},removeData:function(){this.scale.valuesCount--,this.scale.labels.shift(),helpers.each(this.datasets,function(dataset){dataset.points.shift()},this),this.reflow(),this.update()},update:function(){this.eachPoints(function(point){point.save()}),this.reflow(),this.render()},reflow:function(){helpers.extend(this.scale,{width:this.chart.width,height:this.chart.height,size:helpers.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2}),this.updateScaleRange(this.datasets),this.scale.setScaleSize(),this.scale.buildYLabels()},draw:function(ease){var easeDecimal=ease||1,ctx=this.chart.ctx;this.clear(),this.scale.draw(),helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,function(point,index){point.hasValue()&&point.transition(this.scale.getPointPosition(index,this.scale.calculateCenterOffset(point.value)),easeDecimal)},this),ctx.lineWidth=this.options.datasetStrokeWidth,ctx.strokeStyle=dataset.strokeColor,ctx.beginPath(),helpers.each(dataset.points,function(point,index){0===index?ctx.moveTo(point.x,point.y):ctx.lineTo(point.x,point.y)},this),ctx.closePath(),ctx.stroke(),ctx.fillStyle=dataset.fillColor,ctx.fill(),helpers.each(dataset.points,function(point){point.hasValue()&&point.draw()})},this)}})}.call(this);var CryptoJS=CryptoJS||function(u,p){var d={},l=d.lib={},s=function(){},t=l.Base={extend:function(a){s.prototype=this;var c=new s;return a&&c.mixIn(a),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},r=l.WordArray=t.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=void 0!=c?c:4*a.length},toString:function(a){return(a||v).stringify(this)},concat:function(a){var c=this.words,e=a.words,j=this.sigBytes;if(a=a.sigBytes,this.clamp(),j%4)for(var k=0;k<a;k++)c[j+k>>>2]|=(e[k>>>2]>>>24-k%4*8&255)<<24-(j+k)%4*8;else if(65535<e.length)for(k=0;k<a;k+=4)c[j+k>>>2]=e[k>>>2];else c.push.apply(c,e);return this.sigBytes+=a,this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8,a.length=u.ceil(c/4)},clone:function(){var a=t.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var c=[],e=0;e<a;e+=4)c.push(4294967296*u.random()|0);return new r.init(c,a)}}),w=d.enc={},v=w.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++){var k=c[j>>>2]>>>24-j%4*8&255;e.push((k>>>4).toString(16)),e.push((15&k).toString(16))}return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j+=2)e[j>>>3]|=parseInt(a.substr(j,2),16)<<24-j%8*4;return new r.init(e,c/2)}},b=w.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++)e.push(String.fromCharCode(c[j>>>2]>>>24-j%4*8&255));return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j++)e[j>>>2]|=(255&a.charCodeAt(j))<<24-j%4*8;return new r.init(e,c)}},x=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(b.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data")}},parse:function(a){return b.parse(unescape(encodeURIComponent(a)))}},q=l.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,e=c.words,j=c.sigBytes,k=this.blockSize,b=j/(4*k),b=a?u.ceil(b):u.max((0|b)-this._minBufferSize,0);if(a=b*k,j=u.min(4*a,j),a){for(var q=0;q<a;q+=k)this._doProcessBlock(e,q);q=e.splice(0,a),c.sigBytes-=j}return new r.init(q,j)},clone:function(){var a=t.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});l.Hasher=q.extend({cfg:t.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){q.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,e){return new a.init(e).finalize(b)}},_createHmacHelper:function(a){return function(b,e){return new n.HMAC.init(a,e).finalize(b)}}});var n=d.algo={};return d}(Math);!function(){var u=CryptoJS,p=u.lib.WordArray;u.enc.Base64={stringify:function(d){var l=d.words,p=d.sigBytes,t=this._map;d.clamp(),d=[];for(var r=0;r<p;r+=3)for(var w=(l[r>>>2]>>>24-r%4*8&255)<<16|(l[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|l[r+2>>>2]>>>24-(r+2)%4*8&255,v=0;4>v&&r+.75*v<p;v++)d.push(t.charAt(w>>>6*(3-v)&63));if(l=t.charAt(64))for(;d.length%4;)d.push(l);return d.join("")},parse:function(d){var l=d.length,s=this._map,t=s.charAt(64);t&&-1!=(t=d.indexOf(t))&&(l=t);for(var t=[],r=0,w=0;w<l;w++)if(w%4){var v=s.indexOf(d.charAt(w-1))<<w%4*2,b=s.indexOf(d.charAt(w))>>>6-w%4*2;t[r>>>2]|=(v|b)<<24-r%4*8,r++}return p.create(t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(u){function p(b,n,a,c,e,j,k){return((b=b+(n&a|~n&c)+e+k)<<j|b>>>32-j)+n}function d(b,n,a,c,e,j,k){return((b=b+(n&c|a&~c)+e+k)<<j|b>>>32-j)+n}function l(b,n,a,c,e,j,k){return((b=b+(n^a^c)+e+k)<<j|b>>>32-j)+n}function s(b,n,a,c,e,j,k){return((b=b+(a^(n|~c))+e+k)<<j|b>>>32-j)+n}for(var t=CryptoJS,r=t.lib,w=r.WordArray,v=r.Hasher,r=t.algo,b=[],x=0;64>x;x++)b[x]=4294967296*u.abs(u.sin(x+1))|0;r=r.MD5=v.extend({_doReset:function(){this._hash=new w.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(q,n){for(var a=0;16>a;a++){var c=n+a,e=q[c];q[c]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8)}var a=this._hash.words,c=q[n+0],e=q[n+1],j=q[n+2],k=q[n+3],z=q[n+4],r=q[n+5],t=q[n+6],w=q[n+7],v=q[n+8],A=q[n+9],B=q[n+10],C=q[n+11],u=q[n+12],D=q[n+13],E=q[n+14],x=q[n+15],f=a[0],m=a[1],g=a[2],h=a[3],f=p(f,m,g,h,c,7,b[0]),h=p(h,f,m,g,e,12,b[1]),g=p(g,h,f,m,j,17,b[2]),m=p(m,g,h,f,k,22,b[3]),f=p(f,m,g,h,z,7,b[4]),h=p(h,f,m,g,r,12,b[5]),g=p(g,h,f,m,t,17,b[6]),m=p(m,g,h,f,w,22,b[7]),f=p(f,m,g,h,v,7,b[8]),h=p(h,f,m,g,A,12,b[9]),g=p(g,h,f,m,B,17,b[10]),m=p(m,g,h,f,C,22,b[11]),f=p(f,m,g,h,u,7,b[12]),h=p(h,f,m,g,D,12,b[13]),g=p(g,h,f,m,E,17,b[14]),m=p(m,g,h,f,x,22,b[15]),f=d(f,m,g,h,e,5,b[16]),h=d(h,f,m,g,t,9,b[17]),g=d(g,h,f,m,C,14,b[18]),m=d(m,g,h,f,c,20,b[19]),f=d(f,m,g,h,r,5,b[20]),h=d(h,f,m,g,B,9,b[21]),g=d(g,h,f,m,x,14,b[22]),m=d(m,g,h,f,z,20,b[23]),f=d(f,m,g,h,A,5,b[24]),h=d(h,f,m,g,E,9,b[25]),g=d(g,h,f,m,k,14,b[26]),m=d(m,g,h,f,v,20,b[27]),f=d(f,m,g,h,D,5,b[28]),h=d(h,f,m,g,j,9,b[29]),g=d(g,h,f,m,w,14,b[30]),m=d(m,g,h,f,u,20,b[31]),f=l(f,m,g,h,r,4,b[32]),h=l(h,f,m,g,v,11,b[33]),g=l(g,h,f,m,C,16,b[34]),m=l(m,g,h,f,E,23,b[35]),f=l(f,m,g,h,e,4,b[36]),h=l(h,f,m,g,z,11,b[37]),g=l(g,h,f,m,w,16,b[38]),m=l(m,g,h,f,B,23,b[39]),f=l(f,m,g,h,D,4,b[40]),h=l(h,f,m,g,c,11,b[41]),g=l(g,h,f,m,k,16,b[42]),m=l(m,g,h,f,t,23,b[43]),f=l(f,m,g,h,A,4,b[44]),h=l(h,f,m,g,u,11,b[45]),g=l(g,h,f,m,x,16,b[46]),m=l(m,g,h,f,j,23,b[47]),f=s(f,m,g,h,c,6,b[48]),h=s(h,f,m,g,w,10,b[49]),g=s(g,h,f,m,E,15,b[50]),m=s(m,g,h,f,r,21,b[51]),f=s(f,m,g,h,u,6,b[52]),h=s(h,f,m,g,k,10,b[53]),g=s(g,h,f,m,B,15,b[54]),m=s(m,g,h,f,e,21,b[55]),f=s(f,m,g,h,v,6,b[56]),h=s(h,f,m,g,x,10,b[57]),g=s(g,h,f,m,t,15,b[58]),m=s(m,g,h,f,D,21,b[59]),f=s(f,m,g,h,z,6,b[60]),h=s(h,f,m,g,C,10,b[61]),g=s(g,h,f,m,j,15,b[62]),m=s(m,g,h,f,A,21,b[63]);a[0]=a[0]+f|0,a[1]=a[1]+m|0,a[2]=a[2]+g|0,a[3]=a[3]+h|0},_doFinalize:function(){var b=this._data,n=b.words,a=8*this._nDataBytes,c=8*b.sigBytes;n[c>>>5]|=128<<24-c%32;var e=u.floor(a/4294967296);for(n[15+(c+64>>>9<<4)]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8),n[14+(c+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),b.sigBytes=4*(n.length+1),this._process(),b=this._hash,n=b.words,a=0;4>a;a++)c=n[a],n[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8);return b},clone:function(){var b=v.clone.call(this);return b._hash=this._hash.clone(),b}}),t.MD5=v._createHelper(r),t.HmacMD5=v._createHmacHelper(r)}(Math),function(){var u=CryptoJS,p=u.lib,d=p.Base,l=p.WordArray,p=u.algo,s=p.EvpKDF=d.extend({cfg:d.extend({keySize:4,hasher:p.MD5,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,r){for(var p=this.cfg,s=p.hasher.create(),b=l.create(),u=b.words,q=p.keySize,p=p.iterations;u.length<q;){n&&s.update(n);var n=s.update(d).finalize(r);s.reset();for(var a=1;a<p;a++)n=s.finalize(n),s.reset();b.concat(n)}return b.sigBytes=4*q,b}});u.EvpKDF=function(d,l,p){return s.create(p).compute(d,l)}}(),CryptoJS.lib.Cipher||function(u){var p=CryptoJS,d=p.lib,l=d.Base,s=d.WordArray,t=d.BufferedBlockAlgorithm,r=p.enc.Base64,w=p.algo.EvpKDF,v=d.Cipher=t.extend({cfg:l.extend(),createEncryptor:function(e,a){return this.create(this._ENC_XFORM_MODE,e,a)},createDecryptor:function(e,a){return this.create(this._DEC_XFORM_MODE,e,a)},init:function(e,a,b){this.cfg=this.cfg.extend(b),this._xformMode=e,this._key=a,this.reset()},reset:function(){t.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(b,k,d){return("string"==typeof k?c:a).encrypt(e,b,k,d)},decrypt:function(b,k,d){return("string"==typeof k?c:a).decrypt(e,b,k,d)}}}});d.StreamCipher=v.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var b=p.mode={},x=function(e,a,b){var c=this._iv;c?this._iv=void 0:c=this._prevBlock;for(var d=0;d<b;d++)e[a+d]^=c[d]},q=(d.BlockCipherMode=l.extend({createEncryptor:function(e,a){return this.Encryptor.create(e,a)},createDecryptor:function(e,a){return this.Decryptor.create(e,a)},init:function(e,a){this._cipher=e,this._iv=a}})).extend();q.Encryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize;x.call(this,e,a,c),b.encryptBlock(e,a),this._prevBlock=e.slice(a,a+c)}}),q.Decryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize,d=e.slice(a,a+c);b.decryptBlock(e,a),x.call(this,e,a,c),this._prevBlock=d}}),b=b.CBC=q,q=(p.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,l=[],n=0;n<c;n+=4)l.push(d);c=s.create(l,c),a.concat(c)},unpad:function(a){a.sigBytes-=255&a.words[a.sigBytes-1>>>2]}},d.BlockCipher=v.extend({cfg:v.cfg.extend({mode:b,padding:q}),reset:function(){v.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var n=d.CipherParams=l.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),b=(p.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;return a=a.salt,(a?s.create([1398893684,1701076831]).concat(a).concat(b):b).toString(r)},parse:function(a){a=r.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=s.create(b.slice(2,4));b.splice(0,4),a.sigBytes-=16}return n.create({ciphertext:a,salt:c})}},a=d.SerializableCipher=l.extend({cfg:l.extend({format:b}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var l=a.createEncryptor(c,d);return b=l.finalize(b),l=l.cfg,n.create({ciphertext:b,key:c,iv:l.iv,algorithm:a,mode:l.mode,padding:l.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){return d=this.cfg.extend(d),b=this._parse(b,d.format),a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),p=(p.kdf={}).OpenSSL={execute:function(a,b,c,d){return d||(d=s.random(8)),a=w.create({keySize:b+c}).compute(a,d),c=s.create(a.words.slice(b),4*c),a.sigBytes=4*b,n.create({key:a,iv:c,salt:d})}},c=d.PasswordBasedCipher=a.extend({cfg:a.cfg.extend({kdf:p}),encrypt:function(b,c,d,l){return l=this.cfg.extend(l),d=l.kdf.execute(d,b.keySize,b.ivSize),l.iv=d.iv,b=a.encrypt.call(this,b,c,d.key,l),b.mixIn(d),b},decrypt:function(b,c,d,l){return l=this.cfg.extend(l),c=this._parse(c,l.format),d=l.kdf.execute(d,b.keySize,b.ivSize,c.salt),l.iv=d.iv,a.decrypt.call(this,b,c,d.key,l)}})}(),function(){for(var u=CryptoJS,p=u.lib.BlockCipher,d=u.algo,l=[],s=[],t=[],r=[],w=[],v=[],b=[],x=[],q=[],n=[],a=[],c=0;256>c;c++)a[c]=128>c?c<<1:c<<1^283;for(var e=0,j=0,c=0;256>c;c++){var k=j^j<<1^j<<2^j<<3^j<<4,k=k>>>8^255&k^99;l[e]=k,s[k]=e;var z=a[e],F=a[z],G=a[F],y=257*a[k]^16843008*k;t[e]=y<<24|y>>>8,r[e]=y<<16|y>>>16,w[e]=y<<8|y>>>24,v[e]=y,y=16843009*G^65537*F^257*z^16843008*e,b[k]=y<<24|y>>>8,x[k]=y<<16|y>>>16,q[k]=y<<8|y>>>24,n[k]=y,e?(e=z^a[a[a[G^z]]],j^=a[a[j]]):e=j=1}var H=[0,1,2,4,8,16,32,64,128,27,54],d=d.AES=p.extend({_doReset:function(){for(var a=this._key,c=a.words,d=a.sigBytes/4,a=4*((this._nRounds=d+6)+1),e=this._keySchedule=[],j=0;j<a;j++)if(j<d)e[j]=c[j];else{var k=e[j-1];j%d?6<d&&4==j%d&&(k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[255&k]):(k=k<<8|k>>>24,k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[255&k],k^=H[j/d|0]<<24),e[j]=e[j-d]^k}for(c=this._invKeySchedule=[],d=0;d<a;d++)j=a-d,k=d%4?e[j]:e[j-4],c[d]=4>d||4>=j?k:b[l[k>>>24]]^x[l[k>>>16&255]]^q[l[k>>>8&255]]^n[l[255&k]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,t,r,w,v,l)},decryptBlock:function(a,c){var d=a[c+1];a[c+1]=a[c+3],a[c+3]=d,this._doCryptBlock(a,c,this._invKeySchedule,b,x,q,n,s),d=a[c+1],a[c+1]=a[c+3],a[c+3]=d},_doCryptBlock:function(a,b,c,d,e,j,l,f){for(var m=this._nRounds,g=a[b]^c[0],h=a[b+1]^c[1],k=a[b+2]^c[2],n=a[b+3]^c[3],p=4,r=1;r<m;r++)var q=d[g>>>24]^e[h>>>16&255]^j[k>>>8&255]^l[255&n]^c[p++],s=d[h>>>24]^e[k>>>16&255]^j[n>>>8&255]^l[255&g]^c[p++],t=d[k>>>24]^e[n>>>16&255]^j[g>>>8&255]^l[255&h]^c[p++],n=d[n>>>24]^e[g>>>16&255]^j[h>>>8&255]^l[255&k]^c[p++],g=q,h=s,k=t;q=(f[g>>>24]<<24|f[h>>>16&255]<<16|f[k>>>8&255]<<8|f[255&n])^c[p++],s=(f[h>>>24]<<24|f[k>>>16&255]<<16|f[n>>>8&255]<<8|f[255&g])^c[p++],t=(f[k>>>24]<<24|f[n>>>16&255]<<16|f[g>>>8&255]<<8|f[255&h])^c[p++],n=(f[n>>>24]<<24|f[g>>>16&255]<<16|f[h>>>8&255]<<8|f[255&k])^c[p++],a[b]=q,a[b+1]=s,a[b+2]=t,a[b+3]=n},keySize:8});u.AES=p._createHelper(d)}(),function(window){"use strict";function minErr(module,ErrorConstructor){return ErrorConstructor=ErrorConstructor||Error,function(){var paramPrefix,i,templateArgs=arguments,code=templateArgs[0],message="["+(module?module+":":"")+code+"] ",template=templateArgs[1];for(message+=template.replace(/\{\d+\}/g,function(match){var index=+match.slice(1,-1),shiftedIndex=index+2;return shiftedIndex<templateArgs.length?toDebugString(templateArgs[shiftedIndex]):match}),message+="\nhttp://errors.angularjs.org/1.5.5/"+(module?module+"/":"")+code,i=2,paramPrefix="?";i<templateArgs.length;i++,paramPrefix="&")message+=paramPrefix+"p"+(i-2)+"="+encodeURIComponent(toDebugString(templateArgs[i]));return new ErrorConstructor(message)}}function isArrayLike(obj){if(null==obj||isWindow(obj))return!1;if(isArray(obj)||isString(obj)||jqLite&&obj instanceof jqLite)return!0;var length="length"in Object(obj)&&obj.length;return isNumber(length)&&(length>=0&&(length-1 in obj||obj instanceof Array)||"function"==typeof obj.item)}function forEach(obj,iterator,context){var key,length;if(obj)if(isFunction(obj))for(key in obj)"prototype"==key||"length"==key||"name"==key||obj.hasOwnProperty&&!obj.hasOwnProperty(key)||iterator.call(context,obj[key],key,obj);else if(isArray(obj)||isArrayLike(obj)){var isPrimitive="object"!=typeof obj;for(key=0,length=obj.length;key<length;key++)(isPrimitive||key in obj)&&iterator.call(context,obj[key],key,obj)}else if(obj.forEach&&obj.forEach!==forEach)obj.forEach(iterator,context,obj);else if(isBlankObject(obj))for(key in obj)iterator.call(context,obj[key],key,obj);else if("function"==typeof obj.hasOwnProperty)for(key in obj)obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj);else for(key in obj)hasOwnProperty.call(obj,key)&&iterator.call(context,obj[key],key,obj);return obj}function forEachSorted(obj,iterator,context){for(var keys=Object.keys(obj).sort(),i=0;i<keys.length;i++)iterator.call(context,obj[keys[i]],keys[i]);return keys}function reverseParams(iteratorFn){return function(value,key){iteratorFn(key,value)}}function nextUid(){return++uid}function setHashKey(obj,h){h?obj.$$hashKey=h:delete obj.$$hashKey}function baseExtend(dst,objs,deep){for(var h=dst.$$hashKey,i=0,ii=objs.length;i<ii;++i){var obj=objs[i];if(isObject(obj)||isFunction(obj))for(var keys=Object.keys(obj),j=0,jj=keys.length;j<jj;j++){var key=keys[j],src=obj[key];deep&&isObject(src)?isDate(src)?dst[key]=new Date(src.valueOf()):isRegExp(src)?dst[key]=new RegExp(src):src.nodeName?dst[key]=src.cloneNode(!0):isElement(src)?dst[key]=src.clone():(isObject(dst[key])||(dst[key]=isArray(src)?[]:{}),baseExtend(dst[key],[src],!0)):dst[key]=src}}return setHashKey(dst,h),dst}function extend(dst){return baseExtend(dst,slice.call(arguments,1),!1)}function merge(dst){return baseExtend(dst,slice.call(arguments,1),!0)}function toInt(str){return parseInt(str,10)}function inherit(parent,extra){return extend(Object.create(parent),extra)}function noop(){}function identity($){return $}function valueFn(value){return function(){return value}}function hasCustomToString(obj){return isFunction(obj.toString)&&obj.toString!==toString}function isUndefined(value){return void 0===value}function isDefined(value){return void 0!==value}function isObject(value){return null!==value&&"object"==typeof value}
function isBlankObject(value){return null!==value&&"object"==typeof value&&!getPrototypeOf(value)}function isString(value){return"string"==typeof value}function isNumber(value){return"number"==typeof value}function isDate(value){return"[object Date]"===toString.call(value)}function isFunction(value){return"function"==typeof value}function isRegExp(value){return"[object RegExp]"===toString.call(value)}function isWindow(obj){return obj&&obj.window===obj}function isScope(obj){return obj&&obj.$evalAsync&&obj.$watch}function isFile(obj){return"[object File]"===toString.call(obj)}function isFormData(obj){return"[object FormData]"===toString.call(obj)}function isBlob(obj){return"[object Blob]"===toString.call(obj)}function isBoolean(value){return"boolean"==typeof value}function isPromiseLike(obj){return obj&&isFunction(obj.then)}function isTypedArray(value){return value&&isNumber(value.length)&&TYPED_ARRAY_REGEXP.test(toString.call(value))}function isArrayBuffer(obj){return"[object ArrayBuffer]"===toString.call(obj)}function isElement(node){return!(!node||!(node.nodeName||node.prop&&node.attr&&node.find))}function makeMap(str){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[items[i]]=!0;return obj}function nodeName_(element){return lowercase(element.nodeName||element[0]&&element[0].nodeName)}function arrayRemove(array,value){var index=array.indexOf(value);return index>=0&&array.splice(index,1),index}function copy(source,destination){function copyRecurse(source,destination){var key,h=destination.$$hashKey;if(isArray(source))for(var i=0,ii=source.length;i<ii;i++)destination.push(copyElement(source[i]));else if(isBlankObject(source))for(key in source)destination[key]=copyElement(source[key]);else if(source&&"function"==typeof source.hasOwnProperty)for(key in source)source.hasOwnProperty(key)&&(destination[key]=copyElement(source[key]));else for(key in source)hasOwnProperty.call(source,key)&&(destination[key]=copyElement(source[key]));return setHashKey(destination,h),destination}function copyElement(source){if(!isObject(source))return source;var index=stackSource.indexOf(source);if(-1!==index)return stackDest[index];if(isWindow(source)||isScope(source))throw ngMinErr("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");var needsRecurse=!1,destination=copyType(source);return void 0===destination&&(destination=isArray(source)?[]:Object.create(getPrototypeOf(source)),needsRecurse=!0),stackSource.push(source),stackDest.push(destination),needsRecurse?copyRecurse(source,destination):destination}function copyType(source){switch(toString.call(source)){case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return new source.constructor(copyElement(source.buffer));case"[object ArrayBuffer]":if(!source.slice){var copied=new ArrayBuffer(source.byteLength);return new Uint8Array(copied).set(new Uint8Array(source)),copied}return source.slice(0);case"[object Boolean]":case"[object Number]":case"[object String]":case"[object Date]":return new source.constructor(source.valueOf());case"[object RegExp]":var re=new RegExp(source.source,source.toString().match(/[^\/]*$/)[0]);return re.lastIndex=source.lastIndex,re;case"[object Blob]":return new source.constructor([source],{type:source.type})}if(isFunction(source.cloneNode))return source.cloneNode(!0)}var stackSource=[],stackDest=[];if(destination){if(isTypedArray(destination)||isArrayBuffer(destination))throw ngMinErr("cpta","Can't copy! TypedArray destination cannot be mutated.");if(source===destination)throw ngMinErr("cpi","Can't copy! Source and destination are identical.");return isArray(destination)?destination.length=0:forEach(destination,function(value,key){"$$hashKey"!==key&&delete destination[key]}),stackSource.push(source),stackDest.push(destination),copyRecurse(source,destination)}return copyElement(source)}function shallowCopy(src,dst){if(isArray(src)){dst=dst||[];for(var i=0,ii=src.length;i<ii;i++)dst[i]=src[i]}else if(isObject(src)){dst=dst||{};for(var key in src)"$"===key.charAt(0)&&"$"===key.charAt(1)||(dst[key]=src[key])}return dst||src}function equals(o1,o2){if(o1===o2)return!0;if(null===o1||null===o2)return!1;if(o1!==o1&&o2!==o2)return!0;var length,key,keySet,t1=typeof o1,t2=typeof o2;if(t1==t2&&"object"==t1){if(!isArray(o1)){if(isDate(o1))return!!isDate(o2)&&equals(o1.getTime(),o2.getTime());if(isRegExp(o1))return!!isRegExp(o2)&&o1.toString()==o2.toString();if(isScope(o1)||isScope(o2)||isWindow(o1)||isWindow(o2)||isArray(o2)||isDate(o2)||isRegExp(o2))return!1;keySet=createMap();for(key in o1)if("$"!==key.charAt(0)&&!isFunction(o1[key])){if(!equals(o1[key],o2[key]))return!1;keySet[key]=!0}for(key in o2)if(!(key in keySet)&&"$"!==key.charAt(0)&&isDefined(o2[key])&&!isFunction(o2[key]))return!1;return!0}if(!isArray(o2))return!1;if((length=o1.length)==o2.length){for(key=0;key<length;key++)if(!equals(o1[key],o2[key]))return!1;return!0}}return!1}function concat(array1,array2,index){return array1.concat(slice.call(array2,index))}function sliceArgs(args,startIndex){return slice.call(args,startIndex||0)}function bind(self,fn){var curryArgs=arguments.length>2?sliceArgs(arguments,2):[];return!isFunction(fn)||fn instanceof RegExp?fn:curryArgs.length?function(){return arguments.length?fn.apply(self,concat(curryArgs,arguments,0)):fn.apply(self,curryArgs)}:function(){return arguments.length?fn.apply(self,arguments):fn.call(self)}}function toJsonReplacer(key,value){var val=value;return"string"==typeof key&&"$"===key.charAt(0)&&"$"===key.charAt(1)?val=void 0:isWindow(value)?val="$WINDOW":value&&window.document===value?val="$DOCUMENT":isScope(value)&&(val="$SCOPE"),val}function toJson(obj,pretty){if(!isUndefined(obj))return isNumber(pretty)||(pretty=pretty?2:null),JSON.stringify(obj,toJsonReplacer,pretty)}function fromJson(json){return isString(json)?JSON.parse(json):json}function timezoneToOffset(timezone,fallback){timezone=timezone.replace(ALL_COLONS,"");var requestedTimezoneOffset=Date.parse("Jan 01, 1970 00:00:00 "+timezone)/6e4;return isNaN(requestedTimezoneOffset)?fallback:requestedTimezoneOffset}function addDateMinutes(date,minutes){return date=new Date(date.getTime()),date.setMinutes(date.getMinutes()+minutes),date}function convertTimezoneToLocal(date,timezone,reverse){reverse=reverse?-1:1;var dateTimezoneOffset=date.getTimezoneOffset();return addDateMinutes(date,reverse*(timezoneToOffset(timezone,dateTimezoneOffset)-dateTimezoneOffset))}function startingTag(element){element=jqLite(element).clone();try{element.empty()}catch(e){}var elemHtml=jqLite("<div>").append(element).html();try{return element[0].nodeType===NODE_TYPE_TEXT?lowercase(elemHtml):elemHtml.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(match,nodeName){return"<"+lowercase(nodeName)})}catch(e){return lowercase(elemHtml)}}function tryDecodeURIComponent(value){try{return decodeURIComponent(value)}catch(e){}}function parseKeyValue(keyValue){var obj={};return forEach((keyValue||"").split("&"),function(keyValue){var splitPoint,key,val;keyValue&&(key=keyValue=keyValue.replace(/\+/g,"%20"),splitPoint=keyValue.indexOf("="),-1!==splitPoint&&(key=keyValue.substring(0,splitPoint),val=keyValue.substring(splitPoint+1)),key=tryDecodeURIComponent(key),isDefined(key)&&(val=!isDefined(val)||tryDecodeURIComponent(val),hasOwnProperty.call(obj,key)?isArray(obj[key])?obj[key].push(val):obj[key]=[obj[key],val]:obj[key]=val))}),obj}function toKeyValue(obj){var parts=[];return forEach(obj,function(value,key){isArray(value)?forEach(value,function(arrayValue){parts.push(encodeUriQuery(key,!0)+(!0===arrayValue?"":"="+encodeUriQuery(arrayValue,!0)))}):parts.push(encodeUriQuery(key,!0)+(!0===value?"":"="+encodeUriQuery(value,!0)))}),parts.length?parts.join("&"):""}function encodeUriSegment(val){return encodeUriQuery(val,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function encodeUriQuery(val,pctEncodeSpaces){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,pctEncodeSpaces?"%20":"+")}function getNgAttribute(element,ngAttr){var attr,i,ii=ngAttrPrefixes.length;for(i=0;i<ii;++i)if(attr=ngAttrPrefixes[i]+ngAttr,isString(attr=element.getAttribute(attr)))return attr;return null}function angularInit(element,bootstrap){var appElement,module,config={};forEach(ngAttrPrefixes,function(prefix){var name=prefix+"app";!appElement&&element.hasAttribute&&element.hasAttribute(name)&&(appElement=element,module=element.getAttribute(name))}),forEach(ngAttrPrefixes,function(prefix){var candidate,name=prefix+"app";!appElement&&(candidate=element.querySelector("["+name.replace(":","\\:")+"]"))&&(appElement=candidate,module=candidate.getAttribute(name))}),appElement&&(config.strictDi=null!==getNgAttribute(appElement,"strict-di"),bootstrap(appElement,module?[module]:[],config))}function bootstrap(element,modules,config){isObject(config)||(config={}),config=extend({strictDi:!1},config);var doBootstrap=function(){if(element=jqLite(element),element.injector()){var tag=element[0]===window.document?"document":startingTag(element);throw ngMinErr("btstrpd","App already bootstrapped with this element '{0}'",tag.replace(/</,"&lt;").replace(/>/,"&gt;"))}modules=modules||[],modules.unshift(["$provide",function($provide){$provide.value("$rootElement",element)}]),config.debugInfoEnabled&&modules.push(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!0)}]),modules.unshift("ng");var injector=createInjector(modules,config.strictDi);return injector.invoke(["$rootScope","$rootElement","$compile","$injector",function(scope,element,compile,injector){scope.$apply(function(){element.data("$injector",injector),compile(element)(scope)})}]),injector},NG_ENABLE_DEBUG_INFO=/^NG_ENABLE_DEBUG_INFO!/,NG_DEFER_BOOTSTRAP=/^NG_DEFER_BOOTSTRAP!/;if(window&&NG_ENABLE_DEBUG_INFO.test(window.name)&&(config.debugInfoEnabled=!0,window.name=window.name.replace(NG_ENABLE_DEBUG_INFO,"")),window&&!NG_DEFER_BOOTSTRAP.test(window.name))return doBootstrap();window.name=window.name.replace(NG_DEFER_BOOTSTRAP,""),angular.resumeBootstrap=function(extraModules){return forEach(extraModules,function(module){modules.push(module)}),doBootstrap()},isFunction(angular.resumeDeferredBootstrap)&&angular.resumeDeferredBootstrap()}function reloadWithDebugInfo(){window.name="NG_ENABLE_DEBUG_INFO!"+window.name,window.location.reload()}function getTestability(rootElement){var injector=angular.element(rootElement).injector();if(!injector)throw ngMinErr("test","no injector found for element argument to getTestability");return injector.get("$$testability")}function snake_case(name,separator){return separator=separator||"_",name.replace(SNAKE_CASE_REGEXP,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}function assertArg(arg,name,reason){if(!arg)throw ngMinErr("areq","Argument '{0}' is {1}",name||"?",reason||"required");return arg}function assertArgFn(arg,name,acceptArrayAnnotation){return acceptArrayAnnotation&&isArray(arg)&&(arg=arg[arg.length-1]),assertArg(isFunction(arg),name,"not a function, got "+(arg&&"object"==typeof arg?arg.constructor.name||"Object":typeof arg)),arg}function assertNotHasOwnProperty(name,context){if("hasOwnProperty"===name)throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}function getter(obj,path,bindFnToScope){if(!path)return obj;for(var key,keys=path.split("."),lastInstance=obj,len=keys.length,i=0;i<len;i++)key=keys[i],obj&&(obj=(lastInstance=obj)[key]);return!bindFnToScope&&isFunction(obj)?bind(lastInstance,obj):obj}function getBlockNodes(nodes){for(var blockNodes,node=nodes[0],endNode=nodes[nodes.length-1],i=1;node!==endNode&&(node=node.nextSibling);i++)(blockNodes||nodes[i]!==node)&&(blockNodes||(blockNodes=jqLite(slice.call(nodes,0,i))),blockNodes.push(node));return blockNodes||nodes}function createMap(){return Object.create(null)}function setupModuleLoader(window){function ensure(obj,name,factory){return obj[name]||(obj[name]=factory())}var $injectorMinErr=minErr("$injector"),ngMinErr=minErr("ng"),angular=ensure(window,"angular",Object);return angular.$$minErr=angular.$$minErr||minErr,ensure(angular,"module",function(){var modules={};return function(name,requires,configFn){return function(name,context){if("hasOwnProperty"===name)throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}(name,"module"),requires&&modules.hasOwnProperty(name)&&(modules[name]=null),ensure(modules,name,function(){function invokeLater(provider,method,insertMethod,queue){return queue||(queue=invokeQueue),function(){return queue[insertMethod||"push"]([provider,method,arguments]),moduleInstance}}function invokeLaterAndSetModuleName(provider,method){return function(recipeName,factoryFunction){return factoryFunction&&isFunction(factoryFunction)&&(factoryFunction.$$moduleName=name),invokeQueue.push([provider,method,arguments]),moduleInstance}}if(!requires)throw $injectorMinErr("nomod","Module '{0}' is not available! You either misspelled the module name or forgot to load it. If registering a module ensure that you specify the dependencies as the second argument.",name);var invokeQueue=[],configBlocks=[],runBlocks=[],config=invokeLater("$injector","invoke","push",configBlocks),moduleInstance={_invokeQueue:invokeQueue,_configBlocks:configBlocks,_runBlocks:runBlocks,requires:requires,name:name,provider:invokeLaterAndSetModuleName("$provide","provider"),factory:invokeLaterAndSetModuleName("$provide","factory"),service:invokeLaterAndSetModuleName("$provide","service"),value:invokeLater("$provide","value"),constant:invokeLater("$provide","constant","unshift"),decorator:invokeLaterAndSetModuleName("$provide","decorator"),animation:invokeLaterAndSetModuleName("$animateProvider","register"),filter:invokeLaterAndSetModuleName("$filterProvider","register"),controller:invokeLaterAndSetModuleName("$controllerProvider","register"),directive:invokeLaterAndSetModuleName("$compileProvider","directive"),component:invokeLaterAndSetModuleName("$compileProvider","component"),config:config,run:function(block){return runBlocks.push(block),this}};return configFn&&config(configFn),moduleInstance})}})}function serializeObject(obj){var seen=[];return JSON.stringify(obj,function(key,val){if(val=toJsonReplacer(key,val),isObject(val)){if(seen.indexOf(val)>=0)return"...";seen.push(val)}return val})}function toDebugString(obj){return"function"==typeof obj?obj.toString().replace(/ \{[\s\S]*$/,""):isUndefined(obj)?"undefined":"string"!=typeof obj?serializeObject(obj):obj}function jqNextId(){return++jqId}function camelCase(name){return name.replace(SPECIAL_CHARS_REGEXP,function(_,separator,letter,offset){return offset?letter.toUpperCase():letter}).replace(MOZ_HACK_REGEXP,"Moz$1")}function jqLiteIsTextNode(html){return!HTML_REGEXP.test(html)}function jqLiteAcceptsData(node){var nodeType=node.nodeType;return nodeType===NODE_TYPE_ELEMENT||!nodeType||nodeType===NODE_TYPE_DOCUMENT}function jqLiteHasData(node){for(var key in jqCache[node.ng339])return!0;return!1}function jqLiteCleanData(nodes){for(var i=0,ii=nodes.length;i<ii;i++)jqLiteRemoveData(nodes[i])}function jqLiteBuildFragment(html,context){var tmp,tag,wrap,i,fragment=context.createDocumentFragment(),nodes=[];if(jqLiteIsTextNode(html))nodes.push(context.createTextNode(html));else{for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(TAG_NAME_REGEXP.exec(html)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+html.replace(XHTML_TAG_REGEXP,"<$1></$2>")+wrap[2],i=wrap[0];i--;)tmp=tmp.lastChild;nodes=concat(nodes,tmp.childNodes),tmp=fragment.firstChild,tmp.textContent=""}return fragment.textContent="",fragment.innerHTML="",forEach(nodes,function(node){fragment.appendChild(node)}),fragment}function jqLiteParseHTML(html,context){context=context||window.document;var parsed;return(parsed=SINGLE_TAG_REGEXP.exec(html))?[context.createElement(parsed[1])]:(parsed=jqLiteBuildFragment(html,context))?parsed.childNodes:[]}function jqLiteWrapNode(node,wrapper){var parent=node.parentNode;parent&&parent.replaceChild(wrapper,node),wrapper.appendChild(node)}function JQLite(element){if(element instanceof JQLite)return element;var argIsString;if(isString(element)&&(element=trim(element),argIsString=!0),!(this instanceof JQLite)){if(argIsString&&"<"!=element.charAt(0))throw jqLiteMinErr("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element");return new JQLite(element)}argIsString?jqLiteAddNodes(this,jqLiteParseHTML(element)):jqLiteAddNodes(this,element)}function jqLiteClone(element){return element.cloneNode(!0)}function jqLiteDealoc(element,onlyDescendants){if(onlyDescendants||jqLiteRemoveData(element),element.querySelectorAll)for(var descendants=element.querySelectorAll("*"),i=0,l=descendants.length;i<l;i++)jqLiteRemoveData(descendants[i])}function jqLiteOff(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("offargs","jqLite#off() does not support the `selector` argument");var expandoStore=jqLiteExpandoStore(element),events=expandoStore&&expandoStore.events,handle=expandoStore&&expandoStore.handle;if(handle)if(type){var removeHandler=function(type){var listenerFns=events[type];isDefined(fn)&&arrayRemove(listenerFns||[],fn),isDefined(fn)&&listenerFns&&listenerFns.length>0||(removeEventListenerFn(element,type,handle),delete events[type])};forEach(type.split(" "),function(type){removeHandler(type),MOUSE_EVENT_MAP[type]&&removeHandler(MOUSE_EVENT_MAP[type])})}else for(type in events)"$destroy"!==type&&removeEventListenerFn(element,type,handle),delete events[type]}function jqLiteRemoveData(element,name){var expandoId=element.ng339,expandoStore=expandoId&&jqCache[expandoId];if(expandoStore){if(name)return void delete expandoStore.data[name];expandoStore.handle&&(expandoStore.events.$destroy&&expandoStore.handle({},"$destroy"),jqLiteOff(element)),delete jqCache[expandoId],element.ng339=void 0}}function jqLiteExpandoStore(element,createIfNecessary){var expandoId=element.ng339,expandoStore=expandoId&&jqCache[expandoId];return createIfNecessary&&!expandoStore&&(element.ng339=expandoId=jqNextId(),expandoStore=jqCache[expandoId]={events:{},data:{},handle:void 0}),expandoStore}function jqLiteData(element,key,value){if(jqLiteAcceptsData(element)){var isSimpleSetter=isDefined(value),isSimpleGetter=!isSimpleSetter&&key&&!isObject(key),massGetter=!key,expandoStore=jqLiteExpandoStore(element,!isSimpleGetter),data=expandoStore&&expandoStore.data;if(isSimpleSetter)data[key]=value;else{if(massGetter)return data;if(isSimpleGetter)return data&&data[key];extend(data,key)}}}function jqLiteHasClass(element,selector){return!!element.getAttribute&&(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+selector+" ")>-1}function jqLiteRemoveClass(element,cssClasses){cssClasses&&element.setAttribute&&forEach(cssClasses.split(" "),function(cssClass){element.setAttribute("class",trim((" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+trim(cssClass)+" "," ")))})}function jqLiteAddClass(element,cssClasses){if(cssClasses&&element.setAttribute){var existingClasses=(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");forEach(cssClasses.split(" "),function(cssClass){cssClass=trim(cssClass),-1===existingClasses.indexOf(" "+cssClass+" ")&&(existingClasses+=cssClass+" ")}),element.setAttribute("class",trim(existingClasses))}}function jqLiteAddNodes(root,elements){if(elements)if(elements.nodeType)root[root.length++]=elements;else{var length=elements.length;if("number"==typeof length&&elements.window!==elements){if(length)for(var i=0;i<length;i++)root[root.length++]=elements[i]}else root[root.length++]=elements}}function jqLiteController(element,name){return jqLiteInheritedData(element,"$"+(name||"ngController")+"Controller")}function jqLiteInheritedData(element,name,value){element.nodeType==NODE_TYPE_DOCUMENT&&(element=element.documentElement);for(var names=isArray(name)?name:[name];element;){for(var i=0,ii=names.length;i<ii;i++)if(isDefined(value=jqLite.data(element,names[i])))return value;element=element.parentNode||element.nodeType===NODE_TYPE_DOCUMENT_FRAGMENT&&element.host}}function jqLiteEmpty(element){for(jqLiteDealoc(element,!0);element.firstChild;)element.removeChild(element.firstChild)}function jqLiteRemove(element,keepData){keepData||jqLiteDealoc(element);var parent=element.parentNode;parent&&parent.removeChild(element)}function jqLiteDocumentLoaded(action,win){win=win||window,"complete"===win.document.readyState?win.setTimeout(action):jqLite(win).on("load",action)}function getBooleanAttrName(element,name){var booleanAttr=BOOLEAN_ATTR[name.toLowerCase()];return booleanAttr&&BOOLEAN_ELEMENTS[nodeName_(element)]&&booleanAttr}function getAliasedAttrName(name){return ALIASED_ATTR[name]}function createEventHandler(element,events){var eventHandler=function(event,type){event.isDefaultPrevented=function(){return event.defaultPrevented};var eventFns=events[type||event.type],eventFnsLength=eventFns?eventFns.length:0;if(eventFnsLength){if(isUndefined(event.immediatePropagationStopped)){var originalStopImmediatePropagation=event.stopImmediatePropagation;event.stopImmediatePropagation=function(){event.immediatePropagationStopped=!0,event.stopPropagation&&event.stopPropagation(),originalStopImmediatePropagation&&originalStopImmediatePropagation.call(event)}}event.isImmediatePropagationStopped=function(){return!0===event.immediatePropagationStopped};var handlerWrapper=eventFns.specialHandlerWrapper||defaultHandlerWrapper;eventFnsLength>1&&(eventFns=shallowCopy(eventFns));for(var i=0;i<eventFnsLength;i++)event.isImmediatePropagationStopped()||handlerWrapper(element,event,eventFns[i])}};return eventHandler.elem=element,eventHandler}function defaultHandlerWrapper(element,event,handler){handler.call(element,event)}function specialMouseHandlerWrapper(target,event,handler){var related=event.relatedTarget;related&&(related===target||jqLiteContains.call(target,related))||handler.call(target,event)}function $$jqLiteProvider(){this.$get=function(){return extend(JQLite,{hasClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteHasClass(node,classes)},addClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteAddClass(node,classes)},removeClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteRemoveClass(node,classes)}})}}function hashKey(obj,nextUidFn){var key=obj&&obj.$$hashKey;if(key)return"function"==typeof key&&(key=obj.$$hashKey()),key;var objType=typeof obj;return key="function"==objType||"object"==objType&&null!==obj?obj.$$hashKey=objType+":"+(nextUidFn||nextUid)():objType+":"+obj}function HashMap(array,isolatedUid){if(isolatedUid){var uid=0;this.nextUid=function(){return++uid}}forEach(array,this.put,this)}function extractArgs(fn){var fnText=Function.prototype.toString.call(fn).replace(STRIP_COMMENTS,"");return fnText.match(ARROW_ARG)||fnText.match(FN_ARGS)}function anonFn(fn){var args=extractArgs(fn);return args?"function("+(args[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}function annotate(fn,strictDi,name){var $inject,argDecl,last;if("function"==typeof fn){if(!($inject=fn.$inject)){if($inject=[],fn.length){if(strictDi)throw isString(name)&&name||(name=fn.name||anonFn(fn)),$injectorMinErr("strictdi","{0} is not using explicit annotation and cannot be invoked in strict mode",name);argDecl=extractArgs(fn),forEach(argDecl[1].split(FN_ARG_SPLIT),function(arg){arg.replace(FN_ARG,function(all,underscore,name){$inject.push(name)})})}fn.$inject=$inject}}else isArray(fn)?(last=fn.length-1,assertArgFn(fn[last],"fn"),$inject=fn.slice(0,last)):assertArgFn(fn,"fn",!0);return $inject}function createInjector(modulesToLoad,strictDi){function supportObject(delegate){return function(key,value){if(!isObject(key))return delegate(key,value);forEach(key,reverseParams(delegate))}}function provider(name,provider_){if(assertNotHasOwnProperty(name,"service"),(isFunction(provider_)||isArray(provider_))&&(provider_=providerInjector.instantiate(provider_)),!provider_.$get)throw $injectorMinErr("pget","Provider '{0}' must define $get factory method.",name);return providerCache[name+providerSuffix]=provider_}function enforceReturnValue(name,factory){return function(){var result=instanceInjector.invoke(factory,this);if(isUndefined(result))throw $injectorMinErr("undef","Provider '{0}' must return a value from $get factory method.",name);return result}}function factory(name,factoryFn,enforce){return provider(name,{$get:!1!==enforce?enforceReturnValue(name,factoryFn):factoryFn})}function service(name,constructor){return factory(name,["$injector",function($injector){return $injector.instantiate(constructor)}])}function value(name,val){return factory(name,valueFn(val),!1)}function constant(name,value){assertNotHasOwnProperty(name,"constant"),providerCache[name]=value,instanceCache[name]=value}function decorator(serviceName,decorFn){var origProvider=providerInjector.get(serviceName+providerSuffix),orig$get=origProvider.$get;origProvider.$get=function(){var origInstance=instanceInjector.invoke(orig$get,origProvider);return instanceInjector.invoke(decorFn,null,{$delegate:origInstance})}}function loadModules(modulesToLoad){assertArg(isUndefined(modulesToLoad)||isArray(modulesToLoad),"modulesToLoad","not an array");var moduleFn,runBlocks=[];return forEach(modulesToLoad,function(module){function runInvokeQueue(queue){var i,ii;for(i=0,ii=queue.length;i<ii;i++){var invokeArgs=queue[i],provider=providerInjector.get(invokeArgs[0]);provider[invokeArgs[1]].apply(provider,invokeArgs[2])}}if(!loadedModules.get(module)){loadedModules.put(module,!0);try{isString(module)?(moduleFn=angularModule(module),runBlocks=runBlocks.concat(loadModules(moduleFn.requires)).concat(moduleFn._runBlocks),runInvokeQueue(moduleFn._invokeQueue),runInvokeQueue(moduleFn._configBlocks)):isFunction(module)?runBlocks.push(providerInjector.invoke(module)):isArray(module)?runBlocks.push(providerInjector.invoke(module)):assertArgFn(module,"module")}catch(e){throw isArray(module)&&(module=module[module.length-1]),e.message&&e.stack&&-1==e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),$injectorMinErr("modulerr","Failed to instantiate module {0} due to:\n{1}",module,e.stack||e.message||e)}}}),runBlocks}function createInternalInjector(cache,factory){function getService(serviceName,caller){if(cache.hasOwnProperty(serviceName)){if(cache[serviceName]===INSTANTIATING)throw $injectorMinErr("cdep","Circular dependency found: {0}",serviceName+" <- "+path.join(" <- "));return cache[serviceName]}try{return path.unshift(serviceName),cache[serviceName]=INSTANTIATING,cache[serviceName]=factory(serviceName,caller)}catch(err){throw cache[serviceName]===INSTANTIATING&&delete cache[serviceName],err}finally{path.shift()}}function injectionArgs(fn,locals,serviceName){for(var args=[],$inject=createInjector.$$annotate(fn,strictDi,serviceName),i=0,length=$inject.length;i<length;i++){var key=$inject[i];if("string"!=typeof key)throw $injectorMinErr("itkn","Incorrect injection token! Expected service name as string, got {0}",key);args.push(locals&&locals.hasOwnProperty(key)?locals[key]:getService(key,serviceName))}return args}function isClass(func){return!(msie<=11)&&("function"==typeof func&&/^(?:class\s|constructor\()/.test(Function.prototype.toString.call(func)))}function invoke(fn,self,locals,serviceName){"string"==typeof locals&&(serviceName=locals,locals=null);var args=injectionArgs(fn,locals,serviceName);return isArray(fn)&&(fn=fn[fn.length-1]),isClass(fn)?(args.unshift(null),new(Function.prototype.bind.apply(fn,args))):fn.apply(self,args)}function instantiate(Type,locals,serviceName){var ctor=isArray(Type)?Type[Type.length-1]:Type,args=injectionArgs(Type,locals,serviceName);return args.unshift(null),new(Function.prototype.bind.apply(ctor,args))}return{invoke:invoke,instantiate:instantiate,get:getService,annotate:createInjector.$$annotate,has:function(name){return providerCache.hasOwnProperty(name+providerSuffix)||cache.hasOwnProperty(name)}}}strictDi=!0===strictDi;var INSTANTIATING={},providerSuffix="Provider",path=[],loadedModules=new HashMap([],!0),providerCache={$provide:{provider:supportObject(provider),factory:supportObject(factory),service:supportObject(service),value:supportObject(value),constant:supportObject(constant),decorator:decorator}},providerInjector=providerCache.$injector=createInternalInjector(providerCache,function(serviceName,caller){throw angular.isString(caller)&&path.push(caller),$injectorMinErr("unpr","Unknown provider: {0}",path.join(" <- "))}),instanceCache={},protoInstanceInjector=createInternalInjector(instanceCache,function(serviceName,caller){var provider=providerInjector.get(serviceName+providerSuffix,caller);return instanceInjector.invoke(provider.$get,provider,void 0,serviceName)}),instanceInjector=protoInstanceInjector;providerCache["$injector"+providerSuffix]={$get:valueFn(protoInstanceInjector)};var runBlocks=loadModules(modulesToLoad);return instanceInjector=protoInstanceInjector.get("$injector"),instanceInjector.strictDi=strictDi,forEach(runBlocks,function(fn){fn&&instanceInjector.invoke(fn)}),instanceInjector}function $AnchorScrollProvider(){var autoScrollingEnabled=!0;this.disableAutoScrolling=function(){autoScrollingEnabled=!1},this.$get=["$window","$location","$rootScope",function($window,$location,$rootScope){function getFirstAnchor(list){var result=null;return Array.prototype.some.call(list,function(element){if("a"===nodeName_(element))return result=element,!0}),result}function getYOffset(){var offset=scroll.yOffset;if(isFunction(offset))offset=offset();else if(isElement(offset)){var elem=offset[0],style=$window.getComputedStyle(elem);offset="fixed"!==style.position?0:elem.getBoundingClientRect().bottom}else isNumber(offset)||(offset=0);return offset}function scrollTo(elem){if(elem){elem.scrollIntoView();var offset=getYOffset();if(offset){var elemTop=elem.getBoundingClientRect().top;$window.scrollBy(0,elemTop-offset)}}else $window.scrollTo(0,0)}function scroll(hash){hash=isString(hash)?hash:$location.hash();var elm;hash?(elm=document.getElementById(hash))?scrollTo(elm):(elm=getFirstAnchor(document.getElementsByName(hash)))?scrollTo(elm):"top"===hash&&scrollTo(null):scrollTo(null)}var document=$window.document;return autoScrollingEnabled&&$rootScope.$watch(function(){return $location.hash()},function(newVal,oldVal){newVal===oldVal&&""===newVal||jqLiteDocumentLoaded(function(){$rootScope.$evalAsync(scroll)})}),scroll}]}function mergeClasses(a,b){return a||b?a?b?(isArray(a)&&(a=a.join(" ")),isArray(b)&&(b=b.join(" ")),a+" "+b):a:b:""}function extractElementNode(element){for(var i=0;i<element.length;i++){var elm=element[i];if(elm.nodeType===ELEMENT_NODE)return elm}}function splitClasses(classes){isString(classes)&&(classes=classes.split(" "));var obj=createMap();return forEach(classes,function(klass){klass.length&&(obj[klass]=!0)}),obj}function prepareAnimateOptions(options){return isObject(options)?options:{}}function Browser(window,document,$log,$sniffer){function completeOutstandingRequest(fn){try{fn.apply(null,sliceArgs(arguments,1))}finally{if(0===--outstandingRequestCount)for(;outstandingRequestCallbacks.length;)try{outstandingRequestCallbacks.pop()()}catch(e){$log.error(e)}}}function getHash(url){var index=url.indexOf("#");return-1===index?"":url.substr(index)}function cacheStateAndFireUrlChange(){pendingLocation=null,cacheState(),fireUrlChange()}function cacheState(){cachedState=getCurrentState(),cachedState=isUndefined(cachedState)?null:cachedState,equals(cachedState,lastCachedState)&&(cachedState=lastCachedState),lastCachedState=cachedState}function fireUrlChange(){lastBrowserUrl===self.url()&&lastHistoryState===cachedState||(lastBrowserUrl=self.url(),lastHistoryState=cachedState,forEach(urlChangeListeners,function(listener){listener(self.url(),cachedState)}))}var self=this,location=window.location,history=window.history,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,pendingDeferIds={};self.isMock=!1;var outstandingRequestCount=0,outstandingRequestCallbacks=[];self.$$completeOutstandingRequest=completeOutstandingRequest,self.$$incOutstandingRequestCount=function(){outstandingRequestCount++},self.notifyWhenNoOutstandingRequests=function(callback){0===outstandingRequestCount?callback():outstandingRequestCallbacks.push(callback)};var cachedState,lastHistoryState,lastBrowserUrl=location.href,baseElement=document.find("base"),pendingLocation=null,getCurrentState=$sniffer.history?function(){try{return history.state}catch(e){}}:noop;cacheState(),lastHistoryState=cachedState,self.url=function(url,replace,state){if(isUndefined(state)&&(state=null),location!==window.location&&(location=window.location),history!==window.history&&(history=window.history),url){var sameState=lastHistoryState===state;if(lastBrowserUrl===url&&(!$sniffer.history||sameState))return self;var sameBase=lastBrowserUrl&&stripHash(lastBrowserUrl)===stripHash(url);return lastBrowserUrl=url,lastHistoryState=state,!$sniffer.history||sameBase&&sameState?(sameBase&&!pendingLocation||(pendingLocation=url),replace?location.replace(url):sameBase?location.hash=getHash(url):location.href=url,location.href!==url&&(pendingLocation=url)):(history[replace?"replaceState":"pushState"](state,"",url),cacheState(),lastHistoryState=cachedState),self}return pendingLocation||location.href.replace(/%27/g,"'")},self.state=function(){return cachedState};var urlChangeListeners=[],urlChangeInit=!1,lastCachedState=null;self.onUrlChange=function(callback){return urlChangeInit||($sniffer.history&&jqLite(window).on("popstate",cacheStateAndFireUrlChange),jqLite(window).on("hashchange",cacheStateAndFireUrlChange),urlChangeInit=!0),urlChangeListeners.push(callback),callback},self.$$applicationDestroyed=function(){jqLite(window).off("hashchange popstate",cacheStateAndFireUrlChange)},self.$$checkUrlChange=fireUrlChange,self.baseHref=function(){var href=baseElement.attr("href");return href?href.replace(/^(https?\:)?\/\/[^\/]*/,""):""},self.defer=function(fn,delay){var timeoutId;return outstandingRequestCount++,timeoutId=setTimeout(function(){delete pendingDeferIds[timeoutId],completeOutstandingRequest(fn)},delay||0),pendingDeferIds[timeoutId]=!0,timeoutId},self.defer.cancel=function(deferId){return!!pendingDeferIds[deferId]&&(delete pendingDeferIds[deferId],clearTimeout(deferId),completeOutstandingRequest(noop),!0)}}function $BrowserProvider(){this.$get=["$window","$log","$sniffer","$document",function($window,$log,$sniffer,$document){return new Browser($window,$document,$log,$sniffer)}]}function $CacheFactoryProvider(){this.$get=function(){function cacheFactory(cacheId,options){function refresh(entry){entry!=freshEnd&&(staleEnd?staleEnd==entry&&(staleEnd=entry.n):staleEnd=entry,link(entry.n,entry.p),link(entry,freshEnd),freshEnd=entry,freshEnd.n=null)}function link(nextEntry,prevEntry){nextEntry!=prevEntry&&(nextEntry&&(nextEntry.p=prevEntry),prevEntry&&(prevEntry.n=nextEntry))}if(cacheId in caches)throw minErr("$cacheFactory")("iid","CacheId '{0}' is already taken!",cacheId);var size=0,stats=extend({},options,{id:cacheId}),data=createMap(),capacity=options&&options.capacity||Number.MAX_VALUE,lruHash=createMap(),freshEnd=null,staleEnd=null;return caches[cacheId]={put:function(key,value){if(!isUndefined(value)){if(capacity<Number.MAX_VALUE){refresh(lruHash[key]||(lruHash[key]={key:key}))}return key in data||size++,data[key]=value,size>capacity&&this.remove(staleEnd.key),value}},get:function(key){if(capacity<Number.MAX_VALUE){var lruEntry=lruHash[key];if(!lruEntry)return;refresh(lruEntry)}return data[key]},remove:function(key){if(capacity<Number.MAX_VALUE){var lruEntry=lruHash[key];if(!lruEntry)return;lruEntry==freshEnd&&(freshEnd=lruEntry.p),lruEntry==staleEnd&&(staleEnd=lruEntry.n),link(lruEntry.n,lruEntry.p),delete lruHash[key]}key in data&&(delete data[key],size--)},removeAll:function(){data=createMap(),size=0,lruHash=createMap(),freshEnd=staleEnd=null},destroy:function(){data=null,stats=null,lruHash=null,delete caches[cacheId]},info:function(){return extend({},stats,{size:size})}}}var caches={};return cacheFactory.info=function(){var info={};return forEach(caches,function(cache,cacheId){info[cacheId]=cache.info()}),info},cacheFactory.get=function(cacheId){return caches[cacheId]},cacheFactory}}function $TemplateCacheProvider(){this.$get=["$cacheFactory",function($cacheFactory){return $cacheFactory("templates")}]}function UNINITIALIZED_VALUE(){}function $CompileProvider($provide,$$sanitizeUriProvider){function parseIsolateBindings(scope,directiveName,isController){var LOCAL_REGEXP=/^\s*([@&<]|=(\*?))(\??)\s*(\w*)\s*$/,bindings=createMap();return forEach(scope,function(definition,scopeName){if(definition in bindingCache)return void(bindings[scopeName]=bindingCache[definition]);var match=definition.match(LOCAL_REGEXP);if(!match)throw $compileMinErr("iscp","Invalid {3} for directive '{0}'. Definition: {... {1}: '{2}' ...}",directiveName,scopeName,definition,isController?"controller bindings definition":"isolate scope definition");bindings[scopeName]={mode:match[1][0],collection:"*"===match[2],optional:"?"===match[3],attrName:match[4]||scopeName},match[4]&&(bindingCache[definition]=bindings[scopeName])}),bindings}function parseDirectiveBindings(directive,directiveName){var bindings={isolateScope:null,bindToController:null};if(isObject(directive.scope)&&(!0===directive.bindToController?(bindings.bindToController=parseIsolateBindings(directive.scope,directiveName,!0),bindings.isolateScope={}):bindings.isolateScope=parseIsolateBindings(directive.scope,directiveName,!1)),isObject(directive.bindToController)&&(bindings.bindToController=parseIsolateBindings(directive.bindToController,directiveName,!0)),isObject(bindings.bindToController)){var controller=directive.controller,controllerAs=directive.controllerAs;if(!controller)throw $compileMinErr("noctrl","Cannot bind to controller without directive '{0}'s controller.",directiveName);if(!identifierForController(controller,controllerAs))throw $compileMinErr("noident","Cannot bind to controller without identifier for directive '{0}'.",directiveName)}return bindings}function assertValidDirectiveName(name){var letter=name.charAt(0);if(!letter||letter!==lowercase(letter))throw $compileMinErr("baddir","Directive/Component name '{0}' is invalid. The first character must be a lowercase letter",name);if(name!==name.trim())throw $compileMinErr("baddir","Directive/Component name '{0}' is invalid. The name should not contain leading or trailing whitespaces",name)}var hasDirectives={},Suffix="Directive",COMMENT_DIRECTIVE_REGEXP=/^\s*directive\:\s*([\w\-]+)\s+(.*)$/,CLASS_DIRECTIVE_REGEXP=/(([\w\-]+)(?:\:([^;]+))?;?)/,ALL_OR_NOTHING_ATTRS=makeMap("ngSrc,ngSrcset,src,srcset"),REQUIRE_PREFIX_REGEXP=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,EVENT_HANDLER_ATTR_REGEXP=/^(on[a-z]+|formaction)$/,bindingCache=createMap();this.directive=function registerDirective(name,directiveFactory){return assertNotHasOwnProperty(name,"directive"),isString(name)?(assertValidDirectiveName(name),assertArg(directiveFactory,"directiveFactory"),hasDirectives.hasOwnProperty(name)||(hasDirectives[name]=[],$provide.factory(name+Suffix,["$injector","$exceptionHandler",function($injector,$exceptionHandler){var directives=[];return forEach(hasDirectives[name],function(directiveFactory,index){try{var directive=$injector.invoke(directiveFactory);isFunction(directive)?directive={compile:valueFn(directive)}:!directive.compile&&directive.link&&(directive.compile=valueFn(directive.link)),directive.priority=directive.priority||0,directive.index=index,directive.name=directive.name||name,directive.require=directive.require||directive.controller&&directive.name,directive.restrict=directive.restrict||"EA",directive.$$moduleName=directiveFactory.$$moduleName,directives.push(directive)}catch(e){$exceptionHandler(e)}}),directives}])),hasDirectives[name].push(directiveFactory)):forEach(name,reverseParams(registerDirective)),this},this.component=function(name,options){function factory($injector){function makeInjectable(fn){return isFunction(fn)||isArray(fn)?function(tElement,tAttrs){return $injector.invoke(fn,this,{$element:tElement,$attrs:tAttrs})}:fn}var template=options.template||options.templateUrl?options.template:"",ddo={controller:controller,controllerAs:identifierForController(options.controller)||options.controllerAs||"$ctrl",template:makeInjectable(template),templateUrl:makeInjectable(options.templateUrl),transclude:options.transclude,scope:{},bindToController:options.bindings||{},restrict:"E",require:options.require};return forEach(options,function(val,key){"$"===key.charAt(0)&&(ddo[key]=val)}),ddo}var controller=options.controller||function(){};return forEach(options,function(val,key){"$"===key.charAt(0)&&(factory[key]=val,isFunction(controller)&&(controller[key]=val))}),factory.$inject=["$injector"],this.directive(name,factory)},this.aHrefSanitizationWhitelist=function(regexp){return isDefined(regexp)?($$sanitizeUriProvider.aHrefSanitizationWhitelist(regexp),this):$$sanitizeUriProvider.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(regexp){return isDefined(regexp)?($$sanitizeUriProvider.imgSrcSanitizationWhitelist(regexp),this):$$sanitizeUriProvider.imgSrcSanitizationWhitelist()};var debugInfoEnabled=!0;this.debugInfoEnabled=function(enabled){return isDefined(enabled)?(debugInfoEnabled=enabled,this):debugInfoEnabled};var TTL=10;this.onChangesTtl=function(value){return arguments.length?(TTL=value,this):TTL},this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$sce","$animate","$$sanitizeUri",function($injector,$interpolate,$exceptionHandler,$templateRequest,$parse,$controller,$rootScope,$sce,$animate,$$sanitizeUri){function flushOnChangesQueue(){try{if(!--onChangesTtl)throw onChangesQueue=void 0,$compileMinErr("infchng","{0} $onChanges() iterations reached. Aborting!\n",TTL);$rootScope.$apply(function(){for(var i=0,ii=onChangesQueue.length;i<ii;++i)onChangesQueue[i]();onChangesQueue=void 0})}finally{onChangesTtl++}}function Attributes(element,attributesToCopy){if(attributesToCopy){var i,l,key,keys=Object.keys(attributesToCopy);for(i=0,l=keys.length;i<l;i++)key=keys[i],this[key]=attributesToCopy[key]}else this.$attr={};this.$$element=element}function setSpecialAttr(element,attrName,value){specialAttrHolder.innerHTML="<span "+attrName+">";var attributes=specialAttrHolder.firstChild.attributes,attribute=attributes[0];attributes.removeNamedItem(attribute.name),attribute.value=value,element.attributes.setNamedItem(attribute)}function safeAddClass($element,className){try{$element.addClass(className)}catch(e){}}function compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext){$compileNodes instanceof jqLite||($compileNodes=jqLite($compileNodes));for(var NOT_EMPTY=/\S+/,i=0,len=$compileNodes.length;i<len;i++){var domNode=$compileNodes[i];domNode.nodeType===NODE_TYPE_TEXT&&domNode.nodeValue.match(NOT_EMPTY)&&jqLiteWrapNode(domNode,$compileNodes[i]=window.document.createElement("span"))}var compositeLinkFn=compileNodes($compileNodes,transcludeFn,$compileNodes,maxPriority,ignoreDirective,previousCompileContext);compile.$$addScopeClass($compileNodes);var namespace=null;return function(scope,cloneConnectFn,options){assertArg(scope,"scope"),previousCompileContext&&previousCompileContext.needsNewScope&&(scope=scope.$parent.$new()),options=options||{};var parentBoundTranscludeFn=options.parentBoundTranscludeFn,transcludeControllers=options.transcludeControllers,futureParentElement=options.futureParentElement;parentBoundTranscludeFn&&parentBoundTranscludeFn.$$boundTransclude&&(parentBoundTranscludeFn=parentBoundTranscludeFn.$$boundTransclude),namespace||(namespace=detectNamespaceForChildElements(futureParentElement));var $linkNode;if($linkNode="html"!==namespace?jqLite(wrapTemplate(namespace,jqLite("<div>").append($compileNodes).html())):cloneConnectFn?JQLitePrototype.clone.call($compileNodes):$compileNodes,transcludeControllers)for(var controllerName in transcludeControllers)$linkNode.data("$"+controllerName+"Controller",transcludeControllers[controllerName].instance);return compile.$$addScopeInfo($linkNode,scope),cloneConnectFn&&cloneConnectFn($linkNode,scope),compositeLinkFn&&compositeLinkFn(scope,$linkNode,$linkNode,parentBoundTranscludeFn),$linkNode}}function detectNamespaceForChildElements(parentElement){var node=parentElement&&parentElement[0];return node&&"foreignobject"!==nodeName_(node)&&toString.call(node).match(/SVG/)?"svg":"html"}function compileNodes(nodeList,transcludeFn,$rootElement,maxPriority,ignoreDirective,previousCompileContext){function compositeLinkFn(scope,nodeList,$rootElement,parentBoundTranscludeFn){var nodeLinkFn,childLinkFn,node,childScope,i,ii,idx,childBoundTranscludeFn,stableNodeList;if(nodeLinkFnFound){var nodeListLength=nodeList.length;for(stableNodeList=new Array(nodeListLength),i=0;i<linkFns.length;i+=3)idx=linkFns[i],stableNodeList[idx]=nodeList[idx]}else stableNodeList=nodeList;for(i=0,ii=linkFns.length;i<ii;)node=stableNodeList[linkFns[i++]],nodeLinkFn=linkFns[i++],childLinkFn=linkFns[i++],nodeLinkFn?(nodeLinkFn.scope?(childScope=scope.$new(),compile.$$addScopeInfo(jqLite(node),childScope)):childScope=scope,childBoundTranscludeFn=nodeLinkFn.transcludeOnThisElement?createBoundTranscludeFn(scope,nodeLinkFn.transclude,parentBoundTranscludeFn):!nodeLinkFn.templateOnThisElement&&parentBoundTranscludeFn?parentBoundTranscludeFn:!parentBoundTranscludeFn&&transcludeFn?createBoundTranscludeFn(scope,transcludeFn):null,nodeLinkFn(childLinkFn,childScope,node,$rootElement,childBoundTranscludeFn)):childLinkFn&&childLinkFn(scope,node.childNodes,void 0,parentBoundTranscludeFn)}for(var attrs,directives,nodeLinkFn,childNodes,childLinkFn,linkFnFound,nodeLinkFnFound,linkFns=[],i=0;i<nodeList.length;i++)attrs=new Attributes,directives=collectDirectives(nodeList[i],[],attrs,0===i?maxPriority:void 0,ignoreDirective),nodeLinkFn=directives.length?applyDirectivesToNode(directives,nodeList[i],attrs,transcludeFn,$rootElement,null,[],[],previousCompileContext):null,nodeLinkFn&&nodeLinkFn.scope&&compile.$$addScopeClass(attrs.$$element),childLinkFn=nodeLinkFn&&nodeLinkFn.terminal||!(childNodes=nodeList[i].childNodes)||!childNodes.length?null:compileNodes(childNodes,nodeLinkFn?(nodeLinkFn.transcludeOnThisElement||!nodeLinkFn.templateOnThisElement)&&nodeLinkFn.transclude:transcludeFn),(nodeLinkFn||childLinkFn)&&(linkFns.push(i,nodeLinkFn,childLinkFn),linkFnFound=!0,nodeLinkFnFound=nodeLinkFnFound||nodeLinkFn),previousCompileContext=null;return linkFnFound?compositeLinkFn:null}function createBoundTranscludeFn(scope,transcludeFn,previousBoundTranscludeFn){function boundTranscludeFn(transcludedScope,cloneFn,controllers,futureParentElement,containingScope){return transcludedScope||(transcludedScope=scope.$new(!1,containingScope),transcludedScope.$$transcluded=!0),transcludeFn(transcludedScope,cloneFn,{parentBoundTranscludeFn:previousBoundTranscludeFn,transcludeControllers:controllers,futureParentElement:futureParentElement})}var boundSlots=boundTranscludeFn.$$slots=createMap();for(var slotName in transcludeFn.$$slots)transcludeFn.$$slots[slotName]?boundSlots[slotName]=createBoundTranscludeFn(scope,transcludeFn.$$slots[slotName],previousBoundTranscludeFn):boundSlots[slotName]=null;return boundTranscludeFn}function collectDirectives(node,directives,attrs,maxPriority,ignoreDirective){var match,className,nodeType=node.nodeType,attrsMap=attrs.$attr;switch(nodeType){case NODE_TYPE_ELEMENT:addDirective(directives,directiveNormalize(nodeName_(node)),"E",maxPriority,ignoreDirective);for(var attr,name,nName,ngAttrName,value,isNgAttr,nAttrs=node.attributes,j=0,jj=nAttrs&&nAttrs.length;j<jj;j++){var attrStartName=!1,attrEndName=!1;attr=nAttrs[j],name=attr.name,value=trim(attr.value),ngAttrName=directiveNormalize(name),(isNgAttr=NG_ATTR_BINDING.test(ngAttrName))&&(name=name.replace(PREFIX_REGEXP,"").substr(8).replace(/_(.)/g,function(match,letter){return letter.toUpperCase()}));var multiElementMatch=ngAttrName.match(MULTI_ELEMENT_DIR_RE);multiElementMatch&&directiveIsMultiElement(multiElementMatch[1])&&(attrStartName=name,attrEndName=name.substr(0,name.length-5)+"end",name=name.substr(0,name.length-6)),nName=directiveNormalize(name.toLowerCase()),attrsMap[nName]=name,!isNgAttr&&attrs.hasOwnProperty(nName)||(attrs[nName]=value,getBooleanAttrName(node,nName)&&(attrs[nName]=!0)),addAttrInterpolateDirective(node,directives,value,nName,isNgAttr),addDirective(directives,nName,"A",maxPriority,ignoreDirective,attrStartName,attrEndName)}if(className=node.className,isObject(className)&&(className=className.animVal),isString(className)&&""!==className)for(;match=CLASS_DIRECTIVE_REGEXP.exec(className);)nName=directiveNormalize(match[2]),addDirective(directives,nName,"C",maxPriority,ignoreDirective)&&(attrs[nName]=trim(match[3])),className=className.substr(match.index+match[0].length);break;case NODE_TYPE_TEXT:if(11===msie)for(;node.parentNode&&node.nextSibling&&node.nextSibling.nodeType===NODE_TYPE_TEXT;)node.nodeValue=node.nodeValue+node.nextSibling.nodeValue,node.parentNode.removeChild(node.nextSibling);addTextInterpolateDirective(directives,node.nodeValue);break;case NODE_TYPE_COMMENT:try{match=COMMENT_DIRECTIVE_REGEXP.exec(node.nodeValue),match&&(nName=directiveNormalize(match[1]),addDirective(directives,nName,"M",maxPriority,ignoreDirective)&&(attrs[nName]=trim(match[2])))}catch(e){}}return directives.sort(byPriority),directives}function groupScan(node,attrStart,attrEnd){var nodes=[],depth=0;if(attrStart&&node.hasAttribute&&node.hasAttribute(attrStart))do{if(!node)throw $compileMinErr("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",attrStart,attrEnd);node.nodeType==NODE_TYPE_ELEMENT&&(node.hasAttribute(attrStart)&&depth++,node.hasAttribute(attrEnd)&&depth--),nodes.push(node),node=node.nextSibling}while(depth>0);else nodes.push(node);return jqLite(nodes)}function groupElementsLinkFnWrapper(linkFn,attrStart,attrEnd){return function(scope,element,attrs,controllers,transcludeFn){return element=groupScan(element[0],attrStart,attrEnd),linkFn(scope,element,attrs,controllers,transcludeFn)}}function compilationGenerator(eager,$compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext){var compiled;return eager?compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext):function(){return compiled||(compiled=compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext),$compileNodes=transcludeFn=previousCompileContext=null),compiled.apply(this,arguments)}}function applyDirectivesToNode(directives,compileNode,templateAttrs,transcludeFn,jqCollection,originalReplaceDirective,preLinkFns,postLinkFns,previousCompileContext){function addLinkFns(pre,post,attrStart,attrEnd){pre&&(attrStart&&(pre=groupElementsLinkFnWrapper(pre,attrStart,attrEnd)),pre.require=directive.require,pre.directiveName=directiveName,(newIsolateScopeDirective===directive||directive.$$isolateScope)&&(pre=cloneAndAnnotateFn(pre,{isolateScope:!0})),preLinkFns.push(pre)),post&&(attrStart&&(post=groupElementsLinkFnWrapper(post,attrStart,attrEnd)),post.require=directive.require,post.directiveName=directiveName,(newIsolateScopeDirective===directive||directive.$$isolateScope)&&(post=cloneAndAnnotateFn(post,{isolateScope:!0})),postLinkFns.push(post))}function nodeLinkFn(childLinkFn,scope,linkNode,$rootElement,boundTranscludeFn){function controllersBoundTransclude(scope,cloneAttachFn,futureParentElement,slotName){var transcludeControllers;if(isScope(scope)||(slotName=futureParentElement,futureParentElement=cloneAttachFn,cloneAttachFn=scope,scope=void 0),hasElementTranscludeDirective&&(transcludeControllers=elementControllers),futureParentElement||(futureParentElement=hasElementTranscludeDirective?$element.parent():$element),!slotName)return boundTranscludeFn(scope,cloneAttachFn,transcludeControllers,futureParentElement,scopeToChild);var slotTranscludeFn=boundTranscludeFn.$$slots[slotName];if(slotTranscludeFn)return slotTranscludeFn(scope,cloneAttachFn,transcludeControllers,futureParentElement,scopeToChild);if(isUndefined(slotTranscludeFn))throw $compileMinErr("noslot",'No parent directive that requires a transclusion with slot name "{0}". Element: {1}',slotName,startingTag($element))}var i,ii,linkFn,isolateScope,controllerScope,elementControllers,transcludeFn,$element,attrs,scopeBindingInfo;compileNode===linkNode?(attrs=templateAttrs,$element=templateAttrs.$$element):($element=jqLite(linkNode),attrs=new Attributes($element,templateAttrs)),controllerScope=scope,newIsolateScopeDirective?isolateScope=scope.$new(!0):newScopeDirective&&(controllerScope=scope.$parent),boundTranscludeFn&&(transcludeFn=controllersBoundTransclude,transcludeFn.$$boundTransclude=boundTranscludeFn,transcludeFn.isSlotFilled=function(slotName){return!!boundTranscludeFn.$$slots[slotName]}),controllerDirectives&&(elementControllers=setupControllers($element,attrs,transcludeFn,controllerDirectives,isolateScope,scope,newIsolateScopeDirective)),newIsolateScopeDirective&&(compile.$$addScopeInfo($element,isolateScope,!0,!(templateDirective&&(templateDirective===newIsolateScopeDirective||templateDirective===newIsolateScopeDirective.$$originalDirective))),compile.$$addScopeClass($element,!0),isolateScope.$$isolateBindings=newIsolateScopeDirective.$$isolateBindings,scopeBindingInfo=initializeDirectiveBindings(scope,attrs,isolateScope,isolateScope.$$isolateBindings,newIsolateScopeDirective),scopeBindingInfo.removeWatches&&isolateScope.$on("$destroy",scopeBindingInfo.removeWatches));for(var name in elementControllers){var controllerDirective=controllerDirectives[name],controller=elementControllers[name],bindings=controllerDirective.$$bindings.bindToController;controller.identifier&&bindings?controller.bindingInfo=initializeDirectiveBindings(controllerScope,attrs,controller.instance,bindings,controllerDirective):controller.bindingInfo={};var controllerResult=controller();controllerResult!==controller.instance&&(controller.instance=controllerResult,$element.data("$"+controllerDirective.name+"Controller",controllerResult),controller.bindingInfo.removeWatches&&controller.bindingInfo.removeWatches(),controller.bindingInfo=initializeDirectiveBindings(controllerScope,attrs,controller.instance,bindings,controllerDirective))}for(forEach(controllerDirectives,function(controllerDirective,name){var require=controllerDirective.require;controllerDirective.bindToController&&!isArray(require)&&isObject(require)&&extend(elementControllers[name].instance,getControllers(name,require,$element,elementControllers))}),forEach(elementControllers,function(controller){var controllerInstance=controller.instance;isFunction(controllerInstance.$onChanges)&&controllerInstance.$onChanges(controller.bindingInfo.initialChanges),isFunction(controllerInstance.$onInit)&&controllerInstance.$onInit(),isFunction(controllerInstance.$onDestroy)&&controllerScope.$on("$destroy",function(){controllerInstance.$onDestroy()})}),i=0,ii=preLinkFns.length;i<ii;i++)linkFn=preLinkFns[i],invokeLinkFn(linkFn,linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.directiveName,linkFn.require,$element,elementControllers),transcludeFn);var scopeToChild=scope;for(newIsolateScopeDirective&&(newIsolateScopeDirective.template||null===newIsolateScopeDirective.templateUrl)&&(scopeToChild=isolateScope),childLinkFn&&childLinkFn(scopeToChild,linkNode.childNodes,void 0,boundTranscludeFn),i=postLinkFns.length-1;i>=0;i--)linkFn=postLinkFns[i],invokeLinkFn(linkFn,linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.directiveName,linkFn.require,$element,elementControllers),transcludeFn);forEach(elementControllers,function(controller){var controllerInstance=controller.instance;isFunction(controllerInstance.$postLink)&&controllerInstance.$postLink()})}previousCompileContext=previousCompileContext||{};for(var directive,directiveName,$template,linkFn,directiveValue,terminalPriority=-Number.MAX_VALUE,newScopeDirective=previousCompileContext.newScopeDirective,controllerDirectives=previousCompileContext.controllerDirectives,newIsolateScopeDirective=previousCompileContext.newIsolateScopeDirective,templateDirective=previousCompileContext.templateDirective,nonTlbTranscludeDirective=previousCompileContext.nonTlbTranscludeDirective,hasTranscludeDirective=!1,hasTemplate=!1,hasElementTranscludeDirective=previousCompileContext.hasElementTranscludeDirective,$compileNode=templateAttrs.$$element=jqLite(compileNode),replaceDirective=originalReplaceDirective,childTranscludeFn=transcludeFn,didScanForMultipleTransclusion=!1,mightHaveMultipleTransclusionError=!1,i=0,ii=directives.length;i<ii;i++){directive=directives[i];var attrStart=directive.$$start,attrEnd=directive.$$end;if(attrStart&&($compileNode=groupScan(compileNode,attrStart,attrEnd)),$template=void 0,terminalPriority>directive.priority)break;if((directiveValue=directive.scope)&&(directive.templateUrl||(isObject(directiveValue)?(assertNoDuplicate("new/isolated scope",newIsolateScopeDirective||newScopeDirective,directive,$compileNode),newIsolateScopeDirective=directive):assertNoDuplicate("new/isolated scope",newIsolateScopeDirective,directive,$compileNode)),newScopeDirective=newScopeDirective||directive),directiveName=directive.name,!didScanForMultipleTransclusion&&(directive.replace&&(directive.templateUrl||directive.template)||directive.transclude&&!directive.$$tlb)){for(var candidateDirective,scanningIndex=i+1;candidateDirective=directives[scanningIndex++];)if(candidateDirective.transclude&&!candidateDirective.$$tlb||candidateDirective.replace&&(candidateDirective.templateUrl||candidateDirective.template)){mightHaveMultipleTransclusionError=!0;break}didScanForMultipleTransclusion=!0}if(!directive.templateUrl&&directive.controller&&(directiveValue=directive.controller,controllerDirectives=controllerDirectives||createMap(),assertNoDuplicate("'"+directiveName+"' controller",controllerDirectives[directiveName],directive,$compileNode),controllerDirectives[directiveName]=directive),directiveValue=directive.transclude)if(hasTranscludeDirective=!0,directive.$$tlb||(assertNoDuplicate("transclusion",nonTlbTranscludeDirective,directive,$compileNode),nonTlbTranscludeDirective=directive),"element"==directiveValue)hasElementTranscludeDirective=!0,terminalPriority=directive.priority,$template=$compileNode,$compileNode=templateAttrs.$$element=jqLite(compile.$$createComment(directiveName,templateAttrs[directiveName])),compileNode=$compileNode[0],replaceWith(jqCollection,sliceArgs($template),compileNode),$template[0].$$parentNode=$template[0].parentNode,childTranscludeFn=compilationGenerator(mightHaveMultipleTransclusionError,$template,transcludeFn,terminalPriority,replaceDirective&&replaceDirective.name,{nonTlbTranscludeDirective:nonTlbTranscludeDirective});else{var slots=createMap();if($template=jqLite(jqLiteClone(compileNode)).contents(),isObject(directiveValue)){$template=[];var slotMap=createMap(),filledSlots=createMap();forEach(directiveValue,function(elementSelector,slotName){var optional="?"===elementSelector.charAt(0);elementSelector=optional?elementSelector.substring(1):elementSelector,slotMap[elementSelector]=slotName,slots[slotName]=null,filledSlots[slotName]=optional}),forEach($compileNode.contents(),function(node){var slotName=slotMap[directiveNormalize(nodeName_(node))];slotName?(filledSlots[slotName]=!0,slots[slotName]=slots[slotName]||[],slots[slotName].push(node)):$template.push(node)}),forEach(filledSlots,function(filled,slotName){if(!filled)throw $compileMinErr("reqslot","Required transclusion slot `{0}` was not filled.",slotName)});for(var slotName in slots)slots[slotName]&&(slots[slotName]=compilationGenerator(mightHaveMultipleTransclusionError,slots[slotName],transcludeFn))}$compileNode.empty(),childTranscludeFn=compilationGenerator(mightHaveMultipleTransclusionError,$template,transcludeFn,void 0,void 0,{needsNewScope:directive.$$isolateScope||directive.$$newScope}),childTranscludeFn.$$slots=slots}if(directive.template)if(hasTemplate=!0,assertNoDuplicate("template",templateDirective,directive,$compileNode),templateDirective=directive,directiveValue=isFunction(directive.template)?directive.template($compileNode,templateAttrs):directive.template,directiveValue=denormalizeTemplate(directiveValue),directive.replace){if(replaceDirective=directive,$template=jqLiteIsTextNode(directiveValue)?[]:removeComments(wrapTemplate(directive.templateNamespace,trim(directiveValue))),compileNode=$template[0],1!=$template.length||compileNode.nodeType!==NODE_TYPE_ELEMENT)throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",directiveName,"");replaceWith(jqCollection,$compileNode,compileNode);var newTemplateAttrs={$attr:{}},templateDirectives=collectDirectives(compileNode,[],newTemplateAttrs),unprocessedDirectives=directives.splice(i+1,directives.length-(i+1));(newIsolateScopeDirective||newScopeDirective)&&markDirectiveScope(templateDirectives,newIsolateScopeDirective,newScopeDirective),directives=directives.concat(templateDirectives).concat(unprocessedDirectives),mergeTemplateAttributes(templateAttrs,newTemplateAttrs),ii=directives.length}else $compileNode.html(directiveValue);if(directive.templateUrl)hasTemplate=!0,assertNoDuplicate("template",templateDirective,directive,$compileNode),templateDirective=directive,directive.replace&&(replaceDirective=directive),nodeLinkFn=compileTemplateUrl(directives.splice(i,directives.length-i),$compileNode,templateAttrs,jqCollection,hasTranscludeDirective&&childTranscludeFn,preLinkFns,postLinkFns,{controllerDirectives:controllerDirectives,newScopeDirective:newScopeDirective!==directive&&newScopeDirective,newIsolateScopeDirective:newIsolateScopeDirective,templateDirective:templateDirective,nonTlbTranscludeDirective:nonTlbTranscludeDirective}),ii=directives.length;else if(directive.compile)try{linkFn=directive.compile($compileNode,templateAttrs,childTranscludeFn),isFunction(linkFn)?addLinkFns(null,linkFn,attrStart,attrEnd):linkFn&&addLinkFns(linkFn.pre,linkFn.post,attrStart,attrEnd)}catch(e){$exceptionHandler(e,startingTag($compileNode))}directive.terminal&&(nodeLinkFn.terminal=!0,terminalPriority=Math.max(terminalPriority,directive.priority))}return nodeLinkFn.scope=newScopeDirective&&!0===newScopeDirective.scope,nodeLinkFn.transcludeOnThisElement=hasTranscludeDirective,nodeLinkFn.templateOnThisElement=hasTemplate,nodeLinkFn.transclude=childTranscludeFn,previousCompileContext.hasElementTranscludeDirective=hasElementTranscludeDirective,nodeLinkFn}function getControllers(directiveName,require,$element,elementControllers){var value;if(isString(require)){var match=require.match(REQUIRE_PREFIX_REGEXP),name=require.substring(match[0].length),inheritType=match[1]||match[3],optional="?"===match[2];if("^^"===inheritType?$element=$element.parent():(value=elementControllers&&elementControllers[name],value=value&&value.instance),!value){var dataName="$"+name+"Controller";value=inheritType?$element.inheritedData(dataName):$element.data(dataName)}if(!value&&!optional)throw $compileMinErr("ctreq","Controller '{0}', required by directive '{1}', can't be found!",name,directiveName)}else if(isArray(require)){value=[];for(var i=0,ii=require.length;i<ii;i++)value[i]=getControllers(directiveName,require[i],$element,elementControllers)}else isObject(require)&&(value={},forEach(require,function(controller,property){value[property]=getControllers(directiveName,controller,$element,elementControllers)}));return value||null}function setupControllers($element,attrs,transcludeFn,controllerDirectives,isolateScope,scope,newIsolateScopeDirective){var elementControllers=createMap();for(var controllerKey in controllerDirectives){var directive=controllerDirectives[controllerKey],locals={$scope:directive===newIsolateScopeDirective||directive.$$isolateScope?isolateScope:scope,$element:$element,$attrs:attrs,$transclude:transcludeFn},controller=directive.controller;"@"==controller&&(controller=attrs[directive.name]);var controllerInstance=$controller(controller,locals,!0,directive.controllerAs);elementControllers[directive.name]=controllerInstance,$element.data("$"+directive.name+"Controller",controllerInstance.instance)}return elementControllers}function markDirectiveScope(directives,isolateScope,newScope){for(var j=0,jj=directives.length;j<jj;j++)directives[j]=inherit(directives[j],{$$isolateScope:isolateScope,$$newScope:newScope})}function addDirective(tDirectives,name,location,maxPriority,ignoreDirective,startAttrName,endAttrName){if(name===ignoreDirective)return null;var match=null;if(hasDirectives.hasOwnProperty(name))for(var directive,directives=$injector.get(name+Suffix),i=0,ii=directives.length;i<ii;i++)try{if(directive=directives[i],(isUndefined(maxPriority)||maxPriority>directive.priority)&&-1!=directive.restrict.indexOf(location)){if(startAttrName&&(directive=inherit(directive,{$$start:startAttrName,$$end:endAttrName})),!directive.$$bindings){var bindings=directive.$$bindings=parseDirectiveBindings(directive,directive.name);isObject(bindings.isolateScope)&&(directive.$$isolateBindings=bindings.isolateScope)}tDirectives.push(directive),match=directive}}catch(e){$exceptionHandler(e)}return match}function directiveIsMultiElement(name){if(hasDirectives.hasOwnProperty(name))for(var directive,directives=$injector.get(name+Suffix),i=0,ii=directives.length;i<ii;i++)if(directive=directives[i],directive.multiElement)return!0;return!1}function mergeTemplateAttributes(dst,src){var srcAttr=src.$attr,dstAttr=dst.$attr,$element=dst.$$element;forEach(dst,function(value,key){"$"!=key.charAt(0)&&(src[key]&&src[key]!==value&&(value+=("style"===key?";":" ")+src[key]),dst.$set(key,value,!0,srcAttr[key]))}),forEach(src,function(value,key){"class"==key?(safeAddClass($element,value),dst.class=(dst.class?dst.class+" ":"")+value):"style"==key?($element.attr("style",$element.attr("style")+";"+value),dst.style=(dst.style?dst.style+";":"")+value):"$"==key.charAt(0)||dst.hasOwnProperty(key)||(dst[key]=value,dstAttr[key]=srcAttr[key])})}function compileTemplateUrl(directives,$compileNode,tAttrs,$rootElement,childTranscludeFn,preLinkFns,postLinkFns,previousCompileContext){var afterTemplateNodeLinkFn,afterTemplateChildLinkFn,linkQueue=[],beforeTemplateCompileNode=$compileNode[0],origAsyncDirective=directives.shift(),derivedSyncDirective=inherit(origAsyncDirective,{templateUrl:null,transclude:null,replace:null,$$originalDirective:origAsyncDirective}),templateUrl=isFunction(origAsyncDirective.templateUrl)?origAsyncDirective.templateUrl($compileNode,tAttrs):origAsyncDirective.templateUrl,templateNamespace=origAsyncDirective.templateNamespace;return $compileNode.empty(),$templateRequest(templateUrl).then(function(content){var compileNode,tempTemplateAttrs,$template,childBoundTranscludeFn;if(content=denormalizeTemplate(content),origAsyncDirective.replace){if($template=jqLiteIsTextNode(content)?[]:removeComments(wrapTemplate(templateNamespace,trim(content))),compileNode=$template[0],1!=$template.length||compileNode.nodeType!==NODE_TYPE_ELEMENT)throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",origAsyncDirective.name,templateUrl);tempTemplateAttrs={$attr:{}},replaceWith($rootElement,$compileNode,compileNode);var templateDirectives=collectDirectives(compileNode,[],tempTemplateAttrs);isObject(origAsyncDirective.scope)&&markDirectiveScope(templateDirectives,!0),directives=templateDirectives.concat(directives),mergeTemplateAttributes(tAttrs,tempTemplateAttrs)}else compileNode=beforeTemplateCompileNode,$compileNode.html(content);for(directives.unshift(derivedSyncDirective),afterTemplateNodeLinkFn=applyDirectivesToNode(directives,compileNode,tAttrs,childTranscludeFn,$compileNode,origAsyncDirective,preLinkFns,postLinkFns,previousCompileContext),forEach($rootElement,function(node,i){node==compileNode&&($rootElement[i]=$compileNode[0])}),afterTemplateChildLinkFn=compileNodes($compileNode[0].childNodes,childTranscludeFn);linkQueue.length;){var scope=linkQueue.shift(),beforeTemplateLinkNode=linkQueue.shift(),linkRootElement=linkQueue.shift(),boundTranscludeFn=linkQueue.shift(),linkNode=$compileNode[0];if(!scope.$$destroyed){if(beforeTemplateLinkNode!==beforeTemplateCompileNode){var oldClasses=beforeTemplateLinkNode.className;previousCompileContext.hasElementTranscludeDirective&&origAsyncDirective.replace||(linkNode=jqLiteClone(compileNode)),replaceWith(linkRootElement,jqLite(beforeTemplateLinkNode),linkNode),safeAddClass(jqLite(linkNode),oldClasses)}childBoundTranscludeFn=afterTemplateNodeLinkFn.transcludeOnThisElement?createBoundTranscludeFn(scope,afterTemplateNodeLinkFn.transclude,boundTranscludeFn):boundTranscludeFn,afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,linkNode,$rootElement,childBoundTranscludeFn)}}linkQueue=null}),function(ignoreChildLinkFn,scope,node,rootElement,boundTranscludeFn){var childBoundTranscludeFn=boundTranscludeFn;scope.$$destroyed||(linkQueue?linkQueue.push(scope,node,rootElement,childBoundTranscludeFn):(afterTemplateNodeLinkFn.transcludeOnThisElement&&(childBoundTranscludeFn=createBoundTranscludeFn(scope,afterTemplateNodeLinkFn.transclude,boundTranscludeFn)),afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,node,rootElement,childBoundTranscludeFn)))}}function byPriority(a,b){var diff=b.priority-a.priority;return 0!==diff?diff:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function assertNoDuplicate(what,previousDirective,directive,element){function wrapModuleNameIfDefined(moduleName){return moduleName?" (module: "+moduleName+")":""}if(previousDirective)throw $compileMinErr("multidir","Multiple directives [{0}{1}, {2}{3}] asking for {4} on: {5}",previousDirective.name,wrapModuleNameIfDefined(previousDirective.$$moduleName),directive.name,wrapModuleNameIfDefined(directive.$$moduleName),what,startingTag(element))}function addTextInterpolateDirective(directives,text){var interpolateFn=$interpolate(text,!0);interpolateFn&&directives.push({priority:0,compile:function(templateNode){var templateNodeParent=templateNode.parent(),hasCompileParent=!!templateNodeParent.length;return hasCompileParent&&compile.$$addBindingClass(templateNodeParent),function(scope,node){var parent=node.parent();hasCompileParent||compile.$$addBindingClass(parent),compile.$$addBindingInfo(parent,interpolateFn.expressions),scope.$watch(interpolateFn,function(value){node[0].nodeValue=value})}}})}function wrapTemplate(type,template){switch(type=lowercase(type||"html")){case"svg":case"math":var wrapper=window.document.createElement("div");return wrapper.innerHTML="<"+type+">"+template+"</"+type+">",wrapper.childNodes[0].childNodes;default:return template}}function getTrustedContext(node,attrNormalizedName){if("srcdoc"==attrNormalizedName)return $sce.HTML;var tag=nodeName_(node);return"xlinkHref"==attrNormalizedName||"form"==tag&&"action"==attrNormalizedName||"img"!=tag&&("src"==attrNormalizedName||"ngSrc"==attrNormalizedName)?$sce.RESOURCE_URL:void 0}function addAttrInterpolateDirective(node,directives,value,name,allOrNothing){var trustedContext=getTrustedContext(node,name);allOrNothing=ALL_OR_NOTHING_ATTRS[name]||allOrNothing;var interpolateFn=$interpolate(value,!0,trustedContext,allOrNothing);if(interpolateFn){if("multiple"===name&&"select"===nodeName_(node))throw $compileMinErr("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",startingTag(node));directives.push({priority:100,compile:function(){return{pre:function(scope,element,attr){var $$observers=attr.$$observers||(attr.$$observers=createMap());if(EVENT_HANDLER_ATTR_REGEXP.test(name))throw $compileMinErr("nodomevents","Interpolations for HTML DOM event attributes are disallowed.  Please use the ng- versions (such as ng-click instead of onclick) instead.");var newValue=attr[name];newValue!==value&&(interpolateFn=newValue&&$interpolate(newValue,!0,trustedContext,allOrNothing),value=newValue),interpolateFn&&(attr[name]=interpolateFn(scope),($$observers[name]||($$observers[name]=[])).$$inter=!0,(attr.$$observers&&attr.$$observers[name].$$scope||scope).$watch(interpolateFn,function(newValue,oldValue){"class"===name&&newValue!=oldValue?attr.$updateClass(newValue,oldValue):attr.$set(name,newValue)}))}}}})}}function replaceWith($rootElement,elementsToRemove,newNode){var i,ii,firstElementToRemove=elementsToRemove[0],removeCount=elementsToRemove.length,parent=firstElementToRemove.parentNode;if($rootElement)for(i=0,ii=$rootElement.length;i<ii;i++)if($rootElement[i]==firstElementToRemove){$rootElement[i++]=newNode;for(var j=i,j2=j+removeCount-1,jj=$rootElement.length;j<jj;j++,j2++)j2<jj?$rootElement[j]=$rootElement[j2]:delete $rootElement[j];$rootElement.length-=removeCount-1,$rootElement.context===firstElementToRemove&&($rootElement.context=newNode);break}parent&&parent.replaceChild(newNode,firstElementToRemove);var fragment=window.document.createDocumentFragment();for(i=0;i<removeCount;i++)fragment.appendChild(elementsToRemove[i]);for(jqLite.hasData(firstElementToRemove)&&(jqLite.data(newNode,jqLite.data(firstElementToRemove)),jqLite(firstElementToRemove).off("$destroy")),jqLite.cleanData(fragment.querySelectorAll("*")),i=1;i<removeCount;i++)delete elementsToRemove[i];elementsToRemove[0]=newNode,elementsToRemove.length=1}function cloneAndAnnotateFn(fn,annotation){return extend(function(){return fn.apply(null,arguments)},fn,annotation)}function invokeLinkFn(linkFn,scope,$element,attrs,controllers,transcludeFn){try{linkFn(scope,$element,attrs,controllers,transcludeFn)}catch(e){$exceptionHandler(e,startingTag($element))}}function initializeDirectiveBindings(scope,attrs,destination,bindings,directive){function recordChanges(key,currentValue,previousValue){isFunction(destination.$onChanges)&&currentValue!==previousValue&&(onChangesQueue||(scope.$$postDigest(flushOnChangesQueue),onChangesQueue=[]),changes||(changes={},onChangesQueue.push(triggerOnChangesHook)),changes[key]&&(previousValue=changes[key].previousValue),changes[key]=new SimpleChange(previousValue,currentValue))}function triggerOnChangesHook(){destination.$onChanges(changes),changes=void 0}var changes,removeWatchCollection=[],initialChanges={};return forEach(bindings,function(definition,scopeName){var lastValue,parentGet,parentSet,compare,removeWatch,attrName=definition.attrName,optional=definition.optional,mode=definition.mode;switch(mode){case"@":optional||hasOwnProperty.call(attrs,attrName)||(destination[scopeName]=attrs[attrName]=void 0),attrs.$observe(attrName,function(value){if(isString(value)||isBoolean(value)){var oldValue=destination[scopeName];recordChanges(scopeName,value,oldValue),destination[scopeName]=value}}),attrs.$$observers[attrName].$$scope=scope,lastValue=attrs[attrName],isString(lastValue)?destination[scopeName]=$interpolate(lastValue)(scope):isBoolean(lastValue)&&(destination[scopeName]=lastValue),initialChanges[scopeName]=new SimpleChange(_UNINITIALIZED_VALUE,destination[scopeName]);break;case"=":if(!hasOwnProperty.call(attrs,attrName)){if(optional)break;attrs[attrName]=void 0}if(optional&&!attrs[attrName])break;parentGet=$parse(attrs[attrName]),compare=parentGet.literal?equals:function(a,b){return a===b||a!==a&&b!==b},parentSet=parentGet.assign||function(){throw lastValue=destination[scopeName]=parentGet(scope),$compileMinErr("nonassign","Expression '{0}' in attribute '{1}' used with directive '{2}' is non-assignable!",attrs[attrName],attrName,directive.name)},lastValue=destination[scopeName]=parentGet(scope);var parentValueWatch=function(parentValue){return compare(parentValue,destination[scopeName])||(compare(parentValue,lastValue)?parentSet(scope,parentValue=destination[scopeName]):destination[scopeName]=parentValue),lastValue=parentValue};parentValueWatch.$stateful=!0,removeWatch=definition.collection?scope.$watchCollection(attrs[attrName],parentValueWatch):scope.$watch($parse(attrs[attrName],parentValueWatch),null,parentGet.literal),removeWatchCollection.push(removeWatch);break;case"<":if(!hasOwnProperty.call(attrs,attrName)){if(optional)break;attrs[attrName]=void 0}if(optional&&!attrs[attrName])break;parentGet=$parse(attrs[attrName]),destination[scopeName]=parentGet(scope),initialChanges[scopeName]=new SimpleChange(_UNINITIALIZED_VALUE,destination[scopeName]),removeWatch=scope.$watch(parentGet,function(newValue,oldValue){newValue===oldValue&&(oldValue=destination[scopeName]),recordChanges(scopeName,newValue,oldValue),destination[scopeName]=newValue},parentGet.literal),removeWatchCollection.push(removeWatch);break;case"&":if((parentGet=attrs.hasOwnProperty(attrName)?$parse(attrs[attrName]):noop)===noop&&optional)break;destination[scopeName]=function(locals){return parentGet(scope,locals)}}}),{initialChanges:initialChanges,removeWatches:removeWatchCollection.length&&function(){for(var i=0,ii=removeWatchCollection.length;i<ii;++i)removeWatchCollection[i]()}}}var onChangesQueue,SIMPLE_ATTR_NAME=/^\w/,specialAttrHolder=window.document.createElement("div"),onChangesTtl=TTL;Attributes.prototype={$normalize:directiveNormalize,$addClass:function(classVal){classVal&&classVal.length>0&&$animate.addClass(this.$$element,classVal)},$removeClass:function(classVal){classVal&&classVal.length>0&&$animate.removeClass(this.$$element,classVal)},$updateClass:function(newClasses,oldClasses){var toAdd=tokenDifference(newClasses,oldClasses);toAdd&&toAdd.length&&$animate.addClass(this.$$element,toAdd);var toRemove=tokenDifference(oldClasses,newClasses);toRemove&&toRemove.length&&$animate.removeClass(this.$$element,toRemove)},$set:function(key,value,writeAttr,attrName){var nodeName,node=this.$$element[0],booleanKey=getBooleanAttrName(node,key),aliasedKey=getAliasedAttrName(key),observer=key;if(booleanKey?(this.$$element.prop(key,value),attrName=booleanKey):aliasedKey&&(this[aliasedKey]=value,observer=aliasedKey),this[key]=value,attrName?this.$attr[key]=attrName:(attrName=this.$attr[key])||(this.$attr[key]=attrName=snake_case(key,"-")),"a"===(nodeName=nodeName_(this.$$element))&&("href"===key||"xlinkHref"===key)||"img"===nodeName&&"src"===key)this[key]=value=$$sanitizeUri(value,"src"===key);else if("img"===nodeName&&"srcset"===key){for(var result="",trimmedSrcset=trim(value),srcPattern=/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/,pattern=/\s/.test(trimmedSrcset)?srcPattern:/(,)/,rawUris=trimmedSrcset.split(pattern),nbrUrisWith2parts=Math.floor(rawUris.length/2),i=0;i<nbrUrisWith2parts;i++){var innerIdx=2*i;result+=$$sanitizeUri(trim(rawUris[innerIdx]),!0),result+=" "+trim(rawUris[innerIdx+1])}var lastTuple=trim(rawUris[2*i]).split(/\s/);result+=$$sanitizeUri(trim(lastTuple[0]),!0),2===lastTuple.length&&(result+=" "+trim(lastTuple[1])),this[key]=value=result}!1!==writeAttr&&(null===value||isUndefined(value)?this.$$element.removeAttr(attrName):SIMPLE_ATTR_NAME.test(attrName)?this.$$element.attr(attrName,value):setSpecialAttr(this.$$element[0],attrName,value));var $$observers=this.$$observers;$$observers&&forEach($$observers[observer],function(fn){try{fn(value)}catch(e){$exceptionHandler(e)}})},$observe:function(key,fn){var attrs=this,$$observers=attrs.$$observers||(attrs.$$observers=createMap()),listeners=$$observers[key]||($$observers[key]=[]);return listeners.push(fn),$rootScope.$evalAsync(function(){listeners.$$inter||!attrs.hasOwnProperty(key)||isUndefined(attrs[key])||fn(attrs[key])}),function(){arrayRemove(listeners,fn)}}};var startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),denormalizeTemplate="{{"==startSymbol&&"}}"==endSymbol?identity:function(template){return template.replace(/\{\{/g,startSymbol).replace(/}}/g,endSymbol)},NG_ATTR_BINDING=/^ngAttr[A-Z]/,MULTI_ELEMENT_DIR_RE=/^(.+)Start$/;return compile.$$addBindingInfo=debugInfoEnabled?function($element,binding){var bindings=$element.data("$binding")||[];isArray(binding)?bindings=bindings.concat(binding):bindings.push(binding),$element.data("$binding",bindings)}:noop,compile.$$addBindingClass=debugInfoEnabled?function($element){safeAddClass($element,"ng-binding")}:noop,compile.$$addScopeInfo=debugInfoEnabled?function($element,scope,isolated,noTemplate){var dataName=isolated?noTemplate?"$isolateScopeNoTemplate":"$isolateScope":"$scope";$element.data(dataName,scope)}:noop,compile.$$addScopeClass=debugInfoEnabled?function($element,isolated){safeAddClass($element,isolated?"ng-isolate-scope":"ng-scope")}:noop,compile.$$createComment=function(directiveName,comment){var content="";return debugInfoEnabled&&(content=" "+(directiveName||"")+": "+(comment||"")+" "),window.document.createComment(content)},compile}]}function SimpleChange(previous,current){this.previousValue=previous,this.currentValue=current}function directiveNormalize(name){return camelCase(name.replace(PREFIX_REGEXP,""))}function tokenDifference(str1,str2){var values="",tokens1=str1.split(/\s+/),tokens2=str2.split(/\s+/);outer:for(var i=0;i<tokens1.length;i++){for(var token=tokens1[i],j=0;j<tokens2.length;j++)if(token==tokens2[j])continue outer;values+=(values.length>0?" ":"")+token}return values}function removeComments(jqNodes){jqNodes=jqLite(jqNodes);var i=jqNodes.length;if(i<=1)return jqNodes;for(;i--;){jqNodes[i].nodeType===NODE_TYPE_COMMENT&&splice.call(jqNodes,i,1)}return jqNodes}function identifierForController(controller,ident){if(ident&&isString(ident))return ident;if(isString(controller)){var match=CNTRL_REG.exec(controller);if(match)return match[3]}}function $ControllerProvider(){var controllers={},globals=!1;this.has=function(name){return controllers.hasOwnProperty(name)},this.register=function(name,constructor){assertNotHasOwnProperty(name,"controller"),isObject(name)?extend(controllers,name):controllers[name]=constructor},this.allowGlobals=function(){globals=!0},this.$get=["$injector","$window",function($injector,$window){function addIdentifier(locals,identifier,instance,name){if(!locals||!isObject(locals.$scope))throw minErr("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",name,identifier);locals.$scope[identifier]=instance}return function(expression,locals,later,ident){var instance,match,constructor,identifier;if(later=!0===later,ident&&isString(ident)&&(identifier=ident),isString(expression)){if(!(match=expression.match(CNTRL_REG)))throw $controllerMinErr("ctrlfmt","Badly formed controller string '{0}'. Must match `__name__ as __id__` or `__name__`.",expression);constructor=match[1],identifier=identifier||match[3],expression=controllers.hasOwnProperty(constructor)?controllers[constructor]:getter(locals.$scope,constructor,!0)||(globals?getter($window,constructor,!0):void 0),assertArgFn(expression,constructor,!0)}if(later){var controllerPrototype=(isArray(expression)?expression[expression.length-1]:expression).prototype;instance=Object.create(controllerPrototype||null),identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name);return extend(function(){var result=$injector.invoke(expression,instance,locals,constructor);return result!==instance&&(isObject(result)||isFunction(result))&&(instance=result,identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name)),instance},{instance:instance,identifier:identifier})}return instance=$injector.instantiate(expression,locals,constructor),identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name),instance}}]}function $DocumentProvider(){this.$get=["$window",function(window){return jqLite(window.document)}]}function $ExceptionHandlerProvider(){this.$get=["$log",function($log){return function(exception,cause){$log.error.apply($log,arguments)}}]}function serializeValue(v){return isObject(v)?isDate(v)?v.toISOString():toJson(v):v}function $HttpParamSerializerProvider(){this.$get=function(){return function(params){if(!params)return"";var parts=[];return forEachSorted(params,function(value,key){null===value||isUndefined(value)||(isArray(value)?forEach(value,function(v){parts.push(encodeUriQuery(key)+"="+encodeUriQuery(serializeValue(v)))}):parts.push(encodeUriQuery(key)+"="+encodeUriQuery(serializeValue(value))))}),parts.join("&")}}}function $HttpParamSerializerJQLikeProvider(){this.$get=function(){return function(params){function serialize(toSerialize,prefix,topLevel){null===toSerialize||isUndefined(toSerialize)||(isArray(toSerialize)?forEach(toSerialize,function(value,index){serialize(value,prefix+"["+(isObject(value)?index:"")+"]")}):isObject(toSerialize)&&!isDate(toSerialize)?forEachSorted(toSerialize,function(value,key){serialize(value,prefix+(topLevel?"":"[")+key+(topLevel?"":"]"))}):parts.push(encodeUriQuery(prefix)+"="+encodeUriQuery(serializeValue(toSerialize))))}if(!params)return"";var parts=[];return serialize(params,"",!0),parts.join("&")}}}function defaultHttpResponseTransform(data,headers){if(isString(data)){var tempData=data.replace(JSON_PROTECTION_PREFIX,"").trim();if(tempData){var contentType=headers("Content-Type");(contentType&&0===contentType.indexOf(APPLICATION_JSON)||isJsonLike(tempData))&&(data=fromJson(tempData))}}return data}function isJsonLike(str){var jsonStart=str.match(JSON_START);return jsonStart&&JSON_ENDS[jsonStart[0]].test(str)}function parseHeaders(headers){function fillInParsed(key,val){key&&(parsed[key]=parsed[key]?parsed[key]+", "+val:val)}var i,parsed=createMap();return isString(headers)?forEach(headers.split("\n"),function(line){i=line.indexOf(":"),fillInParsed(lowercase(trim(line.substr(0,i))),trim(line.substr(i+1)))}):isObject(headers)&&forEach(headers,function(headerVal,headerKey){fillInParsed(lowercase(headerKey),trim(headerVal))}),parsed}function headersGetter(headers){var headersObj;return function(name){if(headersObj||(headersObj=parseHeaders(headers)),name){var value=headersObj[lowercase(name)];return void 0===value&&(value=null),value}return headersObj}}function transformData(data,headers,status,fns){return isFunction(fns)?fns(data,headers,status):(forEach(fns,function(fn){data=fn(data,headers,status)}),data)}function isSuccess(status){return 200<=status&&status<300}function $HttpProvider(){var defaults=this.defaults={transformResponse:[defaultHttpResponseTransform],transformRequest:[function(d){return!isObject(d)||isFile(d)||isBlob(d)||isFormData(d)?d:toJson(d)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:shallowCopy(CONTENT_TYPE_APPLICATION_JSON),put:shallowCopy(CONTENT_TYPE_APPLICATION_JSON),patch:shallowCopy(CONTENT_TYPE_APPLICATION_JSON)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",paramSerializer:"$httpParamSerializer"},useApplyAsync=!1;this.useApplyAsync=function(value){return isDefined(value)?(useApplyAsync=!!value,this):useApplyAsync};var useLegacyPromise=!0;this.useLegacyPromiseExtensions=function(value){return isDefined(value)?(useLegacyPromise=!!value,this):useLegacyPromise};var interceptorFactories=this.interceptors=[];this.$get=["$httpBackend","$$cookieReader","$cacheFactory","$rootScope","$q","$injector",function($httpBackend,$$cookieReader,$cacheFactory,$rootScope,$q,$injector){function $http(requestConfig){function transformResponse(response){var resp=extend({},response);return resp.data=transformData(response.data,response.headers,response.status,config.transformResponse),isSuccess(response.status)?resp:$q.reject(resp)}function executeHeaderFns(headers,config){var headerContent,processedHeaders={};return forEach(headers,function(headerFn,header){isFunction(headerFn)?null!=(headerContent=headerFn(config))&&(processedHeaders[header]=headerContent):processedHeaders[header]=headerFn}),processedHeaders}if(!isObject(requestConfig))throw minErr("$http")("badreq","Http request configuration must be an object.  Received: {0}",requestConfig);if(!isString(requestConfig.url))throw minErr("$http")("badreq","Http request configuration url must be a string.  Received: {0}",requestConfig.url);var config=extend({method:"get",transformRequest:defaults.transformRequest,transformResponse:defaults.transformResponse,paramSerializer:defaults.paramSerializer},requestConfig);config.headers=function(config){var defHeaderName,lowercaseDefHeaderName,reqHeaderName,defHeaders=defaults.headers,reqHeaders=extend({},config.headers);defHeaders=extend({},defHeaders.common,defHeaders[lowercase(config.method)]);defaultHeadersIteration:for(defHeaderName in defHeaders){lowercaseDefHeaderName=lowercase(defHeaderName);for(reqHeaderName in reqHeaders)if(lowercase(reqHeaderName)===lowercaseDefHeaderName)continue defaultHeadersIteration;reqHeaders[defHeaderName]=defHeaders[defHeaderName]}return executeHeaderFns(reqHeaders,shallowCopy(config))}(requestConfig),config.method=uppercase(config.method),config.paramSerializer=isString(config.paramSerializer)?$injector.get(config.paramSerializer):config.paramSerializer;var serverRequest=function(config){var headers=config.headers,reqData=transformData(config.data,headersGetter(headers),void 0,config.transformRequest);return isUndefined(reqData)&&forEach(headers,function(value,header){"content-type"===lowercase(header)&&delete headers[header]}),isUndefined(config.withCredentials)&&!isUndefined(defaults.withCredentials)&&(config.withCredentials=defaults.withCredentials),sendReq(config,reqData).then(transformResponse,transformResponse)},chain=[serverRequest,void 0],promise=$q.when(config);for(forEach(reversedInterceptors,function(interceptor){(interceptor.request||interceptor.requestError)&&chain.unshift(interceptor.request,interceptor.requestError),(interceptor.response||interceptor.responseError)&&chain.push(interceptor.response,interceptor.responseError)});chain.length;){var thenFn=chain.shift(),rejectFn=chain.shift();promise=promise.then(thenFn,rejectFn)}return useLegacyPromise?(promise.success=function(fn){return assertArgFn(fn,"fn"),promise.then(function(response){fn(response.data,response.status,response.headers,config)}),promise},promise.error=function(fn){return assertArgFn(fn,"fn"),promise.then(null,function(response){fn(response.data,response.status,response.headers,config)}),promise}):(promise.success=$httpMinErrLegacyFn("success"),promise.error=$httpMinErrLegacyFn("error")),promise}function sendReq(config,reqData){function createApplyHandlers(eventHandlers){if(eventHandlers){var applyHandlers={};return forEach(eventHandlers,function(eventHandler,key){applyHandlers[key]=function(event){function callEventHandler(){eventHandler(event)}useApplyAsync?$rootScope.$applyAsync(callEventHandler):$rootScope.$$phase?callEventHandler():$rootScope.$apply(callEventHandler)}}),applyHandlers}}function done(status,response,headersString,statusText){function resolveHttpPromise(){resolvePromise(response,status,headersString,statusText)}cache&&(isSuccess(status)?cache.put(url,[status,response,parseHeaders(headersString),statusText]):cache.remove(url)),useApplyAsync?$rootScope.$applyAsync(resolveHttpPromise):(resolveHttpPromise(),$rootScope.$$phase||$rootScope.$apply())}function resolvePromise(response,status,headers,statusText){status=status>=-1?status:0,(isSuccess(status)?deferred.resolve:deferred.reject)({data:response,status:status,headers:headersGetter(headers),config:config,statusText:statusText})}function resolvePromiseWithResult(result){resolvePromise(result.data,result.status,shallowCopy(result.headers()),result.statusText)}function removePendingReq(){var idx=$http.pendingRequests.indexOf(config);-1!==idx&&$http.pendingRequests.splice(idx,1)}var cache,cachedResp,deferred=$q.defer(),promise=deferred.promise,reqHeaders=config.headers,url=buildUrl(config.url,config.paramSerializer(config.params));if($http.pendingRequests.push(config),promise.then(removePendingReq,removePendingReq),!config.cache&&!defaults.cache||!1===config.cache||"GET"!==config.method&&"JSONP"!==config.method||(cache=isObject(config.cache)?config.cache:isObject(defaults.cache)?defaults.cache:defaultCache),cache&&(cachedResp=cache.get(url),isDefined(cachedResp)?isPromiseLike(cachedResp)?cachedResp.then(resolvePromiseWithResult,resolvePromiseWithResult):isArray(cachedResp)?resolvePromise(cachedResp[1],cachedResp[0],shallowCopy(cachedResp[2]),cachedResp[3]):resolvePromise(cachedResp,200,{},"OK"):cache.put(url,promise)),isUndefined(cachedResp)){var xsrfValue=urlIsSameOrigin(config.url)?$$cookieReader()[config.xsrfCookieName||defaults.xsrfCookieName]:void 0;xsrfValue&&(reqHeaders[config.xsrfHeaderName||defaults.xsrfHeaderName]=xsrfValue),$httpBackend(config.method,url,reqData,done,reqHeaders,config.timeout,config.withCredentials,config.responseType,createApplyHandlers(config.eventHandlers),createApplyHandlers(config.uploadEventHandlers))}return promise}function buildUrl(url,serializedParams){return serializedParams.length>0&&(url+=(-1==url.indexOf("?")?"?":"&")+serializedParams),url}var defaultCache=$cacheFactory("$http");defaults.paramSerializer=isString(defaults.paramSerializer)?$injector.get(defaults.paramSerializer):defaults.paramSerializer;var reversedInterceptors=[];return forEach(interceptorFactories,function(interceptorFactory){reversedInterceptors.unshift(isString(interceptorFactory)?$injector.get(interceptorFactory):$injector.invoke(interceptorFactory))}),$http.pendingRequests=[],function(names){forEach(arguments,function(name){$http[name]=function(url,config){return $http(extend({},config||{},{method:name,url:url}))}})}("get","delete","head","jsonp"),function(name){forEach(arguments,function(name){$http[name]=function(url,data,config){return $http(extend({},config||{},{method:name,url:url,data:data}))}})}("post","put","patch"),$http.defaults=defaults,$http}]}function $xhrFactoryProvider(){this.$get=function(){return function(){return new window.XMLHttpRequest}}}function $HttpBackendProvider(){this.$get=["$browser","$window","$document","$xhrFactory",function($browser,$window,$document,$xhrFactory){return createHttpBackend($browser,$xhrFactory,$browser.defer,$window.angular.callbacks,$document[0])}]}function createHttpBackend($browser,createXhr,$browserDefer,callbacks,rawDocument){function jsonpReq(url,callbackId,done){var script=rawDocument.createElement("script"),callback=null;return script.type="text/javascript",script.src=url,script.async=!0,callback=function(event){removeEventListenerFn(script,"load",callback),removeEventListenerFn(script,"error",callback),rawDocument.body.removeChild(script),script=null;var status=-1,text="unknown";event&&("load"!==event.type||callbacks[callbackId].called||(event={type:"error"}),text=event.type,status="error"===event.type?404:200),done&&done(status,text)},addEventListenerFn(script,"load",callback),addEventListenerFn(script,"error",callback),rawDocument.body.appendChild(script),callback}return function(method,url,post,callback,headers,timeout,withCredentials,responseType,eventHandlers,uploadEventHandlers){function timeoutRequest(){jsonpDone&&jsonpDone(),xhr&&xhr.abort()}function completeRequest(callback,status,response,headersString,statusText){isDefined(timeoutId)&&$browserDefer.cancel(timeoutId),jsonpDone=xhr=null,callback(status,response,headersString,statusText),$browser.$$completeOutstandingRequest(noop)}if($browser.$$incOutstandingRequestCount(),url=url||$browser.url(),"jsonp"==lowercase(method)){var callbackId="_"+(callbacks.counter++).toString(36);callbacks[callbackId]=function(data){callbacks[callbackId].data=data,callbacks[callbackId].called=!0};var jsonpDone=jsonpReq(url.replace("JSON_CALLBACK","angular.callbacks."+callbackId),callbackId,function(status,text){completeRequest(callback,status,callbacks[callbackId].data,"",text),callbacks[callbackId]=noop})}else{var xhr=createXhr(method,url);xhr.open(method,url,!0),forEach(headers,function(value,key){isDefined(value)&&xhr.setRequestHeader(key,value)}),xhr.onload=function(){var statusText=xhr.statusText||"",response="response"in xhr?xhr.response:xhr.responseText,status=1223===xhr.status?204:xhr.status;0===status&&(status=response?200:"file"==urlResolve(url).protocol?404:0),completeRequest(callback,status,response,xhr.getAllResponseHeaders(),statusText)};var requestError=function(){completeRequest(callback,-1,null,null,"")};if(xhr.onerror=requestError,xhr.onabort=requestError,forEach(eventHandlers,function(value,key){xhr.addEventListener(key,value)}),forEach(uploadEventHandlers,function(value,key){xhr.upload.addEventListener(key,value)}),withCredentials&&(xhr.withCredentials=!0),responseType)try{xhr.responseType=responseType}catch(e){if("json"!==responseType)throw e}xhr.send(isUndefined(post)?null:post)}if(timeout>0)var timeoutId=$browserDefer(timeoutRequest,timeout);else isPromiseLike(timeout)&&timeout.then(timeoutRequest)}}function $InterpolateProvider(){var startSymbol="{{",endSymbol="}}";this.startSymbol=function(value){return value?(startSymbol=value,this):startSymbol},this.endSymbol=function(value){return value?(endSymbol=value,this):endSymbol},this.$get=["$parse","$exceptionHandler","$sce",function($parse,$exceptionHandler,$sce){function escape(ch){return"\\\\\\"+ch}function unescapeText(text){return text.replace(escapedStartRegexp,startSymbol).replace(escapedEndRegexp,endSymbol)}function stringify(value){if(null==value)return"";switch(typeof value){case"string":break;case"number":value=""+value;break;default:value=toJson(value)}return value}function constantWatchDelegate(scope,listener,objectEquality,constantInterp){var unwatch;return unwatch=scope.$watch(function(scope){return unwatch(),constantInterp(scope)},listener,objectEquality)}function $interpolate(text,mustHaveExpression,trustedContext,allOrNothing){function parseStringifyInterceptor(value){try{return value=getValue(value),allOrNothing&&!isDefined(value)?value:stringify(value)}catch(err){$exceptionHandler($interpolateMinErr.interr(text,err))}}if(!text.length||-1===text.indexOf(startSymbol)){var constantInterp;if(!mustHaveExpression){constantInterp=valueFn(unescapeText(text)),constantInterp.exp=text,constantInterp.expressions=[],constantInterp.$$watchDelegate=constantWatchDelegate}return constantInterp}allOrNothing=!!allOrNothing;for(var startIndex,endIndex,exp,index=0,expressions=[],parseFns=[],textLength=text.length,concat=[],expressionPositions=[];index<textLength;){if(-1==(startIndex=text.indexOf(startSymbol,index))||-1==(endIndex=text.indexOf(endSymbol,startIndex+startSymbolLength))){index!==textLength&&concat.push(unescapeText(text.substring(index)));break}index!==startIndex&&concat.push(unescapeText(text.substring(index,startIndex))),exp=text.substring(startIndex+startSymbolLength,endIndex),expressions.push(exp),parseFns.push($parse(exp,parseStringifyInterceptor)),index=endIndex+endSymbolLength,expressionPositions.push(concat.length),concat.push("")}if(trustedContext&&concat.length>1&&$interpolateMinErr.throwNoconcat(text),!mustHaveExpression||expressions.length){var compute=function(values){for(var i=0,ii=expressions.length;i<ii;i++){if(allOrNothing&&isUndefined(values[i]))return;concat[expressionPositions[i]]=values[i]}return concat.join("")},getValue=function(value){return trustedContext?$sce.getTrusted(trustedContext,value):$sce.valueOf(value)};return extend(function(context){var i=0,ii=expressions.length,values=new Array(ii);try{for(;i<ii;i++)values[i]=parseFns[i](context);return compute(values)}catch(err){$exceptionHandler($interpolateMinErr.interr(text,err))}},{exp:text,expressions:expressions,$$watchDelegate:function(scope,listener){var lastValue;return scope.$watchGroup(parseFns,function(values,oldValues){var currValue=compute(values);isFunction(listener)&&listener.call(this,currValue,values!==oldValues?lastValue:currValue,scope),lastValue=currValue})}})}}var startSymbolLength=startSymbol.length,endSymbolLength=endSymbol.length,escapedStartRegexp=new RegExp(startSymbol.replace(/./g,escape),"g"),escapedEndRegexp=new RegExp(endSymbol.replace(/./g,escape),"g");return $interpolate.startSymbol=function(){return startSymbol},$interpolate.endSymbol=function(){return endSymbol},$interpolate}]}function $IntervalProvider(){this.$get=["$rootScope","$window","$q","$$q","$browser",function($rootScope,$window,$q,$$q,$browser){function interval(fn,delay,count,invokeApply){function callback(){hasParams?fn.apply(null,args):fn(iteration)}var hasParams=arguments.length>4,args=hasParams?sliceArgs(arguments,4):[],setInterval=$window.setInterval,clearInterval=$window.clearInterval,iteration=0,skipApply=isDefined(invokeApply)&&!invokeApply,deferred=(skipApply?$$q:$q).defer(),promise=deferred.promise;return count=isDefined(count)?count:0,promise.$$intervalId=setInterval(function(){skipApply?$browser.defer(callback):$rootScope.$evalAsync(callback),deferred.notify(iteration++),count>0&&iteration>=count&&(deferred.resolve(iteration),clearInterval(promise.$$intervalId),delete intervals[promise.$$intervalId]),skipApply||$rootScope.$apply()},delay),intervals[promise.$$intervalId]=deferred,promise}var intervals={};return interval.cancel=function(promise){return!!(promise&&promise.$$intervalId in intervals)&&(intervals[promise.$$intervalId].reject("canceled"),$window.clearInterval(promise.$$intervalId),delete intervals[promise.$$intervalId],!0)},interval}]}function encodePath(path){for(var segments=path.split("/"),i=segments.length;i--;)segments[i]=encodeUriSegment(segments[i]);return segments.join("/")}function parseAbsoluteUrl(absoluteUrl,locationObj){var parsedUrl=urlResolve(absoluteUrl);locationObj.$$protocol=parsedUrl.protocol,locationObj.$$host=parsedUrl.hostname,locationObj.$$port=toInt(parsedUrl.port)||DEFAULT_PORTS[parsedUrl.protocol]||null}function parseAppUrl(relativeUrl,locationObj){var prefixed="/"!==relativeUrl.charAt(0);prefixed&&(relativeUrl="/"+relativeUrl);var match=urlResolve(relativeUrl);locationObj.$$path=decodeURIComponent(prefixed&&"/"===match.pathname.charAt(0)?match.pathname.substring(1):match.pathname),locationObj.$$search=parseKeyValue(match.search),locationObj.$$hash=decodeURIComponent(match.hash),locationObj.$$path&&"/"!=locationObj.$$path.charAt(0)&&(locationObj.$$path="/"+locationObj.$$path)}function beginsWith(begin,whole){if(0===whole.indexOf(begin))return whole.substr(begin.length)}function stripHash(url){var index=url.indexOf("#");return-1==index?url:url.substr(0,index)}function trimEmptyHash(url){return url.replace(/(#.+)|#$/,"$1")}function stripFile(url){return url.substr(0,stripHash(url).lastIndexOf("/")+1)}function serverBase(url){return url.substring(0,url.indexOf("/",url.indexOf("//")+2))}function LocationHtml5Url(appBase,appBaseNoFile,basePrefix){this.$$html5=!0,basePrefix=basePrefix||"",parseAbsoluteUrl(appBase,this),this.$$parse=function(url){var pathUrl=beginsWith(appBaseNoFile,url);if(!isString(pathUrl))throw $locationMinErr("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',url,appBaseNoFile);parseAppUrl(pathUrl,this),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash,this.$$absUrl=appBaseNoFile+this.$$url.substr(1)},this.$$parseLinkUrl=function(url,relHref){if(relHref&&"#"===relHref[0])return this.hash(relHref.slice(1)),!0;var appUrl,prevAppUrl,rewrittenUrl;return isDefined(appUrl=beginsWith(appBase,url))?(prevAppUrl=appUrl,rewrittenUrl=isDefined(appUrl=beginsWith(basePrefix,appUrl))?appBaseNoFile+(beginsWith("/",appUrl)||appUrl):appBase+prevAppUrl):isDefined(appUrl=beginsWith(appBaseNoFile,url))?rewrittenUrl=appBaseNoFile+appUrl:appBaseNoFile==url+"/"&&(rewrittenUrl=appBaseNoFile),rewrittenUrl&&this.$$parse(rewrittenUrl),!!rewrittenUrl}}function LocationHashbangUrl(appBase,appBaseNoFile,hashPrefix){parseAbsoluteUrl(appBase,this),this.$$parse=function(url){var withoutHashUrl,withoutBaseUrl=beginsWith(appBase,url)||beginsWith(appBaseNoFile,url);isUndefined(withoutBaseUrl)||"#"!==withoutBaseUrl.charAt(0)?this.$$html5?withoutHashUrl=withoutBaseUrl:(withoutHashUrl="",isUndefined(withoutBaseUrl)&&(appBase=url,this.replace())):(withoutHashUrl=beginsWith(hashPrefix,withoutBaseUrl),isUndefined(withoutHashUrl)&&(withoutHashUrl=withoutBaseUrl)),parseAppUrl(withoutHashUrl,this),this.$$path=function(path,url,base){var firstPathSegmentMatch,windowsFilePathExp=/^\/[A-Z]:(\/.*)/;return 0===url.indexOf(base)&&(url=url.replace(base,"")),windowsFilePathExp.exec(url)?path:(firstPathSegmentMatch=windowsFilePathExp.exec(path),firstPathSegmentMatch?firstPathSegmentMatch[1]:path)}(this.$$path,withoutHashUrl,appBase),this.$$compose()},this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash,this.$$absUrl=appBase+(this.$$url?hashPrefix+this.$$url:"")},this.$$parseLinkUrl=function(url,relHref){return stripHash(appBase)==stripHash(url)&&(this.$$parse(url),!0)}}function LocationHashbangInHtml5Url(appBase,appBaseNoFile,hashPrefix){this.$$html5=!0,LocationHashbangUrl.apply(this,arguments),this.$$parseLinkUrl=function(url,relHref){if(relHref&&"#"===relHref[0])return this.hash(relHref.slice(1)),!0;var rewrittenUrl,appUrl;return appBase==stripHash(url)?rewrittenUrl=url:(appUrl=beginsWith(appBaseNoFile,url))?rewrittenUrl=appBase+hashPrefix+appUrl:appBaseNoFile===url+"/"&&(rewrittenUrl=appBaseNoFile),rewrittenUrl&&this.$$parse(rewrittenUrl),!!rewrittenUrl},this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash,this.$$absUrl=appBase+hashPrefix+this.$$url}}function locationGetter(property){return function(){return this[property]}}function locationGetterSetter(property,preprocess){return function(value){return isUndefined(value)?this[property]:(this[property]=preprocess(value),this.$$compose(),this)}}function $LocationProvider(){var hashPrefix="",html5Mode={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(prefix){return isDefined(prefix)?(hashPrefix=prefix,this):hashPrefix},this.html5Mode=function(mode){return isBoolean(mode)?(html5Mode.enabled=mode,this):isObject(mode)?(isBoolean(mode.enabled)&&(html5Mode.enabled=mode.enabled),isBoolean(mode.requireBase)&&(html5Mode.requireBase=mode.requireBase),isBoolean(mode.rewriteLinks)&&(html5Mode.rewriteLinks=mode.rewriteLinks),this):html5Mode},this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function($rootScope,$browser,$sniffer,$rootElement,$window){function setBrowserUrlWithFallback(url,replace,state){var oldUrl=$location.url(),oldState=$location.$$state;try{$browser.url(url,replace,state),$location.$$state=$browser.state()}catch(e){throw $location.url(oldUrl),$location.$$state=oldState,e}}function afterLocationChange(oldUrl,oldState){$rootScope.$broadcast("$locationChangeSuccess",$location.absUrl(),oldUrl,$location.$$state,oldState)}var $location,LocationMode,appBase,baseHref=$browser.baseHref(),initialUrl=$browser.url();if(html5Mode.enabled){if(!baseHref&&html5Mode.requireBase)throw $locationMinErr("nobase","$location in HTML5 mode requires a <base> tag to be present!");appBase=serverBase(initialUrl)+(baseHref||"/"),LocationMode=$sniffer.history?LocationHtml5Url:LocationHashbangInHtml5Url}else appBase=stripHash(initialUrl),LocationMode=LocationHashbangUrl;var appBaseNoFile=stripFile(appBase);$location=new LocationMode(appBase,appBaseNoFile,"#"+hashPrefix),$location.$$parseLinkUrl(initialUrl,initialUrl),$location.$$state=$browser.state();var IGNORE_URI_REGEXP=/^\s*(javascript|mailto):/i;$rootElement.on("click",function(event){if(html5Mode.rewriteLinks&&!event.ctrlKey&&!event.metaKey&&!event.shiftKey&&2!=event.which&&2!=event.button){for(var elm=jqLite(event.target);"a"!==nodeName_(elm[0]);)if(elm[0]===$rootElement[0]||!(elm=elm.parent())[0])return;var absHref=elm.prop("href"),relHref=elm.attr("href")||elm.attr("xlink:href");isObject(absHref)&&"[object SVGAnimatedString]"===absHref.toString()&&(absHref=urlResolve(absHref.animVal).href),IGNORE_URI_REGEXP.test(absHref)||!absHref||elm.attr("target")||event.isDefaultPrevented()||$location.$$parseLinkUrl(absHref,relHref)&&(event.preventDefault(),$location.absUrl()!=$browser.url()&&($rootScope.$apply(),$window.angular["ff-684208-preventDefault"]=!0))}}),trimEmptyHash($location.absUrl())!=trimEmptyHash(initialUrl)&&$browser.url($location.absUrl(),!0);var initializing=!0;return $browser.onUrlChange(function(newUrl,newState){if(isUndefined(beginsWith(appBaseNoFile,newUrl)))return void($window.location.href=newUrl);$rootScope.$evalAsync(function(){var defaultPrevented,oldUrl=$location.absUrl(),oldState=$location.$$state;newUrl=trimEmptyHash(newUrl),$location.$$parse(newUrl),$location.$$state=newState,defaultPrevented=$rootScope.$broadcast("$locationChangeStart",newUrl,oldUrl,newState,oldState).defaultPrevented,$location.absUrl()===newUrl&&(defaultPrevented?($location.$$parse(oldUrl),$location.$$state=oldState,setBrowserUrlWithFallback(oldUrl,!1,oldState)):(initializing=!1,afterLocationChange(oldUrl,oldState)))}),$rootScope.$$phase||$rootScope.$digest()}),$rootScope.$watch(function(){var oldUrl=trimEmptyHash($browser.url()),newUrl=trimEmptyHash($location.absUrl()),oldState=$browser.state(),currentReplace=$location.$$replace,urlOrStateChanged=oldUrl!==newUrl||$location.$$html5&&$sniffer.history&&oldState!==$location.$$state;(initializing||urlOrStateChanged)&&(initializing=!1,$rootScope.$evalAsync(function(){var newUrl=$location.absUrl(),defaultPrevented=$rootScope.$broadcast("$locationChangeStart",newUrl,oldUrl,$location.$$state,oldState).defaultPrevented;$location.absUrl()===newUrl&&(defaultPrevented?($location.$$parse(oldUrl),$location.$$state=oldState):(urlOrStateChanged&&setBrowserUrlWithFallback(newUrl,currentReplace,oldState===$location.$$state?null:$location.$$state),afterLocationChange(oldUrl,oldState)))})),$location.$$replace=!1}),$location}]}function $LogProvider(){var debug=!0,self=this;this.debugEnabled=function(flag){return isDefined(flag)?(debug=flag,this):debug},this.$get=["$window",function($window){function formatError(arg){return arg instanceof Error&&(arg.stack?arg=arg.message&&-1===arg.stack.indexOf(arg.message)?"Error: "+arg.message+"\n"+arg.stack:arg.stack:arg.sourceURL&&(arg=arg.message+"\n"+arg.sourceURL+":"+arg.line)),arg}function consoleLog(type){var console=$window.console||{},logFn=console[type]||console.log||noop,hasApply=!1;try{hasApply=!!logFn.apply}catch(e){}return hasApply?function(){var args=[];return forEach(arguments,function(arg){args.push(formatError(arg))}),logFn.apply(console,args)}:function(arg1,arg2){logFn(arg1,null==arg2?"":arg2)}}return{log:consoleLog("log"),info:consoleLog("info"),warn:consoleLog("warn"),error:consoleLog("error"),debug:function(){var fn=consoleLog("debug");return function(){debug&&fn.apply(self,arguments)}}()}}]}function ensureSafeMemberName(name,fullExpression){if("__defineGetter__"===name||"__defineSetter__"===name||"__lookupGetter__"===name||"__lookupSetter__"===name||"__proto__"===name)throw $parseMinErr("isecfld","Attempting to access a disallowed field in Angular expressions! Expression: {0}",fullExpression);return name}function getStringValue(name){return name+""}function ensureSafeObject(obj,fullExpression){if(obj){if(obj.constructor===obj)throw $parseMinErr("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",fullExpression);if(obj.window===obj)throw $parseMinErr("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",fullExpression);if(obj.children&&(obj.nodeName||obj.prop&&obj.attr&&obj.find))throw $parseMinErr("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",fullExpression);if(obj===Object)throw $parseMinErr("isecobj","Referencing Object in Angular expressions is disallowed! Expression: {0}",fullExpression)}return obj}function ensureSafeFunction(obj,fullExpression){if(obj){if(obj.constructor===obj)throw $parseMinErr("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",fullExpression);if(obj===CALL||obj===APPLY||obj===BIND)throw $parseMinErr("isecff","Referencing call, apply or bind in Angular expressions is disallowed! Expression: {0}",fullExpression)}}function ensureSafeAssignContext(obj,fullExpression){if(obj&&(obj===(0).constructor||obj===(!1).constructor||obj==="".constructor||obj==={}.constructor||obj===[].constructor||obj===Function.constructor))throw $parseMinErr("isecaf","Assigning to a constructor is disallowed! Expression: {0}",fullExpression)}function ifDefined(v,d){return void 0!==v?v:d}function plusFn(l,r){return void 0===l?r:void 0===r?l:l+r}function isStateless($filter,filterName){return!$filter(filterName).$stateful}function findConstantAndWatchExpressions(ast,$filter){var allConstants,argsToWatch;switch(ast.type){case AST.Program:allConstants=!0,forEach(ast.body,function(expr){findConstantAndWatchExpressions(expr.expression,$filter),allConstants=allConstants&&expr.expression.constant}),ast.constant=allConstants;break;case AST.Literal:ast.constant=!0,ast.toWatch=[];break;case AST.UnaryExpression:findConstantAndWatchExpressions(ast.argument,$filter),ast.constant=ast.argument.constant,ast.toWatch=ast.argument.toWatch;break;case AST.BinaryExpression:findConstantAndWatchExpressions(ast.left,$filter),findConstantAndWatchExpressions(ast.right,$filter),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=ast.left.toWatch.concat(ast.right.toWatch);break;case AST.LogicalExpression:findConstantAndWatchExpressions(ast.left,$filter),findConstantAndWatchExpressions(ast.right,$filter),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=ast.constant?[]:[ast];break;case AST.ConditionalExpression:findConstantAndWatchExpressions(ast.test,$filter),findConstantAndWatchExpressions(ast.alternate,$filter),findConstantAndWatchExpressions(ast.consequent,$filter),ast.constant=ast.test.constant&&ast.alternate.constant&&ast.consequent.constant,ast.toWatch=ast.constant?[]:[ast];break;case AST.Identifier:ast.constant=!1,ast.toWatch=[ast];break;case AST.MemberExpression:findConstantAndWatchExpressions(ast.object,$filter),ast.computed&&findConstantAndWatchExpressions(ast.property,$filter),ast.constant=ast.object.constant&&(!ast.computed||ast.property.constant),ast.toWatch=[ast];break;case AST.CallExpression:allConstants=!!ast.filter&&isStateless($filter,ast.callee.name),argsToWatch=[],forEach(ast.arguments,function(expr){findConstantAndWatchExpressions(expr,$filter),allConstants=allConstants&&expr.constant,expr.constant||argsToWatch.push.apply(argsToWatch,expr.toWatch)}),ast.constant=allConstants,ast.toWatch=ast.filter&&isStateless($filter,ast.callee.name)?argsToWatch:[ast];break;case AST.AssignmentExpression:findConstantAndWatchExpressions(ast.left,$filter),findConstantAndWatchExpressions(ast.right,$filter),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=[ast];break;case AST.ArrayExpression:allConstants=!0,argsToWatch=[],forEach(ast.elements,function(expr){findConstantAndWatchExpressions(expr,$filter),allConstants=allConstants&&expr.constant,expr.constant||argsToWatch.push.apply(argsToWatch,expr.toWatch)}),ast.constant=allConstants,ast.toWatch=argsToWatch;break;case AST.ObjectExpression:allConstants=!0,argsToWatch=[],forEach(ast.properties,function(property){findConstantAndWatchExpressions(property.value,$filter),allConstants=allConstants&&property.value.constant,property.value.constant||argsToWatch.push.apply(argsToWatch,property.value.toWatch)}),ast.constant=allConstants,ast.toWatch=argsToWatch;break;case AST.ThisExpression:case AST.LocalsExpression:ast.constant=!1,ast.toWatch=[]}}function getInputs(body){if(1==body.length){var lastExpression=body[0].expression,candidate=lastExpression.toWatch;return 1!==candidate.length?candidate:candidate[0]!==lastExpression?candidate:void 0}}function isAssignable(ast){return ast.type===AST.Identifier||ast.type===AST.MemberExpression}function assignableAST(ast){if(1===ast.body.length&&isAssignable(ast.body[0].expression))return{type:AST.AssignmentExpression,left:ast.body[0].expression,right:{type:AST.NGValueParameter},operator:"="}}function isLiteral(ast){return 0===ast.body.length||1===ast.body.length&&(ast.body[0].expression.type===AST.Literal||ast.body[0].expression.type===AST.ArrayExpression||ast.body[0].expression.type===AST.ObjectExpression)}function isConstant(ast){return ast.constant}function ASTCompiler(astBuilder,$filter){this.astBuilder=astBuilder,this.$filter=$filter}function ASTInterpreter(astBuilder,$filter){this.astBuilder=astBuilder,this.$filter=$filter}function isPossiblyDangerousMemberName(name){return"constructor"==name}function getValueOf(value){return isFunction(value.valueOf)?value.valueOf():objectValueOf.call(value)}function $ParseProvider(){var identStart,identContinue,cacheDefault=createMap(),cacheExpensive=createMap(),literals={true:!0,false:!1,null:null,undefined:void 0};this.addLiteral=function(literalName,literalValue){literals[literalName]=literalValue},this.setIdentifierFns=function(identifierStart,identifierContinue){return identStart=identifierStart,identContinue=identifierContinue,this},this.$get=["$filter",function($filter){function $parse(exp,interceptorFn,expensiveChecks){var parsedExpression,oneTime,cacheKey;switch(expensiveChecks=expensiveChecks||runningChecksEnabled,typeof exp){case"string":exp=exp.trim(),cacheKey=exp;var cache=expensiveChecks?cacheExpensive:cacheDefault;if(!(parsedExpression=cache[cacheKey])){":"===exp.charAt(0)&&":"===exp.charAt(1)&&(oneTime=!0,exp=exp.substring(2));var parseOptions=expensiveChecks?$parseOptionsExpensive:$parseOptions,lexer=new Lexer(parseOptions);parsedExpression=new Parser(lexer,$filter,parseOptions).parse(exp),parsedExpression.constant?parsedExpression.$$watchDelegate=constantWatchDelegate:oneTime?parsedExpression.$$watchDelegate=parsedExpression.literal?oneTimeLiteralWatchDelegate:oneTimeWatchDelegate:parsedExpression.inputs&&(parsedExpression.$$watchDelegate=inputsWatchDelegate),expensiveChecks&&(parsedExpression=expensiveChecksInterceptor(parsedExpression)),cache[cacheKey]=parsedExpression}return addInterceptor(parsedExpression,interceptorFn);case"function":return addInterceptor(exp,interceptorFn);default:return addInterceptor(noop,interceptorFn)}}function expensiveChecksInterceptor(fn){function expensiveCheckFn(scope,locals,assign,inputs){var expensiveCheckOldValue=runningChecksEnabled;runningChecksEnabled=!0;try{return fn(scope,locals,assign,inputs)}finally{runningChecksEnabled=expensiveCheckOldValue}}if(!fn)return fn;expensiveCheckFn.$$watchDelegate=fn.$$watchDelegate,expensiveCheckFn.assign=expensiveChecksInterceptor(fn.assign),expensiveCheckFn.constant=fn.constant,expensiveCheckFn.literal=fn.literal;for(var i=0;fn.inputs&&i<fn.inputs.length;++i)fn.inputs[i]=expensiveChecksInterceptor(fn.inputs[i]);return expensiveCheckFn.inputs=fn.inputs,expensiveCheckFn}function expressionInputDirtyCheck(newValue,oldValueOfValue){return null==newValue||null==oldValueOfValue?newValue===oldValueOfValue:("object"!=typeof newValue||"object"!=typeof(newValue=getValueOf(newValue)))&&(newValue===oldValueOfValue||newValue!==newValue&&oldValueOfValue!==oldValueOfValue)}function inputsWatchDelegate(scope,listener,objectEquality,parsedExpression,prettyPrintExpression){var lastResult,inputExpressions=parsedExpression.inputs;if(1===inputExpressions.length){var oldInputValueOf=expressionInputDirtyCheck;return inputExpressions=inputExpressions[0],scope.$watch(function(scope){var newInputValue=inputExpressions(scope);return expressionInputDirtyCheck(newInputValue,oldInputValueOf)||(lastResult=parsedExpression(scope,void 0,void 0,[newInputValue]),oldInputValueOf=newInputValue&&getValueOf(newInputValue)),lastResult},listener,objectEquality,prettyPrintExpression)}for(var oldInputValueOfValues=[],oldInputValues=[],i=0,ii=inputExpressions.length;i<ii;i++)oldInputValueOfValues[i]=expressionInputDirtyCheck,oldInputValues[i]=null;return scope.$watch(function(scope){for(var changed=!1,i=0,ii=inputExpressions.length;i<ii;i++){var newInputValue=inputExpressions[i](scope);(changed||(changed=!expressionInputDirtyCheck(newInputValue,oldInputValueOfValues[i])))&&(oldInputValues[i]=newInputValue,oldInputValueOfValues[i]=newInputValue&&getValueOf(newInputValue))}return changed&&(lastResult=parsedExpression(scope,void 0,void 0,oldInputValues)),lastResult},listener,objectEquality,prettyPrintExpression)}function oneTimeWatchDelegate(scope,listener,objectEquality,parsedExpression){var unwatch,lastValue;return unwatch=scope.$watch(function(scope){return parsedExpression(scope)},function(value,old,scope){lastValue=value,isFunction(listener)&&listener.apply(this,arguments),isDefined(value)&&scope.$$postDigest(function(){isDefined(lastValue)&&unwatch()})},objectEquality)}function oneTimeLiteralWatchDelegate(scope,listener,objectEquality,parsedExpression){function isAllDefined(value){var allDefined=!0;return forEach(value,function(val){isDefined(val)||(allDefined=!1)}),allDefined}var unwatch,lastValue;return unwatch=scope.$watch(function(scope){return parsedExpression(scope)},function(value,old,scope){lastValue=value,isFunction(listener)&&listener.call(this,value,old,scope),isAllDefined(value)&&scope.$$postDigest(function(){isAllDefined(lastValue)&&unwatch()})},objectEquality)}function constantWatchDelegate(scope,listener,objectEquality,parsedExpression){var unwatch;return unwatch=scope.$watch(function(scope){return unwatch(),parsedExpression(scope)},listener,objectEquality)}function addInterceptor(parsedExpression,interceptorFn){if(!interceptorFn)return parsedExpression;var watchDelegate=parsedExpression.$$watchDelegate,useInputs=!1,regularWatch=watchDelegate!==oneTimeLiteralWatchDelegate&&watchDelegate!==oneTimeWatchDelegate,fn=regularWatch?function(scope,locals,assign,inputs){var value=useInputs&&inputs?inputs[0]:parsedExpression(scope,locals,assign,inputs);return interceptorFn(value,scope,locals)}:function(scope,locals,assign,inputs){var value=parsedExpression(scope,locals,assign,inputs),result=interceptorFn(value,scope,locals);return isDefined(value)?result:value};return parsedExpression.$$watchDelegate&&parsedExpression.$$watchDelegate!==inputsWatchDelegate?fn.$$watchDelegate=parsedExpression.$$watchDelegate:interceptorFn.$stateful||(fn.$$watchDelegate=inputsWatchDelegate,useInputs=!parsedExpression.inputs,fn.inputs=parsedExpression.inputs?parsedExpression.inputs:[parsedExpression]),fn}var noUnsafeEval=csp().noUnsafeEval,$parseOptions={csp:noUnsafeEval,expensiveChecks:!1,literals:copy(literals),isIdentifierStart:isFunction(identStart)&&identStart,isIdentifierContinue:isFunction(identContinue)&&identContinue},$parseOptionsExpensive={csp:noUnsafeEval,expensiveChecks:!0,literals:copy(literals),isIdentifierStart:isFunction(identStart)&&identStart,isIdentifierContinue:isFunction(identContinue)&&identContinue},runningChecksEnabled=!1;return $parse.$$runningExpensiveChecks=function(){return runningChecksEnabled},$parse}]}function $QProvider(){this.$get=["$rootScope","$exceptionHandler",function($rootScope,$exceptionHandler){return qFactory(function(callback){$rootScope.$evalAsync(callback)},$exceptionHandler)}]}function $$QProvider(){this.$get=["$browser","$exceptionHandler",function($browser,$exceptionHandler){return qFactory(function(callback){$browser.defer(callback)},$exceptionHandler)}]}function qFactory(nextTick,exceptionHandler){function Promise(){this.$$state={status:0}}function simpleBind(context,fn){return function(value){fn.call(context,value)}}function processQueue(state){var fn,deferred,pending;pending=state.pending,state.processScheduled=!1,state.pending=void 0;for(var i=0,ii=pending.length;i<ii;++i){deferred=pending[i][0],fn=pending[i][state.status];try{isFunction(fn)?deferred.resolve(fn(state.value)):1===state.status?deferred.resolve(state.value):deferred.reject(state.value)}catch(e){deferred.reject(e),exceptionHandler(e)}}}function scheduleProcessQueue(state){!state.processScheduled&&state.pending&&(state.processScheduled=!0,nextTick(function(){processQueue(state)}))}function Deferred(){this.promise=new Promise}function all(promises){var deferred=new Deferred,counter=0,results=isArray(promises)?[]:{};return forEach(promises,function(promise,key){counter++,when(promise).then(function(value){results.hasOwnProperty(key)||(results[key]=value,--counter||deferred.resolve(results))},function(reason){results.hasOwnProperty(key)||deferred.reject(reason)})}),0===counter&&deferred.resolve(results),deferred.promise}var $qMinErr=minErr("$q",TypeError),defer=function(){var d=new Deferred;return d.resolve=simpleBind(d,d.resolve),d.reject=simpleBind(d,d.reject),d.notify=simpleBind(d,d.notify),d};extend(Promise.prototype,{then:function(onFulfilled,onRejected,progressBack){if(isUndefined(onFulfilled)&&isUndefined(onRejected)&&isUndefined(progressBack))return this;var result=new Deferred;return this.$$state.pending=this.$$state.pending||[],this.$$state.pending.push([result,onFulfilled,onRejected,progressBack]),this.$$state.status>0&&scheduleProcessQueue(this.$$state),result.promise},catch:function(callback){return this.then(null,callback)},finally:function(callback,progressBack){return this.then(function(value){return handleCallback(value,!0,callback)},function(error){return handleCallback(error,!1,callback)},progressBack)}}),extend(Deferred.prototype,{resolve:function(val){this.promise.$$state.status||(val===this.promise?this.$$reject($qMinErr("qcycle","Expected promise to be resolved with value other than itself '{0}'",val)):this.$$resolve(val))},$$resolve:function(val){function resolvePromise(val){done||(done=!0,that.$$resolve(val))}function rejectPromise(val){done||(done=!0,that.$$reject(val))}var then,that=this,done=!1;try{(isObject(val)||isFunction(val))&&(then=val&&val.then),isFunction(then)?(this.promise.$$state.status=-1,then.call(val,resolvePromise,rejectPromise,simpleBind(this,this.notify))):(this.promise.$$state.value=val,this.promise.$$state.status=1,scheduleProcessQueue(this.promise.$$state))}catch(e){rejectPromise(e),exceptionHandler(e)}},reject:function(reason){this.promise.$$state.status||this.$$reject(reason)},$$reject:function(reason){this.promise.$$state.value=reason,this.promise.$$state.status=2,scheduleProcessQueue(this.promise.$$state)},notify:function(progress){var callbacks=this.promise.$$state.pending;this.promise.$$state.status<=0&&callbacks&&callbacks.length&&nextTick(function(){for(var callback,result,i=0,ii=callbacks.length;i<ii;i++){result=callbacks[i][0],callback=callbacks[i][3];try{result.notify(isFunction(callback)?callback(progress):progress)}catch(e){exceptionHandler(e)}}})}});var reject=function(reason){var result=new Deferred;return result.reject(reason),result.promise},makePromise=function(value,resolved){var result=new Deferred;return resolved?result.resolve(value):result.reject(value),result.promise},handleCallback=function(value,isResolved,callback){var callbackOutput=null;try{isFunction(callback)&&(callbackOutput=callback())}catch(e){return makePromise(e,!1)}return isPromiseLike(callbackOutput)?callbackOutput.then(function(){return makePromise(value,isResolved)},function(error){return makePromise(error,!1)}):makePromise(value,isResolved)},when=function(value,callback,errback,progressBack){var result=new Deferred;return result.resolve(value),result.promise.then(callback,errback,progressBack)},resolve=when,$Q=function(resolver){function resolveFn(value){deferred.resolve(value)}function rejectFn(reason){deferred.reject(reason)}
if(!isFunction(resolver))throw $qMinErr("norslvr","Expected resolverFn, got '{0}'",resolver);var deferred=new Deferred;return resolver(resolveFn,rejectFn),deferred.promise};return $Q.prototype=Promise.prototype,$Q.defer=defer,$Q.reject=reject,$Q.when=when,$Q.resolve=resolve,$Q.all=all,$Q}function $$RAFProvider(){this.$get=["$window","$timeout",function($window,$timeout){var requestAnimationFrame=$window.requestAnimationFrame||$window.webkitRequestAnimationFrame,cancelAnimationFrame=$window.cancelAnimationFrame||$window.webkitCancelAnimationFrame||$window.webkitCancelRequestAnimationFrame,rafSupported=!!requestAnimationFrame,raf=rafSupported?function(fn){var id=requestAnimationFrame(fn);return function(){cancelAnimationFrame(id)}}:function(fn){var timer=$timeout(fn,16.66,!1);return function(){$timeout.cancel(timer)}};return raf.supported=rafSupported,raf}]}function $RootScopeProvider(){function createChildScopeClass(parent){function ChildScope(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$id=nextUid(),this.$$ChildScope=null}return ChildScope.prototype=parent,ChildScope}var TTL=10,$rootScopeMinErr=minErr("$rootScope"),lastDirtyWatch=null,applyAsyncId=null;this.digestTtl=function(value){return arguments.length&&(TTL=value),TTL},this.$get=["$exceptionHandler","$parse","$browser",function($exceptionHandler,$parse,$browser){function destroyChildScope($event){$event.currentScope.$$destroyed=!0}function cleanUpScope($scope){9===msie&&($scope.$$childHead&&cleanUpScope($scope.$$childHead),$scope.$$nextSibling&&cleanUpScope($scope.$$nextSibling)),$scope.$parent=$scope.$$nextSibling=$scope.$$prevSibling=$scope.$$childHead=$scope.$$childTail=$scope.$root=$scope.$$watchers=null}function Scope(){this.$id=nextUid(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this.$root=this,this.$$destroyed=!1,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$$isolateBindings=null}function beginPhase(phase){if($rootScope.$$phase)throw $rootScopeMinErr("inprog","{0} already in progress",$rootScope.$$phase);$rootScope.$$phase=phase}function clearPhase(){$rootScope.$$phase=null}function incrementWatchersCount(current,count){do{current.$$watchersCount+=count}while(current=current.$parent)}function decrementListenerCount(current,count,name){do{current.$$listenerCount[name]-=count,0===current.$$listenerCount[name]&&delete current.$$listenerCount[name]}while(current=current.$parent)}function initWatchVal(){}function flushApplyAsync(){for(;applyAsyncQueue.length;)try{applyAsyncQueue.shift()()}catch(e){$exceptionHandler(e)}applyAsyncId=null}function scheduleApplyAsync(){null===applyAsyncId&&(applyAsyncId=$browser.defer(function(){$rootScope.$apply(flushApplyAsync)}))}Scope.prototype={constructor:Scope,$new:function(isolate,parent){var child;return parent=parent||this,isolate?(child=new Scope,child.$root=this.$root):(this.$$ChildScope||(this.$$ChildScope=createChildScopeClass(this)),child=new this.$$ChildScope),child.$parent=parent,child.$$prevSibling=parent.$$childTail,parent.$$childHead?(parent.$$childTail.$$nextSibling=child,parent.$$childTail=child):parent.$$childHead=parent.$$childTail=child,(isolate||parent!=this)&&child.$on("$destroy",destroyChildScope),child},$watch:function(watchExp,listener,objectEquality,prettyPrintExpression){var get=$parse(watchExp);if(get.$$watchDelegate)return get.$$watchDelegate(this,listener,objectEquality,get,watchExp);var scope=this,array=scope.$$watchers,watcher={fn:listener,last:initWatchVal,get:get,exp:prettyPrintExpression||watchExp,eq:!!objectEquality};return lastDirtyWatch=null,isFunction(listener)||(watcher.fn=noop),array||(array=scope.$$watchers=[]),array.unshift(watcher),incrementWatchersCount(this,1),function(){arrayRemove(array,watcher)>=0&&incrementWatchersCount(scope,-1),lastDirtyWatch=null}},$watchGroup:function(watchExpressions,listener){function watchGroupAction(){changeReactionScheduled=!1,firstRun?(firstRun=!1,listener(newValues,newValues,self)):listener(newValues,oldValues,self)}var oldValues=new Array(watchExpressions.length),newValues=new Array(watchExpressions.length),deregisterFns=[],self=this,changeReactionScheduled=!1,firstRun=!0;if(!watchExpressions.length){var shouldCall=!0;return self.$evalAsync(function(){shouldCall&&listener(newValues,newValues,self)}),function(){shouldCall=!1}}return 1===watchExpressions.length?this.$watch(watchExpressions[0],function(value,oldValue,scope){newValues[0]=value,oldValues[0]=oldValue,listener(newValues,value===oldValue?newValues:oldValues,scope)}):(forEach(watchExpressions,function(expr,i){var unwatchFn=self.$watch(expr,function(value,oldValue){newValues[i]=value,oldValues[i]=oldValue,changeReactionScheduled||(changeReactionScheduled=!0,self.$evalAsync(watchGroupAction))});deregisterFns.push(unwatchFn)}),function(){for(;deregisterFns.length;)deregisterFns.shift()()})},$watchCollection:function(obj,listener){function $watchCollectionInterceptor(_value){newValue=_value;var newLength,key,newItem,oldItem;if(!isUndefined(newValue)){if(isObject(newValue))if(isArrayLike(newValue)){oldValue!==internalArray&&(oldValue=internalArray,oldLength=oldValue.length=0,changeDetected++),newLength=newValue.length,oldLength!==newLength&&(changeDetected++,oldValue.length=oldLength=newLength);for(var i=0;i<newLength;i++)oldItem=oldValue[i],newItem=newValue[i],oldItem!==oldItem&&newItem!==newItem||oldItem===newItem||(changeDetected++,oldValue[i]=newItem)}else{oldValue!==internalObject&&(oldValue=internalObject={},oldLength=0,changeDetected++),newLength=0;for(key in newValue)hasOwnProperty.call(newValue,key)&&(newLength++,newItem=newValue[key],oldItem=oldValue[key],key in oldValue?oldItem!==oldItem&&newItem!==newItem||oldItem===newItem||(changeDetected++,oldValue[key]=newItem):(oldLength++,oldValue[key]=newItem,changeDetected++));if(oldLength>newLength){changeDetected++;for(key in oldValue)hasOwnProperty.call(newValue,key)||(oldLength--,delete oldValue[key])}}else oldValue!==newValue&&(oldValue=newValue,changeDetected++);return changeDetected}}function $watchCollectionAction(){if(initRun?(initRun=!1,listener(newValue,newValue,self)):listener(newValue,veryOldValue,self),trackVeryOldValue)if(isObject(newValue))if(isArrayLike(newValue)){veryOldValue=new Array(newValue.length);for(var i=0;i<newValue.length;i++)veryOldValue[i]=newValue[i]}else{veryOldValue={};for(var key in newValue)hasOwnProperty.call(newValue,key)&&(veryOldValue[key]=newValue[key])}else veryOldValue=newValue}$watchCollectionInterceptor.$stateful=!0;var newValue,oldValue,veryOldValue,self=this,trackVeryOldValue=listener.length>1,changeDetected=0,changeDetector=$parse(obj,$watchCollectionInterceptor),internalArray=[],internalObject={},initRun=!0,oldLength=0;return this.$watch(changeDetector,$watchCollectionAction)},$digest:function(){var watch,value,last,fn,get,watchers,length,dirty,next,current,logIdx,asyncTask,ttl=TTL,target=this,watchLog=[];beginPhase("$digest"),$browser.$$checkUrlChange(),this===$rootScope&&null!==applyAsyncId&&($browser.defer.cancel(applyAsyncId),flushApplyAsync()),lastDirtyWatch=null;do{for(dirty=!1,current=target;asyncQueue.length;){try{asyncTask=asyncQueue.shift(),asyncTask.scope.$eval(asyncTask.expression,asyncTask.locals)}catch(e){$exceptionHandler(e)}lastDirtyWatch=null}traverseScopesLoop:do{if(watchers=current.$$watchers)for(length=watchers.length;length--;)try{if(watch=watchers[length])if(get=watch.get,(value=get(current))===(last=watch.last)||(watch.eq?equals(value,last):"number"==typeof value&&"number"==typeof last&&isNaN(value)&&isNaN(last))){if(watch===lastDirtyWatch){dirty=!1;break traverseScopesLoop}}else dirty=!0,lastDirtyWatch=watch,watch.last=watch.eq?copy(value,null):value,fn=watch.fn,fn(value,last===initWatchVal?value:last,current),ttl<5&&(logIdx=4-ttl,watchLog[logIdx]||(watchLog[logIdx]=[]),watchLog[logIdx].push({msg:isFunction(watch.exp)?"fn: "+(watch.exp.name||watch.exp.toString()):watch.exp,newVal:value,oldVal:last}))}catch(e){$exceptionHandler(e)}if(!(next=current.$$watchersCount&&current.$$childHead||current!==target&&current.$$nextSibling))for(;current!==target&&!(next=current.$$nextSibling);)current=current.$parent}while(current=next);if((dirty||asyncQueue.length)&&!ttl--)throw clearPhase(),$rootScopeMinErr("infdig","{0} $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: {1}",TTL,watchLog)}while(dirty||asyncQueue.length);for(clearPhase();postDigestQueue.length;)try{postDigestQueue.shift()()}catch(e){$exceptionHandler(e)}},$destroy:function(){if(!this.$$destroyed){var parent=this.$parent;this.$broadcast("$destroy"),this.$$destroyed=!0,this===$rootScope&&$browser.$$applicationDestroyed(),incrementWatchersCount(this,-this.$$watchersCount);for(var eventName in this.$$listenerCount)decrementListenerCount(this,this.$$listenerCount[eventName],eventName);parent&&parent.$$childHead==this&&(parent.$$childHead=this.$$nextSibling),parent&&parent.$$childTail==this&&(parent.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=noop,this.$on=this.$watch=this.$watchGroup=function(){return noop},this.$$listeners={},this.$$nextSibling=null,cleanUpScope(this)}},$eval:function(expr,locals){return $parse(expr)(this,locals)},$evalAsync:function(expr,locals){$rootScope.$$phase||asyncQueue.length||$browser.defer(function(){asyncQueue.length&&$rootScope.$digest()}),asyncQueue.push({scope:this,expression:$parse(expr),locals:locals})},$$postDigest:function(fn){postDigestQueue.push(fn)},$apply:function(expr){try{beginPhase("$apply");try{return this.$eval(expr)}finally{clearPhase()}}catch(e){$exceptionHandler(e)}finally{try{$rootScope.$digest()}catch(e){throw $exceptionHandler(e),e}}},$applyAsync:function(expr){function $applyAsyncExpression(){scope.$eval(expr)}var scope=this;expr&&applyAsyncQueue.push($applyAsyncExpression),expr=$parse(expr),scheduleApplyAsync()},$on:function(name,listener){var namedListeners=this.$$listeners[name];namedListeners||(this.$$listeners[name]=namedListeners=[]),namedListeners.push(listener);var current=this;do{current.$$listenerCount[name]||(current.$$listenerCount[name]=0),current.$$listenerCount[name]++}while(current=current.$parent);var self=this;return function(){var indexOfListener=namedListeners.indexOf(listener);-1!==indexOfListener&&(namedListeners[indexOfListener]=null,decrementListenerCount(self,1,name))}},$emit:function(name,args){var namedListeners,i,length,empty=[],scope=this,stopPropagation=!1,event={name:name,targetScope:scope,stopPropagation:function(){stopPropagation=!0},preventDefault:function(){event.defaultPrevented=!0},defaultPrevented:!1},listenerArgs=concat([event],arguments,1);do{for(namedListeners=scope.$$listeners[name]||empty,event.currentScope=scope,i=0,length=namedListeners.length;i<length;i++)if(namedListeners[i])try{namedListeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}else namedListeners.splice(i,1),i--,length--;if(stopPropagation)return event.currentScope=null,event;scope=scope.$parent}while(scope);return event.currentScope=null,event},$broadcast:function(name,args){var target=this,current=target,next=target,event={name:name,targetScope:target,preventDefault:function(){event.defaultPrevented=!0},defaultPrevented:!1};if(!target.$$listenerCount[name])return event;for(var listeners,i,length,listenerArgs=concat([event],arguments,1);current=next;){for(event.currentScope=current,listeners=current.$$listeners[name]||[],i=0,length=listeners.length;i<length;i++)if(listeners[i])try{listeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}else listeners.splice(i,1),i--,length--;if(!(next=current.$$listenerCount[name]&&current.$$childHead||current!==target&&current.$$nextSibling))for(;current!==target&&!(next=current.$$nextSibling);)current=current.$parent}return event.currentScope=null,event}};var $rootScope=new Scope,asyncQueue=$rootScope.$$asyncQueue=[],postDigestQueue=$rootScope.$$postDigestQueue=[],applyAsyncQueue=$rootScope.$$applyAsyncQueue=[];return $rootScope}]}function $$SanitizeUriProvider(){var aHrefSanitizationWhitelist=/^\s*(https?|ftp|mailto|tel|file):/,imgSrcSanitizationWhitelist=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(regexp){return isDefined(regexp)?(aHrefSanitizationWhitelist=regexp,this):aHrefSanitizationWhitelist},this.imgSrcSanitizationWhitelist=function(regexp){return isDefined(regexp)?(imgSrcSanitizationWhitelist=regexp,this):imgSrcSanitizationWhitelist},this.$get=function(){return function(uri,isImage){var normalizedVal,regex=isImage?imgSrcSanitizationWhitelist:aHrefSanitizationWhitelist;return normalizedVal=urlResolve(uri).href,""===normalizedVal||normalizedVal.match(regex)?uri:"unsafe:"+normalizedVal}}}function adjustMatcher(matcher){if("self"===matcher)return matcher;if(isString(matcher)){if(matcher.indexOf("***")>-1)throw $sceMinErr("iwcard","Illegal sequence *** in string matcher.  String: {0}",matcher);return matcher=escapeForRegexp(matcher).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*"),new RegExp("^"+matcher+"$")}if(isRegExp(matcher))return new RegExp("^"+matcher.source+"$");throw $sceMinErr("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}function adjustMatchers(matchers){var adjustedMatchers=[];return isDefined(matchers)&&forEach(matchers,function(matcher){adjustedMatchers.push(adjustMatcher(matcher))}),adjustedMatchers}function $SceDelegateProvider(){this.SCE_CONTEXTS=SCE_CONTEXTS;var resourceUrlWhitelist=["self"],resourceUrlBlacklist=[];this.resourceUrlWhitelist=function(value){return arguments.length&&(resourceUrlWhitelist=adjustMatchers(value)),resourceUrlWhitelist},this.resourceUrlBlacklist=function(value){return arguments.length&&(resourceUrlBlacklist=adjustMatchers(value)),resourceUrlBlacklist},this.$get=["$injector",function($injector){function matchUrl(matcher,parsedUrl){return"self"===matcher?urlIsSameOrigin(parsedUrl):!!matcher.exec(parsedUrl.href)}function isResourceUrlAllowedByPolicy(url){var i,n,parsedUrl=urlResolve(url.toString()),allowed=!1;for(i=0,n=resourceUrlWhitelist.length;i<n;i++)if(matchUrl(resourceUrlWhitelist[i],parsedUrl)){allowed=!0;break}if(allowed)for(i=0,n=resourceUrlBlacklist.length;i<n;i++)if(matchUrl(resourceUrlBlacklist[i],parsedUrl)){allowed=!1;break}return allowed}function generateHolderType(Base){var holderType=function(trustedValue){this.$$unwrapTrustedValue=function(){return trustedValue}};return Base&&(holderType.prototype=new Base),holderType.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},holderType.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},holderType}function trustAs(type,trustedValue){var Constructor=byType.hasOwnProperty(type)?byType[type]:null;if(!Constructor)throw $sceMinErr("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",type,trustedValue);if(null===trustedValue||isUndefined(trustedValue)||""===trustedValue)return trustedValue;if("string"!=typeof trustedValue)throw $sceMinErr("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",type);return new Constructor(trustedValue)}function valueOf(maybeTrusted){return maybeTrusted instanceof trustedValueHolderBase?maybeTrusted.$$unwrapTrustedValue():maybeTrusted}function getTrusted(type,maybeTrusted){if(null===maybeTrusted||isUndefined(maybeTrusted)||""===maybeTrusted)return maybeTrusted;var constructor=byType.hasOwnProperty(type)?byType[type]:null;if(constructor&&maybeTrusted instanceof constructor)return maybeTrusted.$$unwrapTrustedValue();if(type===SCE_CONTEXTS.RESOURCE_URL){if(isResourceUrlAllowedByPolicy(maybeTrusted))return maybeTrusted;throw $sceMinErr("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",maybeTrusted.toString())}if(type===SCE_CONTEXTS.HTML)return htmlSanitizer(maybeTrusted);throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")}var htmlSanitizer=function(html){throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")};$injector.has("$sanitize")&&(htmlSanitizer=$injector.get("$sanitize"));var trustedValueHolderBase=generateHolderType(),byType={};return byType[SCE_CONTEXTS.HTML]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.CSS]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.URL]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.JS]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.RESOURCE_URL]=generateHolderType(byType[SCE_CONTEXTS.URL]),{trustAs:trustAs,getTrusted:getTrusted,valueOf:valueOf}}]}function $SceProvider(){var enabled=!0;this.enabled=function(value){return arguments.length&&(enabled=!!value),enabled},this.$get=["$parse","$sceDelegate",function($parse,$sceDelegate){if(enabled&&msie<8)throw $sceMinErr("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 11 in quirks mode.  You can fix this by adding the text <!doctype html> to the top of your HTML document.  See http://docs.angularjs.org/api/ng.$sce for more information.");var sce=shallowCopy(SCE_CONTEXTS);sce.isEnabled=function(){return enabled},sce.trustAs=$sceDelegate.trustAs,sce.getTrusted=$sceDelegate.getTrusted,sce.valueOf=$sceDelegate.valueOf,enabled||(sce.trustAs=sce.getTrusted=function(type,value){return value},sce.valueOf=identity),sce.parseAs=function(type,expr){var parsed=$parse(expr);return parsed.literal&&parsed.constant?parsed:$parse(expr,function(value){return sce.getTrusted(type,value)})};var parse=sce.parseAs,getTrusted=sce.getTrusted,trustAs=sce.trustAs;return forEach(SCE_CONTEXTS,function(enumValue,name){var lName=lowercase(name);sce[camelCase("parse_as_"+lName)]=function(expr){return parse(enumValue,expr)},sce[camelCase("get_trusted_"+lName)]=function(value){return getTrusted(enumValue,value)},sce[camelCase("trust_as_"+lName)]=function(value){return trustAs(enumValue,value)}}),sce}]}function $SnifferProvider(){this.$get=["$window","$document",function($window,$document){var vendorPrefix,match,eventSupport={},isChromePackagedApp=$window.chrome&&$window.chrome.app&&$window.chrome.app.runtime,hasHistoryPushState=!isChromePackagedApp&&$window.history&&$window.history.pushState,android=toInt((/android (\d+)/.exec(lowercase(($window.navigator||{}).userAgent))||[])[1]),boxee=/Boxee/i.test(($window.navigator||{}).userAgent),document=$document[0]||{},vendorRegex=/^(Moz|webkit|ms)(?=[A-Z])/,bodyStyle=document.body&&document.body.style,transitions=!1,animations=!1;if(bodyStyle){for(var prop in bodyStyle)if(match=vendorRegex.exec(prop)){vendorPrefix=match[0],vendorPrefix=vendorPrefix.substr(0,1).toUpperCase()+vendorPrefix.substr(1);break}vendorPrefix||(vendorPrefix="WebkitOpacity"in bodyStyle&&"webkit"),transitions=!!("transition"in bodyStyle||vendorPrefix+"Transition"in bodyStyle),animations=!!("animation"in bodyStyle||vendorPrefix+"Animation"in bodyStyle),!android||transitions&&animations||(transitions=isString(bodyStyle.webkitTransition),animations=isString(bodyStyle.webkitAnimation))}return{history:!(!hasHistoryPushState||android<4||boxee),hasEvent:function(event){if("input"===event&&msie<=11)return!1;if(isUndefined(eventSupport[event])){var divElm=document.createElement("div");eventSupport[event]="on"+event in divElm}return eventSupport[event]},csp:csp(),vendorPrefix:vendorPrefix,transitions:transitions,animations:animations,android:android}}]}function $TemplateRequestProvider(){var httpOptions;this.httpOptions=function(val){return val?(httpOptions=val,this):httpOptions},this.$get=["$templateCache","$http","$q","$sce",function($templateCache,$http,$q,$sce){function handleRequestFn(tpl,ignoreRequestError){function handleError(resp){if(!ignoreRequestError)throw $templateRequestMinErr("tpload","Failed to load template: {0} (HTTP status: {1} {2})",tpl,resp.status,resp.statusText);return $q.reject(resp)}handleRequestFn.totalPendingRequests++,isString(tpl)&&$templateCache.get(tpl)||(tpl=$sce.getTrustedResourceUrl(tpl));var transformResponse=$http.defaults&&$http.defaults.transformResponse;return isArray(transformResponse)?transformResponse=transformResponse.filter(function(transformer){return transformer!==defaultHttpResponseTransform}):transformResponse===defaultHttpResponseTransform&&(transformResponse=null),$http.get(tpl,extend({cache:$templateCache,transformResponse:transformResponse},httpOptions)).finally(function(){handleRequestFn.totalPendingRequests--}).then(function(response){return $templateCache.put(tpl,response.data),response.data},handleError)}return handleRequestFn.totalPendingRequests=0,handleRequestFn}]}function $$TestabilityProvider(){this.$get=["$rootScope","$browser","$location",function($rootScope,$browser,$location){var testability={};return testability.findBindings=function(element,expression,opt_exactMatch){var bindings=element.getElementsByClassName("ng-binding"),matches=[];return forEach(bindings,function(binding){var dataBinding=angular.element(binding).data("$binding");dataBinding&&forEach(dataBinding,function(bindingName){if(opt_exactMatch){new RegExp("(^|\\s)"+escapeForRegexp(expression)+"(\\s|\\||$)").test(bindingName)&&matches.push(binding)}else-1!=bindingName.indexOf(expression)&&matches.push(binding)})}),matches},testability.findModels=function(element,expression,opt_exactMatch){for(var prefixes=["ng-","data-ng-","ng\\:"],p=0;p<prefixes.length;++p){var attributeEquals=opt_exactMatch?"=":"*=",selector="["+prefixes[p]+"model"+attributeEquals+'"'+expression+'"]',elements=element.querySelectorAll(selector);if(elements.length)return elements}},testability.getLocation=function(){return $location.url()},testability.setLocation=function(url){url!==$location.url()&&($location.url(url),$rootScope.$digest())},testability.whenStable=function(callback){$browser.notifyWhenNoOutstandingRequests(callback)},testability}]}function $TimeoutProvider(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",function($rootScope,$browser,$q,$$q,$exceptionHandler){function timeout(fn,delay,invokeApply){isFunction(fn)||(invokeApply=delay,delay=fn,fn=noop);var timeoutId,args=sliceArgs(arguments,3),skipApply=isDefined(invokeApply)&&!invokeApply,deferred=(skipApply?$$q:$q).defer(),promise=deferred.promise;return timeoutId=$browser.defer(function(){try{deferred.resolve(fn.apply(null,args))}catch(e){deferred.reject(e),$exceptionHandler(e)}finally{delete deferreds[promise.$$timeoutId]}skipApply||$rootScope.$apply()},delay),promise.$$timeoutId=timeoutId,deferreds[timeoutId]=deferred,promise}var deferreds={};return timeout.cancel=function(promise){return!!(promise&&promise.$$timeoutId in deferreds)&&(deferreds[promise.$$timeoutId].reject("canceled"),delete deferreds[promise.$$timeoutId],$browser.defer.cancel(promise.$$timeoutId))},timeout}]}function urlResolve(url){var href=url;return msie&&(urlParsingNode.setAttribute("href",href),href=urlParsingNode.href),urlParsingNode.setAttribute("href",href),{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:"/"===urlParsingNode.pathname.charAt(0)?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}function urlIsSameOrigin(requestUrl){var parsed=isString(requestUrl)?urlResolve(requestUrl):requestUrl;return parsed.protocol===originUrl.protocol&&parsed.host===originUrl.host}function $WindowProvider(){this.$get=valueFn(window)}function $$CookieReader($document){function safeDecodeURIComponent(str){try{return decodeURIComponent(str)}catch(e){return str}}var rawDocument=$document[0]||{},lastCookies={},lastCookieString="";return function(){var cookieArray,cookie,i,index,name,currentCookieString=rawDocument.cookie||"";if(currentCookieString!==lastCookieString)for(lastCookieString=currentCookieString,cookieArray=lastCookieString.split("; "),lastCookies={},i=0;i<cookieArray.length;i++)cookie=cookieArray[i],(index=cookie.indexOf("="))>0&&(name=safeDecodeURIComponent(cookie.substring(0,index)),isUndefined(lastCookies[name])&&(lastCookies[name]=safeDecodeURIComponent(cookie.substring(index+1))));return lastCookies}}function $$CookieReaderProvider(){this.$get=$$CookieReader}function $FilterProvider($provide){function register(name,factory){if(isObject(name)){var filters={};return forEach(name,function(filter,key){filters[key]=register(key,filter)}),filters}return $provide.factory(name+suffix,factory)}var suffix="Filter";this.register=register,this.$get=["$injector",function($injector){return function(name){return $injector.get(name+suffix)}}],register("currency",currencyFilter),register("date",dateFilter),register("filter",filterFilter),register("json",jsonFilter),register("limitTo",limitToFilter),register("lowercase",lowercaseFilter),register("number",numberFilter),register("orderBy",orderByFilter),register("uppercase",uppercaseFilter)}function filterFilter(){return function(array,expression,comparator){if(!isArrayLike(array)){if(null==array)return array;throw minErr("filter")("notarray","Expected array but received: {0}",array)}var predicateFn,matchAgainstAnyProp,expressionType=getTypeForFilter(expression);switch(expressionType){case"function":predicateFn=expression;break;case"boolean":case"null":case"number":case"string":matchAgainstAnyProp=!0;case"object":predicateFn=createPredicateFn(expression,comparator,matchAgainstAnyProp);break;default:return array}return Array.prototype.filter.call(array,predicateFn)}}function createPredicateFn(expression,comparator,matchAgainstAnyProp){var shouldMatchPrimitives=isObject(expression)&&"$"in expression;return!0===comparator?comparator=equals:isFunction(comparator)||(comparator=function(actual,expected){return!isUndefined(actual)&&(null===actual||null===expected?actual===expected:!(isObject(expected)||isObject(actual)&&!hasCustomToString(actual))&&(actual=lowercase(""+actual),expected=lowercase(""+expected),-1!==actual.indexOf(expected)))}),function(item){return shouldMatchPrimitives&&!isObject(item)?deepCompare(item,expression.$,comparator,!1):deepCompare(item,expression,comparator,matchAgainstAnyProp)}}function deepCompare(actual,expected,comparator,matchAgainstAnyProp,dontMatchWholeObject){var actualType=getTypeForFilter(actual),expectedType=getTypeForFilter(expected);if("string"===expectedType&&"!"===expected.charAt(0))return!deepCompare(actual,expected.substring(1),comparator,matchAgainstAnyProp);if(isArray(actual))return actual.some(function(item){return deepCompare(item,expected,comparator,matchAgainstAnyProp)});switch(actualType){case"object":var key;if(matchAgainstAnyProp){for(key in actual)if("$"!==key.charAt(0)&&deepCompare(actual[key],expected,comparator,!0))return!0;return!dontMatchWholeObject&&deepCompare(actual,expected,comparator,!1)}if("object"===expectedType){for(key in expected){var expectedVal=expected[key];if(!isFunction(expectedVal)&&!isUndefined(expectedVal)){var matchAnyProperty="$"===key;if(!deepCompare(matchAnyProperty?actual:actual[key],expectedVal,comparator,matchAnyProperty,matchAnyProperty))return!1}}return!0}return comparator(actual,expected);case"function":return!1;default:return comparator(actual,expected)}}function getTypeForFilter(val){return null===val?"null":typeof val}function currencyFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(amount,currencySymbol,fractionSize){return isUndefined(currencySymbol)&&(currencySymbol=formats.CURRENCY_SYM),isUndefined(fractionSize)&&(fractionSize=formats.PATTERNS[1].maxFrac),null==amount?amount:formatNumber(amount,formats.PATTERNS[1],formats.GROUP_SEP,formats.DECIMAL_SEP,fractionSize).replace(/\u00A4/g,currencySymbol)}}function numberFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(number,fractionSize){return null==number?number:formatNumber(number,formats.PATTERNS[0],formats.GROUP_SEP,formats.DECIMAL_SEP,fractionSize)}}function parse(numStr){var digits,numberOfIntegerDigits,i,j,zeros,exponent=0;for((numberOfIntegerDigits=numStr.indexOf(DECIMAL_SEP))>-1&&(numStr=numStr.replace(DECIMAL_SEP,"")),(i=numStr.search(/e/i))>0?(numberOfIntegerDigits<0&&(numberOfIntegerDigits=i),numberOfIntegerDigits+=+numStr.slice(i+1),numStr=numStr.substring(0,i)):numberOfIntegerDigits<0&&(numberOfIntegerDigits=numStr.length),i=0;numStr.charAt(i)==ZERO_CHAR;i++);if(i==(zeros=numStr.length))digits=[0],numberOfIntegerDigits=1;else{for(zeros--;numStr.charAt(zeros)==ZERO_CHAR;)zeros--;for(numberOfIntegerDigits-=i,digits=[],j=0;i<=zeros;i++,j++)digits[j]=+numStr.charAt(i)}return numberOfIntegerDigits>MAX_DIGITS&&(digits=digits.splice(0,MAX_DIGITS-1),exponent=numberOfIntegerDigits-1,numberOfIntegerDigits=1),{d:digits,e:exponent,i:numberOfIntegerDigits}}function roundNumber(parsedNumber,fractionSize,minFrac,maxFrac){var digits=parsedNumber.d,fractionLen=digits.length-parsedNumber.i;fractionSize=isUndefined(fractionSize)?Math.min(Math.max(minFrac,fractionLen),maxFrac):+fractionSize;var roundAt=fractionSize+parsedNumber.i,digit=digits[roundAt];if(roundAt>0){digits.splice(Math.max(parsedNumber.i,roundAt));for(var j=roundAt;j<digits.length;j++)digits[j]=0}else{fractionLen=Math.max(0,fractionLen),parsedNumber.i=1,digits.length=Math.max(1,roundAt=fractionSize+1),digits[0]=0;for(var i=1;i<roundAt;i++)digits[i]=0}if(digit>=5)if(roundAt-1<0){for(var k=0;k>roundAt;k--)digits.unshift(0),parsedNumber.i++;digits.unshift(1),parsedNumber.i++}else digits[roundAt-1]++;for(;fractionLen<Math.max(0,fractionSize);fractionLen++)digits.push(0);var carry=digits.reduceRight(function(carry,d,i,digits){return d+=carry,digits[i]=d%10,Math.floor(d/10)},0);carry&&(digits.unshift(carry),parsedNumber.i++)}function formatNumber(number,pattern,groupSep,decimalSep,fractionSize){if(!isString(number)&&!isNumber(number)||isNaN(number))return"";var parsedNumber,isInfinity=!isFinite(number),isZero=!1,numStr=Math.abs(number)+"",formattedText="";if(isInfinity)formattedText="";else{parsedNumber=parse(numStr),roundNumber(parsedNumber,fractionSize,pattern.minFrac,pattern.maxFrac);var digits=parsedNumber.d,integerLen=parsedNumber.i,exponent=parsedNumber.e,decimals=[];for(isZero=digits.reduce(function(isZero,d){return isZero&&!d},!0);integerLen<0;)digits.unshift(0),integerLen++;integerLen>0?decimals=digits.splice(integerLen):(decimals=digits,digits=[0]);var groups=[];for(digits.length>=pattern.lgSize&&groups.unshift(digits.splice(-pattern.lgSize).join(""));digits.length>pattern.gSize;)groups.unshift(digits.splice(-pattern.gSize).join(""));digits.length&&groups.unshift(digits.join("")),formattedText=groups.join(groupSep),decimals.length&&(formattedText+=decimalSep+decimals.join("")),exponent&&(formattedText+="e+"+exponent)}return number<0&&!isZero?pattern.negPre+formattedText+pattern.negSuf:pattern.posPre+formattedText+pattern.posSuf}function padNumber(num,digits,trim,negWrap){var neg="";for((num<0||negWrap&&num<=0)&&(negWrap?num=1-num:(num=-num,neg="-")),num=""+num;num.length<digits;)num=ZERO_CHAR+num;return trim&&(num=num.substr(num.length-digits)),neg+num}function dateGetter(name,size,offset,trim,negWrap){return offset=offset||0,function(date){var value=date["get"+name]();return(offset>0||value>-offset)&&(value+=offset),0===value&&-12==offset&&(value=12),padNumber(value,size,trim,negWrap)}}function dateStrGetter(name,shortForm,standAlone){return function(date,formats){var value=date["get"+name]();return formats[uppercase((standAlone?"STANDALONE":"")+(shortForm?"SHORT":"")+name)][value]}}function timeZoneGetter(date,formats,offset){var zone=-1*offset,paddedZone=zone>=0?"+":"";return paddedZone+=padNumber(Math[zone>0?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2)}function getFirstThursdayOfYear(year){var dayOfWeekOnFirst=new Date(year,0,1).getDay();return new Date(year,0,(dayOfWeekOnFirst<=4?5:12)-dayOfWeekOnFirst)}function getThursdayThisWeek(datetime){return new Date(datetime.getFullYear(),datetime.getMonth(),datetime.getDate()+(4-datetime.getDay()))}function weekGetter(size){return function(date){var firstThurs=getFirstThursdayOfYear(date.getFullYear()),thisThurs=getThursdayThisWeek(date),diff=+thisThurs-+firstThurs;return padNumber(1+Math.round(diff/6048e5),size)}}function ampmGetter(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]}function eraGetter(date,formats){return date.getFullYear()<=0?formats.ERAS[0]:formats.ERAS[1]}function longEraGetter(date,formats){return date.getFullYear()<=0?formats.ERANAMES[0]:formats.ERANAMES[1]}function dateFilter($locale){function jsonStringToDate(string){var match;if(match=string.match(R_ISO8601_STR)){var date=new Date(0),tzHour=0,tzMin=0,dateSetter=match[8]?date.setUTCFullYear:date.setFullYear,timeSetter=match[8]?date.setUTCHours:date.setHours;match[9]&&(tzHour=toInt(match[9]+match[10]),tzMin=toInt(match[9]+match[11])),dateSetter.call(date,toInt(match[1]),toInt(match[2])-1,toInt(match[3]));var h=toInt(match[4]||0)-tzHour,m=toInt(match[5]||0)-tzMin,s=toInt(match[6]||0),ms=Math.round(1e3*parseFloat("0."+(match[7]||0)));return timeSetter.call(date,h,m,s,ms),date}return string}var R_ISO8601_STR=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(date,format,timezone){var fn,match,text="",parts=[];if(format=format||"mediumDate",format=$locale.DATETIME_FORMATS[format]||format,isString(date)&&(date=NUMBER_STRING.test(date)?toInt(date):jsonStringToDate(date)),isNumber(date)&&(date=new Date(date)),!isDate(date)||!isFinite(date.getTime()))return date;for(;format;)match=DATE_FORMATS_SPLIT.exec(format),match?(parts=concat(parts,match,1),format=parts.pop()):(parts.push(format),format=null);var dateTimezoneOffset=date.getTimezoneOffset();return timezone&&(dateTimezoneOffset=timezoneToOffset(timezone,dateTimezoneOffset),date=convertTimezoneToLocal(date,timezone,!0)),forEach(parts,function(value){fn=DATE_FORMATS[value],text+=fn?fn(date,$locale.DATETIME_FORMATS,dateTimezoneOffset):"''"===value?"'":value.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),text}}function jsonFilter(){return function(object,spacing){return isUndefined(spacing)&&(spacing=2),toJson(object,spacing)}}function limitToFilter(){return function(input,limit,begin){return limit=Math.abs(Number(limit))===1/0?Number(limit):toInt(limit),isNaN(limit)?input:(isNumber(input)&&(input=input.toString()),isArray(input)||isString(input)?(begin=!begin||isNaN(begin)?0:toInt(begin),begin=begin<0?Math.max(0,input.length+begin):begin,limit>=0?input.slice(begin,begin+limit):0===begin?input.slice(limit,input.length):input.slice(Math.max(0,begin+limit),begin)):input)}}function orderByFilter($parse){function processPredicates(sortPredicate,reverseOrder){return reverseOrder=reverseOrder?-1:1,sortPredicate.map(function(predicate){var descending=1,get=identity;if(isFunction(predicate))get=predicate;else if(isString(predicate)&&("+"!=predicate.charAt(0)&&"-"!=predicate.charAt(0)||(descending="-"==predicate.charAt(0)?-1:1,predicate=predicate.substring(1)),""!==predicate&&(get=$parse(predicate),get.constant))){var key=get();get=function(value){return value[key]}}return{get:get,descending:descending*reverseOrder}})}function isPrimitive(value){switch(typeof value){case"number":case"boolean":case"string":return!0;default:return!1}}function objectValue(value,index){return"function"==typeof value.valueOf&&(value=value.valueOf(),isPrimitive(value))?value:hasCustomToString(value)&&(value=value.toString(),isPrimitive(value))?value:index}function getPredicateValue(value,index){var type=typeof value;return null===value?(type="string",value="null"):"string"===type?value=value.toLowerCase():"object"===type&&(value=objectValue(value,index)),{value:value,type:type}}function compare(v1,v2){var result=0;return v1.type===v2.type?v1.value!==v2.value&&(result=v1.value<v2.value?-1:1):result=v1.type<v2.type?-1:1,result}return function(array,sortPredicate,reverseOrder){function getComparisonObject(value,index){return{value:value,predicateValues:predicates.map(function(predicate){return getPredicateValue(predicate.get(value),index)})}}function doComparison(v1,v2){for(var result=0,index=0,length=predicates.length;index<length&&!(result=compare(v1.predicateValues[index],v2.predicateValues[index])*predicates[index].descending);++index);return result}if(null==array)return array;if(!isArrayLike(array))throw minErr("orderBy")("notarray","Expected array but received: {0}",array);isArray(sortPredicate)||(sortPredicate=[sortPredicate]),0===sortPredicate.length&&(sortPredicate=["+"]);var predicates=processPredicates(sortPredicate,reverseOrder);predicates.push({get:function(){return{}},descending:reverseOrder?-1:1});var compareValues=Array.prototype.map.call(array,getComparisonObject);return compareValues.sort(doComparison),array=compareValues.map(function(item){return item.value})}}function ngDirective(directive){return isFunction(directive)&&(directive={link:directive}),directive.restrict=directive.restrict||"AC",valueFn(directive)}function nullFormRenameControl(control,name){control.$name=name}function FormController(element,attrs,$scope,$animate,$interpolate){var form=this,controls=[];form.$error={},form.$$success={},form.$pending=void 0,form.$name=$interpolate(attrs.name||attrs.ngForm||"")($scope),form.$dirty=!1,form.$pristine=!0,form.$valid=!0,form.$invalid=!1,form.$submitted=!1,form.$$parentForm=nullFormCtrl,form.$rollbackViewValue=function(){forEach(controls,function(control){control.$rollbackViewValue()})},form.$commitViewValue=function(){forEach(controls,function(control){control.$commitViewValue()})},form.$addControl=function(control){assertNotHasOwnProperty(control.$name,"input"),controls.push(control),control.$name&&(form[control.$name]=control),control.$$parentForm=form},form.$$renameControl=function(control,newName){var oldName=control.$name;form[oldName]===control&&delete form[oldName],form[newName]=control,control.$name=newName},form.$removeControl=function(control){control.$name&&form[control.$name]===control&&delete form[control.$name],forEach(form.$pending,function(value,name){form.$setValidity(name,null,control)}),forEach(form.$error,function(value,name){form.$setValidity(name,null,control)}),forEach(form.$$success,function(value,name){form.$setValidity(name,null,control)}),arrayRemove(controls,control),control.$$parentForm=nullFormCtrl},addSetValidityMethod({ctrl:this,$element:element,set:function(object,property,controller){var list=object[property];if(list){-1===list.indexOf(controller)&&list.push(controller)}else object[property]=[controller]},unset:function(object,property,controller){var list=object[property];list&&(arrayRemove(list,controller),0===list.length&&delete object[property])},$animate:$animate}),form.$setDirty=function(){$animate.removeClass(element,PRISTINE_CLASS),$animate.addClass(element,DIRTY_CLASS),form.$dirty=!0,form.$pristine=!1,form.$$parentForm.$setDirty()},form.$setPristine=function(){$animate.setClass(element,PRISTINE_CLASS,DIRTY_CLASS+" "+SUBMITTED_CLASS),form.$dirty=!1,form.$pristine=!0,form.$submitted=!1,forEach(controls,function(control){control.$setPristine()})},form.$setUntouched=function(){forEach(controls,function(control){control.$setUntouched()})},form.$setSubmitted=function(){$animate.addClass(element,SUBMITTED_CLASS),form.$submitted=!0,form.$$parentForm.$setSubmitted()}}function stringBasedInputType(ctrl){ctrl.$formatters.push(function(value){return ctrl.$isEmpty(value)?value:value.toString()})}function textInputType(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl)}function baseInputType(scope,element,attr,ctrl,$sniffer,$browser){var type=lowercase(element[0].type);if(!$sniffer.android){var composing=!1;element.on("compositionstart",function(){composing=!0}),element.on("compositionend",function(){composing=!1,listener()})}var timeout,listener=function(ev){if(timeout&&($browser.defer.cancel(timeout),timeout=null),!composing){var value=element.val(),event=ev&&ev.type;"password"===type||attr.ngTrim&&"false"===attr.ngTrim||(value=trim(value)),(ctrl.$viewValue!==value||""===value&&ctrl.$$hasNativeValidators)&&ctrl.$setViewValue(value,event)}};if($sniffer.hasEvent("input"))element.on("input",listener);else{var deferListener=function(ev,input,origValue){timeout||(timeout=$browser.defer(function(){timeout=null,input&&input.value===origValue||listener(ev)}))};element.on("keydown",function(event){var key=event.keyCode;91===key||15<key&&key<19||37<=key&&key<=40||deferListener(event,this,this.value)}),$sniffer.hasEvent("paste")&&element.on("paste cut",deferListener)}element.on("change",listener),PARTIAL_VALIDATION_TYPES[type]&&ctrl.$$hasNativeValidators&&type===attr.type&&element.on(PARTIAL_VALIDATION_EVENTS,function(ev){if(!timeout){var validity=this[VALIDITY_STATE_PROPERTY],origBadInput=validity.badInput,origTypeMismatch=validity.typeMismatch;timeout=$browser.defer(function(){timeout=null,validity.badInput===origBadInput&&validity.typeMismatch===origTypeMismatch||listener(ev)})}}),ctrl.$render=function(){var value=ctrl.$isEmpty(ctrl.$viewValue)?"":ctrl.$viewValue;element.val()!==value&&element.val(value)}}function weekParser(isoWeek,existingDate){if(isDate(isoWeek))return isoWeek;if(isString(isoWeek)){WEEK_REGEXP.lastIndex=0;var parts=WEEK_REGEXP.exec(isoWeek);if(parts){var year=+parts[1],week=+parts[2],hours=0,minutes=0,seconds=0,milliseconds=0,firstThurs=getFirstThursdayOfYear(year),addDays=7*(week-1);return existingDate&&(hours=existingDate.getHours(),minutes=existingDate.getMinutes(),seconds=existingDate.getSeconds(),milliseconds=existingDate.getMilliseconds()),new Date(year,0,firstThurs.getDate()+addDays,hours,minutes,seconds,milliseconds)}}return NaN}function createDateParser(regexp,mapping){return function(iso,date){var parts,map;if(isDate(iso))return iso;if(isString(iso)){if('"'==iso.charAt(0)&&'"'==iso.charAt(iso.length-1)&&(iso=iso.substring(1,iso.length-1)),ISO_DATE_REGEXP.test(iso))return new Date(iso);if(regexp.lastIndex=0,parts=regexp.exec(iso))return parts.shift(),map=date?{yyyy:date.getFullYear(),MM:date.getMonth()+1,dd:date.getDate(),HH:date.getHours(),mm:date.getMinutes(),ss:date.getSeconds(),sss:date.getMilliseconds()/1e3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},forEach(parts,function(part,index){index<mapping.length&&(map[mapping[index]]=+part)}),new Date(map.yyyy,map.MM-1,map.dd,map.HH,map.mm,map.ss||0,1e3*map.sss||0)}return NaN}}function createDateInputType(type,regexp,parseDate,format){return function(scope,element,attr,ctrl,$sniffer,$browser,$filter){function isValidDate(value){return value&&!(value.getTime&&value.getTime()!==value.getTime())}function parseObservedDateValue(val){return isDefined(val)&&!isDate(val)?parseDate(val)||void 0:val}badInputChecker(scope,element,attr,ctrl),baseInputType(scope,element,attr,ctrl,$sniffer,$browser);var previousDate,timezone=ctrl&&ctrl.$options&&ctrl.$options.timezone;if(ctrl.$$parserName=type,ctrl.$parsers.push(function(value){if(ctrl.$isEmpty(value))return null;if(regexp.test(value)){var parsedDate=parseDate(value,previousDate);return timezone&&(parsedDate=convertTimezoneToLocal(parsedDate,timezone)),parsedDate}}),ctrl.$formatters.push(function(value){if(value&&!isDate(value))throw ngModelMinErr("datefmt","Expected `{0}` to be a date",value);return isValidDate(value)?(previousDate=value,previousDate&&timezone&&(previousDate=convertTimezoneToLocal(previousDate,timezone,!0)),$filter("date")(value,format,timezone)):(previousDate=null,"")}),isDefined(attr.min)||attr.ngMin){var minVal;ctrl.$validators.min=function(value){return!isValidDate(value)||isUndefined(minVal)||parseDate(value)>=minVal},attr.$observe("min",function(val){minVal=parseObservedDateValue(val),ctrl.$validate()})}if(isDefined(attr.max)||attr.ngMax){var maxVal;ctrl.$validators.max=function(value){return!isValidDate(value)||isUndefined(maxVal)||parseDate(value)<=maxVal},attr.$observe("max",function(val){maxVal=parseObservedDateValue(val),ctrl.$validate()})}}}function badInputChecker(scope,element,attr,ctrl){var node=element[0];(ctrl.$$hasNativeValidators=isObject(node.validity))&&ctrl.$parsers.push(function(value){var validity=element.prop(VALIDITY_STATE_PROPERTY)||{};return validity.badInput||validity.typeMismatch?void 0:value})}function numberInputType(scope,element,attr,ctrl,$sniffer,$browser){if(badInputChecker(scope,element,attr,ctrl),baseInputType(scope,element,attr,ctrl,$sniffer,$browser),ctrl.$$parserName="number",ctrl.$parsers.push(function(value){return ctrl.$isEmpty(value)?null:NUMBER_REGEXP.test(value)?parseFloat(value):void 0}),ctrl.$formatters.push(function(value){if(!ctrl.$isEmpty(value)){if(!isNumber(value))throw ngModelMinErr("numfmt","Expected `{0}` to be a number",value);value=value.toString()}return value}),isDefined(attr.min)||attr.ngMin){var minVal;ctrl.$validators.min=function(value){return ctrl.$isEmpty(value)||isUndefined(minVal)||value>=minVal},attr.$observe("min",function(val){isDefined(val)&&!isNumber(val)&&(val=parseFloat(val,10)),minVal=isNumber(val)&&!isNaN(val)?val:void 0,ctrl.$validate()})}if(isDefined(attr.max)||attr.ngMax){var maxVal;ctrl.$validators.max=function(value){return ctrl.$isEmpty(value)||isUndefined(maxVal)||value<=maxVal},attr.$observe("max",function(val){isDefined(val)&&!isNumber(val)&&(val=parseFloat(val,10)),maxVal=isNumber(val)&&!isNaN(val)?val:void 0,ctrl.$validate()})}}function urlInputType(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl),ctrl.$$parserName="url",ctrl.$validators.url=function(modelValue,viewValue){var value=modelValue||viewValue;return ctrl.$isEmpty(value)||URL_REGEXP.test(value)}}function emailInputType(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl),ctrl.$$parserName="email",ctrl.$validators.email=function(modelValue,viewValue){var value=modelValue||viewValue;return ctrl.$isEmpty(value)||EMAIL_REGEXP.test(value)}}function radioInputType(scope,element,attr,ctrl){isUndefined(attr.name)&&element.attr("name",nextUid());var listener=function(ev){element[0].checked&&ctrl.$setViewValue(attr.value,ev&&ev.type)};element.on("click",listener),ctrl.$render=function(){var value=attr.value;element[0].checked=value==ctrl.$viewValue},attr.$observe("value",ctrl.$render)}function parseConstantExpr($parse,context,name,expression,fallback){var parseFn;if(isDefined(expression)){if(parseFn=$parse(expression),!parseFn.constant)throw ngModelMinErr("constexpr","Expected constant expression for `{0}`, but saw `{1}`.",name,expression);return parseFn(context)}return fallback}function checkboxInputType(scope,element,attr,ctrl,$sniffer,$browser,$filter,$parse){var trueValue=parseConstantExpr($parse,scope,"ngTrueValue",attr.ngTrueValue,!0),falseValue=parseConstantExpr($parse,scope,"ngFalseValue",attr.ngFalseValue,!1),listener=function(ev){ctrl.$setViewValue(element[0].checked,ev&&ev.type)};element.on("click",listener),ctrl.$render=function(){element[0].checked=ctrl.$viewValue},ctrl.$isEmpty=function(value){return!1===value},ctrl.$formatters.push(function(value){return equals(value,trueValue)}),ctrl.$parsers.push(function(value){return value?trueValue:falseValue})}function classDirective(name,selector){return name="ngClass"+name,["$animate",function($animate){function arrayDifference(tokens1,tokens2){var values=[];outer:for(var i=0;i<tokens1.length;i++){for(var token=tokens1[i],j=0;j<tokens2.length;j++)if(token==tokens2[j])continue outer;values.push(token)}return values}function arrayClasses(classVal){var classes=[];return isArray(classVal)?(forEach(classVal,function(v){classes=classes.concat(arrayClasses(v))}),classes):isString(classVal)?classVal.split(" "):isObject(classVal)?(forEach(classVal,function(v,k){v&&(classes=classes.concat(k.split(" ")))}),classes):classVal}return{restrict:"AC",link:function(scope,element,attr){function addClasses(classes){var newClasses=digestClassCounts(classes,1);attr.$addClass(newClasses)}function removeClasses(classes){var newClasses=digestClassCounts(classes,-1);attr.$removeClass(newClasses)}function digestClassCounts(classes,count){var classCounts=element.data("$classCounts")||createMap(),classesToUpdate=[];return forEach(classes,function(className){(count>0||classCounts[className])&&(classCounts[className]=(classCounts[className]||0)+count,classCounts[className]===+(count>0)&&classesToUpdate.push(className))}),element.data("$classCounts",classCounts),classesToUpdate.join(" ")}function updateClasses(oldClasses,newClasses){var toAdd=arrayDifference(newClasses,oldClasses),toRemove=arrayDifference(oldClasses,newClasses);toAdd=digestClassCounts(toAdd,1),toRemove=digestClassCounts(toRemove,-1),toAdd&&toAdd.length&&$animate.addClass(element,toAdd),toRemove&&toRemove.length&&$animate.removeClass(element,toRemove)}function ngClassWatchAction(newVal){if(!0===selector||scope.$index%2===selector){var newClasses=arrayClasses(newVal||[]);if(oldVal){if(!equals(newVal,oldVal)){var oldClasses=arrayClasses(oldVal);updateClasses(oldClasses,newClasses)}}else addClasses(newClasses)}oldVal=isArray(newVal)?newVal.map(function(v){return shallowCopy(v)}):shallowCopy(newVal)}var oldVal;scope.$watch(attr[name],ngClassWatchAction,!0),attr.$observe("class",function(value){ngClassWatchAction(scope.$eval(attr[name]))}),"ngClass"!==name&&scope.$watch("$index",function($index,old$index){var mod=1&$index;if(mod!==(1&old$index)){var classes=arrayClasses(scope.$eval(attr[name]));mod===selector?addClasses(classes):removeClasses(classes)}})}}}]}function addSetValidityMethod(context){function setValidity(validationErrorKey,state,controller){isUndefined(state)?createAndSet("$pending",validationErrorKey,controller):unsetAndCleanup("$pending",validationErrorKey,controller),isBoolean(state)?state?(unset(ctrl.$error,validationErrorKey,controller),set(ctrl.$$success,validationErrorKey,controller)):(set(ctrl.$error,validationErrorKey,controller),unset(ctrl.$$success,validationErrorKey,controller)):(unset(ctrl.$error,validationErrorKey,controller),unset(ctrl.$$success,validationErrorKey,controller)),ctrl.$pending?(cachedToggleClass(PENDING_CLASS,!0),ctrl.$valid=ctrl.$invalid=void 0,toggleValidationCss("",null)):(cachedToggleClass(PENDING_CLASS,!1),ctrl.$valid=isObjectEmpty(ctrl.$error),ctrl.$invalid=!ctrl.$valid,toggleValidationCss("",ctrl.$valid));var combinedState;combinedState=ctrl.$pending&&ctrl.$pending[validationErrorKey]?void 0:!ctrl.$error[validationErrorKey]&&(!!ctrl.$$success[validationErrorKey]||null),toggleValidationCss(validationErrorKey,combinedState),ctrl.$$parentForm.$setValidity(validationErrorKey,combinedState,ctrl)}function createAndSet(name,value,controller){ctrl[name]||(ctrl[name]={}),set(ctrl[name],value,controller)}function unsetAndCleanup(name,value,controller){ctrl[name]&&unset(ctrl[name],value,controller),isObjectEmpty(ctrl[name])&&(ctrl[name]=void 0)}function cachedToggleClass(className,switchValue){switchValue&&!classCache[className]?($animate.addClass($element,className),classCache[className]=!0):!switchValue&&classCache[className]&&($animate.removeClass($element,className),classCache[className]=!1)}function toggleValidationCss(validationErrorKey,isValid){validationErrorKey=validationErrorKey?"-"+snake_case(validationErrorKey,"-"):"",cachedToggleClass(VALID_CLASS+validationErrorKey,!0===isValid),cachedToggleClass(INVALID_CLASS+validationErrorKey,!1===isValid)}var ctrl=context.ctrl,$element=context.$element,classCache={},set=context.set,unset=context.unset,$animate=context.$animate;classCache[INVALID_CLASS]=!(classCache[VALID_CLASS]=$element.hasClass(VALID_CLASS)),ctrl.$setValidity=setValidity}function isObjectEmpty(obj){if(obj)for(var prop in obj)if(obj.hasOwnProperty(prop))return!1;return!0}function chromeHack(optionElement){optionElement[0].hasAttribute("selected")&&(optionElement[0].selected=!0)}var REGEX_STRING_REGEXP=/^\/(.+)\/([a-z]*)$/,VALIDITY_STATE_PROPERTY="validity",hasOwnProperty=Object.prototype.hasOwnProperty,lowercase=function(string){return isString(string)?string.toLowerCase():string},uppercase=function(string){return isString(string)?string.toUpperCase():string},manualLowercase=function(s){return isString(s)?s.replace(/[A-Z]/g,function(ch){return String.fromCharCode(32|ch.charCodeAt(0))}):s},manualUppercase=function(s){return isString(s)?s.replace(/[a-z]/g,function(ch){return String.fromCharCode(-33&ch.charCodeAt(0))}):s};"i"!=="I".toLowerCase()&&(lowercase=manualLowercase,uppercase=manualUppercase);var msie,jqLite,jQuery,angularModule,slice=[].slice,splice=[].splice,push=[].push,toString=Object.prototype.toString,getPrototypeOf=Object.getPrototypeOf,ngMinErr=minErr("ng"),angular=window.angular||(window.angular={}),uid=0;msie=window.document.documentMode,noop.$inject=[],identity.$inject=[];var isArray=Array.isArray,TYPED_ARRAY_REGEXP=/^\[object (?:Uint8|Uint8Clamped|Uint16|Uint32|Int8|Int16|Int32|Float32|Float64)Array\]$/,trim=function(value){return isString(value)?value.trim():value},escapeForRegexp=function(s){return s.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},csp=function(){if(!isDefined(csp.rules)){var ngCspElement=window.document.querySelector("[ng-csp]")||window.document.querySelector("[data-ng-csp]");if(ngCspElement){var ngCspAttribute=ngCspElement.getAttribute("ng-csp")||ngCspElement.getAttribute("data-ng-csp");csp.rules={noUnsafeEval:!ngCspAttribute||-1!==ngCspAttribute.indexOf("no-unsafe-eval"),noInlineStyle:!ngCspAttribute||-1!==ngCspAttribute.indexOf("no-inline-style")}}else csp.rules={noUnsafeEval:function(){try{return new Function(""),!1}catch(e){return!0}}(),noInlineStyle:!1}}return csp.rules},jq=function(){if(isDefined(jq.name_))return jq.name_;var el,i,prefix,name,ii=ngAttrPrefixes.length;for(i=0;i<ii;++i)if(prefix=ngAttrPrefixes[i],el=window.document.querySelector("["+prefix.replace(":","\\:")+"jq]")){name=el.getAttribute(prefix+"jq");break}return jq.name_=name},ALL_COLONS=/:/g,ngAttrPrefixes=["ng-","data-ng-","ng:","x-ng-"],SNAKE_CASE_REGEXP=/[A-Z]/g,bindJQueryFired=!1,NODE_TYPE_ELEMENT=1,NODE_TYPE_TEXT=3,NODE_TYPE_COMMENT=8,NODE_TYPE_DOCUMENT=9,NODE_TYPE_DOCUMENT_FRAGMENT=11,version={full:"1.5.5",major:1,minor:5,dot:5,codeName:"material-conspiration"};JQLite.expando="ng339";var jqCache=JQLite.cache={},jqId=1,addEventListenerFn=function(element,type,fn){element.addEventListener(type,fn,!1)},removeEventListenerFn=function(element,type,fn){element.removeEventListener(type,fn,!1)};JQLite._data=function(node){return this.cache[node[this.expando]]||{}};var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,MOUSE_EVENT_MAP={mouseleave:"mouseout",mouseenter:"mouseover"},jqLiteMinErr=minErr("jqLite"),SINGLE_TAG_REGEXP=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,HTML_REGEXP=/<|&#?\w+;/,TAG_NAME_REGEXP=/<([\w:-]+)/,XHTML_TAG_REGEXP=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wrapMap={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;var jqLiteContains=window.Node.prototype.contains||function(arg){return!!(16&this.compareDocumentPosition(arg))},JQLitePrototype=JQLite.prototype={ready:function(fn){function trigger(){fired||(fired=!0,fn())}var fired=!1;"complete"===window.document.readyState?window.setTimeout(trigger):(this.on("DOMContentLoaded",trigger),JQLite(window).on("load",trigger))},toString:function(){var value=[];return forEach(this,function(e){value.push(""+e)}),"["+value.join(", ")+"]"},eq:function(index){return jqLite(index>=0?this[index]:this[this.length+index])},length:0,push:push,sort:[].sort,splice:[].splice},BOOLEAN_ATTR={};forEach("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(value){BOOLEAN_ATTR[lowercase(value)]=value});var BOOLEAN_ELEMENTS={};forEach("input,select,option,textarea,button,form,details".split(","),function(value){BOOLEAN_ELEMENTS[value]=!0});var ALIASED_ATTR={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern"};forEach({data:jqLiteData,removeData:jqLiteRemoveData,hasData:jqLiteHasData,cleanData:jqLiteCleanData},function(fn,name){JQLite[name]=fn}),forEach({data:jqLiteData,inheritedData:jqLiteInheritedData,scope:function(element){return jqLite.data(element,"$scope")||jqLiteInheritedData(element.parentNode||element,["$isolateScope","$scope"])},isolateScope:function(element){return jqLite.data(element,"$isolateScope")||jqLite.data(element,"$isolateScopeNoTemplate")},controller:jqLiteController,injector:function(element){return jqLiteInheritedData(element,"$injector")},removeAttr:function(element,name){element.removeAttribute(name)},hasClass:jqLiteHasClass,css:function(element,name,value){if(name=camelCase(name),!isDefined(value))return element.style[name];element.style[name]=value},attr:function(element,name,value){var nodeType=element.nodeType;if(nodeType!==NODE_TYPE_TEXT&&2!==nodeType&&nodeType!==NODE_TYPE_COMMENT){var lowercasedName=lowercase(name);if(BOOLEAN_ATTR[lowercasedName]){if(!isDefined(value))return element[name]||(element.attributes.getNamedItem(name)||noop).specified?lowercasedName:void 0;value?(element[name]=!0,element.setAttribute(name,lowercasedName)):(element[name]=!1,element.removeAttribute(lowercasedName))}else if(isDefined(value))element.setAttribute(name,value);else if(element.getAttribute){var ret=element.getAttribute(name,2);return null===ret?void 0:ret}}},prop:function(element,name,value){if(!isDefined(value))return element[name];element[name]=value},text:function(){function getText(element,value){if(isUndefined(value)){var nodeType=element.nodeType;return nodeType===NODE_TYPE_ELEMENT||nodeType===NODE_TYPE_TEXT?element.textContent:""}element.textContent=value}return getText.$dv="",getText}(),val:function(element,value){if(isUndefined(value)){if(element.multiple&&"select"===nodeName_(element)){var result=[];return forEach(element.options,function(option){option.selected&&result.push(option.value||option.text)}),0===result.length?null:result}return element.value}element.value=value},html:function(element,value){if(isUndefined(value))return element.innerHTML;jqLiteDealoc(element,!0),element.innerHTML=value},empty:jqLiteEmpty},function(fn,name){JQLite.prototype[name]=function(arg1,arg2){var i,key,nodeCount=this.length;if(fn!==jqLiteEmpty&&isUndefined(2==fn.length&&fn!==jqLiteHasClass&&fn!==jqLiteController?arg1:arg2)){if(isObject(arg1)){for(i=0;i<nodeCount;i++)if(fn===jqLiteData)fn(this[i],arg1);else for(key in arg1)fn(this[i],key,arg1[key]);return this}for(var value=fn.$dv,jj=isUndefined(value)?Math.min(nodeCount,1):nodeCount,j=0;j<jj;j++){var nodeValue=fn(this[j],arg1,arg2);value=value?value+nodeValue:nodeValue}return value}for(i=0;i<nodeCount;i++)fn(this[i],arg1,arg2);return this}}),forEach({removeData:jqLiteRemoveData,on:function(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");if(jqLiteAcceptsData(element)){var expandoStore=jqLiteExpandoStore(element,!0),events=expandoStore.events,handle=expandoStore.handle;handle||(handle=expandoStore.handle=createEventHandler(element,events));for(var types=type.indexOf(" ")>=0?type.split(" "):[type],i=types.length,addHandler=function(type,specialHandlerWrapper,noEventListener){var eventFns=events[type];eventFns||(eventFns=events[type]=[],eventFns.specialHandlerWrapper=specialHandlerWrapper,"$destroy"===type||noEventListener||addEventListenerFn(element,type,handle)),eventFns.push(fn)};i--;)type=types[i],MOUSE_EVENT_MAP[type]?(addHandler(MOUSE_EVENT_MAP[type],specialMouseHandlerWrapper),addHandler(type,void 0,!0)):addHandler(type)}},off:jqLiteOff,one:function(element,type,fn){element=jqLite(element),element.on(type,function onFn(){element.off(type,fn),element.off(type,onFn)}),element.on(type,fn)},replaceWith:function(element,replaceNode){var index,parent=element.parentNode;jqLiteDealoc(element),forEach(new JQLite(replaceNode),function(node){index?parent.insertBefore(node,index.nextSibling):parent.replaceChild(node,element),index=node})},children:function(element){var children=[];return forEach(element.childNodes,function(element){element.nodeType===NODE_TYPE_ELEMENT&&children.push(element)}),children},contents:function(element){return element.contentDocument||element.childNodes||[]},append:function(element,node){var nodeType=element.nodeType;if(nodeType===NODE_TYPE_ELEMENT||nodeType===NODE_TYPE_DOCUMENT_FRAGMENT){node=new JQLite(node);for(var i=0,ii=node.length;i<ii;i++){var child=node[i];element.appendChild(child)}}},prepend:function(element,node){if(element.nodeType===NODE_TYPE_ELEMENT){var index=element.firstChild;forEach(new JQLite(node),function(child){element.insertBefore(child,index)})}},wrap:function(element,wrapNode){jqLiteWrapNode(element,jqLite(wrapNode).eq(0).clone()[0])},remove:jqLiteRemove,detach:function(element){jqLiteRemove(element,!0)},after:function(element,newElement){var index=element,parent=element.parentNode;newElement=new JQLite(newElement);for(var i=0,ii=newElement.length;i<ii;i++){var node=newElement[i];parent.insertBefore(node,index.nextSibling),index=node}},addClass:jqLiteAddClass,removeClass:jqLiteRemoveClass,toggleClass:function(element,selector,condition){selector&&forEach(selector.split(" "),function(className){var classCondition=condition;isUndefined(classCondition)&&(classCondition=!jqLiteHasClass(element,className)),(classCondition?jqLiteAddClass:jqLiteRemoveClass)(element,className)})},parent:function(element){var parent=element.parentNode;return parent&&parent.nodeType!==NODE_TYPE_DOCUMENT_FRAGMENT?parent:null},next:function(element){return element.nextElementSibling},find:function(element,selector){return element.getElementsByTagName?element.getElementsByTagName(selector):[]},clone:jqLiteClone,triggerHandler:function(element,event,extraParameters){var dummyEvent,eventFnsCopy,handlerArgs,eventName=event.type||event,expandoStore=jqLiteExpandoStore(element),events=expandoStore&&expandoStore.events,eventFns=events&&events[eventName];eventFns&&(dummyEvent={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},stopPropagation:noop,type:eventName,target:element},event.type&&(dummyEvent=extend(dummyEvent,event)),eventFnsCopy=shallowCopy(eventFns),handlerArgs=extraParameters?[dummyEvent].concat(extraParameters):[dummyEvent],forEach(eventFnsCopy,function(fn){dummyEvent.isImmediatePropagationStopped()||fn.apply(element,handlerArgs)}))}},function(fn,name){JQLite.prototype[name]=function(arg1,arg2,arg3){for(var value,i=0,ii=this.length;i<ii;i++)isUndefined(value)?(value=fn(this[i],arg1,arg2,arg3),isDefined(value)&&(value=jqLite(value))):jqLiteAddNodes(value,fn(this[i],arg1,arg2,arg3));return isDefined(value)?value:this},JQLite.prototype.bind=JQLite.prototype.on,JQLite.prototype.unbind=JQLite.prototype.off}),HashMap.prototype={put:function(key,value){this[hashKey(key,this.nextUid)]=value},get:function(key){return this[hashKey(key,this.nextUid)]},remove:function(key){var value=this[key=hashKey(key,this.nextUid)];return delete this[key],value}};var $$HashMapProvider=[function(){this.$get=[function(){return HashMap}]}],ARROW_ARG=/^([^\(]+?)=>/,FN_ARGS=/^[^\(]*\(\s*([^\)]*)\)/m,FN_ARG_SPLIT=/,/,FN_ARG=/^\s*(_?)(\S+?)\1\s*$/,STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,$injectorMinErr=minErr("$injector");createInjector.$$annotate=annotate;var $animateMinErr=minErr("$animate"),ELEMENT_NODE=1,$$CoreAnimateJsProvider=function(){this.$get=noop},$$CoreAnimateQueueProvider=function(){var postDigestQueue=new HashMap,postDigestElements=[];this.$get=["$$AnimateRunner","$rootScope",function($$AnimateRunner,$rootScope){function updateData(data,classes,value){var changed=!1;return classes&&(classes=isString(classes)?classes.split(" "):isArray(classes)?classes:[],forEach(classes,function(className){className&&(changed=!0,data[className]=value)})),changed}function handleCSSClassChanges(){forEach(postDigestElements,function(element){var data=postDigestQueue.get(element);if(data){var existing=splitClasses(element.attr("class")),toAdd="",toRemove="";forEach(data,function(status,className){status!==!!existing[className]&&(status?toAdd+=(toAdd.length?" ":"")+className:toRemove+=(toRemove.length?" ":"")+className)}),forEach(element,function(elm){toAdd&&jqLiteAddClass(elm,toAdd),toRemove&&jqLiteRemoveClass(elm,toRemove)}),postDigestQueue.remove(element)}}),postDigestElements.length=0}function addRemoveClassesPostDigest(element,add,remove){var data=postDigestQueue.get(element)||{},classesAdded=updateData(data,add,!0),classesRemoved=updateData(data,remove,!1);(classesAdded||classesRemoved)&&(postDigestQueue.put(element,data),postDigestElements.push(element),1===postDigestElements.length&&$rootScope.$$postDigest(handleCSSClassChanges))}return{enabled:noop,on:noop,off:noop,pin:noop,push:function(element,event,options,domOperation){domOperation&&domOperation(),options=options||{},options.from&&element.css(options.from),options.to&&element.css(options.to),(options.addClass||options.removeClass)&&addRemoveClassesPostDigest(element,options.addClass,options.removeClass);var runner=new $$AnimateRunner;return runner.complete(),runner}}}]},$AnimateProvider=["$provide",function($provide){var provider=this;this.$$registeredAnimations=Object.create(null),this.register=function(name,factory){if(name&&"."!==name.charAt(0))throw $animateMinErr("notcsel","Expecting class selector starting with '.' got '{0}'.",name);var key=name+"-animation";provider.$$registeredAnimations[name.substr(1)]=key,$provide.factory(key,factory)},this.classNameFilter=function(expression){if(1===arguments.length&&(this.$$classNameFilter=expression instanceof RegExp?expression:null,this.$$classNameFilter)){if(new RegExp("(\\s+|\\/)ng-animate(\\s+|\\/)").test(this.$$classNameFilter.toString()))throw $animateMinErr("nongcls",'$animateProvider.classNameFilter(regex) prohibits accepting a regex value which matches/contains the "{0}" CSS class.',"ng-animate")}return this.$$classNameFilter},this.$get=["$$animateQueue",function($$animateQueue){function domInsert(element,parentElement,afterElement){if(afterElement){var afterNode=extractElementNode(afterElement);!afterNode||afterNode.parentNode||afterNode.previousElementSibling||(afterElement=null)}afterElement?afterElement.after(element):parentElement.prepend(element)}return{on:$$animateQueue.on,off:$$animateQueue.off,pin:$$animateQueue.pin,enabled:$$animateQueue.enabled,cancel:function(runner){runner.end&&runner.end()},enter:function(element,parent,after,options){return parent=parent&&jqLite(parent),after=after&&jqLite(after),parent=parent||after.parent(),domInsert(element,parent,after),$$animateQueue.push(element,"enter",prepareAnimateOptions(options))},move:function(element,parent,after,options){return parent=parent&&jqLite(parent),after=after&&jqLite(after),parent=parent||after.parent(),domInsert(element,parent,after),$$animateQueue.push(element,"move",prepareAnimateOptions(options))},leave:function(element,options){return $$animateQueue.push(element,"leave",prepareAnimateOptions(options),function(){element.remove()})},addClass:function(element,className,options){return options=prepareAnimateOptions(options),options.addClass=mergeClasses(options.addclass,className),$$animateQueue.push(element,"addClass",options)},removeClass:function(element,className,options){return options=prepareAnimateOptions(options),options.removeClass=mergeClasses(options.removeClass,className),$$animateQueue.push(element,"removeClass",options)},setClass:function(element,add,remove,options){return options=prepareAnimateOptions(options),options.addClass=mergeClasses(options.addClass,add),options.removeClass=mergeClasses(options.removeClass,remove),$$animateQueue.push(element,"setClass",options)},animate:function(element,from,to,className,options){return options=prepareAnimateOptions(options),options.from=options.from?extend(options.from,from):from,options.to=options.to?extend(options.to,to):to,className=className||"ng-inline-animate",options.tempClasses=mergeClasses(options.tempClasses,className),$$animateQueue.push(element,"animate",options)}}}]}],$$AnimateAsyncRunFactoryProvider=function(){this.$get=["$$rAF",function($$rAF){function waitForTick(fn){waitQueue.push(fn),waitQueue.length>1||$$rAF(function(){for(var i=0;i<waitQueue.length;i++)waitQueue[i]();waitQueue=[]})}var waitQueue=[];return function(){var passed=!1;return waitForTick(function(){passed=!0}),function(callback){passed?callback():waitForTick(callback)}}}]},$$AnimateRunnerFactoryProvider=function(){this.$get=["$q","$sniffer","$$animateAsyncRun","$document","$timeout",function($q,$sniffer,$$animateAsyncRun,$document,$timeout){function AnimateRunner(host){this.setHost(host);var rafTick=$$animateAsyncRun(),timeoutTick=function(fn){$timeout(fn,0,!1)};this._doneCallbacks=[],this._tick=function(fn){var doc=$document[0];doc&&doc.hidden?timeoutTick(fn):rafTick(fn)},this._state=0}return AnimateRunner.chain=function(chain,callback){function next(){if(index===chain.length)return void callback(!0);chain[index](function(response){if(!1===response)return void callback(!1);index++,next()})}var index=0;next()},AnimateRunner.all=function(runners,callback){function onProgress(response){status=status&&response,++count===runners.length&&callback(status)}var count=0,status=!0;forEach(runners,function(runner){runner.done(onProgress)})},AnimateRunner.prototype={setHost:function(host){this.host=host||{}},done:function(fn){2===this._state?fn():this._doneCallbacks.push(fn)},progress:noop,getPromise:function(){if(!this.promise){var self=this;this.promise=$q(function(resolve,reject){self.done(function(status){!1===status?reject():resolve()})})}return this.promise},then:function(resolveHandler,rejectHandler){return this.getPromise().then(resolveHandler,rejectHandler)},catch:function(handler){return this.getPromise().catch(handler)},finally:function(handler){return this.getPromise().finally(handler)},pause:function(){this.host.pause&&this.host.pause()},resume:function(){this.host.resume&&this.host.resume()},end:function(){this.host.end&&this.host.end(),this._resolve(!0)},cancel:function(){this.host.cancel&&this.host.cancel(),this._resolve(!1)},complete:function(response){var self=this;0===self._state&&(self._state=1,self._tick(function(){self._resolve(response)}))},_resolve:function(response){2!==this._state&&(forEach(this._doneCallbacks,function(fn){fn(response)}),this._doneCallbacks.length=0,this._state=2)}},AnimateRunner}]},$CoreAnimateCssProvider=function(){this.$get=["$$rAF","$q","$$AnimateRunner",function($$rAF,$q,$$AnimateRunner){return function(element,initialOptions){function run(){return $$rAF(function(){applyAnimationContents(),closed||runner.complete(),closed=!0}),runner}function applyAnimationContents(){options.addClass&&(element.addClass(options.addClass),options.addClass=null),options.removeClass&&(element.removeClass(options.removeClass),options.removeClass=null),options.to&&(element.css(options.to),options.to=null)}var options=initialOptions||{};options.$$prepared||(options=copy(options)),options.cleanupStyles&&(options.from=options.to=null),options.from&&(element.css(options.from),options.from=null);var closed,runner=new $$AnimateRunner;return{start:run,end:run}}}]},$compileMinErr=minErr("$compile"),_UNINITIALIZED_VALUE=new UNINITIALIZED_VALUE;$CompileProvider.$inject=["$provide","$$sanitizeUriProvider"],SimpleChange.prototype.isFirstChange=function(){return this.previousValue===_UNINITIALIZED_VALUE};var PREFIX_REGEXP=/^((?:x|data)[\:\-_])/i,$controllerMinErr=minErr("$controller"),CNTRL_REG=/^(\S+)(\s+as\s+([\w$]+))?$/,$$ForceReflowProvider=function(){this.$get=["$document",function($document){return function(domNode){return domNode?!domNode.nodeType&&domNode instanceof jqLite&&(domNode=domNode[0]):domNode=$document[0].body,domNode.offsetWidth+1}}]},APPLICATION_JSON="application/json",CONTENT_TYPE_APPLICATION_JSON={"Content-Type":APPLICATION_JSON+";charset=utf-8"},JSON_START=/^\[|^\{(?!\{)/,JSON_ENDS={"[":/]$/,"{":/}$/},JSON_PROTECTION_PREFIX=/^\)\]\}',?\n/,$httpMinErr=minErr("$http"),$httpMinErrLegacyFn=function(method){return function(){throw $httpMinErr("legacy","The method `{0}` on the promise returned from `$http` has been disabled.",method)}},$interpolateMinErr=angular.$interpolateMinErr=minErr("$interpolate");$interpolateMinErr.throwNoconcat=function(text){throw $interpolateMinErr("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows interpolations that concatenate multiple expressions when a trusted value is required.  See http://docs.angularjs.org/api/ng.$sce",text)},$interpolateMinErr.interr=function(text,err){return $interpolateMinErr("interr","Can't interpolate: {0}\n{1}",text,err.toString())};var PATH_MATCH=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,DEFAULT_PORTS={http:80,https:443,ftp:21},$locationMinErr=minErr("$location"),locationPrototype={$$html5:!1,$$replace:!1,absUrl:locationGetter("$$absUrl"),url:function(url){if(isUndefined(url))return this.$$url;var match=PATH_MATCH.exec(url);return(match[1]||""===url)&&this.path(decodeURIComponent(match[1])),(match[2]||match[1]||""===url)&&this.search(match[3]||""),this.hash(match[5]||""),this},protocol:locationGetter("$$protocol"),host:locationGetter("$$host"),port:locationGetter("$$port"),path:locationGetterSetter("$$path",function(path){return path=null!==path?path.toString():"","/"==path.charAt(0)?path:"/"+path}),search:function(search,paramValue){switch(arguments.length){case 0:return this.$$search;case 1:if(isString(search)||isNumber(search))search=search.toString(),this.$$search=parseKeyValue(search);else{if(!isObject(search))throw $locationMinErr("isrcharg","The first argument of the `$location#search()` call must be a string or an object.");search=copy(search,{}),forEach(search,function(value,key){null==value&&delete search[key]}),this.$$search=search}break;default:isUndefined(paramValue)||null===paramValue?delete this.$$search[search]:this.$$search[search]=paramValue}return this.$$compose(),this},hash:locationGetterSetter("$$hash",function(hash){return null!==hash?hash.toString():""}),replace:function(){return this.$$replace=!0,this}};forEach([LocationHashbangInHtml5Url,LocationHashbangUrl,LocationHtml5Url],function(Location){Location.prototype=Object.create(locationPrototype),Location.prototype.state=function(state){if(!arguments.length)return this.$$state;if(Location!==LocationHtml5Url||!this.$$html5)throw $locationMinErr("nostate","History API state support is available only in HTML5 mode and only in browsers supporting HTML5 History API");return this.$$state=isUndefined(state)?null:state,this}});var $parseMinErr=minErr("$parse"),CALL=Function.prototype.call,APPLY=Function.prototype.apply,BIND=Function.prototype.bind,OPERATORS=createMap();forEach("+ - * / % === !== == != < > <= >= && || ! = |".split(" "),function(operator){OPERATORS[operator]=!0});var ESCAPE={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},Lexer=function(options){this.options=options};Lexer.prototype={constructor:Lexer,lex:function(text){for(this.text=text,this.index=0,this.tokens=[];this.index<this.text.length;){var ch=this.text.charAt(this.index);if('"'===ch||"'"===ch)this.readString(ch);else if(this.isNumber(ch)||"."===ch&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdentifierStart(this.peekMultichar()))this.readIdent();else if(this.is(ch,"(){}[].,;:?"))this.tokens.push({index:this.index,text:ch}),this.index++;else if(this.isWhitespace(ch))this.index++;else{var ch2=ch+this.peek(),ch3=ch2+this.peek(2),op1=OPERATORS[ch],op2=OPERATORS[ch2],op3=OPERATORS[ch3];if(op1||op2||op3){var token=op3?ch3:op2?ch2:ch;this.tokens.push({index:this.index,text:token,operator:!0}),this.index+=token.length}else this.throwError("Unexpected next character ",this.index,this.index+1)}}return this.tokens},is:function(ch,chars){return-1!==chars.indexOf(ch)},peek:function(i){var num=i||1;return this.index+num<this.text.length&&this.text.charAt(this.index+num)},isNumber:function(ch){return"0"<=ch&&ch<="9"&&"string"==typeof ch},isWhitespace:function(ch){return" "===ch||"\r"===ch||"\t"===ch||"\n"===ch||"\v"===ch||""===ch},isIdentifierStart:function(ch){return this.options.isIdentifierStart?this.options.isIdentifierStart(ch,this.codePointAt(ch)):this.isValidIdentifierStart(ch)},isValidIdentifierStart:function(ch){return"a"<=ch&&ch<="z"||"A"<=ch&&ch<="Z"||"_"===ch||"$"===ch},isIdentifierContinue:function(ch){return this.options.isIdentifierContinue?this.options.isIdentifierContinue(ch,this.codePointAt(ch)):this.isValidIdentifierContinue(ch)},isValidIdentifierContinue:function(ch,cp){return this.isValidIdentifierStart(ch,cp)||this.isNumber(ch)},codePointAt:function(ch){return 1===ch.length?ch.charCodeAt(0):(ch.charCodeAt(0)<<10)+ch.charCodeAt(1)-56613888},peekMultichar:function(){var ch=this.text.charAt(this.index),peek=this.peek();if(!peek)return ch;var cp1=ch.charCodeAt(0),cp2=peek.charCodeAt(0);return cp1>=55296&&cp1<=56319&&cp2>=56320&&cp2<=57343?ch+peek:ch},isExpOperator:function(ch){return"-"===ch||"+"===ch||this.isNumber(ch)},throwError:function(error,start,end){end=end||this.index;var colStr=isDefined(start)?"s "+start+"-"+this.index+" ["+this.text.substring(start,end)+"]":" "+end;throw $parseMinErr("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",error,colStr,this.text)},readNumber:function(){for(var number="",start=this.index;this.index<this.text.length;){var ch=lowercase(this.text.charAt(this.index));if("."==ch||this.isNumber(ch))number+=ch;else{var peekCh=this.peek();if("e"==ch&&this.isExpOperator(peekCh))number+=ch;else if(this.isExpOperator(ch)&&peekCh&&this.isNumber(peekCh)&&"e"==number.charAt(number.length-1))number+=ch;else{if(!this.isExpOperator(ch)||peekCh&&this.isNumber(peekCh)||"e"!=number.charAt(number.length-1))break;this.throwError("Invalid exponent")}}this.index++}this.tokens.push({index:start,text:number,constant:!0,value:Number(number)})},readIdent:function(){var start=this.index;for(this.index+=this.peekMultichar().length;this.index<this.text.length;){var ch=this.peekMultichar();if(!this.isIdentifierContinue(ch))break;this.index+=ch.length}this.tokens.push({index:start,text:this.text.slice(start,this.index),identifier:!0})},readString:function(quote){var start=this.index;this.index++;for(var string="",rawString=quote,escape=!1;this.index<this.text.length;){var ch=this.text.charAt(this.index);if(rawString+=ch,escape){if("u"===ch){var hex=this.text.substring(this.index+1,this.index+5);hex.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+hex+"]"),this.index+=4,string+=String.fromCharCode(parseInt(hex,16))}else{string+=ESCAPE[ch]||ch}escape=!1}else if("\\"===ch)escape=!0;else{if(ch===quote)return this.index++,void this.tokens.push({index:start,text:rawString,constant:!0,value:string});string+=ch}this.index++}this.throwError("Unterminated quote",start)}};var AST=function(lexer,options){this.lexer=lexer,this.options=options};AST.Program="Program",AST.ExpressionStatement="ExpressionStatement",AST.AssignmentExpression="AssignmentExpression",AST.ConditionalExpression="ConditionalExpression",AST.LogicalExpression="LogicalExpression",AST.BinaryExpression="BinaryExpression",AST.UnaryExpression="UnaryExpression",AST.CallExpression="CallExpression",AST.MemberExpression="MemberExpression",AST.Identifier="Identifier",AST.Literal="Literal",AST.ArrayExpression="ArrayExpression",AST.Property="Property",AST.ObjectExpression="ObjectExpression",AST.ThisExpression="ThisExpression",AST.LocalsExpression="LocalsExpression",AST.NGValueParameter="NGValueParameter",AST.prototype={ast:function(text){this.text=text,this.tokens=this.lexer.lex(text);var value=this.program();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),value},program:function(){for(var body=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&body.push(this.expressionStatement()),!this.expect(";"))return{type:AST.Program,body:body}},expressionStatement:function(){return{type:AST.ExpressionStatement,expression:this.filterChain()}},filterChain:function(){for(var left=this.expression();this.expect("|");)left=this.filter(left);return left},expression:function(){return this.assignment()},assignment:function(){var result=this.ternary();return this.expect("=")&&(result={type:AST.AssignmentExpression,left:result,right:this.assignment(),operator:"="}),result},ternary:function(){var alternate,consequent,test=this.logicalOR();return this.expect("?")&&(alternate=this.expression(),this.consume(":"))?(consequent=this.expression(),{type:AST.ConditionalExpression,test:test,alternate:alternate,consequent:consequent}):test},logicalOR:function(){for(var left=this.logicalAND();this.expect("||");)left={type:AST.LogicalExpression,operator:"||",left:left,right:this.logicalAND()};return left},logicalAND:function(){for(var left=this.equality();this.expect("&&");)left={type:AST.LogicalExpression,operator:"&&",left:left,right:this.equality()};return left},equality:function(){for(var token,left=this.relational();token=this.expect("==","!=","===","!==");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.relational()};return left},relational:function(){for(var token,left=this.additive();token=this.expect("<",">","<=",">=");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.additive()};return left},additive:function(){for(var token,left=this.multiplicative();token=this.expect("+","-");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.multiplicative()};return left},multiplicative:function(){for(var token,left=this.unary();token=this.expect("*","/","%");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.unary()};return left},unary:function(){var token;return(token=this.expect("+","-","!"))?{type:AST.UnaryExpression,operator:token.text,prefix:!0,argument:this.unary()}:this.primary()},primary:function(){var primary;this.expect("(")?(primary=this.filterChain(),this.consume(")")):this.expect("[")?primary=this.arrayDeclaration():this.expect("{")?primary=this.object():this.selfReferential.hasOwnProperty(this.peek().text)?primary=copy(this.selfReferential[this.consume().text]):this.options.literals.hasOwnProperty(this.peek().text)?primary={type:AST.Literal,value:this.options.literals[this.consume().text]}:this.peek().identifier?primary=this.identifier():this.peek().constant?primary=this.constant():this.throwError("not a primary expression",this.peek());for(var next;next=this.expect("(","[",".");)"("===next.text?(primary={type:AST.CallExpression,callee:primary,arguments:this.parseArguments()},this.consume(")")):"["===next.text?(primary={type:AST.MemberExpression,object:primary,property:this.expression(),computed:!0},this.consume("]")):"."===next.text?primary={type:AST.MemberExpression,object:primary,property:this.identifier(),computed:!1}:this.throwError("IMPOSSIBLE");return primary},filter:function(baseExpression){for(var args=[baseExpression],result={type:AST.CallExpression,callee:this.identifier(),arguments:args,filter:!0};this.expect(":");)args.push(this.expression());return result},parseArguments:function(){var args=[];if(")"!==this.peekToken().text)do{args.push(this.expression())}while(this.expect(","));return args},identifier:function(){var token=this.consume();return token.identifier||this.throwError("is not a valid identifier",token),{type:AST.Identifier,name:token.text}},constant:function(){return{type:AST.Literal,value:this.consume().value}},arrayDeclaration:function(){var elements=[];if("]"!==this.peekToken().text)do{if(this.peek("]"))break;elements.push(this.expression())}while(this.expect(","));return this.consume("]"),{type:AST.ArrayExpression,elements:elements}},object:function(){var property,properties=[];if("}"!==this.peekToken().text)do{if(this.peek("}"))break;property={type:AST.Property,kind:"init"},this.peek().constant?property.key=this.constant():this.peek().identifier?property.key=this.identifier():this.throwError("invalid key",this.peek()),this.consume(":"),property.value=this.expression(),properties.push(property)}while(this.expect(","));return this.consume("}"),{type:AST.ObjectExpression,properties:properties}},throwError:function(msg,token){throw $parseMinErr("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",token.text,msg,token.index+1,this.text,this.text.substring(token.index))},consume:function(e1){if(0===this.tokens.length)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);var token=this.expect(e1);return token||this.throwError("is unexpected, expecting ["+e1+"]",this.peek()),token},peekToken:function(){if(0===this.tokens.length)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e1,e2,e3,e4){return this.peekAhead(0,e1,e2,e3,e4)},peekAhead:function(i,e1,e2,e3,e4){if(this.tokens.length>i){var token=this.tokens[i],t=token.text;if(t===e1||t===e2||t===e3||t===e4||!e1&&!e2&&!e3&&!e4)return token}return!1},expect:function(e1,e2,e3,e4){var token=this.peek(e1,e2,e3,e4);return!!token&&(this.tokens.shift(),token)},selfReferential:{this:{type:AST.ThisExpression},$locals:{type:AST.LocalsExpression}}},ASTCompiler.prototype={compile:function(expression,expensiveChecks){var self=this,ast=this.astBuilder.ast(expression);this.state={nextId:0,filters:{},expensiveChecks:expensiveChecks,fn:{vars:[],body:[],own:{}},assign:{vars:[],body:[],own:{}},inputs:[]},findConstantAndWatchExpressions(ast,self.$filter);var assignable,extra="";if(this.stage="assign",assignable=assignableAST(ast)){this.state.computing="assign";var result=this.nextId();this.recurse(assignable,result),this.return_(result),extra="fn.assign="+this.generateFunction("assign","s,v,l")}var toWatch=getInputs(ast.body);self.stage="inputs",forEach(toWatch,function(watch,key){var fnKey="fn"+key;self.state[fnKey]={vars:[],body:[],own:{}},self.state.computing=fnKey;var intoId=self.nextId();self.recurse(watch,intoId),self.return_(intoId),self.state.inputs.push(fnKey),watch.watchId=key}),this.state.computing="fn",this.stage="main",this.recurse(ast);var fnString='"'+this.USE+" "+this.STRICT+'";\n'+this.filterPrefix()+"var fn="+this.generateFunction("fn","s,l,a,i")+extra+this.watchFns()+"return fn;",fn=new Function("$filter","ensureSafeMemberName","ensureSafeObject","ensureSafeFunction","getStringValue","ensureSafeAssignContext","ifDefined","plus","text",fnString)(this.$filter,ensureSafeMemberName,ensureSafeObject,ensureSafeFunction,getStringValue,ensureSafeAssignContext,ifDefined,plusFn,expression);return this.state=this.stage=void 0,fn.literal=isLiteral(ast),fn.constant=isConstant(ast),fn},USE:"use",STRICT:"strict",watchFns:function(){var result=[],fns=this.state.inputs,self=this;return forEach(fns,function(name){result.push("var "+name+"="+self.generateFunction(name,"s"))}),fns.length&&result.push("fn.inputs=["+fns.join(",")+"];"),result.join("")},generateFunction:function(name,params){return"function("+params+"){"+this.varsPrefix(name)+this.body(name)+"};"},filterPrefix:function(){var parts=[],self=this;return forEach(this.state.filters,function(id,filter){parts.push(id+"=$filter("+self.escape(filter)+")")}),parts.length?"var "+parts.join(",")+";":""},varsPrefix:function(section){return this.state[section].vars.length?"var "+this.state[section].vars.join(",")+";":""},body:function(section){return this.state[section].body.join("")},recurse:function(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck){var left,right,args,expression,self=this;if(recursionFn=recursionFn||noop,!skipWatchIdCheck&&isDefined(ast.watchId))return intoId=intoId||this.nextId(),void this.if_("i",this.lazyAssign(intoId,this.computedMember("i",ast.watchId)),this.lazyRecurse(ast,intoId,nameId,recursionFn,create,!0));switch(ast.type){case AST.Program:forEach(ast.body,function(expression,pos){self.recurse(expression.expression,void 0,void 0,function(expr){right=expr}),pos!==ast.body.length-1?self.current().body.push(right,";"):self.return_(right)});break;case AST.Literal:expression=this.escape(ast.value),this.assign(intoId,expression),recursionFn(expression);break;case AST.UnaryExpression:this.recurse(ast.argument,void 0,void 0,function(expr){right=expr}),expression=ast.operator+"("+this.ifDefined(right,0)+")",this.assign(intoId,expression),recursionFn(expression);break;case AST.BinaryExpression:this.recurse(ast.left,void 0,void 0,function(expr){left=expr}),this.recurse(ast.right,void 0,void 0,function(expr){right=expr}),expression="+"===ast.operator?this.plus(left,right):"-"===ast.operator?this.ifDefined(left,0)+ast.operator+this.ifDefined(right,0):"("+left+")"+ast.operator+"("+right+")",this.assign(intoId,expression),recursionFn(expression);break;case AST.LogicalExpression:intoId=intoId||this.nextId(),self.recurse(ast.left,intoId),self.if_("&&"===ast.operator?intoId:self.not(intoId),self.lazyRecurse(ast.right,intoId)),recursionFn(intoId);break;case AST.ConditionalExpression:intoId=intoId||this.nextId(),self.recurse(ast.test,intoId),self.if_(intoId,self.lazyRecurse(ast.alternate,intoId),self.lazyRecurse(ast.consequent,intoId)),recursionFn(intoId);break;case AST.Identifier:intoId=intoId||this.nextId(),nameId&&(nameId.context="inputs"===self.stage?"s":this.assign(this.nextId(),this.getHasOwnProperty("l",ast.name)+"?l:s"),nameId.computed=!1,nameId.name=ast.name),ensureSafeMemberName(ast.name),self.if_("inputs"===self.stage||self.not(self.getHasOwnProperty("l",ast.name)),function(){self.if_("inputs"===self.stage||"s",function(){create&&1!==create&&self.if_(self.not(self.nonComputedMember("s",ast.name)),self.lazyAssign(self.nonComputedMember("s",ast.name),"{}")),self.assign(intoId,self.nonComputedMember("s",ast.name))})},intoId&&self.lazyAssign(intoId,self.nonComputedMember("l",ast.name))),(self.state.expensiveChecks||isPossiblyDangerousMemberName(ast.name))&&self.addEnsureSafeObject(intoId),recursionFn(intoId);break;case AST.MemberExpression:left=nameId&&(nameId.context=this.nextId())||this.nextId(),intoId=intoId||this.nextId(),self.recurse(ast.object,left,void 0,function(){self.if_(self.notNull(left),function(){create&&1!==create&&self.addEnsureSafeAssignContext(left),ast.computed?(right=self.nextId(),self.recurse(ast.property,right),self.getStringValue(right),self.addEnsureSafeMemberName(right),create&&1!==create&&self.if_(self.not(self.computedMember(left,right)),self.lazyAssign(self.computedMember(left,right),"{}")),expression=self.ensureSafeObject(self.computedMember(left,right)),self.assign(intoId,expression),nameId&&(nameId.computed=!0,nameId.name=right)):(ensureSafeMemberName(ast.property.name),create&&1!==create&&self.if_(self.not(self.nonComputedMember(left,ast.property.name)),self.lazyAssign(self.nonComputedMember(left,ast.property.name),"{}")),expression=self.nonComputedMember(left,ast.property.name),(self.state.expensiveChecks||isPossiblyDangerousMemberName(ast.property.name))&&(expression=self.ensureSafeObject(expression)),self.assign(intoId,expression),nameId&&(nameId.computed=!1,nameId.name=ast.property.name))},function(){self.assign(intoId,"undefined")}),recursionFn(intoId)},!!create);break;case AST.CallExpression:intoId=intoId||this.nextId(),ast.filter?(right=self.filter(ast.callee.name),args=[],forEach(ast.arguments,function(expr){var argument=self.nextId();self.recurse(expr,argument),args.push(argument)}),expression=right+"("+args.join(",")+")",self.assign(intoId,expression),recursionFn(intoId)):(right=self.nextId(),left={},args=[],self.recurse(ast.callee,right,left,function(){self.if_(self.notNull(right),function(){self.addEnsureSafeFunction(right),forEach(ast.arguments,function(expr){self.recurse(expr,self.nextId(),void 0,function(argument){args.push(self.ensureSafeObject(argument))})}),left.name?(self.state.expensiveChecks||self.addEnsureSafeObject(left.context),expression=self.member(left.context,left.name,left.computed)+"("+args.join(",")+")"):expression=right+"("+args.join(",")+")",expression=self.ensureSafeObject(expression),self.assign(intoId,expression)},function(){self.assign(intoId,"undefined")}),recursionFn(intoId)}));break;case AST.AssignmentExpression:if(right=this.nextId(),left={},!isAssignable(ast.left))throw $parseMinErr("lval","Trying to assign a value to a non l-value");this.recurse(ast.left,void 0,left,function(){self.if_(self.notNull(left.context),function(){self.recurse(ast.right,right),self.addEnsureSafeObject(self.member(left.context,left.name,left.computed)),self.addEnsureSafeAssignContext(left.context),expression=self.member(left.context,left.name,left.computed)+ast.operator+right,self.assign(intoId,expression),recursionFn(intoId||expression)})},1);break;case AST.ArrayExpression:args=[],forEach(ast.elements,function(expr){self.recurse(expr,self.nextId(),void 0,function(argument){args.push(argument)})}),expression="["+args.join(",")+"]",this.assign(intoId,expression),recursionFn(expression);break;case AST.ObjectExpression:args=[],forEach(ast.properties,function(property){self.recurse(property.value,self.nextId(),void 0,function(expr){args.push(self.escape(property.key.type===AST.Identifier?property.key.name:""+property.key.value)+":"+expr)})}),expression="{"+args.join(",")+"}",this.assign(intoId,expression),recursionFn(expression);break;case AST.ThisExpression:this.assign(intoId,"s"),recursionFn("s");break;case AST.LocalsExpression:this.assign(intoId,"l"),recursionFn("l");break;case AST.NGValueParameter:this.assign(intoId,"v"),recursionFn("v")}},getHasOwnProperty:function(element,property){var key=element+"."+property,own=this.current().own;return own.hasOwnProperty(key)||(own[key]=this.nextId(!1,element+"&&("+this.escape(property)+" in "+element+")")),own[key]},assign:function(id,value){if(id)return this.current().body.push(id,"=",value,";"),id},filter:function(filterName){return this.state.filters.hasOwnProperty(filterName)||(this.state.filters[filterName]=this.nextId(!0)),this.state.filters[filterName]},ifDefined:function(id,defaultValue){return"ifDefined("+id+","+this.escape(defaultValue)+")"},plus:function(left,right){return"plus("+left+","+right+")"},return_:function(id){this.current().body.push("return ",id,";")},if_:function(test,alternate,consequent){if(!0===test)alternate();else{var body=this.current().body;body.push("if(",test,"){"),alternate(),body.push("}"),consequent&&(body.push("else{"),consequent(),body.push("}"))}},not:function(expression){return"!("+expression+")"},notNull:function(expression){return expression+"!=null"},nonComputedMember:function(left,right){var SAFE_IDENTIFIER=/[$_a-zA-Z][$_a-zA-Z0-9]*/,UNSAFE_CHARACTERS=/[^$_a-zA-Z0-9]/g;return SAFE_IDENTIFIER.test(right)?left+"."+right:left+'["'+right.replace(UNSAFE_CHARACTERS,this.stringEscapeFn)+'"]'},computedMember:function(left,right){return left+"["+right+"]"},member:function(left,right,computed){return computed?this.computedMember(left,right):this.nonComputedMember(left,right)},addEnsureSafeObject:function(item){this.current().body.push(this.ensureSafeObject(item),";")},addEnsureSafeMemberName:function(item){this.current().body.push(this.ensureSafeMemberName(item),";")},addEnsureSafeFunction:function(item){this.current().body.push(this.ensureSafeFunction(item),";")},addEnsureSafeAssignContext:function(item){this.current().body.push(this.ensureSafeAssignContext(item),";")},ensureSafeObject:function(item){return"ensureSafeObject("+item+",text)"},ensureSafeMemberName:function(item){return"ensureSafeMemberName("+item+",text)"},ensureSafeFunction:function(item){return"ensureSafeFunction("+item+",text)"},getStringValue:function(item){this.assign(item,"getStringValue("+item+")")},ensureSafeAssignContext:function(item){return"ensureSafeAssignContext("+item+",text)"},lazyRecurse:function(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck){var self=this;return function(){self.recurse(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck)}},lazyAssign:function(id,value){var self=this;return function(){self.assign(id,value)}},stringEscapeRegex:/[^ a-zA-Z0-9]/g,stringEscapeFn:function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)},escape:function(value){if(isString(value))return"'"+value.replace(this.stringEscapeRegex,this.stringEscapeFn)+"'";if(isNumber(value))return value.toString();if(!0===value)return"true";if(!1===value)return"false";if(null===value)return"null";if(void 0===value)return"undefined";throw $parseMinErr("esc","IMPOSSIBLE")},nextId:function(skip,init){var id="v"+this.state.nextId++;return skip||this.current().vars.push(id+(init?"="+init:"")),id},current:function(){return this.state[this.state.computing]}},ASTInterpreter.prototype={compile:function(expression,expensiveChecks){var self=this,ast=this.astBuilder.ast(expression);this.expression=expression,this.expensiveChecks=expensiveChecks,findConstantAndWatchExpressions(ast,self.$filter);var assignable,assign;(assignable=assignableAST(ast))&&(assign=this.recurse(assignable));var inputs,toWatch=getInputs(ast.body);toWatch&&(inputs=[],forEach(toWatch,function(watch,key){var input=self.recurse(watch);watch.input=input,inputs.push(input),watch.watchId=key}));var expressions=[];forEach(ast.body,function(expression){expressions.push(self.recurse(expression.expression))});var fn=0===ast.body.length?noop:1===ast.body.length?expressions[0]:function(scope,locals){var lastValue;return forEach(expressions,function(exp){lastValue=exp(scope,locals)}),lastValue};return assign&&(fn.assign=function(scope,value,locals){return assign(scope,locals,value)}),inputs&&(fn.inputs=inputs),fn.literal=isLiteral(ast),fn.constant=isConstant(ast),fn},recurse:function(ast,context,create){var left,right,args,self=this;if(ast.input)return this.inputs(ast.input,ast.watchId);switch(ast.type){case AST.Literal:return this.value(ast.value,context);case AST.UnaryExpression:return right=this.recurse(ast.argument),this["unary"+ast.operator](right,context);case AST.BinaryExpression:case AST.LogicalExpression:return left=this.recurse(ast.left),right=this.recurse(ast.right),this["binary"+ast.operator](left,right,context);case AST.ConditionalExpression:return this["ternary?:"](this.recurse(ast.test),this.recurse(ast.alternate),this.recurse(ast.consequent),context);case AST.Identifier:return ensureSafeMemberName(ast.name,self.expression),self.identifier(ast.name,self.expensiveChecks||isPossiblyDangerousMemberName(ast.name),context,create,self.expression);case AST.MemberExpression:return left=this.recurse(ast.object,!1,!!create),ast.computed||(ensureSafeMemberName(ast.property.name,self.expression),right=ast.property.name),ast.computed&&(right=this.recurse(ast.property)),ast.computed?this.computedMember(left,right,context,create,self.expression):this.nonComputedMember(left,right,self.expensiveChecks,context,create,self.expression);case AST.CallExpression:return args=[],forEach(ast.arguments,function(expr){args.push(self.recurse(expr))}),ast.filter&&(right=this.$filter(ast.callee.name)),ast.filter||(right=this.recurse(ast.callee,!0)),ast.filter?function(scope,locals,assign,inputs){for(var values=[],i=0;i<args.length;++i)values.push(args[i](scope,locals,assign,inputs));var value=right.apply(void 0,values,inputs);return context?{context:void 0,name:void 0,value:value}:value}:function(scope,locals,assign,inputs){var value,rhs=right(scope,locals,assign,inputs);if(null!=rhs.value){ensureSafeObject(rhs.context,self.expression),ensureSafeFunction(rhs.value,self.expression);for(var values=[],i=0;i<args.length;++i)values.push(ensureSafeObject(args[i](scope,locals,assign,inputs),self.expression));value=ensureSafeObject(rhs.value.apply(rhs.context,values),self.expression)}return context?{value:value}:value};case AST.AssignmentExpression:return left=this.recurse(ast.left,!0,1),right=this.recurse(ast.right),function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs);return ensureSafeObject(lhs.value,self.expression),ensureSafeAssignContext(lhs.context),lhs.context[lhs.name]=rhs,context?{value:rhs}:rhs};case AST.ArrayExpression:return args=[],forEach(ast.elements,function(expr){args.push(self.recurse(expr))}),function(scope,locals,assign,inputs){for(var value=[],i=0;i<args.length;++i)value.push(args[i](scope,locals,assign,inputs));return context?{value:value}:value};case AST.ObjectExpression:return args=[],forEach(ast.properties,function(property){args.push({key:property.key.type===AST.Identifier?property.key.name:""+property.key.value,value:self.recurse(property.value)})}),function(scope,locals,assign,inputs){for(var value={},i=0;i<args.length;++i)value[args[i].key]=args[i].value(scope,locals,assign,inputs);return context?{value:value}:value};case AST.ThisExpression:return function(scope){return context?{value:scope}:scope};case AST.LocalsExpression:return function(scope,locals){return context?{value:locals}:locals};case AST.NGValueParameter:return function(scope,locals,assign){return context?{value:assign}:assign}}},"unary+":function(argument,context){return function(scope,locals,assign,inputs){var arg=argument(scope,locals,assign,inputs);return arg=isDefined(arg)?+arg:0,context?{value:arg}:arg}},"unary-":function(argument,context){return function(scope,locals,assign,inputs){var arg=argument(scope,locals,assign,inputs);return arg=isDefined(arg)?-arg:0,context?{value:arg}:arg}},"unary!":function(argument,context){return function(scope,locals,assign,inputs){var arg=!argument(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary+":function(left,right,context){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs),arg=plusFn(lhs,rhs);return context?{value:arg}:arg}},"binary-":function(left,right,context){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs),arg=(isDefined(lhs)?lhs:0)-(isDefined(rhs)?rhs:0);return context?{value:arg}:arg}},"binary*":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)*right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary/":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)/right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary%":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)%right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary===":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)===right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary!==":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)!==right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary==":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)==right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary!=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)!=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary<":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)<right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary>":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)>right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary<=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)<=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary>=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)>=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary&&":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)&&right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary||":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)||right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"ternary?:":function(test,alternate,consequent,context){return function(scope,locals,assign,inputs){var arg=test(scope,locals,assign,inputs)?alternate(scope,locals,assign,inputs):consequent(scope,locals,assign,inputs);return context?{value:arg}:arg}},value:function(value,context){return function(){return context?{context:void 0,name:void 0,value:value}:value}},identifier:function(name,expensiveChecks,context,create,expression){return function(scope,locals,assign,inputs){var base=locals&&name in locals?locals:scope;create&&1!==create&&base&&!base[name]&&(base[name]={});var value=base?base[name]:void 0;return expensiveChecks&&ensureSafeObject(value,expression),context?{context:base,name:name,value:value}:value}},computedMember:function(left,right,context,create,expression){return function(scope,locals,assign,inputs){var rhs,value,lhs=left(scope,locals,assign,inputs);return null!=lhs&&(rhs=right(scope,locals,assign,inputs),rhs=getStringValue(rhs),ensureSafeMemberName(rhs,expression),create&&1!==create&&(ensureSafeAssignContext(lhs),lhs&&!lhs[rhs]&&(lhs[rhs]={})),value=lhs[rhs],ensureSafeObject(value,expression)),context?{context:lhs,name:rhs,value:value}:value}},nonComputedMember:function(left,right,expensiveChecks,context,create,expression){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs);create&&1!==create&&(ensureSafeAssignContext(lhs),lhs&&!lhs[right]&&(lhs[right]={}));var value=null!=lhs?lhs[right]:void 0;return(expensiveChecks||isPossiblyDangerousMemberName(right))&&ensureSafeObject(value,expression),context?{context:lhs,name:right,value:value}:value}},inputs:function(input,watchId){return function(scope,value,locals,inputs){return inputs?inputs[watchId]:input(scope,value,locals)}}};var Parser=function(lexer,$filter,options){this.lexer=lexer,this.$filter=$filter,this.options=options,this.ast=new AST(lexer,options),this.astCompiler=options.csp?new ASTInterpreter(this.ast,$filter):new ASTCompiler(this.ast,$filter)};Parser.prototype={constructor:Parser,parse:function(text){return this.astCompiler.compile(text,this.options.expensiveChecks)}};var objectValueOf=Object.prototype.valueOf,$sceMinErr=minErr("$sce"),SCE_CONTEXTS={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},$templateRequestMinErr=minErr("$compile"),urlParsingNode=window.document.createElement("a"),originUrl=urlResolve(window.location.href);$$CookieReader.$inject=["$document"],$FilterProvider.$inject=["$provide"];var MAX_DIGITS=22,DECIMAL_SEP=".",ZERO_CHAR="0";currencyFilter.$inject=["$locale"],numberFilter.$inject=["$locale"];var DATE_FORMATS={yyyy:dateGetter("FullYear",4,0,!1,!0),yy:dateGetter("FullYear",2,0,!0,!0),y:dateGetter("FullYear",1,0,!1,!0),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",!0),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),LLLL:dateStrGetter("Month",!1,!0),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",!0),a:ampmGetter,Z:timeZoneGetter,ww:weekGetter(2),w:weekGetter(1),G:eraGetter,GG:eraGetter,GGG:eraGetter,GGGG:longEraGetter},DATE_FORMATS_SPLIT=/((?:[^yMLdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|m+|s+|a|Z|G+|w+))(.*)/,NUMBER_STRING=/^\-?\d+$/;dateFilter.$inject=["$locale"];var lowercaseFilter=valueFn(lowercase),uppercaseFilter=valueFn(uppercase);orderByFilter.$inject=["$parse"];var htmlAnchorDirective=valueFn({restrict:"E",compile:function(element,attr){if(!attr.href&&!attr.xlinkHref)return function(scope,element){if("a"===element[0].nodeName.toLowerCase()){var href="[object SVGAnimatedString]"===toString.call(element.prop("href"))?"xlink:href":"href";element.on("click",function(event){element.attr(href)||event.preventDefault()})}}}}),ngAttributeAliasDirectives={};forEach(BOOLEAN_ATTR,function(propName,attrName){function defaultLinkFn(scope,element,attr){scope.$watch(attr[normalized],function(value){attr.$set(attrName,!!value)})}if("multiple"!=propName){var normalized=directiveNormalize("ng-"+attrName),linkFn=defaultLinkFn;"checked"===propName&&(linkFn=function(scope,element,attr){attr.ngModel!==attr[normalized]&&defaultLinkFn(scope,element,attr)}),ngAttributeAliasDirectives[normalized]=function(){return{restrict:"A",priority:100,link:linkFn}}}}),forEach(ALIASED_ATTR,function(htmlAttr,ngAttr){ngAttributeAliasDirectives[ngAttr]=function(){return{priority:100,link:function(scope,element,attr){if("ngPattern"===ngAttr&&"/"==attr.ngPattern.charAt(0)){var match=attr.ngPattern.match(REGEX_STRING_REGEXP);if(match)return void attr.$set("ngPattern",new RegExp(match[1],match[2]))}scope.$watch(attr[ngAttr],function(value){attr.$set(ngAttr,value)})}}}}),forEach(["src","srcset","href"],function(attrName){var normalized=directiveNormalize("ng-"+attrName);ngAttributeAliasDirectives[normalized]=function(){return{priority:99,link:function(scope,element,attr){var propName=attrName,name=attrName;"href"===attrName&&"[object SVGAnimatedString]"===toString.call(element.prop("href"))&&(name="xlinkHref",attr.$attr[name]="xlink:href",propName=null),attr.$observe(normalized,function(value){if(!value)return void("href"===attrName&&attr.$set(name,null));attr.$set(name,value),msie&&propName&&element.prop(propName,attr[name])})}}}});var nullFormCtrl={$addControl:noop,$$renameControl:nullFormRenameControl,$removeControl:noop,$setValidity:noop,$setDirty:noop,$setPristine:noop,$setSubmitted:noop},SUBMITTED_CLASS="ng-submitted";FormController.$inject=["$element","$attrs","$scope","$animate","$interpolate"];var formDirectiveFactory=function(isNgForm){return["$timeout","$parse",function($timeout,$parse){function getSetter(expression){return""===expression?$parse('this[""]').assign:$parse(expression).assign||noop}return{name:"form",restrict:isNgForm?"EAC":"E",require:["form","^^?form"],controller:FormController,compile:function(formElement,attr){formElement.addClass(PRISTINE_CLASS).addClass(VALID_CLASS);var nameAttr=attr.name?"name":!(!isNgForm||!attr.ngForm)&&"ngForm";return{pre:function(scope,formElement,attr,ctrls){var controller=ctrls[0];if(!("action"in attr)){var handleFormSubmission=function(event){scope.$apply(function(){controller.$commitViewValue(),controller.$setSubmitted()}),event.preventDefault()};addEventListenerFn(formElement[0],"submit",handleFormSubmission),formElement.on("$destroy",function(){$timeout(function(){removeEventListenerFn(formElement[0],"submit",handleFormSubmission)},0,!1)})}(ctrls[1]||controller.$$parentForm).$addControl(controller);var setter=nameAttr?getSetter(controller.$name):noop;nameAttr&&(setter(scope,controller),attr.$observe(nameAttr,function(newValue){controller.$name!==newValue&&(setter(scope,void 0),controller.$$parentForm.$$renameControl(controller,newValue),(setter=getSetter(controller.$name))(scope,controller))})),formElement.on("$destroy",function(){controller.$$parentForm.$removeControl(controller),setter(scope,void 0),extend(controller,nullFormCtrl)})}}}}}]},formDirective=formDirectiveFactory(),ngFormDirective=formDirectiveFactory(!0),ISO_DATE_REGEXP=/^\d{4,}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+(?:[+-][0-2]\d:[0-5]\d|Z)$/,URL_REGEXP=/^[a-z][a-z\d.+-]*:\/*(?:[^:@]+(?::[^@]+)?@)?(?:[^\s:\/?#]+|\[[a-f\d:]+\])(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/i,EMAIL_REGEXP=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/,DATE_REGEXP=/^(\d{4,})-(\d{2})-(\d{2})$/,DATETIMELOCAL_REGEXP=/^(\d{4,})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,WEEK_REGEXP=/^(\d{4,})-W(\d\d)$/,MONTH_REGEXP=/^(\d{4,})-(\d\d)$/,TIME_REGEXP=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,PARTIAL_VALIDATION_EVENTS="keydown wheel mousedown",PARTIAL_VALIDATION_TYPES=createMap();forEach("date,datetime-local,month,time,week".split(","),function(type){PARTIAL_VALIDATION_TYPES[type]=!0});var inputType={text:textInputType,date:createDateInputType("date",DATE_REGEXP,createDateParser(DATE_REGEXP,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":createDateInputType("datetimelocal",DATETIMELOCAL_REGEXP,createDateParser(DATETIMELOCAL_REGEXP,["yyyy","MM","dd","HH","mm","ss","sss"]),"yyyy-MM-ddTHH:mm:ss.sss"),time:createDateInputType("time",TIME_REGEXP,createDateParser(TIME_REGEXP,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:createDateInputType("week",WEEK_REGEXP,weekParser,"yyyy-Www"),month:createDateInputType("month",MONTH_REGEXP,createDateParser(MONTH_REGEXP,["yyyy","MM"]),"yyyy-MM"),number:numberInputType,url:urlInputType,email:emailInputType,radio:radioInputType,checkbox:checkboxInputType,hidden:noop,button:noop,submit:noop,reset:noop,file:noop},inputDirective=["$browser","$sniffer","$filter","$parse",function($browser,$sniffer,$filter,$parse){return{restrict:"E",require:["?ngModel"],link:{pre:function(scope,element,attr,ctrls){ctrls[0]&&(inputType[lowercase(attr.type)]||inputType.text)(scope,element,attr,ctrls[0],$sniffer,$browser,$filter,$parse)}}}}],CONSTANT_VALUE_REGEXP=/^(true|false|\d+)$/,ngValueDirective=function(){return{restrict:"A",priority:100,compile:function(tpl,tplAttr){return CONSTANT_VALUE_REGEXP.test(tplAttr.ngValue)?function(scope,elm,attr){attr.$set("value",scope.$eval(attr.ngValue))}:function(scope,elm,attr){scope.$watch(attr.ngValue,function(value){attr.$set("value",value)})}}}},ngBindDirective=["$compile",function($compile){return{restrict:"AC",compile:function(templateElement){return $compile.$$addBindingClass(templateElement),function(scope,element,attr){$compile.$$addBindingInfo(element,attr.ngBind),element=element[0],scope.$watch(attr.ngBind,function(value){element.textContent=isUndefined(value)?"":value})}}}}],ngBindTemplateDirective=["$interpolate","$compile",function($interpolate,$compile){return{compile:function(templateElement){return $compile.$$addBindingClass(templateElement),function(scope,element,attr){var interpolateFn=$interpolate(element.attr(attr.$attr.ngBindTemplate));$compile.$$addBindingInfo(element,interpolateFn.expressions),element=element[0],attr.$observe("ngBindTemplate",function(value){element.textContent=isUndefined(value)?"":value})}}}}],ngBindHtmlDirective=["$sce","$parse","$compile",function($sce,$parse,$compile){return{restrict:"A",compile:function(tElement,tAttrs){var ngBindHtmlGetter=$parse(tAttrs.ngBindHtml),ngBindHtmlWatch=$parse(tAttrs.ngBindHtml,function(value){return(value||"").toString()});return $compile.$$addBindingClass(tElement),function(scope,element,attr){$compile.$$addBindingInfo(element,attr.ngBindHtml),scope.$watch(ngBindHtmlWatch,function(){element.html($sce.getTrustedHtml(ngBindHtmlGetter(scope))||"")})}}}}],ngChangeDirective=valueFn({restrict:"A",require:"ngModel",link:function(scope,element,attr,ctrl){ctrl.$viewChangeListeners.push(function(){scope.$eval(attr.ngChange)})}}),ngClassDirective=classDirective("",!0),ngClassOddDirective=classDirective("Odd",0),ngClassEvenDirective=classDirective("Even",1),ngCloakDirective=ngDirective({compile:function(element,attr){attr.$set("ngCloak",void 0),element.removeClass("ng-cloak")}}),ngControllerDirective=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],ngEventDirectives={},forceAsyncEvents={blur:!0,focus:!0};forEach("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(eventName){var directiveName=directiveNormalize("ng-"+eventName);ngEventDirectives[directiveName]=["$parse","$rootScope",function($parse,$rootScope){return{restrict:"A",compile:function($element,attr){var fn=$parse(attr[directiveName],null,!0);return function(scope,element){element.on(eventName,function(event){var callback=function(){fn(scope,{$event:event})};forceAsyncEvents[eventName]&&$rootScope.$$phase?scope.$evalAsync(callback):scope.$apply(callback)})}}}}]});var ngIfDirective=["$animate","$compile",function($animate,$compile){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function($scope,$element,$attr,ctrl,$transclude){var block,childScope,previousElements;$scope.$watch($attr.ngIf,function(value){value?childScope||$transclude(function(clone,newScope){childScope=newScope,clone[clone.length++]=$compile.$$createComment("end ngIf",$attr.ngIf),block={clone:clone},$animate.enter(clone,$element.parent(),$element)}):(previousElements&&(previousElements.remove(),previousElements=null),childScope&&(childScope.$destroy(),childScope=null),block&&(previousElements=getBlockNodes(block.clone),$animate.leave(previousElements).then(function(){previousElements=null}),block=null))})}}}],ngIncludeDirective=["$templateRequest","$anchorScroll","$animate",function($templateRequest,$anchorScroll,$animate){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:angular.noop,compile:function(element,attr){var srcExp=attr.ngInclude||attr.src,onloadExp=attr.onload||"",autoScrollExp=attr.autoscroll;return function(scope,$element,$attr,ctrl,$transclude){var currentScope,previousElement,currentElement,changeCounter=0,cleanupLastIncludeContent=function(){previousElement&&(previousElement.remove(),previousElement=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&($animate.leave(currentElement).then(function(){previousElement=null}),previousElement=currentElement,currentElement=null)};scope.$watch(srcExp,function(src){var afterAnimation=function(){!isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll()},thisChangeId=++changeCounter;src?($templateRequest(src,!0).then(function(response){if(!scope.$$destroyed&&thisChangeId===changeCounter){var newScope=scope.$new();ctrl.template=response;var clone=$transclude(newScope,function(clone){cleanupLastIncludeContent(),$animate.enter(clone,null,$element).then(afterAnimation)});currentScope=newScope,currentElement=clone,currentScope.$emit("$includeContentLoaded",src),scope.$eval(onloadExp)}},function(){scope.$$destroyed||thisChangeId===changeCounter&&(cleanupLastIncludeContent(),scope.$emit("$includeContentError",src))}),scope.$emit("$includeContentRequested",src)):(cleanupLastIncludeContent(),ctrl.template=null)})}}}}],ngIncludeFillContentDirective=["$compile",function($compile){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(scope,$element,$attr,ctrl){if(toString.call($element[0]).match(/SVG/))return $element.empty(),void $compile(jqLiteBuildFragment(ctrl.template,window.document).childNodes)(scope,function(clone){$element.append(clone)},{futureParentElement:$element});$element.html(ctrl.template),$compile($element.contents())(scope)}}}],ngInitDirective=ngDirective({priority:450,compile:function(){return{pre:function(scope,element,attrs){scope.$eval(attrs.ngInit)}}}}),ngListDirective=function(){return{restrict:"A",priority:100,require:"ngModel",link:function(scope,element,attr,ctrl){var ngList=element.attr(attr.$attr.ngList)||", ",trimValues="false"!==attr.ngTrim,separator=trimValues?trim(ngList):ngList,parse=function(viewValue){if(!isUndefined(viewValue)){var list=[];return viewValue&&forEach(viewValue.split(separator),function(value){value&&list.push(trimValues?trim(value):value)}),list}};ctrl.$parsers.push(parse),ctrl.$formatters.push(function(value){if(isArray(value))return value.join(ngList)}),ctrl.$isEmpty=function(value){return!value||!value.length}}}},VALID_CLASS="ng-valid",INVALID_CLASS="ng-invalid",PRISTINE_CLASS="ng-pristine",DIRTY_CLASS="ng-dirty",PENDING_CLASS="ng-pending",ngModelMinErr=minErr("ngModel"),NgModelController=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$rootScope","$q","$interpolate",function($scope,$exceptionHandler,$attr,$element,$parse,$animate,$timeout,$rootScope,$q,$interpolate){this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$$rawModelValue=void 0,this.$validators={},this.$asyncValidators={},this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$untouched=!0,this.$touched=!1,this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$error={},this.$$success={},this.$pending=void 0,this.$name=$interpolate($attr.name||"",!1)($scope),this.$$parentForm=nullFormCtrl;var parserValid,parsedNgModel=$parse($attr.ngModel),parsedNgModelAssign=parsedNgModel.assign,ngModelGet=parsedNgModel,ngModelSet=parsedNgModelAssign,pendingDebounce=null,ctrl=this;this.$$setOptions=function(options){if(ctrl.$options=options,options&&options.getterSetter){var invokeModelGetter=$parse($attr.ngModel+"()"),invokeModelSetter=$parse($attr.ngModel+"($$$p)");ngModelGet=function($scope){var modelValue=parsedNgModel($scope);return isFunction(modelValue)&&(modelValue=invokeModelGetter($scope)),modelValue},ngModelSet=function($scope,newValue){isFunction(parsedNgModel($scope))?invokeModelSetter($scope,{$$$p:newValue}):parsedNgModelAssign($scope,newValue)}}else if(!parsedNgModel.assign)throw ngModelMinErr("nonassign","Expression '{0}' is non-assignable. Element: {1}",$attr.ngModel,startingTag($element))},this.$render=noop,this.$isEmpty=function(value){return isUndefined(value)||""===value||null===value||value!==value},this.$$updateEmptyClasses=function(value){ctrl.$isEmpty(value)?($animate.removeClass($element,"ng-not-empty"),$animate.addClass($element,"ng-empty")):($animate.removeClass($element,"ng-empty"),$animate.addClass($element,"ng-not-empty"))};var currentValidationRunId=0;addSetValidityMethod({ctrl:this,$element:$element,set:function(object,property){object[property]=!0},unset:function(object,property){delete object[property]},$animate:$animate}),this.$setPristine=function(){ctrl.$dirty=!1,ctrl.$pristine=!0,$animate.removeClass($element,DIRTY_CLASS),$animate.addClass($element,PRISTINE_CLASS)},this.$setDirty=function(){ctrl.$dirty=!0,ctrl.$pristine=!1,$animate.removeClass($element,PRISTINE_CLASS),$animate.addClass($element,DIRTY_CLASS),ctrl.$$parentForm.$setDirty()},this.$setUntouched=function(){ctrl.$touched=!1,ctrl.$untouched=!0,$animate.setClass($element,"ng-untouched","ng-touched")},this.$setTouched=function(){ctrl.$touched=!0,ctrl.$untouched=!1,$animate.setClass($element,"ng-touched","ng-untouched")},this.$rollbackViewValue=function(){$timeout.cancel(pendingDebounce),ctrl.$viewValue=ctrl.$$lastCommittedViewValue,ctrl.$render()},this.$validate=function(){if(!isNumber(ctrl.$modelValue)||!isNaN(ctrl.$modelValue)){var viewValue=ctrl.$$lastCommittedViewValue,modelValue=ctrl.$$rawModelValue,prevValid=ctrl.$valid,prevModelValue=ctrl.$modelValue,allowInvalid=ctrl.$options&&ctrl.$options.allowInvalid;ctrl.$$runValidators(modelValue,viewValue,function(allValid){allowInvalid||prevValid===allValid||(ctrl.$modelValue=allValid?modelValue:void 0,ctrl.$modelValue!==prevModelValue&&ctrl.$$writeModelToScope())})}},this.$$runValidators=function(modelValue,viewValue,doneCallback){function setValidity(name,isValid){localValidationRunId===currentValidationRunId&&ctrl.$setValidity(name,isValid)}function validationDone(allValid){localValidationRunId===currentValidationRunId&&doneCallback(allValid)}currentValidationRunId++;var localValidationRunId=currentValidationRunId;return function(){var errorKey=ctrl.$$parserName||"parse";return isUndefined(parserValid)?(setValidity(errorKey,null),!0):(parserValid||(forEach(ctrl.$validators,function(v,name){setValidity(name,null)}),forEach(ctrl.$asyncValidators,function(v,name){setValidity(name,null)})),setValidity(errorKey,parserValid),parserValid)}()&&function(){var syncValidatorsValid=!0;return forEach(ctrl.$validators,function(validator,name){var result=validator(modelValue,viewValue);syncValidatorsValid=syncValidatorsValid&&result,setValidity(name,result)}),!!syncValidatorsValid||(forEach(ctrl.$asyncValidators,function(v,name){setValidity(name,null)}),!1)}()?void function(){var validatorPromises=[],allValid=!0;forEach(ctrl.$asyncValidators,function(validator,name){var promise=validator(modelValue,viewValue);if(!isPromiseLike(promise))throw ngModelMinErr("nopromise","Expected asynchronous validator to return a promise but got '{0}' instead.",promise);setValidity(name,void 0),validatorPromises.push(promise.then(function(){setValidity(name,!0)},function(){allValid=!1,setValidity(name,!1)}))}),validatorPromises.length?$q.all(validatorPromises).then(function(){validationDone(allValid)},noop):validationDone(!0)}():void validationDone(!1)},this.$commitViewValue=function(){var viewValue=ctrl.$viewValue;$timeout.cancel(pendingDebounce),(ctrl.$$lastCommittedViewValue!==viewValue||""===viewValue&&ctrl.$$hasNativeValidators)&&(ctrl.$$updateEmptyClasses(viewValue),ctrl.$$lastCommittedViewValue=viewValue,ctrl.$pristine&&this.$setDirty(),this.$$parseAndValidate())},this.$$parseAndValidate=function(){function writeToModelIfNeeded(){ctrl.$modelValue!==prevModelValue&&ctrl.$$writeModelToScope()}var viewValue=ctrl.$$lastCommittedViewValue,modelValue=viewValue;if(parserValid=!isUndefined(modelValue)||void 0)for(var i=0;i<ctrl.$parsers.length;i++)if(modelValue=ctrl.$parsers[i](modelValue),isUndefined(modelValue)){parserValid=!1;break}isNumber(ctrl.$modelValue)&&isNaN(ctrl.$modelValue)&&(ctrl.$modelValue=ngModelGet($scope));var prevModelValue=ctrl.$modelValue,allowInvalid=ctrl.$options&&ctrl.$options.allowInvalid;ctrl.$$rawModelValue=modelValue,allowInvalid&&(ctrl.$modelValue=modelValue,writeToModelIfNeeded()),ctrl.$$runValidators(modelValue,ctrl.$$lastCommittedViewValue,function(allValid){allowInvalid||(ctrl.$modelValue=allValid?modelValue:void 0,writeToModelIfNeeded())})},this.$$writeModelToScope=function(){ngModelSet($scope,ctrl.$modelValue),forEach(ctrl.$viewChangeListeners,function(listener){try{listener()}catch(e){$exceptionHandler(e)}})},this.$setViewValue=function(value,trigger){ctrl.$viewValue=value,ctrl.$options&&!ctrl.$options.updateOnDefault||ctrl.$$debounceViewValueCommit(trigger)},this.$$debounceViewValueCommit=function(trigger){var debounce,debounceDelay=0,options=ctrl.$options;options&&isDefined(options.debounce)&&(debounce=options.debounce,isNumber(debounce)?debounceDelay=debounce:isNumber(debounce[trigger])?debounceDelay=debounce[trigger]:isNumber(debounce.default)&&(debounceDelay=debounce.default)),$timeout.cancel(pendingDebounce),debounceDelay?pendingDebounce=$timeout(function(){ctrl.$commitViewValue()},debounceDelay):$rootScope.$$phase?ctrl.$commitViewValue():$scope.$apply(function(){ctrl.$commitViewValue()})},$scope.$watch(function(){var modelValue=ngModelGet($scope);if(modelValue!==ctrl.$modelValue&&(ctrl.$modelValue===ctrl.$modelValue||modelValue===modelValue)){ctrl.$modelValue=ctrl.$$rawModelValue=modelValue,parserValid=void 0;for(var formatters=ctrl.$formatters,idx=formatters.length,viewValue=modelValue;idx--;)viewValue=formatters[idx](viewValue);ctrl.$viewValue!==viewValue&&(ctrl.$$updateEmptyClasses(viewValue),ctrl.$viewValue=ctrl.$$lastCommittedViewValue=viewValue,ctrl.$render(),ctrl.$$runValidators(modelValue,viewValue,noop))}return modelValue})}],ngModelDirective=["$rootScope",function($rootScope){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:NgModelController,priority:1,compile:function(element){return element.addClass(PRISTINE_CLASS).addClass("ng-untouched").addClass(VALID_CLASS),{pre:function(scope,element,attr,ctrls){var modelCtrl=ctrls[0],formCtrl=ctrls[1]||modelCtrl.$$parentForm;modelCtrl.$$setOptions(ctrls[2]&&ctrls[2].$options),formCtrl.$addControl(modelCtrl),attr.$observe("name",function(newValue){modelCtrl.$name!==newValue&&modelCtrl.$$parentForm.$$renameControl(modelCtrl,newValue)}),scope.$on("$destroy",function(){modelCtrl.$$parentForm.$removeControl(modelCtrl)})},post:function(scope,element,attr,ctrls){var modelCtrl=ctrls[0];modelCtrl.$options&&modelCtrl.$options.updateOn&&element.on(modelCtrl.$options.updateOn,function(ev){modelCtrl.$$debounceViewValueCommit(ev&&ev.type)}),element.on("blur",function(){modelCtrl.$touched||($rootScope.$$phase?scope.$evalAsync(modelCtrl.$setTouched):scope.$apply(modelCtrl.$setTouched))})}}}}}],DEFAULT_REGEXP=/(\s+|^)default(\s+|$)/,ngModelOptionsDirective=function(){return{restrict:"A",controller:["$scope","$attrs",function($scope,$attrs){var that=this;this.$options=copy($scope.$eval($attrs.ngModelOptions)),isDefined(this.$options.updateOn)?(this.$options.updateOnDefault=!1,this.$options.updateOn=trim(this.$options.updateOn.replace(DEFAULT_REGEXP,function(){return that.$options.updateOnDefault=!0," "}))):this.$options.updateOnDefault=!0}]}},ngNonBindableDirective=ngDirective({terminal:!0,priority:1e3}),ngOptionsMinErr=minErr("ngOptions"),NG_OPTIONS_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,ngOptionsDirective=["$compile","$document","$parse",function($compile,$document,$parse){function parseOptionsExpression(optionsExp,selectElement,scope){function Option(selectValue,viewValue,label,group,disabled){this.selectValue=selectValue,this.viewValue=viewValue,this.label=label,this.group=group,this.disabled=disabled}function getOptionValuesKeys(optionValues){var optionValuesKeys;if(!keyName&&isArrayLike(optionValues))optionValuesKeys=optionValues;else{optionValuesKeys=[];for(var itemKey in optionValues)optionValues.hasOwnProperty(itemKey)&&"$"!==itemKey.charAt(0)&&optionValuesKeys.push(itemKey)}return optionValuesKeys}var match=optionsExp.match(NG_OPTIONS_REGEXP);if(!match)throw ngOptionsMinErr("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",optionsExp,startingTag(selectElement));var valueName=match[5]||match[7],keyName=match[6],selectAs=/ as /.test(match[0])&&match[1],trackBy=match[9],valueFn=$parse(match[2]?match[1]:valueName),selectAsFn=selectAs&&$parse(selectAs),viewValueFn=selectAsFn||valueFn,trackByFn=trackBy&&$parse(trackBy),getTrackByValueFn=trackBy?function(value,locals){return trackByFn(scope,locals)}:function(value){return hashKey(value)},getTrackByValue=function(value,key){return getTrackByValueFn(value,getLocals(value,key))},displayFn=$parse(match[2]||match[1]),groupByFn=$parse(match[3]||""),disableWhenFn=$parse(match[4]||""),valuesFn=$parse(match[8]),locals={},getLocals=keyName?function(value,key){return locals[keyName]=key,locals[valueName]=value,locals}:function(value){return locals[valueName]=value,locals};return{trackBy:trackBy,getTrackByValue:getTrackByValue,getWatchables:$parse(valuesFn,function(optionValues){var watchedArray=[];optionValues=optionValues||[];for(var optionValuesKeys=getOptionValuesKeys(optionValues),optionValuesLength=optionValuesKeys.length,index=0;index<optionValuesLength;index++){var key=optionValues===optionValuesKeys?index:optionValuesKeys[index],value=optionValues[key],locals=getLocals(value,key),selectValue=getTrackByValueFn(value,locals);if(watchedArray.push(selectValue),match[2]||match[1]){var label=displayFn(scope,locals);watchedArray.push(label)}if(match[4]){var disableWhen=disableWhenFn(scope,locals);watchedArray.push(disableWhen)}}return watchedArray}),getOptions:function(){for(var optionItems=[],selectValueMap={},optionValues=valuesFn(scope)||[],optionValuesKeys=getOptionValuesKeys(optionValues),optionValuesLength=optionValuesKeys.length,index=0;index<optionValuesLength;index++){var key=optionValues===optionValuesKeys?index:optionValuesKeys[index],value=optionValues[key],locals=getLocals(value,key),viewValue=viewValueFn(scope,locals),selectValue=getTrackByValueFn(viewValue,locals),label=displayFn(scope,locals),group=groupByFn(scope,locals),disabled=disableWhenFn(scope,locals),optionItem=new Option(selectValue,viewValue,label,group,disabled);optionItems.push(optionItem),selectValueMap[selectValue]=optionItem}return{items:optionItems,selectValueMap:selectValueMap,getOptionFromViewValue:function(value){return selectValueMap[getTrackByValue(value)]},getViewValueFromOption:function(option){return trackBy?angular.copy(option.viewValue):option.viewValue}}}}}function ngOptionsPostLink(scope,selectElement,attr,ctrls){function addOptionElement(option,parent){var optionElement=optionTemplate.cloneNode(!1);parent.appendChild(optionElement),updateOptionElement(option,optionElement)}function updateOptionElement(option,element){option.element=element,element.disabled=option.disabled,option.label!==element.label&&(element.label=option.label,element.textContent=option.label),option.value!==element.value&&(element.value=option.selectValue)}function updateOptions(){var previousValue=options&&selectCtrl.readValue();if(options)for(var i=options.items.length-1;i>=0;i--){var option=options.items[i];jqLiteRemove(option.group?option.element.parentNode:option.element)}options=ngOptions.getOptions();var groupElementMap={};if(providedEmptyOption&&selectElement.prepend(emptyOption),options.items.forEach(function(option){var groupElement;isDefined(option.group)?(groupElement=groupElementMap[option.group],groupElement||(groupElement=optGroupTemplate.cloneNode(!1),listFragment.appendChild(groupElement),groupElement.label=option.group,groupElementMap[option.group]=groupElement),addOptionElement(option,groupElement)):addOptionElement(option,listFragment)}),selectElement[0].appendChild(listFragment),ngModelCtrl.$render(),!ngModelCtrl.$isEmpty(previousValue)){var nextValue=selectCtrl.readValue();(ngOptions.trackBy||multiple?equals(previousValue,nextValue):previousValue===nextValue)||(ngModelCtrl.$setViewValue(nextValue),ngModelCtrl.$render())}}for(var emptyOption,selectCtrl=ctrls[0],ngModelCtrl=ctrls[1],multiple=attr.multiple,i=0,children=selectElement.children(),ii=children.length;i<ii;i++)if(""===children[i].value){emptyOption=children.eq(i);break}var providedEmptyOption=!!emptyOption,unknownOption=jqLite(optionTemplate.cloneNode(!1));unknownOption.val("?");var options,ngOptions=parseOptionsExpression(attr.ngOptions,selectElement,scope),listFragment=$document[0].createDocumentFragment(),renderEmptyOption=function(){providedEmptyOption||selectElement.prepend(emptyOption),selectElement.val(""),emptyOption.prop("selected",!0),emptyOption.attr("selected",!0)},removeEmptyOption=function(){providedEmptyOption||emptyOption.remove()},renderUnknownOption=function(){selectElement.prepend(unknownOption),selectElement.val("?"),unknownOption.prop("selected",!0),unknownOption.attr("selected",!0)},removeUnknownOption=function(){unknownOption.remove()};multiple?(ngModelCtrl.$isEmpty=function(value){return!value||0===value.length},selectCtrl.writeValue=function(value){options.items.forEach(function(option){option.element.selected=!1}),value&&value.forEach(function(item){var option=options.getOptionFromViewValue(item);option&&(option.element.selected=!0)})},selectCtrl.readValue=function(){var selectedValues=selectElement.val()||[],selections=[];return forEach(selectedValues,function(value){var option=options.selectValueMap[value];option&&!option.disabled&&selections.push(options.getViewValueFromOption(option))}),selections},ngOptions.trackBy&&scope.$watchCollection(function(){if(isArray(ngModelCtrl.$viewValue))return ngModelCtrl.$viewValue.map(function(value){return ngOptions.getTrackByValue(value)})},function(){ngModelCtrl.$render()})):(selectCtrl.writeValue=function(value){var option=options.getOptionFromViewValue(value);option?(selectElement[0].value!==option.selectValue&&(removeUnknownOption(),removeEmptyOption(),selectElement[0].value=option.selectValue,option.element.selected=!0),option.element.setAttribute("selected","selected")):null===value||providedEmptyOption?(removeUnknownOption(),renderEmptyOption()):(removeEmptyOption(),renderUnknownOption())},selectCtrl.readValue=function(){var selectedOption=options.selectValueMap[selectElement.val()];return selectedOption&&!selectedOption.disabled?(removeEmptyOption(),removeUnknownOption(),options.getViewValueFromOption(selectedOption)):null},ngOptions.trackBy&&scope.$watch(function(){return ngOptions.getTrackByValue(ngModelCtrl.$viewValue)},function(){ngModelCtrl.$render()})),providedEmptyOption?(emptyOption.remove(),$compile(emptyOption)(scope),emptyOption.removeClass("ng-scope")):emptyOption=jqLite(optionTemplate.cloneNode(!1)),selectElement.empty(),updateOptions(),scope.$watchCollection(ngOptions.getWatchables,updateOptions)}var optionTemplate=window.document.createElement("option"),optGroupTemplate=window.document.createElement("optgroup");return{restrict:"A",terminal:!0,require:["select","ngModel"],link:{pre:function(scope,selectElement,attr,ctrls){ctrls[0].registerOption=noop},post:ngOptionsPostLink}}}],ngPluralizeDirective=["$locale","$interpolate","$log",function($locale,$interpolate,$log){var BRACE=/{}/g,IS_WHEN=/^when(Minus)?(.+)$/;return{link:function(scope,element,attr){function updateElementText(newText){element.text(newText||"")}var lastCount,numberExp=attr.count,whenExp=attr.$attr.when&&element.attr(attr.$attr.when),offset=attr.offset||0,whens=scope.$eval(whenExp)||{},whensExpFns={},startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),braceReplacement=startSymbol+numberExp+"-"+offset+endSymbol,watchRemover=angular.noop;forEach(attr,function(expression,attributeName){var tmpMatch=IS_WHEN.exec(attributeName);if(tmpMatch){var whenKey=(tmpMatch[1]?"-":"")+lowercase(tmpMatch[2]);whens[whenKey]=element.attr(attr.$attr[attributeName])}}),forEach(whens,function(expression,key){whensExpFns[key]=$interpolate(expression.replace(BRACE,braceReplacement))}),scope.$watch(numberExp,function(newVal){var count=parseFloat(newVal),countIsNaN=isNaN(count);if(countIsNaN||count in whens||(count=$locale.pluralCat(count-offset)),count!==lastCount&&!(countIsNaN&&isNumber(lastCount)&&isNaN(lastCount))){watchRemover();var whenExpFn=whensExpFns[count];isUndefined(whenExpFn)?(null!=newVal&&$log.debug("ngPluralize: no rule defined for '"+count+"' in "+whenExp),watchRemover=noop,updateElementText()):watchRemover=scope.$watch(whenExpFn,updateElementText),lastCount=count}})}}}],ngRepeatDirective=["$parse","$animate","$compile",function($parse,$animate,$compile){var ngRepeatMinErr=minErr("ngRepeat"),updateScope=function(scope,index,valueIdentifier,value,keyIdentifier,key,arrayLength){scope[valueIdentifier]=value,keyIdentifier&&(scope[keyIdentifier]=key),scope.$index=index,scope.$first=0===index,scope.$last=index===arrayLength-1,scope.$middle=!(scope.$first||scope.$last),scope.$odd=!(scope.$even=0==(1&index))},getBlockStart=function(block){return block.clone[0]},getBlockEnd=function(block){return block.clone[block.clone.length-1]};return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function($element,$attr){var expression=$attr.ngRepeat,ngRepeatEndComment=$compile.$$createComment("end ngRepeat",expression),match=expression.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!match)throw ngRepeatMinErr("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",expression);var lhs=match[1],rhs=match[2],aliasAs=match[3],trackByExp=match[4];if(!(match=lhs.match(/^(?:(\s*[\$\w]+)|\(\s*([\$\w]+)\s*,\s*([\$\w]+)\s*\))$/)))throw ngRepeatMinErr("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",lhs);var valueIdentifier=match[3]||match[1],keyIdentifier=match[2];if(aliasAs&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(aliasAs)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(aliasAs)))throw ngRepeatMinErr("badident","alias '{0}' is invalid --- must be a valid JS identifier which is not a reserved name.",aliasAs);var trackByExpGetter,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,hashFnLocals={$id:hashKey};return trackByExp?trackByExpGetter=$parse(trackByExp):(trackByIdArrayFn=function(key,value){return hashKey(value)},trackByIdObjFn=function(key){return key}),function($scope,$element,$attr,ctrl,$transclude){trackByExpGetter&&(trackByIdExpFn=function(key,value,index){return keyIdentifier&&(hashFnLocals[keyIdentifier]=key),hashFnLocals[valueIdentifier]=value,hashFnLocals.$index=index,trackByExpGetter($scope,hashFnLocals)});var lastBlockMap=createMap();$scope.$watchCollection(rhs,function(collection){var index,length,nextNode,collectionLength,key,value,trackById,trackByIdFn,collectionKeys,block,nextBlockOrder,elementsToRemove,previousNode=$element[0],nextBlockMap=createMap();if(aliasAs&&($scope[aliasAs]=collection),isArrayLike(collection))collectionKeys=collection,trackByIdFn=trackByIdExpFn||trackByIdArrayFn;else{trackByIdFn=trackByIdExpFn||trackByIdObjFn,collectionKeys=[];for(var itemKey in collection)hasOwnProperty.call(collection,itemKey)&&"$"!==itemKey.charAt(0)&&collectionKeys.push(itemKey)}for(collectionLength=collectionKeys.length,nextBlockOrder=new Array(collectionLength),index=0;index<collectionLength;index++)if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],trackById=trackByIdFn(key,value,index),lastBlockMap[trackById])block=lastBlockMap[trackById],delete lastBlockMap[trackById],nextBlockMap[trackById]=block,nextBlockOrder[index]=block;else{if(nextBlockMap[trackById])throw forEach(nextBlockOrder,function(block){block&&block.scope&&(lastBlockMap[block.id]=block)}),ngRepeatMinErr("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}, Duplicate value: {2}",expression,trackById,value);nextBlockOrder[index]={id:trackById,scope:void 0,clone:void 0},nextBlockMap[trackById]=!0}for(var blockKey in lastBlockMap){if(block=lastBlockMap[blockKey],elementsToRemove=getBlockNodes(block.clone),$animate.leave(elementsToRemove),elementsToRemove[0].parentNode)for(index=0,length=elementsToRemove.length;index<length;index++)elementsToRemove[index].$$NG_REMOVED=!0;block.scope.$destroy()}for(index=0;index<collectionLength;index++)if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],block=nextBlockOrder[index],block.scope){nextNode=previousNode;do{nextNode=nextNode.nextSibling}while(nextNode&&nextNode.$$NG_REMOVED);getBlockStart(block)!=nextNode&&$animate.move(getBlockNodes(block.clone),null,previousNode),previousNode=getBlockEnd(block),updateScope(block.scope,index,valueIdentifier,value,keyIdentifier,key,collectionLength)}else $transclude(function(clone,scope){block.scope=scope;var endNode=ngRepeatEndComment.cloneNode(!1);clone[clone.length++]=endNode,$animate.enter(clone,null,previousNode),previousNode=endNode,block.clone=clone,nextBlockMap[block.id]=block,updateScope(block.scope,index,valueIdentifier,value,keyIdentifier,key,collectionLength)});lastBlockMap=nextBlockMap})}}}}],ngShowDirective=["$animate",function($animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.ngShow,function(value){$animate[value?"removeClass":"addClass"](element,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],ngHideDirective=["$animate",function($animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.ngHide,function(value){$animate[value?"addClass":"removeClass"](element,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],ngStyleDirective=ngDirective(function(scope,element,attr){scope.$watch(attr.ngStyle,function(newStyles,oldStyles){oldStyles&&newStyles!==oldStyles&&forEach(oldStyles,function(val,style){element.css(style,"")}),newStyles&&element.css(newStyles)},!0)}),ngSwitchDirective=["$animate","$compile",function($animate,$compile){return{require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(scope,element,attr,ngSwitchController){var watchExpr=attr.ngSwitch||attr.on,selectedTranscludes=[],selectedElements=[],previousLeaveAnimations=[],selectedScopes=[],spliceFactory=function(array,index){return function(){array.splice(index,1)}};scope.$watch(watchExpr,function(value){var i,ii;for(i=0,ii=previousLeaveAnimations.length;i<ii;++i)$animate.cancel(previousLeaveAnimations[i]);for(previousLeaveAnimations.length=0,i=0,ii=selectedScopes.length;i<ii;++i){var selected=getBlockNodes(selectedElements[i].clone);selectedScopes[i].$destroy();(previousLeaveAnimations[i]=$animate.leave(selected)).then(spliceFactory(previousLeaveAnimations,i))}selectedElements.length=0,selectedScopes.length=0,(selectedTranscludes=ngSwitchController.cases["!"+value]||ngSwitchController.cases["?"])&&forEach(selectedTranscludes,function(selectedTransclude){selectedTransclude.transclude(function(caseElement,selectedScope){selectedScopes.push(selectedScope);var anchor=selectedTransclude.element;caseElement[caseElement.length++]=$compile.$$createComment("end ngSwitchWhen");var block={clone:caseElement};selectedElements.push(block),$animate.enter(caseElement,anchor.parent(),anchor)})})})}}}],ngSwitchWhenDirective=ngDirective({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(scope,element,attrs,ctrl,$transclude){ctrl.cases["!"+attrs.ngSwitchWhen]=ctrl.cases["!"+attrs.ngSwitchWhen]||[],ctrl.cases["!"+attrs.ngSwitchWhen].push({transclude:$transclude,element:element})}}),ngSwitchDefaultDirective=ngDirective({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(scope,element,attr,ctrl,$transclude){ctrl.cases["?"]=ctrl.cases["?"]||[],ctrl.cases["?"].push({transclude:$transclude,element:element})}}),ngTranscludeMinErr=minErr("ngTransclude"),ngTranscludeDirective=ngDirective({restrict:"EAC",link:function($scope,$element,$attrs,controller,$transclude){function ngTranscludeCloneAttachFn(clone){clone.length&&($element.empty(),$element.append(clone))}if($attrs.ngTransclude===$attrs.$attr.ngTransclude&&($attrs.ngTransclude=""),!$transclude)throw ngTranscludeMinErr("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",startingTag($element));$transclude(ngTranscludeCloneAttachFn,null,$attrs.ngTransclude||$attrs.ngTranscludeSlot)}}),scriptDirective=["$templateCache",function($templateCache){return{restrict:"E",terminal:!0,compile:function(element,attr){if("text/ng-template"==attr.type){var templateUrl=attr.id,text=element[0].text;$templateCache.put(templateUrl,text)}}}}],noopNgModelController={$setViewValue:noop,$render:noop},SelectController=["$element","$scope",function($element,$scope){var self=this,optionsMap=new HashMap;self.ngModelCtrl=noopNgModelController,self.unknownOption=jqLite(window.document.createElement("option")),self.renderUnknownOption=function(val){var unknownVal="? "+hashKey(val)+" ?";self.unknownOption.val(unknownVal),$element.prepend(self.unknownOption),$element.val(unknownVal)},$scope.$on("$destroy",function(){self.renderUnknownOption=noop}),self.removeUnknownOption=function(){self.unknownOption.parent()&&self.unknownOption.remove()},self.readValue=function(){return self.removeUnknownOption(),$element.val()},self.writeValue=function(value){self.hasOption(value)?(self.removeUnknownOption(),$element.val(value),""===value&&self.emptyOption.prop("selected",!0)):null==value&&self.emptyOption?(self.removeUnknownOption(),$element.val("")):self.renderUnknownOption(value)},self.addOption=function(value,element){if(element[0].nodeType!==NODE_TYPE_COMMENT){assertNotHasOwnProperty(value,'"option value"'),""===value&&(self.emptyOption=element);var count=optionsMap.get(value)||0;optionsMap.put(value,count+1),self.ngModelCtrl.$render(),chromeHack(element)}},self.removeOption=function(value){var count=optionsMap.get(value);count&&(1===count?(optionsMap.remove(value),""===value&&(self.emptyOption=void 0)):optionsMap.put(value,count-1))},self.hasOption=function(value){return!!optionsMap.get(value)},self.registerOption=function(optionScope,optionElement,optionAttrs,interpolateValueFn,interpolateTextFn){if(interpolateValueFn){var oldVal;optionAttrs.$observe("value",function(newVal){isDefined(oldVal)&&self.removeOption(oldVal),oldVal=newVal,self.addOption(newVal,optionElement)})}else interpolateTextFn?optionScope.$watch(interpolateTextFn,function(newVal,oldVal){optionAttrs.$set("value",newVal),oldVal!==newVal&&self.removeOption(oldVal),self.addOption(newVal,optionElement)}):self.addOption(optionAttrs.value,optionElement);optionElement.on("$destroy",function(){self.removeOption(optionAttrs.value),self.ngModelCtrl.$render()})}}],selectDirective=function(){function selectPreLink(scope,element,attr,ctrls){var ngModelCtrl=ctrls[1];if(ngModelCtrl){var selectCtrl=ctrls[0];if(selectCtrl.ngModelCtrl=ngModelCtrl,element.on("change",function(){scope.$apply(function(){ngModelCtrl.$setViewValue(selectCtrl.readValue())})}),attr.multiple){selectCtrl.readValue=function(){var array=[];return forEach(element.find("option"),function(option){option.selected&&array.push(option.value)}),array},selectCtrl.writeValue=function(value){var items=new HashMap(value);forEach(element.find("option"),function(option){option.selected=isDefined(items.get(option.value))})};var lastView,lastViewRef=NaN;scope.$watch(function(){lastViewRef!==ngModelCtrl.$viewValue||equals(lastView,ngModelCtrl.$viewValue)||(lastView=shallowCopy(ngModelCtrl.$viewValue),ngModelCtrl.$render()),lastViewRef=ngModelCtrl.$viewValue}),ngModelCtrl.$isEmpty=function(value){return!value||0===value.length}}}}function selectPostLink(scope,element,attrs,ctrls){var ngModelCtrl=ctrls[1];if(ngModelCtrl){var selectCtrl=ctrls[0];ngModelCtrl.$render=function(){selectCtrl.writeValue(ngModelCtrl.$viewValue)}}}return{restrict:"E",require:["select","?ngModel"],controller:SelectController,priority:1,link:{pre:selectPreLink,post:selectPostLink}}},optionDirective=["$interpolate",function($interpolate){return{restrict:"E",priority:100,compile:function(element,attr){if(isDefined(attr.value))var interpolateValueFn=$interpolate(attr.value,!0);else{var interpolateTextFn=$interpolate(element.text(),!0);interpolateTextFn||attr.$set("value",element.text())}return function(scope,element,attr){var parent=element.parent(),selectCtrl=parent.data("$selectController")||parent.parent().data("$selectController");selectCtrl&&selectCtrl.registerOption(scope,element,attr,interpolateValueFn,interpolateTextFn)}}}}],styleDirective=valueFn({restrict:"E",terminal:!1}),requiredDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){ctrl&&(attr.required=!0,ctrl.$validators.required=function(modelValue,viewValue){return!attr.required||!ctrl.$isEmpty(viewValue)},attr.$observe("required",function(){ctrl.$validate()}))}}},patternDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var regexp,patternExp=attr.ngPattern||attr.pattern;attr.$observe("pattern",function(regex){if(isString(regex)&&regex.length>0&&(regex=new RegExp("^"+regex+"$")),regex&&!regex.test)throw minErr("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",patternExp,regex,startingTag(elm));regexp=regex||void 0,ctrl.$validate()}),ctrl.$validators.pattern=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(regexp)||regexp.test(viewValue)}}}}},maxlengthDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var maxlength=-1;attr.$observe("maxlength",function(value){var intVal=toInt(value);maxlength=isNaN(intVal)?-1:intVal,ctrl.$validate()}),ctrl.$validators.maxlength=function(modelValue,viewValue){return maxlength<0||ctrl.$isEmpty(viewValue)||viewValue.length<=maxlength}}}}},minlengthDirective=function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var minlength=0;attr.$observe("minlength",function(value){minlength=toInt(value)||0,ctrl.$validate()}),ctrl.$validators.minlength=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||viewValue.length>=minlength}}}}};if(window.angular.bootstrap)return void(window.console&&console.log("WARNING: Tried to load angular more than once."));!function(){var originalCleanData;if(!bindJQueryFired){var jqName=jq();jQuery=isUndefined(jqName)?window.jQuery:jqName?window[jqName]:void 0,jQuery&&jQuery.fn.on?(jqLite=jQuery,extend(jQuery.fn,{scope:JQLitePrototype.scope,isolateScope:JQLitePrototype.isolateScope,controller:JQLitePrototype.controller,injector:JQLitePrototype.injector,inheritedData:JQLitePrototype.inheritedData}),originalCleanData=jQuery.cleanData,jQuery.cleanData=function(elems){for(var events,elem,i=0;null!=(elem=elems[i]);i++)(events=jQuery._data(elem,"events"))&&events.$destroy&&jQuery(elem).triggerHandler("$destroy");originalCleanData(elems)}):jqLite=JQLite,angular.element=jqLite,bindJQueryFired=!0}}(),function(angular){extend(angular,{bootstrap:bootstrap,copy:copy,extend:extend,merge:merge,equals:equals,element:jqLite,forEach:forEach,injector:createInjector,noop:noop,bind:bind,toJson:toJson,fromJson:fromJson,identity:identity,isUndefined:isUndefined,isDefined:isDefined,isString:isString,isFunction:isFunction,isObject:isObject,isNumber:isNumber,isElement:isElement,isArray:isArray,version:version,isDate:isDate,lowercase:lowercase,uppercase:uppercase,callbacks:{counter:0},getTestability:getTestability,$$minErr:minErr,$$csp:csp,reloadWithDebugInfo:reloadWithDebugInfo}),(angularModule=setupModuleLoader(window))("ng",["ngLocale"],["$provide",function($provide){$provide.provider({$$sanitizeUri:$$SanitizeUriProvider}),$provide.provider("$compile",$CompileProvider).directive({a:htmlAnchorDirective,input:inputDirective,textarea:inputDirective,form:formDirective,script:scriptDirective,select:selectDirective,style:styleDirective,option:optionDirective,ngBind:ngBindDirective,ngBindHtml:ngBindHtmlDirective,ngBindTemplate:ngBindTemplateDirective,ngClass:ngClassDirective,ngClassEven:ngClassEvenDirective,ngClassOdd:ngClassOddDirective,ngCloak:ngCloakDirective,ngController:ngControllerDirective,ngForm:ngFormDirective,ngHide:ngHideDirective,ngIf:ngIfDirective,ngInclude:ngIncludeDirective,ngInit:ngInitDirective,ngNonBindable:ngNonBindableDirective,ngPluralize:ngPluralizeDirective,ngRepeat:ngRepeatDirective,ngShow:ngShowDirective,ngStyle:ngStyleDirective,ngSwitch:ngSwitchDirective,ngSwitchWhen:ngSwitchWhenDirective,ngSwitchDefault:ngSwitchDefaultDirective,ngOptions:ngOptionsDirective,ngTransclude:ngTranscludeDirective,ngModel:ngModelDirective,ngList:ngListDirective,ngChange:ngChangeDirective,pattern:patternDirective,ngPattern:patternDirective,required:requiredDirective,ngRequired:requiredDirective,minlength:minlengthDirective,ngMinlength:minlengthDirective,maxlength:maxlengthDirective,ngMaxlength:maxlengthDirective,ngValue:ngValueDirective,ngModelOptions:ngModelOptionsDirective}).directive({ngInclude:ngIncludeFillContentDirective}).directive(ngAttributeAliasDirectives).directive(ngEventDirectives),$provide.provider({$anchorScroll:$AnchorScrollProvider,$animate:$AnimateProvider,$animateCss:$CoreAnimateCssProvider,$$animateJs:$$CoreAnimateJsProvider,$$animateQueue:$$CoreAnimateQueueProvider,$$AnimateRunner:$$AnimateRunnerFactoryProvider,$$animateAsyncRun:$$AnimateAsyncRunFactoryProvider,$browser:$BrowserProvider,$cacheFactory:$CacheFactoryProvider,$controller:$ControllerProvider,$document:$DocumentProvider,$exceptionHandler:$ExceptionHandlerProvider,$filter:$FilterProvider,$$forceReflow:$$ForceReflowProvider,$interpolate:$InterpolateProvider,$interval:$IntervalProvider,$http:$HttpProvider,$httpParamSerializer:$HttpParamSerializerProvider,$httpParamSerializerJQLike:$HttpParamSerializerJQLikeProvider,$httpBackend:$HttpBackendProvider,$xhrFactory:$xhrFactoryProvider,$location:$LocationProvider,$log:$LogProvider,$parse:$ParseProvider,$rootScope:$RootScopeProvider,$q:$QProvider,$$q:$$QProvider,$sce:$SceProvider,$sceDelegate:$SceDelegateProvider,$sniffer:$SnifferProvider,$templateCache:$TemplateCacheProvider,$templateRequest:$TemplateRequestProvider,$$testability:$$TestabilityProvider,$timeout:$TimeoutProvider,$window:$WindowProvider,$$rAF:$$RAFProvider,$$jqLite:$$jqLiteProvider,$$HashMap:$$HashMapProvider,$$cookieReader:$$CookieReaderProvider})}])}(angular),angular.module("ngLocale",[],["$provide",function($provide){function getDecimals(n){n+="";var i=n.indexOf(".");return-1==i?0:n.length-i-1}function getVF(n,opt_precision){var v=opt_precision;void 0===v&&(v=Math.min(getDecimals(n),3));var base=Math.pow(10,v);return{v:v,f:(n*base|0)%base}}var PLURAL_CATEGORY={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};$provide.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"],FIRSTDAYOFWEEK:6,MONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],SHORTDAY:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],SHORTMONTH:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],STANDALONEMONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],WEEKENDRANGE:[5,6],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a",short:"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}]},id:"en-us",localeID:"en_US",pluralCat:function(n,opt_precision){var i=0|n,vf=getVF(n,opt_precision);return 1==i&&0==vf.v?PLURAL_CATEGORY.ONE:PLURAL_CATEGORY.OTHER}})}]),jqLite(window.document).ready(function(){angularInit(window.document,bootstrap)})}(window),!window.angular.$$csp().noInlineStyle&&window.angular.element(document.head).prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>'),function(root,undefined){"use strict";var NODE_JS="undefined"!=typeof module;NODE_JS&&(root=global);var i,j,k,b,HEX_CHARS="0123456789abcdef".split(""),Modules=[{name:"crc32",polynom:3988292384,initValue:-1,bytes:4},{name:"crc16",polynom:40961,initValue:0,bytes:2}];for(i=0;i<Modules.length;++i){var m=Modules[i];for(m.method=function(m){return function(message){return crc(message,m)}}(m),m.table=[],j=0;j<256;++j){for(b=j,k=0;k<8;++k)b=1&b?m.polynom^b>>>1:b>>>1;m.table[j]=b>>>0}}var exports,crc=function(message,module){var notString="string"!=typeof message;notString&&message.constructor==ArrayBuffer&&(message=new Uint8Array(message));var code,i,crc=module.initValue,length=message.length,table=module.table;if(notString)for(i=0;i<length;++i)crc=table[255&(crc^message[i])]^crc>>>8;else for(i=0;i<length;++i)code=message.charCodeAt(i),code<128?crc=table[255&(crc^code)]^crc>>>8:code<2048?(crc=table[255&(crc^(192|code>>6))]^crc>>>8,crc=table[255&(crc^(128|63&code))]^crc>>>8):code<55296||code>=57344?(crc=table[255&(crc^(224|code>>12))]^crc>>>8,crc=table[255&(crc^(128|code>>6&63))]^crc>>>8,crc=table[255&(crc^(128|63&code))]^crc>>>8):(code=65536+((1023&code)<<10|1023&message.charCodeAt(++i)),crc=table[255&(crc^(240|code>>18))]^crc>>>8,crc=table[255&(crc^(128|code>>12&63))]^crc>>>8,crc=table[255&(crc^(128|code>>6&63))]^crc>>>8,crc=table[255&(crc^(128|63&code))]^crc>>>8);crc^=module.initValue;var hex="";return module.bytes>2&&(hex+=HEX_CHARS[crc>>28&15]+HEX_CHARS[crc>>24&15]+HEX_CHARS[crc>>20&15]+HEX_CHARS[crc>>16&15]),hex+=HEX_CHARS[crc>>12&15]+HEX_CHARS[crc>>8&15]+HEX_CHARS[crc>>4&15]+HEX_CHARS[15&crc]};for(!root.HI_CRC32_TEST&&NODE_JS?exports=module.exports={}:root&&(exports=root),i=0;i<Modules.length;++i){var m=Modules[i];exports[m.name]=m.method}}(this),function(root,factory){"function"==typeof define&&define.amd?define([],function(){return root.Pusher=factory()}):"object"==typeof exports?module.exports=factory():root.Pusher=factory()}(this,function(){return function(){function Pusher(app_key,options){checkAppKey(app_key),options=options||{};var self=this;this.key=app_key,this.config=Pusher.Util.extend(Pusher.getGlobalConfig(),options.cluster?Pusher.getClusterConfig(options.cluster):{},options),this.channels=new Pusher.Channels,this.global_emitter=new Pusher.EventsDispatcher,this.sessionID=Math.floor(1e9*Math.random()),this.timeline=new Pusher.Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:Pusher.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:Pusher.Timeline.INFO,version:Pusher.VERSION}),this.config.disableStats||(this.timelineSender=new Pusher.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/jsonp"}));var getStrategy=function(options){var config=Pusher.Util.extend({},self.config,options);return Pusher.StrategyBuilder.build(Pusher.getDefaultStrategy(config),config)};this.connection=new Pusher.ConnectionManager(this.key,Pusher.Util.extend({getStrategy:getStrategy,timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()})),this.connection.bind("connected",function(){self.subscribeAll(),self.timelineSender&&self.timelineSender.send(self.connection.isEncrypted())}),this.connection.bind("message",function(params){var internal=0===params.event.indexOf("pusher_internal:");if(params.channel){var channel=self.channel(params.channel);channel&&channel.handleEvent(params.event,params.data)}internal||self.global_emitter.emit(params.event,params.data)}),this.connection.bind("disconnected",function(){self.channels.disconnect()}),this.connection.bind("error",function(err){Pusher.warn("Error",err)}),Pusher.instances.push(this),this.timeline.info({instances:Pusher.instances.length}),Pusher.isReady&&self.connect()}function checkAppKey(key){null!==key&&void 0!==key||Pusher.warn("Warning","You must pass your app key when you instantiate Pusher.")}var prototype=Pusher.prototype;Pusher.instances=[],Pusher.isReady=!1,Pusher.debug=function(){Pusher.log&&Pusher.log(Pusher.Util.stringify.apply(this,arguments))},Pusher.warn=function(){var message=Pusher.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(message):window.console.log&&window.console.log(message)),Pusher.log&&Pusher.log(message)},Pusher.ready=function(){Pusher.isReady=!0;for(var i=0,l=Pusher.instances.length;i<l;i++)Pusher.instances[i].connect()},prototype.channel=function(name){return this.channels.find(name)},prototype.allChannels=function(){return this.channels.all()},prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var encrypted=this.connection.isEncrypted(),timelineSender=this.timelineSender;this.timelineSenderTimer=new Pusher.PeriodicTimer(6e4,function(){timelineSender.send(encrypted)})}},prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},prototype.bind=function(event_name,callback){return this.global_emitter.bind(event_name,callback),this},prototype.bind_all=function(callback){return this.global_emitter.bind_all(callback),this},prototype.subscribeAll=function(){var channelName;for(channelName in this.channels.channels)this.channels.channels.hasOwnProperty(channelName)&&this.subscribe(channelName)},prototype.subscribe=function(channel_name){var channel=this.channels.add(channel_name,this);return"connected"===this.connection.state&&channel.subscribe(),channel},prototype.unsubscribe=function(channel_name){var channel=this.channels.remove(channel_name);channel&&"connected"===this.connection.state&&channel.unsubscribe()},prototype.send_event=function(event_name,data,channel){return this.connection.send_event(event_name,data,channel)},prototype.isEncrypted=function(){return"https:"===Pusher.Util.getDocument().location.protocol||Boolean(this.config.encrypted)},Pusher.HTTP={},this.Pusher=Pusher}.call(this),function(){function clearTimeout(timer){window.clearTimeout(timer)}function clearInterval(timer){window.clearInterval(timer)}function GenericTimer(set,clear,delay,callback){var self=this;this.clear=clear,this.timer=set(function(){null!==self.timer&&(self.timer=callback(self.timer))},delay)}var prototype=GenericTimer.prototype;prototype.isRunning=function(){return null!==this.timer},prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},Pusher.Timer=function(delay,callback){return new GenericTimer(setTimeout,clearTimeout,delay,function(timer){return callback(),null})},Pusher.PeriodicTimer=function(delay,callback){return new GenericTimer(setInterval,clearInterval,delay,function(timer){return callback(),timer})}}.call(this),function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(callback){return new Pusher.Timer(0,callback)},extend:function(target){for(var i=1;i<arguments.length;i++){var extensions=arguments[i];for(var property in extensions)extensions[property]&&extensions[property].constructor&&extensions[property].constructor===Object?target[property]=Pusher.Util.extend(target[property]||{},extensions[property]):target[property]=extensions[property]}return target},stringify:function(){for(var m=["Pusher"],i=0;i<arguments.length;i++)"string"==typeof arguments[i]?m.push(arguments[i]):void 0===window.JSON?m.push(arguments[i].toString()):m.push(JSON.stringify(arguments[i]));return m.join(" : ")},arrayIndexOf:function(array,item){var nativeIndexOf=Array.prototype.indexOf;if(null===array)return-1;if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(var i=0,l=array.length;i<l;i++)if(array[i]===item)return i;return-1},objectApply:function(object,f){for(var key in object)Object.prototype.hasOwnProperty.call(object,key)&&f(object[key],key,object)},keys:function(object){var keys=[];return Pusher.Util.objectApply(object,function(_,key){keys.push(key)}),keys},values:function(object){var values=[];return Pusher.Util.objectApply(object,function(value){values.push(value)}),values},apply:function(array,f,context){for(var i=0;i<array.length;i++)f.call(context||window,array[i],i,array)},map:function(array,f){for(var result=[],i=0;i<array.length;i++)result.push(f(array[i],i,array,result));return result},mapObject:function(object,f){var result={};return Pusher.Util.objectApply(object,function(value,key){result[key]=f(value)}),result},filter:function(array,test){test=test||function(value){return!!value};for(var result=[],i=0;i<array.length;i++)test(array[i],i,array,result)&&result.push(array[i]);return result},filterObject:function(object,test){var result={};return Pusher.Util.objectApply(object,function(value,key){(test&&test(value,key,object,result)||Boolean(value))&&(result[key]=value)}),result},flatten:function(object){var result=[];return Pusher.Util.objectApply(object,function(value,key){result.push([key,value])}),result},any:function(array,test){for(var i=0;i<array.length;i++)if(test(array[i],i,array))return!0;return!1},all:function(array,test){for(var i=0;i<array.length;i++)if(!test(array[i],i,array))return!1;return!0},method:function(name){var boundArguments=Array.prototype.slice.call(arguments,1);return function(object){return object[name].apply(object,boundArguments.concat(arguments))}},getWindow:function(){return window},getDocument:function(){return document},getLocalStorage:function(){try{return window.localStorage}catch(e){return}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport},function(t){return t.isSupported({})}))},addWindowListener:function(event,listener){var _window=Pusher.Util.getWindow();void 0!==_window.addEventListener?_window.addEventListener(event,listener,!1):_window.attachEvent("on"+event,listener)},removeWindowListener:function(event,listener){var _window=Pusher.Util.getWindow();void 0!==_window.addEventListener?_window.removeEventListener(event,listener,!1):_window.detachEvent("on"+event,listener)},isXHRSupported:function(){var XHR=window.XMLHttpRequest;return Boolean(XHR)&&void 0!==(new XHR).withCredentials},isXDRSupported:function(encrypted){var protocol=encrypted?"https:":"http:",documentProtocol=Pusher.Util.getDocument().location.protocol;return Boolean(window.XDomainRequest)&&documentProtocol===protocol}}}.call(this),function(){Pusher.VERSION="3.0.0",Pusher.PROTOCOL=7,Pusher.host="ws.pusherapp.com",Pusher.ws_port=80,Pusher.wss_port=443,Pusher.sockjs_host="sockjs.pusher.com",Pusher.sockjs_http_port=80,Pusher.sockjs_https_port=443,Pusher.sockjs_path="/pusher",Pusher.stats_host="stats.pusher.com",Pusher.channel_auth_endpoint="/pusher/auth",Pusher.channel_auth_transport="ajax",Pusher.activity_timeout=12e4,Pusher.pong_timeout=3e4,Pusher.unavailable_timeout=1e4,Pusher.cdn_http="http://js.pusher.com/",Pusher.cdn_https="https://js.pusher.com/",Pusher.dependency_suffix="",Pusher.getDefaultStrategy=function(config){var wsStrategy;return wsStrategy=config.encrypted?[":best_connected_ever",":ws_loop",[":delayed",2e3,[":http_fallback_loop"]]]:[":best_connected_ever",":ws_loop",[":delayed",2e3,[":wss_loop"]],[":delayed",5e3,[":http_fallback_loop"]]],[[":def","ws_options",{hostUnencrypted:config.wsHost+":"+config.wsPort,hostEncrypted:config.wsHost+":"+config.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:config.httpHost+":"+config.httpPort,hostEncrypted:config.httpHost+":"+config.httpsPort,httpPath:config.httpPath}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:config.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:config.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4e3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],wsStrategy,":http_fallback_loop"]]]]]}}.call(this),function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}},Pusher.getClusterConfig=function(clusterName){return{wsHost:"ws-"+clusterName+".pusher.com",httpHost:"sockjs-"+clusterName+".pusher.com"}}}.call(this),function(){function buildExceptionClass(name){var constructor=function(message){Error.call(this,message),this.name=name};return Pusher.Util.extend(constructor.prototype,Error.prototype),constructor}Pusher.Errors={BadEventName:buildExceptionClass("BadEventName"),RequestTimedOut:buildExceptionClass("RequestTimedOut"),TransportPriorityTooLow:buildExceptionClass("TransportPriorityTooLow"),TransportClosed:buildExceptionClass("TransportClosed"),UnsupportedTransport:buildExceptionClass("UnsupportedTransport"),UnsupportedStrategy:buildExceptionClass("UnsupportedStrategy")}}.call(this),function(){function EventsDispatcher(failThrough){this.callbacks=new CallbackRegistry,this.global_callbacks=[],this.failThrough=failThrough}function CallbackRegistry(){this._callbacks={}}function prefix(name){return"_"+name}var prototype=EventsDispatcher.prototype;prototype.bind=function(eventName,callback,context){return this.callbacks.add(eventName,callback,context),this},prototype.bind_all=function(callback){return this.global_callbacks.push(callback),this},prototype.unbind=function(eventName,callback,context){return this.callbacks.remove(eventName,callback,context),this},prototype.unbind_all=function(eventName,callback){return this.callbacks.remove(eventName,callback),this},prototype.emit=function(eventName,data){var i;for(i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](eventName,data);var callbacks=this.callbacks.get(eventName);if(callbacks&&callbacks.length>0)for(i=0;i<callbacks.length;i++)callbacks[i].fn.call(callbacks[i].context||window,data);else this.failThrough&&this.failThrough(eventName,data);return this},CallbackRegistry.prototype.get=function(name){return this._callbacks[prefix(name)]},CallbackRegistry.prototype.add=function(name,callback,context){var prefixedEventName=prefix(name);this._callbacks[prefixedEventName]=this._callbacks[prefixedEventName]||[],this._callbacks[prefixedEventName].push({fn:callback,context:context})},CallbackRegistry.prototype.remove=function(name,callback,context){if(!name&&!callback&&!context)return void(this._callbacks={});var names=name?[prefix(name)]:Pusher.Util.keys(this._callbacks);callback||context?Pusher.Util.apply(names,function(name){this._callbacks[name]=Pusher.Util.filter(this._callbacks[name]||[],function(binding){return callback&&callback!==binding.fn||context&&context!==binding.context}),0===this._callbacks[name].length&&delete this._callbacks[name]},this):Pusher.Util.apply(names,function(name){delete this._callbacks[name]},this)},Pusher.EventsDispatcher=EventsDispatcher}.call(this),function(){function ScriptReceiverFactory(prefix,name){this.lastId=0,this.prefix=prefix,this.name=name}var prototype=ScriptReceiverFactory.prototype;prototype.create=function(callback){this.lastId++;var number=this.lastId,id=this.prefix+number,name=this.name+"["+number+"]",called=!1,callbackWrapper=function(){called||(callback.apply(null,arguments),called=!0)};return this[number]=callbackWrapper,{number:number,id:id,name:name,callback:callbackWrapper}},prototype.remove=function(receiver){delete this[receiver.number]},Pusher.ScriptReceiverFactory=ScriptReceiverFactory,Pusher.ScriptReceivers=new ScriptReceiverFactory("_pusher_script_","Pusher.ScriptReceivers")}.call(this),function(){function ScriptRequest(src){this.src=src}var prototype=ScriptRequest.prototype;prototype.send=function(receiver){var self=this,errorString="Error loading "+self.src;self.script=document.createElement("script"),self.script.id=receiver.id,self.script.src=self.src,self.script.type="text/javascript",self.script.charset="UTF-8",self.script.addEventListener?(self.script.onerror=function(){receiver.callback(errorString)},self.script.onload=function(){receiver.callback(null)}):self.script.onreadystatechange=function(){"loaded"!==self.script.readyState&&"complete"!==self.script.readyState||receiver.callback(null)},void 0===self.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(self.errorScript=document.createElement("script"),self.errorScript.id=receiver.id+"_error",self.errorScript.text=receiver.name+"('"+errorString+"');",self.script.async=self.errorScript.async=!1):self.script.async=!0;var head=document.getElementsByTagName("head")[0];head.insertBefore(self.script,head.firstChild),self.errorScript&&head.insertBefore(self.errorScript,self.script.nextSibling)},prototype.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},Pusher.ScriptRequest=ScriptRequest}.call(this),function(){function DependencyLoader(options){this.options=options,this.receivers=options.receivers||Pusher.ScriptReceivers,this.loading={}}var prototype=DependencyLoader.prototype;prototype.load=function(name,options,callback){var self=this;if(self.loading[name]&&self.loading[name].length>0)self.loading[name].push(callback);else{self.loading[name]=[callback];var request=new Pusher.ScriptRequest(self.getPath(name,options)),receiver=self.receivers.create(function(error){if(self.receivers.remove(receiver),self.loading[name]){var callbacks=self.loading[name];delete self.loading[name];for(var successCallback=function(wasSuccessful){wasSuccessful||request.cleanup()},i=0;i<callbacks.length;i++)callbacks[i](error,successCallback)}});request.send(receiver)}},prototype.getRoot=function(options){var cdn,protocol=Pusher.Util.getDocument().location.protocol;return cdn=options&&options.encrypted||"https:"===protocol?this.options.cdn_https:this.options.cdn_http,cdn.replace(/\/*$/,"")+"/"+this.options.version},prototype.getPath=function(name,options){return this.getRoot(options)+"/"+name+this.options.suffix+".js"},Pusher.DependencyLoader=DependencyLoader}.call(this),function(){function initialize(){Pusher.ready()}function onDocumentBody(callback){document.body?callback():setTimeout(function(){onDocumentBody(callback)},0)}function initializeOnDocumentBody(){onDocumentBody(initialize)}Pusher.DependenciesReceivers=new Pusher.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers"),Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix,receivers:Pusher.DependenciesReceivers}),window.JSON?initializeOnDocumentBody():Pusher.Dependencies.load("json2",{},initializeOnDocumentBody)}(),function(){for(var Base64={encode:function(s){return btoa(utob(s))}},fromCharCode=String.fromCharCode,b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab={},i=0,l=b64chars.length;i<l;i++)b64tab[b64chars.charAt(i)]=i;var cb_utob=function(c){var cc=c.charCodeAt(0);return cc<128?c:cc<2048?fromCharCode(192|cc>>>6)+fromCharCode(128|63&cc):fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|63&cc)},utob=function(u){return u.replace(/[^\x00-\x7F]/g,cb_utob)},cb_encode=function(ccc){var padlen=[0,2,1][ccc.length%3],ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0);return[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"=":b64chars.charAt(ord>>>6&63),padlen>=1?"=":b64chars.charAt(63&ord)].join("")},btoa=window.btoa||function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)};Pusher.Base64=Base64}.call(this),function(){function JSONPRequest(url,data){this.url=url,this.data=data}function encodeParamsObject(data){return Pusher.Util.mapObject(data,function(value){return"object"==typeof value&&(value=JSON.stringify(value)),encodeURIComponent(Pusher.Base64.encode(value.toString()))})}var prototype=JSONPRequest.prototype;prototype.send=function(receiver){if(!this.request){var params=Pusher.Util.filterObject(this.data,function(value){return void 0!==value}),query=Pusher.Util.map(Pusher.Util.flatten(encodeParamsObject(params)),Pusher.Util.method("join","=")).join("&"),url=this.url+"/"+receiver.number+"?"+query;this.request=new Pusher.ScriptRequest(url),this.request.send(receiver)}},prototype.cleanup=function(){this.request&&this.request.cleanup()},Pusher.JSONPRequest=JSONPRequest}.call(this),function(){function Timeline(key,session,options){this.key=key,this.session=session,this.events=[],this.options=options||{},this.sent=0,this.uniqueID=0}var prototype=Timeline.prototype;Timeline.ERROR=3,Timeline.INFO=6,Timeline.DEBUG=7,prototype.log=function(level,event){level<=this.options.level&&(this.events.push(Pusher.Util.extend({},event,{timestamp:Pusher.Util.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},prototype.error=function(event){this.log(Timeline.ERROR,event)},prototype.info=function(event){this.log(Timeline.INFO,event)},prototype.debug=function(event){this.log(Timeline.DEBUG,event)},prototype.isEmpty=function(){return 0===this.events.length},prototype.send=function(sendJSONP,callback){var self=this,data=Pusher.Util.extend({session:self.session,bundle:self.sent+1,key:self.key,lib:"js",version:self.options.version,cluster:self.options.cluster,features:self.options.features,timeline:self.events},self.options.params);return self.events=[],sendJSONP(data,function(error,result){error||self.sent++,callback&&callback(error,result)}),!0},prototype.generateUniqueID=function(){return++this.uniqueID},Pusher.Timeline=Timeline}.call(this),function(){function TimelineSender(timeline,options){this.timeline=timeline,this.options=options||{}}TimelineSender.prototype.send=function(encrypted,callback){var self=this;if(!self.timeline.isEmpty()){var sendJSONP=function(data,callback){var scheme="http"+(encrypted?"s":"")+"://",url=scheme+(self.host||self.options.host)+self.options.path,request=new Pusher.JSONPRequest(url,data),receiver=Pusher.ScriptReceivers.create(function(error,result){Pusher.ScriptReceivers.remove(receiver),request.cleanup(),result&&result.host&&(self.host=result.host),callback&&callback(error,result)});request.send(receiver)};self.timeline.send(sendJSONP,callback)}},Pusher.TimelineSender=TimelineSender}.call(this),function(){function BestConnectedEverStrategy(strategies){this.strategies=strategies}function connect(strategies,minPriority,callbackBuilder){var runners=Pusher.Util.map(strategies,function(strategy,i,_,rs){return strategy.connect(minPriority,callbackBuilder(i,rs))});return{abort:function(){Pusher.Util.apply(runners,abortRunner)},forceMinPriority:function(p){Pusher.Util.apply(runners,function(runner){runner.forceMinPriority(p)})}}}function allRunnersFailed(runners){return Pusher.Util.all(runners,function(runner){return Boolean(runner.error)})}function abortRunner(runner){runner.error||runner.aborted||(runner.abort(),runner.aborted=!0)}var prototype=BestConnectedEverStrategy.prototype;prototype.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},prototype.connect=function(minPriority,callback){return connect(this.strategies,minPriority,function(i,runners){return function(error,handshake){if(runners[i].error=error,error)return void(allRunnersFailed(runners)&&callback(!0));Pusher.Util.apply(runners,function(runner){runner.forceMinPriority(handshake.transport.priority)}),callback(null,handshake)}})},Pusher.BestConnectedEverStrategy=BestConnectedEverStrategy}.call(this),function(){function CachedStrategy(strategy,transports,options){this.strategy=strategy,this.transports=transports,this.ttl=options.ttl||18e5,this.encrypted=options.encrypted,this.timeline=options.timeline}function getTransportCacheKey(encrypted){return"pusherTransport"+(encrypted?"Encrypted":"Unencrypted")}function fetchTransportCache(encrypted){var storage=Pusher.Util.getLocalStorage();if(storage)try{var serializedCache=storage[getTransportCacheKey(encrypted)];if(serializedCache)return JSON.parse(serializedCache)}catch(e){flushTransportCache(encrypted)}return null}function storeTransportCache(encrypted,transport,latency){var storage=Pusher.Util.getLocalStorage();if(storage)try{storage[getTransportCacheKey(encrypted)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:transport,latency:latency})}catch(e){}}function flushTransportCache(encrypted){var storage=Pusher.Util.getLocalStorage();if(storage)try{delete storage[getTransportCacheKey(encrypted)]}catch(e){}}var prototype=CachedStrategy.prototype;prototype.isSupported=function(){return this.strategy.isSupported()},prototype.connect=function(minPriority,callback){var encrypted=this.encrypted,info=fetchTransportCache(encrypted),strategies=[this.strategy];if(info&&info.timestamp+this.ttl>=Pusher.Util.now()){var transport=this.transports[info.transport];transport&&(this.timeline.info({cached:!0,transport:info.transport,latency:info.latency}),strategies.push(new Pusher.SequentialStrategy([transport],{timeout:2*info.latency+1e3,failFast:!0})))}var startTimestamp=Pusher.Util.now(),runner=strategies.pop().connect(minPriority,function cb(error,handshake){error?(flushTransportCache(encrypted),strategies.length>0?(startTimestamp=Pusher.Util.now(),runner=strategies.pop().connect(minPriority,cb)):callback(error)):(storeTransportCache(encrypted,handshake.transport.name,Pusher.Util.now()-startTimestamp),callback(null,handshake))});return{abort:function(){runner.abort()},forceMinPriority:function(p){minPriority=p,runner&&runner.forceMinPriority(p)}}},Pusher.CachedStrategy=CachedStrategy}.call(this),function(){function DelayedStrategy(strategy,options){this.strategy=strategy,this.options={delay:options.delay}}var prototype=DelayedStrategy.prototype;prototype.isSupported=function(){return this.strategy.isSupported()},prototype.connect=function(minPriority,callback){var runner,strategy=this.strategy,timer=new Pusher.Timer(this.options.delay,function(){runner=strategy.connect(minPriority,callback)});return{abort:function(){timer.ensureAborted(),runner&&runner.abort()},forceMinPriority:function(p){minPriority=p,runner&&runner.forceMinPriority(p)}}},Pusher.DelayedStrategy=DelayedStrategy}.call(this),function(){function FirstConnectedStrategy(strategy){this.strategy=strategy}var prototype=FirstConnectedStrategy.prototype;prototype.isSupported=function(){return this.strategy.isSupported()},prototype.connect=function(minPriority,callback){var runner=this.strategy.connect(minPriority,function(error,handshake){handshake&&runner.abort(),callback(error,handshake)});return runner},Pusher.FirstConnectedStrategy=FirstConnectedStrategy}.call(this),function(){function IfStrategy(test,trueBranch,falseBranch){this.test=test,this.trueBranch=trueBranch,this.falseBranch=falseBranch}var prototype=IfStrategy.prototype;prototype.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()},prototype.connect=function(minPriority,callback){return(this.test()?this.trueBranch:this.falseBranch).connect(minPriority,callback)},Pusher.IfStrategy=IfStrategy}.call(this),function(){function SequentialStrategy(strategies,options){this.strategies=strategies,this.loop=Boolean(options.loop),this.failFast=Boolean(options.failFast),this.timeout=options.timeout,this.timeoutLimit=options.timeoutLimit}var prototype=SequentialStrategy.prototype;prototype.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},prototype.connect=function(minPriority,callback){var self=this,strategies=this.strategies,current=0,timeout=this.timeout,runner=null,tryNextStrategy=function(error,handshake){handshake?callback(null,handshake):(current+=1,self.loop&&(current%=strategies.length),current<strategies.length?(timeout&&(timeout*=2,self.timeoutLimit&&(timeout=Math.min(timeout,self.timeoutLimit))),runner=self.tryStrategy(strategies[current],minPriority,{timeout:timeout,failFast:self.failFast},tryNextStrategy)):callback(!0))};return runner=this.tryStrategy(strategies[current],minPriority,{timeout:timeout,failFast:this.failFast},tryNextStrategy),{abort:function(){runner.abort()},forceMinPriority:function(p){minPriority=p,runner&&runner.forceMinPriority(p)}}},prototype.tryStrategy=function(strategy,minPriority,options,callback){var timer=null,runner=null;return options.timeout>0&&(timer=new Pusher.Timer(options.timeout,function(){runner.abort(),callback(!0)})),runner=strategy.connect(minPriority,function(error,handshake){error&&timer&&timer.isRunning()&&!options.failFast||(timer&&timer.ensureAborted(),callback(error,handshake))}),{abort:function(){timer&&timer.ensureAborted(),runner.abort()},forceMinPriority:function(p){runner.forceMinPriority(p)}}},Pusher.SequentialStrategy=SequentialStrategy}.call(this),function(){function TransportStrategy(name,priority,transport,options){this.name=name,this.priority=priority,this.transport=transport,this.options=options||{}}function failAttempt(error,callback){return Pusher.Util.defer(function(){callback(error)}),{abort:function(){},forceMinPriority:function(){}}}var prototype=TransportStrategy.prototype;prototype.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})},prototype.connect=function(minPriority,callback){if(!this.isSupported())return failAttempt(new Pusher.Errors.UnsupportedStrategy,callback);if(this.priority<minPriority)return failAttempt(new Pusher.Errors.TransportPriorityTooLow,callback);var self=this,connected=!1,transport=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),handshake=null,onInitialized=function(){transport.unbind("initialized",onInitialized),transport.connect()},onOpen=function(){handshake=new Pusher.Handshake(transport,function(result){connected=!0,unbindListeners(),callback(null,result)})},onError=function(error){unbindListeners(),callback(error)},onClosed=function(){unbindListeners(),callback(new Pusher.Errors.TransportClosed(transport))},unbindListeners=function(){transport.unbind("initialized",onInitialized),transport.unbind("open",onOpen),transport.unbind("error",onError),transport.unbind("closed",onClosed)};return transport.bind("initialized",onInitialized),transport.bind("open",onOpen),transport.bind("error",onError),transport.bind("closed",onClosed),transport.initialize(),{abort:function(){connected||(unbindListeners(),handshake?handshake.close():transport.close())},forceMinPriority:function(p){connected||self.priority<p&&(handshake?handshake.close():transport.close())}}},Pusher.TransportStrategy=TransportStrategy}.call(this),function(){function getGenericURL(baseScheme,params,path){return baseScheme+(params.encrypted?"s":"")+"://"+(params.encrypted?params.hostEncrypted:params.hostUnencrypted)+path}function getGenericPath(key,queryString){return"/app/"+key+"?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION+(queryString?"&"+queryString:"")}Pusher.URLSchemes={ws:{getInitial:function(key,params){return getGenericURL("ws",params,getGenericPath(key,"flash=false"))}},sockjs:{getInitial:function(key,params){return getGenericURL("http",params,params.httpPath||"/pusher")},getPath:function(key,params){return getGenericPath(key)}},http:{getInitial:function(key,params){return getGenericURL("http",params,(params.httpPath||"/pusher")+getGenericPath(key))}}}}.call(this),function(){function TransportConnection(hooks,name,priority,key,options){Pusher.EventsDispatcher.call(this),this.hooks=hooks,this.name=name,this.priority=priority,this.key=key,this.options=options,this.state="new",this.timeline=options.timeline,this.activityTimeout=options.activityTimeout,this.id=this.timeline.generateUniqueID()}var prototype=TransportConnection.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)},prototype.supportsPing=function(){return Boolean(this.hooks.supportsPing)},prototype.initialize=function(){var self=this;self.timeline.info(self.buildTimelineMessage({transport:self.name+(self.options.encrypted?"s":"")})),self.hooks.isInitialized()?self.changeState("initialized"):self.hooks.file?(self.changeState("initializing"),Pusher.Dependencies.load(self.hooks.file,{encrypted:self.options.encrypted},function(error,callback){self.hooks.isInitialized()?(self.changeState("initialized"),callback(!0)):(error&&self.onError(error),self.onClose(),callback(!1))})):self.onClose()},prototype.connect=function(){var self=this;if(self.socket||"initialized"!==self.state)return!1;var url=self.hooks.urls.getInitial(self.key,self.options);try{self.socket=self.hooks.getSocket(url,self.options)}catch(e){return Pusher.Util.defer(function(){self.onError(e),self.changeState("closed")}),!1}return self.bindListeners(),Pusher.debug("Connecting",{transport:self.name,url:url}),self.changeState("connecting"),!0},prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},prototype.send=function(data){var self=this;return"open"===self.state&&(Pusher.Util.defer(function(){self.socket&&self.socket.send(data)}),!0)},prototype.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},prototype.onError=function(error){this.emit("error",{type:"WebSocketError",error:error}),this.timeline.error(this.buildTimelineMessage({error:error.toString()}))},prototype.onClose=function(closeEvent){closeEvent?this.changeState("closed",{code:closeEvent.code,reason:closeEvent.reason,wasClean:closeEvent.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},prototype.onMessage=function(message){this.emit("message",message)},prototype.onActivity=function(){this.emit("activity")},prototype.bindListeners=function(){var self=this;self.socket.onopen=function(){self.onOpen()},self.socket.onerror=function(error){self.onError(error)},self.socket.onclose=function(closeEvent){self.onClose(closeEvent)},self.socket.onmessage=function(message){self.onMessage(message)},self.supportsPing()&&(self.socket.onactivity=function(){self.onActivity()})},prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},prototype.changeState=function(state,params){this.state=state,this.timeline.info(this.buildTimelineMessage({state:state,params:params})),this.emit(state,params)},prototype.buildTimelineMessage=function(message){return Pusher.Util.extend({cid:this.id},message)},Pusher.TransportConnection=TransportConnection}.call(this),function(){function Transport(hooks){this.hooks=hooks}var prototype=Transport.prototype;prototype.isSupported=function(environment){return this.hooks.isSupported(environment)},prototype.createConnection=function(name,priority,key,options){return new Pusher.TransportConnection(this.hooks,name,priority,key,options)},Pusher.Transport=Transport}.call(this),function(){Pusher.WSTransport=new Pusher.Transport({urls:Pusher.URLSchemes.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(window.WebSocket||window.MozWebSocket)},isSupported:function(){return Boolean(window.WebSocket||window.MozWebSocket)},getSocket:function(url){return new(window.WebSocket||window.MozWebSocket)(url)}}),Pusher.SockJSTransport=new Pusher.Transport({file:"sockjs",urls:Pusher.URLSchemes.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(url,options){return new SockJS(url,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:options.encrypted}),ignore_null_origin:options.ignoreNullOrigin})},beforeOpen:function(socket,path){socket.send(JSON.stringify({path:path}))}});var httpConfiguration={urls:Pusher.URLSchemes.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return Boolean(Pusher.HTTP.Socket)}},streamingConfiguration=Pusher.Util.extend({getSocket:function(url){return Pusher.HTTP.getStreamingSocket(url)}},httpConfiguration),pollingConfiguration=Pusher.Util.extend({getSocket:function(url){return Pusher.HTTP.getPollingSocket(url)}},httpConfiguration),xhrConfiguration={file:"xhr",isSupported:Pusher.Util.isXHRSupported},xdrConfiguration={file:"xdr",isSupported:function(environment){return Pusher.Util.isXDRSupported(environment.encrypted)}};Pusher.XHRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},streamingConfiguration,xhrConfiguration)),Pusher.XDRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},streamingConfiguration,xdrConfiguration)),Pusher.XHRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},pollingConfiguration,xhrConfiguration)),Pusher.XDRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},pollingConfiguration,xdrConfiguration))}.call(this),function(){function AssistantToTheTransportManager(manager,transport,options){this.manager=manager,this.transport=transport,this.minPingDelay=options.minPingDelay,this.maxPingDelay=options.maxPingDelay,this.pingDelay=void 0}var prototype=AssistantToTheTransportManager.prototype;prototype.createConnection=function(name,priority,key,options){var self=this;options=Pusher.Util.extend({},options,{activityTimeout:self.pingDelay});var connection=self.transport.createConnection(name,priority,key,options),openTimestamp=null,onOpen=function(){connection.unbind("open",onOpen),connection.bind("closed",onClosed),openTimestamp=Pusher.Util.now()},onClosed=function(closeEvent){if(connection.unbind("closed",onClosed),1002===closeEvent.code||1003===closeEvent.code)self.manager.reportDeath();else if(!closeEvent.wasClean&&openTimestamp){var lifespan=Pusher.Util.now()-openTimestamp;lifespan<2*self.maxPingDelay&&(self.manager.reportDeath(),self.pingDelay=Math.max(lifespan/2,self.minPingDelay))}};return connection.bind("open",onOpen),connection},prototype.isSupported=function(environment){return this.manager.isAlive()&&this.transport.isSupported(environment)},Pusher.AssistantToTheTransportManager=AssistantToTheTransportManager}.call(this),function(){function TransportManager(options){this.options=options||{},this.livesLeft=this.options.lives||1/0}var prototype=TransportManager.prototype;prototype.getAssistant=function(transport){return new Pusher.AssistantToTheTransportManager(this,transport,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},prototype.isAlive=function(){return this.livesLeft>0},prototype.reportDeath=function(){this.livesLeft-=1},Pusher.TransportManager=TransportManager}.call(this),function(){function returnWithOriginalContext(f){return function(context){return[f.apply(this,arguments),context]}}function isSymbol(expression){return"string"==typeof expression&&":"===expression.charAt(0)}function getSymbolValue(expression,context){return context[expression.slice(1)]}function evaluateListOfExpressions(expressions,context){if(0===expressions.length)return[[],context];var head=evaluate(expressions[0],context),tail=evaluateListOfExpressions(expressions.slice(1),head[1]);return[[head[0]].concat(tail[0]),tail[1]]}function evaluateString(expression,context){if(!isSymbol(expression))return[expression,context];var value=getSymbolValue(expression,context);if(void 0===value)throw"Undefined symbol "+expression;return[value,context]}function evaluateArray(expression,context){if(isSymbol(expression[0])){var f=getSymbolValue(expression[0],context);if(expression.length>1){if("function"!=typeof f)throw"Calling non-function "+expression[0];var args=[Pusher.Util.extend({},context)].concat(Pusher.Util.map(expression.slice(1),function(arg){return evaluate(arg,Pusher.Util.extend({},context))[0]}));return f.apply(this,args)}return[f,context]}return evaluateListOfExpressions(expression,context)}function evaluate(expression,context){return"string"==typeof expression?evaluateString(expression,context):"object"==typeof expression&&expression instanceof Array&&expression.length>0?evaluateArray(expression,context):[expression,context]}var StrategyBuilder={build:function(scheme,options){return evaluate(scheme,Pusher.Util.extend({},globalContext,options))[1].strategy}},transports={ws:Pusher.WSTransport,sockjs:Pusher.SockJSTransport,xhr_streaming:Pusher.XHRStreamingTransport,xdr_streaming:Pusher.XDRStreamingTransport,xhr_polling:Pusher.XHRPollingTransport,xdr_polling:Pusher.XDRPollingTransport},UnsupportedStrategy={isSupported:function(){return!1},connect:function(_,callback){var deferred=Pusher.Util.defer(function(){callback(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){deferred.ensureAborted()},forceMinPriority:function(){}}}},globalContext={extend:function(context,first,second){return[Pusher.Util.extend({},first,second),context]},def:function(context,name,value){if(void 0!==context[name])throw"Redefining symbol "+name;return context[name]=value,[void 0,context]},def_transport:function(context,name,type,priority,options,manager){var transportClass=transports[type];if(!transportClass)throw new Pusher.Errors.UnsupportedTransport(type);var transport,enabled=!(context.enabledTransports&&-1===Pusher.Util.arrayIndexOf(context.enabledTransports,name)||context.disabledTransports&&-1!==Pusher.Util.arrayIndexOf(context.disabledTransports,name));transport=enabled?new Pusher.TransportStrategy(name,priority,manager?manager.getAssistant(transportClass):transportClass,Pusher.Util.extend({key:context.key,encrypted:context.encrypted,timeline:context.timeline,ignoreNullOrigin:context.ignoreNullOrigin},options)):UnsupportedStrategy;var newContext=context.def(context,name,transport)[1];return newContext.transports=context.transports||{},newContext.transports[name]=transport,[void 0,newContext]},transport_manager:returnWithOriginalContext(function(_,options){return new Pusher.TransportManager(options)}),sequential:returnWithOriginalContext(function(_,options){var strategies=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(strategies,options)}),cached:returnWithOriginalContext(function(context,ttl,strategy){return new Pusher.CachedStrategy(strategy,context.transports,{ttl:ttl,timeline:context.timeline,encrypted:context.encrypted})}),first_connected:returnWithOriginalContext(function(_,strategy){return new Pusher.FirstConnectedStrategy(strategy)}),best_connected_ever:returnWithOriginalContext(function(){var strategies=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(strategies)}),delayed:returnWithOriginalContext(function(_,delay,strategy){return new Pusher.DelayedStrategy(strategy,{delay:delay})}),if:returnWithOriginalContext(function(_,test,trueBranch,falseBranch){return new Pusher.IfStrategy(test,trueBranch,falseBranch)}),is_supported:returnWithOriginalContext(function(_,strategy){return function(){return strategy.isSupported()}})};Pusher.StrategyBuilder=StrategyBuilder}.call(this),function(){var Protocol={};Protocol.decodeMessage=function(message){try{var params=JSON.parse(message.data);if("string"==typeof params.data)try{params.data=JSON.parse(params.data)}catch(e){if(!(e instanceof SyntaxError))throw e}return params}catch(e){throw{type:"MessageParseError",error:e,data:message.data}}},Protocol.encodeMessage=function(message){return JSON.stringify(message)},Protocol.processHandshake=function(message){if(message=this.decodeMessage(message),"pusher:connection_established"===message.event){if(!message.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:message.data.socket_id,activityTimeout:1e3*message.data.activity_timeout}}if("pusher:error"===message.event)return{action:this.getCloseAction(message.data),error:this.getCloseError(message.data)};throw"Invalid handshake"},Protocol.getCloseAction=function(closeEvent){return closeEvent.code<4e3?closeEvent.code>=1002&&closeEvent.code<=1004?"backoff":null:4e3===closeEvent.code?"ssl_only":closeEvent.code<4100?"refused":closeEvent.code<4200?"backoff":closeEvent.code<4300?"retry":"refused"},Protocol.getCloseError=function(closeEvent){return 1e3!==closeEvent.code&&1001!==closeEvent.code?{type:"PusherError",data:{code:closeEvent.code,message:closeEvent.reason||closeEvent.message}}:null},Pusher.Protocol=Protocol}.call(this),function(){function Connection(id,transport){Pusher.EventsDispatcher.call(this),this.id=id,this.transport=transport,this.activityTimeout=transport.activityTimeout,this.bindListeners()}var prototype=Connection.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},prototype.send=function(data){return this.transport.send(data)},prototype.send_event=function(name,data,channel){var message={event:name,data:data};return channel&&(message.channel=channel),Pusher.debug("Event sent",message),this.send(Pusher.Protocol.encodeMessage(message))},prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},prototype.close=function(){this.transport.close()},prototype.bindListeners=function(){var self=this,listeners={message:function(m){var message;try{message=Pusher.Protocol.decodeMessage(m)}catch(e){self.emit("error",{type:"MessageParseError",error:e,data:m.data})}if(void 0!==message){switch(Pusher.debug("Event recd",message),message.event){case"pusher:error":self.emit("error",{type:"PusherError",data:message.data});break;case"pusher:ping":self.emit("ping");break;case"pusher:pong":self.emit("pong")}self.emit("message",message)}},activity:function(){self.emit("activity")},error:function(error){self.emit("error",{type:"WebSocketError",error:error})},closed:function(closeEvent){unbindListeners(),closeEvent&&closeEvent.code&&self.handleCloseEvent(closeEvent),self.transport=null,self.emit("closed")}},unbindListeners=function(){Pusher.Util.objectApply(listeners,function(listener,event){self.transport.unbind(event,listener)})};Pusher.Util.objectApply(listeners,function(listener,event){self.transport.bind(event,listener)})},prototype.handleCloseEvent=function(closeEvent){var action=Pusher.Protocol.getCloseAction(closeEvent),error=Pusher.Protocol.getCloseError(closeEvent);error&&this.emit("error",error),action&&this.emit(action)},Pusher.Connection=Connection}.call(this),function(){function Handshake(transport,callback){this.transport=transport,this.callback=callback,this.bindListeners()}var prototype=Handshake.prototype;prototype.close=function(){this.unbindListeners(),this.transport.close()},prototype.bindListeners=function(){var self=this;self.onMessage=function(m){self.unbindListeners();try{var result=Pusher.Protocol.processHandshake(m);"connected"===result.action?self.finish("connected",{connection:new Pusher.Connection(result.id,self.transport),activityTimeout:result.activityTimeout}):(self.finish(result.action,{error:result.error}),self.transport.close())}catch(e){self.finish("error",{error:e}),self.transport.close()}},self.onClosed=function(closeEvent){self.unbindListeners();var action=Pusher.Protocol.getCloseAction(closeEvent)||"backoff",error=Pusher.Protocol.getCloseError(closeEvent);self.finish(action,{error:error})},self.transport.bind("message",self.onMessage),self.transport.bind("closed",self.onClosed)},prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},prototype.finish=function(action,params){this.callback(Pusher.Util.extend({transport:this.transport,action:action},params))},Pusher.Handshake=Handshake}.call(this),function(){function ConnectionManager(key,options){Pusher.EventsDispatcher.call(this),this.key=key,this.options=options||{},this.state="initialized",this.connection=null,this.encrypted=!!options.encrypted,this.timeline=this.options.timeline,this.connectionCallbacks=this.buildConnectionCallbacks(),this.errorCallbacks=this.buildErrorCallbacks(),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var self=this;Pusher.Network.bind("online",function(){self.timeline.info({netinfo:"online"}),"connecting"!==self.state&&"unavailable"!==self.state||self.retryIn(0)}),Pusher.Network.bind("offline",function(){self.timeline.info({netinfo:"offline"}),self.connection&&self.sendActivityCheck()}),this.updateStrategy()}var prototype=ConnectionManager.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.connect=function(){if(!this.connection&&!this.runner){if(!this.strategy.isSupported())return void this.updateState("failed");this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}},prototype.send=function(data){return!!this.connection&&this.connection.send(data)},prototype.send_event=function(name,data,channel){return!!this.connection&&this.connection.send_event(name,data,channel)},prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},prototype.isEncrypted=function(){return this.encrypted},prototype.startConnecting=function(){var self=this,callback=function(error,handshake){error?self.runner=self.strategy.connect(0,callback):"error"===handshake.action?(self.emit("error",{type:"HandshakeError",error:handshake.error}),self.timeline.error({handshakeError:handshake.error})):(self.abortConnecting(),self.handshakeCallbacks[handshake.action](handshake))};self.runner=self.strategy.connect(0,callback)},prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},prototype.disconnectInternally=function(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){this.abandonConnection().close()}},prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})},prototype.retryIn=function(delay){var self=this;self.timeline.info({action:"retry",delay:delay}),delay>0&&self.emit("connecting_in",Math.round(delay/1e3)),self.retryTimer=new Pusher.Timer(delay||0,function(){self.disconnectInternally(),self.connect()})},prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},prototype.setUnavailableTimer=function(){var self=this;self.unavailableTimer=new Pusher.Timer(self.options.unavailableTimeout,function(){self.updateState("unavailable")})},prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},prototype.sendActivityCheck=function(){var self=this;self.stopActivityCheck(),self.connection.ping(),self.activityTimer=new Pusher.Timer(self.options.pongTimeout,function(){self.timeline.error({pong_timed_out:self.options.pongTimeout}),self.retryIn(0)})},prototype.resetActivityCheck=function(){var self=this;self.stopActivityCheck(),self.connection.handlesActivityChecks()||(self.activityTimer=new Pusher.Timer(self.activityTimeout,function(){self.sendActivityCheck()}))},prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},prototype.buildConnectionCallbacks=function(){var self=this;return{message:function(message){self.resetActivityCheck(),self.emit("message",message)},ping:function(){self.send_event("pusher:pong",{})},activity:function(){self.resetActivityCheck()},error:function(error){self.emit("error",{type:"WebSocketError",error:error})},closed:function(){self.abandonConnection(),self.shouldRetry()&&self.retryIn(1e3)}}},prototype.buildHandshakeCallbacks=function(errorCallbacks){var self=this;return Pusher.Util.extend({},errorCallbacks,{connected:function(handshake){self.activityTimeout=Math.min(self.options.activityTimeout,handshake.activityTimeout,handshake.connection.activityTimeout||1/0),self.clearUnavailableTimer(),self.setConnection(handshake.connection),self.socket_id=self.connection.id,self.updateState("connected",{socket_id:self.socket_id})}})},prototype.buildErrorCallbacks=function(){function withErrorEmitted(callback){return function(result){result.error&&self.emit("error",{type:"WebSocketError",error:result.error}),callback(result)}}var self=this;return{ssl_only:withErrorEmitted(function(){self.encrypted=!0,self.updateStrategy(),self.retryIn(0)}),refused:withErrorEmitted(function(){self.disconnect()}),backoff:withErrorEmitted(function(){self.retryIn(1e3)}),retry:withErrorEmitted(function(){self.retryIn(0)})}},prototype.setConnection=function(connection){this.connection=connection;for(var event in this.connectionCallbacks)this.connection.bind(event,this.connectionCallbacks[event]);this.resetActivityCheck()},prototype.abandonConnection=function(){if(this.connection){this.stopActivityCheck();for(var event in this.connectionCallbacks)this.connection.unbind(event,this.connectionCallbacks[event]);var connection=this.connection;return this.connection=null,connection}},prototype.updateState=function(newState,data){var previousState=this.state;this.state=newState,previousState!==newState&&(Pusher.debug("State changed",previousState+" -> "+newState),this.timeline.info({state:newState,params:data}),this.emit("state_change",{previous:previousState,current:newState}),this.emit(newState,data))},prototype.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},Pusher.ConnectionManager=ConnectionManager}.call(this),function(){function NetInfo(){Pusher.EventsDispatcher.call(this);var self=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){self.emit("online")},!1),window.addEventListener("offline",function(){self.emit("offline")},!1))}Pusher.Util.extend(NetInfo.prototype,Pusher.EventsDispatcher.prototype),NetInfo.prototype.isOnline=function(){return void 0===window.navigator.onLine||window.navigator.onLine},Pusher.NetInfo=NetInfo,Pusher.Network=new NetInfo}.call(this),function(){function Members(){this.reset()}var prototype=Members.prototype;prototype.get=function(id){return Object.prototype.hasOwnProperty.call(this.members,id)?{id:id,info:this.members[id]}:null},prototype.each=function(callback){var self=this;Pusher.Util.objectApply(self.members,function(member,id){callback(self.get(id))})},prototype.setMyID=function(id){this.myID=id},prototype.onSubscription=function(subscriptionData){this.members=subscriptionData.presence.hash,this.count=subscriptionData.presence.count,this.me=this.get(this.myID)},prototype.addMember=function(memberData){return null===this.get(memberData.user_id)&&this.count++,this.members[memberData.user_id]=memberData.user_info,this.get(memberData.user_id)},prototype.removeMember=function(memberData){var member=this.get(memberData.user_id);return member&&(delete this.members[memberData.user_id],this.count--),member},prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},Pusher.Members=Members}.call(this),function(){function Channel(name,pusher){Pusher.EventsDispatcher.call(this,function(event,data){Pusher.debug("No callbacks on "+name+" for "+event)}),this.name=name,this.pusher=pusher,this.subscribed=!1}var prototype=Channel.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.authorize=function(socketId,callback){return callback(!1,{})},prototype.trigger=function(event,data){if(0!==event.indexOf("client-"))throw new Pusher.Errors.BadEventName("Event '"+event+"' does not start with 'client-'");return this.pusher.send_event(event,data,this.name)},prototype.disconnect=function(){this.subscribed=!1},prototype.handleEvent=function(event,data){0===event.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===event&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",data)):this.emit(event,data)},prototype.subscribe=function(){var self=this;self.authorize(self.pusher.connection.socket_id,function(error,data){error?self.handleEvent("pusher:subscription_error",data):self.pusher.send_event("pusher:subscribe",{auth:data.auth,channel_data:data.channel_data,channel:self.name})})},prototype.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},Pusher.Channel=Channel}.call(this),function(){function PrivateChannel(name,pusher){Pusher.Channel.call(this,name,pusher)}var prototype=PrivateChannel.prototype;Pusher.Util.extend(prototype,Pusher.Channel.prototype),prototype.authorize=function(socketId,callback){return new Pusher.Channel.Authorizer(this,this.pusher.config).authorize(socketId,callback)},Pusher.PrivateChannel=PrivateChannel}.call(this),function(){function PresenceChannel(name,pusher){Pusher.PrivateChannel.call(this,name,pusher),this.members=new Pusher.Members}var prototype=PresenceChannel.prototype;Pusher.Util.extend(prototype,Pusher.PrivateChannel.prototype),prototype.authorize=function(socketId,callback){var _super=Pusher.PrivateChannel.prototype.authorize,self=this;_super.call(self,socketId,function(error,authData){if(!error){if(void 0===authData.channel_data)return Pusher.warn("Invalid auth response for channel '"+self.name+"', expected 'channel_data' field"),void callback("Invalid auth response");var channelData=JSON.parse(authData.channel_data);self.members.setMyID(channelData.user_id)}callback(error,authData)})},prototype.handleEvent=function(event,data){switch(event){case"pusher_internal:subscription_succeeded":this.members.onSubscription(data),this.subscribed=!0,this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":var addedMember=this.members.addMember(data);this.emit("pusher:member_added",addedMember);break;case"pusher_internal:member_removed":var removedMember=this.members.removeMember(data);removedMember&&this.emit("pusher:member_removed",removedMember);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,event,data)}},prototype.disconnect=function(){this.members.reset(),Pusher.PrivateChannel.prototype.disconnect.call(this)},Pusher.PresenceChannel=PresenceChannel}.call(this),function(){function Channels(){this.channels={}}function createChannel(name,pusher){return 0===name.indexOf("private-")?new Pusher.PrivateChannel(name,pusher):0===name.indexOf("presence-")?new Pusher.PresenceChannel(name,pusher):new Pusher.Channel(name,pusher)}var prototype=Channels.prototype;prototype.add=function(name,pusher){return this.channels[name]||(this.channels[name]=createChannel(name,pusher)),this.channels[name]},prototype.all=function(name){return Pusher.Util.values(this.channels)},prototype.find=function(name){return this.channels[name]},prototype.remove=function(name){var channel=this.channels[name];return delete this.channels[name],channel},prototype.disconnect=function(){Pusher.Util.objectApply(this.channels,function(channel){channel.disconnect()})},Pusher.Channels=Channels}.call(this),function(){Pusher.Channel.Authorizer=function(channel,options){this.channel=channel,this.type=options.authTransport,this.options=options,this.authOptions=(options||{}).auth||{}},Pusher.Channel.Authorizer.prototype={composeQuery:function(socketId){var query="socket_id="+encodeURIComponent(socketId)+"&channel_name="+encodeURIComponent(this.channel.name);for(var i in this.authOptions.params)query+="&"+encodeURIComponent(i)+"="+encodeURIComponent(this.authOptions.params[i]);return query},authorize:function(socketId,callback){return Pusher.authorizers[this.type].call(this,socketId,callback)}};var nextAuthCallbackID=1;Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(socketId,callback){var xhr,self=this;xhr=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xhr.open("POST",self.options.authEndpoint,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var headerName in this.authOptions.headers)xhr.setRequestHeader(headerName,this.authOptions.headers[headerName]);return xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status){var data,parsed=!1;try{data=JSON.parse(xhr.responseText),parsed=!0}catch(e){callback(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+xhr.responseText)}parsed&&callback(!1,data)}else Pusher.warn("Couldn't get auth info from your webapp",xhr.status),callback(!0,xhr.status)},xhr.send(this.composeQuery(socketId)),xhr},jsonp:function(socketId,callback){void 0!==this.authOptions.headers&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var callbackName=nextAuthCallbackID.toString();nextAuthCallbackID++;var document=Pusher.Util.getDocument(),script=document.createElement("script");Pusher.auth_callbacks[callbackName]=function(data){callback(!1,data)};var callback_name="Pusher.auth_callbacks['"+callbackName+"']";script.src=this.options.authEndpoint+"?callback="+encodeURIComponent(callback_name)+"&"+this.composeQuery(socketId);var head=document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(script,head.firstChild)}}}.call(this),Pusher}),function(undefined){function checkGlobal(value){return value&&value.Object===Object?value:null}function cloneArray(arr){for(var a=[],i=0,len=arr.length;i<len;i++)a.push(arr[i]);return a}function tryCatcherGen(tryCatchTarget){return function(){try{return tryCatchTarget.apply(this,arguments)}catch(e){return errorObj.e=e,errorObj}}}function thrower(e){throw e}function makeStackTraceLong(error,observable){if(hasStacks&&observable.stack&&"object"==typeof error&&null!==error&&error.stack&&-1===error.stack.indexOf(STACK_JUMP_SEPARATOR)){for(var stacks=[],o=observable;o;o=o.source)o.stack&&stacks.unshift(o.stack);stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){for(var lines=stackString.split("\n"),desiredLines=[],i=0,len=lines.length;i<len;i++){var line=lines[i];isInternalFrame(line)||isNodeFrame(line)||!line||desiredLines.push(line)}return desiredLines.join("\n")}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber)return!1;var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===rFileName&&lineNumber>=rStartingLine&&lineNumber<=rEndingLine}function isNodeFrame(stackLine){return-1!==stackLine.indexOf("(module.js:")||-1!==stackLine.indexOf("(node.js:")}function captureLine(){if(hasStacks)try{throw new Error}catch(e){var lines=e.stack.split("\n"),firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2],fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber)return;return rFileName=fileNameAndLineNumber[0],fileNameAndLineNumber[1]}}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1)return[attempt1[1],Number(attempt1[2])];var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2)return[attempt2[1],Number(attempt2[2])];var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);return attempt3?[attempt3[1],Number(attempt3[2])]:void 0}function equalObjects(object,other,equalFunc,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length;if(objLength!==keys(other).length&&!isLoose)return!1;for(var key,index=objLength;index--;)if(key=objProps[index],!(isLoose?key in other:hasOwnProperty.call(other,key)))return!1;for(var skipCtor=isLoose;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key];if(!(void 0===undefined?equalFunc(objValue,othValue,isLoose,stackA,stackB):void 0))return!1;skipCtor||(skipCtor="constructor"===key)}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!==othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor))return!1}return!0}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name===other.name&&object.message===other.message;case numberTag:return object!==+object?other!==+other:object===+other;case regexpTag:case stringTag:return object===other+""}return!1}function isObjectLike(value){return!!value&&"object"==typeof value}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function equalArrays(array,other,equalFunc,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!==othLength&&!(isLoose&&othLength>arrLength))return!1;for(;++index<arrLength;){var arrValue=array[index],othValue=other[index];if(void 0!==undefined)return!1;if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,isLoose,stackA,stackB)}))return!1}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,isLoose,stackA,stackB))return!1}return!0}function baseIsEqualDeep(object,other,equalFunc,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;objIsArr||(objTag=objToString.call(object),objTag===argsTag?objTag=objectTag:objTag!==objectTag&&(objIsArr=isTypedArray(object))),othIsArr||(othTag=objToString.call(other))===argsTag&&(othTag=objectTag);var objIsObj=objTag===objectTag&&!isHostObject(object),othIsObj=othTag===objectTag&&!isHostObject(other),isSameTag=objTag===othTag;if(isSameTag&&!objIsArr&&!objIsObj)return equalByTag(object,other,objTag);if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped)return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,isLoose,stackA,stackB)}if(!isSameTag)return!1;stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]===object)return stackB[length]===other;stackA.push(object),stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,isLoose,stackA,stackB);return stackA.pop(),stackB.pop(),result}function baseIsEqual(value,other,isLoose,stackA,stackB){return value===other||(null==value||null==other||!isObject(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,baseIsEqual,isLoose,stackA,stackB))}function arrayInitialize(count,factory){for(var a=new Array(count),i=0;i<count;i++)a[i]=factory();return a}function IndexedItem(id,value){this.id=id,this.value=value}function ScheduledDisposable(scheduler,disposable){this.scheduler=scheduler,this.disposable=disposable,this.isDisposed=!1}function scheduleItem(s,self){self.isDisposed||(self.isDisposed=!0,self.disposable.dispose())}function IsDisposedDisposable(state){this._s=state,this.isDisposed=!1}function StringIterable(s){this._s=s}function StringIterator(s){this._s=s,this._l=s.length,this._i=0}function ArrayIterable(a){this._a=a}function ArrayIterator(a){this._a=a,this._l=toLength(a),this._i=0}function numberIsFinite(value){return"number"==typeof value&&root.isFinite(value)}function getIterable(o){var it,i=o[$iterator$];if(!i&&"string"==typeof o)return it=new StringIterable(o),it[$iterator$]();if(!i&&o.length!==undefined)return it=new ArrayIterable(o),it[$iterator$]();if(!i)throw new TypeError("Object is not iterable");return o[$iterator$]()}function sign(value){var number=+value;return 0===number?number:isNaN(number)?number:number<0?-1:1}function toLength(o){var len=+o.length;return isNaN(len)?0:0!==len&&numberIsFinite(len)?(len=sign(len)*Math.floor(Math.abs(len)),len<=0?0:len>maxSafeInteger?maxSafeInteger:len):len}function observableOf(scheduler,array){return isScheduler(scheduler)||(scheduler=currentThreadScheduler),new FromArrayObservable(array,scheduler)}function RepeatSink(observer,parent){this.observer=observer,this.parent=parent}function amb(p,c){return p.amb(c)}function falseFactory(){return!1}function argumentsToArray(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return args}function falseFactory(){return!1}function argumentsToArray(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return args}function falseFactory(){return!1}function emptyArrayFactory(){return[]}function falseFactory(){return!1}function emptyArrayFactory(){return[]}function argumentsToArray(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return args}function asObservable(source){return function(o){return source.subscribe(o)}}function toArray(x){return x.toArray()}function notEmpty(x){return x.length>0}function repeat(value){return{"@@iterator":function(){return{next:function(){return{done:!1,value:value}}}}}}function repeat(value){return{"@@iterator":function(){return{next:function(){return{done:!1,value:value}}}}}}function concatMap(source,selector,thisArg){var selectorFunc=bindCallback(selector,thisArg,3);return source.map(function(x,i){var result=selectorFunc(x,i,source);return isPromise(result)&&(result=observableFromPromise(result)),(isArrayLike(result)||isIterable(result))&&(result=observableFrom(result)),result}).concatAll()}function arrayIndexOfComparer(array,item,comparer){for(var i=0,len=array.length;i<len;i++)if(comparer(array[i],item))return i;return-1}function HashSet(comparer){this.comparer=comparer,this.set=[]}function plucker(args,len){return function(x){for(var currentProp=x,i=0;i<len;i++){var p=currentProp[args[i]];if(void 0===p)return undefined;currentProp=p}return currentProp}}function firstOnly(x){if(0===x.length)throw new EmptyError;return x[0]}function findValue(source,predicate,thisArg,yieldIndex){var callback=bindCallback(predicate,thisArg,3);return new AnonymousObservable(function(o){return source.subscribe(new FindValueObserver(o,source,callback,yieldIndex))},source)}function toObservable(obj){return obj?Observable.isObservable(obj)?obj:isPromise(obj)?Observable.fromPromise(obj):isGeneratorFunction(obj)||isGenerator(obj)?spawn.call(this,obj):isFunction(obj)?thunkToObservable.call(this,obj):isArrayLike(obj)||isIterable(obj)?arrayToObservable.call(this,obj):isObject(obj)?objectToObservable.call(this,obj):obj:obj}function arrayToObservable(obj){return Observable.from(obj).concatMap(function(o){return Observable.isObservable(o)||isObject(o)?toObservable.call(null,o):Rx.Observable.just(o)}).toArray()}function objectToObservable(obj){for(var results=new obj.constructor,keys=Object.keys(obj),observables=[],i=0,len=keys.length;i<len;i++){var key=keys[i],observable=toObservable.call(this,obj[key]);observable&&Observable.isObservable(observable)?function(observable,key){results[key]=undefined,observables.push(observable.map(function(next){results[key]=next}))}(observable,key):results[key]=obj[key]}return Observable.forkJoin.apply(Observable,observables).map(function(){return results})}function thunkToObservable(fn){var self=this;return new AnonymousObservable(function(o){fn.call(self,function(){var err=arguments[0],res=arguments[1];if(err)return o.onError(err);if(arguments.length>2){for(var args=[],i=1,len=arguments.length;i<len;i++)args.push(arguments[i]);res=args}o.onNext(res),o.onCompleted()})})}function isGenerator(obj){return isFunction(obj.next)&&isFunction(obj.throw)}function isGeneratorFunction(obj){var ctor=obj.constructor;return!!ctor&&("GeneratorFunction"===ctor.name||"GeneratorFunction"===ctor.displayName||isGenerator(ctor.prototype))}function isObject(val){return Object==val.constructor}function createCbObservable(fn,ctx,selector,args){var o=new AsyncSubject;return args.push(createCbHandler(o,ctx,selector)),fn.apply(ctx,args),o.asObservable()}function createCbHandler(o,ctx,selector){return function(){for(var len=arguments.length,results=new Array(len),i=0;i<len;i++)results[i]=arguments[i];if(isFunction(selector)){if((results=tryCatch(selector).apply(ctx,results))===errorObj)return o.onError(results.e);o.onNext(results)}else results.length<=1?o.onNext(results[0]):o.onNext(results);o.onCompleted()}}function createNodeObservable(fn,ctx,selector,args){var o=new AsyncSubject;return args.push(createNodeHandler(o,ctx,selector)),fn.apply(ctx,args),o.asObservable()}function createNodeHandler(o,ctx,selector){return function(){var err=arguments[0];if(err)return o.onError(err);for(var len=arguments.length,results=[],i=1;i<len;i++)results[i-1]=arguments[i];if(isFunction(selector)){var results=tryCatch(selector).apply(ctx,results);if(results===errorObj)return o.onError(results.e);o.onNext(results)}else results.length<=1?o.onNext(results[0]):o.onNext(results);o.onCompleted()}}function isNodeList(el){return root.StaticNodeList?el instanceof root.StaticNodeList||el instanceof root.NodeList:"[object NodeList]"===Object.prototype.toString.call(el)}function ListenDisposable(e,n,fn){this._e=e,this._n=n,this._fn=fn,this._e.addEventListener(this._n,this._fn,!1),this.isDisposed=!1}function createEventListener(el,eventName,handler){var disposables=new CompositeDisposable,elemToString=Object.prototype.toString.call(el);if(isNodeList(el)||"[object HTMLCollection]"===elemToString)for(var i=0,len=el.length;i<len;i++)disposables.add(createEventListener(el.item(i),eventName,handler));else el&&disposables.add(new ListenDisposable(el,eventName,handler));return disposables}function combineLatestSource(source,subject,resultSelector){return new AnonymousObservable(function(o){function next(x,i){if(values[i]=x,hasValue[i]=!0,hasValueAll||(hasValueAll=hasValue.every(identity))){if(err)return o.onError(err);var res=tryCatch(resultSelector).apply(null,values);if(res===errorObj)return o.onError(res.e);o.onNext(res)}isDone&&values[1]&&o.onCompleted()}var err,hasValue=[!1,!1],hasValueAll=!1,isDone=!1,values=new Array(2);return new BinaryDisposable(source.subscribe(function(x){next(x,0)},function(e){values[1]?o.onError(e):err=e},function(){isDone=!0,values[1]&&o.onCompleted()}),subject.subscribe(function(x){next(x,1)},function(e){o.onError(e)},function(){isDone=!0,next(!0,1)}))},source)}function toArray(x){return x.toArray()}function observableWindowWithOpenings(windowOpenings,windowClosingSelector){return windowOpenings.groupJoin(this,windowClosingSelector,observableEmpty,function(_,win){return win})}function observableWindowWithBoundaries(windowBoundaries){var source=this;return new AnonymousObservable(function(observer){var win=new Subject,d=new CompositeDisposable,r=new RefCountDisposable(d);return observer.onNext(addRef(win,r)),d.add(source.subscribe(function(x){win.onNext(x)},function(err){win.onError(err),observer.onError(err)},function(){win.onCompleted(),observer.onCompleted()})),isPromise(windowBoundaries)&&(windowBoundaries=observableFromPromise(windowBoundaries)),d.add(windowBoundaries.subscribe(function(w){win.onCompleted(),win=new Subject,observer.onNext(addRef(win,r))},function(err){win.onError(err),observer.onError(err)},function(){win.onCompleted(),observer.onCompleted()})),r},source)}function observableWindowWithClosingSelector(windowClosingSelector){var source=this;return new AnonymousObservable(function(observer){function createWindowClose(){var windowClose;try{windowClose=windowClosingSelector()}catch(e){return void observer.onError(e)}isPromise(windowClose)&&(windowClose=observableFromPromise(windowClose));var m1=new SingleAssignmentDisposable;m.setDisposable(m1),m1.setDisposable(windowClose.take(1).subscribe(noop,function(err){win.onError(err),observer.onError(err)},function(){win.onCompleted(),win=new Subject,observer.onNext(addRef(win,r)),createWindowClose()}))}var m=new SerialDisposable,d=new CompositeDisposable(m),r=new RefCountDisposable(d),win=new Subject;return observer.onNext(addRef(win,r)),d.add(source.subscribe(function(x){win.onNext(x)},function(err){win.onError(err),observer.onError(err)},function(){win.onCompleted(),observer.onCompleted()})),createWindowClose(),r},source)}function enumerableWhile(condition,source){return new WhileEnumerable(condition,source)}function argumentsToArray(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return args}function Pattern(patterns){this.patterns=patterns}function Plan(expression,selector){this.expression=expression,this.selector=selector}function handleOnError(o){return function(e){o.onError(e)}}function handleOnNext(self,observer){return function(){var result=tryCatch(self.selector).apply(self,arguments);if(result===errorObj)return observer.onError(result.e);observer.onNext(result)}}function planCreateObserver(externalSubscriptions,observable,onError){var entry=externalSubscriptions.get(observable);if(!entry){var observer=new JoinObserver(observable,onError);return externalSubscriptions.set(observable,observer),observer}return entry}function ActivePlan(joinObserverArray,onNext,onCompleted){this.joinObserverArray=joinObserverArray,this.onNext=onNext,this.onCompleted=onCompleted,this.joinObservers=new Map;for(var i=0,len=this.joinObserverArray.length;i<len;i++){var joinObserver=this.joinObserverArray[i];this.joinObservers.set(joinObserver,joinObserver)}}function _observableTimer(dueTime,scheduler){return new TimerObservable(dueTime,scheduler)}function observableTimerDateAndPeriod(dueTime,period,scheduler){return new AnonymousObservable(function(observer){var d=dueTime,p=normalizeTime(period);return scheduler.scheduleRecursiveFuture(0,d,function(count,self){if(p>0){var now=scheduler.now();d=new Date(d.getTime()+p),d.getTime()<=now&&(d=new Date(now+p))}observer.onNext(count),self(count+1,new Date(d))})})}function observableTimerTimeSpanAndPeriod(dueTime,period,scheduler){return dueTime===period?new AnonymousObservable(function(observer){return scheduler.schedulePeriodic(0,period,function(count){return observer.onNext(count),count+1})}):observableDefer(function(){return observableTimerDateAndPeriod(new Date(scheduler.now()+dueTime),period,scheduler)})}function observableDelayRelative(source,dueTime,scheduler){return new AnonymousObservable(function(o){var subscription,active=!1,cancelable=new SerialDisposable,exception=null,q=[],running=!1;return subscription=source.materialize().timestamp(scheduler).subscribe(function(notification){var d,shouldRun;"E"===notification.value.kind?(q=[],q.push(notification),exception=notification.value.error,shouldRun=!running):(q.push({value:notification.value,timestamp:notification.timestamp+dueTime}),shouldRun=!active,active=!0),shouldRun&&(null!==exception?o.onError(exception):(d=new SingleAssignmentDisposable,cancelable.setDisposable(d),d.setDisposable(scheduler.scheduleRecursiveFuture(null,dueTime,function(_,self){var e,recurseDueTime,result,shouldRecurse;if(null===exception){running=!0;do{result=null,q.length>0&&q[0].timestamp-scheduler.now()<=0&&(result=q.shift().value),null!==result&&result.accept(o)}while(null!==result);shouldRecurse=!1,recurseDueTime=0,q.length>0?(shouldRecurse=!0,recurseDueTime=Math.max(0,q[0].timestamp-scheduler.now())):active=!1,e=exception,running=!1,null!==e?o.onError(e):shouldRecurse&&self(null,recurseDueTime)}}))))}),new BinaryDisposable(subscription,cancelable)},source)}function observableDelayAbsolute(source,dueTime,scheduler){return observableDefer(function(){return observableDelayRelative(source,dueTime-scheduler.now(),scheduler)})}function delayWithSelector(source,subscriptionDelay,delayDurationSelector){var subDelay,selector;return isFunction(subscriptionDelay)?selector=subscriptionDelay:(subDelay=subscriptionDelay,selector=delayDurationSelector),new AnonymousObservable(function(o){function start(){subscription.setDisposable(source.subscribe(function(x){var delay=tryCatch(selector)(x);if(delay===errorObj)return o.onError(delay.e);var d=new SingleAssignmentDisposable;delays.add(d),d.setDisposable(delay.subscribe(function(){o.onNext(x),delays.remove(d),done()},function(e){o.onError(e)},function(){o.onNext(x),delays.remove(d),done()}))},function(e){o.onError(e)},function(){atEnd=!0,subscription.dispose(),done()}))}function done(){atEnd&&0===delays.length&&o.onCompleted()}var delays=new CompositeDisposable,atEnd=!1,subscription=new SerialDisposable;return subDelay?subscription.setDisposable(subDelay.subscribe(start,function(e){o.onError(e)},start)):start(),new BinaryDisposable(subscription,delays)},source)}function debounceWithSelector(source,durationSelector){return new AnonymousObservable(function(o){var value,hasValue=!1,cancelable=new SerialDisposable,id=0,subscription=source.subscribe(function(x){var throttle=tryCatch(durationSelector)(x);if(throttle===errorObj)return o.onError(throttle.e);isPromise(throttle)&&(throttle=observableFromPromise(throttle)),hasValue=!0,value=x,id++;var currentid=id,d=new SingleAssignmentDisposable;cancelable.setDisposable(d),d.setDisposable(throttle.subscribe(function(){hasValue&&id===currentid&&o.onNext(value),hasValue=!1,d.dispose()},function(e){o.onError(e)},function(){hasValue&&id===currentid&&o.onNext(value),hasValue=!1,d.dispose()}))},function(e){cancelable.dispose(),o.onError(e),hasValue=!1,id++},function(){cancelable.dispose(),hasValue&&o.onNext(value),o.onCompleted(),hasValue=!1,id++});return new BinaryDisposable(subscription,cancelable)},source)}function toArray(x){return x.toArray()}function toArray(x){return x.toArray()}function timeoutWithSelector(source,firstTimeout,timeoutDurationSelector,other){return isFunction(firstTimeout)&&(other=timeoutDurationSelector,timeoutDurationSelector=firstTimeout,firstTimeout=observableNever()),Observable.isObservable(other)||(other=observableThrow(new TimeoutError)),new AnonymousObservable(function(o){function setTimer(timeout){function timerWins(){return switched=myId===id}var myId=id,d=new SingleAssignmentDisposable;timer.setDisposable(d),d.setDisposable(timeout.subscribe(function(){timerWins()&&subscription.setDisposable(other.subscribe(o)),d.dispose()},function(e){timerWins()&&o.onError(e)},function(){timerWins()&&subscription.setDisposable(other.subscribe(o))}))}function oWins(){var res=!switched;return res&&id++,res}var subscription=new SerialDisposable,timer=new SerialDisposable,original=new SingleAssignmentDisposable;subscription.setDisposable(original);var id=0,switched=!1;return setTimer(firstTimeout),original.setDisposable(source.subscribe(function(x){if(oWins()){o.onNext(x);var timeout=tryCatch(timeoutDurationSelector)(x);if(timeout===errorObj)return o.onError(timeout.e);setTimer(isPromise(timeout)?observableFromPromise(timeout):timeout)}},function(e){oWins()&&o.onError(e)},function(){oWins()&&o.onCompleted()})),new BinaryDisposable(subscription,timer)},source)}function timeout(source,dueTime,other,scheduler){return isScheduler(other)&&(scheduler=other,other=observableThrow(new TimeoutError)),other instanceof Error&&(other=observableThrow(other)),isScheduler(scheduler)||(scheduler=defaultScheduler),Observable.isObservable(other)||(other=observableThrow(new TimeoutError)),new AnonymousObservable(function(o){function createTimer(){var myId=id;timer.setDisposable(scheduler.scheduleFuture(null,dueTime,function(){(switched=id===myId)&&(isPromise(other)&&(other=observableFromPromise(other)),subscription.setDisposable(other.subscribe(o)))}))}var id=0,original=new SingleAssignmentDisposable,subscription=new SerialDisposable,switched=!1,timer=new SerialDisposable;return subscription.setDisposable(original),createTimer(),original.setDisposable(source.subscribe(function(x){switched||(id++,o.onNext(x),createTimer())},function(e){switched||(id++,o.onError(e))},function(){switched||(id++,o.onCompleted())})),new BinaryDisposable(subscription,timer)},source)}function transformForObserver(o){return{"@@transducer/init":function(){return o},"@@transducer/step":function(obs,input){return obs.onNext(input)},"@@transducer/result":function(obs){return obs.onCompleted()}}}function OnNextPredicate(predicate){this.predicate=predicate}function OnErrorPredicate(predicate){this.predicate=predicate}function MockPromise(scheduler,messages){var self=this;this.scheduler=scheduler,this.messages=messages,this.subscriptions=[],this.observers=[];for(var i=0,len=this.messages.length;i<len;i++){var message=this.messages[i],notification=message.value;!function(innerNotification){scheduler.scheduleAbsolute(null,message.time,function(){for(var obs=self.observers.slice(0),j=0,jLen=obs.length;j<jLen;j++)innerNotification.accept(obs[j]);return disposableEmpty})}(notification)}}var objectTypes={function:!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:null,freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:null,freeGlobal=checkGlobal(freeExports&&freeModule&&"object"==typeof global&&global),freeSelf=checkGlobal(objectTypes[typeof self]&&self),freeWindow=checkGlobal(objectTypes[typeof window]&&window),moduleExports=freeModule&&freeModule.exports===freeExports?freeExports:null,thisGlobal=checkGlobal(objectTypes[typeof this]&&this),root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")(),Rx={internals:{},config:{Promise:root.Promise},helpers:{}},noop=Rx.helpers.noop=function(){},identity=Rx.helpers.identity=function(x){return x},defaultNow=Rx.helpers.defaultNow=Date.now,defaultComparer=Rx.helpers.defaultComparer=function(x,y){return isEqual(x,y)},defaultSubComparer=Rx.helpers.defaultSubComparer=function(x,y){return x>y?1:x<y?-1:0},defaultError=(Rx.helpers.defaultKeySerializer=function(x){return x.toString()},Rx.helpers.defaultError=function(err){throw err}),isPromise=Rx.helpers.isPromise=function(p){return!!p&&"function"!=typeof p.subscribe&&"function"==typeof p.then},isFunction=Rx.helpers.isFunction=function(){var isFn=function(value){return"function"==typeof value||!1};return isFn(/x/)&&(isFn=function(value){return"function"==typeof value&&"[object Function]"==toString.call(value)}),isFn}(),errorObj={e:{}},tryCatch=Rx.internals.tryCatch=function(fn){if(!isFunction(fn))throw new TypeError("fn must be a function");return tryCatcherGen(fn)};Rx.config.longStackSupport=!1;var hasStacks=!1,stacks=tryCatch(function(){throw new Error})();hasStacks=!!stacks.e&&!!stacks.e.stack;var rFileName,rStartingLine=captureLine(),STACK_JUMP_SEPARATOR="From previous event:",EmptyError=Rx.EmptyError=function(){this.message="Sequence contains no elements.",Error.call(this)};EmptyError.prototype=Object.create(Error.prototype),EmptyError.prototype.name="EmptyError";var ObjectDisposedError=Rx.ObjectDisposedError=function(){this.message="Object has been disposed",Error.call(this)};ObjectDisposedError.prototype=Object.create(Error.prototype),ObjectDisposedError.prototype.name="ObjectDisposedError";var ArgumentOutOfRangeError=Rx.ArgumentOutOfRangeError=function(){this.message="Argument out of range",Error.call(this)};ArgumentOutOfRangeError.prototype=Object.create(Error.prototype),ArgumentOutOfRangeError.prototype.name="ArgumentOutOfRangeError";var NotSupportedError=Rx.NotSupportedError=function(message){this.message=message||"This operation is not supported",Error.call(this)};NotSupportedError.prototype=Object.create(Error.prototype),NotSupportedError.prototype.name="NotSupportedError";var NotImplementedError=Rx.NotImplementedError=function(message){this.message=message||"This operation is not implemented",Error.call(this)};NotImplementedError.prototype=Object.create(Error.prototype),NotImplementedError.prototype.name="NotImplementedError";var notImplemented=Rx.helpers.notImplemented=function(){throw new NotImplementedError},$iterator$=(Rx.helpers.notSupported=function(){throw new NotSupportedError},"function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_");root.Set&&"function"==typeof(new root.Set)["@@iterator"]&&($iterator$="@@iterator");var doneEnumerator=Rx.doneEnumerator={done:!0,value:undefined},isIterable=Rx.helpers.isIterable=function(o){return o&&o[$iterator$]!==undefined},isArrayLike=Rx.helpers.isArrayLike=function(o){return o&&o.length!==undefined};Rx.helpers.iterator=$iterator$;var bindCallback=Rx.internals.bindCallback=function(func,thisArg,argCount){if(void 0===thisArg)return func;switch(argCount){case 0:return function(){return func.call(thisArg)};case 1:return function(arg){return func.call(thisArg,arg)};case 2:return function(value,index){return func.call(thisArg,value,index)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)}}return function(){return func.apply(thisArg,arguments)}},dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]",typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags["[object ArrayBuffer]"]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags["[object Function]"]=typedArrayTags["[object Map]"]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags["[object Set]"]=typedArrayTags[stringTag]=typedArrayTags["[object WeakMap]"]=!1;var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString,MAX_SAFE_INTEGER=Math.pow(2,53)-1,keys=Object.keys||function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if("object"!=typeof obj&&("function"!=typeof obj||null===obj))throw new TypeError("Object.keys called on non-object");var prop,i,result=[];for(prop in obj)hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(i=0;i<dontEnumsLength;i++)hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}}(),isObject=Rx.internals.isObject=function(value){var type=typeof value;return!!value&&("object"===type||"function"===type)},isHostObject=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(value){return"function"!=typeof value.toString&&"string"==typeof(value+"")}}(),isArray=Array.isArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)===arrayTag},isEqual=Rx.internals.isEqual=function(value,other){return baseIsEqual(value,other)},inherits=(Array.prototype.slice,Rx.internals.inherits=function(child,parent){function __(){this.constructor=child}__.prototype=parent.prototype,child.prototype=new __}),addProperties=Rx.internals.addProperties=function(obj){for(var sources=[],i=1,len=arguments.length;i<len;i++)sources.push(arguments[i]);for(var idx=0,ln=sources.length;idx<ln;idx++){var source=sources[idx];for(var prop in source)obj[prop]=source[prop]}},addRef=Rx.internals.addRef=function(xs,r){return new AnonymousObservable(function(observer){return new BinaryDisposable(r.getDisposable(),xs.subscribe(observer))})};IndexedItem.prototype.compareTo=function(other){var c=this.value.compareTo(other.value);return 0===c&&(c=this.id-other.id),c};var PriorityQueue=Rx.internals.PriorityQueue=function(capacity){this.items=new Array(capacity),this.length=0},priorityProto=PriorityQueue.prototype;priorityProto.isHigherPriority=function(left,right){return this.items[left].compareTo(this.items[right])<0},priorityProto.percolate=function(index){if(!(index>=this.length||index<0)){var parent=index-1>>1;if(!(parent<0||parent===index)&&this.isHigherPriority(index,parent)){var temp=this.items[index];this.items[index]=this.items[parent],this.items[parent]=temp,this.percolate(parent)}}},priorityProto.heapify=function(index){if(+index||(index=0),!(index>=this.length||index<0)){var left=2*index+1,right=2*index+2,first=index;if(left<this.length&&this.isHigherPriority(left,first)&&(first=left),right<this.length&&this.isHigherPriority(right,first)&&(first=right),first!==index){var temp=this.items[index];this.items[index]=this.items[first],this.items[first]=temp,this.heapify(first)}}},priorityProto.peek=function(){return this.items[0].value},priorityProto.removeAt=function(index){this.items[index]=this.items[--this.length],this.items[this.length]=undefined,this.heapify()},priorityProto.dequeue=function(){var result=this.peek();return this.removeAt(0),result},priorityProto.enqueue=function(item){var index=this.length++;this.items[index]=new IndexedItem(PriorityQueue.count++,item),this.percolate(index)},priorityProto.remove=function(item){for(var i=0;i<this.length;i++)if(this.items[i].value===item)return this.removeAt(i),!0;return!1},PriorityQueue.count=0;var CompositeDisposable=Rx.CompositeDisposable=function(){var i,len,args=[];if(Array.isArray(arguments[0]))args=arguments[0];else for(len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];this.disposables=args,this.isDisposed=!1,this.length=args.length},CompositeDisposablePrototype=CompositeDisposable.prototype;CompositeDisposablePrototype.add=function(item){this.isDisposed?item.dispose():(this.disposables.push(item),this.length++)},CompositeDisposablePrototype.remove=function(item){var shouldDispose=!1;if(!this.isDisposed){var idx=this.disposables.indexOf(item);-1!==idx&&(shouldDispose=!0,this.disposables.splice(idx,1),this.length--,item.dispose())}return shouldDispose},CompositeDisposablePrototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var len=this.disposables.length,currentDisposables=new Array(len),i=0;i<len;i++)currentDisposables[i]=this.disposables[i];for(this.disposables=[],this.length=0,i=0;i<len;i++)currentDisposables[i].dispose()}};var Disposable=Rx.Disposable=function(action){this.isDisposed=!1,this.action=action||noop};Disposable.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var disposableCreate=Disposable.create=function(action){return new Disposable(action)},disposableEmpty=Disposable.empty={dispose:noop},isDisposable=Disposable.isDisposable=function(d){return d&&isFunction(d.dispose)},checkDisposed=Disposable.checkDisposed=function(disposable){if(disposable.isDisposed)throw new ObjectDisposedError},disposableFixup=Disposable._fixup=function(result){return isDisposable(result)?result:disposableEmpty},SingleAssignmentDisposable=Rx.SingleAssignmentDisposable=function(){this.isDisposed=!1,this.current=null};SingleAssignmentDisposable.prototype.getDisposable=function(){return this.current},SingleAssignmentDisposable.prototype.setDisposable=function(value){if(this.current)throw new Error("Disposable has already been assigned");var shouldDispose=this.isDisposed;!shouldDispose&&(this.current=value),shouldDispose&&value&&value.dispose()},SingleAssignmentDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var old=this.current;this.current=null,old&&old.dispose()}};var SerialDisposable=Rx.SerialDisposable=function(){this.isDisposed=!1,this.current=null};SerialDisposable.prototype.getDisposable=function(){return this.current},SerialDisposable.prototype.setDisposable=function(value){var shouldDispose=this.isDisposed;if(!shouldDispose){var old=this.current;this.current=value}old&&old.dispose(),shouldDispose&&value&&value.dispose()},SerialDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var old=this.current;this.current=null}old&&old.dispose()};var BinaryDisposable=Rx.BinaryDisposable=function(first,second){this._first=first,this._second=second,this.isDisposed=!1};BinaryDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var old1=this._first;this._first=null,old1&&old1.dispose();var old2=this._second;this._second=null,old2&&old2.dispose()}};var NAryDisposable=Rx.NAryDisposable=function(disposables){this._disposables=disposables,this.isDisposed=!1};NAryDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var i=0,len=this._disposables.length;i<len;i++)this._disposables[i].dispose();this._disposables.length=0}};var RefCountDisposable=Rx.RefCountDisposable=function(){function InnerDisposable(disposable){this.disposable=disposable,this.disposable.count++,this.isInnerDisposed=!1}function RefCountDisposable(disposable){this.underlyingDisposable=disposable,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}return InnerDisposable.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,0===--this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},RefCountDisposable.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},RefCountDisposable.prototype.getDisposable=function(){return this.isDisposed?disposableEmpty:new InnerDisposable(this)},RefCountDisposable}();ScheduledDisposable.prototype.dispose=function(){this.scheduler.schedule(this,scheduleItem)};var ScheduledItem=Rx.internals.ScheduledItem=function(scheduler,state,action,dueTime,comparer){this.scheduler=scheduler,this.state=state,this.action=action,this.dueTime=dueTime,this.comparer=comparer||defaultSubComparer,this.disposable=new SingleAssignmentDisposable};ScheduledItem.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},ScheduledItem.prototype.compareTo=function(other){return this.comparer(this.dueTime,other.dueTime)},ScheduledItem.prototype.isCancelled=function(){return this.disposable.isDisposed},ScheduledItem.prototype.invokeCore=function(){return disposableFixup(this.action(this.scheduler,this.state))};var Scheduler=Rx.Scheduler=function(){function Scheduler(){}Scheduler.isScheduler=function(s){return s instanceof Scheduler};var schedulerProto=Scheduler.prototype;return schedulerProto.schedule=function(state,action){throw new NotImplementedError},schedulerProto.scheduleFuture=function(state,dueTime,action){var dt=dueTime;return dt instanceof Date&&(dt-=this.now()),dt=Scheduler.normalize(dt),0===dt?this.schedule(state,action):this._scheduleFuture(state,dt,action)},schedulerProto._scheduleFuture=function(state,dueTime,action){throw new NotImplementedError},Scheduler.now=defaultNow,Scheduler.prototype.now=defaultNow,Scheduler.normalize=function(timeSpan){return timeSpan<0&&(timeSpan=0),timeSpan},Scheduler}(),normalizeTime=Scheduler.normalize,isScheduler=Scheduler.isScheduler;!function(schedulerProto){function invokeRecImmediate(scheduler,pair){function innerAction(state2){function scheduleWork(_,state3){return isAdded?group.remove(d):isDone=!0,action(state3,innerAction),disposableEmpty}var isAdded=!1,isDone=!1,d=scheduler.schedule(state2,scheduleWork);isDone||(group.add(d),isAdded=!0)}var state=pair[0],action=pair[1],group=new CompositeDisposable;return action(state,innerAction),group}function invokeRecDate(scheduler,pair){function innerAction(state2,dueTime1){function scheduleWork(_,state3){return isAdded?group.remove(d):isDone=!0,action(state3,innerAction),disposableEmpty}var isAdded=!1,isDone=!1,d=scheduler.scheduleFuture(state2,dueTime1,scheduleWork);isDone||(group.add(d),isAdded=!0)}var state=pair[0],action=pair[1],group=new CompositeDisposable;return action(state,innerAction),group}schedulerProto.scheduleRecursive=function(state,action){return this.schedule([state,action],invokeRecImmediate)},schedulerProto.scheduleRecursiveFuture=function(state,dueTime,action){return this.scheduleFuture([state,action],dueTime,invokeRecDate)}}(Scheduler.prototype),function(schedulerProto){schedulerProto.schedulePeriodic=function(state,period,action){if(void 0===root.setInterval)throw new NotSupportedError;period=normalizeTime(period);var s=state,id=root.setInterval(function(){s=action(s)},period);return disposableCreate(function(){root.clearInterval(id)})}}(Scheduler.prototype),function(schedulerProto){schedulerProto.catchError=schedulerProto.catch=function(handler){return new CatchScheduler(this,handler)}}(Scheduler.prototype);var scheduleMethod,clearMethod,SchedulePeriodicRecursive=Rx.internals.SchedulePeriodicRecursive=function(){function createTick(self){return function(command,recurse){recurse(0,self._period);var state=tryCatch(self._action)(self._state);state===errorObj&&(self._cancel.dispose(),thrower(state.e)),self._state=state}}function SchedulePeriodicRecursive(scheduler,state,period,action){this._scheduler=scheduler,this._state=state,this._period=period,this._action=action}return SchedulePeriodicRecursive.prototype.start=function(){var d=new SingleAssignmentDisposable;return this._cancel=d,d.setDisposable(this._scheduler.scheduleRecursiveFuture(0,this._period,createTick(this))),d},SchedulePeriodicRecursive}(),ImmediateScheduler=function(__super__){function ImmediateScheduler(){__super__.call(this)}return inherits(ImmediateScheduler,__super__),ImmediateScheduler.prototype.schedule=function(state,action){return disposableFixup(action(this,state))},ImmediateScheduler}(Scheduler),immediateScheduler=Scheduler.immediate=new ImmediateScheduler,CurrentThreadScheduler=function(__super__){function runTrampoline(){for(;queue.length>0;){var item=queue.dequeue();!item.isCancelled()&&item.invoke()}}function CurrentThreadScheduler(){__super__.call(this)}var queue;return inherits(CurrentThreadScheduler,__super__),CurrentThreadScheduler.prototype.schedule=function(state,action){var si=new ScheduledItem(this,state,action,this.now());if(queue)queue.enqueue(si);else{queue=new PriorityQueue(4),queue.enqueue(si);var result=tryCatch(runTrampoline)();queue=null,result===errorObj&&thrower(result.e)}return si.disposable},CurrentThreadScheduler.prototype.scheduleRequired=function(){return!queue},CurrentThreadScheduler}(Scheduler),currentThreadScheduler=Scheduler.currentThread=new CurrentThreadScheduler,localTimer=function(){var localSetTimeout,localClearTimeout=noop;if(root.setTimeout)localSetTimeout=root.setTimeout,localClearTimeout=root.clearTimeout;else{if(!root.WScript)throw new NotSupportedError;localSetTimeout=function(fn,time){root.WScript.Sleep(time),fn()}}return{setTimeout:localSetTimeout,clearTimeout:localClearTimeout}}(),localSetTimeout=localTimer.setTimeout,localClearTimeout=localTimer.clearTimeout;!function(){function runTask(handle){if(currentlyRunning)localSetTimeout(function(){runTask(handle)},0);else{var task=tasksByHandle[handle];if(task){currentlyRunning=!0;var result=tryCatch(task)();clearMethod(handle),currentlyRunning=!1,result===errorObj&&thrower(result.e)}}}var nextHandle=1,tasksByHandle={},currentlyRunning=!1;clearMethod=function(handle){delete tasksByHandle[handle]};var reNative=new RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),setImmediate="function"==typeof(setImmediate=freeGlobal&&moduleExports&&freeGlobal.setImmediate)&&!reNative.test(setImmediate)&&setImmediate;if(isFunction(setImmediate))scheduleMethod=function(action){var id=nextHandle++;return tasksByHandle[id]=action,setImmediate(function(){runTask(id)}),id};else if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))scheduleMethod=function(action){var id=nextHandle++;return tasksByHandle[id]=action,process.nextTick(function(){runTask(id)}),id};else if(function(){if(!root.postMessage||root.importScripts)return!1;var isAsync=!1,oldHandler=root.onmessage;return root.onmessage=function(){isAsync=!0},root.postMessage("","*"),root.onmessage=oldHandler,isAsync}()){var MSG_PREFIX="ms.rx.schedule"+Math.random(),onGlobalPostMessage=function(event){"string"==typeof event.data&&event.data.substring(0,MSG_PREFIX.length)===MSG_PREFIX&&runTask(event.data.substring(MSG_PREFIX.length))};root.addEventListener("message",onGlobalPostMessage,!1),scheduleMethod=function(action){var id=nextHandle++;return tasksByHandle[id]=action,root.postMessage(MSG_PREFIX+id,"*"),id}}else if(root.MessageChannel){var channel=new root.MessageChannel;channel.port1.onmessage=function(e){runTask(e.data)},scheduleMethod=function(action){var id=nextHandle++;return tasksByHandle[id]=action,channel.port2.postMessage(id),id}}else scheduleMethod="document"in root&&"onreadystatechange"in root.document.createElement("script")?function(action){var scriptElement=root.document.createElement("script"),id=nextHandle++;return tasksByHandle[id]=action,scriptElement.onreadystatechange=function(){runTask(id),scriptElement.onreadystatechange=null,scriptElement.parentNode.removeChild(scriptElement),scriptElement=null},root.document.documentElement.appendChild(scriptElement),id}:function(action){var id=nextHandle++;return tasksByHandle[id]=action,localSetTimeout(function(){runTask(id)},0),id}}();var DefaultScheduler=function(__super__){function DefaultScheduler(){__super__.call(this)}function scheduleAction(disposable,action,scheduler,state){return function(){disposable.setDisposable(Disposable._fixup(action(scheduler,state)))}}function ClearDisposable(id){this._id=id,this.isDisposed=!1}function LocalClearDisposable(id){this._id=id,this.isDisposed=!1}function scheduleLongRunning(state,action,disposable){return function(){action(state,disposable)}}return inherits(DefaultScheduler,__super__),ClearDisposable.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,clearMethod(this._id))},LocalClearDisposable.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,localClearTimeout(this._id))},DefaultScheduler.prototype.schedule=function(state,action){var disposable=new SingleAssignmentDisposable,id=scheduleMethod(scheduleAction(disposable,action,this,state));return new BinaryDisposable(disposable,new ClearDisposable(id))},DefaultScheduler.prototype._scheduleFuture=function(state,dueTime,action){if(0===dueTime)return this.schedule(state,action);var disposable=new SingleAssignmentDisposable,id=localSetTimeout(scheduleAction(disposable,action,this,state),dueTime);return new BinaryDisposable(disposable,new LocalClearDisposable(id))},DefaultScheduler.prototype.scheduleLongRunning=function(state,action){var disposable=disposableCreate(noop);return scheduleMethod(scheduleLongRunning(state,action,disposable)),disposable},DefaultScheduler}(Scheduler),defaultScheduler=Scheduler.default=Scheduler.async=new DefaultScheduler,CatchScheduler=function(__super__){function CatchScheduler(scheduler,handler){this._scheduler=scheduler,this._handler=handler,this._recursiveOriginal=null,this._recursiveWrapper=null,__super__.call(this)}return inherits(CatchScheduler,__super__),CatchScheduler.prototype.schedule=function(state,action){return this._scheduler.schedule(state,this._wrap(action))},CatchScheduler.prototype._scheduleFuture=function(state,dueTime,action){return this._scheduler.schedule(state,dueTime,this._wrap(action))},CatchScheduler.prototype.now=function(){return this._scheduler.now()},CatchScheduler.prototype._clone=function(scheduler){return new CatchScheduler(scheduler,this._handler)},CatchScheduler.prototype._wrap=function(action){var parent=this;return function(self,state){var res=tryCatch(action)(parent._getRecursiveWrapper(self),state);return res===errorObj?(parent._handler(res.e)||thrower(res.e),disposableEmpty):disposableFixup(res)}},CatchScheduler.prototype._getRecursiveWrapper=function(scheduler){if(this._recursiveOriginal!==scheduler){this._recursiveOriginal=scheduler;var wrapper=this._clone(scheduler);wrapper._recursiveOriginal=scheduler,wrapper._recursiveWrapper=wrapper,this._recursiveWrapper=wrapper}return this._recursiveWrapper},CatchScheduler.prototype.schedulePeriodic=function(state,period,action){var self=this,failed=!1,d=new SingleAssignmentDisposable;return d.setDisposable(this._scheduler.schedulePeriodic(state,period,function(state1){if(failed)return null;var res=tryCatch(action)(state1);return res===errorObj?(failed=!0,self._handler(res.e)||thrower(res.e),d.dispose(),null):res})),d},CatchScheduler}(Scheduler),Notification=Rx.Notification=function(){function Notification(){}return Notification.prototype._accept=function(onNext,onError,onCompleted){throw new NotImplementedError},Notification.prototype._acceptObserver=function(onNext,onError,onCompleted){throw new NotImplementedError},Notification.prototype.accept=function(observerOrOnNext,onError,onCompleted){return observerOrOnNext&&"object"==typeof observerOrOnNext?this._acceptObserver(observerOrOnNext):this._accept(observerOrOnNext,onError,onCompleted)},Notification.prototype.toObservable=function(scheduler){var self=this;return isScheduler(scheduler)||(scheduler=immediateScheduler),new AnonymousObservable(function(o){return scheduler.schedule(self,function(_,notification){notification._acceptObserver(o),"N"===notification.kind&&o.onCompleted()})})},Notification}(),OnNextNotification=function(__super__){function OnNextNotification(value){this.value=value,this.kind="N"}return inherits(OnNextNotification,__super__),OnNextNotification.prototype._accept=function(onNext){return onNext(this.value)},OnNextNotification.prototype._acceptObserver=function(o){return o.onNext(this.value)},OnNextNotification.prototype.toString=function(){return"OnNext("+this.value+")"},OnNextNotification}(Notification),OnErrorNotification=function(__super__){function OnErrorNotification(error){this.error=error,this.kind="E"}return inherits(OnErrorNotification,__super__),OnErrorNotification.prototype._accept=function(onNext,onError){return onError(this.error)},OnErrorNotification.prototype._acceptObserver=function(o){return o.onError(this.error)},OnErrorNotification.prototype.toString=function(){return"OnError("+this.error+")"},OnErrorNotification}(Notification),OnCompletedNotification=function(__super__){function OnCompletedNotification(){this.kind="C"}return inherits(OnCompletedNotification,__super__),OnCompletedNotification.prototype._accept=function(onNext,onError,onCompleted){return onCompleted()},OnCompletedNotification.prototype._acceptObserver=function(o){return o.onCompleted()},OnCompletedNotification.prototype.toString=function(){return"OnCompleted()"},OnCompletedNotification}(Notification),notificationCreateOnNext=Notification.createOnNext=function(value){return new OnNextNotification(value)},notificationCreateOnError=Notification.createOnError=function(error){return new OnErrorNotification(error)},notificationCreateOnCompleted=Notification.createOnCompleted=function(){return new OnCompletedNotification},Observer=Rx.Observer=function(){};Observer.prototype.toNotifier=function(){var observer=this;return function(n){return n.accept(observer)}},Observer.prototype.asObserver=function(){var self=this;return new AnonymousObserver(function(x){self.onNext(x)},function(err){self.onError(err)},function(){self.onCompleted()})},Observer.prototype.checked=function(){return new CheckedObserver(this)};var observerCreate=Observer.create=function(onNext,onError,onCompleted){return onNext||(onNext=noop),onError||(onError=defaultError),onCompleted||(onCompleted=noop),new AnonymousObserver(onNext,onError,onCompleted)};Observer.fromNotifier=function(handler,thisArg){var cb=bindCallback(handler,thisArg,1);return new AnonymousObserver(function(x){return cb(notificationCreateOnNext(x))},function(e){return cb(notificationCreateOnError(e))},function(){return cb(notificationCreateOnCompleted())})},Observer.prototype.notifyOn=function(scheduler){return new ObserveOnObserver(scheduler,this)},Observer.prototype.makeSafe=function(disposable){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,disposable)};var observableProto,AbstractObserver=Rx.internals.AbstractObserver=function(__super__){function AbstractObserver(){this.isStopped=!1}return inherits(AbstractObserver,__super__),AbstractObserver.prototype.next=notImplemented,AbstractObserver.prototype.error=notImplemented,AbstractObserver.prototype.completed=notImplemented,AbstractObserver.prototype.onNext=function(value){!this.isStopped&&this.next(value)},AbstractObserver.prototype.onError=function(error){this.isStopped||(this.isStopped=!0,this.error(error))},AbstractObserver.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},AbstractObserver.prototype.dispose=function(){this.isStopped=!0},AbstractObserver.prototype.fail=function(e){return!this.isStopped&&(this.isStopped=!0,this.error(e),!0)},AbstractObserver}(Observer),AnonymousObserver=Rx.AnonymousObserver=function(__super__){function AnonymousObserver(onNext,onError,onCompleted){__super__.call(this),this._onNext=onNext,this._onError=onError,this._onCompleted=onCompleted}return inherits(AnonymousObserver,__super__),AnonymousObserver.prototype.next=function(value){this._onNext(value)},AnonymousObserver.prototype.error=function(error){this._onError(error)},AnonymousObserver.prototype.completed=function(){this._onCompleted()},AnonymousObserver}(AbstractObserver),CheckedObserver=function(__super__){function CheckedObserver(observer){__super__.call(this),this._observer=observer,this._state=0}inherits(CheckedObserver,__super__);var CheckedObserverPrototype=CheckedObserver.prototype;return CheckedObserverPrototype.onNext=function(value){this.checkAccess();var res=tryCatch(this._observer.onNext).call(this._observer,value);this._state=0,res===errorObj&&thrower(res.e)},CheckedObserverPrototype.onError=function(err){this.checkAccess();var res=tryCatch(this._observer.onError).call(this._observer,err);this._state=2,res===errorObj&&thrower(res.e)},CheckedObserverPrototype.onCompleted=function(){this.checkAccess();var res=tryCatch(this._observer.onCompleted).call(this._observer);this._state=2,res===errorObj&&thrower(res.e)},CheckedObserverPrototype.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},CheckedObserver}(Observer),ScheduledObserver=Rx.internals.ScheduledObserver=function(__super__){function ScheduledObserver(scheduler,observer){__super__.call(this),this.scheduler=scheduler,this.observer=observer,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new SerialDisposable}function enqueueNext(observer,x){return function(){observer.onNext(x)}}function enqueueError(observer,e){return function(){observer.onError(e)}}function enqueueCompleted(observer){return function(){observer.onCompleted()}}function scheduleMethod(state,recurse){var work;if(!(state.queue.length>0))return void(state.isAcquired=!1);work=state.queue.shift();var res=tryCatch(work)();if(res===errorObj)return state.queue=[],state.hasFaulted=!0,thrower(res.e);recurse(state)}return inherits(ScheduledObserver,__super__),ScheduledObserver.prototype.next=function(x){this.queue.push(enqueueNext(this.observer,x))},ScheduledObserver.prototype.error=function(e){this.queue.push(enqueueError(this.observer,e))},ScheduledObserver.prototype.completed=function(){this.queue.push(enqueueCompleted(this.observer))},ScheduledObserver.prototype.ensureActive=function(){var isOwner=!1;!this.hasFaulted&&this.queue.length>0&&(isOwner=!this.isAcquired,this.isAcquired=!0),isOwner&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(this,scheduleMethod))},ScheduledObserver.prototype.dispose=function(){__super__.prototype.dispose.call(this),this.disposable.dispose()},ScheduledObserver}(AbstractObserver),ObserveOnObserver=function(__super__){function ObserveOnObserver(scheduler,observer,cancel){__super__.call(this,scheduler,observer),this._cancel=cancel}return inherits(ObserveOnObserver,__super__),ObserveOnObserver.prototype.next=function(value){__super__.prototype.next.call(this,value),this.ensureActive()},ObserveOnObserver.prototype.error=function(e){__super__.prototype.error.call(this,e),this.ensureActive()},ObserveOnObserver.prototype.completed=function(){__super__.prototype.completed.call(this),this.ensureActive()},ObserveOnObserver.prototype.dispose=function(){__super__.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},ObserveOnObserver}(ScheduledObserver),Observable=Rx.Observable=function(){function makeSubscribe(self,subscribe){return function(o){var oldOnError=o.onError;return o.onError=function(e){makeStackTraceLong(e,self),oldOnError.call(o,e)},subscribe.call(self,o)}}function Observable(){if(Rx.config.longStackSupport&&hasStacks){var oldSubscribe=this._subscribe,e=tryCatch(thrower)(new Error).e;this.stack=e.stack.substring(e.stack.indexOf("\n")+1),this._subscribe=makeSubscribe(this,oldSubscribe)}}return observableProto=Observable.prototype,Observable.isObservable=function(o){return o&&isFunction(o.subscribe)},observableProto.subscribe=observableProto.forEach=function(oOrOnNext,onError,onCompleted){return this._subscribe("object"==typeof oOrOnNext?oOrOnNext:observerCreate(oOrOnNext,onError,onCompleted))},observableProto.subscribeOnNext=function(onNext,thisArg){return this._subscribe(observerCreate(void 0!==thisArg?function(x){onNext.call(thisArg,x)}:onNext))},observableProto.subscribeOnError=function(onError,thisArg){return this._subscribe(observerCreate(null,void 0!==thisArg?function(e){onError.call(thisArg,e)}:onError))},observableProto.subscribeOnCompleted=function(onCompleted,thisArg){return this._subscribe(observerCreate(null,null,void 0!==thisArg?function(){onCompleted.call(thisArg)}:onCompleted))},Observable}(),ObservableBase=Rx.ObservableBase=function(__super__){function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],self=state[1],sub=tryCatch(self.subscribeCore).call(self,ado);sub!==errorObj||ado.fail(errorObj.e)||thrower(errorObj.e),ado.setDisposable(fixSubscriber(sub))}function ObservableBase(){__super__.call(this)}return inherits(ObservableBase,__super__),ObservableBase.prototype._subscribe=function(o){var ado=new AutoDetachObserver(o),state=[ado,this];return currentThreadScheduler.scheduleRequired()?currentThreadScheduler.schedule(state,setDisposable):setDisposable(null,state),ado},ObservableBase.prototype.subscribeCore=notImplemented,ObservableBase}(Observable),FlatMapObservable=Rx.FlatMapObservable=function(__super__){function FlatMapObservable(source,selector,resultSelector,thisArg){this.resultSelector=isFunction(resultSelector)?resultSelector:null,this.selector=bindCallback(isFunction(selector)?selector:function(){return selector},thisArg,3),this.source=source,__super__.call(this)}function InnerObserver(observer,selector,resultSelector,source){this.i=0,this.selector=selector,this.resultSelector=resultSelector,this.source=source,this.o=observer,AbstractObserver.call(this)}return inherits(FlatMapObservable,__super__),FlatMapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.selector,this.resultSelector,this))},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype._wrapResult=function(result,x,i){return this.resultSelector?result.map(function(y,i2){return this.resultSelector(x,y,i,i2)},this):result},InnerObserver.prototype.next=function(x){var i=this.i++,result=tryCatch(this.selector)(x,i,this.source);if(result===errorObj)return this.o.onError(result.e);isPromise(result)&&(result=observableFromPromise(result)),(isArrayLike(result)||isIterable(result))&&(result=Observable.from(result)),this.o.onNext(this._wrapResult(result,x,i))},InnerObserver.prototype.error=function(e){this.o.onError(e)},InnerObserver.prototype.completed=function(){this.o.onCompleted()},FlatMapObservable}(ObservableBase),Enumerable=Rx.internals.Enumerable=function(){};IsDisposedDisposable.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._s.isDisposed=!0)};var ConcatEnumerableObservable=function(__super__){function ConcatEnumerableObservable(sources){this.sources=sources,__super__.call(this)}function scheduleMethod(state,recurse){if(!state.isDisposed){var currentItem=tryCatch(state.e.next).call(state.e);if(currentItem===errorObj)return state.o.onError(currentItem.e);if(currentItem.done)return state.o.onCompleted();var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;state.subscription.setDisposable(d),d.setDisposable(currentValue.subscribe(new InnerObserver(state,recurse)))}}function InnerObserver(state,recurse){this._state=state,this._recurse=recurse,AbstractObserver.call(this)}return inherits(ConcatEnumerableObservable,__super__),ConcatEnumerableObservable.prototype.subscribeCore=function(o){var subscription=new SerialDisposable,state={isDisposed:!1,o:o,subscription:subscription,e:this.sources[$iterator$]()},cancelable=currentThreadScheduler.scheduleRecursive(state,scheduleMethod);return new NAryDisposable([subscription,cancelable,new IsDisposedDisposable(state)])},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype.next=function(x){this._state.o.onNext(x)},InnerObserver.prototype.error=function(e){this._state.o.onError(e)},InnerObserver.prototype.completed=function(){this._recurse(this._state)},ConcatEnumerableObservable}(ObservableBase);Enumerable.prototype.concat=function(){return new ConcatEnumerableObservable(this)};var CatchErrorObservable=function(__super__){function CatchErrorObservable(sources){this.sources=sources,__super__.call(this)}function scheduleMethod(state,recurse){if(!state.isDisposed){var currentItem=tryCatch(state.e.next).call(state.e);if(currentItem===errorObj)return state.o.onError(currentItem.e);if(currentItem.done)return null!==state.lastError?state.o.onError(state.lastError):state.o.onCompleted();var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;state.subscription.setDisposable(d),d.setDisposable(currentValue.subscribe(new InnerObserver(state,recurse)))}}function InnerObserver(state,recurse){this._state=state,this._recurse=recurse,AbstractObserver.call(this)}return inherits(CatchErrorObservable,__super__),CatchErrorObservable.prototype.subscribeCore=function(o){var subscription=new SerialDisposable,state={isDisposed:!1,e:this.sources[$iterator$](),subscription:subscription,lastError:null,o:o},cancelable=currentThreadScheduler.scheduleRecursive(state,scheduleMethod);return new NAryDisposable([subscription,cancelable,new IsDisposedDisposable(state)])},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype.next=function(x){this._state.o.onNext(x)},InnerObserver.prototype.error=function(e){this._state.lastError=e,this._recurse(this._state)},InnerObserver.prototype.completed=function(){this._state.o.onCompleted()},CatchErrorObservable}(ObservableBase);Enumerable.prototype.catchError=function(){return new CatchErrorObservable(this)};var RepeatEnumerable=function(__super__){function RepeatEnumerable(v,c){this.v=v,this.c=null==c?-1:c}function RepeatEnumerator(p){this.v=p.v,this.l=p.c}return inherits(RepeatEnumerable,__super__),RepeatEnumerable.prototype[$iterator$]=function(){return new RepeatEnumerator(this)},RepeatEnumerator.prototype.next=function(){return 0===this.l?doneEnumerator:(this.l>0&&this.l--,{done:!1,value:this.v})},RepeatEnumerable}(Enumerable),enumerableRepeat=Enumerable.repeat=function(value,repeatCount){return new RepeatEnumerable(value,repeatCount)},OfEnumerable=function(__super__){function OfEnumerable(s,fn,thisArg){this.s=s,this.fn=fn?bindCallback(fn,thisArg,3):null}function OfEnumerator(p){this.i=-1,this.s=p.s,this.l=this.s.length,this.fn=p.fn}return inherits(OfEnumerable,__super__),OfEnumerable.prototype[$iterator$]=function(){return new OfEnumerator(this)},OfEnumerator.prototype.next=function(){return++this.i<this.l?{done:!1,value:this.fn?this.fn(this.s[this.i],this.i,this.s):this.s[this.i]}:doneEnumerator},OfEnumerable}(Enumerable),enumerableOf=Enumerable.of=function(source,selector,thisArg){return new OfEnumerable(source,selector,thisArg)},ObserveOnObservable=function(__super__){function ObserveOnObservable(source,s){this.source=source,this._s=s,__super__.call(this)}return inherits(ObserveOnObservable,__super__),ObserveOnObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new ObserveOnObserver(this._s,o))},ObserveOnObservable}(ObservableBase);observableProto.observeOn=function(scheduler){return new ObserveOnObservable(this,scheduler)};var SubscribeOnObservable=function(__super__){function SubscribeOnObservable(source,s){this.source=source,this._s=s,__super__.call(this)}function scheduleMethod(scheduler,state){var source=state[0],d=state[1],o=state[2];d.setDisposable(new ScheduledDisposable(scheduler,source.subscribe(o)))}return inherits(SubscribeOnObservable,__super__),SubscribeOnObservable.prototype.subscribeCore=function(o){var m=new SingleAssignmentDisposable,d=new SerialDisposable;return d.setDisposable(m),m.setDisposable(this._s.schedule([this.source,d,o],scheduleMethod)),d},SubscribeOnObservable}(ObservableBase);observableProto.subscribeOn=function(scheduler){return new SubscribeOnObservable(this,scheduler)};var FromPromiseObservable=function(__super__){function FromPromiseObservable(p,s){this._p=p,this._s=s,__super__.call(this)}function scheduleNext(s,state){var o=state[0],data=state[1];o.onNext(data),o.onCompleted()}function scheduleError(s,state){var o=state[0],err=state[1];o.onError(err)}return inherits(FromPromiseObservable,__super__),FromPromiseObservable.prototype.subscribeCore=function(o){var sad=new SingleAssignmentDisposable,self=this,p=this._p;return isFunction(p)&&(p=tryCatch(p)())===errorObj?(o.onError(p.e),sad):(p.then(function(data){sad.setDisposable(self._s.schedule([o,data],scheduleNext))},function(err){sad.setDisposable(self._s.schedule([o,err],scheduleError))}),sad)},FromPromiseObservable}(ObservableBase),observableFromPromise=Observable.fromPromise=function(promise,scheduler){return scheduler||(scheduler=defaultScheduler),new FromPromiseObservable(promise,scheduler)};observableProto.toPromise=function(promiseCtor){if(promiseCtor||(promiseCtor=Rx.config.Promise),!promiseCtor)throw new NotSupportedError("Promise type not provided nor in Rx.config.Promise");var source=this;return new promiseCtor(function(resolve,reject){var value;source.subscribe(function(v){value=v},reject,function(){resolve(value)})})};var ToArrayObservable=function(__super__){function ToArrayObservable(source){this.source=source,__super__.call(this)}function InnerObserver(o){this.o=o,this.a=[],AbstractObserver.call(this)}return inherits(ToArrayObservable,__super__),ToArrayObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o))},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype.next=function(x){this.a.push(x)},InnerObserver.prototype.error=function(e){this.o.onError(e)},InnerObserver.prototype.completed=function(){this.o.onNext(this.a),this.o.onCompleted()},ToArrayObservable}(ObservableBase);observableProto.toArray=function(){return new ToArrayObservable(this)},Observable.create=function(subscribe,parent){return new AnonymousObservable(subscribe,parent)};var Defer=function(__super__){function Defer(factory){this._f=factory,__super__.call(this)}return inherits(Defer,__super__),Defer.prototype.subscribeCore=function(o){var result=tryCatch(this._f)();return result===errorObj?observableThrow(result.e).subscribe(o):(isPromise(result)&&(result=observableFromPromise(result)),result.subscribe(o))},Defer}(ObservableBase),observableDefer=Observable.defer=function(observableFactory){return new Defer(observableFactory)},EmptyObservable=function(__super__){function EmptyObservable(scheduler){this.scheduler=scheduler,__super__.call(this)}function EmptySink(observer,scheduler){this.observer=observer,this.scheduler=scheduler}function scheduleItem(s,state){return state.onCompleted(),disposableEmpty}return inherits(EmptyObservable,__super__),EmptyObservable.prototype.subscribeCore=function(observer){return new EmptySink(observer,this.scheduler).run()},EmptySink.prototype.run=function(){var state=this.observer;return this.scheduler===immediateScheduler?scheduleItem(null,state):this.scheduler.schedule(state,scheduleItem)},EmptyObservable}(ObservableBase),EMPTY_OBSERVABLE=new EmptyObservable(immediateScheduler),observableEmpty=Observable.empty=function(scheduler){return isScheduler(scheduler)||(scheduler=immediateScheduler),scheduler===immediateScheduler?EMPTY_OBSERVABLE:new EmptyObservable(scheduler)},FromObservable=function(__super__){function FromObservable(iterable,fn,scheduler){this._iterable=iterable,this._fn=fn,this._scheduler=scheduler,__super__.call(this)}function createScheduleMethod(o,it,fn){return function(i,recurse){var next=tryCatch(it.next).call(it);if(next===errorObj)return o.onError(next.e);if(next.done)return o.onCompleted();var result=next.value;if(isFunction(fn)&&(result=tryCatch(fn)(result,i))===errorObj)return o.onError(result.e);o.onNext(result),recurse(i+1)}}return inherits(FromObservable,__super__),FromObservable.prototype.subscribeCore=function(o){var list=Object(this._iterable),it=getIterable(list);return this._scheduler.scheduleRecursive(0,createScheduleMethod(o,it,this._fn))},FromObservable}(ObservableBase),maxSafeInteger=Math.pow(2,53)-1;StringIterable.prototype[$iterator$]=function(){return new StringIterator(this._s)},StringIterator.prototype[$iterator$]=function(){return this},StringIterator.prototype.next=function(){return this._i<this._l?{done:!1,value:this._s.charAt(this._i++)}:doneEnumerator},ArrayIterable.prototype[$iterator$]=function(){return new ArrayIterator(this._a)},ArrayIterator.prototype[$iterator$]=function(){return this},ArrayIterator.prototype.next=function(){return this._i<this._l?{done:!1,value:this._a[this._i++]}:doneEnumerator};var observableFrom=Observable.from=function(iterable,mapFn,thisArg,scheduler){if(null==iterable)throw new Error("iterable cannot be null.");if(mapFn&&!isFunction(mapFn))throw new Error("mapFn when provided must be a function");if(mapFn)var mapper=bindCallback(mapFn,thisArg,2);return isScheduler(scheduler)||(scheduler=currentThreadScheduler),new FromObservable(iterable,mapper,scheduler)},FromArrayObservable=function(__super__){function FromArrayObservable(args,scheduler){this._args=args,this._scheduler=scheduler,__super__.call(this)}function scheduleMethod(o,args){var len=args.length;return function(i,recurse){i<len?(o.onNext(args[i]),recurse(i+1)):o.onCompleted()}}return inherits(FromArrayObservable,__super__),FromArrayObservable.prototype.subscribeCore=function(o){return this._scheduler.scheduleRecursive(0,scheduleMethod(o,this._args))},FromArrayObservable}(ObservableBase),observableFromArray=Observable.fromArray=function(array,scheduler){return isScheduler(scheduler)||(scheduler=currentThreadScheduler),new FromArrayObservable(array,scheduler)},GenerateObservable=function(__super__){function GenerateObservable(state,cndFn,itrFn,resFn,s){this._initialState=state,this._cndFn=cndFn,this._itrFn=itrFn,this._resFn=resFn,this._s=s,__super__.call(this)}function scheduleRecursive(state,recurse){if(state.first)state.first=!1;else if(state.newState=tryCatch(state.self._itrFn)(state.newState),state.newState===errorObj)return state.o.onError(state.newState.e);var hasResult=tryCatch(state.self._cndFn)(state.newState);if(hasResult===errorObj)return state.o.onError(hasResult.e);if(hasResult){var result=tryCatch(state.self._resFn)(state.newState);if(result===errorObj)return state.o.onError(result.e);state.o.onNext(result),recurse(state)}else state.o.onCompleted()}return inherits(GenerateObservable,__super__),GenerateObservable.prototype.subscribeCore=function(o){var state={o:o,self:this,first:!0,newState:this._initialState};return this._s.scheduleRecursive(state,scheduleRecursive)},GenerateObservable}(ObservableBase);Observable.generate=function(initialState,condition,iterate,resultSelector,scheduler){return isScheduler(scheduler)||(scheduler=currentThreadScheduler),new GenerateObservable(initialState,condition,iterate,resultSelector,scheduler)},Observable.of=function(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return new FromArrayObservable(args,currentThreadScheduler)},Observable.ofWithScheduler=function(scheduler){for(var len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];return new FromArrayObservable(args,scheduler)},Observable.ofArrayChanges=function(array){if(!Array.isArray(array))throw new TypeError("Array.observe only accepts arrays.");if("function"!=typeof Array.observe&&"function"!=typeof Array.unobserve)throw new TypeError("Array.observe is not supported on your platform");return new AnonymousObservable(function(observer){function observerFn(changes){for(var i=0,len=changes.length;i<len;i++)observer.onNext(changes[i])}return Array.observe(array,observerFn),function(){Array.unobserve(array,observerFn)}})},Observable.ofObjectChanges=function(obj){if(null==obj)throw new TypeError("object must not be null or undefined.");if("function"!=typeof Object.observe&&"function"!=typeof Object.unobserve)throw new TypeError("Object.observe is not supported on your platform");return new AnonymousObservable(function(observer){function observerFn(changes){for(var i=0,len=changes.length;i<len;i++)observer.onNext(changes[i])}return Object.observe(obj,observerFn),function(){Object.unobserve(obj,observerFn)}})};var NeverObservable=function(__super__){function NeverObservable(){__super__.call(this)}return inherits(NeverObservable,__super__),NeverObservable.prototype.subscribeCore=function(observer){return disposableEmpty},NeverObservable}(ObservableBase),NEVER_OBSERVABLE=new NeverObservable,observableNever=Observable.never=function(){return NEVER_OBSERVABLE},PairsObservable=function(__super__){function PairsObservable(o,scheduler){this._o=o,this._keys=Object.keys(o),this._scheduler=scheduler,__super__.call(this)}function scheduleMethod(o,obj,keys){return function(i,recurse){if(i<keys.length){var key=keys[i];o.onNext([key,obj[key]]),recurse(i+1)}else o.onCompleted()}}return inherits(PairsObservable,__super__),PairsObservable.prototype.subscribeCore=function(o){return this._scheduler.scheduleRecursive(0,scheduleMethod(o,this._o,this._keys))},PairsObservable}(ObservableBase);Observable.pairs=function(obj,scheduler){return scheduler||(scheduler=currentThreadScheduler),new PairsObservable(obj,scheduler)};var RangeObservable=function(__super__){function RangeObservable(start,count,scheduler){this.start=start,this.rangeCount=count,this.scheduler=scheduler,__super__.call(this)}function loopRecursive(start,count,o){return function(i,recurse){i<count?(o.onNext(start+i),recurse(i+1)):o.onCompleted()}}return inherits(RangeObservable,__super__),RangeObservable.prototype.subscribeCore=function(o){return this.scheduler.scheduleRecursive(0,loopRecursive(this.start,this.rangeCount,o))},RangeObservable}(ObservableBase);Observable.range=function(start,count,scheduler){return isScheduler(scheduler)||(scheduler=currentThreadScheduler),new RangeObservable(start,count,scheduler)};var RepeatObservable=function(__super__){function RepeatObservable(value,repeatCount,scheduler){this.value=value,this.repeatCount=null==repeatCount?-1:repeatCount,this.scheduler=scheduler,__super__.call(this)}return inherits(RepeatObservable,__super__),RepeatObservable.prototype.subscribeCore=function(observer){return new RepeatSink(observer,this).run()},RepeatObservable}(ObservableBase);RepeatSink.prototype.run=function(){function loopRecursive(i,recurse){if((-1===i||i>0)&&(observer.onNext(value),i>0&&i--),0===i)return observer.onCompleted();recurse(i)}var observer=this.observer,value=this.parent.value;return this.parent.scheduler.scheduleRecursive(this.parent.repeatCount,loopRecursive)},Observable.repeat=function(value,repeatCount,scheduler){return isScheduler(scheduler)||(scheduler=currentThreadScheduler),new RepeatObservable(value,repeatCount,scheduler)};var JustObservable=function(__super__){function JustObservable(value,scheduler){this._value=value,this._scheduler=scheduler,__super__.call(this)}function scheduleItem(s,state){var value=state[0],observer=state[1];return observer.onNext(value),observer.onCompleted(),disposableEmpty}return inherits(JustObservable,__super__),JustObservable.prototype.subscribeCore=function(o){var state=[this._value,o];return this._scheduler===immediateScheduler?scheduleItem(null,state):this._scheduler.schedule(state,scheduleItem)},JustObservable}(ObservableBase),ThrowObservable=(Observable.return=Observable.just=function(value,scheduler){return isScheduler(scheduler)||(scheduler=immediateScheduler),new JustObservable(value,scheduler)},function(__super__){function ThrowObservable(error,scheduler){this._error=error,this._scheduler=scheduler,__super__.call(this)}function scheduleItem(s,state){var e=state[0];return state[1].onError(e),disposableEmpty}return inherits(ThrowObservable,__super__),ThrowObservable.prototype.subscribeCore=function(o){var state=[this._error,o];return this._scheduler===immediateScheduler?scheduleItem(null,state):this._scheduler.schedule(state,scheduleItem)},ThrowObservable}(ObservableBase)),observableThrow=Observable.throw=function(error,scheduler){return isScheduler(scheduler)||(scheduler=immediateScheduler),new ThrowObservable(error,scheduler)},UsingObservable=function(__super__){function UsingObservable(resFn,obsFn){this._resFn=resFn,this._obsFn=obsFn,__super__.call(this)}return inherits(UsingObservable,__super__),UsingObservable.prototype.subscribeCore=function(o){var disposable=disposableEmpty,resource=tryCatch(this._resFn)();if(resource===errorObj)return new BinaryDisposable(observableThrow(resource.e).subscribe(o),disposable);resource&&(disposable=resource);var source=tryCatch(this._obsFn)(resource);return source===errorObj?new BinaryDisposable(observableThrow(source.e).subscribe(o),disposable):new BinaryDisposable(source.subscribe(o),disposable)},UsingObservable}(ObservableBase);Observable.using=function(resourceFactory,observableFactory){return new UsingObservable(resourceFactory,observableFactory)},observableProto.amb=function(rightSource){var leftSource=this;return new AnonymousObservable(function(observer){function choiceL(){choice||(choice=leftChoice,rightSubscription.dispose())}function choiceR(){choice||(choice=rightChoice,leftSubscription.dispose())}var choice,leftChoice="L",rightChoice="R",leftSubscription=new SingleAssignmentDisposable,rightSubscription=new SingleAssignmentDisposable;isPromise(rightSource)&&(rightSource=observableFromPromise(rightSource));var leftSubscribe=observerCreate(function(left){choiceL(),choice===leftChoice&&observer.onNext(left)},function(e){choiceL(),choice===leftChoice&&observer.onError(e)},function(){choiceL(),choice===leftChoice&&observer.onCompleted()}),rightSubscribe=observerCreate(function(right){choiceR(),choice===rightChoice&&observer.onNext(right)},function(e){choiceR(),choice===rightChoice&&observer.onError(e)},function(){choiceR(),choice===rightChoice&&observer.onCompleted()});return leftSubscription.setDisposable(leftSource.subscribe(leftSubscribe)),rightSubscription.setDisposable(rightSource.subscribe(rightSubscribe)),new BinaryDisposable(leftSubscription,rightSubscription)})},Observable.amb=function(){var items,acc=observableNever();if(Array.isArray(arguments[0]))items=arguments[0];else{var len=arguments.length;items=new Array(items);for(var i=0;i<len;i++)items[i]=arguments[i]}for(var i=0,len=items.length;i<len;i++)acc=amb(acc,items[i]);return acc};var CatchObservable=function(__super__){function CatchObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(CatchObservable,__super__),CatchObservable.prototype.subscribeCore=function(o){var d1=new SingleAssignmentDisposable,subscription=new SerialDisposable;return subscription.setDisposable(d1),d1.setDisposable(this.source.subscribe(new CatchObserver(o,subscription,this._fn))),subscription},CatchObservable}(ObservableBase),CatchObserver=function(__super__){function CatchObserver(o,s,fn){this._o=o,this._s=s,this._fn=fn,__super__.call(this)}return inherits(CatchObserver,__super__),CatchObserver.prototype.next=function(x){this._o.onNext(x)},CatchObserver.prototype.completed=function(){return this._o.onCompleted()},CatchObserver.prototype.error=function(e){var result=tryCatch(this._fn)(e);if(result===errorObj)return this._o.onError(result.e);isPromise(result)&&(result=observableFromPromise(result));var d=new SingleAssignmentDisposable;this._s.setDisposable(d),d.setDisposable(result.subscribe(this._o))},CatchObserver}(AbstractObserver);observableProto.catch=function(handlerOrSecond){return isFunction(handlerOrSecond)?new CatchObservable(this,handlerOrSecond):observableCatch([this,handlerOrSecond])};var observableCatch=Observable.catch=function(){var items;if(Array.isArray(arguments[0]))items=arguments[0];else{var len=arguments.length;items=new Array(len);for(var i=0;i<len;i++)items[i]=arguments[i]}return enumerableOf(items).catchError()};observableProto.combineLatest=function(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return Array.isArray(args[0])?args[0].unshift(this):args.unshift(this),combineLatest.apply(this,args)};var CombineLatestObservable=function(__super__){function CombineLatestObservable(params,cb){this._params=params,this._cb=cb,__super__.call(this)}return inherits(CombineLatestObservable,__super__),CombineLatestObservable.prototype.subscribeCore=function(observer){for(var len=this._params.length,subscriptions=new Array(len),state={hasValue:arrayInitialize(len,falseFactory),hasValueAll:!1,isDone:arrayInitialize(len,falseFactory),values:new Array(len)},i=0;i<len;i++){var source=this._params[i],sad=new SingleAssignmentDisposable;subscriptions[i]=sad,isPromise(source)&&(source=observableFromPromise(source)),sad.setDisposable(source.subscribe(new CombineLatestObserver(observer,i,this._cb,state)))}return new NAryDisposable(subscriptions)},CombineLatestObservable}(ObservableBase),CombineLatestObserver=function(__super__){function CombineLatestObserver(o,i,cb,state){this._o=o,this._i=i,this._cb=cb,this._state=state,__super__.call(this)}function notTheSame(i){return function(x,j){return j!==i}}return inherits(CombineLatestObserver,__super__),CombineLatestObserver.prototype.next=function(x){if(this._state.values[this._i]=x,this._state.hasValue[this._i]=!0,this._state.hasValueAll||(this._state.hasValueAll=this._state.hasValue.every(identity))){var res=tryCatch(this._cb).apply(null,this._state.values);if(res===errorObj)return this._o.onError(res.e);this._o.onNext(res)}else this._state.isDone.filter(notTheSame(this._i)).every(identity)&&this._o.onCompleted()},CombineLatestObserver.prototype.error=function(e){this._o.onError(e)},CombineLatestObserver.prototype.completed=function(){this._state.isDone[this._i]=!0,this._state.isDone.every(identity)&&this._o.onCompleted()},CombineLatestObserver}(AbstractObserver),combineLatest=Observable.combineLatest=function(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;return Array.isArray(args[0])&&(args=args[0]),new CombineLatestObservable(args,resultSelector)};observableProto.concat=function(){for(var args=[],i=0,len=arguments.length;i<len;i++)args.push(arguments[i]);return args.unshift(this),observableConcat.apply(null,args)};var ConcatObserver=function(__super__){function ConcatObserver(s,fn){this._s=s,this._fn=fn,__super__.call(this)}return inherits(ConcatObserver,__super__),ConcatObserver.prototype.next=function(x){this._s.o.onNext(x)},ConcatObserver.prototype.error=function(e){this._s.o.onError(e)},ConcatObserver.prototype.completed=function(){this._s.i++,this._fn(this._s)},ConcatObserver}(AbstractObserver),ConcatObservable=function(__super__){function ConcatObservable(sources){this._sources=sources,__super__.call(this)}function scheduleRecursive(state,recurse){if(!state.disposable.isDisposed){if(state.i===state.sources.length)return state.o.onCompleted();var currentValue=state.sources[state.i];isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;state.subscription.setDisposable(d),d.setDisposable(currentValue.subscribe(new ConcatObserver(state,recurse)))}}return inherits(ConcatObservable,__super__),ConcatObservable.prototype.subscribeCore=function(o){var subscription=new SerialDisposable,disposable=disposableCreate(noop),state={o:o,i:0,subscription:subscription,disposable:disposable,sources:this._sources},cancelable=immediateScheduler.scheduleRecursive(state,scheduleRecursive);return new NAryDisposable([subscription,disposable,cancelable])},ConcatObservable}(ObservableBase),observableConcat=Observable.concat=function(){var args;if(Array.isArray(arguments[0]))args=arguments[0];else{args=new Array(arguments.length);for(var i=0,len=arguments.length;i<len;i++)args[i]=arguments[i]}return new ConcatObservable(args)};observableProto.concatAll=function(){return this.merge(1)};var MergeObservable=function(__super__){function MergeObservable(source,maxConcurrent){this.source=source,this.maxConcurrent=maxConcurrent,__super__.call(this)}return inherits(MergeObservable,__super__),MergeObservable.prototype.subscribeCore=function(observer){var g=new CompositeDisposable;return g.add(this.source.subscribe(new MergeObserver(observer,this.maxConcurrent,g))),g},MergeObservable}(ObservableBase),MergeObserver=function(__super__){function MergeObserver(o,max,g){this.o=o,this.max=max,this.g=g,this.done=!1,this.q=[],this.activeCount=0,__super__.call(this)}function InnerObserver(parent,sad){this.parent=parent,this.sad=sad,__super__.call(this)}return inherits(MergeObserver,__super__),MergeObserver.prototype.handleSubscribe=function(xs){var sad=new SingleAssignmentDisposable;this.g.add(sad),isPromise(xs)&&(xs=observableFromPromise(xs)),sad.setDisposable(xs.subscribe(new InnerObserver(this,sad)))},MergeObserver.prototype.next=function(innerSource){this.activeCount<this.max?(this.activeCount++,this.handleSubscribe(innerSource)):this.q.push(innerSource)},MergeObserver.prototype.error=function(e){this.o.onError(e)},MergeObserver.prototype.completed=function(){this.done=!0,0===this.activeCount&&this.o.onCompleted()},inherits(InnerObserver,__super__),InnerObserver.prototype.next=function(x){this.parent.o.onNext(x)},InnerObserver.prototype.error=function(e){this.parent.o.onError(e)},InnerObserver.prototype.completed=function(){this.parent.g.remove(this.sad),this.parent.q.length>0?this.parent.handleSubscribe(this.parent.q.shift()):(this.parent.activeCount--,this.parent.done&&0===this.parent.activeCount&&this.parent.o.onCompleted())},MergeObserver}(AbstractObserver);observableProto.merge=function(maxConcurrentOrOther){return"number"!=typeof maxConcurrentOrOther?observableMerge(this,maxConcurrentOrOther):new MergeObservable(this,maxConcurrentOrOther)};var observableMerge=Observable.merge=function(){var scheduler,i,sources=[],len=arguments.length;if(arguments[0])if(isScheduler(arguments[0]))for(scheduler=arguments[0],i=1;i<len;i++)sources.push(arguments[i]);else for(scheduler=immediateScheduler,i=0;i<len;i++)sources.push(arguments[i]);else for(scheduler=immediateScheduler,i=1;i<len;i++)sources.push(arguments[i]);return Array.isArray(sources[0])&&(sources=sources[0]),observableOf(scheduler,sources).mergeAll()},MergeAllObservable=function(__super__){function MergeAllObservable(source){this.source=source,__super__.call(this)}return inherits(MergeAllObservable,__super__),MergeAllObservable.prototype.subscribeCore=function(o){var g=new CompositeDisposable,m=new SingleAssignmentDisposable;return g.add(m),m.setDisposable(this.source.subscribe(new MergeAllObserver(o,g))),g},MergeAllObservable}(ObservableBase),MergeAllObserver=function(__super__){function MergeAllObserver(o,g){this.o=o,this.g=g,this.done=!1,__super__.call(this)}function InnerObserver(parent,sad){this.parent=parent,this.sad=sad,__super__.call(this)}return inherits(MergeAllObserver,__super__),MergeAllObserver.prototype.next=function(innerSource){var sad=new SingleAssignmentDisposable;this.g.add(sad),isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource)),sad.setDisposable(innerSource.subscribe(new InnerObserver(this,sad)))},MergeAllObserver.prototype.error=function(e){this.o.onError(e)},MergeAllObserver.prototype.completed=function(){this.done=!0,1===this.g.length&&this.o.onCompleted()},inherits(InnerObserver,__super__),InnerObserver.prototype.next=function(x){this.parent.o.onNext(x)},InnerObserver.prototype.error=function(e){this.parent.o.onError(e)},InnerObserver.prototype.completed=function(){this.parent.g.remove(this.sad),this.parent.done&&1===this.parent.g.length&&this.parent.o.onCompleted()},MergeAllObserver}(AbstractObserver);observableProto.mergeAll=function(){return new MergeAllObservable(this)};var CompositeError=Rx.CompositeError=function(errors){this.innerErrors=errors,this.message="This contains multiple errors. Check the innerErrors",Error.call(this)};CompositeError.prototype=Object.create(Error.prototype),CompositeError.prototype.name="CompositeError";var MergeDelayErrorObservable=function(__super__){function MergeDelayErrorObservable(source){this.source=source,__super__.call(this)}return inherits(MergeDelayErrorObservable,__super__),MergeDelayErrorObservable.prototype.subscribeCore=function(o){var group=new CompositeDisposable,m=new SingleAssignmentDisposable,state={isStopped:!1,errors:[],o:o};return group.add(m),m.setDisposable(this.source.subscribe(new MergeDelayErrorObserver(group,state))),group},MergeDelayErrorObservable}(ObservableBase),MergeDelayErrorObserver=function(__super__){function MergeDelayErrorObserver(group,state){this._group=group,this._state=state,__super__.call(this)}function setCompletion(o,errors){0===errors.length?o.onCompleted():1===errors.length?o.onError(errors[0]):o.onError(new CompositeError(errors))}function InnerObserver(inner,group,state){this._inner=inner,this._group=group,this._state=state,__super__.call(this)}return inherits(MergeDelayErrorObserver,__super__),MergeDelayErrorObserver.prototype.next=function(x){var inner=new SingleAssignmentDisposable;this._group.add(inner),isPromise(x)&&(x=observableFromPromise(x)),inner.setDisposable(x.subscribe(new InnerObserver(inner,this._group,this._state)))},MergeDelayErrorObserver.prototype.error=function(e){this._state.errors.push(e),this._state.isStopped=!0,1===this._group.length&&setCompletion(this._state.o,this._state.errors)},MergeDelayErrorObserver.prototype.completed=function(){this._state.isStopped=!0,1===this._group.length&&setCompletion(this._state.o,this._state.errors)},inherits(InnerObserver,__super__),InnerObserver.prototype.next=function(x){this._state.o.onNext(x)},InnerObserver.prototype.error=function(e){this._state.errors.push(e),this._group.remove(this._inner),this._state.isStopped&&1===this._group.length&&setCompletion(this._state.o,this._state.errors)},InnerObserver.prototype.completed=function(){this._group.remove(this._inner),this._state.isStopped&&1===this._group.length&&setCompletion(this._state.o,this._state.errors)},MergeDelayErrorObserver}(AbstractObserver);Observable.mergeDelayError=function(){var args;if(Array.isArray(arguments[0]))args=arguments[0];else{var len=arguments.length;args=new Array(len);for(var i=0;i<len;i++)args[i]=arguments[i]}var source=observableOf(null,args);return new MergeDelayErrorObservable(source)},observableProto.onErrorResumeNext=function(second){if(!second)throw new Error("Second observable is required");return onErrorResumeNext([this,second])};var OnErrorResumeNextObservable=function(__super__){function OnErrorResumeNextObservable(sources){this.sources=sources,__super__.call(this)}function scheduleMethod(state,recurse){if(state.pos<state.sources.length){var current=state.sources[state.pos++];isPromise(current)&&(current=observableFromPromise(current));var d=new SingleAssignmentDisposable;state.subscription.setDisposable(d),d.setDisposable(current.subscribe(new OnErrorResumeNextObserver(state,recurse)))}else state.o.onCompleted()}return inherits(OnErrorResumeNextObservable,__super__),OnErrorResumeNextObservable.prototype.subscribeCore=function(o){var subscription=new SerialDisposable,state={pos:0,subscription:subscription,o:o,sources:this.sources},cancellable=immediateScheduler.scheduleRecursive(state,scheduleMethod);return new BinaryDisposable(subscription,cancellable)},OnErrorResumeNextObservable}(ObservableBase),OnErrorResumeNextObserver=function(__super__){function OnErrorResumeNextObserver(state,recurse){this._state=state,this._recurse=recurse,__super__.call(this)}return inherits(OnErrorResumeNextObserver,__super__),OnErrorResumeNextObserver.prototype.next=function(x){this._state.o.onNext(x)},OnErrorResumeNextObserver.prototype.error=function(){this._recurse(this._state)},OnErrorResumeNextObserver.prototype.completed=function(){this._recurse(this._state)},OnErrorResumeNextObserver}(AbstractObserver),onErrorResumeNext=Observable.onErrorResumeNext=function(){var sources=[];if(Array.isArray(arguments[0]))sources=arguments[0];else{var len=arguments.length;sources=new Array(len);for(var i=0;i<len;i++)sources[i]=arguments[i]}return new OnErrorResumeNextObservable(sources)},SkipUntilObservable=function(__super__){function SkipUntilObservable(source,other){this._s=source,this._o=isPromise(other)?observableFromPromise(other):other,this._open=!1,__super__.call(this)}return inherits(SkipUntilObservable,__super__),SkipUntilObservable.prototype.subscribeCore=function(o){var leftSubscription=new SingleAssignmentDisposable;leftSubscription.setDisposable(this._s.subscribe(new SkipUntilSourceObserver(o,this))),isPromise(this._o)&&(this._o=observableFromPromise(this._o));var rightSubscription=new SingleAssignmentDisposable;return rightSubscription.setDisposable(this._o.subscribe(new SkipUntilOtherObserver(o,this,rightSubscription))),new BinaryDisposable(leftSubscription,rightSubscription)},SkipUntilObservable}(ObservableBase),SkipUntilSourceObserver=function(__super__){function SkipUntilSourceObserver(o,p){this._o=o,this._p=p,__super__.call(this)}return inherits(SkipUntilSourceObserver,__super__),SkipUntilSourceObserver.prototype.next=function(x){this._p._open&&this._o.onNext(x)},SkipUntilSourceObserver.prototype.error=function(err){this._o.onError(err)},SkipUntilSourceObserver.prototype.onCompleted=function(){this._p._open&&this._o.onCompleted()},SkipUntilSourceObserver}(AbstractObserver),SkipUntilOtherObserver=function(__super__){function SkipUntilOtherObserver(o,p,r){this._o=o,this._p=p,this._r=r,__super__.call(this)}return inherits(SkipUntilOtherObserver,__super__),SkipUntilOtherObserver.prototype.next=function(){this._p._open=!0,this._r.dispose()},SkipUntilOtherObserver.prototype.error=function(err){this._o.onError(err)},SkipUntilOtherObserver.prototype.onCompleted=function(){this._r.dispose()},SkipUntilOtherObserver}(AbstractObserver);observableProto.skipUntil=function(other){return new SkipUntilObservable(this,other)};var SwitchObservable=function(__super__){function SwitchObservable(source){this.source=source,__super__.call(this)}function SwitchObserver(o,inner){this.o=o,this.inner=inner,this.stopped=!1,this.latest=0,this.hasLatest=!1,AbstractObserver.call(this)}function InnerObserver(parent,id){this.parent=parent,this.id=id,AbstractObserver.call(this)}return inherits(SwitchObservable,__super__),SwitchObservable.prototype.subscribeCore=function(o){var inner=new SerialDisposable,s=this.source.subscribe(new SwitchObserver(o,inner));return new BinaryDisposable(s,inner)},inherits(SwitchObserver,AbstractObserver),SwitchObserver.prototype.next=function(innerSource){var d=new SingleAssignmentDisposable,id=++this.latest;this.hasLatest=!0,this.inner.setDisposable(d),isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource)),d.setDisposable(innerSource.subscribe(new InnerObserver(this,id)))},SwitchObserver.prototype.error=function(e){this.o.onError(e)},SwitchObserver.prototype.completed=function(){this.stopped=!0,!this.hasLatest&&this.o.onCompleted()},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype.next=function(x){this.parent.latest===this.id&&this.parent.o.onNext(x)},InnerObserver.prototype.error=function(e){this.parent.latest===this.id&&this.parent.o.onError(e)},InnerObserver.prototype.completed=function(){this.parent.latest===this.id&&(this.parent.hasLatest=!1,this.parent.stopped&&this.parent.o.onCompleted())},SwitchObservable}(ObservableBase);observableProto.switch=observableProto.switchLatest=function(){return new SwitchObservable(this)};var TakeUntilObservable=function(__super__){function TakeUntilObservable(source,other){this.source=source,this.other=isPromise(other)?observableFromPromise(other):other,__super__.call(this)}return inherits(TakeUntilObservable,__super__),TakeUntilObservable.prototype.subscribeCore=function(o){return new BinaryDisposable(this.source.subscribe(o),this.other.subscribe(new TakeUntilObserver(o)))},TakeUntilObservable}(ObservableBase),TakeUntilObserver=function(__super__){function TakeUntilObserver(o){this._o=o,__super__.call(this)}return inherits(TakeUntilObserver,__super__),TakeUntilObserver.prototype.next=function(){this._o.onCompleted()},TakeUntilObserver.prototype.error=function(err){this._o.onError(err)},TakeUntilObserver.prototype.onCompleted=noop,TakeUntilObserver}(AbstractObserver);observableProto.takeUntil=function(other){return new TakeUntilObservable(this,other)};var WithLatestFromObservable=function(__super__){function WithLatestFromObservable(source,sources,resultSelector){this._s=source,this._ss=sources,this._cb=resultSelector,__super__.call(this)}return inherits(WithLatestFromObservable,__super__),WithLatestFromObservable.prototype.subscribeCore=function(o){for(var len=this._ss.length,state={hasValue:arrayInitialize(len,falseFactory),hasValueAll:!1,values:new Array(len)},n=this._ss.length,subscriptions=new Array(n+1),i=0;i<n;i++){var other=this._ss[i],sad=new SingleAssignmentDisposable;isPromise(other)&&(other=observableFromPromise(other)),sad.setDisposable(other.subscribe(new WithLatestFromOtherObserver(o,i,state))),subscriptions[i]=sad}var outerSad=new SingleAssignmentDisposable;return outerSad.setDisposable(this._s.subscribe(new WithLatestFromSourceObserver(o,this._cb,state))),subscriptions[n]=outerSad,new NAryDisposable(subscriptions)},WithLatestFromObservable}(ObservableBase),WithLatestFromOtherObserver=function(__super__){function WithLatestFromOtherObserver(o,i,state){this._o=o,this._i=i,this._state=state,__super__.call(this)}return inherits(WithLatestFromOtherObserver,__super__),WithLatestFromOtherObserver.prototype.next=function(x){this._state.values[this._i]=x,this._state.hasValue[this._i]=!0,this._state.hasValueAll=this._state.hasValue.every(identity)},WithLatestFromOtherObserver.prototype.error=function(e){this._o.onError(e)},WithLatestFromOtherObserver.prototype.completed=noop,WithLatestFromOtherObserver}(AbstractObserver),WithLatestFromSourceObserver=function(__super__){function WithLatestFromSourceObserver(o,cb,state){this._o=o,this._cb=cb,this._state=state,__super__.call(this)}return inherits(WithLatestFromSourceObserver,__super__),WithLatestFromSourceObserver.prototype.next=function(x){var allValues=[x].concat(this._state.values);if(this._state.hasValueAll){var res=tryCatch(this._cb).apply(null,allValues);if(res===errorObj)return this._o.onError(res.e);this._o.onNext(res)}},WithLatestFromSourceObserver.prototype.error=function(e){this._o.onError(e)},WithLatestFromSourceObserver.prototype.completed=function(){this._o.onCompleted()},WithLatestFromSourceObserver}(AbstractObserver);observableProto.withLatestFrom=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;return Array.isArray(args[0])&&(args=args[0]),new WithLatestFromObservable(this,args,resultSelector)};var ZipObservable=function(__super__){function ZipObservable(sources,resultSelector){this._s=sources,this._cb=resultSelector,__super__.call(this)}return inherits(ZipObservable,__super__),ZipObservable.prototype.subscribeCore=function(observer){for(var n=this._s.length,subscriptions=new Array(n),done=arrayInitialize(n,falseFactory),q=arrayInitialize(n,emptyArrayFactory),i=0;i<n;i++){var source=this._s[i],sad=new SingleAssignmentDisposable;subscriptions[i]=sad,isPromise(source)&&(source=observableFromPromise(source)),sad.setDisposable(source.subscribe(new ZipObserver(observer,i,this,q,done)))}return new NAryDisposable(subscriptions)},ZipObservable}(ObservableBase),ZipObserver=function(__super__){function ZipObserver(o,i,p,q,d){this._o=o,this._i=i,this._p=p,this._q=q,this._d=d,__super__.call(this)}function notEmpty(x){return x.length>0}function shiftEach(x){return x.shift()}function notTheSame(i){return function(x,j){return j!==i}}return inherits(ZipObserver,__super__),ZipObserver.prototype.next=function(x){if(this._q[this._i].push(x),this._q.every(notEmpty)){var queuedValues=this._q.map(shiftEach),res=tryCatch(this._p._cb).apply(null,queuedValues);if(res===errorObj)return this._o.onError(res.e);this._o.onNext(res)}else this._d.filter(notTheSame(this._i)).every(identity)&&this._o.onCompleted()},ZipObserver.prototype.error=function(e){this._o.onError(e)},ZipObserver.prototype.completed=function(){this._d[this._i]=!0,this._d.every(identity)&&this._o.onCompleted()},ZipObserver}(AbstractObserver);observableProto.zip=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;Array.isArray(args[0])&&(args=args[0]);var parent=this;return args.unshift(parent),new ZipObservable(args,resultSelector)},Observable.zip=function(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];Array.isArray(args[0])&&(args=isFunction(args[1])?args[0].concat(args[1]):args[0]);var first=args.shift();return first.zip.apply(first,args)};var ZipIterableObservable=function(__super__){function ZipIterableObservable(sources,cb){this.sources=sources,this._cb=cb,__super__.call(this)}return inherits(ZipIterableObservable,__super__),ZipIterableObservable.prototype.subscribeCore=function(o){for(var sources=this.sources,len=sources.length,subscriptions=new Array(len),state={q:arrayInitialize(len,emptyArrayFactory),done:arrayInitialize(len,falseFactory),cb:this._cb,o:o},i=0;i<len;i++)!function(i){var source=sources[i],sad=new SingleAssignmentDisposable;(isArrayLike(source)||isIterable(source))&&(source=observableFrom(source)),subscriptions[i]=sad,sad.setDisposable(source.subscribe(new ZipIterableObserver(state,i)))}(i);return new NAryDisposable(subscriptions)},ZipIterableObservable}(ObservableBase),ZipIterableObserver=function(__super__){function ZipIterableObserver(s,i){this._s=s,this._i=i,__super__.call(this)}function notEmpty(x){return x.length>0}function shiftEach(x){return x.shift()}function notTheSame(i){return function(x,j){return j!==i}}return inherits(ZipIterableObserver,__super__),ZipIterableObserver.prototype.next=function(x){if(this._s.q[this._i].push(x),this._s.q.every(notEmpty)){var queuedValues=this._s.q.map(shiftEach),res=tryCatch(this._s.cb).apply(null,queuedValues);if(res===errorObj)return this._s.o.onError(res.e);this._s.o.onNext(res)}else this._s.done.filter(notTheSame(this._i)).every(identity)&&this._s.o.onCompleted()},ZipIterableObserver.prototype.error=function(e){this._s.o.onError(e)},ZipIterableObserver.prototype.completed=function(){this._s.done[this._i]=!0,this._s.done.every(identity)&&this._s.o.onCompleted()},ZipIterableObserver}(AbstractObserver);observableProto.zipIterable=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray,parent=this;return args.unshift(parent),new ZipIterableObservable(args,resultSelector)},observableProto.asObservable=function(){return new AnonymousObservable(asObservable(this),this)},observableProto.bufferWithCount=observableProto.bufferCount=function(count,skip){return"number"!=typeof skip&&(skip=count),this.windowWithCount(count,skip).flatMap(toArray).filter(notEmpty)};var DematerializeObservable=function(__super__){function DematerializeObservable(source){this.source=source,__super__.call(this)}return inherits(DematerializeObservable,__super__),DematerializeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new DematerializeObserver(o))},DematerializeObservable}(ObservableBase),DematerializeObserver=function(__super__){function DematerializeObserver(o){this._o=o,__super__.call(this)}return inherits(DematerializeObserver,__super__),DematerializeObserver.prototype.next=function(x){x.accept(this._o)},DematerializeObserver.prototype.error=function(e){this._o.onError(e)},DematerializeObserver.prototype.completed=function(){this._o.onCompleted()},DematerializeObserver}(AbstractObserver);observableProto.dematerialize=function(){return new DematerializeObservable(this)};var DistinctUntilChangedObservable=function(__super__){function DistinctUntilChangedObservable(source,keyFn,comparer){this.source=source,this.keyFn=keyFn,this.comparer=comparer,__super__.call(this)}return inherits(DistinctUntilChangedObservable,__super__),DistinctUntilChangedObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new DistinctUntilChangedObserver(o,this.keyFn,this.comparer))},DistinctUntilChangedObservable}(ObservableBase),DistinctUntilChangedObserver=function(__super__){function DistinctUntilChangedObserver(o,keyFn,comparer){this.o=o,this.keyFn=keyFn,this.comparer=comparer,this.hasCurrentKey=!1,this.currentKey=null,__super__.call(this)}return inherits(DistinctUntilChangedObserver,__super__),DistinctUntilChangedObserver.prototype.next=function(x){var comparerEquals,key=x;return isFunction(this.keyFn)&&(key=tryCatch(this.keyFn)(x))===errorObj?this.o.onError(key.e):this.hasCurrentKey&&(comparerEquals=tryCatch(this.comparer)(this.currentKey,key))===errorObj?this.o.onError(comparerEquals.e):void(this.hasCurrentKey&&comparerEquals||(this.hasCurrentKey=!0,this.currentKey=key,this.o.onNext(x)))},DistinctUntilChangedObserver.prototype.error=function(e){this.o.onError(e)},DistinctUntilChangedObserver.prototype.completed=function(){this.o.onCompleted()},DistinctUntilChangedObserver}(AbstractObserver);observableProto.distinctUntilChanged=function(keyFn,comparer){return comparer||(comparer=defaultComparer),new DistinctUntilChangedObservable(this,keyFn,comparer)};var TapObservable=function(__super__){function TapObservable(source,observerOrOnNext,onError,onCompleted){this.source=source,this._oN=observerOrOnNext,this._oE=onError,this._oC=onCompleted,__super__.call(this)}function InnerObserver(o,p){this.o=o,this.t=!p._oN||isFunction(p._oN)?observerCreate(p._oN||noop,p._oE||noop,p._oC||noop):p._oN,this.isStopped=!1,AbstractObserver.call(this)}return inherits(TapObservable,__super__),TapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this))},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype.next=function(x){var res=tryCatch(this.t.onNext).call(this.t,x);res===errorObj&&this.o.onError(res.e),this.o.onNext(x)},InnerObserver.prototype.error=function(err){var res=tryCatch(this.t.onError).call(this.t,err);if(res===errorObj)return this.o.onError(res.e);this.o.onError(err)},InnerObserver.prototype.completed=function(){var res=tryCatch(this.t.onCompleted).call(this.t);if(res===errorObj)return this.o.onError(res.e);this.o.onCompleted()},TapObservable}(ObservableBase);observableProto.do=observableProto.tap=observableProto.doAction=function(observerOrOnNext,onError,onCompleted){return new TapObservable(this,observerOrOnNext,onError,onCompleted)},observableProto.doOnNext=observableProto.tapOnNext=function(onNext,thisArg){return this.tap(void 0!==thisArg?function(x){onNext.call(thisArg,x)}:onNext)},observableProto.doOnError=observableProto.tapOnError=function(onError,thisArg){return this.tap(noop,void 0!==thisArg?function(e){onError.call(thisArg,e)}:onError)},observableProto.doOnCompleted=observableProto.tapOnCompleted=function(onCompleted,thisArg){return this.tap(noop,null,void 0!==thisArg?function(){onCompleted.call(thisArg)}:onCompleted)};var FinallyObservable=function(__super__){function FinallyObservable(source,fn,thisArg){this.source=source,this._fn=bindCallback(fn,thisArg,0),__super__.call(this)}function FinallyDisposable(s,fn){this.isDisposed=!1,this._s=s,this._fn=fn}return inherits(FinallyObservable,__super__),FinallyObservable.prototype.subscribeCore=function(o){var d=tryCatch(this.source.subscribe).call(this.source,o);return d===errorObj&&(this._fn(),thrower(d.e)),new FinallyDisposable(d,this._fn)},FinallyDisposable.prototype.dispose=function(){if(!this.isDisposed){var res=tryCatch(this._s.dispose).call(this._s);this._fn(),res===errorObj&&thrower(res.e)}},FinallyObservable}(ObservableBase);observableProto.finally=function(action,thisArg){return new FinallyObservable(this,action,thisArg)};var IgnoreElementsObservable=function(__super__){function IgnoreElementsObservable(source){this.source=source,__super__.call(this)}function InnerObserver(o){this.o=o,this.isStopped=!1}return inherits(IgnoreElementsObservable,__super__),IgnoreElementsObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o))},InnerObserver.prototype.onNext=noop,InnerObserver.prototype.onError=function(err){this.isStopped||(this.isStopped=!0,this.o.onError(err))},InnerObserver.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},InnerObserver.prototype.dispose=function(){this.isStopped=!0},InnerObserver.prototype.fail=function(e){return!this.isStopped&&(this.isStopped=!0,this.observer.onError(e),!0)},IgnoreElementsObservable}(ObservableBase);observableProto.ignoreElements=function(){return new IgnoreElementsObservable(this)};var MaterializeObservable=function(__super__){function MaterializeObservable(source,fn){this.source=source,__super__.call(this)}return inherits(MaterializeObservable,__super__),MaterializeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new MaterializeObserver(o))},MaterializeObservable}(ObservableBase),MaterializeObserver=function(__super__){function MaterializeObserver(o){this._o=o,__super__.call(this)}return inherits(MaterializeObserver,__super__),MaterializeObserver.prototype.next=function(x){this._o.onNext(notificationCreateOnNext(x))},MaterializeObserver.prototype.error=function(e){this._o.onNext(notificationCreateOnError(e)),this._o.onCompleted()},MaterializeObserver.prototype.completed=function(){this._o.onNext(notificationCreateOnCompleted()),this._o.onCompleted()},MaterializeObserver}(AbstractObserver);observableProto.materialize=function(){return new MaterializeObservable(this)},observableProto.repeat=function(repeatCount){return enumerableRepeat(this,repeatCount).concat()},observableProto.retry=function(retryCount){return enumerableRepeat(this,retryCount).catchError()};var RetryWhenObservable=function(__super__){function createDisposable(state){return{isDisposed:!1,dispose:function(){this.isDisposed||(this.isDisposed=!0,state.isDisposed=!0)}}}function RetryWhenObservable(source,notifier){this.source=source,this._notifier=notifier,__super__.call(this)}return inherits(RetryWhenObservable,__super__),RetryWhenObservable.prototype.subscribeCore=function(o){var exceptions=new Subject,notifier=new Subject,handled=this._notifier(exceptions),notificationDisposable=handled.subscribe(notifier),e=this.source["@@iterator"](),state={isDisposed:!1},subscription=new SerialDisposable,cancelable=currentThreadScheduler.scheduleRecursive(null,function(_,recurse){if(!state.isDisposed){var currentItem=e.next();if(currentItem.done)return void o.onCompleted();var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var outer=new SingleAssignmentDisposable,inner=new SingleAssignmentDisposable;subscription.setDisposable(new BinaryDisposable(inner,outer)),outer.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(exn){inner.setDisposable(notifier.subscribe(recurse,function(ex){o.onError(ex)},function(){o.onCompleted()})),exceptions.onNext(exn),outer.dispose()},function(){o.onCompleted()}))}});return new NAryDisposable([notificationDisposable,subscription,cancelable,createDisposable(state)])},RetryWhenObservable}(ObservableBase);observableProto.retryWhen=function(notifier){return new RetryWhenObservable(repeat(this),notifier)};var RepeatWhenObservable=function(__super__){function createDisposable(state){return{isDisposed:!1,dispose:function(){this.isDisposed||(this.isDisposed=!0,state.isDisposed=!0)}}}function RepeatWhenObservable(source,notifier){this.source=source,this._notifier=notifier,__super__.call(this)}return inherits(RepeatWhenObservable,__super__),RepeatWhenObservable.prototype.subscribeCore=function(o){var completions=new Subject,notifier=new Subject,handled=this._notifier(completions),notificationDisposable=handled.subscribe(notifier),e=this.source["@@iterator"](),state={isDisposed:!1},subscription=new SerialDisposable,cancelable=currentThreadScheduler.scheduleRecursive(null,function(_,recurse){if(!state.isDisposed){var currentItem=e.next();if(currentItem.done)return void o.onCompleted();var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var outer=new SingleAssignmentDisposable,inner=new SingleAssignmentDisposable;subscription.setDisposable(new BinaryDisposable(inner,outer)),outer.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(exn){o.onError(exn)},function(){inner.setDisposable(notifier.subscribe(recurse,function(ex){o.onError(ex)},function(){o.onCompleted()})),completions.onNext(null),outer.dispose()}))}});return new NAryDisposable([notificationDisposable,subscription,cancelable,createDisposable(state)])},RepeatWhenObservable}(ObservableBase);observableProto.repeatWhen=function(notifier){return new RepeatWhenObservable(repeat(this),notifier)};var ScanObservable=function(__super__){function ScanObservable(source,accumulator,hasSeed,seed){this.source=source,this.accumulator=accumulator,this.hasSeed=hasSeed,this.seed=seed,__super__.call(this)}return inherits(ScanObservable,__super__),ScanObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new ScanObserver(o,this))},ScanObservable}(ObservableBase),ScanObserver=function(__super__){function ScanObserver(o,parent){this._o=o,this._p=parent,this._fn=parent.accumulator,this._hs=parent.hasSeed,this._s=parent.seed,this._ha=!1,this._a=null,this._hv=!1,this._i=0,__super__.call(this)}return inherits(ScanObserver,__super__),ScanObserver.prototype.next=function(x){if(!this._hv&&(this._hv=!0),this._ha?this._a=tryCatch(this._fn)(this._a,x,this._i,this._p):(this._a=this._hs?tryCatch(this._fn)(this._s,x,this._i,this._p):x,this._ha=!0),this._a===errorObj)return this._o.onError(this._a.e);this._o.onNext(this._a),this._i++},ScanObserver.prototype.error=function(e){this._o.onError(e)},ScanObserver.prototype.completed=function(){!this._hv&&this._hs&&this._o.onNext(this._s),this._o.onCompleted()},ScanObserver}(AbstractObserver);observableProto.scan=function(){var seed,hasSeed=!1,accumulator=arguments[0];return 2===arguments.length&&(hasSeed=!0,seed=arguments[1]),new ScanObservable(this,accumulator,hasSeed,seed)};var SkipLastObservable=function(__super__){function SkipLastObservable(source,c){this.source=source,this._c=c,__super__.call(this)}return inherits(SkipLastObservable,__super__),SkipLastObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SkipLastObserver(o,this._c))},SkipLastObservable}(ObservableBase),SkipLastObserver=function(__super__){function SkipLastObserver(o,c){this._o=o,this._c=c,this._q=[],__super__.call(this)}return inherits(SkipLastObserver,__super__),SkipLastObserver.prototype.next=function(x){this._q.push(x),this._q.length>this._c&&this._o.onNext(this._q.shift())},SkipLastObserver.prototype.error=function(e){this._o.onError(e)},SkipLastObserver.prototype.completed=function(){this._o.onCompleted()},SkipLastObserver}(AbstractObserver);observableProto.skipLast=function(count){if(count<0)throw new ArgumentOutOfRangeError;return new SkipLastObservable(this,count)},observableProto.startWith=function(){var scheduler,start=0;arguments.length&&isScheduler(arguments[0])?(scheduler=arguments[0],start=1):scheduler=immediateScheduler;for(var args=[],i=start,len=arguments.length;i<len;i++)args.push(arguments[i]);return observableConcat.apply(null,[observableFromArray(args,scheduler),this])};var TakeLastObserver=function(__super__){function TakeLastObserver(o,c){this._o=o,this._c=c,this._q=[],__super__.call(this)}return inherits(TakeLastObserver,__super__),TakeLastObserver.prototype.next=function(x){this._q.push(x),this._q.length>this._c&&this._q.shift()},TakeLastObserver.prototype.error=function(e){this._o.onError(e)},TakeLastObserver.prototype.completed=function(){for(;this._q.length>0;)this._o.onNext(this._q.shift());this._o.onCompleted()},TakeLastObserver}(AbstractObserver);observableProto.takeLast=function(count){if(count<0)throw new ArgumentOutOfRangeError;var source=this;return new AnonymousObservable(function(o){return source.subscribe(new TakeLastObserver(o,count))},source)};var TakeLastBufferObserver=function(__super__){function TakeLastBufferObserver(o,c){this._o=o,this._c=c,this._q=[],__super__.call(this)}return inherits(TakeLastBufferObserver,__super__),TakeLastBufferObserver.prototype.next=function(x){this._q.push(x),this._q.length>this._c&&this._q.shift()},TakeLastBufferObserver.prototype.error=function(e){this._o.onError(e)},TakeLastBufferObserver.prototype.completed=function(){this._o.onNext(this._q),this._o.onCompleted()},TakeLastBufferObserver}(AbstractObserver);observableProto.takeLastBuffer=function(count){if(count<0)throw new ArgumentOutOfRangeError;var source=this;return new AnonymousObservable(function(o){return source.subscribe(new TakeLastBufferObserver(o,count))},source)},observableProto.windowWithCount=observableProto.windowCount=function(count,skip){var source=this;if(+count||(count=0),Math.abs(count)===1/0&&(count=0),count<=0)throw new ArgumentOutOfRangeError;if(null==skip&&(skip=count),+skip||(skip=0),Math.abs(skip)===1/0&&(skip=0),skip<=0)throw new ArgumentOutOfRangeError;return new AnonymousObservable(function(observer){function createWindow(){var s=new Subject;q.push(s),observer.onNext(addRef(s,refCountDisposable))}var m=new SingleAssignmentDisposable,refCountDisposable=new RefCountDisposable(m),n=0,q=[];return createWindow(),m.setDisposable(source.subscribe(function(x){for(var i=0,len=q.length;i<len;i++)q[i].onNext(x);var c=n-count+1;c>=0&&c%skip==0&&q.shift().onCompleted(),++n%skip==0&&createWindow()},function(e){for(;q.length>0;)q.shift().onError(e);observer.onError(e)},function(){for(;q.length>0;)q.shift().onCompleted();observer.onCompleted()})),refCountDisposable},source)},observableProto.selectConcat=observableProto.concatMap=function(selector,resultSelector,thisArg){return isFunction(selector)&&isFunction(resultSelector)?this.concatMap(function(x,i){var selectorResult=selector(x,i);return isPromise(selectorResult)&&(selectorResult=observableFromPromise(selectorResult)),(isArrayLike(selectorResult)||isIterable(selectorResult))&&(selectorResult=observableFrom(selectorResult)),selectorResult.map(function(y,i2){return resultSelector(x,y,i,i2)})}):isFunction(selector)?concatMap(this,selector,thisArg):concatMap(this,function(){return selector})},observableProto.concatMapObserver=observableProto.selectConcatObserver=function(onNext,onError,onCompleted,thisArg){var source=this,onNextFunc=bindCallback(onNext,thisArg,2),onErrorFunc=bindCallback(onError,thisArg,1),onCompletedFunc=bindCallback(onCompleted,thisArg,0);return new AnonymousObservable(function(observer){var index=0;return source.subscribe(function(x){var result;try{result=onNextFunc(x,index++)}catch(e){return void observer.onError(e)}isPromise(result)&&(result=observableFromPromise(result)),observer.onNext(result)},function(err){var result;try{result=onErrorFunc(err)}catch(e){return void observer.onError(e)}isPromise(result)&&(result=observableFromPromise(result)),observer.onNext(result),observer.onCompleted()},function(){var result;try{result=onCompletedFunc()}catch(e){return void observer.onError(e)}isPromise(result)&&(result=observableFromPromise(result)),observer.onNext(result),observer.onCompleted()})},this).concatAll()};var DefaultIfEmptyObserver=function(__super__){function DefaultIfEmptyObserver(o,d){this._o=o,this._d=d,this._f=!1,__super__.call(this)}return inherits(DefaultIfEmptyObserver,__super__),DefaultIfEmptyObserver.prototype.next=function(x){this._f=!0,this._o.onNext(x)},DefaultIfEmptyObserver.prototype.error=function(e){this._o.onError(e)},DefaultIfEmptyObserver.prototype.completed=function(){!this._f&&this._o.onNext(this._d),this._o.onCompleted()},DefaultIfEmptyObserver}(AbstractObserver);observableProto.defaultIfEmpty=function(defaultValue){var source=this;return defaultValue===undefined&&(defaultValue=null),new AnonymousObservable(function(o){return source.subscribe(new DefaultIfEmptyObserver(o,defaultValue))},source)},HashSet.prototype.push=function(value){var retValue=-1===arrayIndexOfComparer(this.set,value,this.comparer);return retValue&&this.set.push(value),retValue};var DistinctObservable=function(__super__){function DistinctObservable(source,keyFn,cmpFn){this.source=source,this._keyFn=keyFn,this._cmpFn=cmpFn,__super__.call(this)}return inherits(DistinctObservable,__super__),DistinctObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new DistinctObserver(o,this._keyFn,this._cmpFn))},DistinctObservable}(ObservableBase),DistinctObserver=function(__super__){function DistinctObserver(o,keyFn,cmpFn){this._o=o,this._keyFn=keyFn,this._h=new HashSet(cmpFn),__super__.call(this)}return inherits(DistinctObserver,__super__),DistinctObserver.prototype.next=function(x){var key=x;if(isFunction(this._keyFn)&&(key=tryCatch(this._keyFn)(x))===errorObj)return this._o.onError(key.e);this._h.push(key)&&this._o.onNext(x)},DistinctObserver.prototype.error=function(e){this._o.onError(e)},DistinctObserver.prototype.completed=function(){this._o.onCompleted()},DistinctObserver}(AbstractObserver);observableProto.distinct=function(keySelector,comparer){return comparer||(comparer=defaultComparer),new DistinctObservable(this,keySelector,comparer)},observableProto.groupBy=function(keySelector,elementSelector){return this.groupByUntil(keySelector,elementSelector,observableNever)},observableProto.groupByUntil=function(keySelector,elementSelector,durationSelector){var source=this;return new AnonymousObservable(function(o){var map=new Map,groupDisposable=new CompositeDisposable,refCountDisposable=new RefCountDisposable(groupDisposable),handleError=function(e){return function(item){item.onError(e)}};return groupDisposable.add(source.subscribe(function(x){var key=tryCatch(keySelector)(x);if(key===errorObj)return map.forEach(handleError(key.e)),o.onError(key.e);var fireNewMapEntry=!1,writer=map.get(key);if(writer===undefined&&(writer=new Subject,map.set(key,writer),fireNewMapEntry=!0),fireNewMapEntry){var group=new GroupedObservable(key,writer,refCountDisposable),durationGroup=new GroupedObservable(key,writer),duration=tryCatch(durationSelector)(durationGroup);if(duration===errorObj)return map.forEach(handleError(duration.e)),o.onError(duration.e);o.onNext(group);var md=new SingleAssignmentDisposable;groupDisposable.add(md),md.setDisposable(duration.take(1).subscribe(noop,function(e){map.forEach(handleError(e)),o.onError(e)},function(){map.delete(key)&&writer.onCompleted(),groupDisposable.remove(md)}))}var element=x;if(isFunction(elementSelector)&&(element=tryCatch(elementSelector)(x))===errorObj)return map.forEach(handleError(element.e)),o.onError(element.e);writer.onNext(element)},function(e){map.forEach(handleError(e)),o.onError(e)},function(){map.forEach(function(item){item.onCompleted()}),o.onCompleted()})),refCountDisposable},source)};var MapObservable=function(__super__){function MapObservable(source,selector,thisArg){this.source=source,this.selector=bindCallback(selector,thisArg,3),__super__.call(this)}function innerMap(selector,self){return function(x,i,o){return selector.call(this,self.selector(x,i,o),i,o)}}function InnerObserver(o,selector,source){this.o=o,this.selector=selector,this.source=source,this.i=0,AbstractObserver.call(this)}return inherits(MapObservable,__super__),MapObservable.prototype.internalMap=function(selector,thisArg){return new MapObservable(this.source,innerMap(selector,this),thisArg)},MapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.selector,this))},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype.next=function(x){var result=tryCatch(this.selector)(x,this.i++,this.source);if(result===errorObj)return this.o.onError(result.e);this.o.onNext(result)},InnerObserver.prototype.error=function(e){this.o.onError(e)},InnerObserver.prototype.completed=function(){this.o.onCompleted()},MapObservable}(ObservableBase);observableProto.map=observableProto.select=function(selector,thisArg){var selectorFn="function"==typeof selector?selector:function(){return selector};return this instanceof MapObservable?this.internalMap(selectorFn,thisArg):new MapObservable(this,selectorFn,thisArg)},observableProto.pluck=function(){var len=arguments.length,args=new Array(len);if(0===len)throw new Error("List of properties cannot be empty.");for(var i=0;i<len;i++)args[i]=arguments[i];return this.map(plucker(args,len))},observableProto.flatMap=observableProto.selectMany=observableProto.mergeMap=function(selector,resultSelector,thisArg){return new FlatMapObservable(this,selector,resultSelector,thisArg).mergeAll()},observableProto.flatMapObserver=observableProto.selectManyObserver=function(onNext,onError,onCompleted,thisArg){var source=this;return new AnonymousObservable(function(observer){var index=0;return source.subscribe(function(x){var result;try{result=onNext.call(thisArg,x,index++)}catch(e){return void observer.onError(e)}isPromise(result)&&(result=observableFromPromise(result)),observer.onNext(result)},function(err){var result;try{result=onError.call(thisArg,err)}catch(e){return void observer.onError(e)}isPromise(result)&&(result=observableFromPromise(result)),observer.onNext(result),observer.onCompleted()},function(){var result;try{result=onCompleted.call(thisArg)}catch(e){return void observer.onError(e)}isPromise(result)&&(result=observableFromPromise(result)),observer.onNext(result),observer.onCompleted()})},source).mergeAll()},observableProto.flatMapLatest=observableProto.switchMap=function(selector,resultSelector,thisArg){return new FlatMapObservable(this,selector,resultSelector,thisArg).switchLatest()};var SkipObservable=function(__super__){function SkipObservable(source,count){this.source=source,this._count=count,__super__.call(this)}function SkipObserver(o,c){this._o=o,this._r=c,AbstractObserver.call(this)}return inherits(SkipObservable,__super__),SkipObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SkipObserver(o,this._count))},inherits(SkipObserver,AbstractObserver),SkipObserver.prototype.next=function(x){this._r<=0?this._o.onNext(x):this._r--},SkipObserver.prototype.error=function(e){this._o.onError(e)},SkipObserver.prototype.completed=function(){this._o.onCompleted()},SkipObservable}(ObservableBase);observableProto.skip=function(count){if(count<0)throw new ArgumentOutOfRangeError;return new SkipObservable(this,count)};var SkipWhileObservable=function(__super__){function SkipWhileObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(SkipWhileObservable,__super__),SkipWhileObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SkipWhileObserver(o,this))},SkipWhileObservable}(ObservableBase),SkipWhileObserver=function(__super__){function SkipWhileObserver(o,p){this._o=o,this._p=p,this._i=0,this._r=!1,__super__.call(this)}return inherits(SkipWhileObserver,__super__),SkipWhileObserver.prototype.next=function(x){if(!this._r){var res=tryCatch(this._p._fn)(x,this._i++,this._p);if(res===errorObj)return this._o.onError(res.e);this._r=!res}this._r&&this._o.onNext(x)},SkipWhileObserver.prototype.error=function(e){this._o.onError(e)},SkipWhileObserver.prototype.completed=function(){this._o.onCompleted()},SkipWhileObserver}(AbstractObserver);observableProto.skipWhile=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return new SkipWhileObservable(this,fn)};var TakeObservable=function(__super__){function TakeObservable(source,count){this.source=source,this._count=count,__super__.call(this)}function TakeObserver(o,c){this._o=o,this._c=c,this._r=c,AbstractObserver.call(this)}return inherits(TakeObservable,__super__),TakeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TakeObserver(o,this._count))},inherits(TakeObserver,AbstractObserver),TakeObserver.prototype.next=function(x){this._r-->0&&(this._o.onNext(x),this._r<=0&&this._o.onCompleted())},TakeObserver.prototype.error=function(e){this._o.onError(e)},TakeObserver.prototype.completed=function(){this._o.onCompleted()},TakeObservable}(ObservableBase);observableProto.take=function(count,scheduler){if(count<0)throw new ArgumentOutOfRangeError;return 0===count?observableEmpty(scheduler):new TakeObservable(this,count)};var TakeWhileObservable=function(__super__){function TakeWhileObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(TakeWhileObservable,__super__),TakeWhileObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TakeWhileObserver(o,this))},TakeWhileObservable}(ObservableBase),TakeWhileObserver=function(__super__){function TakeWhileObserver(o,p){this._o=o,this._p=p,this._i=0,this._r=!0,__super__.call(this)}return inherits(TakeWhileObserver,__super__),TakeWhileObserver.prototype.next=function(x){if(this._r&&(this._r=tryCatch(this._p._fn)(x,this._i++,this._p),this._r===errorObj))return this._o.onError(this._r.e);this._r?this._o.onNext(x):this._o.onCompleted()},TakeWhileObserver.prototype.error=function(e){this._o.onError(e)},TakeWhileObserver.prototype.completed=function(){this._o.onCompleted()},TakeWhileObserver}(AbstractObserver);observableProto.takeWhile=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return new TakeWhileObservable(this,fn)};var FilterObservable=function(__super__){function FilterObservable(source,predicate,thisArg){this.source=source,this.predicate=bindCallback(predicate,thisArg,3),__super__.call(this)}function innerPredicate(predicate,self){return function(x,i,o){return self.predicate(x,i,o)&&predicate.call(this,x,i,o)}}function InnerObserver(o,predicate,source){this.o=o,this.predicate=predicate,this.source=source,this.i=0,AbstractObserver.call(this)}return inherits(FilterObservable,__super__),FilterObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.predicate,this))},FilterObservable.prototype.internalFilter=function(predicate,thisArg){return new FilterObservable(this.source,innerPredicate(predicate,this),thisArg)},inherits(InnerObserver,AbstractObserver),InnerObserver.prototype.next=function(x){var shouldYield=tryCatch(this.predicate)(x,this.i++,this.source);if(shouldYield===errorObj)return this.o.onError(shouldYield.e);shouldYield&&this.o.onNext(x)},InnerObserver.prototype.error=function(e){this.o.onError(e)},InnerObserver.prototype.completed=function(){this.o.onCompleted()},FilterObservable}(ObservableBase);observableProto.filter=observableProto.where=function(predicate,thisArg){return this instanceof FilterObservable?this.internalFilter(predicate,thisArg):new FilterObservable(this,predicate,thisArg)};var ExtremaByObservable=function(__super__){function ExtremaByObservable(source,k,c){this.source=source,this._k=k,this._c=c,__super__.call(this)}return inherits(ExtremaByObservable,__super__),ExtremaByObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new ExtremaByObserver(o,this._k,this._c))},ExtremaByObservable}(ObservableBase),ExtremaByObserver=function(__super__){function ExtremaByObserver(o,k,c){this._o=o,this._k=k,this._c=c,this._v=null,this._hv=!1,this._l=[],__super__.call(this)}return inherits(ExtremaByObserver,__super__),ExtremaByObserver.prototype.next=function(x){var key=tryCatch(this._k)(x);if(key===errorObj)return this._o.onError(key.e);var comparison=0;if(this._hv){if((comparison=tryCatch(this._c)(key,this._v))===errorObj)return this._o.onError(comparison.e)}else this._hv=!0,this._v=key;comparison>0&&(this._v=key,this._l=[]),comparison>=0&&this._l.push(x)},ExtremaByObserver.prototype.error=function(e){this._o.onError(e)},ExtremaByObserver.prototype.completed=function(){this._o.onNext(this._l),this._o.onCompleted()},ExtremaByObserver}(AbstractObserver),ReduceObservable=function(__super__){function ReduceObservable(source,accumulator,hasSeed,seed){this.source=source,this.accumulator=accumulator,this.hasSeed=hasSeed,this.seed=seed,__super__.call(this)}return inherits(ReduceObservable,__super__),ReduceObservable.prototype.subscribeCore=function(observer){return this.source.subscribe(new ReduceObserver(observer,this))},ReduceObservable}(ObservableBase),ReduceObserver=function(__super__){function ReduceObserver(o,parent){this._o=o,this._p=parent,this._fn=parent.accumulator,this._hs=parent.hasSeed,this._s=parent.seed,this._ha=!1,this._a=null,this._hv=!1,this._i=0,__super__.call(this)}return inherits(ReduceObserver,__super__),ReduceObserver.prototype.next=function(x){if(!this._hv&&(this._hv=!0),this._ha?this._a=tryCatch(this._fn)(this._a,x,this._i,this._p):(this._a=this._hs?tryCatch(this._fn)(this._s,x,this._i,this._p):x,this._ha=!0),this._a===errorObj)return this._o.onError(this._a.e);this._i++},ReduceObserver.prototype.error=function(e){this._o.onError(e)},ReduceObserver.prototype.completed=function(){this._hv&&this._o.onNext(this._a),!this._hv&&this._hs&&this._o.onNext(this._s),!this._hv&&!this._hs&&this._o.onError(new EmptyError),this._o.onCompleted()},ReduceObserver}(AbstractObserver);observableProto.reduce=function(){var seed,hasSeed=!1,accumulator=arguments[0];return 2===arguments.length&&(hasSeed=!0,seed=arguments[1]),new ReduceObservable(this,accumulator,hasSeed,seed)};var SomeObservable=function(__super__){function SomeObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(SomeObservable,__super__),SomeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SomeObserver(o,this._fn,this.source))},SomeObservable}(ObservableBase),SomeObserver=function(__super__){function SomeObserver(o,fn,s){this._o=o,this._fn=fn,this._s=s,this._i=0,__super__.call(this)}return inherits(SomeObserver,__super__),SomeObserver.prototype.next=function(x){var result=tryCatch(this._fn)(x,this._i++,this._s);if(result===errorObj)return this._o.onError(result.e);Boolean(result)&&(this._o.onNext(!0),this._o.onCompleted())},SomeObserver.prototype.error=function(e){this._o.onError(e)},SomeObserver.prototype.completed=function(){this._o.onNext(!1),this._o.onCompleted()},SomeObserver}(AbstractObserver);observableProto.some=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return new SomeObservable(this,fn)};var IsEmptyObservable=function(__super__){function IsEmptyObservable(source){this.source=source,__super__.call(this)}return inherits(IsEmptyObservable,__super__),IsEmptyObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new IsEmptyObserver(o))},IsEmptyObservable}(ObservableBase),IsEmptyObserver=function(__super__){function IsEmptyObserver(o){this._o=o,__super__.call(this)}return inherits(IsEmptyObserver,__super__),IsEmptyObserver.prototype.next=function(){this._o.onNext(!1),this._o.onCompleted()},IsEmptyObserver.prototype.error=function(e){this._o.onError(e)},IsEmptyObserver.prototype.completed=function(){this._o.onNext(!0),this._o.onCompleted()},IsEmptyObserver}(AbstractObserver);observableProto.isEmpty=function(){return new IsEmptyObservable(this)};var EveryObservable=function(__super__){function EveryObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(EveryObservable,__super__),EveryObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new EveryObserver(o,this._fn,this.source))},EveryObservable}(ObservableBase),EveryObserver=function(__super__){function EveryObserver(o,fn,s){this._o=o,this._fn=fn,this._s=s,this._i=0,__super__.call(this)}return inherits(EveryObserver,__super__),EveryObserver.prototype.next=function(x){var result=tryCatch(this._fn)(x,this._i++,this._s);if(result===errorObj)return this._o.onError(result.e);Boolean(result)||(this._o.onNext(!1),this._o.onCompleted())},EveryObserver.prototype.error=function(e){this._o.onError(e)},EveryObserver.prototype.completed=function(){this._o.onNext(!0),this._o.onCompleted()},EveryObserver}(AbstractObserver);observableProto.every=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return new EveryObservable(this,fn)};var IncludesObservable=function(__super__){function IncludesObservable(source,elem,idx){var n=+idx||0;Math.abs(n)===1/0&&(n=0),this.source=source,this._elem=elem,this._n=n,__super__.call(this)}return inherits(IncludesObservable,__super__),IncludesObservable.prototype.subscribeCore=function(o){return this._n<0?(o.onNext(!1),o.onCompleted(),disposableEmpty):this.source.subscribe(new IncludesObserver(o,this._elem,this._n))},IncludesObservable}(ObservableBase),IncludesObserver=function(__super__){function IncludesObserver(o,elem,n){this._o=o,this._elem=elem,this._n=n,this._i=0,__super__.call(this)}function comparer(a,b){return 0===a&&0===b||a===b||isNaN(a)&&isNaN(b)}return inherits(IncludesObserver,__super__),IncludesObserver.prototype.next=function(x){this._i++>=this._n&&comparer(x,this._elem)&&(this._o.onNext(!0),this._o.onCompleted())},IncludesObserver.prototype.error=function(e){this._o.onError(e)},IncludesObserver.prototype.completed=function(){this._o.onNext(!1),this._o.onCompleted()},IncludesObserver}(AbstractObserver);observableProto.includes=function(searchElement,fromIndex){return new IncludesObservable(this,searchElement,fromIndex)};var CountObservable=function(__super__){function CountObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(CountObservable,__super__),CountObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new CountObserver(o,this._fn,this.source))},CountObservable}(ObservableBase),CountObserver=function(__super__){function CountObserver(o,fn,s){this._o=o,this._fn=fn,this._s=s,this._i=0,this._c=0,__super__.call(this)}return inherits(CountObserver,__super__),CountObserver.prototype.next=function(x){if(this._fn){var result=tryCatch(this._fn)(x,this._i++,this._s);if(result===errorObj)return this._o.onError(result.e);Boolean(result)&&this._c++}else this._c++},CountObserver.prototype.error=function(e){this._o.onError(e)},CountObserver.prototype.completed=function(){this._o.onNext(this._c),this._o.onCompleted()},CountObserver}(AbstractObserver);observableProto.count=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return new CountObservable(this,fn)};var IndexOfObservable=function(__super__){function IndexOfObservable(source,e,n){this.source=source,this._e=e,this._n=n,__super__.call(this)}return inherits(IndexOfObservable,__super__),IndexOfObservable.prototype.subscribeCore=function(o){return this._n<0?(o.onNext(-1),o.onCompleted(),disposableEmpty):this.source.subscribe(new IndexOfObserver(o,this._e,this._n))},IndexOfObservable}(ObservableBase),IndexOfObserver=function(__super__){function IndexOfObserver(o,e,n){this._o=o,this._e=e,this._n=n,this._i=0,__super__.call(this)}return inherits(IndexOfObserver,__super__),IndexOfObserver.prototype.next=function(x){this._i>=this._n&&x===this._e&&(this._o.onNext(this._i),this._o.onCompleted()),this._i++},IndexOfObserver.prototype.error=function(e){this._o.onError(e)},IndexOfObserver.prototype.completed=function(){this._o.onNext(-1),this._o.onCompleted()},IndexOfObserver}(AbstractObserver);observableProto.indexOf=function(searchElement,fromIndex){var n=+fromIndex||0;return Math.abs(n)===1/0&&(n=0),new IndexOfObservable(this,searchElement,n)};var SumObservable=function(__super__){function SumObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(SumObservable,__super__),SumObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SumObserver(o,this._fn,this.source))},SumObservable}(ObservableBase),SumObserver=function(__super__){function SumObserver(o,fn,s){this._o=o,this._fn=fn,this._s=s,this._i=0,this._c=0,__super__.call(this)}return inherits(SumObserver,__super__),SumObserver.prototype.next=function(x){if(this._fn){var result=tryCatch(this._fn)(x,this._i++,this._s);if(result===errorObj)return this._o.onError(result.e);this._c+=result}else this._c+=x},SumObserver.prototype.error=function(e){this._o.onError(e)},SumObserver.prototype.completed=function(){this._o.onNext(this._c),this._o.onCompleted()},SumObserver}(AbstractObserver);observableProto.sum=function(keySelector,thisArg){var fn=bindCallback(keySelector,thisArg,3);return new SumObservable(this,fn)},observableProto.minBy=function(keySelector,comparer){return comparer||(comparer=defaultSubComparer),new ExtremaByObservable(this,keySelector,function(x,y){return-1*comparer(x,y)})},observableProto.min=function(comparer){return this.minBy(identity,comparer).map(firstOnly)},observableProto.maxBy=function(keySelector,comparer){return comparer||(comparer=defaultSubComparer),new ExtremaByObservable(this,keySelector,comparer)},observableProto.max=function(comparer){return this.maxBy(identity,comparer).map(firstOnly)};var AverageObservable=function(__super__){function AverageObservable(source,fn){this.source=source,this._fn=fn,__super__.call(this)}return inherits(AverageObservable,__super__),AverageObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new AverageObserver(o,this._fn,this.source))},AverageObservable}(ObservableBase),AverageObserver=function(__super__){function AverageObserver(o,fn,s){this._o=o,this._fn=fn,this._s=s,this._c=0,this._t=0,__super__.call(this)}return inherits(AverageObserver,__super__),AverageObserver.prototype.next=function(x){if(this._fn){var r=tryCatch(this._fn)(x,this._c++,this._s);if(r===errorObj)return this._o.onError(r.e);this._t+=r}else this._c++,this._t+=x},AverageObserver.prototype.error=function(e){this._o.onError(e)},AverageObserver.prototype.completed=function(){if(0===this._c)return this._o.onError(new EmptyError);this._o.onNext(this._t/this._c),this._o.onCompleted()},AverageObserver}(AbstractObserver);observableProto.average=function(keySelector,thisArg){var fn,source=this;return isFunction(keySelector)&&(fn=bindCallback(keySelector,thisArg,3)),new AverageObservable(source,fn)},observableProto.sequenceEqual=function(second,comparer){var first=this;return comparer||(comparer=defaultComparer),new AnonymousObservable(function(o){var donel=!1,doner=!1,ql=[],qr=[],subscription1=first.subscribe(function(x){if(qr.length>0){var v=qr.shift(),equal=tryCatch(comparer)(v,x);if(equal===errorObj)return o.onError(equal.e);equal||(o.onNext(!1),o.onCompleted())}else doner?(o.onNext(!1),o.onCompleted()):ql.push(x)},function(e){o.onError(e)},function(){donel=!0,0===ql.length&&(qr.length>0?(o.onNext(!1),o.onCompleted()):doner&&(o.onNext(!0),o.onCompleted()))});(isArrayLike(second)||isIterable(second))&&(second=observableFrom(second)),isPromise(second)&&(second=observableFromPromise(second));var subscription2=second.subscribe(function(x){if(ql.length>0){var v=ql.shift(),equal=tryCatch(comparer)(v,x);if(equal===errorObj)return o.onError(equal.e);equal||(o.onNext(!1),o.onCompleted())}else donel?(o.onNext(!1),o.onCompleted()):qr.push(x)},function(e){o.onError(e)},function(){doner=!0,0===qr.length&&(ql.length>0?(o.onNext(!1),o.onCompleted()):donel&&(o.onNext(!0),o.onCompleted()))});return new BinaryDisposable(subscription1,subscription2)},first)};var ElementAtObservable=function(__super__){function ElementAtObservable(source,i,d){this.source=source,this._i=i,this._d=d,__super__.call(this)}return inherits(ElementAtObservable,__super__),ElementAtObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new ElementAtObserver(o,this._i,this._d))},ElementAtObservable}(ObservableBase),ElementAtObserver=function(__super__){function ElementAtObserver(o,i,d){this._o=o,this._i=i,this._d=d,__super__.call(this)}return inherits(ElementAtObserver,__super__),ElementAtObserver.prototype.next=function(x){0==this._i--&&(this._o.onNext(x),this._o.onCompleted())},ElementAtObserver.prototype.error=function(e){this._o.onError(e)},ElementAtObserver.prototype.completed=function(){this._d===undefined?this._o.onError(new ArgumentOutOfRangeError):(this._o.onNext(this._d),this._o.onCompleted())},ElementAtObserver}(AbstractObserver);observableProto.elementAt=function(index,defaultValue){if(index<0)throw new ArgumentOutOfRangeError;return new ElementAtObservable(this,index,defaultValue)};var SingleObserver=function(__super__){function SingleObserver(o,obj,s){this._o=o,this._obj=obj,this._s=s,this._i=0,this._hv=!1,this._v=null,__super__.call(this)}return inherits(SingleObserver,__super__),SingleObserver.prototype.next=function(x){var shouldYield=!1;if(this._obj.predicate){var res=tryCatch(this._obj.predicate)(x,this._i++,this._s);if(res===errorObj)return this._o.onError(res.e);Boolean(res)&&(shouldYield=!0)}else this._obj.predicate||(shouldYield=!0);if(shouldYield){if(this._hv)return this._o.onError(new Error("Sequence contains more than one matching element"));this._hv=!0,this._v=x}},SingleObserver.prototype.error=function(e){this._o.onError(e)},SingleObserver.prototype.completed=function(){this._hv?(this._o.onNext(this._v),this._o.onCompleted()):this._obj.defaultValue===undefined?this._o.onError(new EmptyError):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},SingleObserver}(AbstractObserver);observableProto.single=function(predicate,thisArg){var obj={},source=this;if(obj="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},isFunction(obj.predicate)){var fn=obj.predicate;obj.predicate=bindCallback(fn,obj.thisArg,3)}return new AnonymousObservable(function(o){return source.subscribe(new SingleObserver(o,obj,source))},source)};var FirstObservable=function(__super__){function FirstObservable(source,obj){this.source=source,this._obj=obj,__super__.call(this)}return inherits(FirstObservable,__super__),FirstObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new FirstObserver(o,this._obj,this.source))},FirstObservable}(ObservableBase),FirstObserver=function(__super__){function FirstObserver(o,obj,s){this._o=o,this._obj=obj,this._s=s,this._i=0,__super__.call(this)}return inherits(FirstObserver,__super__),FirstObserver.prototype.next=function(x){if(this._obj.predicate){var res=tryCatch(this._obj.predicate)(x,this._i++,this._s);if(res===errorObj)return this._o.onError(res.e);Boolean(res)&&(this._o.onNext(x),this._o.onCompleted())}else this._obj.predicate||(this._o.onNext(x),this._o.onCompleted())},FirstObserver.prototype.error=function(e){this._o.onError(e)},FirstObserver.prototype.completed=function(){this._obj.defaultValue===undefined?this._o.onError(new EmptyError):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},FirstObserver}(AbstractObserver);observableProto.first=function(){var obj={};if(obj="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},isFunction(obj.predicate)){var fn=obj.predicate;obj.predicate=bindCallback(fn,obj.thisArg,3)}return new FirstObservable(this,obj)};var LastObservable=function(__super__){function LastObservable(source,obj){this.source=source,this._obj=obj,__super__.call(this)}return inherits(LastObservable,__super__),LastObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new LastObserver(o,this._obj,this.source))},LastObservable}(ObservableBase),LastObserver=function(__super__){function LastObserver(o,obj,s){this._o=o,this._obj=obj,this._s=s,this._i=0,this._hv=!1,this._v=null,__super__.call(this)}return inherits(LastObserver,__super__),LastObserver.prototype.next=function(x){var shouldYield=!1;if(this._obj.predicate){var res=tryCatch(this._obj.predicate)(x,this._i++,this._s);if(res===errorObj)return this._o.onError(res.e);Boolean(res)&&(shouldYield=!0)}else this._obj.predicate||(shouldYield=!0);shouldYield&&(this._hv=!0,this._v=x)},LastObserver.prototype.error=function(e){this._o.onError(e)},LastObserver.prototype.completed=function(){this._hv?(this._o.onNext(this._v),this._o.onCompleted()):this._obj.defaultValue===undefined?this._o.onError(new EmptyError):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},LastObserver}(AbstractObserver);observableProto.last=function(){var obj={};if(obj="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},isFunction(obj.predicate)){var fn=obj.predicate;obj.predicate=bindCallback(fn,obj.thisArg,3)}return new LastObservable(this,obj)};var FindValueObserver=function(__super__){function FindValueObserver(observer,source,callback,yieldIndex){this._o=observer,this._s=source,this._cb=callback,this._y=yieldIndex,this._i=0,__super__.call(this)}return inherits(FindValueObserver,__super__),FindValueObserver.prototype.next=function(x){var shouldRun=tryCatch(this._cb)(x,this._i,this._s);if(shouldRun===errorObj)return this._o.onError(shouldRun.e);shouldRun?(this._o.onNext(this._y?this._i:x),this._o.onCompleted()):this._i++},FindValueObserver.prototype.error=function(e){this._o.onError(e)},FindValueObserver.prototype.completed=function(){this._y&&this._o.onNext(-1),this._o.onCompleted()},FindValueObserver}(AbstractObserver);observableProto.find=function(predicate,thisArg){return findValue(this,predicate,thisArg,!1)},observableProto.findIndex=function(predicate,thisArg){return findValue(this,predicate,thisArg,!0)};var ToSetObservable=function(__super__){function ToSetObservable(source){this.source=source,__super__.call(this)}return inherits(ToSetObservable,__super__),ToSetObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new ToSetObserver(o))},ToSetObservable}(ObservableBase),ToSetObserver=function(__super__){function ToSetObserver(o){this._o=o,this._s=new root.Set,__super__.call(this)}return inherits(ToSetObserver,__super__),ToSetObserver.prototype.next=function(x){this._s.add(x)},ToSetObserver.prototype.error=function(e){this._o.onError(e)},ToSetObserver.prototype.completed=function(){this._o.onNext(this._s),this._o.onCompleted()},ToSetObserver}(AbstractObserver);observableProto.toSet=function(){if(void 0===root.Set)throw new TypeError;return new ToSetObservable(this)};var ToMapObservable=function(__super__){function ToMapObservable(source,k,e){this.source=source,this._k=k,this._e=e,__super__.call(this)}return inherits(ToMapObservable,__super__),ToMapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new ToMapObserver(o,this._k,this._e))},ToMapObservable}(ObservableBase),ToMapObserver=function(__super__){function ToMapObserver(o,k,e){this._o=o,this._k=k,this._e=e,this._m=new root.Map,__super__.call(this)}return inherits(ToMapObserver,__super__),ToMapObserver.prototype.next=function(x){var key=tryCatch(this._k)(x);if(key===errorObj)return this._o.onError(key.e);var elem=x;if(this._e&&(elem=tryCatch(this._e)(x))===errorObj)return this._o.onError(elem.e);this._m.set(key,elem)},ToMapObserver.prototype.error=function(e){this._o.onError(e)},ToMapObserver.prototype.completed=function(){this._o.onNext(this._m),this._o.onCompleted()},ToMapObserver}(AbstractObserver);observableProto.toMap=function(keySelector,elementSelector){if(void 0===root.Map)throw new TypeError;return new ToMapObservable(this,keySelector,elementSelector)};var SliceObservable=function(__super__){function SliceObservable(source,b,e){this.source=source,this._b=b,this._e=e,__super__.call(this)}return inherits(SliceObservable,__super__),SliceObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SliceObserver(o,this._b,this._e))},SliceObservable}(ObservableBase),SliceObserver=function(__super__){function SliceObserver(o,b,e){this._o=o,this._b=b,this._e=e,this._i=0,__super__.call(this)}return inherits(SliceObserver,__super__),SliceObserver.prototype.next=function(x){this._i>=this._b&&(this._e===this._i?this._o.onCompleted():this._o.onNext(x)),this._i++},SliceObserver.prototype.error=function(e){this._o.onError(e)},SliceObserver.prototype.completed=function(){this._o.onCompleted()},SliceObserver}(AbstractObserver);observableProto.slice=function(begin,end){var start=begin||0;if(start<0)throw new Rx.ArgumentOutOfRangeError;if("number"==typeof end&&end<start)throw new Rx.ArgumentOutOfRangeError;return new SliceObservable(this,start,end)};var LastIndexOfObservable=function(__super__){function LastIndexOfObservable(source,e,n){this.source=source,this._e=e,this._n=n,__super__.call(this)}return inherits(LastIndexOfObservable,__super__),LastIndexOfObservable.prototype.subscribeCore=function(o){return this._n<0?(o.onNext(-1),o.onCompleted(),disposableEmpty):this.source.subscribe(new LastIndexOfObserver(o,this._e,this._n))},LastIndexOfObservable}(ObservableBase),LastIndexOfObserver=function(__super__){function LastIndexOfObserver(o,e,n){this._o=o,this._e=e,this._n=n,this._v=0,this._hv=!1,this._i=0,__super__.call(this)}return inherits(LastIndexOfObserver,__super__),LastIndexOfObserver.prototype.next=function(x){this._i>=this._n&&x===this._e&&(this._hv=!0,this._v=this._i),this._i++},LastIndexOfObserver.prototype.error=function(e){this._o.onError(e)},LastIndexOfObserver.prototype.completed=function(){this._hv?this._o.onNext(this._v):this._o.onNext(-1),this._o.onCompleted()},LastIndexOfObserver}(AbstractObserver);observableProto.lastIndexOf=function(searchElement,fromIndex){var n=+fromIndex||0;return Math.abs(n)===1/0&&(n=0),new LastIndexOfObservable(this,searchElement,n)},Observable.wrap=function(fn){function createObservable(){return Observable.spawn.call(this,fn.apply(this,arguments))}return createObservable.__generatorFunction__=fn,createObservable};var spawn=Observable.spawn=function(){for(var gen=arguments[0],self=this,args=[],i=1,len=arguments.length;i<len;i++)args.push(arguments[i]);return new AnonymousObservable(function(o){function processGenerator(res){var ret=tryCatch(gen.next).call(gen,res);if(ret===errorObj)return o.onError(ret.e);next(ret)}function onError(err){var ret=tryCatch(gen.next).call(gen,err);if(ret===errorObj)return o.onError(ret.e);next(ret)}function next(ret){if(ret.done)return o.onNext(ret.value),void o.onCompleted();var obs=toObservable.call(self,ret.value),value=null,hasValue=!1;Observable.isObservable(obs)?g.add(obs.subscribe(function(val){hasValue=!0,value=val},onError,function(){hasValue&&processGenerator(value)})):onError(new TypeError("type not supported"))}var g=new CompositeDisposable;return isFunction(gen)&&(gen=gen.apply(self,args)),gen&&isFunction(gen.next)?(processGenerator(),g):(o.onNext(gen),o.onCompleted())})};Observable.start=function(func,context,scheduler){return observableToAsync(func,context,scheduler)()};var observableToAsync=Observable.toAsync=function(func,context,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),function(){var args=arguments,subject=new AsyncSubject;return scheduler.schedule(null,function(){var result;try{result=func.apply(context,args)}catch(e){return void subject.onError(e)}subject.onNext(result),subject.onCompleted()}),subject.asObservable()}};Observable.fromCallback=function(fn,ctx,selector){return function(){void 0===ctx&&(ctx=this);for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return createCbObservable(fn,ctx,selector,args)}},Observable.fromNodeCallback=function(fn,ctx,selector){return function(){void 0===ctx&&(ctx=this);for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return createNodeObservable(fn,ctx,selector,args)}},ListenDisposable.prototype.dispose=function(){this.isDisposed||(this._e.removeEventListener(this._n,this._fn,!1),this.isDisposed=!0)},Rx.config.useNativeEvents=!1;var EventObservable=function(__super__){function EventObservable(el,name,fn){this._el=el,this._n=name,this._fn=fn,__super__.call(this)}function createHandler(o,fn){return function(){var results=arguments[0];if(isFunction(fn)&&(results=tryCatch(fn).apply(null,arguments))===errorObj)return o.onError(results.e);o.onNext(results)}}return inherits(EventObservable,__super__),EventObservable.prototype.subscribeCore=function(o){return createEventListener(this._el,this._n,createHandler(o,this._fn))},EventObservable}(ObservableBase);Observable.fromEvent=function(element,eventName,selector){return element.addListener?fromEventPattern(function(h){element.addListener(eventName,h)},function(h){element.removeListener(eventName,h)},selector):Rx.config.useNativeEvents||"function"!=typeof element.on||"function"!=typeof element.off?new EventObservable(element,eventName,selector).publish().refCount():fromEventPattern(function(h){element.on(eventName,h)},function(h){element.off(eventName,h)},selector)};var EventPatternObservable=function(__super__){function EventPatternObservable(add,del,fn){this._add=add,this._del=del,this._fn=fn,__super__.call(this)}function createHandler(o,fn){return function(){var results=arguments[0];if(isFunction(fn)&&(results=tryCatch(fn).apply(null,arguments))===errorObj)return o.onError(results.e);o.onNext(results)}}function EventPatternDisposable(del,fn,ret){this._del=del,this._fn=fn,this._ret=ret,this.isDisposed=!1}return inherits(EventPatternObservable,__super__),EventPatternObservable.prototype.subscribeCore=function(o){var fn=createHandler(o,this._fn),returnValue=this._add(fn);return new EventPatternDisposable(this._del,fn,returnValue)},EventPatternDisposable.prototype.dispose=function(){this.isDisposed||(isFunction(this._del)&&this._del(this._fn,this._ret),this.isDisposed=!0)},EventPatternObservable}(ObservableBase),fromEventPattern=Observable.fromEventPattern=function(addHandler,removeHandler,selector){return new EventPatternObservable(addHandler,removeHandler,selector).publish().refCount()};Observable.startAsync=function(functionAsync){var promise=tryCatch(functionAsync)();return promise===errorObj?observableThrow(promise.e):observableFromPromise(promise)};var PausableObservable=function(__super__){function PausableObservable(source,pauser){this.source=source,this.controller=new Subject,this.paused=!0,pauser&&pauser.subscribe?this.pauser=this.controller.merge(pauser):this.pauser=this.controller,__super__.call(this)}return inherits(PausableObservable,__super__),PausableObservable.prototype._subscribe=function(o){var conn=this.source.publish(),subscription=conn.subscribe(o),connection=disposableEmpty,pausable=this.pauser.startWith(!this.paused).distinctUntilChanged().subscribe(function(b){b?connection=conn.connect():(connection.dispose(),connection=disposableEmpty)});return new NAryDisposable([subscription,connection,pausable])},PausableObservable.prototype.pause=function(){this.paused=!0,this.controller.onNext(!1)},PausableObservable.prototype.resume=function(){this.paused=!1,this.controller.onNext(!0)},PausableObservable}(Observable);observableProto.pausable=function(pauser){return new PausableObservable(this,pauser)};var PausableBufferedObservable=function(__super__){function PausableBufferedObservable(source,pauser){this.source=source,this.controller=new Subject,this.paused=!0,pauser&&pauser.subscribe?this.pauser=this.controller.merge(pauser):this.pauser=this.controller,__super__.call(this)}return inherits(PausableBufferedObservable,__super__),PausableBufferedObservable.prototype._subscribe=function(o){function drainQueue(){for(;q.length>0;)o.onNext(q.shift())}var previousShouldFire,q=[];return combineLatestSource(this.source,this.pauser.startWith(!this.paused).distinctUntilChanged(),function(data,shouldFire){return{data:data,shouldFire:shouldFire}}).subscribe(function(results){previousShouldFire!==undefined&&results.shouldFire!==previousShouldFire?(previousShouldFire=results.shouldFire,results.shouldFire&&drainQueue()):(previousShouldFire=results.shouldFire,results.shouldFire?o.onNext(results.data):q.push(results.data))},function(err){drainQueue(),o.onError(err)},function(){drainQueue(),o.onCompleted()})},PausableBufferedObservable.prototype.pause=function(){this.paused=!0,this.controller.onNext(!1)},PausableBufferedObservable.prototype.resume=function(){this.paused=!1,this.controller.onNext(!0)},PausableBufferedObservable}(Observable);observableProto.pausableBuffered=function(pauser){return new PausableBufferedObservable(this,pauser)};var ControlledObservable=function(__super__){function ControlledObservable(source,enableQueue,scheduler){__super__.call(this),this.subject=new ControlledSubject(enableQueue,scheduler),this.source=source.multicast(this.subject).refCount()}return inherits(ControlledObservable,__super__),ControlledObservable.prototype._subscribe=function(o){return this.source.subscribe(o)},ControlledObservable.prototype.request=function(numberOfItems){return this.subject.request(null==numberOfItems?-1:numberOfItems)},ControlledObservable}(Observable),ControlledSubject=function(__super__){function ControlledSubject(enableQueue,scheduler){null==enableQueue&&(enableQueue=!0),__super__.call(this),this.subject=new Subject,this.enableQueue=enableQueue,this.queue=enableQueue?[]:null,this.requestedCount=0,this.requestedDisposable=null,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.scheduler=scheduler||currentThreadScheduler}return inherits(ControlledSubject,__super__),addProperties(ControlledSubject.prototype,Observer,{_subscribe:function(o){return this.subject.subscribe(o)},onCompleted:function(){this.hasCompleted=!0,this.enableQueue&&0!==this.queue.length?this.queue.push(Notification.createOnCompleted()):(this.subject.onCompleted(),this.disposeCurrentRequest())},onError:function(error){this.hasFailed=!0,this.error=error,this.enableQueue&&0!==this.queue.length?this.queue.push(Notification.createOnError(error)):(this.subject.onError(error),this.disposeCurrentRequest())},onNext:function(value){this.requestedCount<=0?this.enableQueue&&this.queue.push(Notification.createOnNext(value)):(0==this.requestedCount--&&this.disposeCurrentRequest(),this.subject.onNext(value))},_processRequest:function(numberOfItems){if(this.enableQueue)for(;this.queue.length>0&&(numberOfItems>0||"N"!==this.queue[0].kind);){var first=this.queue.shift();first.accept(this.subject),"N"===first.kind?numberOfItems--:(this.disposeCurrentRequest(),this.queue=[])}return numberOfItems},request:function(number){this.disposeCurrentRequest();var self=this;return this.requestedDisposable=this.scheduler.schedule(number,function(s,i){var remaining=self._processRequest(i);if(!self.hasCompleted&&!self.hasFailed&&remaining>0)return self.requestedCount=remaining,disposableCreate(function(){self.requestedCount=0})}),this.requestedDisposable},disposeCurrentRequest:function(){this.requestedDisposable&&(this.requestedDisposable.dispose(),this.requestedDisposable=null)}}),ControlledSubject}(Observable);observableProto.controlled=function(enableQueue,scheduler){return enableQueue&&isScheduler(enableQueue)&&(scheduler=enableQueue,enableQueue=!0),null==enableQueue&&(enableQueue=!0),new ControlledObservable(this,enableQueue,scheduler)};var StopAndWaitObservable=function(__super__){function StopAndWaitObservable(source){__super__.call(this),this.source=source}function scheduleMethod(s,self){return self.source.request(1)}inherits(StopAndWaitObservable,__super__),StopAndWaitObservable.prototype._subscribe=function(o){return this.subscription=this.source.subscribe(new StopAndWaitObserver(o,this,this.subscription)),new BinaryDisposable(this.subscription,defaultScheduler.schedule(this,scheduleMethod))};var StopAndWaitObserver=function(__sub__){function StopAndWaitObserver(observer,observable,cancel){__sub__.call(this),this.observer=observer,this.observable=observable,this.cancel=cancel,this.scheduleDisposable=null}function innerScheduleMethod(s,self){return self.observable.source.request(1)}return inherits(StopAndWaitObserver,__sub__),StopAndWaitObserver.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},StopAndWaitObserver.prototype.error=function(error){this.observer.onError(error),this.dispose()},StopAndWaitObserver.prototype.next=function(value){this.observer.onNext(value),this.scheduleDisposable=defaultScheduler.schedule(this,innerScheduleMethod)},StopAndWaitObserver.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),__sub__.prototype.dispose.call(this)},StopAndWaitObserver}(AbstractObserver);return StopAndWaitObservable}(Observable);ControlledObservable.prototype.stopAndWait=function(){return new StopAndWaitObservable(this)};var WindowedObservable=function(__super__){function WindowedObservable(source,windowSize){__super__.call(this),this.source=source,this.windowSize=windowSize}function scheduleMethod(s,self){return self.source.request(self.windowSize)}inherits(WindowedObservable,__super__),WindowedObservable.prototype._subscribe=function(o){return this.subscription=this.source.subscribe(new WindowedObserver(o,this,this.subscription)),new BinaryDisposable(this.subscription,defaultScheduler.schedule(this,scheduleMethod))};var WindowedObserver=function(__sub__){function WindowedObserver(observer,observable,cancel){this.observer=observer,this.observable=observable,this.cancel=cancel,this.received=0,this.scheduleDisposable=null,__sub__.call(this)}function innerScheduleMethod(s,self){return self.observable.source.request(self.observable.windowSize)}return inherits(WindowedObserver,__sub__),WindowedObserver.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},WindowedObserver.prototype.error=function(error){this.observer.onError(error),this.dispose()},WindowedObserver.prototype.next=function(value){this.observer.onNext(value),this.received=++this.received%this.observable.windowSize,0===this.received&&(this.scheduleDisposable=defaultScheduler.schedule(this,innerScheduleMethod))},WindowedObserver.prototype.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),__sub__.prototype.dispose.call(this)},WindowedObserver}(AbstractObserver);return WindowedObservable}(Observable);ControlledObservable.prototype.windowed=function(windowSize){return new WindowedObservable(this,windowSize)},observableProto.pipe=function(dest){function onDrain(){source.resume()}var source=this.pausableBuffered();return dest.addListener("drain",onDrain),source.subscribe(function(x){!dest.write(x)&&source.pause()},function(err){dest.emit("error",err)},function(){!dest._isStdio&&dest.end(),dest.removeListener("drain",onDrain)}),source.resume(),dest};var MulticastObservable=function(__super__){function MulticastObservable(source,fn1,fn2){this.source=source,this._fn1=fn1,this._fn2=fn2,__super__.call(this)}return inherits(MulticastObservable,__super__),MulticastObservable.prototype.subscribeCore=function(o){var connectable=this.source.multicast(this._fn1());return new BinaryDisposable(this._fn2(connectable).subscribe(o),connectable.connect())},MulticastObservable}(ObservableBase);observableProto.multicast=function(subjectOrSubjectSelector,selector){return isFunction(subjectOrSubjectSelector)?new MulticastObservable(this,subjectOrSubjectSelector,selector):new ConnectableObservable(this,subjectOrSubjectSelector)},observableProto.publish=function(selector){return selector&&isFunction(selector)?this.multicast(function(){return new Subject},selector):this.multicast(new Subject)},observableProto.share=function(){return this.publish().refCount()},observableProto.publishLast=function(selector){return selector&&isFunction(selector)?this.multicast(function(){return new AsyncSubject},selector):this.multicast(new AsyncSubject)},observableProto.publishValue=function(initialValueOrSelector,initialValue){return 2===arguments.length?this.multicast(function(){return new BehaviorSubject(initialValue)},initialValueOrSelector):this.multicast(new BehaviorSubject(initialValueOrSelector))},observableProto.shareValue=function(initialValue){return this.publishValue(initialValue).refCount()},observableProto.replay=function(selector,bufferSize,windowSize,scheduler){return selector&&isFunction(selector)?this.multicast(function(){return new ReplaySubject(bufferSize,windowSize,scheduler)},selector):this.multicast(new ReplaySubject(bufferSize,windowSize,scheduler))},observableProto.shareReplay=function(bufferSize,windowSize,scheduler){return this.replay(null,bufferSize,windowSize,scheduler).refCount()};var InnerSubscription=function(s,o){this._s=s,this._o=o};InnerSubscription.prototype.dispose=function(){if(!this._s.isDisposed&&null!==this._o){var idx=this._s.observers.indexOf(this._o);this._s.observers.splice(idx,1),this._o=null}};var RefCountObservable=function(__super__){function RefCountObservable(source){this.source=source,this._count=0,this._connectableSubscription=null,__super__.call(this)}function RefCountDisposable(p,s){this._p=p,this._s=s,this.isDisposed=!1}return inherits(RefCountObservable,__super__),RefCountObservable.prototype.subscribeCore=function(o){var subscription=this.source.subscribe(o);return 1==++this._count&&(this._connectableSubscription=this.source.connect()),new RefCountDisposable(this,subscription)},RefCountDisposable.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._s.dispose(),0==--this._p._count&&this._p._connectableSubscription.dispose())},RefCountObservable}(ObservableBase),ConnectableObservable=Rx.ConnectableObservable=function(__super__){function ConnectableObservable(source,subject){this.source=source,this._connection=null,this._source=source.asObservable(),this._subject=subject,__super__.call(this)}function ConnectDisposable(parent,subscription){this._p=parent,this._s=subscription}return inherits(ConnectableObservable,__super__),ConnectDisposable.prototype.dispose=function(){this._s&&(this._s.dispose(),this._s=null,this._p._connection=null)},ConnectableObservable.prototype.connect=function(){if(!this._connection){if(this._subject.isStopped)return disposableEmpty;var subscription=this._source.subscribe(this._subject);this._connection=new ConnectDisposable(this,subscription)}return this._connection},ConnectableObservable.prototype._subscribe=function(o){return this._subject.subscribe(o)},ConnectableObservable.prototype.refCount=function(){return new RefCountObservable(this)},ConnectableObservable}(Observable);observableProto.singleInstance=function(){function getObservable(){return hasObservable||(hasObservable=!0,observable=source.finally(function(){hasObservable=!1}).publish().refCount()),observable}var observable,source=this,hasObservable=!1;return new AnonymousObservable(function(o){return getObservable().subscribe(o)})},observableProto.join=function(right,leftDurationSelector,rightDurationSelector,resultSelector){var left=this;return new AnonymousObservable(function(o){var group=new CompositeDisposable,leftDone=!1,rightDone=!1,leftId=0,rightId=0,leftMap=new Map,rightMap=new Map,handleError=function(e){o.onError(e)};return group.add(left.subscribe(function(value){var id=leftId++,md=new SingleAssignmentDisposable;leftMap.set(id,value),group.add(md);var duration=tryCatch(leftDurationSelector)(value);if(duration===errorObj)return o.onError(duration.e);md.setDisposable(duration.take(1).subscribe(noop,handleError,function(){leftMap.delete(id)&&0===leftMap.size&&leftDone&&o.onCompleted(),group.remove(md)})),rightMap.forEach(function(v){var result=tryCatch(resultSelector)(value,v);if(result===errorObj)return o.onError(result.e);o.onNext(result)})},handleError,function(){leftDone=!0,(rightDone||0===leftMap.size)&&o.onCompleted()})),group.add(right.subscribe(function(value){var id=rightId++,md=new SingleAssignmentDisposable;rightMap.set(id,value),group.add(md);var duration=tryCatch(rightDurationSelector)(value);if(duration===errorObj)return o.onError(duration.e);md.setDisposable(duration.take(1).subscribe(noop,handleError,function(){rightMap.delete(id)&&0===rightMap.size&&rightDone&&o.onCompleted(),group.remove(md)})),leftMap.forEach(function(v){var result=tryCatch(resultSelector)(v,value);if(result===errorObj)return o.onError(result.e);o.onNext(result)})},handleError,function(){rightDone=!0,(leftDone||0===rightMap.size)&&o.onCompleted()})),group},left)},observableProto.groupJoin=function(right,leftDurationSelector,rightDurationSelector,resultSelector){var left=this;return new AnonymousObservable(function(o){function handleError(e){}var group=new CompositeDisposable,r=new RefCountDisposable(group),leftMap=new Map,rightMap=new Map,leftId=0,rightId=0,handleError=function(e){return function(v){v.onError(e)}};return group.add(left.subscribe(function(value){var s=new Subject,id=leftId++;leftMap.set(id,s);var result=tryCatch(resultSelector)(value,addRef(s,r));if(result===errorObj)return leftMap.forEach(handleError(result.e)),o.onError(result.e);o.onNext(result),rightMap.forEach(function(v){s.onNext(v)});var md=new SingleAssignmentDisposable;group.add(md);var duration=tryCatch(leftDurationSelector)(value);if(duration===errorObj)return leftMap.forEach(handleError(duration.e)),o.onError(duration.e);md.setDisposable(duration.take(1).subscribe(noop,function(e){leftMap.forEach(handleError(e)),o.onError(e)},function(){leftMap.delete(id)&&s.onCompleted(),group.remove(md)}))},function(e){leftMap.forEach(handleError(e)),o.onError(e)},function(){o.onCompleted()})),group.add(right.subscribe(function(value){var id=rightId++;rightMap.set(id,value);var md=new SingleAssignmentDisposable;group.add(md);var duration=tryCatch(rightDurationSelector)(value);if(duration===errorObj)return leftMap.forEach(handleError(duration.e)),o.onError(duration.e);md.setDisposable(duration.take(1).subscribe(noop,function(e){leftMap.forEach(handleError(e)),o.onError(e)},function(){rightMap.delete(id),group.remove(md)})),leftMap.forEach(function(v){v.onNext(value)})},function(e){leftMap.forEach(handleError(e)),o.onError(e)})),r},left)},observableProto.buffer=function(){return this.window.apply(this,arguments).flatMap(toArray)},observableProto.window=function(windowOpeningsOrClosingSelector,windowClosingSelector){return 1===arguments.length&&"function"!=typeof arguments[0]?observableWindowWithBoundaries.call(this,windowOpeningsOrClosingSelector):"function"==typeof windowOpeningsOrClosingSelector?observableWindowWithClosingSelector.call(this,windowOpeningsOrClosingSelector):observableWindowWithOpenings.call(this,windowOpeningsOrClosingSelector,windowClosingSelector)};var PairwiseObservable=function(__super__){function PairwiseObservable(source){this.source=source,__super__.call(this)}return inherits(PairwiseObservable,__super__),PairwiseObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new PairwiseObserver(o))},PairwiseObservable}(ObservableBase),PairwiseObserver=function(__super__){function PairwiseObserver(o){this._o=o,this._p=null,this._hp=!1,__super__.call(this)}return inherits(PairwiseObserver,__super__),PairwiseObserver.prototype.next=function(x){this._hp?this._o.onNext([this._p,x]):this._hp=!0,this._p=x},PairwiseObserver.prototype.error=function(err){this._o.onError(err)},PairwiseObserver.prototype.completed=function(){this._o.onCompleted()},PairwiseObserver}(AbstractObserver);observableProto.pairwise=function(){return new PairwiseObservable(this)},observableProto.partition=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return[this.filter(predicate,thisArg),this.filter(function(x,i,o){return!fn(x,i,o)})]};var WhileEnumerable=function(__super__){function WhileEnumerable(c,s){this.c=c,this.s=s}return inherits(WhileEnumerable,__super__),WhileEnumerable.prototype[$iterator$]=function(){var self=this;return{next:function(){return self.c()?{done:!1,value:self.s}:{done:!0,value:void 0}}}},WhileEnumerable}(Enumerable);observableProto.letBind=observableProto.let=function(func){return func(this)},Observable.if=function(condition,thenSource,elseSourceOrScheduler){return observableDefer(function(){return elseSourceOrScheduler||(elseSourceOrScheduler=observableEmpty()),isPromise(thenSource)&&(thenSource=observableFromPromise(thenSource)),isPromise(elseSourceOrScheduler)&&(elseSourceOrScheduler=observableFromPromise(elseSourceOrScheduler)),"function"==typeof elseSourceOrScheduler.now&&(elseSourceOrScheduler=observableEmpty(elseSourceOrScheduler)),condition()?thenSource:elseSourceOrScheduler})},Observable.for=Observable.forIn=function(sources,resultSelector,thisArg){return enumerableOf(sources,resultSelector,thisArg).concat()};var observableWhileDo=Observable.while=Observable.whileDo=function(condition,source){return isPromise(source)&&(source=observableFromPromise(source)),enumerableWhile(condition,source).concat()};observableProto.doWhile=function(condition){return observableConcat([this,observableWhileDo(condition,this)])},Observable.case=function(selector,sources,defaultSourceOrScheduler){return observableDefer(function(){isPromise(defaultSourceOrScheduler)&&(defaultSourceOrScheduler=observableFromPromise(defaultSourceOrScheduler)),defaultSourceOrScheduler||(defaultSourceOrScheduler=observableEmpty()),isScheduler(defaultSourceOrScheduler)&&(defaultSourceOrScheduler=observableEmpty(defaultSourceOrScheduler));var result=sources[selector()];return isPromise(result)&&(result=observableFromPromise(result)),result||defaultSourceOrScheduler})};var ExpandObservable=function(__super__){function ExpandObservable(source,fn,scheduler){this.source=source,this._fn=fn,this._scheduler=scheduler,__super__.call(this)}function scheduleRecursive(args,recurse){var work,state=args[0],self=args[1];if(!(state.q.length>0))return void(state.isAcquired=!1);work=state.q.shift();var m1=new SingleAssignmentDisposable;state.d.add(m1),m1.setDisposable(work.subscribe(new ExpandObserver(state,self,m1))),recurse([state,self])}return inherits(ExpandObservable,__super__),ExpandObservable.prototype._ensureActive=function(state){var isOwner=!1;state.q.length>0&&(isOwner=!state.isAcquired,state.isAcquired=!0),isOwner&&state.m.setDisposable(this._scheduler.scheduleRecursive([state,this],scheduleRecursive))},ExpandObservable.prototype.subscribeCore=function(o){var m=new SerialDisposable,d=new CompositeDisposable(m),state={q:[],m:m,d:d,activeCount:0,isAcquired:!1,o:o};return state.q.push(this.source),state.activeCount++,this._ensureActive(state),d},ExpandObservable}(ObservableBase),ExpandObserver=function(__super__){function ExpandObserver(state,parent,m1){this._s=state,this._p=parent,this._m1=m1,__super__.call(this)}return inherits(ExpandObserver,__super__),ExpandObserver.prototype.next=function(x){this._s.o.onNext(x);var result=tryCatch(this._p._fn)(x);if(result===errorObj)return this._s.o.onError(result.e);this._s.q.push(result),this._s.activeCount++,this._p._ensureActive(this._s)},ExpandObserver.prototype.error=function(e){this._s.o.onError(e)},ExpandObserver.prototype.completed=function(){this._s.d.remove(this._m1),0===--this._s.activeCount&&this._s.o.onCompleted()},ExpandObserver}(AbstractObserver);observableProto.expand=function(selector,scheduler){return isScheduler(scheduler)||(scheduler=currentThreadScheduler),new ExpandObservable(this,selector,scheduler)};var ForkJoinObservable=function(__super__){function ForkJoinObservable(sources,cb){this._sources=sources,this._cb=cb,__super__.call(this)}return inherits(ForkJoinObservable,__super__),ForkJoinObservable.prototype.subscribeCore=function(o){if(0===this._sources.length)return o.onCompleted(),disposableEmpty;for(var count=this._sources.length,state={finished:!1,hasResults:new Array(count),hasCompleted:new Array(count),results:new Array(count)},subscriptions=new CompositeDisposable,i=0,len=this._sources.length;i<len;i++){var source=this._sources[i];isPromise(source)&&(source=observableFromPromise(source)),subscriptions.add(source.subscribe(new ForkJoinObserver(o,state,i,this._cb,subscriptions)))}return subscriptions},ForkJoinObservable}(ObservableBase),ForkJoinObserver=function(__super__){function ForkJoinObserver(o,s,i,cb,subs){this._o=o,this._s=s,this._i=i,this._cb=cb,this._subs=subs,__super__.call(this)}return inherits(ForkJoinObserver,__super__),ForkJoinObserver.prototype.next=function(x){this._s.finished||(this._s.hasResults[this._i]=!0,this._s.results[this._i]=x)},ForkJoinObserver.prototype.error=function(e){this._s.finished=!0,this._o.onError(e),this._subs.dispose()},ForkJoinObserver.prototype.completed=function(){if(!this._s.finished){if(!this._s.hasResults[this._i])return this._o.onCompleted();this._s.hasCompleted[this._i]=!0;for(var i=0;i<this._s.results.length;i++)if(!this._s.hasCompleted[i])return;this._s.finished=!0;var res=tryCatch(this._cb).apply(null,this._s.results);if(res===errorObj)return this._o.onError(res.e);this._o.onNext(res),this._o.onCompleted()}},ForkJoinObserver}(AbstractObserver);Observable.forkJoin=function(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;return Array.isArray(args[0])&&(args=args[0]),new ForkJoinObservable(args,resultSelector)},observableProto.forkJoin=function(){for(var len=arguments.length,args=new Array(len),i=0;i<len;i++)args[i]=arguments[i];return Array.isArray(args[0])?args[0].unshift(this):args.unshift(this),Observable.forkJoin.apply(null,args)},observableProto.manySelect=observableProto.extend=function(selector,scheduler){isScheduler(scheduler)||(scheduler=Rx.Scheduler.immediate);var source=this;return observableDefer(function(){var chain;return source.map(function(x){var curr=new ChainObservable(x);return chain&&chain.onNext(x),chain=curr,curr}).tap(noop,function(e){chain&&chain.onError(e)},function(){chain&&chain.onCompleted()}).observeOn(scheduler).map(selector)},source)};var ChainObservable=function(__super__){function ChainObservable(head){__super__.call(this),this.head=head,this.tail=new AsyncSubject}return inherits(ChainObservable,__super__),addProperties(ChainObservable.prototype,Observer,{_subscribe:function(o){var g=new CompositeDisposable;return g.add(currentThreadScheduler.schedule(this,function(_,self){o.onNext(self.head),g.add(self.tail.mergeAll().subscribe(o))})),g},onCompleted:function(){this.onNext(Observable.empty())},onError:function(e){this.onNext(Observable.throw(e))},onNext:function(v){this.tail.onNext(v),this.tail.onCompleted()}}),ChainObservable}(Observable),Map=root.Map||function(){function Map(){this.size=0,this._values=[],this._keys=[]}return Map.prototype.delete=function(key){var i=this._keys.indexOf(key);return-1!==i&&(this._values.splice(i,1),this._keys.splice(i,1),this.size--,!0)},Map.prototype.get=function(key){var i=this._keys.indexOf(key);return-1===i?undefined:this._values[i]},Map.prototype.set=function(key,value){var i=this._keys.indexOf(key);return-1===i?(this._keys.push(key),this._values.push(value),this.size++):this._values[i]=value,this},Map.prototype.forEach=function(cb,thisArg){for(var i=0;i<this.size;i++)cb.call(thisArg,this._values[i],this._keys[i])},Map}();Pattern.prototype.and=function(other){return new Pattern(this.patterns.concat(other))},Pattern.prototype.thenDo=function(selector){return new Plan(this,selector)},Plan.prototype.activate=function(externalSubscriptions,observer,deactivate){for(var joinObservers=[],errHandler=handleOnError(observer),i=0,len=this.expression.patterns.length;i<len;i++)joinObservers.push(planCreateObserver(externalSubscriptions,this.expression.patterns[i],errHandler));var activePlan=new ActivePlan(joinObservers,handleOnNext(this,observer),function(){for(var j=0,jlen=joinObservers.length;j<jlen;j++)joinObservers[j].removeActivePlan(activePlan);deactivate(activePlan)});for(i=0,len=joinObservers.length;i<len;i++)joinObservers[i].addActivePlan(activePlan);return activePlan},ActivePlan.prototype.dequeue=function(){this.joinObservers.forEach(function(v){v.queue.shift()})},ActivePlan.prototype.match=function(){var i,len,hasValues=!0;for(i=0,len=this.joinObserverArray.length;i<len;i++)if(0===this.joinObserverArray[i].queue.length){hasValues=!1;break}if(hasValues){var firstValues=[],isCompleted=!1;for(i=0,len=this.joinObserverArray.length;i<len;i++)firstValues.push(this.joinObserverArray[i].queue[0]),"C"===this.joinObserverArray[i].queue[0].kind&&(isCompleted=!0);if(isCompleted)this.onCompleted();else{this.dequeue();var values=[];for(i=0,len=firstValues.length;i<firstValues.length;i++)values.push(firstValues[i].value);this.onNext.apply(this,values)}}};var JoinObserver=function(__super__){function JoinObserver(source,onError){__super__.call(this),this.source=source,this.onError=onError,this.queue=[],this.activePlans=[],this.subscription=new SingleAssignmentDisposable,this.isDisposed=!1}inherits(JoinObserver,__super__);var JoinObserverPrototype=JoinObserver.prototype;return JoinObserverPrototype.next=function(notification){if(!this.isDisposed){if("E"===notification.kind)return this.onError(notification.error);this.queue.push(notification);for(var activePlans=this.activePlans.slice(0),i=0,len=activePlans.length;i<len;i++)activePlans[i].match()}},JoinObserverPrototype.error=noop,JoinObserverPrototype.completed=noop,JoinObserverPrototype.addActivePlan=function(activePlan){this.activePlans.push(activePlan)},JoinObserverPrototype.subscribe=function(){this.subscription.setDisposable(this.source.materialize().subscribe(this))},JoinObserverPrototype.removeActivePlan=function(activePlan){this.activePlans.splice(this.activePlans.indexOf(activePlan),1),0===this.activePlans.length&&this.dispose()},JoinObserverPrototype.dispose=function(){__super__.prototype.dispose.call(this),this.isDisposed||(this.isDisposed=!0,this.subscription.dispose())},JoinObserver}(AbstractObserver);observableProto.and=function(right){return new Pattern([this,right])},observableProto.thenDo=function(selector){return new Pattern([this]).thenDo(selector)},Observable.when=function(){var plans,len=arguments.length;if(Array.isArray(arguments[0]))plans=arguments[0];else{plans=new Array(len);for(var i=0;i<len;i++)plans[i]=arguments[i]}return new AnonymousObservable(function(o){var activePlans=[],externalSubscriptions=new Map,outObserver=observerCreate(function(x){o.onNext(x)},function(err){externalSubscriptions.forEach(function(v){v.onError(err)}),o.onError(err)},function(x){o.onCompleted()});try{for(var i=0,len=plans.length;i<len;i++)activePlans.push(plans[i].activate(externalSubscriptions,outObserver,function(activePlan){var idx=activePlans.indexOf(activePlan);activePlans.splice(idx,1),0===activePlans.length&&o.onCompleted()}))}catch(e){return observableThrow(e).subscribe(o)}var group=new CompositeDisposable;return externalSubscriptions.forEach(function(joinObserver){joinObserver.subscribe(),group.add(joinObserver)}),group})};var TimerObservable=function(__super__){function TimerObservable(dt,s){this._dt=dt,this._s=s,__super__.call(this)}function scheduleMethod(s,o){o.onNext(0),o.onCompleted()}return inherits(TimerObservable,__super__),TimerObservable.prototype.subscribeCore=function(o){return this._s.scheduleFuture(o,this._dt,scheduleMethod)},TimerObservable}(ObservableBase),observableinterval=Observable.interval=function(period,scheduler){return observableTimerTimeSpanAndPeriod(period,period,isScheduler(scheduler)?scheduler:defaultScheduler)};Observable.timer=function(dueTime,periodOrScheduler,scheduler){var period;return isScheduler(scheduler)||(scheduler=defaultScheduler),null!=periodOrScheduler&&"number"==typeof periodOrScheduler?period=periodOrScheduler:isScheduler(periodOrScheduler)&&(scheduler=periodOrScheduler),(dueTime instanceof Date||"number"==typeof dueTime)&&period===undefined?_observableTimer(dueTime,scheduler):dueTime instanceof Date&&period!==undefined?observableTimerDateAndPeriod(dueTime,periodOrScheduler,scheduler):observableTimerTimeSpanAndPeriod(dueTime,period,scheduler)};observableProto.delay=function(){var firstArg=arguments[0];if("number"==typeof firstArg||firstArg instanceof Date){var dueTime=firstArg,scheduler=arguments[1];return isScheduler(scheduler)||(scheduler=defaultScheduler),dueTime instanceof Date?observableDelayAbsolute(this,dueTime,scheduler):observableDelayRelative(this,dueTime,scheduler)}if(Observable.isObservable(firstArg)||isFunction(firstArg))return delayWithSelector(this,firstArg,arguments[1]);throw new Error("Invalid arguments")};var DebounceObservable=function(__super__){function DebounceObservable(source,dt,s){isScheduler(s)||(s=defaultScheduler),this.source=source,this._dt=dt,this._s=s,__super__.call(this)}return inherits(DebounceObservable,__super__),DebounceObservable.prototype.subscribeCore=function(o){var cancelable=new SerialDisposable;return new BinaryDisposable(this.source.subscribe(new DebounceObserver(o,this._dt,this._s,cancelable)),cancelable)},DebounceObservable}(ObservableBase),DebounceObserver=function(__super__){function DebounceObserver(observer,dueTime,scheduler,cancelable){this._o=observer,this._d=dueTime,this._scheduler=scheduler,this._c=cancelable,this._v=null,this._hv=!1,this._id=0,__super__.call(this)}return inherits(DebounceObserver,__super__),DebounceObserver.prototype.next=function(x){this._hv=!0,this._v=x;var currentId=++this._id,d=new SingleAssignmentDisposable;this._c.setDisposable(d),d.setDisposable(this._scheduler.scheduleFuture(this,this._d,function(_,self){self._hv&&self._id===currentId&&self._o.onNext(x),self._hv=!1}))},DebounceObserver.prototype.error=function(e){this._c.dispose(),this._o.onError(e),this._hv=!1,this._id++},DebounceObserver.prototype.completed=function(){this._c.dispose(),this._hv&&this._o.onNext(this._v),this._o.onCompleted(),this._hv=!1,this._id++},DebounceObserver}(AbstractObserver);observableProto.debounce=function(){if(isFunction(arguments[0]))return debounceWithSelector(this,arguments[0]);if("number"==typeof arguments[0])return new DebounceObservable(this,arguments[0],arguments[1]);throw new Error("Invalid arguments")},observableProto.windowWithTime=observableProto.windowTime=function(timeSpan,timeShiftOrScheduler,scheduler){var timeShift,source=this;return null==timeShiftOrScheduler&&(timeShift=timeSpan),isScheduler(scheduler)||(scheduler=defaultScheduler),"number"==typeof timeShiftOrScheduler?timeShift=timeShiftOrScheduler:isScheduler(timeShiftOrScheduler)&&(timeShift=timeSpan,scheduler=timeShiftOrScheduler),new AnonymousObservable(function(observer){function createTimer(){var m=new SingleAssignmentDisposable,isSpan=!1,isShift=!1;timerD.setDisposable(m),nextSpan===nextShift?(isSpan=!0,isShift=!0):nextSpan<nextShift?isSpan=!0:isShift=!0;var newTotalTime=isSpan?nextSpan:nextShift,ts=newTotalTime-totalTime;totalTime=newTotalTime,isSpan&&(nextSpan+=timeShift),isShift&&(nextShift+=timeShift),m.setDisposable(scheduler.scheduleFuture(null,ts,function(){if(isShift){var s=new Subject;q.push(s),observer.onNext(addRef(s,refCountDisposable))}isSpan&&q.shift().onCompleted(),createTimer()}))}var groupDisposable,refCountDisposable,nextShift=timeShift,nextSpan=timeSpan,q=[],timerD=new SerialDisposable,totalTime=0;return groupDisposable=new CompositeDisposable(timerD),refCountDisposable=new RefCountDisposable(groupDisposable),q.push(new Subject),observer.onNext(addRef(q[0],refCountDisposable)),createTimer(),groupDisposable.add(source.subscribe(function(x){for(var i=0,len=q.length;i<len;i++)q[i].onNext(x)},function(e){for(var i=0,len=q.length;i<len;i++)q[i].onError(e);observer.onError(e)},function(){for(var i=0,len=q.length;i<len;i++)q[i].onCompleted();observer.onCompleted()})),refCountDisposable},source)},observableProto.windowWithTimeOrCount=observableProto.windowTimeOrCount=function(timeSpan,count,scheduler){var source=this;return isScheduler(scheduler)||(scheduler=defaultScheduler),new AnonymousObservable(function(observer){function createTimer(id){var m=new SingleAssignmentDisposable;timerD.setDisposable(m),m.setDisposable(scheduler.scheduleFuture(null,timeSpan,function(){if(id===windowId){n=0;var newId=++windowId;s.onCompleted(),s=new Subject,observer.onNext(addRef(s,refCountDisposable)),createTimer(newId)}}))}var timerD=new SerialDisposable,groupDisposable=new CompositeDisposable(timerD),refCountDisposable=new RefCountDisposable(groupDisposable),n=0,windowId=0,s=new Subject;return observer.onNext(addRef(s,refCountDisposable)),createTimer(0),groupDisposable.add(source.subscribe(function(x){var newId=0,newWindow=!1;s.onNext(x),++n===count&&(newWindow=!0,n=0,newId=++windowId,s.onCompleted(),s=new Subject,observer.onNext(addRef(s,refCountDisposable))),newWindow&&createTimer(newId)},function(e){s.onError(e),observer.onError(e)},function(){s.onCompleted(),observer.onCompleted()})),refCountDisposable},source)},observableProto.bufferWithTime=observableProto.bufferTime=function(timeSpan,timeShiftOrScheduler,scheduler){return this.windowWithTime(timeSpan,timeShiftOrScheduler,scheduler).flatMap(toArray)},observableProto.bufferWithTimeOrCount=observableProto.bufferTimeOrCount=function(timeSpan,count,scheduler){return this.windowWithTimeOrCount(timeSpan,count,scheduler).flatMap(toArray)};var TimeIntervalObservable=function(__super__){function TimeIntervalObservable(source,s){this.source=source,this._s=s,__super__.call(this)}return inherits(TimeIntervalObservable,__super__),TimeIntervalObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TimeIntervalObserver(o,this._s))},TimeIntervalObservable}(ObservableBase),TimeIntervalObserver=function(__super__){function TimeIntervalObserver(o,s){this._o=o,this._s=s,this._l=s.now(),__super__.call(this)}return inherits(TimeIntervalObserver,__super__),TimeIntervalObserver.prototype.next=function(x){var now=this._s.now(),span=now-this._l;this._l=now,this._o.onNext({value:x,interval:span})},TimeIntervalObserver.prototype.error=function(e){this._o.onError(e)},TimeIntervalObserver.prototype.completed=function(){this._o.onCompleted()},TimeIntervalObserver}(AbstractObserver);observableProto.timeInterval=function(scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new TimeIntervalObservable(this,scheduler)};var TimestampObservable=function(__super__){function TimestampObservable(source,s){this.source=source,this._s=s,__super__.call(this)}return inherits(TimestampObservable,__super__),TimestampObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TimestampObserver(o,this._s))},TimestampObservable}(ObservableBase),TimestampObserver=function(__super__){function TimestampObserver(o,s){this._o=o,this._s=s,__super__.call(this)}return inherits(TimestampObserver,__super__),TimestampObserver.prototype.next=function(x){this._o.onNext({value:x,timestamp:this._s.now()})},TimestampObserver.prototype.error=function(e){this._o.onError(e)},TimestampObserver.prototype.completed=function(){this._o.onCompleted()},TimestampObserver}(AbstractObserver);observableProto.timestamp=function(scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new TimestampObservable(this,scheduler)};var SampleObservable=function(__super__){function SampleObservable(source,sampler){this.source=source,this._sampler=sampler,__super__.call(this)}return inherits(SampleObservable,__super__),SampleObservable.prototype.subscribeCore=function(o){var state={o:o,atEnd:!1,value:null,hasValue:!1,sourceSubscription:new SingleAssignmentDisposable};return state.sourceSubscription.setDisposable(this.source.subscribe(new SampleSourceObserver(state))),new BinaryDisposable(state.sourceSubscription,this._sampler.subscribe(new SamplerObserver(state)))},SampleObservable}(ObservableBase),SamplerObserver=function(__super__){function SamplerObserver(s){this._s=s,__super__.call(this)}return inherits(SamplerObserver,__super__),SamplerObserver.prototype._handleMessage=function(){this._s.hasValue&&(this._s.hasValue=!1,this._s.o.onNext(this._s.value)),this._s.atEnd&&this._s.o.onCompleted()},SamplerObserver.prototype.next=function(){this._handleMessage()},SamplerObserver.prototype.error=function(e){this._s.onError(e)},SamplerObserver.prototype.completed=function(){this._handleMessage()},SamplerObserver}(AbstractObserver),SampleSourceObserver=function(__super__){function SampleSourceObserver(s){this._s=s,__super__.call(this)}return inherits(SampleSourceObserver,__super__),SampleSourceObserver.prototype.next=function(x){this._s.hasValue=!0,this._s.value=x},SampleSourceObserver.prototype.error=function(e){this._s.o.onError(e)},SampleSourceObserver.prototype.completed=function(){this._s.atEnd=!0,this._s.sourceSubscription.dispose()},SampleSourceObserver}(AbstractObserver);observableProto.sample=function(intervalOrSampler,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),"number"==typeof intervalOrSampler?new SampleObservable(this,observableinterval(intervalOrSampler,scheduler)):new SampleObservable(this,intervalOrSampler)};var TimeoutError=Rx.TimeoutError=function(message){this.message=message||"Timeout has occurred",this.name="TimeoutError",Error.call(this)};TimeoutError.prototype=Object.create(Error.prototype),observableProto.timeout=function(){var firstArg=arguments[0];if(firstArg instanceof Date||"number"==typeof firstArg)return timeout(this,firstArg,arguments[1],arguments[2]);if(Observable.isObservable(firstArg)||isFunction(firstArg))return timeoutWithSelector(this,firstArg,arguments[1],arguments[2]);throw new Error("Invalid arguments")};var GenerateAbsoluteObservable=function(__super__){function GenerateAbsoluteObservable(state,cndFn,itrFn,resFn,timeFn,s){this._state=state,this._cndFn=cndFn,this._itrFn=itrFn,this._resFn=resFn,this._timeFn=timeFn,this._s=s,__super__.call(this)}function scheduleRecursive(state,recurse){if(state.hasResult&&state.o.onNext(state.result),state.first)state.first=!1;else if(state.newState=tryCatch(state.self._itrFn)(state.newState),state.newState===errorObj)return state.o.onError(state.newState.e);if(state.hasResult=tryCatch(state.self._cndFn)(state.newState),state.hasResult===errorObj)return state.o.onError(state.hasResult.e);if(state.hasResult){if(state.result=tryCatch(state.self._resFn)(state.newState),state.result===errorObj)return state.o.onError(state.result.e);var time=tryCatch(state.self._timeFn)(state.newState);if(time===errorObj)return state.o.onError(time.e);recurse(state,time)}else state.o.onCompleted()}return inherits(GenerateAbsoluteObservable,__super__),GenerateAbsoluteObservable.prototype.subscribeCore=function(o){var state={o:o,self:this,newState:this._state,first:!0,hasResult:!1};return this._s.scheduleRecursiveFuture(state,new Date(this._s.now()),scheduleRecursive)},GenerateAbsoluteObservable}(ObservableBase);Observable.generateWithAbsoluteTime=function(initialState,condition,iterate,resultSelector,timeSelector,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new GenerateAbsoluteObservable(initialState,condition,iterate,resultSelector,timeSelector,scheduler)};var GenerateRelativeObservable=function(__super__){function GenerateRelativeObservable(state,cndFn,itrFn,resFn,timeFn,s){this._state=state,this._cndFn=cndFn,this._itrFn=itrFn,this._resFn=resFn,this._timeFn=timeFn,this._s=s,__super__.call(this)}function scheduleRecursive(state,recurse){if(state.hasResult&&state.o.onNext(state.result),state.first)state.first=!1;else if(state.newState=tryCatch(state.self._itrFn)(state.newState),state.newState===errorObj)return state.o.onError(state.newState.e);if(state.hasResult=tryCatch(state.self._cndFn)(state.newState),state.hasResult===errorObj)return state.o.onError(state.hasResult.e);if(state.hasResult){if(state.result=tryCatch(state.self._resFn)(state.newState),state.result===errorObj)return state.o.onError(state.result.e);var time=tryCatch(state.self._timeFn)(state.newState);if(time===errorObj)return state.o.onError(time.e);recurse(state,time)}else state.o.onCompleted()}return inherits(GenerateRelativeObservable,__super__),GenerateRelativeObservable.prototype.subscribeCore=function(o){var state={o:o,self:this,newState:this._state,first:!0,hasResult:!1};return this._s.scheduleRecursiveFuture(state,0,scheduleRecursive)},GenerateRelativeObservable}(ObservableBase);Observable.generateWithRelativeTime=function(initialState,condition,iterate,resultSelector,timeSelector,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new GenerateRelativeObservable(initialState,condition,iterate,resultSelector,timeSelector,scheduler)};var DelaySubscription=function(__super__){function DelaySubscription(source,dt,s){this.source=source,this._dt=dt,this._s=s,__super__.call(this)}function scheduleMethod(s,state){var source=state[0],o=state[1];state[2].setDisposable(source.subscribe(o))}return inherits(DelaySubscription,__super__),DelaySubscription.prototype.subscribeCore=function(o){var d=new SerialDisposable;return d.setDisposable(this._s.scheduleFuture([this.source,o,d],this._dt,scheduleMethod)),d},DelaySubscription}(ObservableBase);observableProto.delaySubscription=function(dueTime,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new DelaySubscription(this,dueTime,scheduler)};var SkipLastWithTimeObservable=function(__super__){function SkipLastWithTimeObservable(source,d,s){this.source=source,this._d=d,this._s=s,__super__.call(this)}return inherits(SkipLastWithTimeObservable,__super__),SkipLastWithTimeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SkipLastWithTimeObserver(o,this))},SkipLastWithTimeObservable}(ObservableBase),SkipLastWithTimeObserver=function(__super__){function SkipLastWithTimeObserver(o,p){this._o=o,this._s=p._s,this._d=p._d,this._q=[],__super__.call(this)}return inherits(SkipLastWithTimeObserver,__super__),SkipLastWithTimeObserver.prototype.next=function(x){var now=this._s.now();for(this._q.push({interval:now,value:x});this._q.length>0&&now-this._q[0].interval>=this._d;)this._o.onNext(this._q.shift().value)},SkipLastWithTimeObserver.prototype.error=function(e){this._o.onError(e)},SkipLastWithTimeObserver.prototype.completed=function(){for(var now=this._s.now();this._q.length>0&&now-this._q[0].interval>=this._d;)this._o.onNext(this._q.shift().value);this._o.onCompleted()},SkipLastWithTimeObserver}(AbstractObserver);observableProto.skipLastWithTime=function(duration,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new SkipLastWithTimeObservable(this,duration,scheduler)};var TakeLastWithTimeObservable=function(__super__){function TakeLastWithTimeObservable(source,d,s){this.source=source,this._d=d,this._s=s,__super__.call(this)}return inherits(TakeLastWithTimeObservable,__super__),TakeLastWithTimeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TakeLastWithTimeObserver(o,this._d,this._s))},TakeLastWithTimeObservable}(ObservableBase),TakeLastWithTimeObserver=function(__super__){function TakeLastWithTimeObserver(o,d,s){this._o=o,this._d=d,this._s=s,this._q=[],__super__.call(this)}return inherits(TakeLastWithTimeObserver,__super__),TakeLastWithTimeObserver.prototype.next=function(x){var now=this._s.now();for(this._q.push({interval:now,value:x});this._q.length>0&&now-this._q[0].interval>=this._d;)this._q.shift()},TakeLastWithTimeObserver.prototype.error=function(e){this._o.onError(e)},TakeLastWithTimeObserver.prototype.completed=function(){for(var now=this._s.now();this._q.length>0;){var next=this._q.shift();now-next.interval<=this._d&&this._o.onNext(next.value)}this._o.onCompleted()},TakeLastWithTimeObserver}(AbstractObserver);observableProto.takeLastWithTime=function(duration,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new TakeLastWithTimeObservable(this,duration,scheduler)},observableProto.takeLastBufferWithTime=function(duration,scheduler){var source=this;return isScheduler(scheduler)||(scheduler=defaultScheduler),new AnonymousObservable(function(o){var q=[];return source.subscribe(function(x){var now=scheduler.now();for(q.push({interval:now,value:x});q.length>0&&now-q[0].interval>=duration;)q.shift()},function(e){o.onError(e)},function(){for(var now=scheduler.now(),res=[];q.length>0;){var next=q.shift();now-next.interval<=duration&&res.push(next.value)}o.onNext(res),o.onCompleted()})},source)};var TakeWithTimeObservable=function(__super__){function TakeWithTimeObservable(source,d,s){this.source=source,this._d=d,this._s=s,__super__.call(this)}function scheduleMethod(s,o){o.onCompleted()}return inherits(TakeWithTimeObservable,__super__),TakeWithTimeObservable.prototype.subscribeCore=function(o){return new BinaryDisposable(this._s.scheduleFuture(o,this._d,scheduleMethod),this.source.subscribe(o))},TakeWithTimeObservable}(ObservableBase);observableProto.takeWithTime=function(duration,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new TakeWithTimeObservable(this,duration,scheduler)};var SkipWithTimeObservable=function(__super__){function SkipWithTimeObservable(source,d,s){this.source=source,this._d=d,this._s=s,this._open=!1,__super__.call(this)}function scheduleMethod(s,self){self._open=!0}return inherits(SkipWithTimeObservable,__super__),SkipWithTimeObservable.prototype.subscribeCore=function(o){return new BinaryDisposable(this._s.scheduleFuture(this,this._d,scheduleMethod),this.source.subscribe(new SkipWithTimeObserver(o,this)))},SkipWithTimeObservable}(ObservableBase),SkipWithTimeObserver=function(__super__){function SkipWithTimeObserver(o,p){this._o=o,this._p=p,__super__.call(this)}return inherits(SkipWithTimeObserver,__super__),SkipWithTimeObserver.prototype.next=function(x){this._p._open&&this._o.onNext(x)},SkipWithTimeObserver.prototype.error=function(e){this._o.onError(e)},SkipWithTimeObserver.prototype.completed=function(){this._o.onCompleted()},SkipWithTimeObserver}(AbstractObserver);observableProto.skipWithTime=function(duration,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new SkipWithTimeObservable(this,duration,scheduler)};var SkipUntilWithTimeObservable=function(__super__){function SkipUntilWithTimeObservable(source,startTime,scheduler){this.source=source,this._st=startTime,this._s=scheduler,__super__.call(this)}function scheduleMethod(s,state){state._open=!0}return inherits(SkipUntilWithTimeObservable,__super__),SkipUntilWithTimeObservable.prototype.subscribeCore=function(o){return this._open=!1,new BinaryDisposable(this._s.scheduleFuture(this,this._st,scheduleMethod),this.source.subscribe(new SkipUntilWithTimeObserver(o,this)))},SkipUntilWithTimeObservable}(ObservableBase),SkipUntilWithTimeObserver=function(__super__){function SkipUntilWithTimeObserver(o,p){this._o=o,this._p=p,__super__.call(this)}return inherits(SkipUntilWithTimeObserver,__super__),SkipUntilWithTimeObserver.prototype.next=function(x){this._p._open&&this._o.onNext(x)},SkipUntilWithTimeObserver.prototype.error=function(e){this._o.onError(e)},SkipUntilWithTimeObserver.prototype.completed=function(){this._o.onCompleted()},SkipUntilWithTimeObserver}(AbstractObserver);observableProto.skipUntilWithTime=function(startTime,scheduler){return isScheduler(scheduler)||(scheduler=defaultScheduler),new SkipUntilWithTimeObservable(this,startTime,scheduler)},observableProto.takeUntilWithTime=function(endTime,scheduler){isScheduler(scheduler)||(scheduler=defaultScheduler);var source=this;return new AnonymousObservable(function(o){return new BinaryDisposable(scheduler.scheduleFuture(o,endTime,function(_,o){o.onCompleted()}),source.subscribe(o))},source)},observableProto.throttle=function(windowDuration,scheduler){isScheduler(scheduler)||(scheduler=defaultScheduler);var duration=+windowDuration||0;if(duration<=0)throw new RangeError("windowDuration cannot be less or equal zero.");var source=this;return new AnonymousObservable(function(o){var lastOnNext=0;return source.subscribe(function(x){var now=scheduler.now();(0===lastOnNext||now-lastOnNext>=duration)&&(lastOnNext=now,o.onNext(x))},function(e){o.onError(e)},function(){o.onCompleted()})},source)};var TransduceObserver=function(__super__){function TransduceObserver(o,xform){this._o=o,this._xform=xform,__super__.call(this)}return inherits(TransduceObserver,__super__),TransduceObserver.prototype.next=function(x){var res=tryCatch(this._xform["@@transducer/step"]).call(this._xform,this._o,x);res===errorObj&&this._o.onError(res.e)},TransduceObserver.prototype.error=function(e){this._o.onError(e)},TransduceObserver.prototype.completed=function(){this._xform["@@transducer/result"](this._o)},TransduceObserver}(AbstractObserver);observableProto.transduce=function(transducer){var source=this;return new AnonymousObservable(function(o){var xform=transducer(transformForObserver(o));return source.subscribe(new TransduceObserver(o,xform))},source)};var SwitchFirstObservable=function(__super__){function SwitchFirstObservable(source){this.source=source,__super__.call(this)}return inherits(SwitchFirstObservable,__super__),SwitchFirstObservable.prototype.subscribeCore=function(o){var m=new SingleAssignmentDisposable,g=new CompositeDisposable,state={hasCurrent:!1,isStopped:!1,o:o,g:g};return g.add(m),m.setDisposable(this.source.subscribe(new SwitchFirstObserver(state))),g},SwitchFirstObservable}(ObservableBase),SwitchFirstObserver=function(__super__){function SwitchFirstObserver(state){this._s=state,__super__.call(this)}function InnerObserver(state,inner){this._s=state,this._i=inner,__super__.call(this)}return inherits(SwitchFirstObserver,__super__),SwitchFirstObserver.prototype.next=function(x){if(!this._s.hasCurrent){this._s.hasCurrent=!0,isPromise(x)&&(x=observableFromPromise(x));var inner=new SingleAssignmentDisposable;this._s.g.add(inner),inner.setDisposable(x.subscribe(new InnerObserver(this._s,inner)))}},SwitchFirstObserver.prototype.error=function(e){this._s.o.onError(e)},SwitchFirstObserver.prototype.completed=function(){this._s.isStopped=!0,!this._s.hasCurrent&&1===this._s.g.length&&this._s.o.onCompleted()},inherits(InnerObserver,__super__),InnerObserver.prototype.next=function(x){this._s.o.onNext(x)},InnerObserver.prototype.error=function(e){this._s.o.onError(e)},InnerObserver.prototype.completed=function(){this._s.g.remove(this._i),this._s.hasCurrent=!1,this._s.isStopped&&1===this._s.g.length&&this._s.o.onCompleted()},SwitchFirstObserver}(AbstractObserver);observableProto.switchFirst=function(){return new SwitchFirstObservable(this)},observableProto.flatMapFirst=observableProto.exhaustMap=function(selector,resultSelector,thisArg){return new FlatMapObservable(this,selector,resultSelector,thisArg).switchFirst()},observableProto.flatMapWithMaxConcurrent=observableProto.flatMapMaxConcurrent=function(limit,selector,resultSelector,thisArg){return new FlatMapObservable(this,selector,resultSelector,thisArg).merge(limit)};var VirtualTimeScheduler=Rx.VirtualTimeScheduler=function(__super__){function VirtualTimeScheduler(initialClock,comparer){this.clock=initialClock,this.comparer=comparer,this.isEnabled=!1,this.queue=new PriorityQueue(1024),__super__.call(this)}inherits(VirtualTimeScheduler,__super__);var VirtualTimeSchedulerPrototype=VirtualTimeScheduler.prototype;return VirtualTimeSchedulerPrototype.now=function(){return this.toAbsoluteTime(this.clock)},VirtualTimeSchedulerPrototype.schedule=function(state,action){return this.scheduleAbsolute(state,this.clock,action)},VirtualTimeSchedulerPrototype.scheduleFuture=function(state,dueTime,action){var dt=dueTime instanceof Date?this.toRelativeTime(dueTime-this.now()):this.toRelativeTime(dueTime);return this.scheduleRelative(state,dt,action)},VirtualTimeSchedulerPrototype.add=notImplemented,VirtualTimeSchedulerPrototype.toAbsoluteTime=notImplemented,VirtualTimeSchedulerPrototype.toRelativeTime=notImplemented,VirtualTimeSchedulerPrototype.schedulePeriodic=function(state,period,action){return new SchedulePeriodicRecursive(this,state,period,action).start()},VirtualTimeSchedulerPrototype.scheduleRelative=function(state,dueTime,action){var runAt=this.add(this.clock,dueTime);return this.scheduleAbsolute(state,runAt,action)},VirtualTimeSchedulerPrototype.start=function(){if(!this.isEnabled){this.isEnabled=!0;do{var next=this.getNext();null!==next?(this.comparer(next.dueTime,this.clock)>0&&(this.clock=next.dueTime),next.invoke()):this.isEnabled=!1}while(this.isEnabled)}},VirtualTimeSchedulerPrototype.stop=function(){this.isEnabled=!1},VirtualTimeSchedulerPrototype.advanceTo=function(time){var dueToClock=this.comparer(this.clock,time);if(this.comparer(this.clock,time)>0)throw new ArgumentOutOfRangeError;if(0!==dueToClock&&!this.isEnabled){this.isEnabled=!0;do{var next=this.getNext();null!==next&&this.comparer(next.dueTime,time)<=0?(this.comparer(next.dueTime,this.clock)>0&&(this.clock=next.dueTime),next.invoke()):this.isEnabled=!1}while(this.isEnabled);this.clock=time}},VirtualTimeSchedulerPrototype.advanceBy=function(time){var dt=this.add(this.clock,time),dueToClock=this.comparer(this.clock,dt);if(dueToClock>0)throw new ArgumentOutOfRangeError;0!==dueToClock&&this.advanceTo(dt)},VirtualTimeSchedulerPrototype.sleep=function(time){var dt=this.add(this.clock,time);if(this.comparer(this.clock,dt)>=0)throw new ArgumentOutOfRangeError;this.clock=dt},VirtualTimeSchedulerPrototype.getNext=function(){for(;this.queue.length>0;){var next=this.queue.peek();if(!next.isCancelled())return next;this.queue.dequeue()}return null},VirtualTimeSchedulerPrototype.scheduleAbsolute=function(state,dueTime,action){function run(scheduler,state1){return self.queue.remove(si),action(scheduler,state1)}var self=this,si=new ScheduledItem(this,state,run,dueTime,this.comparer);return this.queue.enqueue(si),si.disposable},VirtualTimeScheduler}(Scheduler);Rx.HistoricalScheduler=function(__super__){function HistoricalScheduler(initialClock,comparer){var clock=null==initialClock?0:initialClock,cmp=comparer||defaultSubComparer;__super__.call(this,clock,cmp)}inherits(HistoricalScheduler,__super__);var HistoricalSchedulerProto=HistoricalScheduler.prototype;return HistoricalSchedulerProto.add=function(absolute,relative){return absolute+relative},HistoricalSchedulerProto.toAbsoluteTime=function(absolute){return new Date(absolute).getTime()},HistoricalSchedulerProto.toRelativeTime=function(timeSpan){return timeSpan},HistoricalScheduler}(Rx.VirtualTimeScheduler),OnNextPredicate.prototype.equals=function(other){return other===this||null!=other&&("N"===other.kind&&this.predicate(other.value))},OnErrorPredicate.prototype.equals=function(other){return other===this||null!=other&&("E"===other.kind&&this.predicate(other.error))};var ReactiveTest=Rx.ReactiveTest={created:100,subscribed:200,disposed:1e3,onNext:function(ticks,value){return"function"==typeof value?new Recorded(ticks,new OnNextPredicate(value)):new Recorded(ticks,Notification.createOnNext(value))},onError:function(ticks,error){return"function"==typeof error?new Recorded(ticks,new OnErrorPredicate(error)):new Recorded(ticks,Notification.createOnError(error))},onCompleted:function(ticks){return new Recorded(ticks,Notification.createOnCompleted())},subscribe:function(start,end){return new Subscription(start,end)}},Recorded=Rx.Recorded=function(time,value,comparer){this.time=time,this.value=value,this.comparer=comparer||defaultComparer};Recorded.prototype.equals=function(other){return this.time===other.time&&this.comparer(this.value,other.value)},Recorded.prototype.toString=function(){return this.value.toString()+"@"+this.time};var Subscription=Rx.Subscription=function(start,end){this.subscribe=start,this.unsubscribe=end||Number.MAX_VALUE};Subscription.prototype.equals=function(other){return this.subscribe===other.subscribe&&this.unsubscribe===other.unsubscribe},Subscription.prototype.toString=function(){return"("+this.subscribe+", "+(this.unsubscribe===Number.MAX_VALUE?"Infinite":this.unsubscribe)+")"},(Rx.MockDisposable=function(scheduler){this.scheduler=scheduler,this.disposes=[],this.disposes.push(this.scheduler.clock)}).prototype.dispose=function(){this.disposes.push(this.scheduler.clock)};var MockObserver=function(__super__){function MockObserver(scheduler){__super__.call(this),this.scheduler=scheduler,this.messages=[]}inherits(MockObserver,__super__);var MockObserverPrototype=MockObserver.prototype;return MockObserverPrototype.onNext=function(value){this.messages.push(new Recorded(this.scheduler.clock,Notification.createOnNext(value)))},MockObserverPrototype.onError=function(e){this.messages.push(new Recorded(this.scheduler.clock,Notification.createOnError(e)))},MockObserverPrototype.onCompleted=function(){this.messages.push(new Recorded(this.scheduler.clock,Notification.createOnCompleted()))},MockObserver}(Observer);MockPromise.prototype.then=function(onResolved,onRejected){var self=this;this.subscriptions.push(new Subscription(this.scheduler.clock));var newPromise,index=this.subscriptions.length-1,observer=Rx.Observer.create(function(x){var retValue=onResolved(x);if(retValue&&"function"==typeof retValue.then)newPromise=retValue;else{var ticks=self.scheduler.clock;newPromise=new MockPromise(self.scheduler,[Rx.ReactiveTest.onNext(ticks,undefined),Rx.ReactiveTest.onCompleted(ticks)])}var idx=self.observers.indexOf(observer);self.observers.splice(idx,1),self.subscriptions[index]=new Subscription(self.subscriptions[index].subscribe,self.scheduler.clock)},function(err){onRejected(err);var idx=self.observers.indexOf(observer);self.observers.splice(idx,1),self.subscriptions[index]=new Subscription(self.subscriptions[index].subscribe,self.scheduler.clock)});return this.observers.push(observer),newPromise||new MockPromise(this.scheduler,this.messages)};var HotObservable=function(__super__){function HotObservable(scheduler,messages){__super__.call(this);var message,notification,observable=this;this.scheduler=scheduler,this.messages=messages,this.subscriptions=[],this.observers=[];for(var i=0,len=this.messages.length;i<len;i++)message=this.messages[i],notification=message.value,function(innerNotification){scheduler.scheduleAbsolute(null,message.time,function(){for(var obs=observable.observers.slice(0),j=0,jLen=obs.length;j<jLen;j++)innerNotification.accept(obs[j]);return disposableEmpty})}(notification)}return inherits(HotObservable,__super__),HotObservable.prototype._subscribe=function(o){var observable=this;this.observers.push(o),this.subscriptions.push(new Subscription(this.scheduler.clock));var index=this.subscriptions.length-1;return disposableCreate(function(){var idx=observable.observers.indexOf(o);observable.observers.splice(idx,1),observable.subscriptions[index]=new Subscription(observable.subscriptions[index].subscribe,observable.scheduler.clock)})},HotObservable}(Observable),ColdObservable=function(__super__){function ColdObservable(scheduler,messages){__super__.call(this),this.scheduler=scheduler,this.messages=messages,this.subscriptions=[]}return inherits(ColdObservable,__super__),ColdObservable.prototype._subscribe=function(o){var message,notification,observable=this;this.subscriptions.push(new Subscription(this.scheduler.clock));for(var index=this.subscriptions.length-1,d=new CompositeDisposable,i=0,len=this.messages.length;i<len;i++)message=this.messages[i],notification=message.value,function(innerNotification){d.add(observable.scheduler.scheduleRelative(null,message.time,function(){return innerNotification.accept(o),disposableEmpty}))}(notification);return disposableCreate(function(){observable.subscriptions[index]=new Subscription(observable.subscriptions[index].subscribe,observable.scheduler.clock),d.dispose()})},ColdObservable}(Observable);Rx.TestScheduler=function(__super__){function baseComparer(x,y){return x>y?1:x<y?-1:0}function TestScheduler(){__super__.call(this,0,baseComparer)}return inherits(TestScheduler,__super__),TestScheduler.prototype.scheduleAbsolute=function(state,dueTime,action){return dueTime<=this.clock&&(dueTime=this.clock+1),__super__.prototype.scheduleAbsolute.call(this,state,dueTime,action)},TestScheduler.prototype.add=function(absolute,relative){return absolute+relative},TestScheduler.prototype.toAbsoluteTime=function(absolute){return new Date(absolute).getTime()},TestScheduler.prototype.toRelativeTime=function(timeSpan){return timeSpan},TestScheduler.prototype.startScheduler=function(createFn,settings){settings||(settings={}),null==settings.created&&(settings.created=ReactiveTest.created),null==settings.subscribed&&(settings.subscribed=ReactiveTest.subscribed),null==settings.disposed&&(settings.disposed=ReactiveTest.disposed);var source,subscription,observer=this.createObserver();return this.scheduleAbsolute(null,settings.created,function(){return source=createFn(),disposableEmpty}),this.scheduleAbsolute(null,settings.subscribed,function(){return subscription=source.subscribe(observer),disposableEmpty}),this.scheduleAbsolute(null,settings.disposed,function(){return subscription.dispose(),disposableEmpty}),this.start(),observer},TestScheduler.prototype.createHotObservable=function(){var args,len=arguments.length;if(Array.isArray(arguments[0]))args=arguments[0];else{args=new Array(len);for(var i=0;i<len;i++)args[i]=arguments[i]}return new HotObservable(this,args)},TestScheduler.prototype.createColdObservable=function(){var args,len=arguments.length;if(Array.isArray(arguments[0]))args=arguments[0];else{args=new Array(len);for(var i=0;i<len;i++)args[i]=arguments[i]}return new ColdObservable(this,args)},TestScheduler.prototype.createResolvedPromise=function(ticks,value){return new MockPromise(this,[Rx.ReactiveTest.onNext(ticks,value),Rx.ReactiveTest.onCompleted(ticks)])},TestScheduler.prototype.createRejectedPromise=function(ticks,reason){return new MockPromise(this,[Rx.ReactiveTest.onError(ticks,reason)])},TestScheduler.prototype.createObserver=function(){return new MockObserver(this)},TestScheduler}(VirtualTimeScheduler);var AnonymousObservable=Rx.AnonymousObservable=function(__super__){function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],self=state[1],sub=tryCatch(self.__subscribe).call(self,ado);sub!==errorObj||ado.fail(errorObj.e)||thrower(errorObj.e),ado.setDisposable(fixSubscriber(sub))}function AnonymousObservable(subscribe,parent){this.source=parent,this.__subscribe=subscribe,__super__.call(this)}return inherits(AnonymousObservable,__super__),AnonymousObservable.prototype._subscribe=function(o){var ado=new AutoDetachObserver(o),state=[ado,this];return currentThreadScheduler.scheduleRequired()?currentThreadScheduler.schedule(state,setDisposable):setDisposable(null,state),ado},AnonymousObservable}(Observable),AutoDetachObserver=function(__super__){function AutoDetachObserver(observer){__super__.call(this),this.observer=observer,this.m=new SingleAssignmentDisposable}inherits(AutoDetachObserver,__super__);var AutoDetachObserverPrototype=AutoDetachObserver.prototype;return AutoDetachObserverPrototype.next=function(value){var result=tryCatch(this.observer.onNext).call(this.observer,value);result===errorObj&&(this.dispose(),thrower(result.e))},AutoDetachObserverPrototype.error=function(err){var result=tryCatch(this.observer.onError).call(this.observer,err);this.dispose(),result===errorObj&&thrower(result.e)},AutoDetachObserverPrototype.completed=function(){var result=tryCatch(this.observer.onCompleted).call(this.observer);this.dispose(),result===errorObj&&thrower(result.e)},AutoDetachObserverPrototype.setDisposable=function(value){this.m.setDisposable(value)},AutoDetachObserverPrototype.getDisposable=function(){return this.m.getDisposable()},AutoDetachObserverPrototype.dispose=function(){__super__.prototype.dispose.call(this),this.m.dispose()},AutoDetachObserver}(AbstractObserver),UnderlyingObservable=function(__super__){function UnderlyingObservable(m,u){this._m=m,this._u=u,__super__.call(this)}return inherits(UnderlyingObservable,__super__),UnderlyingObservable.prototype.subscribeCore=function(o){return new BinaryDisposable(this._m.getDisposable(),this._u.subscribe(o))},UnderlyingObservable}(ObservableBase),GroupedObservable=function(__super__){function GroupedObservable(key,underlyingObservable,mergedDisposable){__super__.call(this),this.key=key,this.underlyingObservable=mergedDisposable?new UnderlyingObservable(mergedDisposable,underlyingObservable):underlyingObservable}return inherits(GroupedObservable,__super__),GroupedObservable.prototype._subscribe=function(o){return this.underlyingObservable.subscribe(o)},GroupedObservable}(Observable),Subject=Rx.Subject=function(__super__){function Subject(){__super__.call(this),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}return inherits(Subject,__super__),addProperties(Subject.prototype,Observer.prototype,{_subscribe:function(o){return checkDisposed(this),this.isStopped?this.hasError?(o.onError(this.error),disposableEmpty):(o.onCompleted(),disposableEmpty):(this.observers.push(o),new InnerSubscription(this,o))},hasObservers:function(){return checkDisposed(this),this.observers.length>0},onCompleted:function(){if(checkDisposed(this),!this.isStopped){this.isStopped=!0;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++)os[i].onCompleted();this.observers.length=0}},onError:function(error){if(checkDisposed(this),!this.isStopped){this.isStopped=!0,this.error=error,this.hasError=!0;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++)os[i].onError(error);this.observers.length=0}},onNext:function(value){if(checkDisposed(this),!this.isStopped)for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++)os[i].onNext(value)},dispose:function(){this.isDisposed=!0,this.observers=null}}),Subject.create=function(observer,observable){return new AnonymousSubject(observer,observable)},Subject}(Observable),AsyncSubject=Rx.AsyncSubject=function(__super__){function AsyncSubject(){__super__.call(this),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}return inherits(AsyncSubject,__super__),addProperties(AsyncSubject.prototype,Observer.prototype,{_subscribe:function(o){return checkDisposed(this),this.isStopped?(this.hasError?o.onError(this.error):this.hasValue?(o.onNext(this.value),o.onCompleted()):o.onCompleted(),disposableEmpty):(this.observers.push(o),new InnerSubscription(this,o))},hasObservers:function(){return checkDisposed(this),this.observers.length>0},onCompleted:function(){var i,len;if(checkDisposed(this),!this.isStopped){this.isStopped=!0;var os=cloneArray(this.observers),len=os.length;if(this.hasValue)for(i=0;i<len;i++){var o=os[i];o.onNext(this.value),o.onCompleted()}else for(i=0;i<len;i++)os[i].onCompleted();this.observers.length=0}},onError:function(error){if(checkDisposed(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=error;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++)os[i].onError(error);this.observers.length=0}},onNext:function(value){checkDisposed(this),this.isStopped||(this.value=value,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.error=null,this.value=null}}),AsyncSubject}(Observable),BehaviorSubject=Rx.BehaviorSubject=function(__super__){function BehaviorSubject(value){__super__.call(this),this.value=value,this.observers=[],this.isDisposed=!1,this.isStopped=!1,this.hasError=!1}return inherits(BehaviorSubject,__super__),addProperties(BehaviorSubject.prototype,Observer.prototype,{_subscribe:function(o){return checkDisposed(this),this.isStopped?(this.hasError?o.onError(this.error):o.onCompleted(),disposableEmpty):(this.observers.push(o),o.onNext(this.value),new InnerSubscription(this,o))},getValue:function(){return checkDisposed(this),this.hasError&&thrower(this.error),this.value},hasObservers:function(){return checkDisposed(this),this.observers.length>0},onCompleted:function(){if(checkDisposed(this),!this.isStopped){this.isStopped=!0;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++)os[i].onCompleted();this.observers.length=0}},onError:function(error){if(checkDisposed(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=error;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++)os[i].onError(error);this.observers.length=0}},onNext:function(value){if(checkDisposed(this),!this.isStopped){this.value=value;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++)os[i].onNext(value)}},dispose:function(){this.isDisposed=!0,this.observers=null,this.value=null,this.error=null}}),BehaviorSubject}(Observable),ReplaySubject=Rx.ReplaySubject=function(__super__){function createRemovableDisposable(subject,observer){return disposableCreate(function(){observer.dispose(),!subject.isDisposed&&subject.observers.splice(subject.observers.indexOf(observer),1)})}function ReplaySubject(bufferSize,windowSize,scheduler){this.bufferSize=null==bufferSize?maxSafeInteger:bufferSize,this.windowSize=null==windowSize?maxSafeInteger:windowSize,this.scheduler=scheduler||currentThreadScheduler,this.q=[],this.observers=[],this.isStopped=!1,this.isDisposed=!1,this.hasError=!1,this.error=null,__super__.call(this)}var maxSafeInteger=Math.pow(2,53)-1;return inherits(ReplaySubject,__super__),addProperties(ReplaySubject.prototype,Observer.prototype,{_subscribe:function(o){checkDisposed(this);var so=new ScheduledObserver(this.scheduler,o),subscription=createRemovableDisposable(this,so);this._trim(this.scheduler.now()),this.observers.push(so);for(var i=0,len=this.q.length;i<len;i++)so.onNext(this.q[i].value);return this.hasError?so.onError(this.error):this.isStopped&&so.onCompleted(),so.ensureActive(),subscription},hasObservers:function(){return checkDisposed(this),this.observers.length>0},_trim:function(now){for(;this.q.length>this.bufferSize;)this.q.shift();for(;this.q.length>0&&now-this.q[0].interval>this.windowSize;)this.q.shift()},onNext:function(value){if(checkDisposed(this),!this.isStopped){var now=this.scheduler.now();this.q.push({interval:now,value:value}),this._trim(now);for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){var observer=os[i];observer.onNext(value),observer.ensureActive()}}},onError:function(error){if(checkDisposed(this),!this.isStopped){this.isStopped=!0,this.error=error,this.hasError=!0;var now=this.scheduler.now();this._trim(now);for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){var observer=os[i];observer.onError(error),observer.ensureActive()}this.observers.length=0}},onCompleted:function(){if(checkDisposed(this),!this.isStopped){this.isStopped=!0;var now=this.scheduler.now();this._trim(now);for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){var observer=os[i];observer.onCompleted(),observer.ensureActive()}this.observers.length=0}},dispose:function(){this.isDisposed=!0,this.observers=null}}),ReplaySubject}(Observable),AnonymousSubject=Rx.AnonymousSubject=function(__super__){function AnonymousSubject(observer,observable){this.observer=observer,this.observable=observable,__super__.call(this)}return inherits(AnonymousSubject,__super__),addProperties(AnonymousSubject.prototype,Observer.prototype,{_subscribe:function(o){return this.observable.subscribe(o)},onCompleted:function(){this.observer.onCompleted()},onError:function(error){this.observer.onError(error)},onNext:function(value){this.observer.onNext(value)}}),AnonymousSubject}(Observable);Rx.Pauser=function(__super__){function Pauser(){__super__.call(this)}return inherits(Pauser,__super__),Pauser.prototype.pause=function(){this.onNext(!1)},Pauser.prototype.resume=function(){this.onNext(!0)},Pauser}(Subject),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(root.Rx=Rx,define(function(){return Rx})):freeExports&&freeModule?moduleExports?(freeModule.exports=Rx).Rx=Rx:freeExports.Rx=Rx:root.Rx=Rx;var rEndingLine=captureLine()}.call(this),function(global,factory){if("function"==typeof define&&define.amd)define("Imgix",["exports","md5","js-base64"],factory);else if("undefined"!=typeof exports)module.exports=factory(exports,require("md5"),require("js-base64").Base64);else{var mod={exports:{}};global.ImgixClient=factory(mod.exports,global.md5,global.Base64)}}(this,function(exports,_md5,_jsBase64){var md5=_md5,Base64=_jsBase64,VERSION="1.0.7",DEFAULTS={host:null,useHTTPS:!0,includeLibraryParam:!0};return function(){function ImgixClient(opts){var key,val;this.settings={};for(key in DEFAULTS)val=DEFAULTS[key],this.settings[key]=val;for(key in opts)val=opts[key],this.settings[key]=val;if(!this.settings.host)throw new Error("ImgixClient must be passed a valid host");this.settings.includeLibraryParam&&(this.settings.libraryParam="js-"+VERSION),this.settings.urlPrefix=this.settings.useHTTPS?"https://":"http://"}return ImgixClient.prototype.buildURL=function(path,params){path=this._sanitizePath(path),null==params&&(params={});var queryParams=this._buildParams(params);return this.settings.secureURLToken&&(queryParams=this._signParams(path,queryParams)),this.settings.urlPrefix+this.settings.host+path+queryParams},ImgixClient.prototype._sanitizePath=function(path){return path=path.replace(/^\//,""),"/"+(path=/^https?:\/\//.test(path)?encodeURIComponent(path):/^https?%3A%2F%2F/.test(path)?decodeURIComponent(encodeURIComponent(path)):decodeURI(encodeURI(path)))},ImgixClient.prototype._buildParams=function(params){this.settings.libraryParam&&(params.ixlib=this.settings.libraryParam);var key,val,encodedKey,encodedVal,queryParams=[];for(key in params)val=params[key],encodedKey=encodeURIComponent(key),encodedVal="64"===key.substr(-2)?Base64.encodeURI(val):encodeURIComponent(val),queryParams.push(encodedKey+"="+encodedVal);return queryParams[0]&&(queryParams[0]="?"+queryParams[0]),queryParams.join("&")},ImgixClient.prototype._signParams=function(path,queryParams){var signatureBase=this.settings.secureURLToken+path+queryParams,signature=md5(signatureBase);return queryParams=queryParams.length>0?queryParams+"&s="+signature:"?s="+signature},ImgixClient.VERSION=VERSION,ImgixClient}()}),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.Raven=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function RavenConfigError(message){this.name="RavenConfigError",this.message=message}RavenConfigError.prototype=new Error,RavenConfigError.prototype.constructor=RavenConfigError,module.exports=RavenConfigError},{}],2:[function(_dereq_,module,exports){var wrapMethod=function(console,level,callback){var originalConsoleLevel=console[level],originalConsole=console;if(level in console){var sentryLevel="warn"===level?"warning":level;console[level]=function(){var args=[].slice.call(arguments),msg=""+args.join(" "),data={level:sentryLevel,logger:"console",extra:{arguments:args}};"assert"===level?!1===args[0]&&(msg="Assertion failed: "+(args.slice(1).join(" ")||"console.assert"),data.extra.arguments=args.slice(1),callback&&callback(msg,data)):callback&&callback(msg,data),originalConsoleLevel&&Function.prototype.apply.call(originalConsoleLevel,originalConsole,args)}}};module.exports={wrapMethod:wrapMethod}},{}],3:[function(_dereq_,module,exports){(function(global){function now(){return+new Date}function keepOriginalCallback(original,callback){return isFunction(callback)?function(data){return callback(data,original)}:callback}function Raven(){this._hasJSON=!("object"!=typeof JSON||!JSON.stringify),this._hasDocument=!isUndefined(_document),this._hasNavigator=!isUndefined(_navigator),this._lastCapturedException=null,this._lastData=null,this._lastEventId=null,this._globalServer=null,this._globalKey=null,this._globalProject=null,this._globalContext={},this._globalOptions={release:_window.SENTRY_RELEASE&&_window.SENTRY_RELEASE.id,logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],headers:null,collectWindowErrors:!0,maxMessageLength:0,maxUrlLength:250,stackTraceLimit:50,autoBreadcrumbs:!0,instrument:!0,sampleRate:1},this._fetchDefaults={method:"POST",keepalive:!0,referrerPolicy:"origin"},this._ignoreOnError=0,this._isRavenInstalled=!1,this._originalErrorStackTraceLimit=Error.stackTraceLimit,this._originalConsole=_window.console||{},this._originalConsoleMethods={},this._plugins=[],this._startTime=now(),this._wrappedBuiltIns=[],this._breadcrumbs=[],this._lastCapturedEvent=null,this._keypressTimeout,this._location=_window.location,this._lastHref=this._location&&this._location.href,this._resetBackoff();for(var method in this._originalConsole)this._originalConsoleMethods[method]=this._originalConsole[method]}var TraceKit=_dereq_(6),stringify=_dereq_(7),RavenConfigError=_dereq_(1),utils=_dereq_(5),isError=utils.isError,isObject=utils.isObject,isErrorEvent=utils.isErrorEvent,isUndefined=utils.isUndefined,isFunction=utils.isFunction,isString=utils.isString,isArray=utils.isArray,isEmptyObject=utils.isEmptyObject,each=utils.each,objectMerge=utils.objectMerge,truncate=utils.truncate,objectFrozen=utils.objectFrozen,hasKey=utils.hasKey,joinRegExp=utils.joinRegExp,urlencode=utils.urlencode,uuid4=utils.uuid4,htmlTreeAsString=utils.htmlTreeAsString,isSameException=utils.isSameException,isSameStacktrace=utils.isSameStacktrace,parseUrl=utils.parseUrl,fill=utils.fill,supportsFetch=utils.supportsFetch,wrapConsoleMethod=_dereq_(2).wrapMethod,dsnKeys="source protocol user pass host port path".split(" "),dsnPattern=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/,_window="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{},_document=_window.document,_navigator=_window.navigator;Raven.prototype={VERSION:"3.22.1",debug:!1,TraceKit:TraceKit,config:function(dsn,options){var self=this;if(self._globalServer)return this._logDebug("error","Error: Raven has already been configured"),self;if(!dsn)return self;var globalOptions=self._globalOptions;options&&each(options,function(key,value){"tags"===key||"extra"===key||"user"===key?self._globalContext[key]=value:globalOptions[key]=value}),self.setDSN(dsn),globalOptions.ignoreErrors.push(/^Script error\.?$/),globalOptions.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),globalOptions.ignoreErrors=joinRegExp(globalOptions.ignoreErrors),globalOptions.ignoreUrls=!!globalOptions.ignoreUrls.length&&joinRegExp(globalOptions.ignoreUrls),globalOptions.whitelistUrls=!!globalOptions.whitelistUrls.length&&joinRegExp(globalOptions.whitelistUrls),globalOptions.includePaths=joinRegExp(globalOptions.includePaths),globalOptions.maxBreadcrumbs=Math.max(0,Math.min(globalOptions.maxBreadcrumbs||100,100));var autoBreadcrumbDefaults={xhr:!0,console:!0,dom:!0,location:!0,sentry:!0},autoBreadcrumbs=globalOptions.autoBreadcrumbs;"[object Object]"==={}.toString.call(autoBreadcrumbs)?autoBreadcrumbs=objectMerge(autoBreadcrumbDefaults,autoBreadcrumbs):!1!==autoBreadcrumbs&&(autoBreadcrumbs=autoBreadcrumbDefaults),globalOptions.autoBreadcrumbs=autoBreadcrumbs;var instrumentDefaults={tryCatch:!0},instrument=globalOptions.instrument;return"[object Object]"==={}.toString.call(instrument)?instrument=objectMerge(instrumentDefaults,instrument):!1!==instrument&&(instrument=instrumentDefaults),globalOptions.instrument=instrument,TraceKit.collectWindowErrors=!!globalOptions.collectWindowErrors,self},install:function(){var self=this;return self.isSetup()&&!self._isRavenInstalled&&(TraceKit.report.subscribe(function(){self._handleOnErrorStackInfo.apply(self,arguments)}),self._patchFunctionToString(),self._globalOptions.instrument&&self._globalOptions.instrument.tryCatch&&self._instrumentTryCatch(),self._globalOptions.autoBreadcrumbs&&self._instrumentBreadcrumbs(),self._drainPlugins(),self._isRavenInstalled=!0),Error.stackTraceLimit=self._globalOptions.stackTraceLimit,this},setDSN:function(dsn){var self=this,uri=self._parseDSN(dsn),lastSlash=uri.path.lastIndexOf("/"),path=uri.path.substr(1,lastSlash);self._dsn=dsn,self._globalKey=uri.user,self._globalSecret=uri.pass&&uri.pass.substr(1),self._globalProject=uri.path.substr(lastSlash+1),self._globalServer=self._getGlobalServer(uri),self._globalEndpoint=self._globalServer+"/"+path+"api/"+self._globalProject+"/store/",this._resetBackoff()},context:function(options,func,args){return isFunction(options)&&(args=func||[],func=options,options=void 0),this.wrap(options,func).apply(this,args)},wrap:function(options,func,_before){function wrapped(){var args=[],i=arguments.length,deep=!options||options&&!1!==options.deep;for(_before&&isFunction(_before)&&_before.apply(this,arguments);i--;)args[i]=deep?self.wrap(options,arguments[i]):arguments[i];try{return func.apply(this,args)}catch(e){throw self._ignoreNextOnError(),self.captureException(e,options),e}}var self=this;if(isUndefined(func)&&!isFunction(options))return options;if(isFunction(options)&&(func=options,options=void 0),!isFunction(func))return func;try{if(func.__raven__)return func;if(func.__raven_wrapper__)return func.__raven_wrapper__}catch(e){return func}for(var property in func)hasKey(func,property)&&(wrapped[property]=func[property]);return wrapped.prototype=func.prototype,func.__raven_wrapper__=wrapped,wrapped.__raven__=!0,wrapped.__orig__=func,wrapped},uninstall:function(){return TraceKit.report.uninstall(),this._unpatchFunctionToString(),this._restoreBuiltIns(),Error.stackTraceLimit=this._originalErrorStackTraceLimit,this._isRavenInstalled=!1,this},captureException:function(ex,options){var isNotError=!isError(ex),isNotErrorEvent=!isErrorEvent(ex),isErrorEventWithoutError=isErrorEvent(ex)&&!ex.error;if(isNotError&&isNotErrorEvent||isErrorEventWithoutError)return this.captureMessage(ex,objectMerge({trimHeadFrames:1,stacktrace:!0},options));isErrorEvent(ex)&&(ex=ex.error),this._lastCapturedException=ex;try{var stack=TraceKit.computeStackTrace(ex);this._handleStackInfo(stack,options)}catch(ex1){if(ex!==ex1)throw ex1}return this},captureMessage:function(msg,options){if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(msg)){options=options||{};var ex,data=objectMerge({message:msg+""},options);try{throw new Error(msg)}catch(ex1){ex=ex1}ex.name=null;var stack=TraceKit.computeStackTrace(ex),initialCall=isArray(stack.stack)&&stack.stack[1],fileurl=initialCall&&initialCall.url||"";if((!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(fileurl))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(fileurl))){if(this._globalOptions.stacktrace||options&&options.stacktrace){options=objectMerge({fingerprint:msg,trimHeadFrames:(options.trimHeadFrames||0)+1},options);var frames=this._prepareFrames(stack,options);data.stacktrace={frames:frames.reverse()}}return this._send(data),this}}},captureBreadcrumb:function(obj){var crumb=objectMerge({timestamp:now()/1e3},obj);if(isFunction(this._globalOptions.breadcrumbCallback)){var result=this._globalOptions.breadcrumbCallback(crumb);if(isObject(result)&&!isEmptyObject(result))crumb=result;else if(!1===result)return this}return this._breadcrumbs.push(crumb),this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs&&this._breadcrumbs.shift(),this},addPlugin:function(plugin){var pluginArgs=[].slice.call(arguments,1);return this._plugins.push([plugin,pluginArgs]),this._isRavenInstalled&&this._drainPlugins(),this},setUserContext:function(user){return this._globalContext.user=user,this},setExtraContext:function(extra){return this._mergeContext("extra",extra),this},setTagsContext:function(tags){return this._mergeContext("tags",tags),this},clearContext:function(){return this._globalContext={},this},getContext:function(){return JSON.parse(stringify(this._globalContext))},setEnvironment:function(environment){return this._globalOptions.environment=environment,this},setRelease:function(release){return this._globalOptions.release=release,this},setDataCallback:function(callback){var original=this._globalOptions.dataCallback;return this._globalOptions.dataCallback=keepOriginalCallback(original,callback),this},setBreadcrumbCallback:function(callback){var original=this._globalOptions.breadcrumbCallback;return this._globalOptions.breadcrumbCallback=keepOriginalCallback(original,callback),this},setShouldSendCallback:function(callback){var original=this._globalOptions.shouldSendCallback;return this._globalOptions.shouldSendCallback=keepOriginalCallback(original,callback),this},setTransport:function(transport){return this._globalOptions.transport=transport,this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){return!!this._hasJSON&&(!!this._globalServer||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this._logDebug("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var RavenConfig=_window.RavenConfig;RavenConfig&&this.config(RavenConfig.dsn,RavenConfig.config).install()},showReportDialog:function(options){if(_document){options=options||{};var lastEventId=options.eventId||this.lastEventId();if(!lastEventId)throw new RavenConfigError("Missing eventId");var dsn=options.dsn||this._dsn;if(!dsn)throw new RavenConfigError("Missing DSN");var encode=encodeURIComponent,qs="";qs+="?eventId="+encode(lastEventId),qs+="&dsn="+encode(dsn);var user=options.user||this._globalContext.user;user&&(user.name&&(qs+="&name="+encode(user.name)),user.email&&(qs+="&email="+encode(user.email)));var globalServer=this._getGlobalServer(this._parseDSN(dsn)),script=_document.createElement("script");script.async=!0,script.src=globalServer+"/api/embed/error-page/"+qs,(_document.head||_document.body).appendChild(script)}},_ignoreNextOnError:function(){var self=this;this._ignoreOnError+=1,setTimeout(function(){self._ignoreOnError-=1})},_triggerEvent:function(eventType,options){var evt,key;if(this._hasDocument){options=options||{},eventType="raven"+eventType.substr(0,1).toUpperCase()+eventType.substr(1),_document.createEvent?(evt=_document.createEvent("HTMLEvents"),evt.initEvent(eventType,!0,!0)):(evt=_document.createEventObject(),evt.eventType=eventType);for(key in options)hasKey(options,key)&&(evt[key]=options[key]);if(_document.createEvent)_document.dispatchEvent(evt);else try{_document.fireEvent("on"+evt.eventType.toLowerCase(),evt)}catch(e){}}},_breadcrumbEventHandler:function(evtName){var self=this;return function(evt){if(self._keypressTimeout=null,self._lastCapturedEvent!==evt){self._lastCapturedEvent=evt;var target;try{target=htmlTreeAsString(evt.target)}catch(e){target="<unknown>"}self.captureBreadcrumb({category:"ui."+evtName,message:target})}}},_keypressEventHandler:function(){var self=this;return function(evt){var target;try{target=evt.target}catch(e){return}var tagName=target&&target.tagName;if(tagName&&("INPUT"===tagName||"TEXTAREA"===tagName||target.isContentEditable)){var timeout=self._keypressTimeout;timeout||self._breadcrumbEventHandler("input")(evt),clearTimeout(timeout),self._keypressTimeout=setTimeout(function(){self._keypressTimeout=null},1e3)}}},_captureUrlChange:function(from,to){var parsedLoc=parseUrl(this._location.href),parsedTo=parseUrl(to),parsedFrom=parseUrl(from);this._lastHref=to,parsedLoc.protocol===parsedTo.protocol&&parsedLoc.host===parsedTo.host&&(to=parsedTo.relative),parsedLoc.protocol===parsedFrom.protocol&&parsedLoc.host===parsedFrom.host&&(from=parsedFrom.relative),this.captureBreadcrumb({category:"navigation",data:{to:to,from:from}})},_patchFunctionToString:function(){var self=this;self._originalFunctionToString=Function.prototype.toString,Function.prototype.toString=function(){return"function"==typeof this&&this.__raven__?self._originalFunctionToString.apply(this.__orig__,arguments):self._originalFunctionToString.apply(this,arguments)}},_unpatchFunctionToString:function(){this._originalFunctionToString&&(Function.prototype.toString=this._originalFunctionToString)},_instrumentTryCatch:function(){function wrapTimeFn(orig){return function(fn,t){for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];var originalCallback=args[0];return isFunction(originalCallback)&&(args[0]=self.wrap(originalCallback)),orig.apply?orig.apply(this,args):orig(args[0],args[1])}}var self=this,wrappedBuiltIns=self._wrappedBuiltIns,autoBreadcrumbs=this._globalOptions.autoBreadcrumbs;fill(_window,"setTimeout",wrapTimeFn,wrappedBuiltIns),fill(_window,"setInterval",wrapTimeFn,wrappedBuiltIns),_window.requestAnimationFrame&&fill(_window,"requestAnimationFrame",function(orig){return function(cb){return orig(self.wrap(cb))}},wrappedBuiltIns);for(var eventTargets=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],i=0;i<eventTargets.length;i++)!function(global){var proto=_window[global]&&_window[global].prototype;proto&&proto.hasOwnProperty&&proto.hasOwnProperty("addEventListener")&&(fill(proto,"addEventListener",function(orig){return function(evtName,fn,capture,secure){try{fn&&fn.handleEvent&&(fn.handleEvent=self.wrap(fn.handleEvent))}catch(err){}var before,clickHandler,keypressHandler;return autoBreadcrumbs&&autoBreadcrumbs.dom&&("EventTarget"===global||"Node"===global)&&(clickHandler=self._breadcrumbEventHandler("click"),keypressHandler=self._keypressEventHandler(),before=function(evt){if(evt){var eventType;try{eventType=evt.type}catch(e){return}return"click"===eventType?clickHandler(evt):"keypress"===eventType?keypressHandler(evt):void 0}}),orig.call(this,evtName,self.wrap(fn,void 0,before),capture,secure)}},wrappedBuiltIns),fill(proto,"removeEventListener",function(orig){return function(evt,fn,capture,secure){try{fn=fn&&(fn.__raven_wrapper__?fn.__raven_wrapper__:fn)}catch(e){}return orig.call(this,evt,fn,capture,secure)}},wrappedBuiltIns))}(eventTargets[i])},_instrumentBreadcrumbs:function(){function wrapProp(prop,xhr){prop in xhr&&isFunction(xhr[prop])&&fill(xhr,prop,function(orig){return self.wrap(orig)})}var self=this,autoBreadcrumbs=this._globalOptions.autoBreadcrumbs,wrappedBuiltIns=self._wrappedBuiltIns;if(autoBreadcrumbs.xhr&&"XMLHttpRequest"in _window){var xhrproto=XMLHttpRequest.prototype;fill(xhrproto,"open",function(origOpen){return function(method,url){return isString(url)&&-1===url.indexOf(self._globalKey)&&(this.__raven_xhr={method:method,url:url,status_code:null}),origOpen.apply(this,arguments)}},wrappedBuiltIns),fill(xhrproto,"send",function(origSend){return function(){function onreadystatechangeHandler(){if(xhr.__raven_xhr&&4===xhr.readyState){try{xhr.__raven_xhr.status_code=xhr.status}catch(e){}self.captureBreadcrumb({type:"http",category:"xhr",data:xhr.__raven_xhr})}}for(var xhr=this,props=["onload","onerror","onprogress"],j=0;j<props.length;j++)wrapProp(props[j],xhr);return"onreadystatechange"in xhr&&isFunction(xhr.onreadystatechange)?fill(xhr,"onreadystatechange",function(orig){return self.wrap(orig,void 0,onreadystatechangeHandler)}):xhr.onreadystatechange=onreadystatechangeHandler,origSend.apply(this,arguments)}},wrappedBuiltIns)}autoBreadcrumbs.xhr&&supportsFetch()&&fill(_window,"fetch",function(origFetch){return function(){for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];var url,fetchInput=args[0],method="GET";if("string"==typeof fetchInput?url=fetchInput:"Request"in _window&&fetchInput instanceof _window.Request?(url=fetchInput.url,fetchInput.method&&(method=fetchInput.method)):url=""+fetchInput,-1!==url.indexOf(self._globalKey))return origFetch.apply(this,args);args[1]&&args[1].method&&(method=args[1].method);var fetchData={method:method,url:url,status_code:null};return origFetch.apply(this,args).then(function(response){return fetchData.status_code=response.status,self.captureBreadcrumb({type:"http",category:"fetch",data:fetchData}),response})}},wrappedBuiltIns),autoBreadcrumbs.dom&&this._hasDocument&&(_document.addEventListener?(_document.addEventListener("click",self._breadcrumbEventHandler("click"),!1),_document.addEventListener("keypress",self._keypressEventHandler(),!1)):(_document.attachEvent("onclick",self._breadcrumbEventHandler("click")),_document.attachEvent("onkeypress",self._keypressEventHandler())));var chrome=_window.chrome,isChromePackagedApp=chrome&&chrome.app&&chrome.app.runtime,hasPushAndReplaceState=!isChromePackagedApp&&_window.history&&history.pushState&&history.replaceState;if(autoBreadcrumbs.location&&hasPushAndReplaceState){var oldOnPopState=_window.onpopstate;_window.onpopstate=function(){var currentHref=self._location.href;if(self._captureUrlChange(self._lastHref,currentHref),oldOnPopState)return oldOnPopState.apply(this,arguments)};var historyReplacementFunction=function(origHistFunction){return function(){var url=arguments.length>2?arguments[2]:void 0;return url&&self._captureUrlChange(self._lastHref,url+""),origHistFunction.apply(this,arguments)}};fill(history,"pushState",historyReplacementFunction,wrappedBuiltIns),fill(history,"replaceState",historyReplacementFunction,wrappedBuiltIns)}if(autoBreadcrumbs.console&&"console"in _window&&console.log){var consoleMethodCallback=function(msg,data){self.captureBreadcrumb({message:msg,level:data.level,category:"console"})};each(["debug","info","warn","error","log"],function(_,level){wrapConsoleMethod(console,level,consoleMethodCallback)})}},_restoreBuiltIns:function(){for(var builtin;this._wrappedBuiltIns.length;){builtin=this._wrappedBuiltIns.shift();var obj=builtin[0],name=builtin[1],orig=builtin[2];obj[name]=orig}},_drainPlugins:function(){var self=this;each(this._plugins,function(_,plugin){var installer=plugin[0],args=plugin[1];installer.apply(self,[self].concat(args))})},_parseDSN:function(str){var m=dsnPattern.exec(str),dsn={},i=7;try{for(;i--;)dsn[dsnKeys[i]]=m[i]||""}catch(e){throw new RavenConfigError("Invalid DSN: "+str)}if(dsn.pass&&!this._globalOptions.allowSecretKey)throw new RavenConfigError("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return dsn},_getGlobalServer:function(uri){var globalServer="//"+uri.host+(uri.port?":"+uri.port:"");return uri.protocol&&(globalServer=uri.protocol+":"+globalServer),globalServer},_handleOnErrorStackInfo:function(){this._ignoreOnError||this._handleStackInfo.apply(this,arguments)},_handleStackInfo:function(stackInfo,options){var frames=this._prepareFrames(stackInfo,options);this._triggerEvent("handle",{stackInfo:stackInfo,options:options}),this._processException(stackInfo.name,stackInfo.message,stackInfo.url,stackInfo.lineno,frames,options)},_prepareFrames:function(stackInfo,options){var self=this,frames=[];if(stackInfo.stack&&stackInfo.stack.length&&(each(stackInfo.stack,function(i,stack){var frame=self._normalizeFrame(stack,stackInfo.url);frame&&frames.push(frame)}),options&&options.trimHeadFrames))for(var j=0;j<options.trimHeadFrames&&j<frames.length;j++)frames[j].in_app=!1;return frames=frames.slice(0,this._globalOptions.stackTraceLimit)},_normalizeFrame:function(frame,stackInfoUrl){var normalized={filename:frame.url,lineno:frame.line,colno:frame.column,function:frame.func||"?"};return frame.url||(normalized.filename=stackInfoUrl),normalized.in_app=!(this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(normalized.filename)||/(Raven|TraceKit)\./.test(normalized.function)||/raven\.(min\.)?js$/.test(normalized.filename)),normalized},_processException:function(type,message,fileurl,lineno,frames,options){var prefixedMessage=(type?type+": ":"")+(message||"");if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(message)&&!this._globalOptions.ignoreErrors.test(prefixedMessage)){var stacktrace;if(frames&&frames.length?(fileurl=frames[0].filename||fileurl,frames.reverse(),stacktrace={frames:frames}):fileurl&&(stacktrace={frames:[{filename:fileurl,lineno:lineno,in_app:!0}]}),(!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(fileurl))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(fileurl))){var data=objectMerge({exception:{values:[{type:type,value:message,stacktrace:stacktrace}]},culprit:fileurl},options);this._send(data)}}},_trimPacket:function(data){var max=this._globalOptions.maxMessageLength;if(data.message&&(data.message=truncate(data.message,max)),data.exception){var exception=data.exception.values[0];exception.value=truncate(exception.value,max)}var request=data.request;return request&&(request.url&&(request.url=truncate(request.url,this._globalOptions.maxUrlLength)),request.Referer&&(request.Referer=truncate(request.Referer,this._globalOptions.maxUrlLength))),data.breadcrumbs&&data.breadcrumbs.values&&this._trimBreadcrumbs(data.breadcrumbs),data},_trimBreadcrumbs:function(breadcrumbs){for(var urlProp,crumb,data,urlProps=["to","from","url"],i=0;i<breadcrumbs.values.length;++i)if(crumb=breadcrumbs.values[i],crumb.hasOwnProperty("data")&&isObject(crumb.data)&&!objectFrozen(crumb.data)){data=objectMerge({},crumb.data);for(var j=0;j<urlProps.length;++j)urlProp=urlProps[j],data.hasOwnProperty(urlProp)&&data[urlProp]&&(data[urlProp]=truncate(data[urlProp],this._globalOptions.maxUrlLength));breadcrumbs.values[i].data=data}},_getHttpData:function(){if(this._hasNavigator||this._hasDocument){var httpData={};return this._hasNavigator&&_navigator.userAgent&&(httpData.headers={"User-Agent":navigator.userAgent}),_window.location&&_window.location.href&&(httpData.url=_window.location.href),this._hasDocument&&_document.referrer&&(httpData.headers||(httpData.headers={}),httpData.headers.Referer=_document.referrer),httpData}},_resetBackoff:function(){this._backoffDuration=0,this._backoffStart=null},_shouldBackoff:function(){return this._backoffDuration&&now()-this._backoffStart<this._backoffDuration},_isRepeatData:function(current){var last=this._lastData;return!(!last||current.message!==last.message||current.culprit!==last.culprit)&&(current.stacktrace||last.stacktrace?isSameStacktrace(current.stacktrace,last.stacktrace):!current.exception&&!last.exception||isSameException(current.exception,last.exception))},_setBackoffState:function(request){if(!this._shouldBackoff()){var status=request.status;if(400===status||401===status||429===status){var retry;try{retry=supportsFetch()?request.headers.get("Retry-After"):request.getResponseHeader("Retry-After"),retry=1e3*parseInt(retry,10)}catch(e){}this._backoffDuration=retry||(2*this._backoffDuration||1e3),this._backoffStart=now()}}},_send:function(data){var globalOptions=this._globalOptions,baseData={project:this._globalProject,logger:globalOptions.logger,platform:"javascript"},httpData=this._getHttpData();if(httpData&&(baseData.request=httpData),data.trimHeadFrames&&delete data.trimHeadFrames,data=objectMerge(baseData,data),data.tags=objectMerge(objectMerge({},this._globalContext.tags),data.tags),data.extra=objectMerge(objectMerge({},this._globalContext.extra),data.extra),data.extra["session:duration"]=now()-this._startTime,this._breadcrumbs&&this._breadcrumbs.length>0&&(data.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}),this._globalContext.user&&(data.user=this._globalContext.user),globalOptions.environment&&(data.environment=globalOptions.environment),globalOptions.release&&(data.release=globalOptions.release),globalOptions.serverName&&(data.server_name=globalOptions.serverName),Object.keys(data).forEach(function(key){(null==data[key]||""===data[key]||isEmptyObject(data[key]))&&delete data[key]}),isFunction(globalOptions.dataCallback)&&(data=globalOptions.dataCallback(data)||data),data&&!isEmptyObject(data)&&(!isFunction(globalOptions.shouldSendCallback)||globalOptions.shouldSendCallback(data)))return this._shouldBackoff()?void this._logDebug("warn","Raven dropped error due to backoff: ",data):void("number"==typeof globalOptions.sampleRate?Math.random()<globalOptions.sampleRate&&this._sendProcessedPayload(data):this._sendProcessedPayload(data))},_getUuid:function(){return uuid4()},_sendProcessedPayload:function(data,callback){var self=this,globalOptions=this._globalOptions;if(this.isSetup()){if(data=this._trimPacket(data),!this._globalOptions.allowDuplicates&&this._isRepeatData(data))return void this._logDebug("warn","Raven dropped repeat event: ",data);this._lastEventId=data.event_id||(data.event_id=this._getUuid()),this._lastData=data,this._logDebug("debug","Raven about to send:",data);var auth={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey};this._globalSecret&&(auth.sentry_secret=this._globalSecret);var exception=data.exception&&data.exception.values[0];this._globalOptions.autoBreadcrumbs&&this._globalOptions.autoBreadcrumbs.sentry&&this.captureBreadcrumb({category:"sentry",message:exception?(exception.type?exception.type+": ":"")+exception.value:data.message,event_id:data.event_id,level:data.level||"error"});var url=this._globalEndpoint;(globalOptions.transport||this._makeRequest).call(this,{url:url,auth:auth,data:data,options:globalOptions,onSuccess:function(){self._resetBackoff(),self._triggerEvent("success",{data:data,src:url}),callback&&callback()},onError:function(error){self._logDebug("error","Raven transport failed to send: ",error),error.request&&self._setBackoffState(error.request),self._triggerEvent("failure",{data:data,src:url}),error=error||new Error("Raven send failed (no additional details provided)"),callback&&callback(error)}})}},_makeRequest:function(opts){var url=opts.url+"?"+urlencode(opts.auth),evaluatedHeaders=null,evaluatedFetchParameters={};if(opts.options.headers&&(evaluatedHeaders=this._evaluateHash(opts.options.headers)),opts.options.fetchParameters&&(evaluatedFetchParameters=this._evaluateHash(opts.options.fetchParameters)),supportsFetch()){evaluatedFetchParameters.body=stringify(opts.data);var defaultFetchOptions=objectMerge({},this._fetchDefaults),fetchOptions=objectMerge(defaultFetchOptions,evaluatedFetchParameters);return evaluatedHeaders&&(fetchOptions.headers=evaluatedHeaders),_window.fetch(url,fetchOptions).then(function(response){if(response.ok)opts.onSuccess&&opts.onSuccess();else{var error=new Error("Sentry error code: "+response.status);error.request=response,opts.onError&&opts.onError(error)}}).catch(function(){opts.onError&&opts.onError(new Error("Sentry error code: network unavailable"))})}var request=_window.XMLHttpRequest&&new _window.XMLHttpRequest;if(request){("withCredentials"in request||"undefined"!=typeof XDomainRequest)&&("withCredentials"in request?request.onreadystatechange=function(){if(4===request.readyState)if(200===request.status)opts.onSuccess&&opts.onSuccess();else if(opts.onError){var err=new Error("Sentry error code: "+request.status);err.request=request,opts.onError(err)}}:(request=new XDomainRequest,url=url.replace(/^https?:/,""),opts.onSuccess&&(request.onload=opts.onSuccess),opts.onError&&(request.onerror=function(){var err=new Error("Sentry error code: XDomainRequest");err.request=request,opts.onError(err)})),request.open("POST",url),evaluatedHeaders&&each(evaluatedHeaders,function(key,value){request.setRequestHeader(key,value)}),request.send(stringify(opts.data)))}},_evaluateHash:function(hash){var evaluated={};for(var key in hash)if(hash.hasOwnProperty(key)){var value=hash[key];evaluated[key]="function"==typeof value?value():value}return evaluated},_logDebug:function(level){this._originalConsoleMethods[level]&&this.debug&&Function.prototype.apply.call(this._originalConsoleMethods[level],this._originalConsole,[].slice.call(arguments,1))},_mergeContext:function(key,context){isUndefined(context)?delete this._globalContext[key]:this._globalContext[key]=objectMerge(this._globalContext[key]||{},context)}},Raven.prototype.setUser=Raven.prototype.setUserContext,Raven.prototype.setReleaseContext=Raven.prototype.setRelease,module.exports=Raven}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,2:2,5:5,6:6,7:7}],4:[function(_dereq_,module,exports){(function(global){var RavenConstructor=_dereq_(3),_window="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{},_Raven=_window.Raven,Raven=new RavenConstructor;Raven.noConflict=function(){return _window.Raven=_Raven,Raven},Raven.afterLoad(),module.exports=Raven}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{3:3}],5:[function(_dereq_,module,exports){(function(global){function isObject(what){return"object"==typeof what&&null!==what}function isError(value){switch({}.toString.call(value)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return value instanceof Error}}function isErrorEvent(value){return supportsErrorEvent()&&"[object ErrorEvent]"==={}.toString.call(value)}function isUndefined(what){return void 0===what}function isFunction(what){return"function"==typeof what}function isPlainObject(what){return"[object Object]"===Object.prototype.toString.call(what)}function isString(what){return"[object String]"===Object.prototype.toString.call(what)}function isArray(what){return"[object Array]"===Object.prototype.toString.call(what)}function isEmptyObject(what){if(!isPlainObject(what))return!1;for(var _ in what)if(what.hasOwnProperty(_))return!1;return!0}function supportsErrorEvent(){try{return new ErrorEvent(""),!0}catch(e){return!1}}function supportsFetch(){if(!("fetch"in _window))return!1;try{return new Headers,new Request(""),new Response,!0}catch(e){return!1}}function wrappedCallback(callback){function dataCallback(data,original){var normalizedData=callback(data)||data;return original?original(normalizedData)||normalizedData:normalizedData}return dataCallback}function each(obj,callback){var i,j;if(isUndefined(obj.length))for(i in obj)hasKey(obj,i)&&callback.call(null,i,obj[i]);else if(j=obj.length)for(i=0;i<j;i++)callback.call(null,i,obj[i])}function objectMerge(obj1,obj2){return obj2?(each(obj2,function(key,value){obj1[key]=value}),obj1):obj1}function objectFrozen(obj){return!!Object.isFrozen&&Object.isFrozen(obj)}function truncate(str,max){return!max||str.length<=max?str:str.substr(0,max)+""}function hasKey(object,key){return Object.prototype.hasOwnProperty.call(object,key)}function joinRegExp(patterns){for(var pattern,sources=[],i=0,len=patterns.length;i<len;i++)pattern=patterns[i],isString(pattern)?sources.push(pattern.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):pattern&&pattern.source&&sources.push(pattern.source);return new RegExp(sources.join("|"),"i")}function urlencode(o){var pairs=[];return each(o,function(key,value){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}),pairs.join("&")}function parseUrl(url){if("string"!=typeof url)return{};var match=url.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/),query=match[6]||"",fragment=match[8]||"";return{protocol:match[2],host:match[4],path:match[5],relative:match[5]+query+fragment}}function uuid4(){var crypto=_window.crypto||_window.msCrypto;if(!isUndefined(crypto)&&crypto.getRandomValues){var arr=new Uint16Array(8);crypto.getRandomValues(arr),arr[3]=4095&arr[3]|16384,arr[4]=16383&arr[4]|32768;var pad=function(num){for(var v=num.toString(16);v.length<4;)v="0"+v;return v};return pad(arr[0])+pad(arr[1])+pad(arr[2])+pad(arr[3])+pad(arr[4])+pad(arr[5])+pad(arr[6])+pad(arr[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)})}function htmlTreeAsString(elem){for(var nextStr,out=[],height=0,len=0,sepLength=" > ".length;elem&&height++<5&&!("html"===(nextStr=htmlElementAsString(elem))||height>1&&len+out.length*sepLength+nextStr.length>=80);)out.push(nextStr),len+=nextStr.length,elem=elem.parentNode;return out.reverse().join(" > ")}function htmlElementAsString(elem){var className,classes,key,attr,i,out=[];if(!elem||!elem.tagName)return"";if(out.push(elem.tagName.toLowerCase()),elem.id&&out.push("#"+elem.id),(className=elem.className)&&isString(className))for(classes=className.split(/\s+/),i=0;i<classes.length;i++)out.push("."+classes[i]);var attrWhitelist=["type","name","title","alt"];for(i=0;i<attrWhitelist.length;i++)key=attrWhitelist[i],(attr=elem.getAttribute(key))&&out.push("["+key+'="'+attr+'"]');return out.join("")}function isOnlyOneTruthy(a,b){return!!(!!a^!!b)}function isBothUndefined(a,b){return isUndefined(a)&&isUndefined(b)}function isSameException(ex1,ex2){return!isOnlyOneTruthy(ex1,ex2)&&(ex1=ex1.values[0],ex2=ex2.values[0],ex1.type===ex2.type&&ex1.value===ex2.value&&(!isBothUndefined(ex1.stacktrace,ex2.stacktrace)&&isSameStacktrace(ex1.stacktrace,ex2.stacktrace)))}function isSameStacktrace(stack1,stack2){if(isOnlyOneTruthy(stack1,stack2))return!1;var frames1=stack1.frames,frames2=stack2.frames;if(frames1.length!==frames2.length)return!1;for(var a,b,i=0;i<frames1.length;i++)if(a=frames1[i],b=frames2[i],a.filename!==b.filename||a.lineno!==b.lineno||a.colno!==b.colno||a.function!==b.function)return!1;return!0}function fill(obj,name,replacement,track){var orig=obj[name];obj[name]=replacement(orig),obj[name].__raven__=!0,obj[name].__orig__=orig,track&&track.push([obj,name,orig])}var _window="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};module.exports={isObject:isObject,isError:isError,isErrorEvent:isErrorEvent,isUndefined:isUndefined,isFunction:isFunction,isPlainObject:isPlainObject,isString:isString,isArray:isArray,isEmptyObject:isEmptyObject,supportsErrorEvent:supportsErrorEvent,supportsFetch:supportsFetch,wrappedCallback:wrappedCallback,each:each,objectMerge:objectMerge,truncate:truncate,objectFrozen:objectFrozen,hasKey:hasKey,joinRegExp:joinRegExp,urlencode:urlencode,uuid4:uuid4,htmlTreeAsString:htmlTreeAsString,htmlElementAsString:htmlElementAsString,isSameException:isSameException,isSameStacktrace:isSameStacktrace,parseUrl:parseUrl,fill:fill}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(_dereq_,module,exports){(function(global){function getLocationHref(){return"undefined"==typeof document||null==document.location?"":document.location.href}var utils=_dereq_(5),TraceKit={collectWindowErrors:!0,debug:!1},_window="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{},_slice=[].slice,UNKNOWN_FUNCTION="?",ERROR_TYPES_RE=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;TraceKit.report=function(){function subscribe(handler){installGlobalHandler(),handlers.push(handler)}function unsubscribe(handler){for(var i=handlers.length-1;i>=0;--i)handlers[i]===handler&&handlers.splice(i,1)}function unsubscribeAll(){uninstallGlobalHandler(),handlers=[]}function notifyHandlers(stack,isWindowError){var exception=null;if(!isWindowError||TraceKit.collectWindowErrors){for(var i in handlers)if(handlers.hasOwnProperty(i))try{handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))}catch(inner){exception=inner}if(exception)throw exception}}function traceKitWindowOnError(msg,url,lineNo,colNo,ex){var stack=null,exception=utils.isErrorEvent(ex)?ex.error:ex,message=utils.isErrorEvent(msg)?msg.message:msg;if(lastExceptionStack)TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message),processLastException();else if(exception&&utils.isError(exception))stack=TraceKit.computeStackTrace(exception),notifyHandlers(stack,!0);else{var groups,location={url:url,line:lineNo,column:colNo},name=void 0;if("[object String]"==={}.toString.call(message)){var groups=message.match(ERROR_TYPES_RE);groups&&(name=groups[1],message=groups[2])}location.func=UNKNOWN_FUNCTION,stack={name:name,message:message,url:getLocationHref(),stack:[location]},notifyHandlers(stack,!0)}return!!_oldOnerrorHandler&&_oldOnerrorHandler.apply(this,arguments)}function installGlobalHandler(){_onErrorHandlerInstalled||(_oldOnerrorHandler=_window.onerror,_window.onerror=traceKitWindowOnError,_onErrorHandlerInstalled=!0)}function uninstallGlobalHandler(){_onErrorHandlerInstalled&&(_window.onerror=_oldOnerrorHandler,_onErrorHandlerInstalled=!1,_oldOnerrorHandler=void 0)}function processLastException(){var _lastExceptionStack=lastExceptionStack,_lastArgs=lastArgs;lastArgs=null,lastExceptionStack=null,lastException=null,notifyHandlers.apply(null,[_lastExceptionStack,!1].concat(_lastArgs))}function report(ex,rethrow){var args=_slice.call(arguments,1);if(lastExceptionStack){if(lastException===ex)return;processLastException()}var stack=TraceKit.computeStackTrace(ex);if(lastExceptionStack=stack,lastException=ex,lastArgs=args,setTimeout(function(){lastException===ex&&processLastException()},stack.incomplete?2e3:0),!1!==rethrow)throw ex}var _oldOnerrorHandler,_onErrorHandlerInstalled,handlers=[],lastArgs=null,lastException=null,lastExceptionStack=null;return report.subscribe=subscribe,report.unsubscribe=unsubscribe,report.uninstall=unsubscribeAll,report}(),TraceKit.computeStackTrace=function(){function computeStackTraceFromStackProp(ex){if(void 0!==ex.stack&&ex.stack){for(var submatch,parts,element,chrome=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,gecko=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,winjs=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx(?:-web)|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,geckoEval=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,chromeEval=/\((\S*)(?::(\d+))(?::(\d+))\)/,lines=ex.stack.split("\n"),stack=[],i=(/^(.*) is undefined$/.exec(ex.message),0),j=lines.length;i<j;++i){if(parts=chrome.exec(lines[i])){var isNative=parts[2]&&0===parts[2].indexOf("native"),isEval=parts[2]&&0===parts[2].indexOf("eval");isEval&&(submatch=chromeEval.exec(parts[2]))&&(parts[2]=submatch[1],parts[3]=submatch[2],parts[4]=submatch[3]),element={url:isNative?null:parts[2],func:parts[1]||UNKNOWN_FUNCTION,args:isNative?[parts[2]]:[],line:parts[3]?+parts[3]:null,column:parts[4]?+parts[4]:null}}else if(parts=winjs.exec(lines[i]))element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,args:[],line:+parts[3],column:parts[4]?+parts[4]:null};else{if(!(parts=gecko.exec(lines[i])))continue;var isEval=parts[3]&&parts[3].indexOf(" > eval")>-1;isEval&&(submatch=geckoEval.exec(parts[3]))?(parts[3]=submatch[1],parts[4]=submatch[2],parts[5]=null):0!==i||parts[5]||void 0===ex.columnNumber||(stack[0].column=ex.columnNumber+1),element={url:parts[3],func:parts[1]||UNKNOWN_FUNCTION,args:parts[2]?parts[2].split(","):[],line:parts[4]?+parts[4]:null,column:parts[5]?+parts[5]:null}}!element.func&&element.line&&(element.func=UNKNOWN_FUNCTION),stack.push(element)}return stack.length?{name:ex.name,message:ex.message,url:getLocationHref(),stack:stack}:null}}function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={url:url,line:lineNo};if(initial.url&&initial.line){if(stackInfo.incomplete=!1,initial.func||(initial.func=UNKNOWN_FUNCTION),stackInfo.stack.length>0&&stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line)return!1;if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func)return stackInfo.stack[0].line=initial.line,!1}return stackInfo.stack.unshift(initial),stackInfo.partial=!0,!0}return stackInfo.incomplete=!0,!1}function computeStackTraceByWalkingCallerChain(ex,depth){for(var parts,item,functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=!1,curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller)if(curr!==computeStackTrace&&curr!==TraceKit.report){if(item={url:null,func:UNKNOWN_FUNCTION,line:null,column:null},curr.name?item.func=curr.name:(parts=functionName.exec(curr.toString()))&&(item.func=parts[1]),void 0===item.func)try{item.func=parts.input.substring(0,parts.input.indexOf("{"))}catch(e){}funcs[""+curr]?recursion=!0:funcs[""+curr]=!0,stack.push(item)}depth&&stack.splice(0,depth);var result={name:ex.name,message:ex.message,url:getLocationHref(),stack:stack};return augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description),result}function computeStackTrace(ex,depth){var stack=null;depth=null==depth?0:+depth;try{if(stack=computeStackTraceFromStackProp(ex))return stack}catch(e){if(TraceKit.debug)throw e}try{if(stack=computeStackTraceByWalkingCallerChain(ex,depth+1))return stack}catch(e){if(TraceKit.debug)throw e}return{name:ex.name,message:ex.message,url:getLocationHref()}}return computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement,computeStackTrace.computeStackTraceFromStackProp=computeStackTraceFromStackProp,computeStackTrace}(),module.exports=TraceKit}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{5:5}],7:[function(_dereq_,module,exports){function indexOf(haystack,needle){for(var i=0;i<haystack.length;++i)if(haystack[i]===needle)return i;return-1}function stringify(obj,replacer,spaces,cycleReplacer){return JSON.stringify(obj,serializer(replacer,cycleReplacer),spaces)}function stringifyError(value){var err={stack:value.stack,message:value.message,name:value.name};for(var i in value)Object.prototype.hasOwnProperty.call(value,i)&&(err[i]=value[i]);return err}function serializer(replacer,cycleReplacer){var stack=[],keys=[];return null==cycleReplacer&&(cycleReplacer=function(key,value){return stack[0]===value?"[Circular ~]":"[Circular ~."+keys.slice(0,indexOf(stack,value)).join(".")+"]"}),function(key,value){if(stack.length>0){var thisPos=indexOf(stack,this);~thisPos?stack.splice(thisPos+1):stack.push(this),~thisPos?keys.splice(thisPos,1/0,key):keys.push(key),~indexOf(stack,value)&&(value=cycleReplacer.call(this,key,value))}else stack.push(value);return null==replacer?value instanceof Error?stringifyError(value):value:replacer.call(this,key,value)}}exports=module.exports=stringify,exports.getSerialize=serializer},{}]},{},[4])(4)}),function(doc,win){function seppuku(){init=add=rebuild=pause=stop=kill=noop}function mergeObjects(targetObj,sourceObject){for(var key in sourceObject)sourceObject.hasOwnProperty(key)&&(targetObj[key]=sourceObject[key])}function parseNumeric(val){return parseFloat(val)||0}function updateScrollPos(){scroll={top:win.pageYOffset,left:win.pageXOffset}}function onScroll(){if(win.pageXOffset!=scroll.left)return updateScrollPos(),void rebuild();win.pageYOffset!=scroll.top&&(updateScrollPos(),recalcAllPos())}function onWheel(event){setTimeout(function(){win.pageYOffset!=scroll.top&&(scroll.top=win.pageYOffset,recalcAllPos())},0)}function recalcAllPos(){for(var i=watchArray.length-1;i>=0;i--)recalcElementPos(watchArray[i])}function recalcElementPos(el){if(el.inited){var currentMode=scroll.top<=el.limit.start?0:scroll.top>=el.limit.end?2:1;el.mode!=currentMode&&switchElementMode(el,currentMode)}}function fastCheck(){for(var i=watchArray.length-1;i>=0;i--)if(watchArray[i].inited){var deltaTop=Math.abs(getDocOffsetTop(watchArray[i].clone)-watchArray[i].docOffsetTop),deltaHeight=Math.abs(watchArray[i].parent.node.offsetHeight-watchArray[i].parent.height);if(deltaTop>=2||deltaHeight>=2)return!1}return!0}function initElement(el){isNaN(parseFloat(el.computed.top))||el.isCell||"none"==el.computed.display||(el.inited=!0,el.clone||clone(el),"absolute"!=el.parent.computed.position&&"relative"!=el.parent.computed.position&&(el.parent.node.style.position="relative"),recalcElementPos(el),el.parent.height=el.parent.node.offsetHeight,el.docOffsetTop=getDocOffsetTop(el.clone))}function deinitElement(el){var deinitParent=!0;el.clone&&killClone(el),mergeObjects(el.node.style,el.css);for(var i=watchArray.length-1;i>=0;i--)if(watchArray[i].node!==el.node&&watchArray[i].parent.node===el.parent.node){deinitParent=!1;break}deinitParent&&(el.parent.node.style.position=el.parent.css.position),el.mode=-1}function initAll(){for(var i=watchArray.length-1;i>=0;i--)initElement(watchArray[i])}function deinitAll(){for(var i=watchArray.length-1;i>=0;i--)deinitElement(watchArray[i])}function switchElementMode(el,mode){var nodeStyle=el.node.style;switch(mode){case 0:nodeStyle.position="absolute",nodeStyle.left=el.offset.left+"px",nodeStyle.right=el.offset.right+"px",nodeStyle.top=el.offset.top+"px",nodeStyle.bottom="auto",nodeStyle.width="auto",nodeStyle.marginLeft=0,nodeStyle.marginRight=0,nodeStyle.marginTop=0;break;case 1:nodeStyle.position="fixed",nodeStyle.left=el.box.left+"px",nodeStyle.right=el.box.right+"px",nodeStyle.top=el.css.top,nodeStyle.bottom="auto",nodeStyle.width="auto",nodeStyle.marginLeft=0,nodeStyle.marginRight=0,nodeStyle.marginTop=0;break;case 2:nodeStyle.position="absolute",nodeStyle.left=el.offset.left+"px",nodeStyle.right=el.offset.right+"px",nodeStyle.top="auto",nodeStyle.bottom=0,nodeStyle.width="auto",nodeStyle.marginLeft=0,nodeStyle.marginRight=0}el.mode=mode}function clone(el){el.clone=document.createElement("div");var refElement=el.node.nextSibling||el.node,cloneStyle=el.clone.style;cloneStyle.height=el.height+"px",cloneStyle.width=el.width+"px",cloneStyle.marginTop=el.computed.marginTop,cloneStyle.marginBottom=el.computed.marginBottom,cloneStyle.marginLeft=el.computed.marginLeft,cloneStyle.marginRight=el.computed.marginRight,cloneStyle.padding=cloneStyle.border=cloneStyle.borderSpacing=0,cloneStyle.fontSize="1em",cloneStyle.position="static",cloneStyle.cssFloat=el.computed.cssFloat,el.node.parentNode.insertBefore(el.clone,refElement)}function killClone(el){el.clone.parentNode.removeChild(el.clone),el.clone=void 0}function getElementParams(node){var computedStyle=getComputedStyle(node),parentNode=node.parentNode,parentComputedStyle=getComputedStyle(parentNode),cachedPosition=node.style.position;node.style.position="relative";var computed={top:computedStyle.top,marginTop:computedStyle.marginTop,marginBottom:computedStyle.marginBottom,marginLeft:computedStyle.marginLeft,marginRight:computedStyle.marginRight,cssFloat:computedStyle.cssFloat,display:computedStyle.display},numeric={top:parseNumeric(computedStyle.top),marginBottom:parseNumeric(computedStyle.marginBottom),paddingLeft:parseNumeric(computedStyle.paddingLeft),paddingRight:parseNumeric(computedStyle.paddingRight),borderLeftWidth:parseNumeric(computedStyle.borderLeftWidth),borderRightWidth:parseNumeric(computedStyle.borderRightWidth)};node.style.position=cachedPosition;var css={position:node.style.position,top:node.style.top,bottom:node.style.bottom,left:node.style.left,right:node.style.right,width:node.style.width,marginTop:node.style.marginTop,marginLeft:node.style.marginLeft,marginRight:node.style.marginRight},nodeOffset=getElementOffset(node),parentOffset=getElementOffset(parentNode),parent={node:parentNode,css:{position:parentNode.style.position},computed:{position:parentComputedStyle.position},numeric:{borderLeftWidth:parseNumeric(parentComputedStyle.borderLeftWidth),borderRightWidth:parseNumeric(parentComputedStyle.borderRightWidth),borderTopWidth:parseNumeric(parentComputedStyle.borderTopWidth),borderBottomWidth:parseNumeric(parentComputedStyle.borderBottomWidth)}};return{node:node,box:{left:nodeOffset.win.left,right:html.clientWidth-nodeOffset.win.right},offset:{top:nodeOffset.win.top-parentOffset.win.top-parent.numeric.borderTopWidth,left:nodeOffset.win.left-parentOffset.win.left-parent.numeric.borderLeftWidth,right:-nodeOffset.win.right+parentOffset.win.right-parent.numeric.borderRightWidth},css:css,isCell:"table-cell"==computedStyle.display,computed:computed,numeric:numeric,width:nodeOffset.win.right-nodeOffset.win.left,height:nodeOffset.win.bottom-nodeOffset.win.top,mode:-1,inited:!1,parent:parent,limit:{start:nodeOffset.doc.top-numeric.top,end:parentOffset.doc.top+parentNode.offsetHeight-parent.numeric.borderBottomWidth-node.offsetHeight-numeric.top-numeric.marginBottom}}}function getDocOffsetTop(node){for(var docOffsetTop=0;node;)docOffsetTop+=node.offsetTop,node=node.offsetParent;return docOffsetTop}function getElementOffset(node){var box=node.getBoundingClientRect();return{doc:{top:box.top+win.pageYOffset,left:box.left+win.pageXOffset},win:box}}function startFastCheckTimer(){checkTimer=setInterval(function(){!fastCheck()&&rebuild()},500)}function stopFastCheckTimer(){clearInterval(checkTimer)}function handlePageVisibilityChange(){initialized&&(document[hiddenPropertyName]?stopFastCheckTimer():startFastCheckTimer())}function init(){initialized||(updateScrollPos(),initAll(),win.addEventListener("scroll",onScroll),win.addEventListener("wheel",onWheel),win.addEventListener("resize",rebuild),win.addEventListener("orientationchange",rebuild),doc.addEventListener(visibilityChangeEventName,handlePageVisibilityChange),startFastCheckTimer(),initialized=!0)}function rebuild(){if(initialized){deinitAll();for(var i=watchArray.length-1;i>=0;i--)watchArray[i]=getElementParams(watchArray[i].node);initAll()}}function pause(){win.removeEventListener("scroll",onScroll),win.removeEventListener("wheel",onWheel),win.removeEventListener("resize",rebuild),win.removeEventListener("orientationchange",rebuild),doc.removeEventListener(visibilityChangeEventName,handlePageVisibilityChange),stopFastCheckTimer(),initialized=!1}function stop(){pause(),deinitAll()}function kill(){for(stop();watchArray.length;)watchArray.pop()}function add(node){for(var i=watchArray.length-1;i>=0;i--)if(watchArray[i].node===node)return;var el=getElementParams(node);watchArray.push(el),initialized?initElement(el):init()}function remove(node){for(var i=watchArray.length-1;i>=0;i--)watchArray[i].node===node&&(deinitElement(watchArray[i]),watchArray.splice(i,1))}var scroll,checkTimer,watchArray=[],initialized=!1,html=doc.documentElement,noop=function(){},hiddenPropertyName="hidden",visibilityChangeEventName="visibilitychange";void 0!==doc.webkitHidden&&(hiddenPropertyName="webkitHidden",visibilityChangeEventName="webkitvisibilitychange"),win.getComputedStyle||seppuku();for(var prefixes=["","-webkit-","-moz-","-ms-"],block=document.createElement("div"),i=prefixes.length-1;i>=0;i--){try{block.style.position=prefixes[i]+"sticky"}catch(e){}""!=block.style.position&&seppuku()}updateScrollPos(),win.Stickyfill={stickies:watchArray,add:add,remove:remove,init:init,rebuild:rebuild,pause:pause,stop:stop,kill:kill}}(document,window),window.jQuery&&function($){$.fn.Stickyfill=function(options){return this.each(function(){Stickyfill.add(this)}),this}}(window.jQuery),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Swiper=t()}(this,function(){"use strict";function t(t,i){var s=[],a=0;if(t&&!i&&t instanceof e)return t;if(t)if("string"==typeof t){var r,n,o=t.trim();if(o.indexOf("<")>=0&&o.indexOf(">")>=0){var l="div";for(0===o.indexOf("<li")&&(l="ul"),0===o.indexOf("<tr")&&(l="tbody"),0!==o.indexOf("<td")&&0!==o.indexOf("<th")||(l="tr"),0===o.indexOf("<tbody")&&(l="table"),0===o.indexOf("<option")&&(l="select"),(n=document.createElement(l)).innerHTML=o,a=0;a<n.childNodes.length;a+=1)s.push(n.childNodes[a])}else for(r=i||"#"!==t[0]||t.match(/[ .<>:~]/)?(i||document).querySelectorAll(t.trim()):[document.getElementById(t.trim().split("#")[1])],a=0;a<r.length;a+=1)r[a]&&s.push(r[a])}else if(t.nodeType||t===window||t===document)s.push(t);else if(t.length>0&&t[0].nodeType)for(a=0;a<t.length;a+=1)s.push(t[a]);return new e(s)}function i(e){for(var t=[],i=0;i<e.length;i+=1)-1===t.indexOf(e[i])&&t.push(e[i]);return t}var e=function(e){for(var t=0;t<e.length;t+=1)this[t]=e[t];return this.length=e.length,this};t.fn=e.prototype,t.Class=e,t.Dom7=e,"resize scroll".split(" ");var s={addClass:function(e){if(void 0===e)return this;for(var t=e.split(" "),i=0;i<t.length;i+=1)for(var s=0;s<this.length;s+=1)void 0!==this[s].classList&&this[s].classList.add(t[i]);return this},removeClass:function(e){for(var t=e.split(" "),i=0;i<t.length;i+=1)for(var s=0;s<this.length;s+=1)void 0!==this[s].classList&&this[s].classList.remove(t[i]);return this},hasClass:function(e){return!!this[0]&&this[0].classList.contains(e)},toggleClass:function(e){for(var t=e.split(" "),i=0;i<t.length;i+=1)for(var s=0;s<this.length;s+=1)void 0!==this[s].classList&&this[s].classList.toggle(t[i]);return this},attr:function(e,t){var i=arguments;if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(var s=0;s<this.length;s+=1)if(2===i.length)this[s].setAttribute(e,t);else for(var a in e)this[s][a]=e[a],this[s].setAttribute(a,e[a]);return this},removeAttr:function(e){for(var t=0;t<this.length;t+=1)this[t].removeAttribute(e);return this},data:function(e,t){var i;if(void 0!==t){for(var s=0;s<this.length;s+=1)(i=this[s]).dom7ElementDataStorage||(i.dom7ElementDataStorage={}),i.dom7ElementDataStorage[e]=t;return this}if(i=this[0]){if(i.dom7ElementDataStorage&&e in i.dom7ElementDataStorage)return i.dom7ElementDataStorage[e];return i.getAttribute("data-"+e)||void 0}},transform:function(e){for(var t=0;t<this.length;t+=1){var i=this[t].style;i.webkitTransform=e,i.transform=e}return this},transition:function(e){"string"!=typeof e&&(e+="ms");for(var t=0;t<this.length;t+=1){var i=this[t].style;i.webkitTransitionDuration=e,i.transitionDuration=e}return this},on:function(){function l(e){var i=e.target;if(i){var s=e.target.dom7EventData||[];if(s.unshift(e),t(i).is(r))n.apply(i,s);else for(var a=t(i).parents(),o=0;o<a.length;o+=1)t(a[o]).is(r)&&n.apply(a[o],s)}}function d(e){var t=e&&e.target?e.target.dom7EventData||[]:[];t.unshift(e),n.apply(this,t)}for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];var s,a=e[0],r=e[1],n=e[2],o=e[3];"function"==typeof e[1]&&(a=(s=e)[0],n=s[1],o=s[2],r=void 0),o||(o=!1);for(var h,p=a.split(" "),c=0;c<this.length;c+=1){var u=this[c];if(r)for(h=0;h<p.length;h+=1)u.dom7LiveListeners||(u.dom7LiveListeners=[]),u.dom7LiveListeners.push({type:a,listener:n,proxyListener:l}),u.addEventListener(p[h],l,o);else for(h=0;h<p.length;h+=1)u.dom7Listeners||(u.dom7Listeners=[]),u.dom7Listeners.push({type:a,listener:n,proxyListener:d}),u.addEventListener(p[h],d,o)}return this},off:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i,s=e[0],a=e[1],r=e[2],n=e[3];"function"==typeof e[1]&&(s=(i=e)[0],r=i[1],n=i[2],a=void 0),n||(n=!1);for(var o=s.split(" "),l=0;l<o.length;l+=1)for(var d=0;d<this.length;d+=1){var h=this[d];if(a){if(h.dom7LiveListeners)for(var p=0;p<h.dom7LiveListeners.length;p+=1)r?h.dom7LiveListeners[p].listener===r&&h.removeEventListener(o[l],h.dom7LiveListeners[p].proxyListener,n):h.dom7LiveListeners[p].type===o[l]&&h.removeEventListener(o[l],h.dom7LiveListeners[p].proxyListener,n)}else if(h.dom7Listeners)for(var c=0;c<h.dom7Listeners.length;c+=1)r?h.dom7Listeners[c].listener===r&&h.removeEventListener(o[l],h.dom7Listeners[c].proxyListener,n):h.dom7Listeners[c].type===o[l]&&h.removeEventListener(o[l],h.dom7Listeners[c].proxyListener,n)}return this},trigger:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i=e[0].split(" "),s=e[1],a=0;a<i.length;a+=1)for(var r=0;r<this.length;r+=1){var n=void 0;try{n=new window.CustomEvent(i[a],{detail:s,bubbles:!0,cancelable:!0})}catch(e){(n=document.createEvent("Event")).initEvent(i[a],!0,!0),n.detail=s}this[r].dom7EventData=e.filter(function(e,t){return t>0}),this[r].dispatchEvent(n),this[r].dom7EventData=[],delete this[r].dom7EventData}return this},transitionEnd:function(e){function a(r){if(r.target===this)for(e.call(this,r),t=0;t<i.length;t+=1)s.off(i[t],a)}var t,i=["webkitTransitionEnd","transitionend"],s=this;if(e)for(t=0;t<i.length;t+=1)s.on(i[t],a);return this},outerWidth:function(e){if(this.length>0){if(e){var t=this.styles();return this[0].offsetWidth+parseFloat(t.getPropertyValue("margin-right"))+parseFloat(t.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null},outerHeight:function(e){if(this.length>0){if(e){var t=this.styles();return this[0].offsetHeight+parseFloat(t.getPropertyValue("margin-top"))+parseFloat(t.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null},offset:function(){if(this.length>0){var e=this[0],t=e.getBoundingClientRect(),i=document.body,s=e.clientTop||i.clientTop||0,a=e.clientLeft||i.clientLeft||0,r=e===window?window.scrollY:e.scrollTop,n=e===window?window.scrollX:e.scrollLeft;return{top:t.top+r-s,left:t.left+n-a}}return null},css:function(e,t){var i;if(1===arguments.length){if("string"!=typeof e){for(i=0;i<this.length;i+=1)for(var s in e)this[i].style[s]=e[s];return this}if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(i=0;i<this.length;i+=1)this[i].style[e]=t;return this}return this},each:function(e){if(!e)return this;for(var t=0;t<this.length;t+=1)if(!1===e.call(this[t],t,this[t]))return this;return this},html:function(e){if(void 0===e)return this[0]?this[0].innerHTML:void 0;for(var t=0;t<this.length;t+=1)this[t].innerHTML=e;return this},text:function(e){if(void 0===e)return this[0]?this[0].textContent.trim():null;for(var t=0;t<this.length;t+=1)this[t].textContent=e;return this},is:function(i){var s,a,r=this[0];if(!r||void 0===i)return!1;if("string"==typeof i){if(r.matches)return r.matches(i);if(r.webkitMatchesSelector)return r.webkitMatchesSelector(i);if(r.msMatchesSelector)return r.msMatchesSelector(i);for(s=t(i),a=0;a<s.length;a+=1)if(s[a]===r)return!0;return!1}if(i===document)return r===document;if(i===window)return r===window;if(i.nodeType||i instanceof e){for(s=i.nodeType?[i]:i,a=0;a<s.length;a+=1)if(s[a]===r)return!0;return!1}return!1},index:function(){var e,t=this[0];if(t){for(e=0;null!==(t=t.previousSibling);)1===t.nodeType&&(e+=1);return e}},eq:function(t){if(void 0===t)return this;var i,s=this.length;return new e(t>s-1?[]:t<0?(i=s+t)<0?[]:[this[i]]:[this[t]])},append:function(){for(var t,i=[],s=arguments.length;s--;)i[s]=arguments[s];for(var a=0;a<i.length;a+=1){t=i[a];for(var r=0;r<this.length;r+=1)if("string"==typeof t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)this[r].appendChild(n.firstChild)}else if(t instanceof e)for(var o=0;o<t.length;o+=1)this[r].appendChild(t[o]);else this[r].appendChild(t)}return this},prepend:function(t){var i,s;for(i=0;i<this.length;i+=1)if("string"==typeof t){var a=document.createElement("div");for(a.innerHTML=t,s=a.childNodes.length-1;s>=0;s-=1)this[i].insertBefore(a.childNodes[s],this[i].childNodes[0])}else if(t instanceof e)for(s=0;s<t.length;s+=1)this[i].insertBefore(t[s],this[i].childNodes[0]);else this[i].insertBefore(t,this[i].childNodes[0]);return this},next:function(i){return new e(this.length>0?i?this[0].nextElementSibling&&t(this[0].nextElementSibling).is(i)?[this[0].nextElementSibling]:[]:this[0].nextElementSibling?[this[0].nextElementSibling]:[]:[])},nextAll:function(i){var s=[],a=this[0];if(!a)return new e([]);for(;a.nextElementSibling;){var r=a.nextElementSibling;i?t(r).is(i)&&s.push(r):s.push(r),a=r}return new e(s)},prev:function(i){if(this.length>0){var s=this[0];return new e(i?s.previousElementSibling&&t(s.previousElementSibling).is(i)?[s.previousElementSibling]:[]:s.previousElementSibling?[s.previousElementSibling]:[])}return new e([])},prevAll:function(i){var s=[],a=this[0];if(!a)return new e([]);for(;a.previousElementSibling;){var r=a.previousElementSibling;i?t(r).is(i)&&s.push(r):s.push(r),a=r}return new e(s)},parent:function(e){for(var s=[],a=0;a<this.length;a+=1)null!==this[a].parentNode&&(e?t(this[a].parentNode).is(e)&&s.push(this[a].parentNode):s.push(this[a].parentNode));return t(i(s))},parents:function(e){for(var s=[],a=0;a<this.length;a+=1)for(var r=this[a].parentNode;r;)e?t(r).is(e)&&s.push(r):s.push(r),r=r.parentNode;return t(i(s))},closest:function(t){var i=this;return void 0===t?new e([]):(i.is(t)||(i=i.parents(t).eq(0)),i)},find:function(t){for(var i=[],s=0;s<this.length;s+=1)for(var a=this[s].querySelectorAll(t),r=0;r<a.length;r+=1)i.push(a[r]);return new e(i)},children:function(s){for(var a=[],r=0;r<this.length;r+=1)for(var n=this[r].childNodes,o=0;o<n.length;o+=1)s?1===n[o].nodeType&&t(n[o]).is(s)&&a.push(n[o]):1===n[o].nodeType&&a.push(n[o]);return new e(i(a))},remove:function(){for(var e=0;e<this.length;e+=1)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},add:function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];var s,a;for(s=0;s<e.length;s+=1){var r=t(e[s]);for(a=0;a<r.length;a+=1)this[this.length]=r[a],this.length+=1}return this},styles:function(){return this[0]?window.getComputedStyle(this[0],null):{}}};Object.keys(s).forEach(function(e){t.fn[e]=s[e]});var a,r,n,o="undefined"==typeof window?{navigator:{userAgent:""},location:{},history:{},addEventListener:function(){},removeEventListener:function(){},getComputedStyle:function(){return{}},Image:function(){},Date:function(){},screen:{}}:window,l={deleteProps:function(e){var t=e;Object.keys(t).forEach(function(e){try{t[e]=null}catch(e){}try{delete t[e]}catch(e){}})},nextTick:function(e,t){return void 0===t&&(t=0),setTimeout(e,t)},now:function(){return Date.now()},getTranslate:function(e,t){var i,s,a;void 0===t&&(t="x");var r=o.getComputedStyle(e,null);return o.WebKitCSSMatrix?((s=r.transform||r.webkitTransform).split(",").length>6&&(s=s.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),a=new o.WebKitCSSMatrix("none"===s?"":s)):i=(a=r.MozTransform||r.OTransform||r.MsTransform||r.msTransform||r.transform||r.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,")).toString().split(","),"x"===t&&(s=o.WebKitCSSMatrix?a.m41:16===i.length?parseFloat(i[12]):parseFloat(i[4])),"y"===t&&(s=o.WebKitCSSMatrix?a.m42:16===i.length?parseFloat(i[13]):parseFloat(i[5])),s||0},parseUrlQuery:function(e){var t,i,s,a,r={},n=e||o.location.href;if("string"==typeof n&&n.length)for(a=(i=(n=n.indexOf("?")>-1?n.replace(/\S*\?/,""):"").split("&").filter(function(e){return""!==e})).length,t=0;t<a;t+=1)s=i[t].replace(/#\S+/g,"").split("="),r[decodeURIComponent(s[0])]=void 0===s[1]?void 0:decodeURIComponent(s[1])||"";return r},isObject:function(e){return"object"==typeof e&&null!==e&&e.constructor&&e.constructor===Object},extend:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i=Object(e[0]),s=1;s<e.length;s+=1){var a=e[s];if(void 0!==a&&null!==a)for(var r=Object.keys(Object(a)),n=0,o=r.length;n<o;n+=1){var d=r[n],h=Object.getOwnPropertyDescriptor(a,d);void 0!==h&&h.enumerable&&(l.isObject(i[d])&&l.isObject(a[d])?l.extend(i[d],a[d]):!l.isObject(i[d])&&l.isObject(a[d])?(i[d]={},l.extend(i[d],a[d])):i[d]=a[d])}}return i}},d="undefined"==typeof document?{addEventListener:function(){},removeEventListener:function(){},activeElement:{blur:function(){},nodeName:""},querySelector:function(){return{}},querySelectorAll:function(){return[]},createElement:function(){return{style:{},setAttribute:function(){},getElementsByTagName:function(){return[]}}},location:{hash:""}}:document,h=(n=d.createElement("div"),{touch:o.Modernizr&&!0===o.Modernizr.touch||!!("ontouchstart"in o||o.DocumentTouch&&d instanceof o.DocumentTouch),pointerEvents:!(!o.navigator.pointerEnabled&&!o.PointerEvent),prefixedPointerEvents:!!o.navigator.msPointerEnabled,transition:"transition"in(r=n.style)||"webkitTransition"in r||"MozTransition"in r,transforms3d:o.Modernizr&&!0===o.Modernizr.csstransforms3d||"webkitPerspective"in(a=n.style)||"MozPerspective"in a||"OPerspective"in a||"MsPerspective"in a||"perspective"in a,flexbox:function(){for(var e=n.style,t="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),i=0;i<t.length;i+=1)if(t[i]in e)return!0;return!1}(),observer:"MutationObserver"in o||"WebkitMutationObserver"in o,passiveListener:function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});o.addEventListener("testPassiveListener",null,t)}catch(e){}return e}(),gestures:"ongesturestart"in o}),p=function(e){void 0===e&&(e={});var t=this;t.params=e,t.eventsListeners={},t.params&&t.params.on&&Object.keys(t.params.on).forEach(function(e){t.on(e,t.params.on[e])})},c={components:{configurable:!0}};p.prototype.on=function(e,t){var i=this;return"function"!=typeof t?i:(e.split(" ").forEach(function(e){i.eventsListeners[e]||(i.eventsListeners[e]=[]),i.eventsListeners[e].push(t)}),i)},p.prototype.once=function(e,t){var i=this;return"function"!=typeof t?i:i.on(e,function s(){for(var a=[],r=arguments.length;r--;)a[r]=arguments[r];t.apply(i,a),i.off(e,s)})},p.prototype.off=function(e,t){var i=this;return e.split(" ").forEach(function(e){void 0===t?i.eventsListeners[e]=[]:i.eventsListeners[e].forEach(function(s,a){s===t&&i.eventsListeners[e].splice(a,1)})}),i},p.prototype.emit=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i,s,a,r=this;return r.eventsListeners?("string"==typeof e[0]||Array.isArray(e[0])?(i=e[0],s=e.slice(1,e.length),a=r):(i=e[0].events,s=e[0].data,a=e[0].context||r),(Array.isArray(i)?i:i.split(" ")).forEach(function(e){if(r.eventsListeners[e]){var t=[];r.eventsListeners[e].forEach(function(e){t.push(e)}),t.forEach(function(e){e.apply(a,s)})}}),r):r},p.prototype.useModulesParams=function(e){var t=this;t.modules&&Object.keys(t.modules).forEach(function(i){var s=t.modules[i];s.params&&l.extend(e,s.params)})},p.prototype.useModules=function(e){void 0===e&&(e={});var t=this;t.modules&&Object.keys(t.modules).forEach(function(i){var s=t.modules[i],a=e[i]||{};s.instance&&Object.keys(s.instance).forEach(function(e){var i=s.instance[e];t[e]="function"==typeof i?i.bind(t):i}),s.on&&t.on&&Object.keys(s.on).forEach(function(e){t.on(e,s.on[e])}),s.create&&s.create.bind(t)(a)})},c.components.set=function(e){this.use&&this.use(e)},p.installModule=function(e){for(var t=[],i=arguments.length-1;i-->0;)t[i]=arguments[i+1];var s=this;s.prototype.modules||(s.prototype.modules={});var a=e.name||Object.keys(s.prototype.modules).length+"_"+l.now();return s.prototype.modules[a]=e,e.proto&&Object.keys(e.proto).forEach(function(t){s.prototype[t]=e.proto[t]}),e.static&&Object.keys(e.static).forEach(function(t){s[t]=e.static[t]}),e.install&&e.install.apply(s,t),s},p.use=function(e){for(var t=[],i=arguments.length-1;i-->0;)t[i]=arguments[i+1];var s=this;return Array.isArray(e)?(e.forEach(function(e){return s.installModule(e)}),s):s.installModule.apply(s,[e].concat(t))},Object.defineProperties(p,c);var u={updateSize:function(){var e,t,i=this.$el;e=void 0!==this.params.width?this.params.width:i[0].clientWidth,t=void 0!==this.params.height?this.params.height:i[0].clientHeight,0===e&&this.isHorizontal()||0===t&&this.isVertical()||(e=e-parseInt(i.css("padding-left"),10)-parseInt(i.css("padding-right"),10),t=t-parseInt(i.css("padding-top"),10)-parseInt(i.css("padding-bottom"),10),l.extend(this,{width:e,height:t,size:this.isHorizontal()?e:t}))},updateSlides:function(){var e=this.params,t=this.$wrapperEl,i=this.size,s=this.rtl,a=this.wrongRTL,r=t.children("."+this.params.slideClass),n=this.virtual&&e.virtual.enabled?this.virtual.slides.length:r.length,o=[],d=[],p=[],c=e.slidesOffsetBefore;"function"==typeof c&&(c=e.slidesOffsetBefore.call(this));var u=e.slidesOffsetAfter;"function"==typeof u&&(u=e.slidesOffsetAfter.call(this));var f=n,v=this.snapGrid.length,m=this.snapGrid.length,g=e.spaceBetween,b=-c,w=0,y=0;if(void 0!==i){var x,T;"string"==typeof g&&g.indexOf("%")>=0&&(g=parseFloat(g.replace("%",""))/100*i),this.virtualSize=-g,s?r.css({marginLeft:"",marginTop:""}):r.css({marginRight:"",marginBottom:""}),e.slidesPerColumn>1&&(x=Math.floor(n/e.slidesPerColumn)===n/this.params.slidesPerColumn?n:Math.ceil(n/e.slidesPerColumn)*e.slidesPerColumn,"auto"!==e.slidesPerView&&"row"===e.slidesPerColumnFill&&(x=Math.max(x,e.slidesPerView*e.slidesPerColumn)));for(var E,S=e.slidesPerColumn,C=x/S,M=C-(e.slidesPerColumn*C-n),z=0;z<n;z+=1){T=0;var P=r.eq(z);if(e.slidesPerColumn>1){var k=void 0,$=void 0,L=void 0;"column"===e.slidesPerColumnFill?(L=z-($=Math.floor(z/S))*S,($>M||$===M&&L===S-1)&&(L+=1)>=S&&(L=0,$+=1),k=$+L*x/S,P.css({"-webkit-box-ordinal-group":k,"-moz-box-ordinal-group":k,"-ms-flex-order":k,"-webkit-order":k,order:k})):$=z-(L=Math.floor(z/C))*C,P.css("margin-"+(this.isHorizontal()?"top":"left"),0!==L&&e.spaceBetween&&e.spaceBetween+"px").attr("data-swiper-column",$).attr("data-swiper-row",L)}"none"!==P.css("display")&&("auto"===e.slidesPerView?(T=this.isHorizontal()?P.outerWidth(!0):P.outerHeight(!0),e.roundLengths&&(T=Math.floor(T))):(T=(i-(e.slidesPerView-1)*g)/e.slidesPerView,e.roundLengths&&(T=Math.floor(T)),r[z]&&(this.isHorizontal()?r[z].style.width=T+"px":r[z].style.height=T+"px")),r[z]&&(r[z].swiperSlideSize=T),p.push(T),e.centeredSlides?(b=b+T/2+w/2+g,0===w&&0!==z&&(b=b-i/2-g),0===z&&(b=b-i/2-g),Math.abs(b)<.001&&(b=0),y%e.slidesPerGroup==0&&o.push(b),d.push(b)):(y%e.slidesPerGroup==0&&o.push(b),d.push(b),b=b+T+g),this.virtualSize+=T+g,w=T,y+=1)}if(this.virtualSize=Math.max(this.virtualSize,i)+u,s&&a&&("slide"===e.effect||"coverflow"===e.effect)&&t.css({width:this.virtualSize+e.spaceBetween+"px"}),h.flexbox&&!e.setWrapperSize||(this.isHorizontal()?t.css({width:this.virtualSize+e.spaceBetween+"px"}):t.css({height:this.virtualSize+e.spaceBetween+"px"})),e.slidesPerColumn>1&&(this.virtualSize=(T+e.spaceBetween)*x,this.virtualSize=Math.ceil(this.virtualSize/e.slidesPerColumn)-e.spaceBetween,this.isHorizontal()?t.css({width:this.virtualSize+e.spaceBetween+"px"}):t.css({height:this.virtualSize+e.spaceBetween+"px"}),e.centeredSlides)){E=[];for(var I=0;I<o.length;I+=1)o[I]<this.virtualSize+o[0]&&E.push(o[I]);o=E}if(!e.centeredSlides){E=[];for(var D=0;D<o.length;D+=1)o[D]<=this.virtualSize-i&&E.push(o[D]);o=E,Math.floor(this.virtualSize-i)-Math.floor(o[o.length-1])>1&&o.push(this.virtualSize-i)}0===o.length&&(o=[0]),0!==e.spaceBetween&&(this.isHorizontal()?s?r.css({marginLeft:g+"px"}):r.css({marginRight:g+"px"}):r.css({marginBottom:g+"px"})),l.extend(this,{slides:r,snapGrid:o,slidesGrid:d,slidesSizesGrid:p}),n!==f&&this.emit("slidesLengthChange"),o.length!==v&&(this.params.watchOverflow&&this.checkOverflow(),this.emit("snapGridLengthChange")),d.length!==m&&this.emit("slidesGridLengthChange"),(e.watchSlidesProgress||e.watchSlidesVisibility)&&this.updateSlidesOffset()}},updateAutoHeight:function(){var e,t=[],i=0;if("auto"!==this.params.slidesPerView&&this.params.slidesPerView>1)for(e=0;e<Math.ceil(this.params.slidesPerView);e+=1){var s=this.activeIndex+e;if(s>this.slides.length)break;t.push(this.slides.eq(s)[0])}else t.push(this.slides.eq(this.activeIndex)[0]);for(e=0;e<t.length;e+=1)if(void 0!==t[e]){var a=t[e].offsetHeight;i=a>i?a:i}i&&this.$wrapperEl.css("height",i+"px")},updateSlidesOffset:function(){for(var e=this.slides,t=0;t<e.length;t+=1)e[t].swiperSlideOffset=this.isHorizontal()?e[t].offsetLeft:e[t].offsetTop},updateSlidesProgress:function(e){void 0===e&&(e=this.translate||0);var t=this.params,i=this.slides,s=this.rtl;if(0!==i.length){void 0===i[0].swiperSlideOffset&&this.updateSlidesOffset();var a=-e;s&&(a=e),i.removeClass(t.slideVisibleClass);for(var r=0;r<i.length;r+=1){var n=i[r],o=(a+(t.centeredSlides?this.minTranslate():0)-n.swiperSlideOffset)/(n.swiperSlideSize+t.spaceBetween);if(t.watchSlidesVisibility){var l=-(a-n.swiperSlideOffset),d=l+this.slidesSizesGrid[r];(l>=0&&l<this.size||d>0&&d<=this.size||l<=0&&d>=this.size)&&i.eq(r).addClass(t.slideVisibleClass)}n.progress=s?-o:o}}},updateProgress:function(e){void 0===e&&(e=this.translate||0);var t=this.params,i=this.maxTranslate()-this.minTranslate(),s=this.progress,a=this.isBeginning,r=this.isEnd,n=a,o=r;0===i?(s=0,a=!0,r=!0):(a=(s=(e-this.minTranslate())/i)<=0,r=s>=1),l.extend(this,{progress:s,isBeginning:a,isEnd:r}),(t.watchSlidesProgress||t.watchSlidesVisibility)&&this.updateSlidesProgress(e),a&&!n&&this.emit("reachBeginning toEdge"),r&&!o&&this.emit("reachEnd toEdge"),(n&&!a||o&&!r)&&this.emit("fromEdge"),this.emit("progress",s)},updateSlidesClasses:function(){var e,t=this.slides,i=this.params,s=this.$wrapperEl,a=this.activeIndex,r=this.realIndex,n=this.virtual&&i.virtual.enabled;t.removeClass(i.slideActiveClass+" "+i.slideNextClass+" "+i.slidePrevClass+" "+i.slideDuplicateActiveClass+" "+i.slideDuplicateNextClass+" "+i.slideDuplicatePrevClass),(e=n?this.$wrapperEl.find("."+i.slideClass+'[data-swiper-slide-index="'+a+'"]'):t.eq(a)).addClass(i.slideActiveClass),i.loop&&(e.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+r+'"]').addClass(i.slideDuplicateActiveClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+r+'"]').addClass(i.slideDuplicateActiveClass));var o=e.nextAll("."+i.slideClass).eq(0).addClass(i.slideNextClass);i.loop&&0===o.length&&(o=t.eq(0)).addClass(i.slideNextClass);var l=e.prevAll("."+i.slideClass).eq(0).addClass(i.slidePrevClass);i.loop&&0===l.length&&(l=t.eq(-1)).addClass(i.slidePrevClass),i.loop&&(o.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+o.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicateNextClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+o.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicateNextClass),l.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+l.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicatePrevClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+l.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicatePrevClass))},updateActiveIndex:function(e){var t,i=this.rtl?this.translate:-this.translate,s=this.slidesGrid,a=this.snapGrid,r=this.params,n=this.activeIndex,o=this.realIndex,d=this.snapIndex,h=e;if(void 0===h){for(var p=0;p<s.length;p+=1)void 0!==s[p+1]?i>=s[p]&&i<s[p+1]-(s[p+1]-s[p])/2?h=p:i>=s[p]&&i<s[p+1]&&(h=p+1):i>=s[p]&&(h=p);r.normalizeSlideIndex&&(h<0||void 0===h)&&(h=0)}if((t=a.indexOf(i)>=0?a.indexOf(i):Math.floor(h/r.slidesPerGroup))>=a.length&&(t=a.length-1),h!==n){var c=parseInt(this.slides.eq(h).attr("data-swiper-slide-index")||h,10);l.extend(this,{snapIndex:t,realIndex:c,previousIndex:n,activeIndex:h}),this.emit("activeIndexChange"),this.emit("snapIndexChange"),o!==c&&this.emit("realIndexChange"),this.emit("slideChange")}else t!==d&&(this.snapIndex=t,this.emit("snapIndexChange"))},updateClickedSlide:function(e){var i=this.params,s=t(e.target).closest("."+i.slideClass)[0],a=!1;if(s)for(var r=0;r<this.slides.length;r+=1)this.slides[r]===s&&(a=!0);if(!s||!a)return this.clickedSlide=void 0,void(this.clickedIndex=void 0);this.clickedSlide=s,this.virtual&&this.params.virtual.enabled?this.clickedIndex=parseInt(t(s).attr("data-swiper-slide-index"),10):this.clickedIndex=t(s).index(),i.slideToClickedSlide&&void 0!==this.clickedIndex&&this.clickedIndex!==this.activeIndex&&this.slideToClickedSlide()}},f={getTranslate:function(e){void 0===e&&(e=this.isHorizontal()?"x":"y");var t=this.params,i=this.rtl,s=this.translate,a=this.$wrapperEl;if(t.virtualTranslate)return i?-s:s;var r=l.getTranslate(a[0],e);return i&&(r=-r),r||0},setTranslate:function(e,t){var i=this.rtl,s=this.params,a=this.$wrapperEl,r=this.progress,n=0,o=0;this.isHorizontal()?n=i?-e:e:o=e,s.roundLengths&&(n=Math.floor(n),o=Math.floor(o)),s.virtualTranslate||(h.transforms3d?a.transform("translate3d("+n+"px, "+o+"px, 0px)"):a.transform("translate("+n+"px, "+o+"px)")),this.translate=this.isHorizontal()?n:o;var l=this.maxTranslate()-this.minTranslate();(0===l?0:(e-this.minTranslate())/l)!==r&&this.updateProgress(e),this.emit("setTranslate",this.translate,t)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]}},v={setTransition:function(e,t){this.$wrapperEl.transition(e),this.emit("setTransition",e,t)},transitionStart:function(e){void 0===e&&(e=!0);var t=this.activeIndex,i=this.params,s=this.previousIndex;i.autoHeight&&this.updateAutoHeight(),this.emit("transitionStart"),e&&t!==s&&(this.emit("slideChangeTransitionStart"),t>s?this.emit("slideNextTransitionStart"):this.emit("slidePrevTransitionStart"))},transitionEnd:function(e){void 0===e&&(e=!0);var t=this.activeIndex,i=this.previousIndex;this.animating=!1,this.setTransition(0),this.emit("transitionEnd"),e&&t!==i&&(this.emit("slideChangeTransitionEnd"),t>i?this.emit("slideNextTransitionEnd"):this.emit("slidePrevTransitionEnd"))}},m={slideTo:function(e,t,i,s){void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===i&&(i=!0);var a=this,r=e;r<0&&(r=0);var n=a.params,o=a.snapGrid,l=a.slidesGrid,d=a.previousIndex,p=a.activeIndex,c=a.rtl,u=a.$wrapperEl,f=Math.floor(r/n.slidesPerGroup);f>=o.length&&(f=o.length-1),(p||n.initialSlide||0)===(d||0)&&i&&a.emit("beforeSlideChangeStart");var v=-o[f];if(a.updateProgress(v),n.normalizeSlideIndex)for(var m=0;m<l.length;m+=1)-Math.floor(100*v)>=Math.floor(100*l[m])&&(r=m);if(a.initialized){if(!a.allowSlideNext&&v<a.translate&&v<a.minTranslate())return!1;if(!a.allowSlidePrev&&v>a.translate&&v>a.maxTranslate()&&(p||0)!==r)return!1}return c&&-v===a.translate||!c&&v===a.translate?(a.updateActiveIndex(r),n.autoHeight&&a.updateAutoHeight(),a.updateSlidesClasses(),"slide"!==n.effect&&a.setTranslate(v),!1):(0!==t&&h.transition?(a.setTransition(t),a.setTranslate(v),a.updateActiveIndex(r),a.updateSlidesClasses(),a.emit("beforeTransitionStart",t,s),a.transitionStart(i),a.animating||(a.animating=!0,u.transitionEnd(function(){a&&!a.destroyed&&a.transitionEnd(i)}))):(a.setTransition(0),a.setTranslate(v),a.updateActiveIndex(r),a.updateSlidesClasses(),a.emit("beforeTransitionStart",t,s),a.transitionStart(i),a.transitionEnd(i)),!0)},slideNext:function(e,t,i){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);var s=this.params,a=this.animating;return s.loop?!a&&(this.loopFix(),this._clientLeft=this.$wrapperEl[0].clientLeft,this.slideTo(this.activeIndex+s.slidesPerGroup,e,t,i)):this.slideTo(this.activeIndex+s.slidesPerGroup,e,t,i)},slidePrev:function(e,t,i){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);var s=this.params,a=this.animating;return s.loop?!a&&(this.loopFix(),this._clientLeft=this.$wrapperEl[0].clientLeft,this.slideTo(this.activeIndex-1,e,t,i)):this.slideTo(this.activeIndex-1,e,t,i)},slideReset:function(e,t,i){return void 0===e&&(e=this.params.speed),void 0===t&&(t=!0),this.slideTo(this.activeIndex,e,t,i)},slideToClickedSlide:function(){var e,i=this,s=i.params,a=i.$wrapperEl,r="auto"===s.slidesPerView?i.slidesPerViewDynamic():s.slidesPerView,n=i.clickedIndex;if(s.loop){if(i.animating)return;e=parseInt(t(i.clickedSlide).attr("data-swiper-slide-index"),10),s.centeredSlides?n<i.loopedSlides-r/2||n>i.slides.length-i.loopedSlides+r/2?(i.loopFix(),n=a.children("."+s.slideClass+'[data-swiper-slide-index="'+e+'"]:not(.'+s.slideDuplicateClass+")").eq(0).index(),l.nextTick(function(){i.slideTo(n)})):i.slideTo(n):n>i.slides.length-r?(i.loopFix(),n=a.children("."+s.slideClass+'[data-swiper-slide-index="'+e+'"]:not(.'+s.slideDuplicateClass+")").eq(0).index(),l.nextTick(function(){i.slideTo(n)})):i.slideTo(n)}else i.slideTo(n)}},g={loopCreate:function(){var e=this,i=e.params,s=e.$wrapperEl;s.children("."+i.slideClass+"."+i.slideDuplicateClass).remove();var a=s.children("."+i.slideClass);if(i.loopFillGroupWithBlank){var r=i.slidesPerGroup-a.length%i.slidesPerGroup;if(r!==i.slidesPerGroup){for(var n=0;n<r;n+=1){var o=t(d.createElement("div")).addClass(i.slideClass+" "+i.slideBlankClass);s.append(o)}a=s.children("."+i.slideClass)}}"auto"!==i.slidesPerView||i.loopedSlides||(i.loopedSlides=a.length),e.loopedSlides=parseInt(i.loopedSlides||i.slidesPerView,10),e.loopedSlides+=i.loopAdditionalSlides,e.loopedSlides>a.length&&(e.loopedSlides=a.length);var l=[],h=[];a.each(function(i,s){var r=t(s);i<e.loopedSlides&&h.push(s),i<a.length&&i>=a.length-e.loopedSlides&&l.push(s),r.attr("data-swiper-slide-index",i)});for(var p=0;p<h.length;p+=1)s.append(t(h[p].cloneNode(!0)).addClass(i.slideDuplicateClass));for(var c=l.length-1;c>=0;c-=1)s.prepend(t(l[c].cloneNode(!0)).addClass(i.slideDuplicateClass))},loopFix:function(){var e,t=this.params,i=this.activeIndex,s=this.slides,a=this.loopedSlides,r=this.allowSlidePrev,n=this.allowSlideNext;this.allowSlidePrev=!0,this.allowSlideNext=!0,i<a?(e=s.length-3*a+i,e+=a,this.slideTo(e,0,!1,!0)):("auto"===t.slidesPerView&&i>=2*a||i>s.length-2*t.slidesPerView)&&(e=-s.length+i+a,e+=a,this.slideTo(e,0,!1,!0)),this.allowSlidePrev=r,this.allowSlideNext=n},loopDestroy:function(){var e=this.$wrapperEl,t=this.params,i=this.slides;e.children("."+t.slideClass+"."+t.slideDuplicateClass).remove(),i.removeAttr("data-swiper-slide-index")}},b={setGrabCursor:function(e){if(!h.touch&&this.params.simulateTouch){var t=this.el;t.style.cursor="move",t.style.cursor=e?"-webkit-grabbing":"-webkit-grab",t.style.cursor=e?"-moz-grabbin":"-moz-grab",t.style.cursor=e?"grabbing":"grab"}},unsetGrabCursor:function(){h.touch||(this.el.style.cursor="")}},w={appendSlide:function(e){var t=this.$wrapperEl,i=this.params;if(i.loop&&this.loopDestroy(),"object"==typeof e&&"length"in e)for(var s=0;s<e.length;s+=1)e[s]&&t.append(e[s]);else t.append(e);i.loop&&this.loopCreate(),i.observer&&h.observer||this.update()},prependSlide:function(e){var t=this.params,i=this.$wrapperEl,s=this.activeIndex;t.loop&&this.loopDestroy();var a=s+1;if("object"==typeof e&&"length"in e){for(var r=0;r<e.length;r+=1)e[r]&&i.prepend(e[r]);a=s+e.length}else i.prepend(e);t.loop&&this.loopCreate(),t.observer&&h.observer||this.update(),this.slideTo(a,0,!1)},removeSlide:function(e){var t=this.params,i=this.$wrapperEl,s=this.activeIndex;t.loop&&(this.loopDestroy(),this.slides=i.children("."+t.slideClass));var a,r=s;if("object"==typeof e&&"length"in e){for(var n=0;n<e.length;n+=1)a=e[n],this.slides[a]&&this.slides.eq(a).remove(),a<r&&(r-=1);r=Math.max(r,0)}else a=e,this.slides[a]&&this.slides.eq(a).remove(),a<r&&(r-=1),r=Math.max(r,0);t.loop&&this.loopCreate(),t.observer&&h.observer||this.update(),t.loop?this.slideTo(r+this.loopedSlides,0,!1):this.slideTo(r,0,!1)},removeAllSlides:function(){for(var e=[],t=0;t<this.slides.length;t+=1)e.push(t);this.removeSlide(e)}},y=function(){var e=o.navigator.userAgent,t={ios:!1,android:!1,androidChrome:!1,desktop:!1,windows:!1,iphone:!1,ipod:!1,ipad:!1,cordova:o.cordova||o.phonegap,phonegap:o.cordova||o.phonegap},i=e.match(/(Windows Phone);?[\s\/]+([\d.]+)?/),s=e.match(/(Android);?[\s\/]+([\d.]+)?/),a=e.match(/(iPad).*OS\s([\d_]+)/),r=e.match(/(iPod)(.*OS\s([\d_]+))?/),n=!a&&e.match(/(iPhone\sOS|iOS)\s([\d_]+)/);if(i&&(t.os="windows",t.osVersion=i[2],t.windows=!0),s&&!i&&(t.os="android",t.osVersion=s[2],t.android=!0,t.androidChrome=e.toLowerCase().indexOf("chrome")>=0),(a||n||r)&&(t.os="ios",t.ios=!0),n&&!r&&(t.osVersion=n[2].replace(/_/g,"."),t.iphone=!0),a&&(t.osVersion=a[2].replace(/_/g,"."),t.ipad=!0),r&&(t.osVersion=r[3]?r[3].replace(/_/g,"."):null,t.iphone=!0),t.ios&&t.osVersion&&e.indexOf("Version/")>=0&&"10"===t.osVersion.split(".")[0]&&(t.osVersion=e.toLowerCase().split("version/")[1].split(" ")[0]),t.desktop=!(t.os||t.android||t.webView),t.webView=(n||a||r)&&e.match(/.*AppleWebKit(?!.*Safari)/i),t.os&&"ios"===t.os){var l=t.osVersion.split("."),h=d.querySelector('meta[name="viewport"]');t.minimalUi=!t.webView&&(r||n)&&(1*l[0]==7?1*l[1]>=1:1*l[0]>7)&&h&&h.getAttribute("content").indexOf("minimal-ui")>=0}return t.pixelRatio=o.devicePixelRatio||1,t}(),x=function(e){var i=this.touchEventsData,s=this.params,a=this.touches,r=e;if(r.originalEvent&&(r=r.originalEvent),i.isTouchEvent="touchstart"===r.type,(i.isTouchEvent||!("which"in r)||3!==r.which)&&(!i.isTouched||!i.isMoved))if(s.noSwiping&&t(r.target).closest("."+s.noSwipingClass)[0])this.allowClick=!0;else if(!s.swipeHandler||t(r).closest(s.swipeHandler)[0]){a.currentX="touchstart"===r.type?r.targetTouches[0].pageX:r.pageX,a.currentY="touchstart"===r.type?r.targetTouches[0].pageY:r.pageY;var n=a.currentX,o=a.currentY;if(!(y.ios&&!y.cordova&&s.iOSEdgeSwipeDetection&&n<=s.iOSEdgeSwipeThreshold&&n>=window.screen.width-s.iOSEdgeSwipeThreshold)){if(l.extend(i,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),a.startX=n,a.startY=o,i.touchStartTime=l.now(),this.allowClick=!0,this.updateSize(),this.swipeDirection=void 0,s.threshold>0&&(i.allowThresholdMove=!1),"touchstart"!==r.type){var h=!0;t(r.target).is(i.formElements)&&(h=!1),d.activeElement&&t(d.activeElement).is(i.formElements)&&d.activeElement.blur(),h&&this.allowTouchMove&&r.preventDefault()}this.emit("touchStart",r)}}},T=function(e){var i=this.touchEventsData,s=this.params,a=this.touches,r=this.rtl,n=e;if(n.originalEvent&&(n=n.originalEvent),!i.isTouchEvent||"mousemove"!==n.type){var o="touchmove"===n.type?n.targetTouches[0].pageX:n.pageX,h="touchmove"===n.type?n.targetTouches[0].pageY:n.pageY;if(n.preventedByNestedSwiper)return a.startX=o,void(a.startY=h);if(!this.allowTouchMove)return this.allowClick=!1,void(i.isTouched&&(l.extend(a,{startX:o,startY:h,currentX:o,currentY:h}),i.touchStartTime=l.now()));if(i.isTouchEvent&&s.touchReleaseOnEdges&&!s.loop)if(this.isVertical()){if(h<a.startY&&this.translate<=this.maxTranslate()||h>a.startY&&this.translate>=this.minTranslate())return i.isTouched=!1,void(i.isMoved=!1)}else if(o<a.startX&&this.translate<=this.maxTranslate()||o>a.startX&&this.translate>=this.minTranslate())return;if(i.isTouchEvent&&d.activeElement&&n.target===d.activeElement&&t(n.target).is(i.formElements))return i.isMoved=!0,void(this.allowClick=!1);if(i.allowTouchCallbacks&&this.emit("touchMove",n),!(n.targetTouches&&n.targetTouches.length>1)){a.currentX=o,a.currentY=h;var p,c=a.currentX-a.startX,u=a.currentY-a.startY;if(void 0===i.isScrolling&&(this.isHorizontal()&&a.currentY===a.startY||this.isVertical()&&a.currentX===a.startX?i.isScrolling=!1:c*c+u*u>=25&&(p=180*Math.atan2(Math.abs(u),Math.abs(c))/Math.PI,i.isScrolling=this.isHorizontal()?p>s.touchAngle:90-p>s.touchAngle)),i.isScrolling&&this.emit("touchMoveOpposite",n),"undefined"==typeof startMoving&&(a.currentX===a.startX&&a.currentY===a.startY||(i.startMoving=!0)),i.isTouched)if(i.isScrolling)i.isTouched=!1;else if(i.startMoving){this.allowClick=!1,n.preventDefault(),s.touchMoveStopPropagation&&!s.nested&&n.stopPropagation(),i.isMoved||(s.loop&&this.loopFix(),i.startTranslate=this.getTranslate(),this.setTransition(0),this.animating&&this.$wrapperEl.trigger("webkitTransitionEnd transitionend"),i.allowMomentumBounce=!1,!s.grabCursor||!0!==this.allowSlideNext&&!0!==this.allowSlidePrev||this.setGrabCursor(!0),this.emit("sliderFirstMove",n)),this.emit("sliderMove",n),i.isMoved=!0;var f=this.isHorizontal()?c:u;a.diff=f,f*=s.touchRatio,r&&(f=-f),this.swipeDirection=f>0?"prev":"next",i.currentTranslate=f+i.startTranslate;var v=!0,m=s.resistanceRatio;if(s.touchReleaseOnEdges&&(m=0),f>0&&i.currentTranslate>this.minTranslate()?(v=!1,s.resistance&&(i.currentTranslate=this.minTranslate()-1+Math.pow(-this.minTranslate()+i.startTranslate+f,m))):f<0&&i.currentTranslate<this.maxTranslate()&&(v=!1,s.resistance&&(i.currentTranslate=this.maxTranslate()+1-Math.pow(this.maxTranslate()-i.startTranslate-f,m))),v&&(n.preventedByNestedSwiper=!0),!this.allowSlideNext&&"next"===this.swipeDirection&&i.currentTranslate<i.startTranslate&&(i.currentTranslate=i.startTranslate),!this.allowSlidePrev&&"prev"===this.swipeDirection&&i.currentTranslate>i.startTranslate&&(i.currentTranslate=i.startTranslate),s.threshold>0){if(!(Math.abs(f)>s.threshold||i.allowThresholdMove))return void(i.currentTranslate=i.startTranslate);if(!i.allowThresholdMove)return i.allowThresholdMove=!0,a.startX=a.currentX,a.startY=a.currentY,i.currentTranslate=i.startTranslate,void(a.diff=this.isHorizontal()?a.currentX-a.startX:a.currentY-a.startY)}s.followFinger&&((s.freeMode||s.watchSlidesProgress||s.watchSlidesVisibility)&&(this.updateActiveIndex(),this.updateSlidesClasses()),s.freeMode&&(0===i.velocities.length&&i.velocities.push({position:a[this.isHorizontal()?"startX":"startY"],time:i.touchStartTime}),i.velocities.push({position:a[this.isHorizontal()?"currentX":"currentY"],time:l.now()})),this.updateProgress(i.currentTranslate),this.setTranslate(i.currentTranslate))}}}},E=function(e){var t=this,i=t.touchEventsData,s=t.params,a=t.touches,r=t.rtl,n=t.$wrapperEl,o=t.slidesGrid,d=t.snapGrid,h=e;if(h.originalEvent&&(h=h.originalEvent),i.allowTouchCallbacks&&t.emit("touchEnd",h),i.allowTouchCallbacks=!1,i.isTouched){s.grabCursor&&i.isMoved&&i.isTouched&&(!0===t.allowSlideNext||!0===t.allowSlidePrev)&&t.setGrabCursor(!1);var p,c=l.now(),u=c-i.touchStartTime;if(t.allowClick&&(t.updateClickedSlide(h),t.emit("tap",h),u<300&&c-i.lastClickTime>300&&(i.clickTimeout&&clearTimeout(i.clickTimeout),i.clickTimeout=l.nextTick(function(){t&&!t.destroyed&&t.emit("click",h)},300)),u<300&&c-i.lastClickTime<300&&(i.clickTimeout&&clearTimeout(i.clickTimeout),t.emit("doubleTap",h))),i.lastClickTime=l.now(),l.nextTick(function(){t.destroyed||(t.allowClick=!0)}),!i.isTouched||!i.isMoved||!t.swipeDirection||0===a.diff||i.currentTranslate===i.startTranslate)return i.isTouched=!1,void(i.isMoved=!1);if(i.isTouched=!1,i.isMoved=!1,p=s.followFinger?r?t.translate:-t.translate:-i.currentTranslate,s.freeMode){if(p<-t.minTranslate())return void t.slideTo(t.activeIndex);if(p>-t.maxTranslate())return void(t.slides.length<d.length?t.slideTo(d.length-1):t.slideTo(t.slides.length-1));if(s.freeModeMomentum){if(i.velocities.length>1){var f=i.velocities.pop(),v=i.velocities.pop(),m=f.position-v.position,g=f.time-v.time;t.velocity=m/g,t.velocity/=2,Math.abs(t.velocity)<s.freeModeMinimumVelocity&&(t.velocity=0),(g>150||l.now()-f.time>300)&&(t.velocity=0)}else t.velocity=0;t.velocity*=s.freeModeMomentumVelocityRatio,i.velocities.length=0;var b=1e3*s.freeModeMomentumRatio,w=t.velocity*b,y=t.translate+w;r&&(y=-y);var x,T=!1,E=20*Math.abs(t.velocity)*s.freeModeMomentumBounceRatio;if(y<t.maxTranslate())s.freeModeMomentumBounce?(y+t.maxTranslate()<-E&&(y=t.maxTranslate()-E),x=t.maxTranslate(),T=!0,i.allowMomentumBounce=!0):y=t.maxTranslate();else if(y>t.minTranslate())s.freeModeMomentumBounce?(y-t.minTranslate()>E&&(y=t.minTranslate()+E),x=t.minTranslate(),T=!0,i.allowMomentumBounce=!0):y=t.minTranslate();else if(s.freeModeSticky){for(var S,C=0;C<d.length;C+=1)if(d[C]>-y){S=C;break}y=-(y=Math.abs(d[S]-y)<Math.abs(d[S-1]-y)||"next"===t.swipeDirection?d[S]:d[S-1])}if(0!==t.velocity)b=r?Math.abs((-y-t.translate)/t.velocity):Math.abs((y-t.translate)/t.velocity);else if(s.freeModeSticky)return void t.slideReset();s.freeModeMomentumBounce&&T?(t.updateProgress(x),t.setTransition(b),t.setTranslate(y),t.transitionStart(),t.animating=!0,n.transitionEnd(function(){t&&!t.destroyed&&i.allowMomentumBounce&&(t.emit("momentumBounce"),t.setTransition(s.speed),t.setTranslate(x),n.transitionEnd(function(){t&&!t.destroyed&&t.transitionEnd()}))})):t.velocity?(t.updateProgress(y),t.setTransition(b),t.setTranslate(y),t.transitionStart(),t.animating||(t.animating=!0,n.transitionEnd(function(){t&&!t.destroyed&&t.transitionEnd()}))):t.updateProgress(y),t.updateActiveIndex(),t.updateSlidesClasses()}(!s.freeModeMomentum||u>=s.longSwipesMs)&&(t.updateProgress(),t.updateActiveIndex(),t.updateSlidesClasses())}else{for(var M=0,z=t.slidesSizesGrid[0],P=0;P<o.length;P+=s.slidesPerGroup)void 0!==o[P+s.slidesPerGroup]?p>=o[P]&&p<o[P+s.slidesPerGroup]&&(M=P,z=o[P+s.slidesPerGroup]-o[P]):p>=o[P]&&(M=P,z=o[o.length-1]-o[o.length-2]);var k=(p-o[M])/z;if(u>s.longSwipesMs){if(!s.longSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&(k>=s.longSwipesRatio?t.slideTo(M+s.slidesPerGroup):t.slideTo(M)),"prev"===t.swipeDirection&&(k>1-s.longSwipesRatio?t.slideTo(M+s.slidesPerGroup):t.slideTo(M))}else{if(!s.shortSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&t.slideTo(M+s.slidesPerGroup),"prev"===t.swipeDirection&&t.slideTo(M)}}}},S=function(){var e=this.params,t=this.el;if(!t||0!==t.offsetWidth){e.breakpoints&&this.setBreakpoint();var i=this.allowSlideNext,s=this.allowSlidePrev;if(this.allowSlideNext=!0,this.allowSlidePrev=!0,this.updateSize(),this.updateSlides(),e.freeMode){var a=Math.min(Math.max(this.translate,this.maxTranslate()),this.minTranslate());this.setTranslate(a),this.updateActiveIndex(),this.updateSlidesClasses(),e.autoHeight&&this.updateAutoHeight()}else this.updateSlidesClasses(),("auto"===e.slidesPerView||e.slidesPerView>1)&&this.isEnd&&!this.params.centeredSlides?this.slideTo(this.slides.length-1,0,!1,!0):this.slideTo(this.activeIndex,0,!1,!0);this.allowSlidePrev=s,this.allowSlideNext=i}},C=function(e){this.allowClick||(this.params.preventClicks&&e.preventDefault(),this.params.preventClicksPropagation&&this.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))},M={init:!0,direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,watchOverflow:!1,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!0,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopFillGroupWithBlank:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",passiveListeners:!0,containerModifierClass:"swiper-container-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0},z={update:u,translate:f,transition:v,slide:m,loop:g,grabCursor:b,manipulation:w,events:{attachEvents:function(){var e=this.params,t=this.touchEvents,i=this.el,s=this.wrapperEl;this.onTouchStart=x.bind(this),this.onTouchMove=T.bind(this),this.onTouchEnd=E.bind(this),this.onClick=C.bind(this);var a="container"===e.touchEventsTarget?i:s,r=!!e.nested;if(h.pointerEvents||h.prefixedPointerEvents)a.addEventListener(t.start,this.onTouchStart,!1),(h.touch?a:d).addEventListener(t.move,this.onTouchMove,r),(h.touch?a:d).addEventListener(t.end,this.onTouchEnd,!1);else{if(h.touch){var n=!("touchstart"!==t.start||!h.passiveListener||!e.passiveListeners)&&{passive:!0,capture:!1};a.addEventListener(t.start,this.onTouchStart,n),a.addEventListener(t.move,this.onTouchMove,h.passiveListener?{passive:!1,capture:r}:r),a.addEventListener(t.end,this.onTouchEnd,n)}(e.simulateTouch&&!y.ios&&!y.android||e.simulateTouch&&!h.touch&&y.ios)&&(a.addEventListener("mousedown",this.onTouchStart,!1),d.addEventListener("mousemove",this.onTouchMove,r),d.addEventListener("mouseup",this.onTouchEnd,!1))}(e.preventClicks||e.preventClicksPropagation)&&a.addEventListener("click",this.onClick,!0),this.on("resize observerUpdate",S)},detachEvents:function(){var e=this.params,t=this.touchEvents,i=this.el,s=this.wrapperEl,a="container"===e.touchEventsTarget?i:s,r=!!e.nested;if(h.pointerEvents||h.prefixedPointerEvents)a.removeEventListener(t.start,this.onTouchStart,!1),(h.touch?a:d).removeEventListener(t.move,this.onTouchMove,r),(h.touch?a:d).removeEventListener(t.end,this.onTouchEnd,!1);else{if(h.touch){var n=!("onTouchStart"!==t.start||!h.passiveListener||!e.passiveListeners)&&{passive:!0,capture:!1};a.removeEventListener(t.start,this.onTouchStart,n),a.removeEventListener(t.move,this.onTouchMove,r),a.removeEventListener(t.end,this.onTouchEnd,n)}(e.simulateTouch&&!y.ios&&!y.android||e.simulateTouch&&!h.touch&&y.ios)&&(a.removeEventListener("mousedown",this.onTouchStart,!1),d.removeEventListener("mousemove",this.onTouchMove,r),d.removeEventListener("mouseup",this.onTouchEnd,!1))}(e.preventClicks||e.preventClicksPropagation)&&a.removeEventListener("click",this.onClick,!0),this.off("resize observerUpdate",S)}},breakpoints:{setBreakpoint:function(){var e=this.activeIndex,t=this.loopedSlides;void 0===t&&(t=0);var i=this.params,s=i.breakpoints;if(s&&(!s||0!==Object.keys(s).length)){var a=this.getBreakpoint(s);if(a&&this.currentBreakpoint!==a){var r=a in s?s[a]:this.originalParams,n=i.loop&&r.slidesPerView!==i.slidesPerView;l.extend(this.params,r),l.extend(this,{allowTouchMove:this.params.allowTouchMove,allowSlideNext:this.params.allowSlideNext,allowSlidePrev:this.params.allowSlidePrev}),this.currentBreakpoint=a,n&&(this.loopDestroy(),this.loopCreate(),this.updateSlides(),this.slideTo(e-t+this.loopedSlides,0,!1)),this.emit("breakpoint",r)}}},getBreakpoint:function(e){if(e){var t=!1,i=[];Object.keys(e).forEach(function(e){i.push(e)}),i.sort(function(e,t){return parseInt(e,10)-parseInt(t,10)});for(var s=0;s<i.length;s+=1){var a=i[s];a>=o.innerWidth&&!t&&(t=a)}return t||"max"}}},checkOverflow:{checkOverflow:function(){var e=this.isLocked;this.isLocked=1===this.snapGrid.length,this.allowTouchMove=!this.isLocked,e&&e!==this.isLocked&&(this.isEnd=!1,this.navigation.update())}},classes:{addClasses:function(){var e=this.classNames,t=this.params,i=this.rtl,s=this.$el,a=[];a.push(t.direction),t.freeMode&&a.push("free-mode"),h.flexbox||a.push("no-flexbox"),t.autoHeight&&a.push("autoheight"),i&&a.push("rtl"),t.slidesPerColumn>1&&a.push("multirow"),y.android&&a.push("android"),y.ios&&a.push("ios"),(h.pointerEvents||h.prefixedPointerEvents)&&a.push("wp8-"+t.direction),a.forEach(function(i){e.push(t.containerModifierClass+i)}),s.addClass(e.join(" "))},removeClasses:function(){var e=this.$el,t=this.classNames;e.removeClass(t.join(" "))}},images:{loadImage:function(e,t,i,s,a,r){function l(){r&&r()}var n;e.complete&&a?l():t?((n=new o.Image).onload=l,n.onerror=l,s&&(n.sizes=s),i&&(n.srcset=i),t&&(n.src=t)):l()},preloadImages:function(){function t(){void 0!==e&&null!==e&&e&&!e.destroyed&&(void 0!==e.imagesLoaded&&(e.imagesLoaded+=1),e.imagesLoaded===e.imagesToLoad.length&&(e.params.updateOnImagesReady&&e.update(),e.emit("imagesReady")))}var e=this;e.imagesToLoad=e.$el.find("img");for(var i=0;i<e.imagesToLoad.length;i+=1){var s=e.imagesToLoad[i];e.loadImage(s,s.currentSrc||s.getAttribute("src"),s.srcset||s.getAttribute("srcset"),s.sizes||s.getAttribute("sizes"),!0,t)}}}},P={},k=function(e){function i(){for(var s,a,r,n=[],o=arguments.length;o--;)n[o]=arguments[o];1===n.length&&n[0].constructor&&n[0].constructor===Object?a=n[0]:(s=(r=n)[0],a=r[1]),a||(a={}),a=l.extend({},a),s&&!a.el&&(a.el=s),e.call(this,a),Object.keys(z).forEach(function(e){Object.keys(z[e]).forEach(function(t){i.prototype[t]||(i.prototype[t]=z[e][t])})});var d=this;void 0===d.modules&&(d.modules={}),Object.keys(d.modules).forEach(function(e){var t=d.modules[e];if(t.params){var i=Object.keys(t.params)[0],s=t.params[i];if("object"!=typeof s)return;if(!(i in a&&"enabled"in s))return;!0===a[i]&&(a[i]={enabled:!0}),"object"!=typeof a[i]||"enabled"in a[i]||(a[i].enabled=!0),a[i]||(a[i]={enabled:!1})}});var p=l.extend({},M);d.useModulesParams(p),d.params=l.extend({},p,P,a),d.originalParams=l.extend({},d.params),d.passedParams=l.extend({},a);var c=t(d.params.el);if(s=c[0]){if(c.length>1){var u=[];return c.each(function(e,t){var s=l.extend({},a,{el:t});u.push(new i(s))}),u}s.swiper=d,c.data("swiper",d);var f,v,m=c.children("."+d.params.wrapperClass);return l.extend(d,{$el:c,el:s,$wrapperEl:m,wrapperEl:m[0],classNames:[],slides:t(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:function(){return"horizontal"===d.params.direction},isVertical:function(){return"vertical"===d.params.direction},rtl:"horizontal"===d.params.direction&&("rtl"===s.dir.toLowerCase()||"rtl"===c.css("direction")),wrongRTL:"-webkit-box"===m.css("display"),activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,progress:0,velocity:0,animating:!1,allowSlideNext:d.params.allowSlideNext,allowSlidePrev:d.params.allowSlidePrev,touchEvents:(f=["touchstart","touchmove","touchend"],v=["mousedown","mousemove","mouseup"],h.pointerEvents?v=["pointerdown","pointermove","pointerup"]:h.prefixedPointerEvents&&(v=["MSPointerDown","MSPointerMove","MSPointerUp"]),{start:h.touch||!d.params.simulateTouch?f[0]:v[0],move:h.touch||!d.params.simulateTouch?f[1]:v[1],end:h.touch||!d.params.simulateTouch?f[2]:v[2]}),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,formElements:"input, select, option, textarea, button, video",lastClickTime:l.now(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:d.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),d.useModules(),d.params.init&&d.init(),d}}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var s={extendedDefaults:{configurable:!0},defaults:{configurable:!0},Class:{configurable:!0},$:{configurable:!0}};return i.prototype.slidesPerViewDynamic=function(){var e=this.params,t=this.slides,i=this.slidesGrid,s=this.size,a=this.activeIndex,r=1;if(e.centeredSlides){for(var n,o=t[a].swiperSlideSize,l=a+1;l<t.length;l+=1)t[l]&&!n&&(r+=1,(o+=t[l].swiperSlideSize)>s&&(n=!0));for(var d=a-1;d>=0;d-=1)t[d]&&!n&&(r+=1,(o+=t[d].swiperSlideSize)>s&&(n=!0))}else for(var h=a+1;h<t.length;h+=1)i[h]-i[a]<s&&(r+=1);return r},i.prototype.update=function(){function t(){var t=e.rtl?-1*e.translate:e.translate,i=Math.min(Math.max(t,e.maxTranslate()),e.minTranslate());e.setTranslate(i),e.updateActiveIndex(),e.updateSlidesClasses()}var e=this;e&&!e.destroyed&&(e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.params.freeMode?(t(),e.params.autoHeight&&e.updateAutoHeight()):(("auto"===e.params.slidesPerView||e.params.slidesPerView>1)&&e.isEnd&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0))||t(),e.emit("update"))},i.prototype.init=function(){this.initialized||(this.emit("beforeInit"),this.params.breakpoints&&this.setBreakpoint(),this.addClasses(),this.params.loop&&this.loopCreate(),this.updateSize(),this.updateSlides(),this.params.watchOverflow&&this.checkOverflow(),this.params.grabCursor&&this.setGrabCursor(),this.params.preloadImages&&this.preloadImages(),this.params.loop?this.slideTo(this.params.initialSlide+this.loopedSlides,0,this.params.runCallbacksOnInit):this.slideTo(this.params.initialSlide,0,this.params.runCallbacksOnInit),this.attachEvents(),this.initialized=!0,this.emit("init"))},i.prototype.destroy=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var i=this,s=i.params,a=i.$el,r=i.$wrapperEl,n=i.slides;i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),s.loop&&i.loopDestroy(),t&&(i.removeClasses(),a.removeAttr("style"),r.removeAttr("style"),n&&n.length&&n.removeClass([s.slideVisibleClass,s.slideActiveClass,s.slideNextClass,s.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index").removeAttr("data-swiper-column").removeAttr("data-swiper-row")),i.emit("destroy"),Object.keys(i.eventsListeners).forEach(function(e){i.off(e)}),!1!==e&&(i.$el[0].swiper=null,i.$el.data("swiper",null),l.deleteProps(i)),i.destroyed=!0},i.extendDefaults=function(e){l.extend(P,e)},s.extendedDefaults.get=function(){return P},s.defaults.get=function(){return M},s.Class.get=function(){return e},s.$.get=function(){return t},Object.defineProperties(i,s),i}(p),$={name:"device",proto:{device:y},static:{device:y}},L={name:"support",proto:{support:h},static:{support:h}},I=function(){return{isSafari:(e=o.navigator.userAgent.toLowerCase(),e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(o.navigator.userAgent)};var e}(),D={name:"browser",proto:{browser:I},static:{browser:I}},O={name:"resize",create:function(){var e=this;l.extend(e,{resize:{resizeHandler:function(){e&&!e.destroyed&&e.initialized&&(e.emit("beforeResize"),e.emit("resize"))},orientationChangeHandler:function(){e&&!e.destroyed&&e.initialized&&e.emit("orientationchange")}}})},on:{init:function(){o.addEventListener("resize",this.resize.resizeHandler),o.addEventListener("orientationchange",this.resize.orientationChangeHandler)},destroy:function(){o.removeEventListener("resize",this.resize.resizeHandler),o.removeEventListener("orientationchange",this.resize.orientationChangeHandler)}}},A={func:o.MutationObserver||o.WebkitMutationObserver,attach:function(e,t){void 0===t&&(t={});var i=this,s=new(0,A.func)(function(e){e.forEach(function(e){i.emit("observerUpdate",e)})});s.observe(e,{attributes:void 0===t.attributes||t.attributes,childList:void 0===t.childList||t.childList,characterData:void 0===t.characterData||t.characterData}),i.observer.observers.push(s)},init:function(){if(h.observer&&this.params.observer){if(this.params.observeParents)for(var e=this.$el.parents(),t=0;t<e.length;t+=1)this.observer.attach(e[t]);this.observer.attach(this.$el[0],{childList:!1}),this.observer.attach(this.$wrapperEl[0],{attributes:!1})}},destroy:function(){this.observer.observers.forEach(function(e){e.disconnect()}),this.observer.observers=[]}},H={name:"observer",params:{observer:!1,observeParents:!1},create:function(){l.extend(this,{observer:{init:A.init.bind(this),attach:A.attach.bind(this),destroy:A.destroy.bind(this),observers:[]}})},on:{init:function(){this.observer.init()},destroy:function(){this.observer.destroy()}}},N={update:function(e){function x(){t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),t.lazy&&t.params.lazy.enabled&&t.lazy.load()}var t=this,i=t.params,s=i.slidesPerView,a=i.slidesPerGroup,r=i.centeredSlides,n=t.virtual,o=n.from,d=n.to,h=n.slides,p=n.slidesGrid,c=n.renderSlide,u=n.offset;t.updateActiveIndex();var f,v,m,g=t.activeIndex||0;f=t.rtl&&t.isHorizontal()?"right":t.isHorizontal()?"left":"top",r?(v=Math.floor(s/2)+a,m=Math.floor(s/2)+a):(v=s+(a-1),m=a);var b=Math.max((g||0)-m,0),w=Math.min((g||0)+v,h.length-1),y=(t.slidesGrid[b]||0)-(t.slidesGrid[0]||0);if(l.extend(t.virtual,{from:b,to:w,offset:y,slidesGrid:t.slidesGrid}),o===b&&d===w&&!e)return t.slidesGrid!==p&&y!==u&&t.slides.css(f,y+"px"),void t.updateProgress();if(t.params.virtual.renderExternal)return t.params.virtual.renderExternal.call(t,{offset:y,from:b,to:w,slides:function(){for(var e=[],t=b;t<=w;t+=1)e.push(h[t]);return e}()}),void x();var T=[],E=[];if(e)t.$wrapperEl.find("."+t.params.slideClass).remove();else for(var S=o;S<=d;S+=1)(S<b||S>w)&&t.$wrapperEl.find("."+t.params.slideClass+'[data-swiper-slide-index="'+S+'"]').remove();for(var C=0;C<h.length;C+=1)C>=b&&C<=w&&(void 0===d||e?E.push(C):(C>d&&E.push(C),C<o&&T.push(C)));E.forEach(function(e){t.$wrapperEl.append(c(h[e],e))}),T.sort(function(e,t){return e<t}).forEach(function(e){t.$wrapperEl.prepend(c(h[e],e))}),t.$wrapperEl.children(".swiper-slide").css(f,y+"px"),x()},renderSlide:function(e,i){var s=this.params.virtual;if(s.cache&&this.virtual.cache[i])return this.virtual.cache[i];var a=t(s.renderSlide?s.renderSlide.call(this,e,i):'<div class="'+this.params.slideClass+'" data-swiper-slide-index="'+i+'">'+e+"</div>");return a.attr("data-swiper-slide-index")||a.attr("data-swiper-slide-index",i),s.cache&&(this.virtual.cache[i]=a),a},appendSlide:function(e){this.virtual.slides.push(e),this.virtual.update(!0)},prependSlide:function(e){if(this.virtual.slides.unshift(e),this.params.virtual.cache){var t=this.virtual.cache,i={};Object.keys(t).forEach(function(e){i[e+1]=t[e]}),this.virtual.cache=i}this.virtual.update(!0),this.slideNext(0)}},X={name:"virtual",params:{virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null}},create:function(){l.extend(this,{virtual:{update:N.update.bind(this),appendSlide:N.appendSlide.bind(this),prependSlide:N.prependSlide.bind(this),renderSlide:N.renderSlide.bind(this),slides:this.params.virtual.slides,cache:{}}})},on:{beforeInit:function(){if(this.params.virtual.enabled){this.classNames.push(this.params.containerModifierClass+"virtual");var e={watchSlidesProgress:!0};l.extend(this.params,e),l.extend(this.originalParams,e),this.virtual.update()}},setTranslate:function(){this.params.virtual.enabled&&this.virtual.update()}}},Y={handle:function(e){var t=e;t.originalEvent&&(t=t.originalEvent);var i=t.keyCode||t.charCode;if(!this.allowSlideNext&&(this.isHorizontal()&&39===i||this.isVertical()&&40===i))return!1;if(!this.allowSlidePrev&&(this.isHorizontal()&&37===i||this.isVertical()&&38===i))return!1;if(!(t.shiftKey||t.altKey||t.ctrlKey||t.metaKey||d.activeElement&&d.activeElement.nodeName&&("input"===d.activeElement.nodeName.toLowerCase()||"textarea"===d.activeElement.nodeName.toLowerCase()))){if(this.params.keyboard.onlyInViewport&&(37===i||39===i||38===i||40===i)){var s=!1;if(this.$el.parents("."+this.params.slideClass).length>0&&0===this.$el.parents("."+this.params.slideActiveClass).length)return;var a=o.pageXOffset,r=o.pageYOffset,n=o.innerWidth,l=o.innerHeight,h=this.$el.offset();this.rtl&&(h.left-=this.$el[0].scrollLeft);for(var p=[[h.left,h.top],[h.left+this.width,h.top],[h.left,h.top+this.height],[h.left+this.width,h.top+this.height]],c=0;c<p.length;c+=1){var u=p[c];u[0]>=a&&u[0]<=a+n&&u[1]>=r&&u[1]<=r+l&&(s=!0)}if(!s)return}this.isHorizontal()?(37!==i&&39!==i||(t.preventDefault?t.preventDefault():t.returnValue=!1),(39===i&&!this.rtl||37===i&&this.rtl)&&this.slideNext(),(37===i&&!this.rtl||39===i&&this.rtl)&&this.slidePrev()):(38!==i&&40!==i||(t.preventDefault?t.preventDefault():t.returnValue=!1),40===i&&this.slideNext(),38===i&&this.slidePrev()),this.emit("keyPress",i)}},enable:function(){this.keyboard.enabled||(t(d).on("keydown",this.keyboard.handle),this.keyboard.enabled=!0)},disable:function(){this.keyboard.enabled&&(t(d).off("keydown",this.keyboard.handle),this.keyboard.enabled=!1)}},G={name:"keyboard",params:{keyboard:{enabled:!1,onlyInViewport:!0}},create:function(){l.extend(this,{keyboard:{enabled:!1,enable:Y.enable.bind(this),disable:Y.disable.bind(this),handle:Y.handle.bind(this)}})},on:{init:function(){this.params.keyboard.enabled&&this.keyboard.enable()},destroy:function(){this.keyboard.enabled&&this.keyboard.disable()}}},B={lastScrollTime:l.now(),event:o.navigator.userAgent.indexOf("firefox")>-1?"DOMMouseScroll":function(){var e="onwheel"in d;if(!e){var t=d.createElement("div");t.setAttribute("onwheel","return;"),e="function"==typeof t.onwheel}return!e&&d.implementation&&d.implementation.hasFeature&&!0!==d.implementation.hasFeature("","")&&(e=d.implementation.hasFeature("Events.wheel","3.0")),e}()?"wheel":"mousewheel",normalize:function(e){var t=0,i=0,s=0,a=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=i,i=0),s=10*t,a=10*i,"deltaY"in e&&(a=e.deltaY),"deltaX"in e&&(s=e.deltaX),(s||a)&&e.deltaMode&&(1===e.deltaMode?(s*=40,a*=40):(s*=800,a*=800)),s&&!t&&(t=s<1?-1:1),a&&!i&&(i=a<1?-1:1),{spinX:t,spinY:i,pixelX:s,pixelY:a}},handle:function(e){var t=e,i=this,s=i.params.mousewheel;t.originalEvent&&(t=t.originalEvent);var a=0,r=i.rtl?-1:1,n=B.normalize(t);if(s.forceToAxis)if(i.isHorizontal()){if(!(Math.abs(n.pixelX)>Math.abs(n.pixelY)))return!0;a=n.pixelX*r}else{if(!(Math.abs(n.pixelY)>Math.abs(n.pixelX)))return!0;a=n.pixelY}else a=Math.abs(n.pixelX)>Math.abs(n.pixelY)?-n.pixelX*r:-n.pixelY;if(0===a)return!0;if(s.invert&&(a=-a),i.params.freeMode){var d=i.getTranslate()+a*s.sensitivity,h=i.isBeginning,p=i.isEnd;if(d>=i.minTranslate()&&(d=i.minTranslate()),d<=i.maxTranslate()&&(d=i.maxTranslate()),i.setTransition(0),i.setTranslate(d),i.updateProgress(),i.updateActiveIndex(),i.updateSlidesClasses(),(!h&&i.isBeginning||!p&&i.isEnd)&&i.updateSlidesClasses(),i.params.freeModeSticky&&(clearTimeout(i.mousewheel.timeout),i.mousewheel.timeout=l.nextTick(function(){i.slideReset()},300)),i.emit("scroll",t),i.params.autoplay&&i.params.autoplayDisableOnInteraction&&i.stopAutoplay(),0===d||d===i.maxTranslate())return!0}else{if(l.now()-i.mousewheel.lastScrollTime>60)if(a<0)if(i.isEnd&&!i.params.loop||i.animating){if(s.releaseOnEdges)return!0}else i.slideNext(),i.emit("scroll",t);else if(i.isBeginning&&!i.params.loop||i.animating){if(s.releaseOnEdges)return!0}else i.slidePrev(),i.emit("scroll",t);i.mousewheel.lastScrollTime=(new o.Date).getTime()}return t.preventDefault?t.preventDefault():t.returnValue=!1,!1},enable:function(){if(!B.event)return!1;if(this.mousewheel.enabled)return!1;var e=this.$el;return"container"!==this.params.mousewheel.eventsTarged&&(e=t(this.params.mousewheel.eventsTarged)),e.on(B.event,this.mousewheel.handle),this.mousewheel.enabled=!0,!0},disable:function(){if(!B.event)return!1;if(!this.mousewheel.enabled)return!1;var e=this.$el;return"container"!==this.params.mousewheel.eventsTarged&&(e=t(this.params.mousewheel.eventsTarged)),e.off(B.event,this.mousewheel.handle),this.mousewheel.enabled=!1,!0}},V={update:function(){var e=this.params.navigation;if(!this.params.loop){var t=this.navigation,i=t.$nextEl,s=t.$prevEl;s&&s.length>0&&(this.isBeginning?s.addClass(e.disabledClass):s.removeClass(e.disabledClass),s[this.params.watchOverflow&&this.isLocked?"addClass":"removeClass"](e.lockClass)),i&&i.length>0&&(this.isEnd?i.addClass(e.disabledClass):i.removeClass(e.disabledClass),i[this.params.watchOverflow&&this.isLocked?"addClass":"removeClass"](e.lockClass))}},init:function(){var e,i,s=this,a=s.params.navigation;(a.nextEl||a.prevEl)&&(a.nextEl&&(e=t(a.nextEl),s.params.uniqueNavElements&&"string"==typeof a.nextEl&&e.length>1&&1===s.$el.find(a.nextEl).length&&(e=s.$el.find(a.nextEl))),a.prevEl&&(i=t(a.prevEl),s.params.uniqueNavElements&&"string"==typeof a.prevEl&&i.length>1&&1===s.$el.find(a.prevEl).length&&(i=s.$el.find(a.prevEl))),e&&e.length>0&&e.on("click",function(e){e.preventDefault(),s.isEnd&&!s.params.loop||s.slideNext()}),i&&i.length>0&&i.on("click",function(e){e.preventDefault(),s.isBeginning&&!s.params.loop||s.slidePrev()}),l.extend(s.navigation,{$nextEl:e,nextEl:e&&e[0],$prevEl:i,prevEl:i&&i[0]}))},destroy:function(){var e=this.navigation,t=e.$nextEl,i=e.$prevEl;t&&t.length&&(t.off("click"),t.removeClass(this.params.navigation.disabledClass)),i&&i.length&&(i.off("click"),i.removeClass(this.params.navigation.disabledClass))}},R={update:function(){var e=this.rtl,i=this.params.pagination;if(i.el&&this.pagination.el&&this.pagination.$el&&0!==this.pagination.$el.length){var s,a=this.virtual&&this.params.virtual.enabled?this.virtual.slides.length:this.slides.length,r=this.pagination.$el,n=this.params.loop?Math.ceil((a-2*this.loopedSlides)/this.params.slidesPerGroup):this.snapGrid.length;if(this.params.loop?((s=Math.ceil((this.activeIndex-this.loopedSlides)/this.params.slidesPerGroup))>a-1-2*this.loopedSlides&&(s-=a-2*this.loopedSlides),s>n-1&&(s-=n),s<0&&"bullets"!==this.params.paginationType&&(s=n+s)):s=void 0!==this.snapIndex?this.snapIndex:this.activeIndex||0,"bullets"===i.type&&this.pagination.bullets&&this.pagination.bullets.length>0){var o=this.pagination.bullets;if(i.dynamicBullets&&(this.pagination.bulletSize=o.eq(0)[this.isHorizontal()?"outerWidth":"outerHeight"](!0),r.css(this.isHorizontal()?"width":"height",5*this.pagination.bulletSize+"px")),o.removeClass(i.bulletActiveClass+" "+i.bulletActiveClass+"-next "+i.bulletActiveClass+"-next-next "+i.bulletActiveClass+"-prev "+i.bulletActiveClass+"-prev-prev"),r.length>1)o.each(function(e,a){var r=t(a);r.index()===s&&(r.addClass(i.bulletActiveClass),i.dynamicBullets&&(r.prev().addClass(i.bulletActiveClass+"-prev").prev().addClass(i.bulletActiveClass+"-prev-prev"),r.next().addClass(i.bulletActiveClass+"-next").next().addClass(i.bulletActiveClass+"-next-next")))});else{var l=o.eq(s);l.addClass(i.bulletActiveClass),i.dynamicBullets&&(l.prev().addClass(i.bulletActiveClass+"-prev").prev().addClass(i.bulletActiveClass+"-prev-prev"),l.next().addClass(i.bulletActiveClass+"-next").next().addClass(i.bulletActiveClass+"-next-next"))}if(i.dynamicBullets){var d=Math.min(o.length,5),h=(this.pagination.bulletSize*d-this.pagination.bulletSize)/2-s*this.pagination.bulletSize,p=e?"right":"left";o.css(this.isHorizontal()?p:"top",h+"px")}}if("fraction"===i.type&&(r.find("."+i.currentClass).text(s+1),r.find("."+i.totalClass).text(n)),"progressbar"===i.type){var c=(s+1)/n,u=c,f=1;this.isHorizontal()||(f=c,u=1),r.find("."+i.progressbarFillClass).transform("translate3d(0,0,0) scaleX("+u+") scaleY("+f+")").transition(this.params.speed)}"custom"===i.type&&i.renderCustom?(r.html(i.renderCustom(this,s+1,n)),this.emit("paginationRender",this,r[0])):this.emit("paginationUpdate",this,r[0]),r[this.params.watchOverflow&&this.isLocked?"addClass":"removeClass"](i.lockClass)}},render:function(){var e=this.params.pagination;if(e.el&&this.pagination.el&&this.pagination.$el&&0!==this.pagination.$el.length){var t=this.virtual&&this.params.virtual.enabled?this.virtual.slides.length:this.slides.length,i=this.pagination.$el,s="";if("bullets"===e.type){for(var a=this.params.loop?Math.ceil((t-2*this.loopedSlides)/this.params.slidesPerGroup):this.snapGrid.length,r=0;r<a;r+=1)e.renderBullet?s+=e.renderBullet.call(this,r,e.bulletClass):s+="<"+e.bulletElement+' class="'+e.bulletClass+'"></'+e.bulletElement+">";i.html(s),this.pagination.bullets=i.find("."+e.bulletClass)}"fraction"===e.type&&(s=e.renderFraction?e.renderFraction.call(this,e.currentClass,e.totalClass):'<span class="'+e.currentClass+'"></span> / <span class="'+e.totalClass+'"></span>',i.html(s)),"progressbar"===e.type&&(s=e.renderProgressbar?e.renderProgressbar.call(this,e.progressbarFillClass):'<span class="'+e.progressbarFillClass+'"></span>',i.html(s)),"custom"!==e.type&&this.emit("paginationRender",this.pagination.$el[0])}},init:function(){var e=this,i=e.params.pagination;if(i.el){var s=t(i.el);0!==s.length&&(e.params.uniqueNavElements&&"string"==typeof i.el&&s.length>1&&1===e.$el.find(i.el).length&&(s=e.$el.find(i.el)),"bullets"===i.type&&i.clickable&&s.addClass(i.clickableClass),s.addClass(i.modifierClass+i.type),"bullets"===i.type&&i.dynamicBullets&&s.addClass(""+i.modifierClass+i.type+"-dynamic"),i.clickable&&s.on("click","."+i.bulletClass,function(i){i.preventDefault();var s=t(this).index()*e.params.slidesPerGroup;e.params.loop&&(s+=e.loopedSlides),e.slideTo(s)}),l.extend(e.pagination,{$el:s,el:s[0]}))}},destroy:function(){var e=this.params.pagination;if(e.el&&this.pagination.el&&this.pagination.$el&&0!==this.pagination.$el.length){var t=this.pagination.$el;t.removeClass(e.hiddenClass),t.removeClass(e.modifierClass+e.type),this.pagination.bullets&&this.pagination.bullets.removeClass(e.bulletActiveClass),e.clickable&&t.off("click","."+e.bulletClass)}}},F={setTranslate:function(){if(this.params.scrollbar.el&&this.scrollbar.el){var e=this.scrollbar,t=this.rtl,i=this.progress,s=e.dragSize,a=e.trackSize,r=e.$dragEl,n=e.$el,o=this.params.scrollbar,l=s,d=(a-s)*i;t&&this.isHorizontal()?(d=-d)>0?(l=s-d,d=0):-d+s>a&&(l=a+d):d<0?(l=s+d,d=0):d+s>a&&(l=a-d),this.isHorizontal()?(h.transforms3d?r.transform("translate3d("+d+"px, 0, 0)"):r.transform("translateX("+d+"px)"),r[0].style.width=l+"px"):(h.transforms3d?r.transform("translate3d(0px, "+d+"px, 0)"):r.transform("translateY("+d+"px)"),r[0].style.height=l+"px"),o.hide&&(clearTimeout(this.scrollbar.timeout),n[0].style.opacity=1,this.scrollbar.timeout=setTimeout(function(){n[0].style.opacity=0,n.transition(400)},1e3))}},setTransition:function(e){this.params.scrollbar.el&&this.scrollbar.el&&this.scrollbar.$dragEl.transition(e)},updateSize:function(){if(this.params.scrollbar.el&&this.scrollbar.el){var e=this.scrollbar,t=e.$dragEl,i=e.$el;t[0].style.width="",t[0].style.height="";var s,a=this.isHorizontal()?i[0].offsetWidth:i[0].offsetHeight,r=this.size/this.virtualSize,n=r*(a/this.size);s="auto"===this.params.scrollbar.dragSize?a*r:parseInt(this.params.scrollbar.dragSize,10),this.isHorizontal()?t[0].style.width=s+"px":t[0].style.height=s+"px",i[0].style.display=r>=1?"none":"",this.params.scrollbarHide&&(i[0].style.opacity=0),l.extend(e,{trackSize:a,divider:r,moveDivider:n,dragSize:s}),e.$el[this.params.watchOverflow&&this.isLocked?"addClass":"removeClass"](this.params.scrollbar.lockClass)}},setDragPosition:function(e){var t,i=this.scrollbar,s=i.$el,a=i.dragSize,r=i.trackSize;t=((this.isHorizontal()?"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageX:e.pageX||e.clientX:"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageY:e.pageY||e.clientY)-s.offset()[this.isHorizontal()?"left":"top"]-a/2)/(r-a),t=Math.max(Math.min(t,1),0),this.rtl&&(t=1-t);var n=this.minTranslate()+(this.maxTranslate()-this.minTranslate())*t;this.updateProgress(n),this.setTranslate(n),this.updateActiveIndex(),this.updateSlidesClasses()},onDragStart:function(e){var t=this.params.scrollbar,i=this.scrollbar,s=this.$wrapperEl,a=i.$el,r=i.$dragEl;this.scrollbar.isTouched=!0,e.preventDefault(),e.stopPropagation(),s.transition(100),r.transition(100),i.setDragPosition(e),clearTimeout(this.scrollbar.dragTimeout),a.transition(0),t.hide&&a.css("opacity",1),this.emit("scrollbarDragStart",e)},onDragMove:function(e){var t=this.scrollbar,i=this.$wrapperEl,s=t.$el,a=t.$dragEl;this.scrollbar.isTouched&&(e.preventDefault?e.preventDefault():e.returnValue=!1,t.setDragPosition(e),i.transition(0),s.transition(0),a.transition(0),this.emit("scrollbarDragMove",e))},onDragEnd:function(e){var t=this.params.scrollbar,i=this.scrollbar.$el;this.scrollbar.isTouched&&(this.scrollbar.isTouched=!1,t.hide&&(clearTimeout(this.scrollbar.dragTimeout),this.scrollbar.dragTimeout=l.nextTick(function(){i.css("opacity",0),i.transition(400)},1e3)),this.emit("scrollbarDragEnd",e),t.snapOnRelease&&this.slideReset())},enableDraggable:function(){if(this.params.scrollbar.el){var e=this.scrollbar.$el,i=h.touch?e[0]:document;e.on(this.scrollbar.dragEvents.start,this.scrollbar.onDragStart),t(i).on(this.scrollbar.dragEvents.move,this.scrollbar.onDragMove),t(i).on(this.scrollbar.dragEvents.end,this.scrollbar.onDragEnd)}},disableDraggable:function(){if(this.params.scrollbar.el){var e=this.scrollbar.$el,i=h.touch?e[0]:document;e.off(this.scrollbar.dragEvents.start),t(i).off(this.scrollbar.dragEvents.move),t(i).off(this.scrollbar.dragEvents.end)}},init:function(){var e=this;if(e.params.scrollbar.el){var i=e.scrollbar,s=e.$el,a=e.touchEvents,r=e.params.scrollbar,n=t(r.el);e.params.uniqueNavElements&&"string"==typeof r.el&&n.length>1&&1===s.find(r.el).length&&(n=s.find(r.el));var o=n.find(".swiper-scrollbar-drag");0===o.length&&(o=t('<div class="swiper-scrollbar-drag"></div>'),n.append(o)),e.scrollbar.dragEvents=!1!==e.params.simulateTouch||h.touch?a:{start:"mousedown",move:"mousemove",end:"mouseup"},l.extend(i,{$el:n,el:n[0],$dragEl:o,dragEl:o[0]}),r.draggable&&i.enableDraggable()}},destroy:function(){this.scrollbar.disableDraggable()}},W={setTransform:function(e,i){var s=this.rtl,a=t(e),r=s?-1:1,n=a.attr("data-swiper-parallax")||"0",o=a.attr("data-swiper-parallax-x"),l=a.attr("data-swiper-parallax-y"),d=a.attr("data-swiper-parallax-scale"),h=a.attr("data-swiper-parallax-opacity");if(o||l?(o=o||"0",l=l||"0"):this.isHorizontal()?(o=n,l="0"):(l=n,o="0"),o=o.indexOf("%")>=0?parseInt(o,10)*i*r+"%":o*i*r+"px",l=l.indexOf("%")>=0?parseInt(l,10)*i+"%":l*i+"px",void 0!==h&&null!==h){var p=h-(h-1)*(1-Math.abs(i));a[0].style.opacity=p}if(void 0===d||null===d)a.transform("translate3d("+o+", "+l+", 0px)");else{var c=d-(d-1)*(1-Math.abs(i));a.transform("translate3d("+o+", "+l+", 0px) scale("+c+")")}},setTranslate:function(){var e=this,i=e.$el,s=e.slides,a=e.progress,r=e.snapGrid;i.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(t,i){e.parallax.setTransform(i,a)}),s.each(function(i,s){var n=s.progress;e.params.slidesPerGroup>1&&"auto"!==e.params.slidesPerView&&(n+=Math.ceil(i/2)-a*(r.length-1)),n=Math.min(Math.max(n,-1),1),t(s).find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(t,i){e.parallax.setTransform(i,n)})})},setTransition:function(e){void 0===e&&(e=this.params.speed),this.$el.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(i,s){var a=t(s),r=parseInt(a.attr("data-swiper-parallax-duration"),10)||e;0===e&&(r=0),a.transition(r)})}},j={getDistanceBetweenTouches:function(e){if(e.targetTouches.length<2)return 1;var t=e.targetTouches[0].pageX,i=e.targetTouches[0].pageY,s=e.targetTouches[1].pageX,a=e.targetTouches[1].pageY;return Math.sqrt(Math.pow(s-t,2)+Math.pow(a-i,2))},onGestureStart:function(e){var i=this.params.zoom,s=this.zoom,a=s.gesture;if(s.fakeGestureTouched=!1,s.fakeGestureMoved=!1,!h.gestures){if("touchstart"!==e.type||"touchstart"===e.type&&e.targetTouches.length<2)return;s.fakeGestureTouched=!0,a.scaleStart=j.getDistanceBetweenTouches(e)}a.$slideEl&&a.$slideEl.length||(a.$slideEl=t(this),0===a.$slideEl.length&&(a.$slideEl=this.slides.eq(this.activeIndex)),a.$imageEl=a.$slideEl.find("img, svg, canvas"),a.$imageWrapEl=a.$imageEl.parent("."+i.containerClass),a.maxRatio=a.$imageWrapEl.attr("data-swiper-zoom")||i.maxRatio,0!==a.$imageWrapEl.length)?(a.$imageEl.transition(0),this.zoom.isScaling=!0):a.$imageEl=void 0},onGestureChange:function(e){var t=this.params.zoom,i=this.zoom,s=i.gesture;if(!h.gestures){if("touchmove"!==e.type||"touchmove"===e.type&&e.targetTouches.length<2)return;i.fakeGestureMoved=!0,s.scaleMove=j.getDistanceBetweenTouches(e)}s.$imageEl&&0!==s.$imageEl.length&&(h.gestures?this.zoom.scale=e.scale*i.currentScale:i.scale=s.scaleMove/s.scaleStart*i.currentScale,i.scale>s.maxRatio&&(i.scale=s.maxRatio-1+Math.pow(i.scale-s.maxRatio+1,.5)),i.scale<t.minRatio&&(i.scale=t.minRatio+1-Math.pow(t.minRatio-i.scale+1,.5)),s.$imageEl.transform("translate3d(0,0,0) scale("+i.scale+")"))},onGestureEnd:function(e){var t=this.params.zoom,i=this.zoom,s=i.gesture;if(!h.gestures){if(!i.fakeGestureTouched||!i.fakeGestureMoved)return;if("touchend"!==e.type||"touchend"===e.type&&e.changedTouches.length<2&&!y.android)return;i.fakeGestureTouched=!1,i.fakeGestureMoved=!1}s.$imageEl&&0!==s.$imageEl.length&&(i.scale=Math.max(Math.min(i.scale,s.maxRatio),t.minRatio),s.$imageEl.transition(this.params.speed).transform("translate3d(0,0,0) scale("+i.scale+")"),i.currentScale=i.scale,i.isScaling=!1,1===i.scale&&(s.$slideEl=void 0))},onTouchStart:function(e){var t=this.zoom,i=t.gesture,s=t.image;i.$imageEl&&0!==i.$imageEl.length&&(s.isTouched||(y.android&&e.preventDefault(),s.isTouched=!0,s.touchesStart.x="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,s.touchesStart.y="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY))},onTouchMove:function(e){var t=this.zoom,i=t.gesture,s=t.image,a=t.velocity;if(i.$imageEl&&0!==i.$imageEl.length&&(this.allowClick=!1,s.isTouched&&i.$slideEl)){s.isMoved||(s.width=i.$imageEl[0].offsetWidth,s.height=i.$imageEl[0].offsetHeight,s.startX=l.getTranslate(i.$imageWrapEl[0],"x")||0,s.startY=l.getTranslate(i.$imageWrapEl[0],"y")||0,i.slideWidth=i.$slideEl[0].offsetWidth,i.slideHeight=i.$slideEl[0].offsetHeight,i.$imageWrapEl.transition(0),this.rtl&&(s.startX=-s.startX),this.rtl&&(s.startY=-s.startY));var r=s.width*t.scale,n=s.height*t.scale;if(!(r<i.slideWidth&&n<i.slideHeight)){if(s.minX=Math.min(i.slideWidth/2-r/2,0),s.maxX=-s.minX,s.minY=Math.min(i.slideHeight/2-n/2,0),s.maxY=-s.minY,s.touchesCurrent.x="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,s.touchesCurrent.y="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,!s.isMoved&&!t.isScaling){if(this.isHorizontal()&&(Math.floor(s.minX)===Math.floor(s.startX)&&s.touchesCurrent.x<s.touchesStart.x||Math.floor(s.maxX)===Math.floor(s.startX)&&s.touchesCurrent.x>s.touchesStart.x))return void(s.isTouched=!1);if(!this.isHorizontal()&&(Math.floor(s.minY)===Math.floor(s.startY)&&s.touchesCurrent.y<s.touchesStart.y||Math.floor(s.maxY)===Math.floor(s.startY)&&s.touchesCurrent.y>s.touchesStart.y))return void(s.isTouched=!1)}e.preventDefault(),e.stopPropagation(),s.isMoved=!0,s.currentX=s.touchesCurrent.x-s.touchesStart.x+s.startX,s.currentY=s.touchesCurrent.y-s.touchesStart.y+s.startY,s.currentX<s.minX&&(s.currentX=s.minX+1-Math.pow(s.minX-s.currentX+1,.8)),s.currentX>s.maxX&&(s.currentX=s.maxX-1+Math.pow(s.currentX-s.maxX+1,.8)),s.currentY<s.minY&&(s.currentY=s.minY+1-Math.pow(s.minY-s.currentY+1,.8)),s.currentY>s.maxY&&(s.currentY=s.maxY-1+Math.pow(s.currentY-s.maxY+1,.8)),a.prevPositionX||(a.prevPositionX=s.touchesCurrent.x),a.prevPositionY||(a.prevPositionY=s.touchesCurrent.y),a.prevTime||(a.prevTime=Date.now()),a.x=(s.touchesCurrent.x-a.prevPositionX)/(Date.now()-a.prevTime)/2,a.y=(s.touchesCurrent.y-a.prevPositionY)/(Date.now()-a.prevTime)/2,Math.abs(s.touchesCurrent.x-a.prevPositionX)<2&&(a.x=0),Math.abs(s.touchesCurrent.y-a.prevPositionY)<2&&(a.y=0),a.prevPositionX=s.touchesCurrent.x,a.prevPositionY=s.touchesCurrent.y,a.prevTime=Date.now(),i.$imageWrapEl.transform("translate3d("+s.currentX+"px, "+s.currentY+"px,0)")}}},onTouchEnd:function(){var e=this.zoom,t=e.gesture,i=e.image,s=e.velocity;if(t.$imageEl&&0!==t.$imageEl.length){if(!i.isTouched||!i.isMoved)return i.isTouched=!1,void(i.isMoved=!1);i.isTouched=!1,i.isMoved=!1;var a=300,r=300,n=s.x*a,o=i.currentX+n,l=s.y*r,d=i.currentY+l;0!==s.x&&(a=Math.abs((o-i.currentX)/s.x)),0!==s.y&&(r=Math.abs((d-i.currentY)/s.y));var h=Math.max(a,r);i.currentX=o,i.currentY=d;var p=i.width*e.scale,c=i.height*e.scale;i.minX=Math.min(t.slideWidth/2-p/2,0),i.maxX=-i.minX,i.minY=Math.min(t.slideHeight/2-c/2,0),i.maxY=-i.minY,i.currentX=Math.max(Math.min(i.currentX,i.maxX),i.minX),i.currentY=Math.max(Math.min(i.currentY,i.maxY),i.minY),t.$imageWrapEl.transition(h).transform("translate3d("+i.currentX+"px, "+i.currentY+"px,0)")}},onTransitionEnd:function(){var e=this.zoom,t=e.gesture;t.$slideEl&&this.previousIndex!==this.activeIndex&&(t.$imageEl.transform("translate3d(0,0,0) scale(1)"),t.$imageWrapEl.transform("translate3d(0,0,0)"),t.$slideEl=void 0,t.$imageEl=void 0,t.$imageWrapEl=void 0,e.scale=1,e.currentScale=1)},toggle:function(e){var t=this.zoom;t.scale&&1!==t.scale?t.out():t.in(e)},in:function(e){var i,s,a,r,n,o,l,d,h,p,c,u,f,v,m,g,b=this.zoom,w=this.params.zoom,y=b.gesture,x=b.image;y.$slideEl||(y.$slideEl=this.clickedSlide?t(this.clickedSlide):this.slides.eq(this.activeIndex),y.$imageEl=y.$slideEl.find("img, svg, canvas"),y.$imageWrapEl=y.$imageEl.parent("."+w.containerClass)),y.$imageEl&&0!==y.$imageEl.length&&(y.$slideEl.addClass(""+w.zoomedSlideClass),void 0===x.touchesStart.x&&e?(i="touchend"===e.type?e.changedTouches[0].pageX:e.pageX,s="touchend"===e.type?e.changedTouches[0].pageY:e.pageY):(i=x.touchesStart.x,s=x.touchesStart.y),b.scale=y.$imageWrapEl.attr("data-swiper-zoom")||w.maxRatio,b.currentScale=y.$imageWrapEl.attr("data-swiper-zoom")||w.maxRatio,e?(m=y.$slideEl[0].offsetWidth,g=y.$slideEl[0].offsetHeight,a=y.$slideEl.offset().left+m/2-i,r=y.$slideEl.offset().top+g/2-s,l=y.$imageEl[0].offsetWidth,d=y.$imageEl[0].offsetHeight,h=l*b.scale,p=d*b.scale,f=-(c=Math.min(m/2-h/2,0)),v=-(u=Math.min(g/2-p/2,0)),n=a*b.scale,o=r*b.scale,n<c&&(n=c),n>f&&(n=f),o<u&&(o=u),o>v&&(o=v)):(n=0,o=0),y.$imageWrapEl.transition(300).transform("translate3d("+n+"px, "+o+"px,0)"),y.$imageEl.transition(300).transform("translate3d(0,0,0) scale("+b.scale+")"))},out:function(){var e=this.zoom,i=this.params.zoom,s=e.gesture;s.$slideEl||(s.$slideEl=this.clickedSlide?t(this.clickedSlide):this.slides.eq(this.activeIndex),s.$imageEl=s.$slideEl.find("img, svg, canvas"),s.$imageWrapEl=s.$imageEl.parent("."+i.containerClass)),s.$imageEl&&0!==s.$imageEl.length&&(e.scale=1,e.currentScale=1,s.$imageWrapEl.transition(300).transform("translate3d(0,0,0)"),s.$imageEl.transition(300).transform("translate3d(0,0,0) scale(1)"),s.$slideEl.removeClass(""+i.zoomedSlideClass),s.$slideEl=void 0)},enable:function(){var e=this,i=e.zoom;if(!i.enabled){i.enabled=!0;var s=e.slides,a=!("touchstart"!==e.touchEvents.start||!h.passiveListener||!e.params.passiveListeners)&&{passive:!0,capture:!1};h.gestures?(s.on("gesturestart",i.onGestureStart,a),s.on("gesturechange",i.onGestureChange,a),s.on("gestureend",i.onGestureEnd,a)):"touchstart"===e.touchEvents.start&&(s.on(e.touchEvents.start,i.onGestureStart,a),s.on(e.touchEvents.move,i.onGestureChange,a),s.on(e.touchEvents.end,i.onGestureEnd,a)),e.slides.each(function(s,a){var r=t(a);r.find("."+e.params.zoom.containerClass).length>0&&r.on(e.touchEvents.move,i.onTouchMove)})}},disable:function(){var e=this,i=e.zoom;if(i.enabled){e.zoom.enabled=!1;var s=e.slides,a=!("touchstart"!==e.touchEvents.start||!h.passiveListener||!e.params.passiveListeners)&&{passive:!0,capture:!1};h.gestures?(s.off("gesturestart",i.onGestureStart,a),s.off("gesturechange",i.onGestureChange,a),s.off("gestureend",i.onGestureEnd,a)):"touchstart"===e.touchEvents.start&&(s.off(e.touchEvents.start,i.onGestureStart,a),s.off(e.touchEvents.move,i.onGestureChange,a),s.off(e.touchEvents.end,i.onGestureEnd,a)),e.slides.each(function(s,a){var r=t(a);r.find("."+e.params.zoom.containerClass).length>0&&r.off(e.touchEvents.move,i.onTouchMove)})}}},q={loadInSlide:function(e,i){void 0===i&&(i=!0);var s=this,a=s.params.lazy;if(void 0!==e&&0!==s.slides.length){var r=s.virtual&&s.params.virtual.enabled?s.$wrapperEl.children("."+s.params.slideClass+'[data-swiper-slide-index="'+e+'"]'):s.slides.eq(e),n=r.find("."+a.elementClass+":not(."+a.loadedClass+"):not(."+a.loadingClass+")");!r.hasClass(a.elementClass)||r.hasClass(a.loadedClass)||r.hasClass(a.loadingClass)||(n=n.add(r[0])),0!==n.length&&n.each(function(e,n){var o=t(n);o.addClass(a.loadingClass);var l=o.attr("data-background"),d=o.attr("data-src"),h=o.attr("data-srcset"),p=o.attr("data-sizes");s.loadImage(o[0],d||l,h,p,!1,function(){if(void 0!==s&&null!==s&&s&&(!s||s.params)&&!s.destroyed){if(l?(o.css("background-image",'url("'+l+'")'),o.removeAttr("data-background")):(h&&(o.attr("srcset",h),o.removeAttr("data-srcset")),p&&(o.attr("sizes",p),o.removeAttr("data-sizes")),d&&(o.attr("src",d),o.removeAttr("data-src"))),o.addClass(a.loadedClass).removeClass(a.loadingClass),r.find("."+a.preloaderClass).remove(),s.params.loop&&i){var e=r.attr("data-swiper-slide-index");if(r.hasClass(s.params.slideDuplicateClass)){var t=s.$wrapperEl.children('[data-swiper-slide-index="'+e+'"]:not(.'+s.params.slideDuplicateClass+")");s.lazy.loadInSlide(t.index(),!1)}else{var n=s.$wrapperEl.children("."+s.params.slideDuplicateClass+'[data-swiper-slide-index="'+e+'"]');s.lazy.loadInSlide(n.index(),!1)}}s.emit("lazyImageReady",r[0],o[0])}}),s.emit("lazyImageLoad",r[0],o[0])})}},load:function(){function d(e){if(n){if(i.children("."+s.slideClass+'[data-swiper-slide-index="'+e+'"]').length)return!0}else if(a[e])return!0;return!1}function h(e){return n?t(e).attr("data-swiper-slide-index"):t(e).index()}var e=this,i=e.$wrapperEl,s=e.params,a=e.slides,r=e.activeIndex,n=e.virtual&&s.virtual.enabled,o=s.lazy,l=s.slidesPerView;if("auto"===l&&(l=0),e.lazy.initialImageLoaded||(e.lazy.initialImageLoaded=!0),e.params.watchSlidesVisibility)i.children("."+s.slideVisibleClass).each(function(i,s){var a=n?t(s).attr("data-swiper-slide-index"):t(s).index();e.lazy.loadInSlide(a)});else if(l>1)for(var p=r;p<r+l;p+=1)d(p)&&e.lazy.loadInSlide(p);else e.lazy.loadInSlide(r);if(o.loadPrevNext)if(l>1||o.loadPrevNextAmount&&o.loadPrevNextAmount>1){for(var c=o.loadPrevNextAmount,u=l,f=Math.min(r+u+Math.max(c,u),a.length),v=Math.max(r-Math.max(u,c),0),m=r+l;m<f;m+=1)d(m)&&e.lazy.loadInSlide(m);for(var g=v;g<r;g+=1)d(g)&&e.lazy.loadInSlide(g)}else{var b=i.children("."+s.slideNextClass);b.length>0&&e.lazy.loadInSlide(h(b));var w=i.children("."+s.slidePrevClass);w.length>0&&e.lazy.loadInSlide(h(w))}}},K={LinearSpline:function(e,t){var i,s,a,r,n,o=function(e,t){for(s=-1,i=e.length;i-s>1;)e[a=i+s>>1]<=t?s=a:i=a;return i};return this.x=e,this.y=t,this.lastIndex=e.length-1,this.interpolate=function(e){return e?(n=o(this.x,e),r=n-1,(e-this.x[r])*(this.y[n]-this.y[r])/(this.x[n]-this.x[r])+this.y[r]):0},this},getInterpolateFunction:function(e){this.controller.spline||(this.controller.spline=this.params.loop?new K.LinearSpline(this.slidesGrid,e.slidesGrid):new K.LinearSpline(this.snapGrid,e.snapGrid))},setTranslate:function(e,t){function n(e){var t=e.rtl&&"horizontal"===e.params.direction?-a.translate:a.translate;"slide"===a.params.controller.by&&(a.controller.getInterpolateFunction(e),s=-a.controller.spline.interpolate(-t)),s&&"container"!==a.params.controller.by||(i=(e.maxTranslate()-e.minTranslate())/(a.maxTranslate()-a.minTranslate()),s=(t-a.minTranslate())*i+e.minTranslate()),a.params.controller.inverse&&(s=e.maxTranslate()-s),e.updateProgress(s),e.setTranslate(s,a),e.updateActiveIndex(),e.updateSlidesClasses()}var i,s,a=this,r=a.controller.control;if(Array.isArray(r))for(var o=0;o<r.length;o+=1)r[o]!==t&&r[o]instanceof k&&n(r[o]);else r instanceof k&&t!==r&&n(r)},setTransition:function(e,t){function r(t){t.setTransition(e,s),0!==e&&(t.transitionStart(),t.$wrapperEl.transitionEnd(function(){a&&(t.params.loop&&"slide"===s.params.controller.by&&t.loopFix(),t.transitionEnd())}))}var i,s=this,a=s.controller.control;if(Array.isArray(a))for(i=0;i<a.length;i+=1)a[i]!==t&&a[i]instanceof k&&r(a[i]);else a instanceof k&&t!==a&&r(a)}},U={makeElFocusable:function(e){return e.attr("tabIndex","0"),e},addElRole:function(e,t){return e.attr("role",t),e},addElLabel:function(e,t){return e.attr("aria-label",t),e},disableEl:function(e){return e.attr("aria-disabled",!0),e},enableEl:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){var i=this.params.a11y;if(13===e.keyCode){var s=t(e.target);this.navigation&&this.navigation.$nextEl&&s.is(this.navigation.$nextEl)&&(this.isEnd&&!this.params.loop||this.slideNext(),this.isEnd?this.a11y.notify(i.lastSlideMessage):this.a11y.notify(i.nextSlideMessage)),this.navigation&&this.navigation.$prevEl&&s.is(this.navigation.$prevEl)&&(this.isBeginning&&!this.params.loop||this.slidePrev(),this.isBeginning?this.a11y.notify(i.firstSlideMessage):this.a11y.notify(i.prevSlideMessage)),this.pagination&&s.is("."+this.params.pagination.bulletClass)&&s[0].click()}},notify:function(e){var t=this.a11y.liveRegion;0!==t.length&&(t.html(""),t.html(e))},updateNavigation:function(){if(!this.params.loop){var e=this.navigation,t=e.$nextEl,i=e.$prevEl;i&&i.length>0&&(this.isBeginning?this.a11y.disableEl(i):this.a11y.enableEl(i)),t&&t.length>0&&(this.isEnd?this.a11y.disableEl(t):this.a11y.enableEl(t))}},updatePagination:function(){var e=this,i=e.params.a11y;e.pagination&&e.params.pagination.clickable&&e.pagination.bullets&&e.pagination.bullets.length&&e.pagination.bullets.each(function(s,a){var r=t(a);e.a11y.makeElFocusable(r),e.a11y.addElRole(r,"button"),e.a11y.addElLabel(r,i.paginationBulletMessage.replace(/{{index}}/,r.index()+1))})},init:function(){this.$el.append(this.a11y.liveRegion);var e,t,i=this.params.a11y;this.navigation&&this.navigation.$nextEl&&(e=this.navigation.$nextEl),this.navigation&&this.navigation.$prevEl&&(t=this.navigation.$prevEl),e&&(this.a11y.makeElFocusable(e),this.a11y.addElRole(e,"button"),this.a11y.addElLabel(e,i.nextSlideMessage),e.on("keydown",this.a11y.onEnterKey)),t&&(this.a11y.makeElFocusable(t),this.a11y.addElRole(t,"button"),this.a11y.addElLabel(t,i.prevSlideMessage),t.on("keydown",this.a11y.onEnterKey)),this.pagination&&this.params.pagination.clickable&&this.pagination.bullets&&this.pagination.bullets.length&&this.pagination.$el.on("keydown","."+this.params.pagination.bulletClass,this.a11y.onEnterKey)},destroy:function(){var e,t;this.a11y.liveRegion&&this.a11y.liveRegion.length>0&&this.a11y.liveRegion.remove(),this.navigation&&this.navigation.$nextEl&&(e=this.navigation.$nextEl),this.navigation&&this.navigation.$prevEl&&(t=this.navigation.$prevEl),e&&e.off("keydown",this.a11y.onEnterKey),t&&t.off("keydown",this.a11y.onEnterKey),this.pagination&&this.params.pagination.clickable&&this.pagination.bullets&&this.pagination.bullets.length&&this.pagination.$el.off("keydown","."+this.params.pagination.bulletClass,this.a11y.onEnterKey)}},_={init:function(){if(this.params.history){if(!o.history||!o.history.pushState)return this.params.history.enabled=!1,void(this.params.hashNavigation.enabled=!0);var e=this.history;e.initialized=!0,e.paths=_.getPathValues(),(e.paths.key||e.paths.value)&&(e.scrollToSlide(0,e.paths.value,this.params.runCallbacksOnInit),this.params.history.replaceState||o.addEventListener("popstate",this.history.setHistoryPopState))}},destroy:function(){this.params.history.replaceState||o.removeEventListener("popstate",this.history.setHistoryPopState)},setHistoryPopState:function(){this.history.paths=_.getPathValues(),this.history.scrollToSlide(this.params.speed,this.history.paths.value,!1)},getPathValues:function(){var e=o.location.pathname.slice(1).split("/").filter(function(e){return""!==e}),t=e.length;return{key:e[t-2],value:e[t-1]}},setHistory:function(e,t){if(this.history.initialized&&this.params.history.enabled){var i=this.slides.eq(t),s=_.slugify(i.attr("data-history"));o.location.pathname.includes(e)||(s=e+"/"+s);var a=o.history.state;a&&a.value===s||(this.params.history.replaceState?o.history.replaceState({value:s},null,s):o.history.pushState({value:s},null,s))}},slugify:function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},scrollToSlide:function(e,t,i){if(t)for(var s=0,a=this.slides.length;s<a;s+=1){var r=this.slides.eq(s);if(_.slugify(r.attr("data-history"))===t&&!r.hasClass(this.params.slideDuplicateClass)){var n=r.index();this.slideTo(n,e,i)}}else this.slideTo(0,e,i)}},Z={onHashCange:function(){var e=d.location.hash.replace("#","");e!==this.slides.eq(this.activeIndex).attr("data-hash")&&this.slideTo(this.$wrapperEl.children("."+this.params.slideClass+'[data-hash="'+e+'"]').index())},setHash:function(){if(this.hashNavigation.initialized&&this.params.hashNavigation.enabled)if(this.params.hashNavigation.replaceState&&o.history&&o.history.replaceState)o.history.replaceState(null,null,"#"+this.slides.eq(this.activeIndex).attr("data-hash")||"");else{var e=this.slides.eq(this.activeIndex),t=e.attr("data-hash")||e.attr("data-history");d.location.hash=t||""}},init:function(){if(!(!this.params.hashNavigation.enabled||this.params.history&&this.params.history.enabled)){this.hashNavigation.initialized=!0;var e=d.location.hash.replace("#","");if(e)for(var i=0,s=this.slides.length;i<s;i+=1){var a=this.slides.eq(i);if((a.attr("data-hash")||a.attr("data-history"))===e&&!a.hasClass(this.params.slideDuplicateClass)){var r=a.index();this.slideTo(r,0,this.params.runCallbacksOnInit,!0)}}this.params.hashNavigation.watchState&&t(o).on("hashchange",this.hashNavigation.onHashCange)}},destroy:function(){this.params.hashNavigation.watchState&&t(o).off("hashchange",this.hashNavigation.onHashCange)}},Q={run:function(){var e=this,t=e.slides.eq(e.activeIndex),i=e.params.autoplay.delay;t.attr("data-swiper-autoplay")&&(i=t.attr("data-swiper-autoplay")||e.params.autoplay.delay),e.autoplay.timeout=l.nextTick(function(){e.params.autoplay.reverseDirection?e.params.loop?(e.loopFix(),e.slidePrev(e.params.speed,!0,!0),e.emit("autoplay")):e.isBeginning?e.params.autoplay.stopOnLastSlide?e.autoplay.stop():(e.slideTo(e.slides.length-1,e.params.speed,!0,!0),e.emit("autoplay")):(e.slidePrev(e.params.speed,!0,!0),e.emit("autoplay")):e.params.loop?(e.loopFix(),e.slideNext(e.params.speed,!0,!0),e.emit("autoplay")):e.isEnd?e.params.autoplay.stopOnLastSlide?e.autoplay.stop():(e.slideTo(0,e.params.speed,!0,!0),e.emit("autoplay")):(e.slideNext(e.params.speed,!0,!0),e.emit("autoplay"))},i)},start:function(){return void 0===this.autoplay.timeout&&!this.autoplay.running&&(this.autoplay.running=!0,this.emit("autoplayStart"),this.autoplay.run(),!0)},stop:function(){return!!this.autoplay.running&&void 0!==this.autoplay.timeout&&(this.autoplay.timeout&&(clearTimeout(this.autoplay.timeout),this.autoplay.timeout=void 0),this.autoplay.running=!1,this.emit("autoplayStop"),!0)},pause:function(e){var t=this;t.autoplay.running&&(t.autoplay.paused||(t.autoplay.timeout&&clearTimeout(t.autoplay.timeout),t.autoplay.paused=!0,0!==e&&t.params.autoplay.waitForTransition?t.$wrapperEl.transitionEnd(function(){t&&!t.destroyed&&(t.autoplay.paused=!1,t.autoplay.running?t.autoplay.run():t.autoplay.stop())}):(t.autoplay.paused=!1,t.autoplay.run())))}},J={setTranslate:function(){for(var e=this.slides,t=0;t<e.length;t+=1){var i=this.slides.eq(t),s=-i[0].swiperSlideOffset;this.params.virtualTranslate||(s-=this.translate);var a=0;this.isHorizontal()||(a=s,s=0);var r=this.params.fadeEffect.crossFade?Math.max(1-Math.abs(i[0].progress),0):1+Math.min(Math.max(i[0].progress,-1),0);i.css({opacity:r}).transform("translate3d("+s+"px, "+a+"px, 0px)")}},setTransition:function(e){var t=this,i=t.slides,s=t.$wrapperEl;if(i.transition(e),t.params.virtualTranslate&&0!==e){var a=!1;i.transitionEnd(function(){if(!a&&t&&!t.destroyed){a=!0,t.animating=!1;for(var e=["webkitTransitionEnd","transitionend"],i=0;i<e.length;i+=1)s.trigger(e[i])}})}}},ee={setTranslate:function(){var e,i=this.$el,s=this.$wrapperEl,a=this.slides,r=this.width,n=this.height,o=this.rtl,l=this.size,d=this.params.cubeEffect,h=this.isHorizontal(),p=this.virtual&&this.params.virtual.enabled,c=0;d.shadow&&(h?(0===(e=s.find(".swiper-cube-shadow")).length&&(e=t('<div class="swiper-cube-shadow"></div>'),s.append(e)),e.css({height:r+"px"})):0===(e=i.find(".swiper-cube-shadow")).length&&(e=t('<div class="swiper-cube-shadow"></div>'),i.append(e)));for(var u=0;u<a.length;u+=1){var f=a.eq(u),v=u;p&&(v=parseInt(f.attr("data-swiper-slide-index"),10));var m=90*v,g=Math.floor(m/360);o&&(m=-m,g=Math.floor(-m/360));var b=Math.max(Math.min(f[0].progress,1),-1),w=0,y=0,x=0;v%4==0?(w=4*-g*l,x=0):(v-1)%4==0?(w=0,x=4*-g*l):(v-2)%4==0?(w=l+4*g*l,x=l):(v-3)%4==0&&(w=-l,x=3*l+4*l*g),o&&(w=-w),h||(y=w,w=0);var T="rotateX("+(h?0:-m)+"deg) rotateY("+(h?m:0)+"deg) translate3d("+w+"px, "+y+"px, "+x+"px)";if(b<=1&&b>-1&&(c=90*v+90*b,o&&(c=90*-v-90*b)),f.transform(T),d.slideShadows){var E=h?f.find(".swiper-slide-shadow-left"):f.find(".swiper-slide-shadow-top"),S=h?f.find(".swiper-slide-shadow-right"):f.find(".swiper-slide-shadow-bottom");0===E.length&&(E=t('<div class="swiper-slide-shadow-'+(h?"left":"top")+'"></div>'),f.append(E)),0===S.length&&(S=t('<div class="swiper-slide-shadow-'+(h?"right":"bottom")+'"></div>'),f.append(S)),E.length&&(E[0].style.opacity=Math.max(-b,0)),S.length&&(S[0].style.opacity=Math.max(b,0))}}if(s.css({"-webkit-transform-origin":"50% 50% -"+l/2+"px","-moz-transform-origin":"50% 50% -"+l/2+"px","-ms-transform-origin":"50% 50% -"+l/2+"px","transform-origin":"50% 50% -"+l/2+"px"}),d.shadow)if(h)e.transform("translate3d(0px, "+(r/2+d.shadowOffset)+"px, "+-r/2+"px) rotateX(90deg) rotateZ(0deg) scale("+d.shadowScale+")");else{var C=Math.abs(c)-90*Math.floor(Math.abs(c)/90),M=1.5-(Math.sin(2*C*Math.PI/360)/2+Math.cos(2*C*Math.PI/360)/2),z=d.shadowScale,P=d.shadowScale/M,k=d.shadowOffset;e.transform("scale3d("+z+", 1, "+P+") translate3d(0px, "+(n/2+k)+"px, "+-n/2/P+"px) rotateX(-90deg)")}var $=I.isSafari||I.isUiWebView?-l/2:0;s.transform("translate3d(0px,0,"+$+"px) rotateX("+(this.isHorizontal()?0:c)+"deg) rotateY("+(this.isHorizontal()?-c:0)+"deg)")},setTransition:function(e){var t=this.$el;this.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),this.params.cubeEffect.shadow&&!this.isHorizontal()&&t.find(".swiper-cube-shadow").transition(e)}},te={setTranslate:function(){for(var e=this.slides,i=0;i<e.length;i+=1){var s=e.eq(i),a=s[0].progress;this.params.flipEffect.limitRotation&&(a=Math.max(Math.min(s[0].progress,1),-1));var r=-180*a,n=0,o=-s[0].swiperSlideOffset,l=0;if(this.isHorizontal()?this.rtl&&(r=-r):(l=o,o=0,n=-r,r=0),s[0].style.zIndex=-Math.abs(Math.round(a))+e.length,this.params.flipEffect.slideShadows){var d=this.isHorizontal()?s.find(".swiper-slide-shadow-left"):s.find(".swiper-slide-shadow-top"),h=this.isHorizontal()?s.find(".swiper-slide-shadow-right"):s.find(".swiper-slide-shadow-bottom");0===d.length&&(d=t('<div class="swiper-slide-shadow-'+(this.isHorizontal()?"left":"top")+'"></div>'),s.append(d)),0===h.length&&(h=t('<div class="swiper-slide-shadow-'+(this.isHorizontal()?"right":"bottom")+'"></div>'),s.append(h)),d.length&&(d[0].style.opacity=Math.max(-a,0)),h.length&&(h[0].style.opacity=Math.max(a,0))}s.transform("translate3d("+o+"px, "+l+"px, 0px) rotateX("+n+"deg) rotateY("+r+"deg)")}},setTransition:function(e){var t=this,i=t.slides,s=t.activeIndex,a=t.$wrapperEl;if(i.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),t.params.virtualTranslate&&0!==e){var r=!1;i.eq(s).transitionEnd(function(){if(!r&&t&&!t.destroyed){r=!0,t.animating=!1;for(var e=["webkitTransitionEnd","transitionend"],i=0;i<e.length;i+=1)a.trigger(e[i])}})}}},ie={setTranslate:function(){for(var e=this.width,i=this.height,s=this.slides,a=this.$wrapperEl,r=this.slidesSizesGrid,n=this.params.coverflowEffect,o=this.isHorizontal(),l=this.translate,d=o?e/2-l:i/2-l,p=o?n.rotate:-n.rotate,c=n.depth,u=0,f=s.length;u<f;u+=1){var v=s.eq(u),m=r[u],g=(d-v[0].swiperSlideOffset-m/2)/m*n.modifier,b=o?p*g:0,w=o?0:p*g,y=-c*Math.abs(g),x=o?0:n.stretch*g,T=o?n.stretch*g:0;Math.abs(T)<.001&&(T=0),Math.abs(x)<.001&&(x=0),Math.abs(y)<.001&&(y=0),Math.abs(b)<.001&&(b=0),Math.abs(w)<.001&&(w=0);var E="translate3d("+T+"px,"+x+"px,"+y+"px)  rotateX("+w+"deg) rotateY("+b+"deg)";if(v.transform(E),v[0].style.zIndex=1-Math.abs(Math.round(g)),n.slideShadows){var S=o?v.find(".swiper-slide-shadow-left"):v.find(".swiper-slide-shadow-top"),C=o?v.find(".swiper-slide-shadow-right"):v.find(".swiper-slide-shadow-bottom");0===S.length&&(S=t('<div class="swiper-slide-shadow-'+(o?"left":"top")+'"></div>'),v.append(S)),0===C.length&&(C=t('<div class="swiper-slide-shadow-'+(o?"right":"bottom")+'"></div>'),v.append(C)),S.length&&(S[0].style.opacity=g>0?g:0),C.length&&(C[0].style.opacity=-g>0?-g:0)}}(h.pointerEvents||h.prefixedPointerEvents)&&(a[0].style.perspectiveOrigin=d+"px 50%")},setTransition:function(e){this.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}},se=[$,L,D,O,H,X,G,{name:"mousewheel",params:{mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarged:"container"}},create:function(){l.extend(this,{mousewheel:{enabled:!1,enable:B.enable.bind(this),disable:B.disable.bind(this),handle:B.handle.bind(this),lastScrollTime:l.now()}})},on:{init:function(){this.params.mousewheel.enabled&&this.mousewheel.enable()},destroy:function(){this.mousewheel.enabled&&this.mousewheel.disable()}}},{name:"navigation",params:{navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock"}},create:function(){l.extend(this,{navigation:{init:V.init.bind(this),update:V.update.bind(this),destroy:V.destroy.bind(this)}})},on:{init:function(){this.navigation.init(),this.navigation.update()},toEdge:function(){this.navigation.update()},fromEdge:function(){this.navigation.update()},destroy:function(){this.navigation.destroy()},click:function(e){var i=this.navigation,s=i.$nextEl,a=i.$prevEl;!this.params.navigation.hideOnClick||t(e.target).is(a)||t(e.target).is(s)||(s&&s.toggleClass(this.params.navigation.hiddenClass),a&&a.toggleClass(this.params.navigation.hiddenClass))}}},{name:"pagination",params:{pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,type:"bullets",dynamicBullets:!1,bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",modifierClass:"swiper-pagination-",currentClass:"swiper-pagination-current",totalClass:"swiper-pagination-total",hiddenClass:"swiper-pagination-hidden",progressbarFillClass:"swiper-pagination-progressbar-fill",clickableClass:"swiper-pagination-clickable",lockClass:"swiper-pagination-lock"}},create:function(){l.extend(this,{pagination:{init:R.init.bind(this),render:R.render.bind(this),update:R.update.bind(this),destroy:R.destroy.bind(this)}})},on:{init:function(){this.pagination.init(),this.pagination.render(),this.pagination.update()},activeIndexChange:function(){this.params.loop?this.pagination.update():void 0===this.snapIndex&&this.pagination.update()},snapIndexChange:function(){this.params.loop||this.pagination.update()},slidesLengthChange:function(){this.params.loop&&(this.pagination.render(),this.pagination.update())},snapGridLengthChange:function(){this.params.loop||(this.pagination.render(),this.pagination.update())},destroy:function(){this.pagination.destroy()},click:function(e){this.params.pagination.el&&this.params.pagination.hideOnClick&&this.pagination.$el.length>0&&!t(e.target).hasClass(this.params.pagination.bulletClass)&&this.pagination.$el.toggleClass(this.params.pagination.hiddenClass)}}},{name:"scrollbar",params:{scrollbar:{el:null,dragSize:"auto",hide:!1,draggable:!1,snapOnRelease:!0,lockClass:"swiper-scrollbar-lock"}},create:function(){l.extend(this,{scrollbar:{init:F.init.bind(this),destroy:F.destroy.bind(this),updateSize:F.updateSize.bind(this),setTranslate:F.setTranslate.bind(this),setTransition:F.setTransition.bind(this),enableDraggable:F.enableDraggable.bind(this),disableDraggable:F.disableDraggable.bind(this),setDragPosition:F.setDragPosition.bind(this),onDragStart:F.onDragStart.bind(this),onDragMove:F.onDragMove.bind(this),onDragEnd:F.onDragEnd.bind(this),isTouched:!1,timeout:null,dragTimeout:null}})},on:{init:function(){this.scrollbar.init(),this.scrollbar.updateSize(),this.scrollbar.setTranslate()},update:function(){this.scrollbar.updateSize()},resize:function(){this.scrollbar.updateSize()},observerUpdate:function(){this.scrollbar.updateSize()},setTranslate:function(){this.scrollbar.setTranslate()},setTransition:function(e){this.scrollbar.setTransition(e)},destroy:function(){this.scrollbar.destroy()}}},{name:"parallax",params:{parallax:{enabled:!1}},create:function(){l.extend(this,{parallax:{setTransform:W.setTransform.bind(this),setTranslate:W.setTranslate.bind(this),setTransition:W.setTransition.bind(this)}})},on:{beforeInit:function(){this.params.watchSlidesProgress=!0},init:function(){this.params.parallax&&this.parallax.setTranslate()},setTranslate:function(){this.params.parallax&&this.parallax.setTranslate()},setTransition:function(e){this.params.parallax&&this.parallax.setTransition(e)}}},{name:"zoom",params:{zoom:{enabled:!1,maxRatio:3,minRatio:1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}},create:function(){var e=this,t={enabled:!1,scale:1,currentScale:1,isScaling:!1,gesture:{$slideEl:void 0,slideWidth:void 0,slideHeight:void 0,$imageEl:void 0,$imageWrapEl:void 0,maxRatio:3},image:{isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},velocity:{x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0}};"onGestureStart onGestureChange onGestureEnd onTouchStart onTouchMove onTouchEnd onTransitionEnd toggle enable disable in out".split(" ").forEach(function(i){t[i]=j[i].bind(e)}),l.extend(e,{zoom:t})},on:{init:function(){this.params.zoom.enabled&&this.zoom.enable()},destroy:function(){this.zoom.disable()},touchStart:function(e){this.zoom.enabled&&this.zoom.onTouchStart(e)},touchEnd:function(e){this.zoom.enabled&&this.zoom.onTouchEnd(e)},doubleTap:function(e){this.params.zoom.enabled&&this.zoom.enabled&&this.params.zoom.toggle&&this.zoom.toggle(e)},transitionEnd:function(){this.zoom.enabled&&this.params.zoom.enabled&&this.zoom.onTransitionEnd()}}},{name:"lazy",params:{lazy:{enabled:!1,loadPrevNext:!1,loadPrevNextAmount:1,loadOnTransitionStart:!1,elementClass:"swiper-lazy",loadingClass:"swiper-lazy-loading",loadedClass:"swiper-lazy-loaded",preloaderClass:"swiper-lazy-preloader"}},create:function(){l.extend(this,{lazy:{initialImageLoaded:!1,load:q.load.bind(this),loadInSlide:q.loadInSlide.bind(this)}})},on:{beforeInit:function(){this.params.lazy.enabled&&this.params.preloadImages&&(this.params.preloadImages=!1)},init:function(){this.params.lazy.enabled&&!this.params.loop&&0===this.params.initialSlide&&this.lazy.load()},scroll:function(){this.params.freeMode&&!this.params.freeModeSticky&&this.lazy.load()},resize:function(){this.params.lazy.enabled&&this.lazy.load()},scrollbarDragMove:function(){this.params.lazy.enabled&&this.lazy.load()},transitionStart:function(){this.params.lazy.enabled&&(this.params.lazy.loadOnTransitionStart||!this.params.lazy.loadOnTransitionStart&&!this.lazy.initialImageLoaded)&&this.lazy.load()},transitionEnd:function(){this.params.lazy.enabled&&!this.params.lazy.loadOnTransitionStart&&this.lazy.load()}}},{name:"controller",params:{controller:{control:void 0,inverse:!1,by:"slide"}},create:function(){l.extend(this,{controller:{control:this.params.controller.control,getInterpolateFunction:K.getInterpolateFunction.bind(this),setTranslate:K.setTranslate.bind(this),setTransition:K.setTransition.bind(this)}})},on:{update:function(){this.controller.control&&this.controller.spline&&(this.controller.spline=void 0,delete this.controller.spline)},resize:function(){this.controller.control&&this.controller.spline&&(this.controller.spline=void 0,delete this.controller.spline)},observerUpdate:function(){this.controller.control&&this.controller.spline&&(this.controller.spline=void 0,delete this.controller.spline)},setTranslate:function(e,t){this.controller.control&&this.controller.setTranslate(e,t)},setTransition:function(e,t){this.controller.control&&this.controller.setTransition(e,t)}}},{name:"a11y",params:{a11y:{enabled:!1,notificationClass:"swiper-notification",prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}"}},create:function(){var e=this;l.extend(e,{a11y:{liveRegion:t('<span class="'+e.params.a11y.notificationClass+'" aria-live="assertive" aria-atomic="true"></span>')}}),Object.keys(U).forEach(function(t){e.a11y[t]=U[t].bind(e)})},on:{init:function(){this.params.a11y.enabled&&(this.a11y.init(),this.a11y.updateNavigation())},toEdge:function(){this.params.a11y.enabled&&this.a11y.updateNavigation()},fromEdge:function(){this.params.a11y.enabled&&this.a11y.updateNavigation()},paginationUpdate:function(){this.params.a11y.enabled&&this.a11y.updatePagination()},destroy:function(){this.params.a11y.enabled&&this.a11y.destroy()}}},{name:"history",params:{history:{enabled:!1,replaceState:!1,key:"slides"}},create:function(){l.extend(this,{history:{init:_.init.bind(this),setHistory:_.setHistory.bind(this),setHistoryPopState:_.setHistoryPopState.bind(this),scrollToSlide:_.scrollToSlide.bind(this),destroy:_.destroy.bind(this)}})},on:{init:function(){this.params.history.enabled&&this.history.init()},destroy:function(){this.params.history.enabled&&this.history.destroy()},transitionEnd:function(){this.history.initialized&&this.history.setHistory(this.params.history.key,this.activeIndex)}}},{name:"hash-navigation",params:{hashNavigation:{enabled:!1,replaceState:!1,watchState:!1}},create:function(){l.extend(this,{hashNavigation:{initialized:!1,init:Z.init.bind(this),destroy:Z.destroy.bind(this),setHash:Z.setHash.bind(this),onHashCange:Z.onHashCange.bind(this)}})},on:{init:function(){this.params.hashNavigation.enabled&&this.hashNavigation.init()},destroy:function(){this.params.hashNavigation.enabled&&this.hashNavigation.destroy()},transitionEnd:function(){this.hashNavigation.initialized&&this.hashNavigation.setHash()}}},{name:"autoplay",params:{autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!0,stopOnLastSlide:!1,reverseDirection:!1}},create:function(){l.extend(this,{autoplay:{running:!1,paused:!1,run:Q.run.bind(this),start:Q.start.bind(this),stop:Q.stop.bind(this),pause:Q.pause.bind(this)}})},on:{init:function(){this.params.autoplay.enabled&&this.autoplay.start()},beforeTransitionStart:function(e,t){this.autoplay.running&&(t||!this.params.autoplay.disableOnInteraction?this.autoplay.pause(e):this.autoplay.stop())},sliderFirstMove:function(){this.autoplay.running&&(this.params.autoplay.disableOnInteraction?this.autoplay.stop():this.autoplay.pause())},destroy:function(){this.autoplay.running&&this.autoplay.stop()}}},{name:"effect-fade",params:{fadeEffect:{crossFade:!1}},create:function(){l.extend(this,{fadeEffect:{setTranslate:J.setTranslate.bind(this),setTransition:J.setTransition.bind(this)}})},on:{beforeInit:function(){if("fade"===this.params.effect){this.classNames.push(this.params.containerModifierClass+"fade");var e={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!0};l.extend(this.params,e),l.extend(this.originalParams,e)}},setTranslate:function(){"fade"===this.params.effect&&this.fadeEffect.setTranslate()},setTransition:function(e){"fade"===this.params.effect&&this.fadeEffect.setTransition(e)}}},{name:"effect-cube",params:{cubeEffect:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94}},create:function(){l.extend(this,{cubeEffect:{setTranslate:ee.setTranslate.bind(this),setTransition:ee.setTransition.bind(this)}})},on:{beforeInit:function(){if("cube"===this.params.effect){this.classNames.push(this.params.containerModifierClass+"cube"),this.classNames.push(this.params.containerModifierClass+"3d");var e={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,resistanceRatio:0,spaceBetween:0,centeredSlides:!1,virtualTranslate:!0};l.extend(this.params,e),l.extend(this.originalParams,e)}},setTranslate:function(){"cube"===this.params.effect&&this.cubeEffect.setTranslate()},setTransition:function(e){"cube"===this.params.effect&&this.cubeEffect.setTransition(e)}}},{name:"effect-flip",params:{flipEffect:{slideShadows:!0,limitRotation:!0}},create:function(){l.extend(this,{flipEffect:{setTranslate:te.setTranslate.bind(this),setTransition:te.setTransition.bind(this)}})},on:{beforeInit:function(){if("flip"===this.params.effect){this.classNames.push(this.params.containerModifierClass+"flip"),this.classNames.push(this.params.containerModifierClass+"3d");var e={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!0};l.extend(this.params,e),l.extend(this.originalParams,e)}},setTranslate:function(){"flip"===this.params.effect&&this.flipEffect.setTranslate()},setTransition:function(e){"flip"===this.params.effect&&this.flipEffect.setTransition(e)}}},{name:"effect-coverflow",params:{coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0}},create:function(){l.extend(this,{coverflowEffect:{setTranslate:ie.setTranslate.bind(this),setTransition:ie.setTransition.bind(this)}})},on:{beforeInit:function(){"coverflow"===this.params.effect&&(this.classNames.push(this.params.containerModifierClass+"coverflow"),this.classNames.push(this.params.containerModifierClass+"3d"),this.params.watchSlidesProgress=!0,this.originalParams.watchSlidesProgress=!0)},setTranslate:function(){"coverflow"===this.params.effect&&this.coverflowEffect.setTranslate()},setTransition:function(e){"coverflow"===this.params.effect&&this.coverflowEffect.setTransition(e)}}}];return void 0===k.use&&(k.use=k.Class.use,k.installModule=k.Class.installModule),k.use(se),k}),function(){var isNodeJS=!1,XMLHttpRequestNodeJS=!1;"undefined"!=typeof module&&void 0!==module.exports&&(isNodeJS=!0,XMLHttpRequestNodeJS=require("xmlhttprequest").XMLHttpRequest);var Bibblio={moduleVersion:"1.1.13",moduleTracking:{},outerModuleTemplate:'<ul class="bib__module <%= classes %>">                                    <%= recommendedContentItems %>                                    <a href="http://bibblio.org/about" target="_blank" class="bib__origin">Refined by</a>                                 </ul>',relatedContentItemTemplate:'<li class="bib__tile bib__tile--<%= tileNumber %>">                                            <a href="<%= url %>" target="<%= Bibblio.linkTargetFor(url) %>"  <%= Bibblio.linkRelFor(url) %> data="<%= contentItemId %>" class="bib__link <%= (imageUrl ? \'bib__link--image\' : \'\') %>" <%= (imageUrl ? \'style="background-image: url(\' + imageUrl + \')\' : \'\') %>">                                                <span class="bib__container">                                                    <span class="bib__info">                                                        <span class="bib__title"><span><%= name %></span></span>                                                        <% if (typeof(attributes) != "undefined") { %>                                                          <span class="bib__attributes">                                                              <% if (attributes[\'duration\']) { %> <span class="bib__duration"><%= attributes[\'duration\'] %></span> <% } %>                                                              <% if (attributes[\'author\']) { %> <span class="bib__author"><%= attributes[\'author\'] %></span> <% } %>                                                              <% if (attributes[\'recency\']) { %> <span class="bib__recency"><%= attributes[\'recency\'] %></span> <% } %>                                                          </span>                                                        <% } %>                                                        <% if (subtitle) { %><span class="bib__preview"><%= subtitle %></span><% } %>                                                        <% if (showRelatedBy && relatedBy.length > 0) { %>                                                          <span class="bib__terms">                                                              <span class="bib__term-label">Related by</span>                                                              <span class="bib__term-list">                                                                  <span class="bib__term-item"><%= relatedBy[0] %></span>                                                                  <span class="bib__term-item"><%= relatedBy[1] %></span>                                                                  <span class="bib__term-item"><%= relatedBy[2] %></span>                                                              </span>                                                          </span>                                                        <% } %>                                                    </span>                                                </span>                                            </a>                                        </li>',initRelatedContent:function(containerId,accessToken,contentItemId,options,callbacks){var catalogueIds=options.catalogueIds||[],moduleSettings=Bibblio.initModuleSettings(options),callbacks=callbacks||{},displayWithTemplates=_.partial(Bibblio.displayRelatedContent,containerId,Bibblio.outerModuleTemplate,Bibblio.relatedContentItemTemplate,moduleSettings,_),submitClickedActivityData=_.partial(Bibblio.onRecommendationClick,containerId,contentItemId,catalogueIds,moduleSettings,_,_,_,_,_),submitViewedActivityData=_.partial(Bibblio.onRecommendationViewed,moduleSettings,contentItemId,catalogueIds,_,_),renderModule=_.partial(Bibblio.renderModule,containerId,displayWithTemplates,submitClickedActivityData,submitViewedActivityData,callbacks,_);Bibblio.getRelatedContentItems(accessToken,contentItemId,catalogueIds,moduleSettings,renderModule)},getRelatedContentItems:function(accessToken,contentItemId,catalogueIds,moduleSettings,successCallback){var subtitleField=moduleSettings.subtitleField,userId=moduleSettings.userId,xmlhttp=XMLHttpRequestNodeJS?new XMLHttpRequestNodeJS:new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(4===xmlhttp.readyState)if(200===xmlhttp.status){var response=JSON.parse(xmlhttp.responseText);successCallback(response)}else isNodeJS&&successCallback(new Error(xmlhttp.status))};var fields=["name","url","moduleImage"].concat(Bibblio.getRootProperty(subtitleField)).filter(Boolean),url=Bibblio.recommendationUrl(userId,contentItemId,catalogueIds,6,1,fields);xmlhttp.open("GET",url,!0),xmlhttp.setRequestHeader("Authorization","Bearer "+accessToken),xmlhttp.send()},renderModule:function(containerId,displayWithTemplates,submitClickedActivityData,submitViewedActivityData,callbacks,recommendationsResponse){var relatedContentItems=[],trackingLink=null,activityId=null;try{relatedContentItems=recommendationsResponse.results,trackingLink=recommendationsResponse._links.tracking.href,activityId=Bibblio.getActivityId(trackingLink)}catch(err){}Bibblio.createModuleTrackingEntry(activityId);var submitClickedActivityData=_.partial(submitClickedActivityData,activityId,relatedContentItems,trackingLink,_,_),submitViewedActivityData=_.partial(submitViewedActivityData,activityId,relatedContentItems,trackingLink,_);displayWithTemplates(relatedContentItems),Bibblio.bindRelatedContentItemLinks(submitClickedActivityData,containerId,callbacks),Bibblio.setOnViewedListeners(containerId,submitViewedActivityData,activityId,callbacks)},displayRelatedContent:function(containerId,outerModuleTemplate,contentItemTemplate,moduleSettings,relatedContentItems){var relatedContentItemCountainer=document.getElementById(containerId),relatedContentItemPanels=_.map(relatedContentItems,function(contentItem,index){return Bibblio.renderContentItemTemplate(contentItem,index,contentItemTemplate,moduleSettings)}).join("\n"),module=Bibblio.renderOuterModuleTemplate(moduleSettings,relatedContentItemPanels,outerModuleTemplate);relatedContentItemCountainer.innerHTML=module},renderOuterModuleTemplate:function(moduleSettings,contentItemsHTML,outerModuleTemplate){var classes=moduleSettings.styleClasses?moduleSettings.styleClasses:Bibblio.getPresetModuleClasses(moduleSettings.stylePreset);return _.template(outerModuleTemplate)({classes:classes,recommendedContentItems:contentItemsHTML})},stripImgProtocol:function(contentUrl){return contentUrl&&"string"==typeof contentUrl?contentUrl.replace(/^https?\:/,""):contentUrl},renderContentItemTemplate:function(contentItem,contentItemIndex,contentItemTemplate,moduleSettings){return _.template(contentItemTemplate)({contentItemId:Bibblio.getProperty(contentItem,"contentItemId")?contentItem.contentItemId:null,name:Bibblio.getProperty(contentItem,"fields.name")?contentItem.fields.name:null,url:Bibblio.getProperty(contentItem,"fields.url")?contentItem.fields.url:null,subtitle:Bibblio.getProperty(contentItem,"fields."+moduleSettings.subtitleField)?Bibblio.getProperty(contentItem.fields,moduleSettings.subtitleField):null,imageUrl:Bibblio.getProperty(contentItem,"fields.moduleImage.contentUrl")?Bibblio.stripImgProtocol(contentItem.fields.moduleImage.contentUrl):null,relatedBy:Bibblio.getProperty(contentItem,"relationships.inCommon")?contentItem.relationships.inCommon:null,tileNumber:contentItemIndex+1,showRelatedBy:moduleSettings.showRelatedBy})},recommendationUrl:function(userId,contentItemId,catalogueIds,limit,page,fields){var querystringArgs=["limit="+limit,"page="+page,"fields="+fields.join(",")];return catalogueIds.length>0&&querystringArgs.push("catalogueIds="+catalogueIds.join(",")),null!==userId&&querystringArgs.push("userId="+userId),"https://api.bibblio.org/v1/content-items/"+contentItemId+"/recommendations?"+querystringArgs.join("&")},getPresetModuleClasses:function(stylePreset){var presets={"grid-4":"bib--grd-4 bib--wide","box-5":"bib--box-5 bib--wide","box-6":"bib--box-6 bib--wide"};return presets[stylePreset]||presets["box-6"]},linkRelFor:function(url){var currentdomain=window.location.hostname;return Bibblio.getDomainName(currentdomain)==Bibblio.getDomainName(url)?"":' rel="noopener noreferrer" '},linkTargetFor:function(url){var currentdomain=window.location.hostname;return Bibblio.getDomainName(currentdomain)==Bibblio.getDomainName(url)?"_self":"_blank"},getDomainName:function(url){var r=/^(?:https?:\/\/)?(?:www\.)?(.[^\/]+)/,matchResult=url.match(r);return url.match(r)?matchResult[1].replace("www.",""):""},getProperty:function(properties,accessor){if(0==accessor||void 0==accessor)return accessor;var reduceProps=function(props,field){return void 0==props?void 0:props[field]};return _.reduce(accessor.split("."),reduceProps,properties)},getRootProperty:function(accessor){return 0==accessor||void 0==accessor?accessor:accessor.split(".")[0]},validateField:function(accessor){var validFields=["name","url","text","description","keywords","learningResourceType","thumbnail","image","moduleImage","video","dateCreated","dateModified","datePublished","provider","publisher"];return _.contains(validFields,Bibblio.getRootProperty(accessor))},bindRelatedContentItemLinks:function(submitClickedActivityData,containerId,callbacks){for(var relatedContentItemlinks=document.getElementById(containerId).getElementsByClassName("bib__link"),i=0;i<relatedContentItemlinks.length;i++)relatedContentItemlinks[i].addEventListener("click",function(event){var callback=null;1==event.which&&callbacks.onRecommendationClick&&(callback=callbacks.onRecommendationClick),Bibblio.triggerRecommendationClickedEvent(submitClickedActivityData,event,callback)},!1),relatedContentItemlinks[i].addEventListener("mousedown",function(event){3==event.which&&Bibblio.triggerRecommendationClickedEvent(submitClickedActivityData,event)},!1),relatedContentItemlinks[i].addEventListener("mouseup",function(event){event.which<4&&Bibblio.triggerRecommendationClickedEvent(submitClickedActivityData,event)},!1),relatedContentItemlinks[i].addEventListener("auxclick",function(event){event.which<4&&Bibblio.triggerRecommendationClickedEvent(submitClickedActivityData,event)},!1),relatedContentItemlinks[i].addEventListener("keydown",function(event){13==event.which&&Bibblio.triggerRecommendationClickedEvent(submitClickedActivityData,event)},!1)},setOnViewedListeners:function(containerId,submitViewedActivityData,activityId,callbacks){var callback=null;if(callbacks.onRecommendationViewed&&(callback=callbacks.onRecommendationViewed),Bibblio.isRecommendationTileInView(containerId))Bibblio.triggerRecommendationViewedEvent(submitViewedActivityData,activityId,callback);else{var ticking=!1,eventListener=function(event){if(Bibblio.hasModuleBeenViewed(activityId))return void window.removeEventListener("scroll",eventListener,!0);ticking||window.setTimeout(function(){Bibblio.isRecommendationTileInView(containerId)&&Bibblio.triggerRecommendationViewedEvent(submitViewedActivityData,activityId,callback),ticking=!1},50),ticking=!0};window.addEventListener("scroll",eventListener,!0)}},isRecommendationTileInView:function(containerId){var tiles=document.getElementById(containerId).getElementsByClassName("bib__tile"),scrollableParents=Bibblio.getScrollableParents(containerId);if(!1!==scrollableParents)for(var i=0;i<tiles.length;i++)if(Bibblio.isTileVisible(tiles[i],scrollableParents))return!0;return!1},hasScrollableOverflow:function(overflowProp){return"scroll"===overflowProp||"auto"===overflowProp||"hidden"===overflowProp},getScrollableParents:function(containerId){var moduleElement=document.getElementById(containerId),moduleRect=moduleElement.getBoundingClientRect();if(0==moduleRect.top&&0==moduleRect.bottom)return!1;if("hidden"===window.getComputedStyle(moduleElement).getPropertyValue("visibility"))return!1;for(var parentStyle,parentRect,isScrollable,parent=moduleElement.parentNode,scrollableParents=[];parent!==document.body;){if(parentStyle=window.getComputedStyle(parent),"hidden"===parentStyle.getPropertyValue("visibility"))return!1;isScrollable=Bibblio.hasScrollableOverflow(parentStyle.getPropertyValue("overflow-x"))||Bibblio.hasScrollableOverflow(parentStyle.getPropertyValue("overflow-y")),isScrollable&&(parentRect=parent.getBoundingClientRect(),scrollableParents.push({rect:parentRect,width:parentRect.right-parentRect.left,height:parentRect.bottom-parentRect.top,style:parentStyle})),parent=parent.parentNode}return scrollableParents},isTileVisible:function(tile,scrollableParents){var tileRect=tile.getBoundingClientRect(),tileWidth=tileRect.right-tileRect.left,tileHeight=tileRect.bottom-tileRect.top;if(0==tileHeight)return!1;var isInVerticleView,isInHorizontalView;if(isInVerticleView=tileHeight<=window.innerHeight&&tileRect.bottom<=window.innerHeight,isInHorizontalView=tileWidth<=window.innerWidth&&tileRect.right<=window.innerWidth,!isInVerticleView||!isInHorizontalView)return!1;for(var parent,parentRect,i=0;i<scrollableParents.length;i++)if(parent=scrollableParents[i],parentRect=parent.rect,isInVerticleView=tileHeight<=parent.height&&tileRect.bottom<=parentRect.bottom,isInHorizontalView=tileWidth<=parent.width&&tileRect.right<=parentRect.right,!isInVerticleView||!isInHorizontalView)return!1;return!0},getActivityId:function(trackingLink){return trackingLink.replace("https://","").replace("http://","").replace(/v[0-9]\//g,"").replace("api.bibblio.org/activities/","")},createModuleTrackingEntry:function(activityId){Bibblio.moduleTracking[activityId]={trackedRecommendations:[],hasModuleBeenViewed:!1}},hasRecommendationBeenClicked:function(activityId,clickedContentItemId){return-1!==Bibblio.moduleTracking[activityId].trackedRecommendations.indexOf(clickedContentItemId)},addTrackedRecommendation:function(activityId,clickedContentItemId){Bibblio.moduleTracking[activityId].trackedRecommendations.push(clickedContentItemId)},hasModuleBeenViewed:function(activityId){return Bibblio.moduleTracking[activityId].hasModuleBeenViewed},setModuleViewed:function(activityId){Bibblio.moduleTracking[activityId].hasModuleBeenViewed=!0},triggerRecommendationClickedEvent:function(submitClickedActivityData,event,callback){submitClickedActivityData(event.currentTarget.getAttribute("data"),event,callback)},triggerRecommendationViewedEvent:function(submitViewedActivityData,activityId,callback){submitViewedActivityData(callback)},onRecommendationClick:function(containerId,sourceContentItemId,catalogueIds,moduleSettings,activityId,relatedContentItems,trackingLink,clickedContentItemId,event,callback){var activityData=BibblioActivity.constructOnClickedActivityData(sourceContentItemId,clickedContentItemId,catalogueIds,relatedContentItems,{type:"BibblioRelatedContent",version:Bibblio.moduleVersion,config:moduleSettings},moduleSettings.userId);if(!Bibblio.hasRecommendationBeenClicked(activityId,clickedContentItemId)){BibblioActivity.track(trackingLink,activityData);Bibblio.addTrackedRecommendation(activityId,clickedContentItemId)}null!=callback&&"function"==typeof callback&&callback(activityData,event)},onRecommendationViewed:function(moduleSettings,sourceContentItemId,catalogueIds,activityId,relatedContentItems,trackingLink,callback){if(!Bibblio.hasModuleBeenViewed(activityId)){Bibblio.setModuleViewed(activityId);var activityData=BibblioActivity.constructOnViewedActivityData(sourceContentItemId,catalogueIds,relatedContentItems,{type:"BibblioRelatedContent",version:Bibblio.moduleVersion,config:moduleSettings},moduleSettings.userId);BibblioActivity.trackAsync(trackingLink,activityData);null!=callback&&"function"==typeof callback&&callback(activityData)}},initModuleSettings:function(options){var moduleSettings={};return moduleSettings.stylePreset=options.stylePreset||"default",moduleSettings.styleClasses=options.styleClasses||!1,moduleSettings.showRelatedBy=options.showRelatedBy||!1,moduleSettings.subtitleField=Bibblio.validateField(options.subtitleField)?options.subtitleField:"headline",moduleSettings.userId=options.userId||null,moduleSettings}},BibblioActivity={track:function(trackingLink,activityData){if(null!=trackingLink){var requestBody=BibblioActivity.constructRequestBody(activityData);return BibblioActivity.constructHttpClient(trackingLink,!1).send(requestBody)}},trackAsync:function(trackingLink,activityData){if(null!=trackingLink){var requestBody=BibblioActivity.constructRequestBody(activityData);return BibblioActivity.constructHttpClient(trackingLink,!0).send(requestBody)}},constructRequestBody:function(activityData){return JSON.stringify(activityData)},constructHttpClient:function(trackingLink,isAsyncClient){var url=trackingLink,httpClient=XMLHttpRequestNodeJS?new XMLHttpRequestNodeJS:new XMLHttpRequest;return httpClient.open("POST",url,isAsyncClient),httpClient.setRequestHeader("Content-Type","application/json"),httpClient},constructOnClickedActivityData:function(sourceContentItemId,clickedContentItemId,catalogueIds,relatedContentItems,instrument,userId){var activityData={type:"Clicked",object:BibblioActivity.constructActivityObject(clickedContentItemId),context:BibblioActivity.constructActivityContext(sourceContentItemId,catalogueIds,relatedContentItems),instrument:BibblioActivity.constructActivityInstrument(instrument)};return null!=userId&&(activityData.actor={userId:userId}),activityData},constructOnViewedActivityData:function(sourceContentItemId,catalogueIds,relatedContentItems,instrument,userId){var activityData={type:"Viewed",context:BibblioActivity.constructActivityContext(sourceContentItemId,catalogueIds,relatedContentItems),instrument:BibblioActivity.constructActivityInstrument(instrument)};return null!=userId&&(activityData.actor={userId:userId}),activityData},constructActivityInstrument:function(instrument){return{type:instrument.type,version:instrument.version,config:instrument.config}},constructActivityObject:function(clickedContentItemId){return[["contentItemId",clickedContentItemId]]},constructActivityContext:function(sourceContentItemId,catalogueIds,relatedContentItems){var context=[],href="undefined"!=typeof window&&window.location&&window.location.href?window.location.href:"";return context.push(["sourceHref",href]),context.push(["sourceContentItemId",sourceContentItemId]),context=context.concat(_.map(relatedContentItems,function(contentItem){return["recommendations.contentItemId",contentItem.contentItemId]})),catalogueIds&&catalogueIds.length>0?context=context.concat(_.map(catalogueIds,function(catalogueId){return["recommendations.catalogueId",catalogueId]})):relatedContentItems[0].catalogueId&&context.push(["recommendations.catalogueId",relatedContentItems[0].catalogueId]),context}};isNodeJS?module.exports={Bibblio:Bibblio,BibblioActivity:BibblioActivity}:(window.Bibblio=Bibblio,window.BibblioActivity=BibblioActivity)}(),function(window,angular){"use strict";function isValidDottedPath(path){return null!=path&&""!==path&&"hasOwnProperty"!==path&&MEMBER_NAME_REGEX.test("."+path)}function lookupDottedPath(obj,path){if(!isValidDottedPath(path))throw $resourceMinErr("badmember",'Dotted member path "@{0}" is invalid.',path);for(var keys=path.split("."),i=0,ii=keys.length;i<ii&&angular.isDefined(obj);i++){var key=keys[i];obj=null!==obj?obj[key]:void 0}return obj}function shallowClearAndCopy(src,dst){dst=dst||{},angular.forEach(dst,function(value,key){delete dst[key]});for(var key in src)!src.hasOwnProperty(key)||"$"===key.charAt(0)&&"$"===key.charAt(1)||(dst[key]=src[key]);return dst}var $resourceMinErr=angular.$$minErr("$resource"),MEMBER_NAME_REGEX=/^(\.[a-zA-Z_$@][0-9a-zA-Z_$@]*)+$/;angular.module("ngResource",["ng"]).provider("$resource",function(){var PROTOCOL_AND_DOMAIN_REGEX=/^https?:\/\/[^\/]*/,provider=this;this.defaults={stripTrailingSlashes:!0,actions:{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},delete:{method:"DELETE"}}},this.$get=["$http","$log","$q","$timeout",function($http,$log,$q,$timeout){function encodeUriSegment(val){return encodeUriQuery(val,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function encodeUriQuery(val,pctEncodeSpaces){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,pctEncodeSpaces?"%20":"+")}function Route(template,defaults){this.template=template,this.defaults=extend({},provider.defaults,defaults),this.urlParams={}}function resourceFactory(url,paramDefaults,actions,options){function extractParams(data,actionParams){var ids={};return actionParams=extend({},paramDefaults,actionParams),forEach(actionParams,function(value,key){isFunction(value)&&(value=value()),ids[key]=value&&value.charAt&&"@"==value.charAt(0)?lookupDottedPath(data,value.substr(1)):value}),ids}function defaultResponseInterceptor(response){return response.resource}function Resource(value){shallowClearAndCopy(value||{},this)}var route=new Route(url,options);return actions=extend({},provider.defaults.actions,actions),Resource.prototype.toJSON=function(){var data=extend({},this);return delete data.$promise,delete data.$resolved,data},forEach(actions,function(action,name){var hasBody=/^(POST|PUT|PATCH)$/i.test(action.method),numericTimeout=action.timeout,cancellable=angular.isDefined(action.cancellable)?action.cancellable:options&&angular.isDefined(options.cancellable)?options.cancellable:provider.defaults.cancellable;numericTimeout&&!angular.isNumber(numericTimeout)&&($log.debug("ngResource:\n  Only numeric values are allowed as `timeout`.\n  Promises are not supported in $resource, because the same value would be used for multiple requests. If you are looking for a way to cancel requests, you should use the `cancellable` option."),delete action.timeout,numericTimeout=null),Resource[name]=function(a1,a2,a3,a4){var data,success,error,params={};switch(arguments.length){case 4:error=a4,success=a3;case 3:case 2:if(!isFunction(a2)){params=a1,data=a2,success=a3;break}if(isFunction(a1)){success=a1,error=a2;break}success=a2,error=a3;case 1:isFunction(a1)?success=a1:hasBody?data=a1:params=a1;break;case 0:break;default:throw $resourceMinErr("badargs","Expected up to 4 arguments [params, data, success, error], got {0} arguments",arguments.length)}var timeoutDeferred,numericTimeoutPromise,isInstanceCall=this instanceof Resource,value=isInstanceCall?data:action.isArray?[]:new Resource(data),httpConfig={},responseInterceptor=action.interceptor&&action.interceptor.response||defaultResponseInterceptor,responseErrorInterceptor=action.interceptor&&action.interceptor.responseError||void 0;forEach(action,function(value,key){switch(key){default:httpConfig[key]=copy(value);break;case"params":case"isArray":case"interceptor":case"cancellable":}}),!isInstanceCall&&cancellable&&(timeoutDeferred=$q.defer(),httpConfig.timeout=timeoutDeferred.promise,numericTimeout&&(numericTimeoutPromise=$timeout(timeoutDeferred.resolve,numericTimeout))),hasBody&&(httpConfig.data=data),route.setUrlParams(httpConfig,extend({},extractParams(data,action.params||{}),params),action.url);var promise=$http(httpConfig).then(function(response){var data=response.data;if(data){if(angular.isArray(data)!==!!action.isArray)throw $resourceMinErr("badcfg","Error in resource configuration for action `{0}`. Expected response to contain an {1} but got an {2} (Request: {3} {4})",name,action.isArray?"array":"object",angular.isArray(data)?"array":"object",httpConfig.method,httpConfig.url);if(action.isArray)value.length=0,forEach(data,function(item){"object"==typeof item?value.push(new Resource(item)):value.push(item)});else{var promise=value.$promise;shallowClearAndCopy(data,value),value.$promise=promise}}return response.resource=value,response},function(response){return(error||noop)(response),$q.reject(response)});return promise.finally(function(){value.$resolved=!0,!isInstanceCall&&cancellable&&(value.$cancelRequest=angular.noop,$timeout.cancel(numericTimeoutPromise),timeoutDeferred=numericTimeoutPromise=httpConfig.timeout=null)}),promise=promise.then(function(response){var value=responseInterceptor(response);return(success||noop)(value,response.headers),value},responseErrorInterceptor),isInstanceCall?promise:(value.$promise=promise,value.$resolved=!1,cancellable&&(value.$cancelRequest=timeoutDeferred.resolve),value)},Resource.prototype["$"+name]=function(params,success,error){isFunction(params)&&(error=success,success=params,params={});var result=Resource[name].call(this,params,this,success,error);return result.$promise||result}}),Resource.bind=function(additionalParamDefaults){return resourceFactory(url,extend({},paramDefaults,additionalParamDefaults),actions)},Resource}var noop=angular.noop,forEach=angular.forEach,extend=angular.extend,copy=angular.copy,isFunction=angular.isFunction;return Route.prototype={setUrlParams:function(config,params,actionUrl){var val,encodedVal,self=this,url=actionUrl||self.template,protocolAndDomain="",urlParams=self.urlParams={};forEach(url.split(/\W/),function(param){if("hasOwnProperty"===param)throw $resourceMinErr("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(param)&&param&&new RegExp("(^|[^\\\\]):"+param+"(\\W|$)").test(url)&&(urlParams[param]={isQueryParamValue:new RegExp("\\?.*=:"+param+"(?:\\W|$)").test(url)})}),url=url.replace(/\\:/g,":"),url=url.replace(PROTOCOL_AND_DOMAIN_REGEX,function(match){return protocolAndDomain=match,""}),params=params||{},forEach(self.urlParams,function(paramInfo,urlParam){val=params.hasOwnProperty(urlParam)?params[urlParam]:self.defaults[urlParam],angular.isDefined(val)&&null!==val?(encodedVal=paramInfo.isQueryParamValue?encodeUriQuery(val,!0):encodeUriSegment(val),url=url.replace(new RegExp(":"+urlParam+"(\\W|$)","g"),function(match,p1){return encodedVal+p1})):url=url.replace(new RegExp("(/?):"+urlParam+"(\\W|$)","g"),function(match,leadingSlashes,tail){return"/"==tail.charAt(0)?tail:leadingSlashes+tail})}),self.defaults.stripTrailingSlashes&&(url=url.replace(/\/+$/,"")||"/"),url=url.replace(/\/\.(?=\w+($|\?))/,"."),config.url=protocolAndDomain+url.replace(/\/\\\./,"/."),forEach(params,function(value,key){self.urlParams[key]||(config.params=config.params||{},config.params[key]=value)})}},resourceFactory}]})}(window,window.angular),function(window,angular){"use strict";function nodeName_(element){return angular.lowercase(element.nodeName||element[0]&&element[0].nodeName)}function $TouchProvider($provide,$compileProvider){var ngClickOverrideEnabled=!1,ngClickDirectiveAdded=!1;this.ngClickOverrideEnabled=function(enabled){return angular.isDefined(enabled)?(enabled&&!ngClickDirectiveAdded&&(ngClickDirectiveAdded=!0,ngTouchClickDirectiveFactory.$$moduleName="ngTouch",$compileProvider.directive("ngClick",ngTouchClickDirectiveFactory),$provide.decorator("ngClickDirective",["$delegate",function($delegate){if(ngClickOverrideEnabled)$delegate.shift();else for(var i=$delegate.length-1;i>=0;){if("ngTouch"===$delegate[i].$$moduleName){$delegate.splice(i,1);break}i--}return $delegate}])),ngClickOverrideEnabled=enabled,this):ngClickOverrideEnabled},this.$get=function(){return{ngClickOverrideEnabled:function(){return ngClickOverrideEnabled}}}}function makeSwipeDirective(directiveName,direction,eventName){ngTouch.directive(directiveName,["$parse","$swipe",function($parse,$swipe){return function(scope,element,attr){function validSwipe(coords){if(!startCoords)return!1;var deltaY=Math.abs(coords.y-startCoords.y),deltaX=(coords.x-startCoords.x)*direction;return valid&&deltaY<75&&deltaX>0&&deltaX>30&&deltaY/deltaX<.3}var startCoords,valid,swipeHandler=$parse(attr[directiveName]),pointerTypes=["touch"];angular.isDefined(attr.ngSwipeDisableMouse)||pointerTypes.push("mouse"),$swipe.bind(element,{start:function(coords,event){startCoords=coords,valid=!0},cancel:function(event){valid=!1},end:function(coords,event){validSwipe(coords)&&scope.$apply(function(){element.triggerHandler(eventName),swipeHandler(scope,{$event:event})})}},pointerTypes)}}])}var ngTouch=angular.module("ngTouch",[]);ngTouch.provider("$touch",$TouchProvider),$TouchProvider.$inject=["$provide","$compileProvider"],ngTouch.factory("$swipe",[function(){function getCoordinates(event){var originalEvent=event.originalEvent||event,touches=originalEvent.touches&&originalEvent.touches.length?originalEvent.touches:[originalEvent],e=originalEvent.changedTouches&&originalEvent.changedTouches[0]||touches[0];return{x:e.clientX,y:e.clientY}}function getEvents(pointerTypes,eventType){var res=[];return angular.forEach(pointerTypes,function(pointerType){var eventName=POINTER_EVENTS[pointerType][eventType];eventName&&res.push(eventName)}),res.join(" ")}var POINTER_EVENTS={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}};return{bind:function(element,eventHandlers,pointerTypes){var totalX,totalY,startCoords,lastPos,active=!1;pointerTypes=pointerTypes||["mouse","touch"],element.on(getEvents(pointerTypes,"start"),function(event){startCoords=getCoordinates(event),active=!0,totalX=0,totalY=0,lastPos=startCoords,eventHandlers.start&&eventHandlers.start(startCoords,event)});var events=getEvents(pointerTypes,"cancel");events&&element.on(events,function(event){active=!1,eventHandlers.cancel&&eventHandlers.cancel(event)}),element.on(getEvents(pointerTypes,"move"),function(event){if(active&&startCoords){var coords=getCoordinates(event);if(totalX+=Math.abs(coords.x-lastPos.x),totalY+=Math.abs(coords.y-lastPos.y),lastPos=coords,!(totalX<10&&totalY<10))return totalY>totalX?(active=!1,void(eventHandlers.cancel&&eventHandlers.cancel(event))):(event.preventDefault(),void(eventHandlers.move&&eventHandlers.move(coords,event)))}}),element.on(getEvents(pointerTypes,"end"),function(event){active&&(active=!1,eventHandlers.end&&eventHandlers.end(getCoordinates(event),event))})}}}]);var ngTouchClickDirectiveFactory=["$parse","$timeout","$rootElement",function($parse,$timeout,$rootElement){function hit(x1,y1,x2,y2){return Math.abs(x1-x2)<CLICKBUSTER_THRESHOLD&&Math.abs(y1-y2)<CLICKBUSTER_THRESHOLD}function checkAllowableRegions(touchCoordinates,x,y){for(var i=0;i<touchCoordinates.length;i+=2)if(hit(touchCoordinates[i],touchCoordinates[i+1],x,y))return touchCoordinates.splice(i,i+2),!0;return!1}function onClick(event){if(!(Date.now()-lastPreventedTime>PREVENT_DURATION)){var touches=event.touches&&event.touches.length?event.touches:[event],x=touches[0].clientX,y=touches[0].clientY;x<1&&y<1||lastLabelClickCoordinates&&lastLabelClickCoordinates[0]===x&&lastLabelClickCoordinates[1]===y||(lastLabelClickCoordinates&&(lastLabelClickCoordinates=null),"label"===nodeName_(event.target)&&(lastLabelClickCoordinates=[x,y]),checkAllowableRegions(touchCoordinates,x,y)||(event.stopPropagation(),event.preventDefault(),event.target&&event.target.blur&&event.target.blur()))}}function onTouchStart(event){var touches=event.touches&&event.touches.length?event.touches:[event],x=touches[0].clientX,y=touches[0].clientY;touchCoordinates.push(x,y),$timeout(function(){for(var i=0;i<touchCoordinates.length;i+=2)if(touchCoordinates[i]==x&&touchCoordinates[i+1]==y)return void touchCoordinates.splice(i,i+2)},PREVENT_DURATION,!1)}function preventGhostClick(x,y){touchCoordinates||($rootElement[0].addEventListener("click",onClick,!0),$rootElement[0].addEventListener("touchstart",onTouchStart,!0),touchCoordinates=[]),lastPreventedTime=Date.now(),checkAllowableRegions(touchCoordinates,x,y)}var lastPreventedTime,touchCoordinates,lastLabelClickCoordinates,PREVENT_DURATION=2500,CLICKBUSTER_THRESHOLD=25,ACTIVE_CLASS_NAME="ng-click-active";return function(scope,element,attr){function resetState(){tapping=!1,element.removeClass(ACTIVE_CLASS_NAME)}var tapElement,startTime,touchStartX,touchStartY,clickHandler=$parse(attr.ngClick),tapping=!1;element.on("touchstart",function(event){tapping=!0,tapElement=event.target?event.target:event.srcElement,3==tapElement.nodeType&&(tapElement=tapElement.parentNode),element.addClass(ACTIVE_CLASS_NAME),startTime=Date.now();var originalEvent=event.originalEvent||event,touches=originalEvent.touches&&originalEvent.touches.length?originalEvent.touches:[originalEvent],e=touches[0];touchStartX=e.clientX,touchStartY=e.clientY}),element.on("touchcancel",function(event){resetState()}),element.on("touchend",function(event){var diff=Date.now()-startTime,originalEvent=event.originalEvent||event,touches=originalEvent.changedTouches&&originalEvent.changedTouches.length?originalEvent.changedTouches:originalEvent.touches&&originalEvent.touches.length?originalEvent.touches:[originalEvent],e=touches[0],x=e.clientX,y=e.clientY,dist=Math.sqrt(Math.pow(x-touchStartX,2)+Math.pow(y-touchStartY,2));tapping&&diff<750&&dist<12&&(preventGhostClick(x,y),tapElement&&tapElement.blur(),angular.isDefined(attr.disabled)&&!1!==attr.disabled||element.triggerHandler("click",[event])),resetState()}),element.onclick=function(event){},element.on("click",function(event,touchend){scope.$apply(function(){clickHandler(scope,{$event:touchend||event})})}),element.on("mousedown",function(event){element.addClass(ACTIVE_CLASS_NAME)}),element.on("mousemove mouseup",function(event){element.removeClass(ACTIVE_CLASS_NAME)})}}];makeSwipeDirective("ngSwipeLeft",-1,"swipeleft"),makeSwipeDirective("ngSwipeRight",1,"swiperight")}(window,window.angular),function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["angular"],factory):root.hasOwnProperty("angular")?factory(root.angular):"object"==typeof exports&&(module.exports=factory(require("angular")))}(this,function(angular){"use strict";function isStorageSupported($window,storageType){var supported;try{supported=$window[storageType]}catch(err){supported=!1}if(supported){var key="__"+Math.round(1e7*Math.random());try{$window[storageType].setItem(key,key),$window[storageType].removeItem(key,key)}catch(err){supported=!1}}return supported}function _storageProvider(storageType){var providerWebStorage=isStorageSupported(window,storageType);return function(){var storageKeyPrefix="ngStorage-";this.setKeyPrefix=function(prefix){if("string"!=typeof prefix)throw new TypeError("[ngStorage] - "+storageType+"Provider.setKeyPrefix() expects a String.");storageKeyPrefix=prefix};var serializer=angular.toJson,deserializer=angular.fromJson;this.setSerializer=function(s){if("function"!=typeof s)throw new TypeError("[ngStorage] - "+storageType+"Provider.setSerializer expects a function.");serializer=s},this.setDeserializer=function(d){if("function"!=typeof d)throw new TypeError("[ngStorage] - "+storageType+"Provider.setDeserializer expects a function.");deserializer=d},this.supported=function(){return!!providerWebStorage},this.get=function(key){return providerWebStorage&&deserializer(providerWebStorage.getItem(storageKeyPrefix+key))},this.set=function(key,value){return providerWebStorage&&providerWebStorage.setItem(storageKeyPrefix+key,serializer(value))},this.remove=function(key){providerWebStorage&&providerWebStorage.removeItem(storageKeyPrefix+key)},this.$get=["$rootScope","$window","$log","$timeout","$document",function($rootScope,$window,$log,$timeout,$document){var _last$storage,_debounce,prefixLength=storageKeyPrefix.length,isSupported=isStorageSupported($window,storageType),webStorage=isSupported||($log.warn("This browser does not support Web Storage!"),{setItem:angular.noop,getItem:angular.noop,removeItem:angular.noop}),$storage={$default:function(items){for(var k in items)angular.isDefined($storage[k])||($storage[k]=angular.copy(items[k]));return $storage.$sync(),$storage},$reset:function(items){for(var k in $storage)"$"===k[0]||delete $storage[k]&&webStorage.removeItem(storageKeyPrefix+k);return $storage.$default(items)},$sync:function(){for(var k,i=0,l=webStorage.length;i<l;i++)(k=webStorage.key(i))&&storageKeyPrefix===k.slice(0,prefixLength)&&($storage[k.slice(prefixLength)]=deserializer(webStorage.getItem(k)))},$apply:function(){var temp$storage;if(_debounce=null,!angular.equals($storage,_last$storage)){temp$storage=angular.copy(_last$storage),angular.forEach($storage,function(v,k){angular.isDefined(v)&&"$"!==k[0]&&(webStorage.setItem(storageKeyPrefix+k,serializer(v)),delete temp$storage[k])});for(var k in temp$storage)webStorage.removeItem(storageKeyPrefix+k);_last$storage=angular.copy($storage)}},$supported:function(){return!!isSupported}};return $storage.$sync(),_last$storage=angular.copy($storage),$rootScope.$watch(function(){_debounce||(_debounce=$timeout($storage.$apply,100,!1))}),$window.addEventListener&&$window.addEventListener("storage",function(event){if(event.key){var doc=$document[0];doc.hasFocus&&doc.hasFocus()||storageKeyPrefix!==event.key.slice(0,prefixLength)||(event.newValue?$storage[event.key.slice(prefixLength)]=deserializer(event.newValue):delete $storage[event.key.slice(prefixLength)],_last$storage=angular.copy($storage),$rootScope.$apply())}}),$window.addEventListener&&$window.addEventListener("beforeunload",function(){$storage.$apply()}),$storage}]}}return angular=angular&&angular.module?angular:window.angular,angular.module("ngStorage",[]).provider("$localStorage",_storageProvider("localStorage")).provider("$sessionStorage",_storageProvider("sessionStorage"))}),function(window,angular){"use strict";function assertArg(arg,name,reason){if(!arg)throw ngMinErr("areq","Argument '{0}' is {1}",name||"?",reason||"required");return arg}function mergeClasses(a,b){return a||b?a?b?(isArray(a)&&(a=a.join(" ")),isArray(b)&&(b=b.join(" ")),a+" "+b):a:b:""}function packageStyles(options){var styles={};return options&&(options.to||options.from)&&(styles.to=options.to,styles.from=options.from),styles}function pendClasses(classes,fix,isPrefix){var className="";return classes=isArray(classes)?classes:classes&&isString(classes)&&classes.length?classes.split(/\s+/):[],forEach(classes,function(klass,i){klass&&klass.length>0&&(className+=i>0?" ":"",className+=isPrefix?fix+klass:klass+fix)}),className}function removeFromArray(arr,val){var index=arr.indexOf(val);val>=0&&arr.splice(index,1)}function stripCommentsFromElement(element){if(element instanceof jqLite)switch(element.length){case 0:return[];case 1:if(element[0].nodeType===ELEMENT_NODE)return element;break;default:return jqLite(extractElementNode(element))}if(element.nodeType===ELEMENT_NODE)return jqLite(element)}function extractElementNode(element){if(!element[0])return element;for(var i=0;i<element.length;i++){var elm=element[i];if(elm.nodeType==ELEMENT_NODE)return elm}}function $$addClass($$jqLite,element,className){forEach(element,function(elm){$$jqLite.addClass(elm,className)})}function $$removeClass($$jqLite,element,className){forEach(element,function(elm){$$jqLite.removeClass(elm,className)})}function applyAnimationClassesFactory($$jqLite){return function(element,options){options.addClass&&($$addClass($$jqLite,element,options.addClass),options.addClass=null),options.removeClass&&($$removeClass($$jqLite,element,options.removeClass),options.removeClass=null)}}function prepareAnimationOptions(options){if(options=options||{},!options.$$prepared){var domOperation=options.domOperation||noop;options.domOperation=function(){options.$$domOperationFired=!0,domOperation(),domOperation=noop},options.$$prepared=!0}return options}function applyAnimationStyles(element,options){applyAnimationFromStyles(element,options),applyAnimationToStyles(element,options)}function applyAnimationFromStyles(element,options){options.from&&(element.css(options.from),options.from=null)}function applyAnimationToStyles(element,options){options.to&&(element.css(options.to),options.to=null)}function mergeAnimationDetails(element,oldAnimation,newAnimation){var target=oldAnimation.options||{},newOptions=newAnimation.options||{},toAdd=(target.addClass||"")+" "+(newOptions.addClass||""),toRemove=(target.removeClass||"")+" "+(newOptions.removeClass||""),classes=resolveElementClasses(element.attr("class"),toAdd,toRemove);newOptions.preparationClasses&&(target.preparationClasses=concatWithSpace(newOptions.preparationClasses,target.preparationClasses),delete newOptions.preparationClasses);var realDomOperation=target.domOperation!==noop?target.domOperation:null;return extend(target,newOptions),realDomOperation&&(target.domOperation=realDomOperation),classes.addClass?target.addClass=classes.addClass:target.addClass=null,classes.removeClass?target.removeClass=classes.removeClass:target.removeClass=null,oldAnimation.addClass=target.addClass,oldAnimation.removeClass=target.removeClass,target}function resolveElementClasses(existing,toAdd,toRemove){function splitClassesToLookup(classes){isString(classes)&&(classes=classes.split(" "));var obj={};return forEach(classes,function(klass){klass.length&&(obj[klass]=!0)}),obj}var flags={};existing=splitClassesToLookup(existing),toAdd=splitClassesToLookup(toAdd),forEach(toAdd,function(value,key){flags[key]=1}),toRemove=splitClassesToLookup(toRemove),forEach(toRemove,function(value,key){flags[key]=1===flags[key]?null:-1});var classes={addClass:"",removeClass:""};return forEach(flags,function(val,klass){var prop,allow;1===val?(prop="addClass",allow=!existing[klass]):-1===val&&(prop="removeClass",allow=existing[klass]),allow&&(classes[prop].length&&(classes[prop]+=" "),classes[prop]+=klass)}),classes}function getDomNode(element){return element instanceof angular.element?element[0]:element}function applyGeneratedPreparationClasses(element,event,options){var classes="";event&&(classes=pendClasses(event,EVENT_CLASS_PREFIX,!0)),options.addClass&&(classes=concatWithSpace(classes,pendClasses(options.addClass,ADD_CLASS_SUFFIX))),options.removeClass&&(classes=concatWithSpace(classes,pendClasses(options.removeClass,REMOVE_CLASS_SUFFIX))),classes.length&&(options.preparationClasses=classes,element.addClass(classes))}function clearGeneratedClasses(element,options){options.preparationClasses&&(element.removeClass(options.preparationClasses),options.preparationClasses=null),options.activeClasses&&(element.removeClass(options.activeClasses),options.activeClasses=null)}function blockTransitions(node,duration){var value=duration?"-"+duration+"s":"";return applyInlineStyle(node,[TRANSITION_DELAY_PROP,value]),[TRANSITION_DELAY_PROP,value]}function blockKeyframeAnimations(node,applyBlock){var value=applyBlock?"paused":"",key=ANIMATION_PROP+ANIMATION_PLAYSTATE_KEY;return applyInlineStyle(node,[key,value]),[key,value]}function applyInlineStyle(node,styleTuple){var prop=styleTuple[0],value=styleTuple[1];node.style[prop]=value}function concatWithSpace(a,b){return a?b?a+" "+b:a:b}function getCssKeyframeDurationStyle(duration){return[ANIMATION_DURATION_PROP,duration+"s"]}function getCssDelayStyle(delay,isKeyframeAnimation){return[isKeyframeAnimation?ANIMATION_DELAY_PROP:TRANSITION_DELAY_PROP,delay+"s"]}function computeCssStyles($window,element,properties){var styles=Object.create(null),detectedStyles=$window.getComputedStyle(element)||{};return forEach(properties,function(formalStyleName,actualStyleName){var val=detectedStyles[formalStyleName];if(val){var c=val.charAt(0);("-"===c||"+"===c||c>=0)&&(val=parseMaxTime(val)),0===val&&(val=null),styles[actualStyleName]=val}}),styles}function parseMaxTime(str){var maxValue=0,values=str.split(/\s*,\s*/);return forEach(values,function(value){"s"==value.charAt(value.length-1)&&(value=value.substring(0,value.length-1)),value=parseFloat(value)||0,maxValue=maxValue?Math.max(value,maxValue):value}),maxValue}function truthyTimingValue(val){return 0===val||null!=val}function getCssTransitionDurationStyle(duration,applyOnlyDuration){var style=TRANSITION_PROP,value=duration+"s";return applyOnlyDuration?style+=DURATION_KEY:value+=" linear all",[style,value]}function createLocalCacheLookup(){var cache=Object.create(null);return{flush:function(){cache=Object.create(null)},count:function(key){var entry=cache[key];return entry?entry.total:0},get:function(key){var entry=cache[key];return entry&&entry.value},put:function(key,value){cache[key]?cache[key].total++:cache[key]={total:1,value:value}}}}function registerRestorableStyles(backup,node,properties){forEach(properties,function(prop){backup[prop]=isDefined(backup[prop])?backup[prop]:node.style.getPropertyValue(prop)})}var TRANSITION_PROP,TRANSITIONEND_EVENT,ANIMATION_PROP,ANIMATIONEND_EVENT,noop=angular.noop,copy=angular.copy,extend=angular.extend,jqLite=angular.element,forEach=angular.forEach,isArray=angular.isArray,isString=angular.isString,isObject=angular.isObject,isUndefined=angular.isUndefined,isDefined=angular.isDefined,isFunction=angular.isFunction,isElement=angular.isElement,ELEMENT_NODE=1,ADD_CLASS_SUFFIX="-add",REMOVE_CLASS_SUFFIX="-remove",EVENT_CLASS_PREFIX="ng-",NG_ANIMATE_CLASSNAME="ng-animate",NG_ANIMATE_CHILDREN_DATA="$$ngAnimateChildren";isUndefined(window.ontransitionend)&&isDefined(window.onwebkittransitionend)?("-webkit-",TRANSITION_PROP="WebkitTransition",TRANSITIONEND_EVENT="webkitTransitionEnd transitionend"):(TRANSITION_PROP="transition",TRANSITIONEND_EVENT="transitionend"),isUndefined(window.onanimationend)&&isDefined(window.onwebkitanimationend)?("-webkit-",ANIMATION_PROP="WebkitAnimation",ANIMATIONEND_EVENT="webkitAnimationEnd animationend"):(ANIMATION_PROP="animation",ANIMATIONEND_EVENT="animationend");var DURATION_KEY="Duration",TIMING_KEY="TimingFunction",ANIMATION_PLAYSTATE_KEY="PlayState",ANIMATION_DELAY_PROP=ANIMATION_PROP+"Delay",ANIMATION_DURATION_PROP=ANIMATION_PROP+DURATION_KEY,TRANSITION_DELAY_PROP=TRANSITION_PROP+"Delay",TRANSITION_DURATION_PROP=TRANSITION_PROP+DURATION_KEY,ngMinErr=angular.$$minErr("ng"),$$rAFSchedulerFactory=["$$rAF",function($$rAF){function scheduler(tasks){queue=queue.concat(tasks),nextTick()}function nextTick(){if(queue.length){for(var items=queue.shift(),i=0;i<items.length;i++)items[i]();cancelFn||$$rAF(function(){cancelFn||nextTick()})}}var queue,cancelFn;return queue=scheduler.queue=[],scheduler.waitUntilQuiet=function(fn){cancelFn&&cancelFn(),cancelFn=$$rAF(function(){cancelFn=null,fn(),nextTick()})},scheduler}],$$AnimateChildrenDirective=["$interpolate",function($interpolate){return{link:function(scope,element,attrs){function setData(value){value="on"===value||"true"===value,element.data(NG_ANIMATE_CHILDREN_DATA,value)}var val=attrs.ngAnimateChildren;angular.isString(val)&&0===val.length?element.data(NG_ANIMATE_CHILDREN_DATA,!0):(setData($interpolate(val)(scope)),attrs.$observe("ngAnimateChildren",setData))}}}],ANIMATE_TIMER_KEY="$$animateCss",ONE_SECOND=1e3,ELAPSED_TIME_MAX_DECIMAL_PLACES=3,CLOSING_TIME_BUFFER=1.5,DETECT_CSS_PROPERTIES={transitionDuration:TRANSITION_DURATION_PROP,transitionDelay:TRANSITION_DELAY_PROP,transitionProperty:TRANSITION_PROP+"Property",animationDuration:ANIMATION_DURATION_PROP,animationDelay:ANIMATION_DELAY_PROP,animationIterationCount:ANIMATION_PROP+"IterationCount"},DETECT_STAGGER_CSS_PROPERTIES={transitionDuration:TRANSITION_DURATION_PROP,transitionDelay:TRANSITION_DELAY_PROP,animationDuration:ANIMATION_DURATION_PROP,animationDelay:ANIMATION_DELAY_PROP},$AnimateCssProvider=["$animateProvider",function($animateProvider){var gcsLookup=createLocalCacheLookup(),gcsStaggerLookup=createLocalCacheLookup();this.$get=["$window","$$jqLite","$$AnimateRunner","$timeout","$$forceReflow","$sniffer","$$rAFScheduler","$$animateQueue",function($window,$$jqLite,$$AnimateRunner,$timeout,$$forceReflow,$sniffer,$$rAFScheduler,$$animateQueue){function gcsHashFn(node,extraClasses){var KEY="$$ngAnimateParentKey",parentNode=node.parentNode;return(parentNode[KEY]||(parentNode[KEY]=++parentCounter))+"-"+node.getAttribute("class")+"-"+extraClasses}function computeCachedCssStyles(node,className,cacheKey,properties){var timings=gcsLookup.get(cacheKey);return timings||(timings=computeCssStyles($window,node,properties),"infinite"===timings.animationIterationCount&&(timings.animationIterationCount=1)),gcsLookup.put(cacheKey,timings),timings}function computeCachedCssStaggerStyles(node,className,cacheKey,properties){var stagger;if(gcsLookup.count(cacheKey)>0&&!(stagger=gcsStaggerLookup.get(cacheKey))){var staggerClassName=pendClasses(className,"-stagger");$$jqLite.addClass(node,staggerClassName),stagger=computeCssStyles($window,node,properties),stagger.animationDuration=Math.max(stagger.animationDuration,0),stagger.transitionDuration=Math.max(stagger.transitionDuration,0),$$jqLite.removeClass(node,staggerClassName),gcsStaggerLookup.put(cacheKey,stagger)}return stagger||{}}function waitUntilQuiet(callback){rafWaitQueue.push(callback),$$rAFScheduler.waitUntilQuiet(function(){gcsLookup.flush(),gcsStaggerLookup.flush();for(var pageWidth=$$forceReflow(),i=0;i<rafWaitQueue.length;i++)rafWaitQueue[i](pageWidth);rafWaitQueue.length=0})}function computeTimings(node,className,cacheKey){var timings=computeCachedCssStyles(node,className,cacheKey,DETECT_CSS_PROPERTIES),aD=timings.animationDelay,tD=timings.transitionDelay;return timings.maxDelay=aD&&tD?Math.max(aD,tD):aD||tD,timings.maxDuration=Math.max(timings.animationDuration*timings.animationIterationCount,timings.transitionDuration),timings}var applyAnimationClasses=applyAnimationClassesFactory($$jqLite),parentCounter=0,rafWaitQueue=[];return function(element,initialOptions){function endFn(){close()}function cancelFn(){close(!0)}function close(rejected){if(!(animationClosed||animationCompleted&&animationPaused)){animationClosed=!0,animationPaused=!1,options.$$skipPreparationClasses||$$jqLite.removeClass(element,preparationClasses),$$jqLite.removeClass(element,activeClasses),blockKeyframeAnimations(node,!1),blockTransitions(node,!1),forEach(temporaryStyles,function(entry){node.style[entry[0]]=""}),applyAnimationClasses(element,options),applyAnimationStyles(element,options),Object.keys(restoreStyles).length&&forEach(restoreStyles,function(value,prop){value?node.style.setProperty(prop,value):node.style.removeProperty(prop)}),options.onDone&&options.onDone(),events&&events.length&&element.off(events.join(" "),onAnimationProgress);var animationTimerData=element.data(ANIMATE_TIMER_KEY);animationTimerData&&($timeout.cancel(animationTimerData[0].timer),element.removeData(ANIMATE_TIMER_KEY)),runner&&runner.complete(!rejected)}}function applyBlocking(duration){flags.blockTransition&&blockTransitions(node,duration),flags.blockKeyframeAnimation&&blockKeyframeAnimations(node,!!duration)}function closeAndReturnNoopAnimator(){return runner=new $$AnimateRunner({end:endFn,cancel:cancelFn}),waitUntilQuiet(noop),close(),{$$willAnimate:!1,start:function(){return runner},end:endFn}}function onAnimationProgress(event){event.stopPropagation();var ev=event.originalEvent||event,timeStamp=ev.$manualTimeStamp||Date.now(),elapsedTime=parseFloat(ev.elapsedTime.toFixed(ELAPSED_TIME_MAX_DECIMAL_PLACES));Math.max(timeStamp-startTime,0)>=maxDelayTime&&elapsedTime>=maxDuration&&(animationCompleted=!0,close())}function start(){function triggerAnimationStart(){if(!animationClosed){if(applyBlocking(!1),forEach(temporaryStyles,function(entry){var key=entry[0],value=entry[1];node.style[key]=value}),applyAnimationClasses(element,options),$$jqLite.addClass(element,activeClasses),flags.recalculateTimingStyles){if(fullClassName=node.className+" "+preparationClasses,cacheKey=gcsHashFn(node,fullClassName),timings=computeTimings(node,fullClassName,cacheKey),relativeDelay=timings.maxDelay,maxDelay=Math.max(relativeDelay,0),0===(maxDuration=timings.maxDuration))return void close();flags.hasTransitions=timings.transitionDuration>0,flags.hasAnimations=timings.animationDuration>0}if(flags.applyAnimationDelay&&(relativeDelay="boolean"!=typeof options.delay&&truthyTimingValue(options.delay)?parseFloat(options.delay):relativeDelay,maxDelay=Math.max(relativeDelay,0),timings.animationDelay=relativeDelay,delayStyle=getCssDelayStyle(relativeDelay,!0),temporaryStyles.push(delayStyle),node.style[delayStyle[0]]=delayStyle[1]),maxDelayTime=maxDelay*ONE_SECOND,maxDurationTime=maxDuration*ONE_SECOND,options.easing){var easeProp,easeVal=options.easing;flags.hasTransitions&&(easeProp=TRANSITION_PROP+TIMING_KEY,temporaryStyles.push([easeProp,easeVal]),node.style[easeProp]=easeVal),flags.hasAnimations&&(easeProp=ANIMATION_PROP+TIMING_KEY,temporaryStyles.push([easeProp,easeVal]),node.style[easeProp]=easeVal)}timings.transitionDuration&&events.push(TRANSITIONEND_EVENT),timings.animationDuration&&events.push(ANIMATIONEND_EVENT),startTime=Date.now();var timerTime=maxDelayTime+CLOSING_TIME_BUFFER*maxDurationTime,endTime=startTime+timerTime,animationsData=element.data(ANIMATE_TIMER_KEY)||[],setupFallbackTimer=!0;if(animationsData.length){var currentTimerData=animationsData[0];setupFallbackTimer=endTime>currentTimerData.expectedEndTime,setupFallbackTimer?$timeout.cancel(currentTimerData.timer):animationsData.push(close)}if(setupFallbackTimer){var timer=$timeout(onAnimationExpired,timerTime,!1);animationsData[0]={timer:timer,expectedEndTime:endTime},animationsData.push(close),element.data(ANIMATE_TIMER_KEY,animationsData)}events.length&&element.on(events.join(" "),onAnimationProgress),options.to&&(options.cleanupStyles&&registerRestorableStyles(restoreStyles,node,Object.keys(options.to)),applyAnimationToStyles(element,options))}}function onAnimationExpired(){var animationsData=element.data(ANIMATE_TIMER_KEY);if(animationsData){for(var i=1;i<animationsData.length;i++)animationsData[i]();element.removeData(ANIMATE_TIMER_KEY)}}if(!animationClosed){if(!node.parentNode)return void close();var playPause=function(playAnimation){if(animationCompleted)animationPaused&&playAnimation&&(animationPaused=!1,close());else if(animationPaused=!playAnimation,timings.animationDuration){var value=blockKeyframeAnimations(node,animationPaused);animationPaused?temporaryStyles.push(value):removeFromArray(temporaryStyles,value)}},maxStagger=itemIndex>0&&(timings.transitionDuration&&0===stagger.transitionDuration||timings.animationDuration&&0===stagger.animationDuration)&&Math.max(stagger.animationDelay,stagger.transitionDelay);maxStagger?$timeout(triggerAnimationStart,Math.floor(maxStagger*itemIndex*ONE_SECOND),!1):triggerAnimationStart(),runnerHost.resume=function(){playPause(!0)},runnerHost.pause=function(){playPause(!1)}}}var options=initialOptions||{};options.$$prepared||(options=prepareAnimationOptions(copy(options)));var restoreStyles={},node=getDomNode(element);if(!node||!node.parentNode||!$$animateQueue.enabled())return closeAndReturnNoopAnimator();var animationClosed,animationPaused,animationCompleted,runner,runnerHost,maxDelay,maxDelayTime,maxDuration,maxDurationTime,startTime,temporaryStyles=[],classes=element.attr("class"),styles=packageStyles(options),events=[];if(0===options.duration||!$sniffer.animations&&!$sniffer.transitions)return closeAndReturnNoopAnimator();var method=options.event&&isArray(options.event)?options.event.join(" "):options.event,isStructural=method&&options.structural,structuralClassName="",addRemoveClassName="";isStructural?structuralClassName=pendClasses(method,EVENT_CLASS_PREFIX,!0):method&&(structuralClassName=method),options.addClass&&(addRemoveClassName+=pendClasses(options.addClass,ADD_CLASS_SUFFIX)),options.removeClass&&(addRemoveClassName.length&&(addRemoveClassName+=" "),addRemoveClassName+=pendClasses(options.removeClass,REMOVE_CLASS_SUFFIX)),options.applyClassesEarly&&addRemoveClassName.length&&applyAnimationClasses(element,options);var preparationClasses=[structuralClassName,addRemoveClassName].join(" ").trim(),fullClassName=classes+" "+preparationClasses,activeClasses=pendClasses(preparationClasses,"-active"),hasToStyles=styles.to&&Object.keys(styles.to).length>0;if(!((options.keyframeStyle||"").length>0||hasToStyles||preparationClasses))return closeAndReturnNoopAnimator();var cacheKey,stagger;if(options.stagger>0){var staggerVal=parseFloat(options.stagger);stagger={transitionDelay:staggerVal,animationDelay:staggerVal,transitionDuration:0,animationDuration:0}}else cacheKey=gcsHashFn(node,fullClassName),stagger=computeCachedCssStaggerStyles(node,preparationClasses,cacheKey,DETECT_STAGGER_CSS_PROPERTIES);options.$$skipPreparationClasses||$$jqLite.addClass(element,preparationClasses);var applyOnlyDuration;if(options.transitionStyle){var transitionStyle=[TRANSITION_PROP,options.transitionStyle];applyInlineStyle(node,transitionStyle),temporaryStyles.push(transitionStyle)}if(options.duration>=0){applyOnlyDuration=node.style[TRANSITION_PROP].length>0;var durationStyle=getCssTransitionDurationStyle(options.duration,applyOnlyDuration);applyInlineStyle(node,durationStyle),temporaryStyles.push(durationStyle)}if(options.keyframeStyle){var keyframeStyle=[ANIMATION_PROP,options.keyframeStyle];applyInlineStyle(node,keyframeStyle),temporaryStyles.push(keyframeStyle)}var itemIndex=stagger?options.staggerIndex>=0?options.staggerIndex:gcsLookup.count(cacheKey):0,isFirst=0===itemIndex;isFirst&&!options.skipBlocking&&blockTransitions(node,9999);var timings=computeTimings(node,fullClassName,cacheKey),relativeDelay=timings.maxDelay;maxDelay=Math.max(relativeDelay,0),maxDuration=timings.maxDuration;var flags={};if(flags.hasTransitions=timings.transitionDuration>0,flags.hasAnimations=timings.animationDuration>0,flags.hasTransitionAll=flags.hasTransitions&&"all"==timings.transitionProperty,flags.applyTransitionDuration=hasToStyles&&(flags.hasTransitions&&!flags.hasTransitionAll||flags.hasAnimations&&!flags.hasTransitions),flags.applyAnimationDuration=options.duration&&flags.hasAnimations,flags.applyTransitionDelay=truthyTimingValue(options.delay)&&(flags.applyTransitionDuration||flags.hasTransitions),flags.applyAnimationDelay=truthyTimingValue(options.delay)&&flags.hasAnimations,flags.recalculateTimingStyles=addRemoveClassName.length>0,(flags.applyTransitionDuration||flags.applyAnimationDuration)&&(maxDuration=options.duration?parseFloat(options.duration):maxDuration,flags.applyTransitionDuration&&(flags.hasTransitions=!0,timings.transitionDuration=maxDuration,applyOnlyDuration=node.style[TRANSITION_PROP+"Property"].length>0,temporaryStyles.push(getCssTransitionDurationStyle(maxDuration,applyOnlyDuration))),flags.applyAnimationDuration&&(flags.hasAnimations=!0,timings.animationDuration=maxDuration,temporaryStyles.push(getCssKeyframeDurationStyle(maxDuration)))),0===maxDuration&&!flags.recalculateTimingStyles)return closeAndReturnNoopAnimator();if(null!=options.delay){var delayStyle;"boolean"!=typeof options.delay&&(delayStyle=parseFloat(options.delay),maxDelay=Math.max(delayStyle,0)),flags.applyTransitionDelay&&temporaryStyles.push(getCssDelayStyle(delayStyle)),flags.applyAnimationDelay&&temporaryStyles.push(getCssDelayStyle(delayStyle,!0))}return null==options.duration&&timings.transitionDuration>0&&(flags.recalculateTimingStyles=flags.recalculateTimingStyles||isFirst),maxDelayTime=maxDelay*ONE_SECOND,maxDurationTime=maxDuration*ONE_SECOND,options.skipBlocking||(flags.blockTransition=timings.transitionDuration>0,flags.blockKeyframeAnimation=timings.animationDuration>0&&stagger.animationDelay>0&&0===stagger.animationDuration),options.from&&(options.cleanupStyles&&registerRestorableStyles(restoreStyles,node,Object.keys(options.from)),applyAnimationFromStyles(element,options)),flags.blockTransition||flags.blockKeyframeAnimation?applyBlocking(maxDuration):options.skipBlocking||blockTransitions(node,!1),{$$willAnimate:!0,end:endFn,start:function(){if(!animationClosed)return runnerHost={end:endFn,cancel:cancelFn,resume:null,pause:null},runner=new $$AnimateRunner(runnerHost),waitUntilQuiet(start),runner}}}}]}],$$AnimateCssDriverProvider=["$$animationProvider",function($$animationProvider){function isDocumentFragment(node){return node.parentNode&&11===node.parentNode.nodeType}$$animationProvider.drivers.push("$$animateCssDriver");var NG_ANIMATE_SHIM_CLASS_NAME="ng-animate-shim",NG_OUT_ANCHOR_CLASS_NAME="ng-anchor-out";this.$get=["$animateCss","$rootScope","$$AnimateRunner","$rootElement","$sniffer","$$jqLite","$document",function($animateCss,$rootScope,$$AnimateRunner,$rootElement,$sniffer,$$jqLite,$document){function filterCssClasses(classes){return classes.replace(/\bng-\S+\b/g,"")}function getUniqueValues(a,b){return isString(a)&&(a=a.split(" ")),isString(b)&&(b=b.split(" ")),a.filter(function(val){return-1===b.indexOf(val)}).join(" ")}function prepareAnchoredAnimation(classes,outAnchor,inAnchor){function calculateAnchorStyles(anchor){var styles={},coords=getDomNode(anchor).getBoundingClientRect();return forEach(["width","height","top","left"],function(key){var value=coords[key];switch(key){case"top":value+=bodyNode.scrollTop;break;case"left":value+=bodyNode.scrollLeft}styles[key]=Math.floor(value)+"px"}),styles}function getClassVal(element){return element.attr("class")||""}function prepareInAnimation(){var endingClasses=filterCssClasses(getClassVal(inAnchor)),toAdd=getUniqueValues(endingClasses,startingClasses),toRemove=getUniqueValues(startingClasses,endingClasses),animator=$animateCss(clone,{to:calculateAnchorStyles(inAnchor),addClass:"ng-anchor-in "+toAdd,removeClass:NG_OUT_ANCHOR_CLASS_NAME+" "+toRemove,delay:!0});return animator.$$willAnimate?animator:null}function end(){clone.remove(),outAnchor.removeClass(NG_ANIMATE_SHIM_CLASS_NAME),inAnchor.removeClass(NG_ANIMATE_SHIM_CLASS_NAME)}var clone=jqLite(getDomNode(outAnchor).cloneNode(!0)),startingClasses=filterCssClasses(getClassVal(clone));outAnchor.addClass(NG_ANIMATE_SHIM_CLASS_NAME),inAnchor.addClass(NG_ANIMATE_SHIM_CLASS_NAME),clone.addClass("ng-anchor"),rootBodyElement.append(clone);var animatorIn,animatorOut=function(){var animator=$animateCss(clone,{addClass:NG_OUT_ANCHOR_CLASS_NAME,delay:!0,from:calculateAnchorStyles(outAnchor)});return animator.$$willAnimate?animator:null}();if(!animatorOut&&!(animatorIn=prepareInAnimation()))return end();var startingAnimator=animatorOut||animatorIn;return{start:function(){function endFn(){currentAnimation&&currentAnimation.end()}var runner,currentAnimation=startingAnimator.start();return currentAnimation.done(function(){if(currentAnimation=null,!animatorIn&&(animatorIn=prepareInAnimation()))return currentAnimation=animatorIn.start(),currentAnimation.done(function(){currentAnimation=null,end(),runner.complete()}),currentAnimation;end(),runner.complete()}),runner=new $$AnimateRunner({end:endFn,cancel:endFn})}}}function prepareFromToAnchorAnimation(from,to,classes,anchors){var fromAnimation=prepareRegularAnimation(from),toAnimation=prepareRegularAnimation(to),anchorAnimations=[];if(forEach(anchors,function(anchor){var outElement=anchor.out,inElement=anchor.in,animator=prepareAnchoredAnimation(classes,outElement,inElement);animator&&anchorAnimations.push(animator)}),fromAnimation||toAnimation||0!==anchorAnimations.length)return{start:function(){function endFn(){forEach(animationRunners,function(runner){runner.end()})}var animationRunners=[];fromAnimation&&animationRunners.push(fromAnimation.start()),toAnimation&&animationRunners.push(toAnimation.start()),forEach(anchorAnimations,function(animation){animationRunners.push(animation.start())});var runner=new $$AnimateRunner({end:endFn,cancel:endFn});return $$AnimateRunner.all(animationRunners,function(status){runner.complete(status)}),runner}}}function prepareRegularAnimation(animationDetails){var element=animationDetails.element,options=animationDetails.options||{};animationDetails.structural&&(options.event=animationDetails.event,options.structural=!0,options.applyClassesEarly=!0,"leave"===animationDetails.event&&(options.onDone=options.domOperation)),options.preparationClasses&&(options.event=concatWithSpace(options.event,options.preparationClasses));var animator=$animateCss(element,options);return animator.$$willAnimate?animator:null}if(!$sniffer.animations&&!$sniffer.transitions)return noop;var bodyNode=$document[0].body,rootNode=getDomNode($rootElement),rootBodyElement=jqLite(isDocumentFragment(rootNode)||bodyNode.contains(rootNode)?rootNode:bodyNode);return applyAnimationClassesFactory($$jqLite),function(animationDetails){return animationDetails.from&&animationDetails.to?prepareFromToAnchorAnimation(animationDetails.from,animationDetails.to,animationDetails.classes,animationDetails.anchors):prepareRegularAnimation(animationDetails)}}]}],$$AnimateJsProvider=["$animateProvider",function($animateProvider){this.$get=["$injector","$$AnimateRunner","$$jqLite",function($injector,$$AnimateRunner,$$jqLite){function lookupAnimations(classes){classes=isArray(classes)?classes:classes.split(" ");for(var matches=[],flagMap={},i=0;i<classes.length;i++){var klass=classes[i],animationFactory=$animateProvider.$$registeredAnimations[klass];animationFactory&&!flagMap[klass]&&(matches.push($injector.get(animationFactory)),flagMap[klass]=!0)}return matches}var applyAnimationClasses=applyAnimationClassesFactory($$jqLite);return function(element,event,classes,options){function applyOptions(){options.domOperation(),applyAnimationClasses(element,options)}function close(){animationClosed=!0,applyOptions(),applyAnimationStyles(element,options)}function executeAnimationFn(fn,element,event,options,onDone){var args;switch(event){case"animate":args=[element,options.from,options.to,onDone];break;case"setClass":args=[element,classesToAdd,classesToRemove,onDone];break;case"addClass":args=[element,classesToAdd,onDone];break;case"removeClass":args=[element,classesToRemove,onDone];break;default:args=[element,onDone]}args.push(options);var value=fn.apply(fn,args);if(value)if(isFunction(value.start)&&(value=value.start()),value instanceof $$AnimateRunner)value.done(onDone);else if(isFunction(value))return value;return noop}function groupEventedAnimations(element,event,options,animations,fnName){var operations=[];return forEach(animations,function(ani){var animation=ani[fnName];animation&&operations.push(function(){var runner,endProgressCb,resolved=!1,onAnimationComplete=function(rejected){resolved||(resolved=!0,(endProgressCb||noop)(rejected),runner.complete(!rejected))};return runner=new $$AnimateRunner({end:function(){onAnimationComplete()},cancel:function(){onAnimationComplete(!0)}}),endProgressCb=executeAnimationFn(animation,element,event,options,function(result){onAnimationComplete(!1===result)}),runner})}),operations}function packageAnimations(element,event,options,animations,fnName){var operations=groupEventedAnimations(element,event,options,animations,fnName);if(0===operations.length){var a,b;"beforeSetClass"===fnName?(a=groupEventedAnimations(element,"removeClass",options,animations,"beforeRemoveClass"),b=groupEventedAnimations(element,"addClass",options,animations,"beforeAddClass")):"setClass"===fnName&&(a=groupEventedAnimations(element,"removeClass",options,animations,"removeClass"),b=groupEventedAnimations(element,"addClass",options,animations,"addClass")),a&&(operations=operations.concat(a)),b&&(operations=operations.concat(b))}if(0!==operations.length)return function(callback){var runners=[];return operations.length&&forEach(operations,function(animateFn){runners.push(animateFn())}),runners.length?$$AnimateRunner.all(runners,callback):callback(),function(reject){forEach(runners,function(runner){reject?runner.cancel():runner.end()})}}}var animationClosed=!1;3===arguments.length&&isObject(classes)&&(options=classes,classes=null),options=prepareAnimationOptions(options),classes||(classes=element.attr("class")||"",options.addClass&&(classes+=" "+options.addClass),options.removeClass&&(classes+=" "+options.removeClass));var before,after,classesToAdd=options.addClass,classesToRemove=options.removeClass,animations=lookupAnimations(classes);if(animations.length){var afterFn,beforeFn;"leave"==event?(beforeFn="leave",afterFn="afterLeave"):(beforeFn="before"+event.charAt(0).toUpperCase()+event.substr(1),afterFn=event),"enter"!==event&&"move"!==event&&(before=packageAnimations(element,event,options,animations,beforeFn)),after=packageAnimations(element,event,options,animations,afterFn)}if(before||after){var runner;return{$$willAnimate:!0,end:function(){return runner?runner.end():(close(),runner=new $$AnimateRunner,runner.complete(!0)),runner},start:function(){function onComplete(success){close(success),runner.complete(success)}function endAnimations(cancelled){animationClosed||((closeActiveAnimations||noop)(cancelled),onComplete(cancelled))}if(runner)return runner;runner=new $$AnimateRunner;var closeActiveAnimations,chain=[];return before&&chain.push(function(fn){closeActiveAnimations=before(fn)}),chain.length?chain.push(function(fn){applyOptions(),fn(!0)}):applyOptions(),after&&chain.push(function(fn){closeActiveAnimations=after(fn)}),runner.setHost({end:function(){endAnimations()},cancel:function(){endAnimations(!0)}}),$$AnimateRunner.chain(chain,onComplete),runner}}}}}]}],$$AnimateJsDriverProvider=["$$animationProvider",function($$animationProvider){$$animationProvider.drivers.push("$$animateJsDriver"),this.$get=["$$animateJs","$$AnimateRunner",function($$animateJs,$$AnimateRunner){function prepareAnimation(animationDetails){var element=animationDetails.element,event=animationDetails.event,options=animationDetails.options,classes=animationDetails.classes;return $$animateJs(element,event,classes,options)}return function(animationDetails){if(animationDetails.from&&animationDetails.to){var fromAnimation=prepareAnimation(animationDetails.from),toAnimation=prepareAnimation(animationDetails.to);if(!fromAnimation&&!toAnimation)return;return{start:function(){function endFnFactory(){return function(){forEach(animationRunners,function(runner){runner.end()})}}function done(status){runner.complete(status)}var animationRunners=[];fromAnimation&&animationRunners.push(fromAnimation.start()),toAnimation&&animationRunners.push(toAnimation.start()),$$AnimateRunner.all(animationRunners,done);var runner=new $$AnimateRunner({end:endFnFactory(),cancel:endFnFactory()});return runner}}}return prepareAnimation(animationDetails)}}]}],NG_ANIMATE_ATTR_NAME="data-ng-animate",NG_ANIMATE_PIN_DATA="$ngAnimatePin",$$AnimateQueueProvider=["$animateProvider",function($animateProvider){function makeTruthyCssClassMap(classString){if(!classString)return null;var keys=classString.split(ONE_SPACE),map=Object.create(null);return forEach(keys,function(key){map[key]=!0}),map}function hasMatchingClasses(newClassString,currentClassString){if(newClassString&&currentClassString){var currentClassMap=makeTruthyCssClassMap(currentClassString);return newClassString.split(ONE_SPACE).some(function(className){return currentClassMap[className]})}}function isAllowed(ruleType,element,currentAnimation,previousAnimation){return rules[ruleType].some(function(fn){return fn(element,currentAnimation,previousAnimation)})}function hasAnimationClasses(animation,and){var a=(animation.addClass||"").length>0,b=(animation.removeClass||"").length>0;return and?a&&b:a||b}var PRE_DIGEST_STATE=1,RUNNING_STATE=2,ONE_SPACE=" ",rules=this.rules={skip:[],cancel:[],join:[]};rules.join.push(function(element,newAnimation,currentAnimation){return!newAnimation.structural&&hasAnimationClasses(newAnimation)}),rules.skip.push(function(element,newAnimation,currentAnimation){return!newAnimation.structural&&!hasAnimationClasses(newAnimation)}),rules.skip.push(function(element,newAnimation,currentAnimation){return"leave"==currentAnimation.event&&newAnimation.structural}),rules.skip.push(function(element,newAnimation,currentAnimation){return currentAnimation.structural&&currentAnimation.state===RUNNING_STATE&&!newAnimation.structural}),rules.cancel.push(function(element,newAnimation,currentAnimation){return currentAnimation.structural&&newAnimation.structural}),rules.cancel.push(function(element,newAnimation,currentAnimation){return currentAnimation.state===RUNNING_STATE&&newAnimation.structural}),rules.cancel.push(function(element,newAnimation,currentAnimation){if(currentAnimation.structural)return!1;var nA=newAnimation.addClass,nR=newAnimation.removeClass,cA=currentAnimation.addClass,cR=currentAnimation.removeClass;return!(isUndefined(nA)&&isUndefined(nR)||isUndefined(cA)&&isUndefined(cR))&&(hasMatchingClasses(nA,cR)||hasMatchingClasses(nR,cA))}),this.$get=["$$rAF","$rootScope","$rootElement","$document","$$HashMap","$$animation","$$AnimateRunner","$templateRequest","$$jqLite","$$forceReflow",function($$rAF,$rootScope,$rootElement,$document,$$HashMap,$$animation,$$AnimateRunner,$templateRequest,$$jqLite,$$forceReflow){function postDigestTaskFactory(){var postDigestCalled=!1;return function(fn){postDigestCalled?fn():$rootScope.$$postDigest(function(){postDigestCalled=!0,fn()})}}function normalizeAnimationDetails(element,animation){return mergeAnimationDetails(element,animation,{})}function findCallbacks(parent,element,event){var targetNode=getDomNode(element),targetParentNode=getDomNode(parent),matches=[],entries=callbackRegistry[event];return entries&&forEach(entries,function(entry){contains.call(entry.node,targetNode)?matches.push(entry.callback):"leave"===event&&contains.call(entry.node,targetParentNode)&&matches.push(entry.callback)}),matches}function filterFromRegistry(list,matchContainer,matchCallback){var containerNode=extractElementNode(matchContainer);return list.filter(function(entry){return!(entry.node===containerNode&&(!matchCallback||entry.callback===matchCallback))})}function cleanupEventListeners(phase,element){"close"!==phase||element[0].parentNode||$animate.off(element)}function queueAnimation(element,event,initialOptions){function notifyProgress(runner,event,phase,data){runInNextPostDigestOrNow(function(){var callbacks=findCallbacks(parent,element,event);callbacks.length?$$rAF(function(){forEach(callbacks,function(callback){callback(element,phase,data)}),cleanupEventListeners(phase,element)}):cleanupEventListeners(phase,element)}),runner.progress(event,phase,data)}function close(reject){clearGeneratedClasses(element,options),applyAnimationClasses(element,options),applyAnimationStyles(element,options),options.domOperation(),runner.complete(!reject)}var node,parent,options=copy(initialOptions);element=stripCommentsFromElement(element),element&&(node=getDomNode(element),parent=element.parent()),options=prepareAnimationOptions(options);var runner=new $$AnimateRunner,runInNextPostDigestOrNow=postDigestTaskFactory();if(isArray(options.addClass)&&(options.addClass=options.addClass.join(" ")),options.addClass&&!isString(options.addClass)&&(options.addClass=null),isArray(options.removeClass)&&(options.removeClass=options.removeClass.join(" ")),options.removeClass&&!isString(options.removeClass)&&(options.removeClass=null),options.from&&!isObject(options.from)&&(options.from=null),options.to&&!isObject(options.to)&&(options.to=null),!node)return close(),runner;var className=[node.className,options.addClass,options.removeClass].join(" ");if(!isAnimatableClassName(className))return close(),runner;var isStructural=["enter","move","leave"].indexOf(event)>=0,documentHidden=$document[0].hidden,skipAnimations=!animationsEnabled||documentHidden||disabledElementsLookup.get(node),existingAnimation=!skipAnimations&&activeAnimationsLookup.get(node)||{},hasExistingAnimation=!!existingAnimation.state;if(skipAnimations||hasExistingAnimation&&existingAnimation.state==PRE_DIGEST_STATE||(skipAnimations=!areAnimationsAllowed(element,parent,event)),skipAnimations)return documentHidden&&notifyProgress(runner,event,"start"),close(),documentHidden&&notifyProgress(runner,event,"close"),runner;isStructural&&closeChildAnimations(element);var newAnimation={structural:isStructural,element:element,event:event,addClass:options.addClass,removeClass:options.removeClass,close:close,options:options,runner:runner};if(hasExistingAnimation){if(isAllowed("skip",element,newAnimation,existingAnimation))return existingAnimation.state===RUNNING_STATE?(close(),runner):(mergeAnimationDetails(element,existingAnimation,newAnimation),existingAnimation.runner);if(isAllowed("cancel",element,newAnimation,existingAnimation))if(existingAnimation.state===RUNNING_STATE)existingAnimation.runner.end();else{if(!existingAnimation.structural)return mergeAnimationDetails(element,existingAnimation,newAnimation),existingAnimation.runner;existingAnimation.close()}else{if(isAllowed("join",element,newAnimation,existingAnimation)){if(existingAnimation.state!==RUNNING_STATE)return applyGeneratedPreparationClasses(element,isStructural?event:null,options),event=newAnimation.event=existingAnimation.event,options=mergeAnimationDetails(element,existingAnimation,newAnimation),existingAnimation.runner;normalizeAnimationDetails(element,newAnimation)}}}else normalizeAnimationDetails(element,newAnimation);var isValidAnimation=newAnimation.structural;if(isValidAnimation||(isValidAnimation="animate"===newAnimation.event&&Object.keys(newAnimation.options.to||{}).length>0||hasAnimationClasses(newAnimation)),!isValidAnimation)return close(),clearElementAnimationState(element),runner;var counter=(existingAnimation.counter||0)+1;return newAnimation.counter=counter,markElementAnimationState(element,PRE_DIGEST_STATE,newAnimation),$rootScope.$$postDigest(function(){var animationDetails=activeAnimationsLookup.get(node),animationCancelled=!animationDetails;animationDetails=animationDetails||{};var parentElement=element.parent()||[],isValidAnimation=parentElement.length>0&&("animate"===animationDetails.event||animationDetails.structural||hasAnimationClasses(animationDetails));if(animationCancelled||animationDetails.counter!==counter||!isValidAnimation)return animationCancelled&&(applyAnimationClasses(element,options),applyAnimationStyles(element,options)),(animationCancelled||isStructural&&animationDetails.event!==event)&&(options.domOperation(),runner.end()),void(isValidAnimation||clearElementAnimationState(element));event=!animationDetails.structural&&hasAnimationClasses(animationDetails,!0)?"setClass":animationDetails.event,markElementAnimationState(element,RUNNING_STATE);var realRunner=$$animation(element,event,animationDetails.options);runner.setHost(realRunner),notifyProgress(runner,event,"start",{}),realRunner.done(function(status){close(!status);var animationDetails=activeAnimationsLookup.get(node);animationDetails&&animationDetails.counter===counter&&clearElementAnimationState(getDomNode(element)),notifyProgress(runner,event,"close",{})})}),runner}function closeChildAnimations(element){var node=getDomNode(element),children=node.querySelectorAll("["+NG_ANIMATE_ATTR_NAME+"]");forEach(children,function(child){var state=parseInt(child.getAttribute(NG_ANIMATE_ATTR_NAME)),animationDetails=activeAnimationsLookup.get(child);if(animationDetails)switch(state){case RUNNING_STATE:animationDetails.runner.end();case PRE_DIGEST_STATE:activeAnimationsLookup.remove(child)}})}function clearElementAnimationState(element){var node=getDomNode(element);node.removeAttribute(NG_ANIMATE_ATTR_NAME),activeAnimationsLookup.remove(node)}function isMatchingElement(nodeOrElmA,nodeOrElmB){return getDomNode(nodeOrElmA)===getDomNode(nodeOrElmB)}function areAnimationsAllowed(element,parentElement,event){var animateChildren,bodyElement=jqLite($document[0].body),bodyElementDetected=isMatchingElement(element,bodyElement)||"HTML"===element[0].nodeName,rootElementDetected=isMatchingElement(element,$rootElement),parentAnimationDetected=!1,elementDisabled=disabledElementsLookup.get(getDomNode(element)),parentHost=jqLite.data(element[0],NG_ANIMATE_PIN_DATA);for(parentHost&&(parentElement=parentHost),parentElement=getDomNode(parentElement);parentElement&&(rootElementDetected||(rootElementDetected=isMatchingElement(parentElement,$rootElement)),parentElement.nodeType===ELEMENT_NODE);){var details=activeAnimationsLookup.get(parentElement)||{};if(!parentAnimationDetected){var parentElementDisabled=disabledElementsLookup.get(parentElement);if(!0===parentElementDisabled&&!1!==elementDisabled){elementDisabled=!0;break}!1===parentElementDisabled&&(elementDisabled=!1),parentAnimationDetected=details.structural}if(isUndefined(animateChildren)||!0===animateChildren){var value=jqLite.data(parentElement,NG_ANIMATE_CHILDREN_DATA);isDefined(value)&&(animateChildren=value)}if(parentAnimationDetected&&!1===animateChildren)break;if(bodyElementDetected||(bodyElementDetected=isMatchingElement(parentElement,bodyElement)),bodyElementDetected&&rootElementDetected)break;parentElement=rootElementDetected||!(parentHost=jqLite.data(parentElement,NG_ANIMATE_PIN_DATA))?parentElement.parentNode:getDomNode(parentHost)}return(!parentAnimationDetected||animateChildren)&&!0!==elementDisabled&&rootElementDetected&&bodyElementDetected}function markElementAnimationState(element,state,details){details=details||{},details.state=state;var node=getDomNode(element);node.setAttribute(NG_ANIMATE_ATTR_NAME,state);var oldValue=activeAnimationsLookup.get(node),newValue=oldValue?extend(oldValue,details):details;activeAnimationsLookup.put(node,newValue)}var activeAnimationsLookup=new $$HashMap,disabledElementsLookup=new $$HashMap,animationsEnabled=null,deregisterWatch=$rootScope.$watch(function(){return 0===$templateRequest.totalPendingRequests},function(isEmpty){isEmpty&&(deregisterWatch(),$rootScope.$$postDigest(function(){$rootScope.$$postDigest(function(){null===animationsEnabled&&(animationsEnabled=!0)})}))}),callbackRegistry={},classNameFilter=$animateProvider.classNameFilter(),isAnimatableClassName=classNameFilter?function(className){return classNameFilter.test(className)}:function(){return!0},applyAnimationClasses=applyAnimationClassesFactory($$jqLite),contains=window.Node.prototype.contains||function(arg){return this===arg||!!(16&this.compareDocumentPosition(arg))},$animate={on:function(event,container,callback){var node=extractElementNode(container);callbackRegistry[event]=callbackRegistry[event]||[],callbackRegistry[event].push({node:node,callback:callback}),jqLite(container).on("$destroy",function(){activeAnimationsLookup.get(node)||$animate.off(event,container,callback)})},off:function(event,container,callback){if(1!==arguments.length||angular.isString(arguments[0])){var entries=callbackRegistry[event];entries&&(callbackRegistry[event]=1===arguments.length?null:filterFromRegistry(entries,container,callback))}else{container=arguments[0];for(var eventType in callbackRegistry)callbackRegistry[eventType]=filterFromRegistry(callbackRegistry[eventType],container)}},pin:function(element,parentElement){assertArg(isElement(element),"element","not an element"),assertArg(isElement(parentElement),"parentElement","not an element"),element.data(NG_ANIMATE_PIN_DATA,parentElement)},push:function(element,event,options,domOperation){return options=options||{},options.domOperation=domOperation,queueAnimation(element,event,options)},enabled:function(element,bool){var argCount=arguments.length;if(0===argCount)bool=!!animationsEnabled;else{if(isElement(element)){var node=getDomNode(element),recordExists=disabledElementsLookup.get(node);1===argCount?bool=!recordExists:disabledElementsLookup.put(node,!bool)}else bool=animationsEnabled=!!element}return bool}};return $animate}]}],$$AnimationProvider=["$animateProvider",function($animateProvider){function setRunner(element,runner){element.data(RUNNER_STORAGE_KEY,runner)}function removeRunner(element){element.removeData(RUNNER_STORAGE_KEY)}function getRunner(element){return element.data(RUNNER_STORAGE_KEY)}var NG_ANIMATE_REF_ATTR="ng-animate-ref",drivers=this.drivers=[],RUNNER_STORAGE_KEY="$$animationRunner";this.$get=["$$jqLite","$rootScope","$injector","$$AnimateRunner","$$HashMap","$$rAFScheduler",function($$jqLite,$rootScope,$injector,$$AnimateRunner,$$HashMap,$$rAFScheduler){function sortAnimations(animations){function processNode(entry){if(entry.processed)return entry;entry.processed=!0;var elementNode=entry.domNode,parentNode=elementNode.parentNode;lookup.put(elementNode,entry);for(var parentEntry;parentNode;){if(parentEntry=lookup.get(parentNode)){parentEntry.processed||(parentEntry=processNode(parentEntry));break}parentNode=parentNode.parentNode}return(parentEntry||tree).children.push(entry),entry}var i,tree={children:[]},lookup=new $$HashMap;for(i=0;i<animations.length;i++){var animation=animations[i];lookup.put(animation.domNode,animations[i]={domNode:animation.domNode,fn:animation.fn,children:[]})}for(i=0;i<animations.length;i++)processNode(animations[i]);return function(tree){var i,result=[],queue=[];for(i=0;i<tree.children.length;i++)queue.push(tree.children[i]);var remainingLevelEntries=queue.length,nextLevelEntries=0,row=[];for(i=0;i<queue.length;i++){var entry=queue[i];remainingLevelEntries<=0&&(remainingLevelEntries=nextLevelEntries,nextLevelEntries=0,result.push(row),row=[]),row.push(entry.fn),entry.children.forEach(function(childEntry){nextLevelEntries++,queue.push(childEntry)}),remainingLevelEntries--}return row.length&&result.push(row),result}(tree)}var animationQueue=[],applyAnimationClasses=applyAnimationClassesFactory($$jqLite);return function(element,event,options){function getAnchorNodes(node){var SELECTOR="["+NG_ANIMATE_REF_ATTR+"]",items=node.hasAttribute(NG_ANIMATE_REF_ATTR)?[node]:node.querySelectorAll(SELECTOR),anchors=[];return forEach(items,function(node){var attr=node.getAttribute(NG_ANIMATE_REF_ATTR);attr&&attr.length&&anchors.push(node)}),anchors}function groupAnimations(animations){var preparedAnimations=[],refLookup={};forEach(animations,function(animation,index){var element=animation.element,node=getDomNode(element),event=animation.event,enterOrMove=["enter","move"].indexOf(event)>=0,anchorNodes=animation.structural?getAnchorNodes(node):[];if(anchorNodes.length){var direction=enterOrMove?"to":"from";forEach(anchorNodes,function(anchor){var key=anchor.getAttribute(NG_ANIMATE_REF_ATTR);refLookup[key]=refLookup[key]||{},refLookup[key][direction]={animationID:index,element:jqLite(anchor)}})}else preparedAnimations.push(animation)});var usedIndicesLookup={},anchorGroups={};return forEach(refLookup,function(operations,key){var from=operations.from,to=operations.to;if(!from||!to){var index=from?from.animationID:to.animationID,indexKey=index.toString();return void(usedIndicesLookup[indexKey]||(usedIndicesLookup[indexKey]=!0,preparedAnimations.push(animations[index])))}var fromAnimation=animations[from.animationID],toAnimation=animations[to.animationID],lookupKey=from.animationID.toString();if(!anchorGroups[lookupKey]){var group=anchorGroups[lookupKey]={structural:!0,beforeStart:function(){fromAnimation.beforeStart(),toAnimation.beforeStart()},close:function(){fromAnimation.close(),toAnimation.close()},classes:cssClassesIntersection(fromAnimation.classes,toAnimation.classes),from:fromAnimation,to:toAnimation,anchors:[]};group.classes.length?preparedAnimations.push(group):(preparedAnimations.push(fromAnimation),preparedAnimations.push(toAnimation))}anchorGroups[lookupKey].anchors.push({out:from.element,in:to.element})}),preparedAnimations}function cssClassesIntersection(a,b){a=a.split(" "),b=b.split(" ");for(var matches=[],i=0;i<a.length;i++){var aa=a[i];if("ng-"!==aa.substring(0,3))for(var j=0;j<b.length;j++)if(aa===b[j]){matches.push(aa);break}}return matches.join(" ")}function invokeFirstDriver(animationDetails){for(var i=drivers.length-1;i>=0;i--){var driverName=drivers[i];if($injector.has(driverName)){var factory=$injector.get(driverName),driver=factory(animationDetails);if(driver)return driver}}}function beforeStart(){element.addClass(NG_ANIMATE_CLASSNAME),tempClasses&&$$jqLite.addClass(element,tempClasses),prepareClassName&&($$jqLite.removeClass(element,prepareClassName),prepareClassName=null)}function updateAnimationRunners(animation,newRunner){function update(element){getRunner(element).setHost(newRunner)}animation.from&&animation.to?(update(animation.from.element),update(animation.to.element)):update(animation.element)}function handleDestroyedElement(){var runner=getRunner(element);!runner||"leave"===event&&options.$$domOperationFired||runner.end()}function close(rejected){element.off("$destroy",handleDestroyedElement),removeRunner(element),applyAnimationClasses(element,options),applyAnimationStyles(element,options),options.domOperation(),tempClasses&&$$jqLite.removeClass(element,tempClasses),element.removeClass(NG_ANIMATE_CLASSNAME),runner.complete(!rejected)}options=prepareAnimationOptions(options);var isStructural=["enter","move","leave"].indexOf(event)>=0,runner=new $$AnimateRunner({end:function(){close()},cancel:function(){close(!0)}});if(!drivers.length)return close(),runner;setRunner(element,runner);var classes=mergeClasses(element.attr("class"),mergeClasses(options.addClass,options.removeClass)),tempClasses=options.tempClasses;tempClasses&&(classes+=" "+tempClasses,options.tempClasses=null);var prepareClassName;return isStructural&&(prepareClassName="ng-"+event+"-prepare",$$jqLite.addClass(element,prepareClassName)),animationQueue.push({element:element,classes:classes,event:event,structural:isStructural,options:options,beforeStart:beforeStart,close:close}),element.on("$destroy",handleDestroyedElement),animationQueue.length>1?runner:($rootScope.$$postDigest(function(){var animations=[];forEach(animationQueue,function(entry){getRunner(entry.element)?animations.push(entry):entry.close()}),animationQueue.length=0;var groupedAnimations=groupAnimations(animations),toBeSortedAnimations=[];forEach(groupedAnimations,function(animationEntry){toBeSortedAnimations.push({domNode:getDomNode(animationEntry.from?animationEntry.from.element:animationEntry.element),fn:function(){animationEntry.beforeStart();var startAnimationFn,closeFn=animationEntry.close;if(getRunner(animationEntry.anchors?animationEntry.from.element||animationEntry.to.element:animationEntry.element)){var operation=invokeFirstDriver(animationEntry);operation&&(startAnimationFn=operation.start)}if(startAnimationFn){var animationRunner=startAnimationFn();animationRunner.done(function(status){closeFn(!status)}),updateAnimationRunners(animationEntry,animationRunner)}else closeFn()}})}),$$rAFScheduler(sortAnimations(toBeSortedAnimations))}),runner)}}]}],ngAnimateSwapDirective=["$animate","$rootScope",function($animate,$rootScope){return{restrict:"A",transclude:"element",terminal:!0,priority:600,link:function(scope,$element,attrs,ctrl,$transclude){var previousElement,previousScope;scope.$watchCollection(attrs.ngAnimateSwap||attrs.for,function(value){previousElement&&$animate.leave(previousElement),previousScope&&(previousScope.$destroy(),previousScope=null),(value||0===value)&&(previousScope=scope.$new(),$transclude(previousScope,function(element){previousElement=element,$animate.enter(element,null,$element)}))})}}}];angular.module("ngAnimate",[]).directive("ngAnimateSwap",ngAnimateSwapDirective).directive("ngAnimateChildren",$$AnimateChildrenDirective).factory("$$rAFScheduler",$$rAFSchedulerFactory).provider("$$animateQueue",$$AnimateQueueProvider).provider("$$animation",$$AnimationProvider).provider("$animateCss",$AnimateCssProvider).provider("$$animateCssDriver",$$AnimateCssDriverProvider).provider("$$animateJs",$$AnimateJsProvider).provider("$$animateJsDriver",$$AnimateJsDriverProvider)}(window,window.angular),function(window,angular){"use strict";function $$CookieWriter($document,$log,$browser){function buildCookieString(name,value,options){var path,expires;options=options||{},expires=options.expires,path=angular.isDefined(options.path)?options.path:cookiePath,angular.isUndefined(value)&&(expires="Thu, 01 Jan 1970 00:00:00 GMT",value=""),angular.isString(expires)&&(expires=new Date(expires));var str=encodeURIComponent(name)+"="+encodeURIComponent(value);str+=path?";path="+path:"",str+=options.domain?";domain="+options.domain:"",str+=expires?";expires="+expires.toUTCString():"",str+=options.secure?";secure":"";var cookieLength=str.length+1;return cookieLength>4096&&$log.warn("Cookie '"+name+"' possibly not set or overflowed because it was too large ("+cookieLength+" > 4096 bytes)!"),str}var cookiePath=$browser.baseHref(),rawDocument=$document[0];return function(name,value,options){rawDocument.cookie=buildCookieString(name,value,options)}}angular.module("ngCookies",["ng"]).provider("$cookies",[function(){function calcOptions(options){return options?angular.extend({},defaults,options):defaults}var defaults=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function($$cookieReader,$$cookieWriter){return{get:function(key){return $$cookieReader()[key]},getObject:function(key){var value=this.get(key);return value?angular.fromJson(value):value},getAll:function(){return $$cookieReader()},put:function(key,value,options){$$cookieWriter(key,value,calcOptions(options))},putObject:function(key,value,options){this.put(key,angular.toJson(value),options)},remove:function(key,options){$$cookieWriter(key,void 0,calcOptions(options))}}}]}]),angular.module("ngCookies").factory("$cookieStore",["$cookies",function($cookies){return{get:function(key){return $cookies.getObject(key)},put:function(key,value){$cookies.putObject(key,value)},remove:function(key){$cookies.remove(key)}}}]),$$CookieWriter.$inject=["$document","$log","$browser"],angular.module("ngCookies").provider("$$cookieWriter",function(){this.$get=$$CookieWriter})}(window,window.angular),function(window,angular){"use strict";function $SanitizeProvider(){var svgEnabled=!1;this.$get=["$$sanitizeUri",function($$sanitizeUri){return svgEnabled&&angular.extend(validElements,svgElements),function(html){var buf=[];return htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe:/.test($$sanitizeUri(uri,isImage))})),buf.join("")}}],this.enableSvg=function(enableSvg){return angular.isDefined(enableSvg)?(svgEnabled=enableSvg,this):svgEnabled}}function sanitizeText(chars){var buf=[];return htmlSanitizeWriter(buf,angular.noop).chars(chars),buf.join("")}function toMap(str,lowercaseKeys){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[lowercaseKeys?angular.lowercase(items[i]):items[i]]=!0;return obj}function htmlParser(html,handler){null===html||void 0===html?html="":"string"!=typeof html&&(html=""+html),inertBodyElement.innerHTML=html;var mXSSAttempts=5;do{if(0===mXSSAttempts)throw $sanitizeMinErr("uinput","Failed to sanitize html because the input is unstable");mXSSAttempts--,window.document.documentMode&&stripCustomNsAttrs(inertBodyElement),html=inertBodyElement.innerHTML,inertBodyElement.innerHTML=html}while(html!==inertBodyElement.innerHTML);for(var node=inertBodyElement.firstChild;node;){switch(node.nodeType){case 1:handler.start(node.nodeName.toLowerCase(),attrToMap(node.attributes));break;case 3:handler.chars(node.textContent)}var nextNode;if(!((nextNode=node.firstChild)||(1==node.nodeType&&handler.end(node.nodeName.toLowerCase()),nextNode=node.nextSibling)))for(;null==nextNode&&(node=node.parentNode)!==inertBodyElement;)nextNode=node.nextSibling,1==node.nodeType&&handler.end(node.nodeName.toLowerCase());node=nextNode}for(;node=inertBodyElement.firstChild;)inertBodyElement.removeChild(node)}function attrToMap(attrs){for(var map={},i=0,ii=attrs.length;i<ii;i++){var attr=attrs[i];map[attr.name]=attr.value}return map}function encodeEntities(value){return value.replace(/&/g,"&amp;").replace(SURROGATE_PAIR_REGEXP,function(value){return"&#"+(1024*(value.charCodeAt(0)-55296)+(value.charCodeAt(1)-56320)+65536)+";"}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlSanitizeWriter(buf,uriValidator){var ignoreCurrentElement=!1,out=angular.bind(buf,buf.push);return{start:function(tag,attrs){tag=angular.lowercase(tag),!ignoreCurrentElement&&blockedElements[tag]&&(ignoreCurrentElement=tag),ignoreCurrentElement||!0!==validElements[tag]||(out("<"),out(tag),angular.forEach(attrs,function(value,key){var lkey=angular.lowercase(key),isImage="img"===tag&&"src"===lkey||"background"===lkey;!0!==validAttrs[lkey]||!0===uriAttrs[lkey]&&!uriValidator(value,isImage)||(out(" "),out(key),out('="'),out(encodeEntities(value)),out('"'))}),out(">"))},end:function(tag){tag=angular.lowercase(tag),ignoreCurrentElement||!0!==validElements[tag]||!0===voidElements[tag]||(out("</"),out(tag),out(">")),tag==ignoreCurrentElement&&(ignoreCurrentElement=!1)},chars:function(chars){ignoreCurrentElement||out(encodeEntities(chars))}}}function stripCustomNsAttrs(node){if(node.nodeType===window.Node.ELEMENT_NODE)for(var attrs=node.attributes,i=0,l=attrs.length;i<l;i++){var attrNode=attrs[i],attrName=attrNode.name.toLowerCase();"xmlns:ns1"!==attrName&&0!==attrName.indexOf("ns1:")||(node.removeAttributeNode(attrNode),i--,l--)}var nextNode=node.firstChild;nextNode&&stripCustomNsAttrs(nextNode),(nextNode=node.nextSibling)&&stripCustomNsAttrs(nextNode)}var inertBodyElement,$sanitizeMinErr=angular.$$minErr("$sanitize"),SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~ |!])/g,voidElements=toMap("area,br,col,hr,img,wbr"),optionalEndTagBlockElements=toMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),optionalEndTagInlineElements=toMap("rp,rt"),optionalEndTagElements=angular.extend({},optionalEndTagInlineElements,optionalEndTagBlockElements),blockElements=angular.extend({},optionalEndTagBlockElements,toMap("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,section,table,ul")),inlineElements=angular.extend({},optionalEndTagInlineElements,toMap("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),svgElements=toMap("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan"),blockedElements=toMap("script,style"),validElements=angular.extend({},voidElements,blockElements,inlineElements,optionalEndTagElements),uriAttrs=toMap("background,cite,href,longdesc,src,xlink:href"),htmlAttrs=toMap("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,valign,value,vspace,width"),svgAttrs=toMap("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",!0),validAttrs=angular.extend({},uriAttrs,svgAttrs,htmlAttrs);!function(window){var doc;if(!window.document||!window.document.implementation)throw $sanitizeMinErr("noinert","Can't create an inert html document");doc=window.document.implementation.createHTMLDocument("inert");var docElement=doc.documentElement||doc.getDocumentElement(),bodyElements=docElement.getElementsByTagName("body");if(1===bodyElements.length)inertBodyElement=bodyElements[0];else{var html=doc.createElement("html");inertBodyElement=doc.createElement("body"),html.appendChild(inertBodyElement),doc.appendChild(html)}}(window),angular.module("ngSanitize",[]).provider("$sanitize",$SanitizeProvider),angular.module("ngSanitize").filter("linky",["$sanitize",function($sanitize){var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,MAILTO_REGEXP=/^mailto:/i,linkyMinErr=angular.$$minErr("linky"),isString=angular.isString;return function(text,target,attributes){function addText(text){text&&html.push(sanitizeText(text))}if(null==text||""===text)return text;if(!isString(text))throw linkyMinErr("notstring","Expected string but received: {0}",text);for(var match,url,i,raw=text,html=[];match=raw.match(LINKY_URL_REGEXP);)url=match[0],match[2]||match[4]||(url=(match[3]?"http://":"mailto:")+url),i=match.index,addText(raw.substr(0,i)),function(url,text){var key;if(html.push("<a "),angular.isFunction(attributes)&&(attributes=attributes(url)),angular.isObject(attributes))for(key in attributes)html.push(key+'="'+attributes[key]+'" ');else attributes={};!angular.isDefined(target)||"target"in attributes||html.push('target="',target,'" '),html.push('href="',url.replace(/"/g,"&quot;"),'">'),addText(text),html.push("</a>")}(url,match[0].replace(MAILTO_REGEXP,"")),raw=raw.substring(i+match[0].length);return addText(raw),$sanitize(html.join(""))}}])}(window,window.angular),angular.module("pusher-angular",[]).factory("$pusher",["$rootScope","$channel","$connection",function($rootScope,$channel,$connection){function PusherAngular(pusherClient){if(!(this instanceof PusherAngular))return new PusherAngular(pusherClient);this._assertValidClient(pusherClient),this.client=pusherClient,this.connection=$connection(pusherClient.connection,pusherClient),this.channels={}}return PusherAngular.prototype={subscribe:function(channelName){var channel=this.client.channel(channelName);return void 0===channel&&(channel=this.client.subscribe(channelName)),channel=$channel(channel,this),this.channels[channelName]=channel,channel},unsubscribe:function(channelName){this.client.channel(channelName)&&(this.client.unsubscribe(channelName),this.channels[channelName]&&delete this.channels[channelName])},bind:function(eventName,callback,context,invokeDigest){var skipDigest=angular.isDefined(invokeDigest)&&!invokeDigest,decoratedCallback=function(data){callback(data),skipDigest||$rootScope.$digest()};return this.client.bind(eventName,decoratedCallback,context),decoratedCallback},bind_all:function(callback,invokeDigest){var skipDigest=angular.isDefined(invokeDigest)&&!invokeDigest;this.client.bind_all(function(eventName,data){callback(eventName,data),skipDigest||$rootScope.$digest()})},unbind:function(eventName,decoratedCallback,context){this.client.unbind(eventName,decoratedCallback,context)},disconnect:function(){this.client.disconnect()},channel:function(channelName){return this.channels[channelName]},allChannels:function(){return this.channels},_assertValidClient:function(pusherClient){if(!angular.isObject(pusherClient)||!angular.isObject(pusherClient.connection)||"function"!=typeof pusherClient.channel)throw new Error("Invalid Pusher client object")}},PusherAngular}]).factory("$channel",["$rootScope","$members",function($rootScope,$members){function checkPresenceOrPrivateChannel(channelName){if(-1==channelName.indexOf("presence-")&&-1==channelName.indexOf("private-"))throw new Error("Presence or private channel required")}function $channel(baseChannel,$pusherClient){if(!(this instanceof $channel))return new $channel(baseChannel,$pusherClient);this._assertValidChannel(baseChannel),this.baseChannel=baseChannel,this.client=$pusherClient,this.name=baseChannel.name,-1==baseChannel.name.indexOf("presence")?this.members=function(){throw new Error("Members object only exists for presence channels")}:this.members=$members(baseChannel.members,baseChannel)}return $channel.prototype={bind:function(eventName,callback,context,invokeDigest){var skipDigest=angular.isDefined(invokeDigest)&&!invokeDigest,decoratedCallback=function(data){callback(data),skipDigest||$rootScope.$digest()};return this.baseChannel.bind(eventName,decoratedCallback,context),decoratedCallback},unbind:function(eventName,decoratedCallback,context){this.baseChannel.unbind(eventName,decoratedCallback,context)},bind_all:function(callback,invokeDigest){var skipDigest=angular.isDefined(invokeDigest)&&!invokeDigest;this.baseChannel.bind_all(function(eventName,data){callback(eventName,data),skipDigest||$rootScope.$digest()})},trigger:function(eventName,obj){if(checkPresenceOrPrivateChannel(this.name),-1==eventName.indexOf("client-"))throw new Error("Event name requires 'client-' prefix");return this.baseChannel.trigger(eventName,obj)},_assertValidChannel:function(baseChannel){if(!angular.isObject(baseChannel)||"string"!=typeof baseChannel.name)throw new Error("Invalid Pusher channel object")}},$channel}]).factory("$members",["$rootScope",function($rootScope){function $members(baseMembers,baseChannel){if(!(this instanceof $members))return new $members(baseMembers,baseChannel);var self=this;this._assertValidMembers(baseMembers),this.baseMembers=baseMembers,this.baseChannel=baseChannel,this.me={},this.count=0,this.members={},baseChannel.bind("pusher:subscription_succeeded",function(members){self.me=members.me,self.count=members.count,self.members=members.members,$rootScope.$digest()}),baseChannel.bind("pusher:member_added",function(member){self.count++,member.info?self.members[member.id.toString()]=member.info:self.members[member.id.toString()]=null,$rootScope.$digest()}),baseChannel.bind("pusher:member_removed",function(member){self.count--,delete self.members[member.id.toString()],$rootScope.$digest()})}return $members.prototype={get:function(id){return this.baseMembers.get(id)},each:function(callback){this.baseMembers.each(function(member){callback(member),$rootScope.$digest()})},_assertValidMembers:function(baseMembers){if(!angular.isObject(baseMembers)||"object"!=typeof baseMembers.me)throw new Error("Invalid Pusher channel members object")}},$members}]).factory("$connection",["$rootScope",function($rootScope){function $connection(baseConnection,baseClient){if(!(this instanceof $connection))return new $connection(baseConnection,baseClient);this._assertValidConnection(baseConnection),this.baseConnection=baseConnection,this.baseClient=baseClient}return $connection.prototype={bind:function(eventName,callback,context,invokeDigest){var skipDigest=angular.isDefined(invokeDigest)&&!invokeDigest;this.baseConnection.bind(eventName,function(data){callback(data),skipDigest||$rootScope.$digest()},context)},bind_all:function(callback,invokeDigest){var skipDigest=angular.isDefined(invokeDigest)&&!invokeDigest;this.baseConnection.bind_all(function(eventName,data){callback(eventName,data),skipDigest||$rootScope.$digest()})},_assertValidConnection:function(baseConnection){if(!angular.isObject(baseConnection))throw new Error("Invalid Pusher connection object")}},$connection}]),function(){"use strict";angular.module("base64",[]).constant("$base64",function(){function getbyte64(s,i){var idx=ALPHA.indexOf(s.charAt(i));if(-1==idx)throw"Cannot decode base64";return idx}function decode(s){s=""+s;var pads,i,b10,imax=s.length;if(0==imax)return s;if(imax%4!=0)throw"Cannot decode base64";pads=0,s.charAt(imax-1)==PADCHAR&&(pads=1,s.charAt(imax-2)==PADCHAR&&(pads=2),imax-=4);var x=[];for(i=0;i<imax;i+=4)b10=getbyte64(s,i)<<18|getbyte64(s,i+1)<<12|getbyte64(s,i+2)<<6|getbyte64(s,i+3),x.push(String.fromCharCode(b10>>16,b10>>8&255,255&b10));switch(pads){case 1:b10=getbyte64(s,i)<<18|getbyte64(s,i+1)<<12|getbyte64(s,i+2)<<6,x.push(String.fromCharCode(b10>>16,b10>>8&255));break;case 2:b10=getbyte64(s,i)<<18|getbyte64(s,i+1)<<12,x.push(String.fromCharCode(b10>>16))}return x.join("")}function getbyte(s,i){var x=s.charCodeAt(i);if(x>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return x}function encode(s){if(1!=arguments.length)throw"SyntaxError: Not enough arguments";var i,b10,x=[];s=""+s;var imax=s.length-s.length%3;if(0==s.length)return s;for(i=0;i<imax;i+=3)b10=getbyte(s,i)<<16|getbyte(s,i+1)<<8|getbyte(s,i+2),x.push(ALPHA.charAt(b10>>18)),x.push(ALPHA.charAt(b10>>12&63)),x.push(ALPHA.charAt(b10>>6&63)),x.push(ALPHA.charAt(63&b10));switch(s.length-imax){case 1:b10=getbyte(s,i)<<16,x.push(ALPHA.charAt(b10>>18)+ALPHA.charAt(b10>>12&63)+PADCHAR+PADCHAR);break;case 2:b10=getbyte(s,i)<<16|getbyte(s,i+1)<<8,x.push(ALPHA.charAt(b10>>18)+ALPHA.charAt(b10>>12&63)+ALPHA.charAt(b10>>6&63)+PADCHAR)}return x.join("")}var PADCHAR="=",ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";return{encode:encode,decode:decode}}())}(),function(){"use strict";angular.module("app.sentry",["app.data"])}(),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.dateparser","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdown","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.transition","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/datepicker/datepicker.html","template/datepicker/day.html","template/datepicker/month.html","template/datepicker/popup.html","template/datepicker/year.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-popup.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/tooltip/tooltip-template-popup.html","template/popover/popover-html.html","template/popover/popover-template.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/timepicker/timepicker.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("ui.bootstrap.collapse",[]).directive("collapse",["$animate",function($animate){return{link:function(scope,element,attrs){function expand(){element.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),$animate.addClass(element,"in",{to:{height:element[0].scrollHeight+"px"}}).then(expandDone)}function expandDone(){element.removeClass("collapsing"),element.css({height:"auto"})}function collapse(){if(!element.hasClass("collapse")&&!element.hasClass("in"))return collapseDone();element.css({height:element[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),$animate.removeClass(element,"in",{to:{height:"0"}}).then(collapseDone)}function collapseDone(){element.css({height:"0"}),element.removeClass("collapsing"),element.addClass("collapse")}scope.$watch(attrs.collapse,function(shouldCollapse){shouldCollapse?collapse():expand()})}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function($scope,$attrs,accordionConfig){this.groups=[],this.closeOthers=function(openGroup){(angular.isDefined($attrs.closeOthers)?$scope.$eval($attrs.closeOthers):accordionConfig.closeOthers)&&angular.forEach(this.groups,function(group){group!==openGroup&&(group.isOpen=!1)})},this.addGroup=function(groupScope){var that=this;this.groups.push(groupScope),groupScope.$on("$destroy",function(event){that.removeGroup(groupScope)})},this.removeGroup=function(group){var index=this.groups.indexOf(group);-1!==index&&this.groups.splice(index,1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",controllerAs:"accordion",transclude:!0,replace:!1,templateUrl:function(element,attrs){return attrs.templateUrl||"template/accordion/accordion.html"}}}).directive("accordionGroup",function(){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:function(element,attrs){return attrs.templateUrl||"template/accordion/accordion-group.html"},scope:{heading:"@",isOpen:"=?",isDisabled:"=?"},controller:function(){this.setHeading=function(element){this.heading=element}},link:function(scope,element,attrs,accordionCtrl){accordionCtrl.addGroup(scope),scope.openClass=attrs.openClass||"panel-open",scope.panelClass=attrs.panelClass,scope.$watch("isOpen",function(value){element.toggleClass(scope.openClass,value),value&&accordionCtrl.closeOthers(scope)}),scope.toggleOpen=function($event){scope.isDisabled||$event&&32!==$event.which||(scope.isOpen=!scope.isOpen)}}}}).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",link:function(scope,element,attr,accordionGroupCtrl,transclude){accordionGroupCtrl.setHeading(transclude(scope,angular.noop))}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(scope,element,attr,controller){scope.$watch(function(){return controller[attr.accordionTransclude]},function(heading){heading&&(element.find("span").html(""),element.find("span").append(heading))})}}}),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function($scope,$attrs){$scope.closeable=!!$attrs.close,this.close=$scope.close}]).directive("alert",function(){return{controller:"AlertController",controllerAs:"alert",templateUrl:function(element,attrs){return attrs.templateUrl||"template/alert/alert.html"},transclude:!0,replace:!0,scope:{type:"@",close:"&"}}}).directive("dismissOnTimeout",["$timeout",function($timeout){return{require:"alert",link:function(scope,element,attrs,alertCtrl){$timeout(function(){alertCtrl.close()},parseInt(attrs.dismissOnTimeout,10))}}}]),angular.module("ui.bootstrap.bindHtml",[]).value("$bindHtmlUnsafeSuppressDeprecated",!1).directive("bindHtmlUnsafe",["$log","$bindHtmlUnsafeSuppressDeprecated",function($log,$bindHtmlUnsafeSuppressDeprecated){return function(scope,element,attr){$bindHtmlUnsafeSuppressDeprecated||$log.warn("bindHtmlUnsafe is now deprecated. Use ngBindHtml instead"),element.addClass("ng-binding").data("$binding",attr.bindHtmlUnsafe),scope.$watch(attr.bindHtmlUnsafe,function(value){element.html(value||"")})}}]),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(buttonConfig){this.activeClass=buttonConfig.activeClass||"active",this.toggleEvent=buttonConfig.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",controllerAs:"buttons",link:function(scope,element,attrs,ctrls){var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];element.find("input").css({display:"none"}),ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,scope.$eval(attrs.btnRadio)))},element.bind(buttonsCtrl.toggleEvent,function(){if(!attrs.disabled){var isActive=element.hasClass(buttonsCtrl.activeClass);isActive&&!angular.isDefined(attrs.uncheckable)||scope.$apply(function(){ngModelCtrl.$setViewValue(isActive?null:scope.$eval(attrs.btnRadio)),ngModelCtrl.$render()})}})}}}).directive("btnCheckbox",["$document",function($document){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",controllerAs:"button",link:function(scope,element,attrs,ctrls){function getTrueValue(){return getCheckboxValue(attrs.btnCheckboxTrue,!0)}function getFalseValue(){return getCheckboxValue(attrs.btnCheckboxFalse,!1)}function getCheckboxValue(attributeValue,defaultValue){var val=scope.$eval(attributeValue);return angular.isDefined(val)?val:defaultValue}var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];element.find("input").css({display:"none"}),ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,getTrueValue()))},element.bind(buttonsCtrl.toggleEvent,function(){attrs.disabled||scope.$apply(function(){ngModelCtrl.$setViewValue(element.hasClass(buttonsCtrl.activeClass)?getFalseValue():getTrueValue()),ngModelCtrl.$render()})}),element.on("keypress",function(e){attrs.disabled||32!==e.which||$document[0].activeElement!==element[0]||scope.$apply(function(){ngModelCtrl.$setViewValue(element.hasClass(buttonsCtrl.activeClass)?getFalseValue():getTrueValue()),ngModelCtrl.$render()})})}}}]),angular.module("ui.bootstrap.carousel",[]).controller("CarouselController",["$scope","$element","$interval","$animate",function($scope,$element,$interval,$animate){function goNext(slide,index,direction){destroyed||(angular.extend(slide,{direction:direction,active:!0}),angular.extend(self.currentSlide||{},{direction:direction,active:!1}),$animate.enabled()&&!$scope.noTransition&&!$scope.$currentTransition&&slide.$element&&self.slides.length>1&&(slide.$element.data(SLIDE_DIRECTION,slide.direction),self.currentSlide&&self.currentSlide.$element&&self.currentSlide.$element.data(SLIDE_DIRECTION,slide.direction),$scope.$currentTransition=!0,NEW_ANIMATE?$animate.on("addClass",slide.$element,function(element,phase){"close"===phase&&($scope.$currentTransition=null,$animate.off("addClass",element))}):slide.$element.one("$animate:close",function(){$scope.$currentTransition=null})),self.currentSlide=slide,currentIndex=index,restartTimer())}function getSlideByIndex(index){if(angular.isUndefined(slides[index].index))return slides[index];var i;slides.length;for(i=0;i<slides.length;++i)if(slides[i].index==index)return slides[i]}function restartTimer(){resetTimer();var interval=+$scope.interval;!isNaN(interval)&&interval>0&&(currentInterval=$interval(timerFn,interval))}function resetTimer(){currentInterval&&($interval.cancel(currentInterval),currentInterval=null)}function timerFn(){var interval=+$scope.interval;isPlaying&&!isNaN(interval)&&interval>0&&slides.length?$scope.next():$scope.pause()}var currentInterval,isPlaying,self=this,slides=self.slides=$scope.slides=[],NEW_ANIMATE=angular.version.minor>=4,SLIDE_DIRECTION="uib-slideDirection",currentIndex=-1;self.currentSlide=null;var destroyed=!1;self.select=$scope.select=function(nextSlide,direction){var nextIndex=$scope.indexOfSlide(nextSlide);void 0===direction&&(direction=nextIndex>self.getCurrentIndex()?"next":"prev"),nextSlide&&nextSlide!==self.currentSlide&&!$scope.$currentTransition&&goNext(nextSlide,nextIndex,direction)},$scope.$on("$destroy",function(){destroyed=!0}),self.getCurrentIndex=function(){return self.currentSlide&&angular.isDefined(self.currentSlide.index)?+self.currentSlide.index:currentIndex},$scope.indexOfSlide=function(slide){return angular.isDefined(slide.index)?+slide.index:slides.indexOf(slide)},$scope.next=function(){var newIndex=(self.getCurrentIndex()+1)%slides.length;return 0===newIndex&&$scope.noWrap()?void $scope.pause():self.select(getSlideByIndex(newIndex),"next")},$scope.prev=function(){var newIndex=self.getCurrentIndex()-1<0?slides.length-1:self.getCurrentIndex()-1;return $scope.noWrap()&&newIndex===slides.length-1?void $scope.pause():self.select(getSlideByIndex(newIndex),"prev")},$scope.isActive=function(slide){return self.currentSlide===slide},$scope.$watch("interval",restartTimer),$scope.$on("$destroy",resetTimer),$scope.play=function(){isPlaying||(isPlaying=!0,restartTimer())},$scope.pause=function(){$scope.noPause||(isPlaying=!1,resetTimer())},self.addSlide=function(slide,element){slide.$element=element,slides.push(slide),1===slides.length||slide.active?(self.select(slides[slides.length-1]),1==slides.length&&$scope.play()):slide.active=!1},self.removeSlide=function(slide){angular.isDefined(slide.index)&&slides.sort(function(a,b){return+a.index>+b.index});var index=slides.indexOf(slide);slides.splice(index,1),slides.length>0&&slide.active?index>=slides.length?self.select(slides[index-1]):self.select(slides[index]):currentIndex>index&&currentIndex--,0===slides.length&&(self.currentSlide=null)},$scope.$watch("noTransition",function(noTransition){$element.data("uib-noTransition",noTransition)})}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",controllerAs:"carousel",require:"carousel",templateUrl:function(element,attrs){return attrs.templateUrl||"template/carousel/carousel.html"},scope:{interval:"=",noTransition:"=",noPause:"=",noWrap:"&"}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:function(element,attrs){return attrs.templateUrl||"template/carousel/slide.html"},scope:{active:"=?",actual:"=?",index:"=?"},link:function(scope,element,attrs,carouselCtrl){carouselCtrl.addSlide(scope,element),scope.$on("$destroy",function(){carouselCtrl.removeSlide(scope)}),scope.$watch("active",function(active){active&&carouselCtrl.select(scope)})}}}).animation(".item",["$injector","$animate",function($injector,$animate){function removeClass(element,className,callback){element.removeClass(className),callback&&callback()}var $animateCss=null;return $injector.has("$animateCss")&&($animateCss=$injector.get("$animateCss")),{beforeAddClass:function(element,className,done){if("active"==className&&element.parent()&&!element.parent().data("uib-noTransition")){var stopped=!1,direction=element.data("uib-slideDirection"),directionClass="next"==direction?"left":"right",removeClassFn=removeClass.bind(this,element,directionClass+" "+direction,done);return element.addClass(direction),$animateCss?$animateCss(element,{addClass:directionClass}).start().done(removeClassFn):$animate.addClass(element,directionClass).then(function(){stopped||removeClassFn(),done()}),function(){stopped=!0}}done()},beforeRemoveClass:function(element,className,done){if("active"===className&&element.parent()&&!element.parent().data("uib-noTransition")){var stopped=!1,direction=element.data("uib-slideDirection"),directionClass="next"==direction?"left":"right",removeClassFn=removeClass.bind(this,element,directionClass,done);return $animateCss?$animateCss(element,{addClass:directionClass}).start().done(removeClassFn):$animate.addClass(element,directionClass).then(function(){stopped||removeClassFn(),done()}),function(){stopped=!0}}done()}}}]),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$log","$locale","orderByFilter",function($log,$locale,orderByFilter){function createParser(format){var map=[],regex=format.split("");return angular.forEach(formatCodeToRegex,function(data,code){var index=format.indexOf(code);if(index>-1){format=format.split(""),regex[index]="("+data.regex+")",format[index]="$";for(var i=index+1,n=index+code.length;i<n;i++)regex[i]="",format[i]="$";format=format.join(""),map.push({index:index,apply:data.apply})}}),{regex:new RegExp("^"+regex.join("")+"$"),map:orderByFilter(map,"index")}}function isValid(year,month,date){return!(date<1)&&(1===month&&date>28?29===date&&(year%4==0&&year%100!=0||year%400==0):3!==month&&5!==month&&8!==month&&10!==month||date<31)}var SPECIAL_CHARACTERS_REGEXP=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;this.parsers={};var formatCodeToRegex={yyyy:{regex:"\\d{4}",apply:function(value){this.year=+value}},yy:{regex:"\\d{2}",apply:function(value){this.year=+value+2e3}},y:{regex:"\\d{1,4}",apply:function(value){this.year=+value}},MMMM:{regex:$locale.DATETIME_FORMATS.MONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.MONTH.indexOf(value)}},MMM:{regex:$locale.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.SHORTMONTH.indexOf(value)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(value){this.month=value-1}},M:{regex:"[1-9]|1[0-2]",apply:function(value){this.month=value-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},EEEE:{regex:$locale.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:$locale.DATETIME_FORMATS.SHORTDAY.join("|")},HH:{regex:"(?:0|1)[0-9]|2[0-3]",apply:function(value){this.hours=+value}},hh:{regex:"0[0-9]|1[0-2]",apply:function(value){this.hours=+value}},H:{regex:"1?[0-9]|2[0-3]",apply:function(value){this.hours=+value}},h:{regex:"[0-9]|1[0-2]",apply:function(value){this.hours=+value}},mm:{regex:"[0-5][0-9]",apply:function(value){this.minutes=+value}},m:{regex:"[0-9]|[1-5][0-9]",apply:function(value){this.minutes=+value}},sss:{regex:"[0-9][0-9][0-9]",apply:function(value){this.milliseconds=+value}},ss:{regex:"[0-5][0-9]",apply:function(value){this.seconds=+value}},s:{regex:"[0-9]|[1-5][0-9]",apply:function(value){this.seconds=+value}},a:{regex:$locale.DATETIME_FORMATS.AMPMS.join("|"),apply:function(value){12===this.hours&&(this.hours=0),"PM"===value&&(this.hours+=12)}}};this.parse=function(input,format,baseDate){if(!angular.isString(input)||!format)return input;format=$locale.DATETIME_FORMATS[format]||format,format=format.replace(SPECIAL_CHARACTERS_REGEXP,"\\$&"),this.parsers[format]||(this.parsers[format]=createParser(format));var parser=this.parsers[format],regex=parser.regex,map=parser.map,results=input.match(regex);if(results&&results.length){var fields,dt;angular.isDate(baseDate)&&!isNaN(baseDate.getTime())?fields={year:baseDate.getFullYear(),month:baseDate.getMonth(),date:baseDate.getDate(),hours:baseDate.getHours(),minutes:baseDate.getMinutes(),seconds:baseDate.getSeconds(),milliseconds:baseDate.getMilliseconds()}:(baseDate&&$log.warn("dateparser:","baseDate is not a valid date"),fields={year:1900,month:0,date:1,hours:0,minutes:0,seconds:0,milliseconds:0});for(var i=1,n=results.length;i<n;i++){var mapper=map[i-1];mapper.apply&&mapper.apply.call(fields,results[i])}return isValid(fields.year,fields.month,fields.date)&&(dt=new Date(fields.year,fields.month,fields.date,fields.hours,fields.minutes,fields.seconds,fields.milliseconds||0)),dt}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).value("$datepickerSuppressError",!1).constant("datepickerConfig",{formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null,shortcutPropagation:!1}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$log","dateFilter","datepickerConfig","$datepickerSuppressError",function($scope,$attrs,$parse,$interpolate,$log,dateFilter,datepickerConfig,$datepickerSuppressError){var self=this,ngModelCtrl={$setViewValue:angular.noop};this.modes=["day","month","year"],angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","showWeeks","startingDay","yearRange","shortcutPropagation"],function(key,index){self[key]=angular.isDefined($attrs[key])?index<6?$interpolate($attrs[key])($scope.$parent):$scope.$parent.$eval($attrs[key]):datepickerConfig[key]}),angular.forEach(["minDate","maxDate"],function(key){$attrs[key]?$scope.$parent.$watch($parse($attrs[key]),function(value){self[key]=value?new Date(value):null,self.refreshView()}):self[key]=datepickerConfig[key]?new Date(datepickerConfig[key]):null}),angular.forEach(["minMode","maxMode"],function(key){$attrs[key]?$scope.$parent.$watch($parse($attrs[key]),function(value){self[key]=angular.isDefined(value)?value:$attrs[key],$scope[key]=self[key],("minMode"==key&&self.modes.indexOf($scope.datepickerMode)<self.modes.indexOf(self[key])||"maxMode"==key&&self.modes.indexOf($scope.datepickerMode)>self.modes.indexOf(self[key]))&&($scope.datepickerMode=self[key])}):(self[key]=datepickerConfig[key]||null,$scope[key]=self[key])}),$scope.datepickerMode=$scope.datepickerMode||datepickerConfig.datepickerMode,$scope.uniqueId="datepicker-"+$scope.$id+"-"+Math.floor(1e4*Math.random()),angular.isDefined($attrs.initDate)?(this.activeDate=$scope.$parent.$eval($attrs.initDate)||new Date,$scope.$parent.$watch($attrs.initDate,function(initDate){initDate&&(ngModelCtrl.$isEmpty(ngModelCtrl.$modelValue)||ngModelCtrl.$invalid)&&(self.activeDate=initDate,self.refreshView())})):this.activeDate=new Date,$scope.isActive=function(dateObject){return 0===self.compare(dateObject.date,self.activeDate)&&($scope.activeDateId=dateObject.uid,!0)},this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=function(){self.render()}},this.render=function(){if(ngModelCtrl.$viewValue){var date=new Date(ngModelCtrl.$viewValue);!isNaN(date)?this.activeDate=date:$datepickerSuppressError||$log.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var date=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):null;ngModelCtrl.$setValidity("dateDisabled",!date||this.element&&!this.isDisabled(date))}},this.createDateObject=function(date,format){var model=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):null;return{date:date,label:dateFilter(date,format),selected:model&&0===this.compare(date,model),disabled:this.isDisabled(date),current:0===this.compare(date,new Date),customClass:this.customClass(date)}},this.isDisabled=function(date){return this.minDate&&this.compare(date,this.minDate)<0||this.maxDate&&this.compare(date,this.maxDate)>0||$attrs.dateDisabled&&$scope.dateDisabled({date:date,mode:$scope.datepickerMode})},this.customClass=function(date){return $scope.customClass({date:date,mode:$scope.datepickerMode})},this.split=function(arr,size){for(var arrays=[];arr.length>0;)arrays.push(arr.splice(0,size));return arrays},this.fixTimeZone=function(date){var hours=date.getHours();date.setHours(23===hours?hours+2:0)},$scope.select=function(date){if($scope.datepickerMode===self.minMode){var dt=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):new Date(0,0,0,0,0,0,0);dt.setFullYear(date.getFullYear(),date.getMonth(),date.getDate()),ngModelCtrl.$setViewValue(dt),ngModelCtrl.$render()}else self.activeDate=date,$scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)-1]},$scope.move=function(direction){var year=self.activeDate.getFullYear()+direction*(self.step.years||0),month=self.activeDate.getMonth()+direction*(self.step.months||0);self.activeDate.setFullYear(year,month,1),self.refreshView()},$scope.toggleMode=function(direction){direction=direction||1,$scope.datepickerMode===self.maxMode&&1===direction||$scope.datepickerMode===self.minMode&&-1===direction||($scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)+direction])},$scope.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var focusElement=function(){self.element[0].focus()};$scope.$on("datepicker.focus",focusElement),$scope.keydown=function(evt){var key=$scope.keys[evt.which];if(key&&!evt.shiftKey&&!evt.altKey)if(evt.preventDefault(),self.shortcutPropagation||evt.stopPropagation(),"enter"===key||"space"===key){if(self.isDisabled(self.activeDate))return;$scope.select(self.activeDate),focusElement()}else!evt.ctrlKey||"up"!==key&&"down"!==key?(self.handleKeyDown(key,evt),self.refreshView()):($scope.toggleMode("up"===key?1:-1),focusElement())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return attrs.templateUrl||"template/datepicker/datepicker.html"},scope:{datepickerMode:"=?",dateDisabled:"&",customClass:"&",shortcutPropagation:"&?"},require:["datepicker","^ngModel"],controller:"DatepickerController",controllerAs:"datepicker",link:function(scope,element,attrs,ctrls){var datepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];datepickerCtrl.init(ngModelCtrl)}}}).directive("daypicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/day.html",require:"^datepicker",link:function(scope,element,attrs,ctrl){function getDaysInMonth(year,month){return 1!==month||year%4!=0||year%100==0&&year%400!=0?DAYS_IN_MONTH[month]:29}function getDates(startDate,n){for(var date,dates=new Array(n),current=new Date(startDate),i=0;i<n;)date=new Date(current),ctrl.fixTimeZone(date),dates[i++]=date,current.setDate(current.getDate()+1);return dates}function getISO8601WeekNumber(date){var checkDate=new Date(date);checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();return checkDate.setMonth(0),checkDate.setDate(1),Math.floor(Math.round((time-checkDate)/864e5)/7)+1}scope.showWeeks=ctrl.showWeeks,ctrl.step={months:1},ctrl.element=element;var DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];ctrl._refreshView=function(){var year=ctrl.activeDate.getFullYear(),month=ctrl.activeDate.getMonth(),firstDayOfMonth=new Date(year,month,1),difference=ctrl.startingDay-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,firstDate=new Date(firstDayOfMonth);numDisplayedFromPreviousMonth>0&&firstDate.setDate(1-numDisplayedFromPreviousMonth);for(var days=getDates(firstDate,42),i=0;i<42;i++)days[i]=angular.extend(ctrl.createDateObject(days[i],ctrl.formatDay),{secondary:days[i].getMonth()!==month,uid:scope.uniqueId+"-"+i});scope.labels=new Array(7);for(var j=0;j<7;j++)scope.labels[j]={abbr:dateFilter(days[j].date,ctrl.formatDayHeader),full:dateFilter(days[j].date,"EEEE")};if(scope.title=dateFilter(ctrl.activeDate,ctrl.formatDayTitle),scope.rows=ctrl.split(days,7),scope.showWeeks){scope.weekNumbers=[];for(var thursdayIndex=(11-ctrl.startingDay)%7,numWeeks=scope.rows.length,curWeek=0;curWeek<numWeeks;curWeek++)scope.weekNumbers.push(getISO8601WeekNumber(scope.rows[curWeek][thursdayIndex].date))}},ctrl.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate())},ctrl.handleKeyDown=function(key,evt){var date=ctrl.activeDate.getDate();if("left"===key)date-=1;else if("up"===key)date-=7;else if("right"===key)date+=1;else if("down"===key)date+=7;else if("pageup"===key||"pagedown"===key){var month=ctrl.activeDate.getMonth()+("pageup"===key?-1:1);ctrl.activeDate.setMonth(month,1),date=Math.min(getDaysInMonth(ctrl.activeDate.getFullYear(),ctrl.activeDate.getMonth()),date)}else"home"===key?date=1:"end"===key&&(date=getDaysInMonth(ctrl.activeDate.getFullYear(),ctrl.activeDate.getMonth()));ctrl.activeDate.setDate(date)},ctrl.refreshView()}}}]).directive("monthpicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/month.html",require:"^datepicker",link:function(scope,element,attrs,ctrl){ctrl.step={years:1},ctrl.element=element,ctrl._refreshView=function(){for(var date,months=new Array(12),year=ctrl.activeDate.getFullYear(),i=0;i<12;i++)date=new Date(year,i,1),ctrl.fixTimeZone(date),months[i]=angular.extend(ctrl.createDateObject(date,ctrl.formatMonth),{uid:scope.uniqueId+"-"+i});scope.title=dateFilter(ctrl.activeDate,ctrl.formatMonthTitle),scope.rows=ctrl.split(months,3)},ctrl.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth())-new Date(date2.getFullYear(),date2.getMonth())},ctrl.handleKeyDown=function(key,evt){var date=ctrl.activeDate.getMonth();if("left"===key)date-=1;else if("up"===key)date-=3;else if("right"===key)date+=1;else if("down"===key)date+=3;else if("pageup"===key||"pagedown"===key){var year=ctrl.activeDate.getFullYear()+("pageup"===key?-1:1);ctrl.activeDate.setFullYear(year)}else"home"===key?date=0:"end"===key&&(date=11);ctrl.activeDate.setMonth(date)},ctrl.refreshView()}}}]).directive("yearpicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/year.html",require:"^datepicker",link:function(scope,element,attrs,ctrl){function getStartingYear(year){return parseInt((year-1)/range,10)*range+1}var range=ctrl.yearRange;ctrl.step={years:range},ctrl.element=element,ctrl._refreshView=function(){for(var date,years=new Array(range),i=0,start=getStartingYear(ctrl.activeDate.getFullYear());i<range;i++)date=new Date(start+i,0,1),ctrl.fixTimeZone(date),years[i]=angular.extend(ctrl.createDateObject(date,ctrl.formatYear),{uid:scope.uniqueId+"-"+i});scope.title=[years[0].label,years[range-1].label].join(" - "),scope.rows=ctrl.split(years,5)},ctrl.compare=function(date1,date2){return date1.getFullYear()-date2.getFullYear()},ctrl.handleKeyDown=function(key,evt){var date=ctrl.activeDate.getFullYear();"left"===key?date-=1:"up"===key?date-=5:"right"===key?date+=1:"down"===key?date+=5:"pageup"===key||"pagedown"===key?date+=("pageup"===key?-1:1)*ctrl.step.years:"home"===key?date=getStartingYear(ctrl.activeDate.getFullYear()):"end"===key&&(date=getStartingYear(ctrl.activeDate.getFullYear())+range-1),ctrl.activeDate.setFullYear(date)},ctrl.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",datepickerPopupTemplateUrl:"template/datepicker/popup.html",datepickerTemplateUrl:"template/datepicker/datepicker.html",html5Types:{date:"yyyy-MM-dd","datetime-local":"yyyy-MM-ddTHH:mm:ss.sss",month:"yyyy-MM"},currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0,onOpenFocus:!0}).directive("datepickerPopup",["$compile","$parse","$document","$rootScope","$position","dateFilter","dateParser","datepickerPopupConfig","$timeout",function($compile,$parse,$document,$rootScope,$position,dateFilter,dateParser,datepickerPopupConfig,$timeout){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&",customClass:"&"},link:function(scope,element,attrs,ngModel){function cameltoDash(string){return string.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})}function parseDate(viewValue){angular.isNumber(viewValue)&&(viewValue=new Date(viewValue));{if(!viewValue)return null;if(angular.isDate(viewValue)&&!isNaN(viewValue))return viewValue;if(angular.isString(viewValue)){var date=dateParser.parse(viewValue,dateFormat,scope.date);return isNaN(date)?void 0:date}}}function validator(modelValue,viewValue){var value=modelValue||viewValue;if(!attrs.ngRequired&&!value)return!0;if(angular.isNumber(value)&&(value=new Date(value)),value){if(angular.isDate(value)&&!isNaN(value))return!0;if(angular.isString(value)){var date=dateParser.parse(value,dateFormat);return!isNaN(date)}return!1}return!0}var dateFormat,closeOnDateSelection=angular.isDefined(attrs.closeOnDateSelection)?scope.$parent.$eval(attrs.closeOnDateSelection):datepickerPopupConfig.closeOnDateSelection,appendToBody=angular.isDefined(attrs.datepickerAppendToBody)?scope.$parent.$eval(attrs.datepickerAppendToBody):datepickerPopupConfig.appendToBody,onOpenFocus=angular.isDefined(attrs.onOpenFocus)?scope.$parent.$eval(attrs.onOpenFocus):datepickerPopupConfig.onOpenFocus,datepickerPopupTemplateUrl=angular.isDefined(attrs.datepickerPopupTemplateUrl)?attrs.datepickerPopupTemplateUrl:datepickerPopupConfig.datepickerPopupTemplateUrl,datepickerTemplateUrl=angular.isDefined(attrs.datepickerTemplateUrl)?attrs.datepickerTemplateUrl:datepickerPopupConfig.datepickerTemplateUrl,cache={};scope.showButtonBar=angular.isDefined(attrs.showButtonBar)?scope.$parent.$eval(attrs.showButtonBar):datepickerPopupConfig.showButtonBar,scope.getText=function(key){return scope[key+"Text"]||datepickerPopupConfig[key+"Text"]},scope.isDisabled=function(date){return"today"===date&&(date=new Date),scope.watchData.minDate&&scope.compare(date,cache.minDate)<0||scope.watchData.maxDate&&scope.compare(date,cache.maxDate)>0},scope.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate())};var isHtml5DateInput=!1;if(datepickerPopupConfig.html5Types[attrs.type]?(dateFormat=datepickerPopupConfig.html5Types[attrs.type],isHtml5DateInput=!0):(dateFormat=attrs.datepickerPopup||datepickerPopupConfig.datepickerPopup,attrs.$observe("datepickerPopup",function(value,oldValue){var newDateFormat=value||datepickerPopupConfig.datepickerPopup;if(newDateFormat!==dateFormat&&(dateFormat=newDateFormat,ngModel.$modelValue=null,!dateFormat))throw new Error("datepickerPopup must have a date format specified.")})),!dateFormat)throw new Error("datepickerPopup must have a date format specified.");if(isHtml5DateInput&&attrs.datepickerPopup)throw new Error("HTML5 date input types do not support custom formats.");var popupEl=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");popupEl.attr({"ng-model":"date","ng-change":"dateSelection(date)","template-url":datepickerPopupTemplateUrl});var datepickerEl=angular.element(popupEl.children()[0]);if(datepickerEl.attr("template-url",datepickerTemplateUrl),isHtml5DateInput&&"month"===attrs.type&&(datepickerEl.attr("datepicker-mode",'"month"'),datepickerEl.attr("min-mode","month")),attrs.datepickerOptions){var options=scope.$parent.$eval(attrs.datepickerOptions);options&&options.initDate&&(scope.initDate=options.initDate,datepickerEl.attr("init-date","initDate"),delete options.initDate),angular.forEach(options,function(value,option){datepickerEl.attr(cameltoDash(option),value)})}scope.watchData={},angular.forEach(["minMode","maxMode","minDate","maxDate","datepickerMode","initDate","shortcutPropagation"],function(key){if(attrs[key]){var getAttribute=$parse(attrs[key]);if(scope.$parent.$watch(getAttribute,function(value){scope.watchData[key]=value,"minDate"!==key&&"maxDate"!==key||(cache[key]=new Date(value))}),datepickerEl.attr(cameltoDash(key),"watchData."+key),"datepickerMode"===key){var setAttribute=getAttribute.assign;scope.$watch("watchData."+key,function(value,oldvalue){angular.isFunction(setAttribute)&&value!==oldvalue&&setAttribute(scope.$parent,value)})}}}),attrs.dateDisabled&&datepickerEl.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),attrs.showWeeks&&datepickerEl.attr("show-weeks",attrs.showWeeks),attrs.customClass&&datepickerEl.attr("custom-class","customClass({ date: date, mode: mode })"),isHtml5DateInput?ngModel.$formatters.push(function(value){return scope.date=value,value}):(ngModel.$$parserName="date",ngModel.$validators.date=validator,ngModel.$parsers.unshift(parseDate),ngModel.$formatters.push(function(value){return scope.date=value,ngModel.$isEmpty(value)?value:dateFilter(value,dateFormat)})),scope.dateSelection=function(dt){angular.isDefined(dt)&&(scope.date=dt);var date=scope.date?dateFilter(scope.date,dateFormat):null;element.val(date),ngModel.$setViewValue(date),closeOnDateSelection&&(scope.isOpen=!1,element[0].focus())},ngModel.$viewChangeListeners.push(function(){scope.date=dateParser.parse(ngModel.$viewValue,dateFormat,scope.date)});var documentClickBind=function(event){!scope.isOpen||element[0].contains(event.target)||popupEl[0].contains(event.target)||scope.$apply(function(){scope.isOpen=!1})},inputKeydownBind=function(evt){27===evt.which&&scope.isOpen?(evt.preventDefault(),evt.stopPropagation(),scope.$apply(function(){scope.isOpen=!1}),element[0].focus()):40!==evt.which||scope.isOpen||(evt.preventDefault(),evt.stopPropagation(),scope.$apply(function(){scope.isOpen=!0}))};element.bind("keydown",inputKeydownBind),scope.keydown=function(evt){27===evt.which&&(scope.isOpen=!1,element[0].focus())},scope.$watch("isOpen",function(value){value?(scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top=scope.position.top+element.prop("offsetHeight"),$timeout(function(){onOpenFocus&&scope.$broadcast("datepicker.focus"),$document.bind("click",documentClickBind)},0,!1)):$document.unbind("click",documentClickBind)}),scope.select=function(date){if("today"===date){var today=new Date;angular.isDate(scope.date)?(date=new Date(scope.date),date.setFullYear(today.getFullYear(),today.getMonth(),today.getDate())):date=new Date(today.setHours(0,0,0,0))}scope.dateSelection(date)},scope.close=function(){scope.isOpen=!1,element[0].focus()};var $popup=$compile(popupEl)(scope);popupEl.remove(),appendToBody?$document.find("body").append($popup):element.after($popup),scope.$on("$destroy",function(){!0===scope.isOpen&&($rootScope.$$phase||scope.$apply(function(){scope.isOpen=!1})),$popup.remove(),element.unbind("keydown",inputKeydownBind),$document.unbind("click",documentClickBind)})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:function(element,attrs){return attrs.templateUrl||"template/datepicker/popup.html"}}}),angular.module("ui.bootstrap.dropdown",["ui.bootstrap.position"]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$rootScope",function($document,$rootScope){var openScope=null;this.open=function(dropdownScope){openScope||($document.bind("click",closeDropdown),$document.bind("keydown",keybindFilter)),openScope&&openScope!==dropdownScope&&(openScope.isOpen=!1),openScope=dropdownScope},this.close=function(dropdownScope){openScope===dropdownScope&&(openScope=null,$document.unbind("click",closeDropdown),$document.unbind("keydown",keybindFilter))};var closeDropdown=function(evt){if(openScope&&(!evt||"disabled"!==openScope.getAutoClose())){var toggleElement=openScope.getToggleElement();if(!(evt&&toggleElement&&toggleElement[0].contains(evt.target))){var dropdownElement=openScope.getDropdownElement();evt&&"outsideClick"===openScope.getAutoClose()&&dropdownElement&&dropdownElement[0].contains(evt.target)||(openScope.isOpen=!1,$rootScope.$$phase||openScope.$apply())}}},keybindFilter=function(evt){27===evt.which?(openScope.focusToggleElement(),closeDropdown()):openScope.isKeynavEnabled()&&/(38|40)/.test(evt.which)&&openScope.isOpen&&(evt.preventDefault(),evt.stopPropagation(),openScope.focusDropdownEntry(evt.which))}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate","$position","$document","$compile","$templateRequest",function($scope,$attrs,$parse,dropdownConfig,dropdownService,$animate,$position,$document,$compile,$templateRequest){var templateScope,getIsOpen,self=this,scope=$scope.$new(),openClass=dropdownConfig.openClass,setIsOpen=angular.noop,toggleInvoker=$attrs.onToggle?$parse($attrs.onToggle):angular.noop,appendToBody=!1,keynavEnabled=!1,body=$document.find("body");this.init=function(element){self.$element=element,$attrs.isOpen&&(getIsOpen=$parse($attrs.isOpen),setIsOpen=getIsOpen.assign,$scope.$watch(getIsOpen,function(value){scope.isOpen=!!value})),appendToBody=angular.isDefined($attrs.dropdownAppendToBody),keynavEnabled=angular.isDefined($attrs.keyboardNav),appendToBody&&self.dropdownMenu&&(body.append(self.dropdownMenu),body.addClass("dropdown"),element.on("$destroy",function(){self.dropdownMenu.remove()}))},this.toggle=function(open){return scope.isOpen=arguments.length?!!open:!scope.isOpen},this.isOpen=function(){return scope.isOpen},scope.getToggleElement=function(){return self.toggleElement},scope.getAutoClose=function(){return $attrs.autoClose||"always"},scope.getElement=function(){return self.$element},scope.isKeynavEnabled=function(){return keynavEnabled},scope.focusDropdownEntry=function(keyCode){var elems=self.dropdownMenu?angular.element(self.dropdownMenu).find("a"):angular.element(self.$element).find("ul").eq(0).find("a");switch(keyCode){case 40:angular.isNumber(self.selectedOption)?self.selectedOption=self.selectedOption===elems.length-1?self.selectedOption:self.selectedOption+1:self.selectedOption=0;break;case 38:angular.isNumber(self.selectedOption)?self.selectedOption=0===self.selectedOption?0:self.selectedOption-1:self.selectedOption=elems.length-1}elems[self.selectedOption].focus()},scope.getDropdownElement=function(){return self.dropdownMenu},scope.focusToggleElement=function(){self.toggleElement&&self.toggleElement[0].focus()},scope.$watch("isOpen",function(isOpen,wasOpen){if(appendToBody&&self.dropdownMenu){var pos=$position.positionElements(self.$element,self.dropdownMenu,"bottom-left",!0),css={top:pos.top+"px",display:isOpen?"block":"none"};self.dropdownMenu.hasClass("dropdown-menu-right")?(css.left="auto",css.right=window.innerWidth-(pos.left+self.$element.prop("offsetWidth"))+"px"):(css.left=pos.left+"px",css.right="auto"),self.dropdownMenu.css(css)}var openContainer=appendToBody?body:self.$element;if($animate[isOpen?"addClass":"removeClass"](openContainer,openClass).then(function(){angular.isDefined(isOpen)&&isOpen!==wasOpen&&toggleInvoker($scope,{open:!!isOpen})}),isOpen)self.dropdownMenuTemplateUrl&&$templateRequest(self.dropdownMenuTemplateUrl).then(function(tplContent){templateScope=scope.$new(),$compile(tplContent.trim())(templateScope,function(dropdownElement){var newEl=dropdownElement;self.dropdownMenu.replaceWith(newEl),self.dropdownMenu=newEl})}),scope.focusToggleElement(),dropdownService.open(scope);else{if(self.dropdownMenuTemplateUrl){templateScope&&templateScope.$destroy();var newEl=angular.element('<ul class="dropdown-menu"></ul>');self.dropdownMenu.replaceWith(newEl),self.dropdownMenu=newEl}dropdownService.close(scope),self.selectedOption=null}angular.isFunction(setIsOpen)&&setIsOpen($scope,isOpen)}),$scope.$on("$locationChangeSuccess",function(){"disabled"!==scope.getAutoClose()&&(scope.isOpen=!1)});var offDestroy=$scope.$on("$destroy",function(){scope.$destroy()});scope.$on("$destroy",offDestroy)}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(scope,element,attrs,dropdownCtrl){dropdownCtrl.init(element),element.addClass("dropdown")}}}).directive("dropdownMenu",function(){return{restrict:"AC",require:"?^dropdown",link:function(scope,element,attrs,dropdownCtrl){if(dropdownCtrl){var tplUrl=attrs.templateUrl;tplUrl&&(dropdownCtrl.dropdownMenuTemplateUrl=tplUrl),dropdownCtrl.dropdownMenu||(dropdownCtrl.dropdownMenu=element)}}}}).directive("keyboardNav",function(){return{restrict:"A",require:"?^dropdown",link:function(scope,element,attrs,dropdownCtrl){element.bind("keydown",function(e){if(-1!==[38,40].indexOf(e.which)){e.preventDefault(),e.stopPropagation();var elems=dropdownCtrl.dropdownMenu.find("a");switch(e.which){case 40:angular.isNumber(dropdownCtrl.selectedOption)?dropdownCtrl.selectedOption=dropdownCtrl.selectedOption===elems.length-1?dropdownCtrl.selectedOption:dropdownCtrl.selectedOption+1:dropdownCtrl.selectedOption=0;break;case 38:angular.isNumber(dropdownCtrl.selectedOption)?dropdownCtrl.selectedOption=0===dropdownCtrl.selectedOption?0:dropdownCtrl.selectedOption-1:dropdownCtrl.selectedOption=elems.length-1}elems[dropdownCtrl.selectedOption].focus()}})}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(scope,element,attrs,dropdownCtrl){if(dropdownCtrl){element.addClass("dropdown-toggle"),dropdownCtrl.toggleElement=element;var toggleDropdown=function(event){event.preventDefault(),element.hasClass("disabled")||attrs.disabled||scope.$apply(function(){dropdownCtrl.toggle()})};element.bind("click",toggleDropdown),element.attr({"aria-haspopup":!0,"aria-expanded":!1}),scope.$watch(dropdownCtrl.isOpen,function(isOpen){element.attr("aria-expanded",!!isOpen)}),scope.$on("$destroy",function(){element.unbind("click",toggleDropdown)})}}}}),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var stack=[];return{add:function(key,value){stack.push({key:key,value:value})},get:function(key){for(var i=0;i<stack.length;i++)if(key==stack[i].key)return stack[i]},keys:function(){for(var keys=[],i=0;i<stack.length;i++)keys.push(stack[i].key);return keys},top:function(){return stack[stack.length-1]},remove:function(key){for(var idx=-1,i=0;i<stack.length;i++)if(key==stack[i].key){idx=i;break}return stack.splice(idx,1)[0]},removeTop:function(){return stack.splice(stack.length-1,1)[0]},length:function(){return stack.length}}}}}).factory("$$multiMap",function(){return{createNew:function(){var map={};return{entries:function(){return Object.keys(map).map(function(key){return{key:key,value:map[key]}})},get:function(key){return map[key]},hasKey:function(key){return!!map[key]},keys:function(){return Object.keys(map)},put:function(key,value){map[key]||(map[key]=[]),map[key].push(value)},remove:function(key,value){var values=map[key];if(values){var idx=values.indexOf(value);-1!==idx&&values.splice(idx,1),values.length||delete map[key]}}}}}}).directive("modalBackdrop",["$animate","$injector","$modalStack",function($animate,$injector,$modalStack){function linkFn(scope,element,attrs){attrs.modalInClass&&($animateCss?$animateCss(element,{addClass:attrs.modalInClass}).start():$animate.addClass(element,attrs.modalInClass),scope.$on($modalStack.NOW_CLOSING_EVENT,function(e,setIsAsync){var done=setIsAsync();$animateCss?$animateCss(element,{removeClass:attrs.modalInClass}).start().then(done):$animate.removeClass(element,attrs.modalInClass).then(done)}))}var $animateCss=null;return $injector.has("$animateCss")&&($animateCss=$injector.get("$animateCss")),{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",compile:function(tElement,tAttrs){return tElement.addClass(tAttrs.backdropClass),linkFn}}}]).directive("modalWindow",["$modalStack","$q","$animate","$injector",function($modalStack,$q,$animate,$injector){var $animateCss=null;return $injector.has("$animateCss")&&($animateCss=$injector.get("$animateCss")),{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:function(tElement,tAttrs){return tAttrs.templateUrl||"template/modal/window.html"},link:function(scope,element,attrs){element.addClass(attrs.windowClass||""),scope.size=attrs.size,scope.close=function(evt){var modal=$modalStack.getTop();modal&&modal.value.backdrop&&"static"!==modal.value.backdrop&&evt.target===evt.currentTarget&&(evt.preventDefault(),evt.stopPropagation(),$modalStack.dismiss(modal.key,"backdrop click"))},scope.$isRendered=!0;var modalRenderDeferObj=$q.defer();attrs.$observe("modalRender",function(value){"true"==value&&modalRenderDeferObj.resolve()}),modalRenderDeferObj.promise.then(function(){var animationPromise=null;attrs.modalInClass&&(animationPromise=$animateCss?$animateCss(element,{addClass:attrs.modalInClass}).start():$animate.addClass(element,attrs.modalInClass),scope.$on($modalStack.NOW_CLOSING_EVENT,function(e,setIsAsync){var done=setIsAsync();$animateCss?$animateCss(element,{removeClass:attrs.modalInClass}).start().then(done):$animate.removeClass(element,attrs.modalInClass).then(done)})),$q.when(animationPromise).then(function(){var inputsWithAutofocus=element[0].querySelectorAll("[autofocus]");inputsWithAutofocus.length?inputsWithAutofocus[0].focus():element[0].focus()});var modal=$modalStack.getTop();modal&&$modalStack.modalRendered(modal.key)})}}}]).directive("modalAnimationClass",[function(){return{compile:function(tElement,tAttrs){tAttrs.modalAnimation&&tElement.addClass(tAttrs.modalAnimationClass)}}}]).directive("modalTransclude",function(){return{link:function($scope,$element,$attrs,controller,$transclude){$transclude($scope.$parent,function(clone){$element.empty(),$element.append(clone)})}}}).factory("$modalStack",["$animate","$timeout","$document","$compile","$rootScope","$q","$injector","$$multiMap","$$stackedMap",function($animate,$timeout,$document,$compile,$rootScope,$q,$injector,$$multiMap,$$stackedMap){function backdropIndex(){for(var topBackdropIndex=-1,opened=openedWindows.keys(),i=0;i<opened.length;i++)openedWindows.get(opened[i]).value.backdrop&&(topBackdropIndex=i);return topBackdropIndex}function removeModalWindow(modalInstance,elementToReceiveFocus){var body=$document.find("body").eq(0),modalWindow=openedWindows.get(modalInstance).value;openedWindows.remove(modalInstance),removeAfterAnimate(modalWindow.modalDomEl,modalWindow.modalScope,function(){var modalBodyClass=modalWindow.openedClass||OPENED_MODAL_CLASS;openedClasses.remove(modalBodyClass,modalInstance),body.toggleClass(modalBodyClass,openedClasses.hasKey(modalBodyClass))}),checkRemoveBackdrop(),elementToReceiveFocus&&elementToReceiveFocus.focus?elementToReceiveFocus.focus():body.focus()}function checkRemoveBackdrop(){if(backdropDomEl&&-1==backdropIndex()){var backdropScopeRef=backdropScope;removeAfterAnimate(backdropDomEl,backdropScope,function(){backdropScopeRef=null}),backdropDomEl=void 0,backdropScope=void 0}}function removeAfterAnimate(domEl,scope,done){function afterAnimating(){afterAnimating.done||(afterAnimating.done=!0,$animateCss?$animateCss(domEl,{event:"leave"}).start().then(function(){domEl.remove()}):$animate.leave(domEl),scope.$destroy(),done&&done())}var asyncDeferred,asyncPromise=null,setIsAsync=function(){return asyncDeferred||(asyncDeferred=$q.defer(),asyncPromise=asyncDeferred.promise),function(){asyncDeferred.resolve()}};return scope.$broadcast($modalStack.NOW_CLOSING_EVENT,setIsAsync),$q.when(asyncPromise).then(afterAnimating)}function broadcastClosing(modalWindow,resultOrReason,closing){return!modalWindow.value.modalScope.$broadcast("modal.closing",resultOrReason,closing).defaultPrevented}var $animateCss=null;$injector.has("$animateCss")&&($animateCss=$injector.get("$animateCss"));var backdropDomEl,backdropScope,focusableElementList,OPENED_MODAL_CLASS="modal-open",openedWindows=$$stackedMap.createNew(),openedClasses=$$multiMap.createNew(),$modalStack={NOW_CLOSING_EVENT:"modal.stack.now-closing"},focusIndex=0;return $rootScope.$watch(backdropIndex,function(newBackdropIndex){backdropScope&&(backdropScope.index=newBackdropIndex)}),$document.bind("keydown",function(evt){if(evt.isDefaultPrevented())return evt;var modal=openedWindows.top();if(modal&&modal.value.keyboard)switch(evt.which){case 27:evt.preventDefault(),$rootScope.$apply(function(){$modalStack.dismiss(modal.key,"escape key press")});break;case 9:$modalStack.loadFocusElementList(modal);var focusChanged=!1;evt.shiftKey?$modalStack.isFocusInFirstItem(evt)&&(focusChanged=$modalStack.focusLastFocusableElement()):$modalStack.isFocusInLastItem(evt)&&(focusChanged=$modalStack.focusFirstFocusableElement()),focusChanged&&(evt.preventDefault(),evt.stopPropagation())}}),$modalStack.open=function(modalInstance,modal){var modalOpener=$document[0].activeElement,modalBodyClass=modal.openedClass||OPENED_MODAL_CLASS;openedWindows.add(modalInstance,{deferred:modal.deferred,renderDeferred:modal.renderDeferred,modalScope:modal.scope,backdrop:modal.backdrop,keyboard:modal.keyboard,openedClass:modal.openedClass}),openedClasses.put(modalBodyClass,modalInstance);var body=$document.find("body").eq(0),currBackdropIndex=backdropIndex();if(currBackdropIndex>=0&&!backdropDomEl){backdropScope=$rootScope.$new(!0),backdropScope.index=currBackdropIndex;var angularBackgroundDomEl=angular.element('<div modal-backdrop="modal-backdrop"></div>');angularBackgroundDomEl.attr("backdrop-class",modal.backdropClass),modal.animation&&angularBackgroundDomEl.attr("modal-animation","true"),backdropDomEl=$compile(angularBackgroundDomEl)(backdropScope),body.append(backdropDomEl)}var angularDomEl=angular.element('<div modal-window="modal-window"></div>');angularDomEl.attr({"template-url":modal.windowTemplateUrl,"window-class":modal.windowClass,size:modal.size,index:openedWindows.length()-1,animate:"animate"}).html(modal.content),modal.animation&&angularDomEl.attr("modal-animation","true");var modalDomEl=$compile(angularDomEl)(modal.scope);openedWindows.top().value.modalDomEl=modalDomEl,openedWindows.top().value.modalOpener=modalOpener,body.append(modalDomEl),body.addClass(modalBodyClass),$modalStack.clearFocusListCache()},$modalStack.close=function(modalInstance,result){var modalWindow=openedWindows.get(modalInstance);return modalWindow&&broadcastClosing(modalWindow,result,!0)?(modalWindow.value.modalScope.$$uibDestructionScheduled=!0,modalWindow.value.deferred.resolve(result),removeModalWindow(modalInstance,modalWindow.value.modalOpener),!0):!modalWindow},$modalStack.dismiss=function(modalInstance,reason){var modalWindow=openedWindows.get(modalInstance);return modalWindow&&broadcastClosing(modalWindow,reason,!1)?(modalWindow.value.modalScope.$$uibDestructionScheduled=!0,modalWindow.value.deferred.reject(reason),removeModalWindow(modalInstance,modalWindow.value.modalOpener),!0):!modalWindow},$modalStack.dismissAll=function(reason){for(var topModal=this.getTop();topModal&&this.dismiss(topModal.key,reason);)topModal=this.getTop()},$modalStack.getTop=function(){return openedWindows.top()},$modalStack.modalRendered=function(modalInstance){var modalWindow=openedWindows.get(modalInstance);modalWindow&&modalWindow.value.renderDeferred.resolve()},$modalStack.focusFirstFocusableElement=function(){return focusableElementList.length>0&&(focusableElementList[0].focus(),!0)},$modalStack.focusLastFocusableElement=function(){return focusableElementList.length>0&&(focusableElementList[focusableElementList.length-1].focus(),!0)},$modalStack.isFocusInFirstItem=function(evt){return focusableElementList.length>0&&(evt.target||evt.srcElement)==focusableElementList[0]},$modalStack.isFocusInLastItem=function(evt){return focusableElementList.length>0&&(evt.target||evt.srcElement)==focusableElementList[focusableElementList.length-1]},$modalStack.clearFocusListCache=function(){focusableElementList=[],focusIndex=0},$modalStack.loadFocusElementList=function(modalWindow){if((void 0===focusableElementList||!focusableElementList.length0)&&modalWindow){var modalDomE1=modalWindow.value.modalDomEl;modalDomE1&&modalDomE1.length&&(focusableElementList=modalDomE1[0].querySelectorAll("a[href], area[href], input:not([disabled]), button:not([disabled]),select:not([disabled]), textarea:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable=true]"))}},$modalStack}]).provider("$modal",function(){var $modalProvider={options:{animation:!0,backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$templateRequest","$controller","$modalStack",function($injector,$rootScope,$q,$templateRequest,$controller,$modalStack){function getTemplatePromise(options){return options.template?$q.when(options.template):$templateRequest(angular.isFunction(options.templateUrl)?options.templateUrl():options.templateUrl)}function getResolvePromises(resolves){var promisesArr=[];return angular.forEach(resolves,function(value){angular.isFunction(value)||angular.isArray(value)?promisesArr.push($q.when($injector.invoke(value))):angular.isString(value)?promisesArr.push($q.when($injector.get(value))):promisesArr.push($q.when(value))}),promisesArr}var $modal={},promiseChain=null;return $modal.getPromiseChain=function(){return promiseChain},$modal.open=function(modalOptions){var modalResultDeferred=$q.defer(),modalOpenedDeferred=$q.defer(),modalRenderDeferred=$q.defer(),modalInstance={result:modalResultDeferred.promise,opened:modalOpenedDeferred.promise,rendered:modalRenderDeferred.promise,close:function(result){return $modalStack.close(modalInstance,result)},dismiss:function(reason){return $modalStack.dismiss(modalInstance,reason)}};if(modalOptions=angular.extend({},$modalProvider.options,modalOptions),modalOptions.resolve=modalOptions.resolve||{},!modalOptions.template&&!modalOptions.templateUrl)throw new Error("One of template or templateUrl options is required.");var samePromise,templateAndResolvePromise=$q.all([getTemplatePromise(modalOptions)].concat(getResolvePromises(modalOptions.resolve)));return samePromise=promiseChain=$q.all([promiseChain]).then(function(){return templateAndResolvePromise},function(){return templateAndResolvePromise}).then(function(tplAndVars){var modalScope=(modalOptions.scope||$rootScope).$new();modalScope.$close=modalInstance.close,modalScope.$dismiss=modalInstance.dismiss,modalScope.$on("$destroy",function(){modalScope.$$uibDestructionScheduled||modalScope.$dismiss("$uibUnscheduledDestruction")});var ctrlInstance,ctrlLocals={},resolveIter=1;modalOptions.controller&&(ctrlLocals.$scope=modalScope,ctrlLocals.$modalInstance=modalInstance,angular.forEach(modalOptions.resolve,function(value,key){ctrlLocals[key]=tplAndVars[resolveIter++]}),ctrlInstance=$controller(modalOptions.controller,ctrlLocals),modalOptions.controllerAs&&(modalOptions.bindToController&&angular.extend(ctrlInstance,modalScope),modalScope[modalOptions.controllerAs]=ctrlInstance)),$modalStack.open(modalInstance,{scope:modalScope,deferred:modalResultDeferred,renderDeferred:modalRenderDeferred,content:tplAndVars[0],animation:modalOptions.animation,backdrop:modalOptions.backdrop,keyboard:modalOptions.keyboard,backdropClass:modalOptions.backdropClass,windowClass:modalOptions.windowClass,windowTemplateUrl:modalOptions.windowTemplateUrl,size:modalOptions.size,openedClass:modalOptions.openedClass}),modalOpenedDeferred.resolve(!0)},function(reason){modalOpenedDeferred.reject(reason),modalResultDeferred.reject(reason)}).finally(function(){promiseChain===samePromise&&(promiseChain=null)}),modalInstance},$modal}]};return $modalProvider}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse",function($scope,$attrs,$parse){var self=this,ngModelCtrl={$setViewValue:angular.noop},setNumPages=$attrs.numPages?$parse($attrs.numPages).assign:angular.noop;this.init=function(ngModelCtrl_,config){ngModelCtrl=ngModelCtrl_,this.config=config,ngModelCtrl.$render=function(){self.render()},$attrs.itemsPerPage?$scope.$parent.$watch($parse($attrs.itemsPerPage),function(value){self.itemsPerPage=parseInt(value,10),$scope.totalPages=self.calculateTotalPages()}):this.itemsPerPage=config.itemsPerPage,$scope.$watch("totalItems",function(){$scope.totalPages=self.calculateTotalPages()}),$scope.$watch("totalPages",function(value){setNumPages($scope.$parent,value),$scope.page>value?$scope.selectPage(value):ngModelCtrl.$render()})},this.calculateTotalPages=function(){var totalPages=this.itemsPerPage<1?1:Math.ceil($scope.totalItems/this.itemsPerPage);return Math.max(totalPages||0,1)},this.render=function(){$scope.page=parseInt(ngModelCtrl.$viewValue,10)||1},$scope.selectPage=function(page,evt){evt&&evt.preventDefault(),(!$scope.ngDisabled||!evt)&&$scope.page!==page&&page>0&&page<=$scope.totalPages&&(evt&&evt.target&&evt.target.blur(),ngModelCtrl.$setViewValue(page),ngModelCtrl.$render())},$scope.getText=function(key){return $scope[key+"Text"]||self.config[key+"Text"]},$scope.noPrevious=function(){return 1===$scope.page},$scope.noNext=function(){return $scope.page===$scope.totalPages}}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function($parse,paginationConfig){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@",ngDisabled:"="},require:["pagination","?ngModel"],controller:"PaginationController",controllerAs:"pagination",templateUrl:function(element,attrs){return attrs.templateUrl||"template/pagination/pagination.html"},replace:!0,link:function(scope,element,attrs,ctrls){function makePage(number,text,isActive){return{number:number,text:text,active:isActive}}function getPages(currentPage,totalPages){var pages=[],startPage=1,endPage=totalPages,isMaxSized=angular.isDefined(maxSize)&&maxSize<totalPages;isMaxSized&&(rotate?(startPage=Math.max(currentPage-Math.floor(maxSize/2),1),(endPage=startPage+maxSize-1)>totalPages&&(endPage=totalPages,startPage=endPage-maxSize+1)):(startPage=(Math.ceil(currentPage/maxSize)-1)*maxSize+1,endPage=Math.min(startPage+maxSize-1,totalPages)));for(var number=startPage;number<=endPage;number++){var page=makePage(number,number,number===currentPage);pages.push(page)}if(isMaxSized&&!rotate){if(startPage>1){var previousPageSet=makePage(startPage-1,"...",!1);pages.unshift(previousPageSet)}if(endPage<totalPages){var nextPageSet=makePage(endPage+1,"...",!1);pages.push(nextPageSet)}}return pages}var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(ngModelCtrl){var maxSize=angular.isDefined(attrs.maxSize)?scope.$parent.$eval(attrs.maxSize):paginationConfig.maxSize,rotate=angular.isDefined(attrs.rotate)?scope.$parent.$eval(attrs.rotate):paginationConfig.rotate;scope.boundaryLinks=angular.isDefined(attrs.boundaryLinks)?scope.$parent.$eval(attrs.boundaryLinks):paginationConfig.boundaryLinks,scope.directionLinks=angular.isDefined(attrs.directionLinks)?scope.$parent.$eval(attrs.directionLinks):paginationConfig.directionLinks,paginationCtrl.init(ngModelCtrl,paginationConfig),attrs.maxSize&&scope.$parent.$watch($parse(attrs.maxSize),function(value){maxSize=parseInt(value,10),paginationCtrl.render()});var originalRender=paginationCtrl.render;paginationCtrl.render=function(){originalRender(),scope.page>0&&scope.page<=scope.totalPages&&(scope.pages=getPages(scope.page,scope.totalPages))}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:" Previous",nextText:"Next ",align:!0}).directive("pager",["pagerConfig",function(pagerConfig){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@",ngDisabled:"="},require:["pager","?ngModel"],controller:"PaginationController",controllerAs:"pagination",templateUrl:function(element,attrs){return attrs.templateUrl||"template/pagination/pager.html"},replace:!0,link:function(scope,element,attrs,ctrls){var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&(scope.align=angular.isDefined(attrs.align)?scope.$parent.$eval(attrs.align):pagerConfig.align,paginationCtrl.init(ngModelCtrl,pagerConfig))}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function snake_case(name){var regexp=/[A-Z]/g;return name.replace(regexp,function(letter,pos){return(pos?"-":"")+letter.toLowerCase()})}var defaultOptions={placement:"top",animation:!0,popupDelay:0,useContentExp:!1},triggerMap={mouseenter:"mouseleave",click:"click",focus:"blur",none:""},globalOptions={};this.options=function(value){angular.extend(globalOptions,value)},this.setTriggers=function(triggers){angular.extend(triggerMap,triggers)},this.$get=["$window","$compile","$timeout","$document","$position","$interpolate","$rootScope","$parse",function($window,$compile,$timeout,$document,$position,$interpolate,$rootScope,$parse){return function(type,prefix,defaultTriggerShow,options){function getTriggers(trigger){var show=(trigger||options.trigger||defaultTriggerShow).split(" ");return{show:show,hide:show.map(function(trigger){return triggerMap[trigger]||trigger})}}options=angular.extend({},defaultOptions,globalOptions,options);var directiveName=snake_case(type),startSym=$interpolate.startSymbol(),endSym=$interpolate.endSymbol(),template="<div "+directiveName+'-popup title="'+startSym+"title"+endSym+'" '+(options.useContentExp?'content-exp="contentExp()" ':'content="'+startSym+"content"+endSym+'" ')+'placement="'+startSym+"placement"+endSym+'" popup-class="'+startSym+"popupClass"+endSym+'" animation="animation" is-open="isOpen"origin-scope="origScope" ></div>';return{restrict:"EA",compile:function(tElem,tAttrs){var tooltipLinker=$compile(template);return function(scope,element,attrs,tooltipCtrl){function toggleTooltipBind(){ttScope.isOpen?hideTooltipBind():showTooltipBind()}function showTooltipBind(){hasEnableExp&&!scope.$eval(attrs[prefix+"Enable"])||(prepareTooltip(),ttScope.popupDelay?popupTimeout||(popupTimeout=$timeout(show,ttScope.popupDelay,!1)):show())}function hideTooltipBind(){hide(),$rootScope.$$phase||$rootScope.$digest()}function show(){if(popupTimeout=null,transitionTimeout&&($timeout.cancel(transitionTimeout),transitionTimeout=null),!(options.useContentExp?ttScope.contentExp():ttScope.content))return angular.noop;createTooltip(),ttScope.isOpen=!0,isOpenExp&&isOpenExp.assign(ttScope.origScope,ttScope.isOpen),$rootScope.$$phase||ttScope.$apply(),tooltip.css({display:"block"}),positionTooltip()}function hide(){ttScope.isOpen=!1,isOpenExp&&isOpenExp.assign(ttScope.origScope,ttScope.isOpen),$timeout.cancel(popupTimeout),popupTimeout=null,$timeout.cancel(positionTimeout),positionTimeout=null,ttScope.animation?transitionTimeout||(transitionTimeout=$timeout(removeTooltip,500)):removeTooltip()}function createTooltip(){tooltip&&removeTooltip(),tooltipLinkedScope=ttScope.$new(),tooltip=tooltipLinker(tooltipLinkedScope,function(tooltip){appendToBody?$document.find("body").append(tooltip):element.after(tooltip)}),options.useContentExp&&(tooltipLinkedScope.$watch("contentExp()",function(val){!val&&ttScope.isOpen&&hide()}),tooltipLinkedScope.$watch(function(){repositionScheduled||(repositionScheduled=!0,tooltipLinkedScope.$$postDigest(function(){repositionScheduled=!1,ttScope.isOpen&&positionTooltip()}))}))}function removeTooltip(){transitionTimeout=null,tooltip&&(tooltip.remove(),tooltip=null),tooltipLinkedScope&&(tooltipLinkedScope.$destroy(),tooltipLinkedScope=null)}function prepareTooltip(){prepPopupClass(),prepPlacement(),prepPopupDelay()}function prepPopupClass(){ttScope.popupClass=attrs[prefix+"Class"]}function prepPlacement(){var val=attrs[prefix+"Placement"];ttScope.placement=angular.isDefined(val)?val:options.placement}function prepPopupDelay(){var val=attrs[prefix+"PopupDelay"],delay=parseInt(val,10);ttScope.popupDelay=isNaN(delay)?options.popupDelay:delay}var tooltip,tooltipLinkedScope,transitionTimeout,popupTimeout,positionTimeout,appendToBody=!!angular.isDefined(options.appendToBody)&&options.appendToBody,triggers=getTriggers(void 0),hasEnableExp=angular.isDefined(attrs[prefix+"Enable"]),ttScope=scope.$new(!0),repositionScheduled=!1,isOpenExp=!!angular.isDefined(attrs[prefix+"IsOpen"])&&$parse(attrs[prefix+"IsOpen"]),positionTooltip=function(){tooltip&&(positionTimeout||(positionTimeout=$timeout(function(){tooltip.css({top:0,left:0,width:"auto",height:"auto"});var ttBox=$position.position(tooltip),ttCss=$position.positionElements(element,tooltip,ttScope.placement,appendToBody);ttCss.top+="px",ttCss.left+="px",ttCss.width=ttBox.width+"px",ttCss.height=ttBox.height+"px",tooltip.css(ttCss),positionTimeout=null},0,!1)))};ttScope.origScope=scope,ttScope.isOpen=!1,ttScope.contentExp=function(){return scope.$eval(attrs[type])},options.useContentExp||attrs.$observe(type,function(val){ttScope.content=val,!val&&ttScope.isOpen?hide():positionTooltip()}),attrs.$observe("disabled",function(val){popupTimeout&&val&&($timeout.cancel(popupTimeout),popupTimeout=null),val&&ttScope.isOpen&&hide()}),attrs.$observe(prefix+"Title",function(val){ttScope.title=val,positionTooltip()}),attrs.$observe(prefix+"Placement",function(){ttScope.isOpen&&(prepPlacement(),positionTooltip())}),isOpenExp&&scope.$watch(isOpenExp,function(val){val!==ttScope.isOpen&&toggleTooltipBind()});var unregisterTriggers=function(){triggers.show.forEach(function(trigger){element.unbind(trigger,showTooltipBind)}),triggers.hide.forEach(function(trigger){element.unbind(trigger,hideTooltipBind)})};!function(){var val=attrs[prefix+"Trigger"];unregisterTriggers(),triggers=getTriggers(val),"none"!==triggers.show&&triggers.show.forEach(function(trigger,idx){trigger===triggers.hide[idx]?element[0].addEventListener(trigger,toggleTooltipBind):trigger&&(element[0].addEventListener(trigger,showTooltipBind),element[0].addEventListener(triggers.hide[idx],hideTooltipBind))})}();var animation=scope.$eval(attrs[prefix+"Animation"]);ttScope.animation=angular.isDefined(animation)?!!animation:options.animation;var appendToBodyVal=scope.$eval(attrs[prefix+"AppendToBody"]);appendToBody=angular.isDefined(appendToBodyVal)?appendToBodyVal:appendToBody,appendToBody&&scope.$on("$locationChangeSuccess",function(){ttScope.isOpen&&hide()}),scope.$on("$destroy",function(){$timeout.cancel(transitionTimeout),$timeout.cancel(popupTimeout),$timeout.cancel(positionTimeout),unregisterTriggers(),removeTooltip(),ttScope=null})}}}}}]}).directive("tooltipTemplateTransclude",["$animate","$sce","$compile","$templateRequest",function($animate,$sce,$compile,$templateRequest){return{link:function(scope,elem,attrs){var currentScope,previousElement,currentElement,origScope=scope.$eval(attrs.tooltipTemplateTranscludeScope),changeCounter=0,cleanupLastIncludeContent=function(){previousElement&&(previousElement.remove(),previousElement=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&($animate.leave(currentElement).then(function(){previousElement=null}),previousElement=currentElement,currentElement=null)};scope.$watch($sce.parseAsResourceUrl(attrs.tooltipTemplateTransclude),function(src){var thisChangeId=++changeCounter;src?($templateRequest(src,!0).then(function(response){if(thisChangeId===changeCounter){var newScope=origScope.$new(),template=response,clone=$compile(template)(newScope,function(clone){cleanupLastIncludeContent(),$animate.enter(clone,elem)});currentScope=newScope,currentElement=clone,currentScope.$emit("$includeContentLoaded",src)}},function(){thisChangeId===changeCounter&&(cleanupLastIncludeContent(),scope.$emit("$includeContentError",src))}),scope.$emit("$includeContentRequested",src)):cleanupLastIncludeContent()}),scope.$on("$destroy",cleanupLastIncludeContent)}}}]).directive("tooltipClasses",function(){return{restrict:"A",link:function(scope,element,attrs){scope.placement&&element.addClass(scope.placement),scope.popupClass&&element.addClass(scope.popupClass),scope.animation()&&element.addClass(attrs.tooltipAnimationClass)}}}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function($tooltip){return $tooltip("tooltip","tooltip","mouseenter")}]).directive("tooltipTemplatePopup",function(){return{restrict:"EA",replace:!0,scope:{contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&",originScope:"&"},templateUrl:"template/tooltip/tooltip-template-popup.html"}}).directive("tooltipTemplate",["$tooltip",function($tooltip){return $tooltip("tooltipTemplate","tooltip","mouseenter",{useContentExp:!0})}]).directive("tooltipHtmlPopup",function(){return{restrict:"EA",replace:!0,scope:{contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-popup.html"}}).directive("tooltipHtml",["$tooltip",function($tooltip){return $tooltip("tooltipHtml","tooltip","mouseenter",{useContentExp:!0})}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).value("tooltipHtmlUnsafeSuppressDeprecated",!1).directive("tooltipHtmlUnsafe",["$tooltip","tooltipHtmlUnsafeSuppressDeprecated","$log",function($tooltip,tooltipHtmlUnsafeSuppressDeprecated,$log){return tooltipHtmlUnsafeSuppressDeprecated||$log.warn("tooltip-html-unsafe is now deprecated. Use tooltip-html or tooltip-template instead."),$tooltip("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverTemplatePopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&",originScope:"&"},templateUrl:"template/popover/popover-template.html"}}).directive("popoverTemplate",["$tooltip",function($tooltip){return $tooltip("popoverTemplate","popover","click",{useContentExp:!0})}]).directive("popoverHtmlPopup",function(){return{restrict:"EA",replace:!0,scope:{contentExp:"&",title:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover-html.html"}}).directive("popoverHtml",["$tooltip",function($tooltip){return $tooltip("popoverHtml","popover","click",{useContentExp:!0})}]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function($tooltip){return $tooltip("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",[]).constant("progressConfig",{animate:!0,max:100}).value("$progressSuppressWarning",!1).controller("ProgressController",["$scope","$attrs","progressConfig",function($scope,$attrs,progressConfig){var self=this,animate=angular.isDefined($attrs.animate)?$scope.$parent.$eval($attrs.animate):progressConfig.animate;this.bars=[],$scope.max=angular.isDefined($scope.max)?$scope.max:progressConfig.max,this.addBar=function(bar,element){animate||element.css({transition:"none"}),this.bars.push(bar),bar.max=$scope.max,bar.$watch("value",function(value){bar.recalculatePercentage()}),bar.recalculatePercentage=function(){bar.percent=+(100*bar.value/bar.max).toFixed(2);var totalPercentage=self.bars.reduce(function(total,bar){return total+bar.percent},0);totalPercentage>100&&(bar.percent-=totalPercentage-100)},bar.$on("$destroy",function(){element=null,self.removeBar(bar)})},this.removeBar=function(bar){this.bars.splice(this.bars.indexOf(bar),1)},$scope.$watch("max",function(max){self.bars.forEach(function(bar){bar.max=$scope.max,bar.recalculatePercentage()})})}]).directive("uibProgress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"uibProgress",scope:{max:"=?"},templateUrl:"template/progressbar/progress.html"}}).directive("progress",["$log","$progressSuppressWarning",function($log,$progressSuppressWarning){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{max:"=?"},templateUrl:"template/progressbar/progress.html",link:function(){$progressSuppressWarning&&$log.warn("progress is now deprecated. Use uib-progress instead")}}}]).directive("uibBar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^uibProgress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,element)}}}).directive("bar",["$log","$progressSuppressWarning",function($log,$progressSuppressWarning){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(scope,element,attrs,progressCtrl){$progressSuppressWarning&&$log.warn("bar is now deprecated. Use uib-bar instead"),progressCtrl.addBar(scope,element)}}}]).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",max:"=?",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,angular.element(element.children()[0]))}}}),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null,titles:["one","two","three","four","five"]}).controller("RatingController",["$scope","$attrs","ratingConfig",function($scope,$attrs,ratingConfig){var ngModelCtrl={$setViewValue:angular.noop};this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=this.render,ngModelCtrl.$formatters.push(function(value){return angular.isNumber(value)&&value<<0!==value&&(value=Math.round(value)),value}),this.stateOn=angular.isDefined($attrs.stateOn)?$scope.$parent.$eval($attrs.stateOn):ratingConfig.stateOn,this.stateOff=angular.isDefined($attrs.stateOff)?$scope.$parent.$eval($attrs.stateOff):ratingConfig.stateOff;var tmpTitles=angular.isDefined($attrs.titles)?$scope.$parent.$eval($attrs.titles):ratingConfig.titles;this.titles=angular.isArray(tmpTitles)&&tmpTitles.length>0?tmpTitles:ratingConfig.titles;var ratingStates=angular.isDefined($attrs.ratingStates)?$scope.$parent.$eval($attrs.ratingStates):new Array(angular.isDefined($attrs.max)?$scope.$parent.$eval($attrs.max):ratingConfig.max);$scope.range=this.buildTemplateObjects(ratingStates)},this.buildTemplateObjects=function(states){for(var i=0,n=states.length;i<n;i++)states[i]=angular.extend({index:i},{stateOn:this.stateOn,stateOff:this.stateOff,title:this.getTitle(i)},states[i]);return states},this.getTitle=function(index){return index>=this.titles.length?index+1:this.titles[index]},$scope.rate=function(value){!$scope.readonly&&value>=0&&value<=$scope.range.length&&(ngModelCtrl.$setViewValue(ngModelCtrl.$viewValue===value?0:value),ngModelCtrl.$render())},$scope.enter=function(value){$scope.readonly||($scope.value=value),$scope.onHover({value:value})},$scope.reset=function(){$scope.value=ngModelCtrl.$viewValue,$scope.onLeave()},$scope.onKeydown=function(evt){/(37|38|39|40)/.test(evt.which)&&(evt.preventDefault(),evt.stopPropagation(),$scope.rate($scope.value+(38===evt.which||39===evt.which?1:-1)))},this.render=function(){$scope.value=ngModelCtrl.$viewValue}}]).directive("rating",function(){return{restrict:"EA",require:["rating","ngModel"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0,link:function(scope,element,attrs,ctrls){var ratingCtrl=ctrls[0],ngModelCtrl=ctrls[1];ratingCtrl.init(ngModelCtrl)}}}),angular.module("ui.bootstrap.tabs",[]).controller("TabsetController",["$scope",function($scope){var ctrl=this,tabs=ctrl.tabs=$scope.tabs=[];ctrl.select=function(selectedTab){angular.forEach(tabs,function(tab){tab.active&&tab!==selectedTab&&(tab.active=!1,tab.onDeselect(),selectedTab.selectCalled=!1)}),selectedTab.active=!0,selectedTab.selectCalled||(selectedTab.onSelect(),selectedTab.selectCalled=!0)},ctrl.addTab=function(tab){tabs.push(tab),1===tabs.length&&!1!==tab.active?tab.active=!0:tab.active?ctrl.select(tab):tab.active=!1},ctrl.removeTab=function(tab){var index=tabs.indexOf(tab);if(tab.active&&tabs.length>1&&!destroyed){var newActiveIndex=index==tabs.length-1?index-1:index+1;ctrl.select(tabs[newActiveIndex])}tabs.splice(index,1)};var destroyed;$scope.$on("$destroy",function(){destroyed=!0})}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{type:"@"},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(scope,element,attrs){scope.vertical=!!angular.isDefined(attrs.vertical)&&scope.$parent.$eval(attrs.vertical),scope.justified=!!angular.isDefined(attrs.justified)&&scope.$parent.$eval(attrs.justified)}}}).directive("tab",["$parse","$log",function($parse,$log){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{active:"=?",heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},link:function(scope,elm,attrs,tabsetCtrl,transclude){scope.$watch("active",function(active){active&&tabsetCtrl.select(scope)}),scope.disabled=!1,attrs.disable&&scope.$parent.$watch($parse(attrs.disable),function(value){scope.disabled=!!value}),attrs.disabled&&($log.warn('Use of "disabled" attribute has been deprecated, please use "disable"'),scope.$parent.$watch($parse(attrs.disabled),function(value){scope.disabled=!!value})),scope.select=function(){scope.disabled||(scope.active=!0)},tabsetCtrl.addTab(scope),scope.$on("$destroy",function(){tabsetCtrl.removeTab(scope)}),scope.$transcludeFn=transclude}}}]).directive("tabHeadingTransclude",function(){return{restrict:"A",require:"^tab",link:function(scope,elm,attrs,tabCtrl){scope.$watch("headingElement",function(heading){heading&&(elm.html(""),elm.append(heading))})}}}).directive("tabContentTransclude",function(){function isTabHeading(node){return node.tagName&&(node.hasAttribute("tab-heading")||node.hasAttribute("data-tab-heading")||node.hasAttribute("x-tab-heading")||"tab-heading"===node.tagName.toLowerCase()||"data-tab-heading"===node.tagName.toLowerCase()||"x-tab-heading"===node.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(scope,elm,attrs){var tab=scope.$eval(attrs.tabContentTransclude);tab.$transcludeFn(tab.$parent,function(contents){angular.forEach(contents,function(node){isTabHeading(node)?tab.headingElement=node:elm.append(node)})})}}}),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0,arrowkeys:!0,showSpinners:!0}).controller("TimepickerController",["$scope","$attrs","$parse","$log","$locale","timepickerConfig",function($scope,$attrs,$parse,$log,$locale,timepickerConfig){function getHoursFromTemplate(){var hours=parseInt($scope.hours,10);if($scope.showMeridian?hours>0&&hours<13:hours>=0&&hours<24)return $scope.showMeridian&&(12===hours&&(hours=0),$scope.meridian===meridians[1]&&(hours+=12)),hours}function getMinutesFromTemplate(){var minutes=parseInt($scope.minutes,10);return minutes>=0&&minutes<60?minutes:void 0}function pad(value){return angular.isDefined(value)&&value.toString().length<2?"0"+value:value.toString()}function refresh(keyboardChange){makeValid(),ngModelCtrl.$setViewValue(new Date(selected)),updateTemplate(keyboardChange)}function makeValid(){ngModelCtrl.$setValidity("time",!0),$scope.invalidHours=!1,$scope.invalidMinutes=!1}function updateTemplate(keyboardChange){var hours=selected.getHours(),minutes=selected.getMinutes();$scope.showMeridian&&(hours=0===hours||12===hours?12:hours%12),$scope.hours="h"===keyboardChange?hours:pad(hours),"m"!==keyboardChange&&($scope.minutes=pad(minutes)),$scope.meridian=selected.getHours()<12?meridians[0]:meridians[1]}function addMinutes(date,minutes){var dt=new Date(date.getTime()+6e4*minutes),newDate=new Date(date);return newDate.setHours(dt.getHours(),dt.getMinutes()),newDate}function addMinutesToSelected(minutes){selected=addMinutes(selected,minutes),refresh()}var selected=new Date,ngModelCtrl={$setViewValue:angular.noop},meridians=angular.isDefined($attrs.meridians)?$scope.$parent.$eval($attrs.meridians):timepickerConfig.meridians||$locale.DATETIME_FORMATS.AMPMS;this.init=function(ngModelCtrl_,inputs){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=this.render,ngModelCtrl.$formatters.unshift(function(modelValue){return modelValue?new Date(modelValue):null});var hoursInputEl=inputs.eq(0),minutesInputEl=inputs.eq(1);(angular.isDefined($attrs.mousewheel)?$scope.$parent.$eval($attrs.mousewheel):timepickerConfig.mousewheel)&&this.setupMousewheelEvents(hoursInputEl,minutesInputEl),(angular.isDefined($attrs.arrowkeys)?$scope.$parent.$eval($attrs.arrowkeys):timepickerConfig.arrowkeys)&&this.setupArrowkeyEvents(hoursInputEl,minutesInputEl),$scope.readonlyInput=angular.isDefined($attrs.readonlyInput)?$scope.$parent.$eval($attrs.readonlyInput):timepickerConfig.readonlyInput,this.setupInputEvents(hoursInputEl,minutesInputEl)};var hourStep=timepickerConfig.hourStep;$attrs.hourStep&&$scope.$parent.$watch($parse($attrs.hourStep),function(value){hourStep=parseInt(value,10)});var minuteStep=timepickerConfig.minuteStep;$attrs.minuteStep&&$scope.$parent.$watch($parse($attrs.minuteStep),function(value){minuteStep=parseInt(value,10)});var min;$scope.$parent.$watch($parse($attrs.min),function(value){var dt=new Date(value);min=isNaN(dt)?void 0:dt});var max;$scope.$parent.$watch($parse($attrs.max),function(value){var dt=new Date(value);max=isNaN(dt)?void 0:dt}),$scope.noIncrementHours=function(){var incrementedSelected=addMinutes(selected,60*hourStep);return incrementedSelected>max||incrementedSelected<selected&&incrementedSelected<min},$scope.noDecrementHours=function(){var decrementedSelected=addMinutes(selected,60*-hourStep);return decrementedSelected<min||decrementedSelected>selected&&decrementedSelected>max},$scope.noIncrementMinutes=function(){var incrementedSelected=addMinutes(selected,minuteStep);return incrementedSelected>max||incrementedSelected<selected&&incrementedSelected<min},$scope.noDecrementMinutes=function(){var decrementedSelected=addMinutes(selected,-minuteStep);return decrementedSelected<min||decrementedSelected>selected&&decrementedSelected>max},$scope.noToggleMeridian=function(){return selected.getHours()<13?addMinutes(selected,720)>max:addMinutes(selected,-720)<min},$scope.showMeridian=timepickerConfig.showMeridian,$attrs.showMeridian&&$scope.$parent.$watch($parse($attrs.showMeridian),function(value){if($scope.showMeridian=!!value,ngModelCtrl.$error.time){var hours=getHoursFromTemplate(),minutes=getMinutesFromTemplate();angular.isDefined(hours)&&angular.isDefined(minutes)&&(selected.setHours(hours),refresh())}else updateTemplate()}),this.setupMousewheelEvents=function(hoursInputEl,minutesInputEl){var isScrollingUp=function(e){e.originalEvent&&(e=e.originalEvent);var delta=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||delta>0};hoursInputEl.bind("mousewheel wheel",function(e){$scope.$apply(isScrollingUp(e)?$scope.incrementHours():$scope.decrementHours()),e.preventDefault()}),minutesInputEl.bind("mousewheel wheel",function(e){$scope.$apply(isScrollingUp(e)?$scope.incrementMinutes():$scope.decrementMinutes()),e.preventDefault()})},this.setupArrowkeyEvents=function(hoursInputEl,minutesInputEl){hoursInputEl.bind("keydown",function(e){38===e.which?(e.preventDefault(),$scope.incrementHours(),$scope.$apply()):40===e.which&&(e.preventDefault(),$scope.decrementHours(),$scope.$apply())}),minutesInputEl.bind("keydown",function(e){38===e.which?(e.preventDefault(),$scope.incrementMinutes(),$scope.$apply()):40===e.which&&(e.preventDefault(),$scope.decrementMinutes(),$scope.$apply())})},this.setupInputEvents=function(hoursInputEl,minutesInputEl){if($scope.readonlyInput)return $scope.updateHours=angular.noop,void($scope.updateMinutes=angular.noop);var invalidate=function(invalidHours,invalidMinutes){ngModelCtrl.$setViewValue(null),ngModelCtrl.$setValidity("time",!1),angular.isDefined(invalidHours)&&($scope.invalidHours=invalidHours),angular.isDefined(invalidMinutes)&&($scope.invalidMinutes=invalidMinutes)};$scope.updateHours=function(){var hours=getHoursFromTemplate(),minutes=getMinutesFromTemplate();angular.isDefined(hours)&&angular.isDefined(minutes)?(selected.setHours(hours),selected<min||selected>max?invalidate(!0):refresh("h")):invalidate(!0)},hoursInputEl.bind("blur",function(e){!$scope.invalidHours&&$scope.hours<10&&$scope.$apply(function(){$scope.hours=pad($scope.hours)})}),$scope.updateMinutes=function(){var minutes=getMinutesFromTemplate(),hours=getHoursFromTemplate();angular.isDefined(minutes)&&angular.isDefined(hours)?(selected.setMinutes(minutes),selected<min||selected>max?invalidate(void 0,!0):refresh("m")):invalidate(void 0,!0)},minutesInputEl.bind("blur",function(e){!$scope.invalidMinutes&&$scope.minutes<10&&$scope.$apply(function(){$scope.minutes=pad($scope.minutes)})})},this.render=function(){var date=ngModelCtrl.$viewValue;isNaN(date)?(ngModelCtrl.$setValidity("time",!1),$log.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(date&&(selected=date),selected<min||selected>max?(ngModelCtrl.$setValidity("time",!1),$scope.invalidHours=!0,$scope.invalidMinutes=!0):makeValid(),updateTemplate())},$scope.showSpinners=angular.isDefined($attrs.showSpinners)?$scope.$parent.$eval($attrs.showSpinners):timepickerConfig.showSpinners,$scope.incrementHours=function(){$scope.noIncrementHours()||addMinutesToSelected(60*hourStep)},$scope.decrementHours=function(){$scope.noDecrementHours()||addMinutesToSelected(60*-hourStep)},$scope.incrementMinutes=function(){$scope.noIncrementMinutes()||addMinutesToSelected(minuteStep)},$scope.decrementMinutes=function(){$scope.noDecrementMinutes()||addMinutesToSelected(-minuteStep)},$scope.toggleMeridian=function(){$scope.noToggleMeridian()||addMinutesToSelected(720*(selected.getHours()<12?1:-1))}}]).directive("timepicker",function(){return{restrict:"EA",require:["timepicker","?^ngModel"],controller:"TimepickerController",controllerAs:"timepicker",replace:!0,scope:{},templateUrl:function(element,attrs){return attrs.templateUrl||"template/timepicker/timepicker.html"},link:function(scope,element,attrs,ctrls){var timepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&timepickerCtrl.init(ngModelCtrl,element.find("input"))}}}),angular.module("ui.bootstrap.transition",[]).value("$transitionSuppressDeprecated",!1).factory("$transition",["$q","$timeout","$rootScope","$log","$transitionSuppressDeprecated",function($q,$timeout,$rootScope,$log,$transitionSuppressDeprecated){function findEndEventName(endEventNames){for(var name in endEventNames)if(void 0!==transElement.style[name])return endEventNames[name]}$transitionSuppressDeprecated||$log.warn("$transition is now deprecated. Use $animate from ngAnimate instead.");var $transition=function(element,trigger,options){options=options||{};var deferred=$q.defer(),endEventName=$transition[options.animation?"animationEndEventName":"transitionEndEventName"],transitionEndHandler=function(event){$rootScope.$apply(function(){element.unbind(endEventName,transitionEndHandler),deferred.resolve(element)})};return endEventName&&element.bind(endEventName,transitionEndHandler),$timeout(function(){angular.isString(trigger)?element.addClass(trigger):angular.isFunction(trigger)?trigger(element):angular.isObject(trigger)&&element.css(trigger),endEventName||deferred.resolve(element)}),deferred.promise.cancel=function(){endEventName&&element.unbind(endEventName,transitionEndHandler),deferred.reject("Transition cancelled")},deferred.promise},transElement=document.createElement("trans"),transitionEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},animationEndEventNames={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return $transition.transitionEndEventName=findEndEventName(transitionEndEventNames),$transition.animationEndEventName=findEndEventName(animationEndEventNames),$transition}]),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position"]).factory("typeaheadParser",["$parse",function($parse){var TYPEAHEAD_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(input){var match=input.match(TYPEAHEAD_REGEXP);if(!match)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+input+'".');return{itemName:match[3],source:$parse(match[4]),viewMapper:$parse(match[2]||match[1]),modelMapper:$parse(match[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$window","$rootScope","$position","typeaheadParser",function($compile,$parse,$q,$timeout,$document,$window,$rootScope,$position,typeaheadParser){var HOT_KEYS=[9,13,27,38,40];return{require:["ngModel","^?ngModelOptions"],link:function(originalScope,element,attrs,ctrls){function fireRecalculating(){scope.moveInProgress||(scope.moveInProgress=!0,scope.$digest()),timeoutEventPromise&&$timeout.cancel(timeoutEventPromise),timeoutEventPromise=$timeout(function(){scope.matches.length&&recalculatePosition(),scope.moveInProgress=!1,scope.$digest()},200)}function recalculatePosition(){scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top+=element.prop("offsetHeight")}var modelCtrl=ctrls[0],ngModelOptions=ctrls[1],minLength=originalScope.$eval(attrs.typeaheadMinLength);minLength||0===minLength||(minLength=1);var hasFocus,selected,waitTime=originalScope.$eval(attrs.typeaheadWaitMs)||0,isEditable=!1!==originalScope.$eval(attrs.typeaheadEditable),isLoadingSetter=$parse(attrs.typeaheadLoading).assign||angular.noop,onSelectCallback=$parse(attrs.typeaheadOnSelect),isSelectOnBlur=!!angular.isDefined(attrs.typeaheadSelectOnBlur)&&originalScope.$eval(attrs.typeaheadSelectOnBlur),isNoResultsSetter=$parse(attrs.typeaheadNoResults).assign||angular.noop,inputFormatter=attrs.typeaheadInputFormatter?$parse(attrs.typeaheadInputFormatter):void 0,appendToBody=!!attrs.typeaheadAppendToBody&&originalScope.$eval(attrs.typeaheadAppendToBody),focusFirst=!1!==originalScope.$eval(attrs.typeaheadFocusFirst),selectOnExact=!!attrs.typeaheadSelectOnExact&&originalScope.$eval(attrs.typeaheadSelectOnExact),parsedModel=$parse(attrs.ngModel),invokeModelSetter=$parse(attrs.ngModel+"($$$p)"),$setModelValue=function(scope,newValue){return angular.isFunction(parsedModel(originalScope))&&ngModelOptions&&ngModelOptions.$options&&ngModelOptions.$options.getterSetter?invokeModelSetter(scope,{$$$p:newValue}):parsedModel.assign(scope,newValue)},parserResult=typeaheadParser.parse(attrs.typeahead),scope=originalScope.$new(),offDestroy=originalScope.$on("$destroy",function(){scope.$destroy()});scope.$on("$destroy",offDestroy);var popupId="typeahead-"+scope.$id+"-"+Math.floor(1e4*Math.random());element.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":popupId});var popUpEl=angular.element("<div typeahead-popup></div>");popUpEl.attr({id:popupId,matches:"matches",active:"activeIdx",select:"select(activeIdx)","move-in-progress":"moveInProgress",query:"query",position:"position"}),angular.isDefined(attrs.typeaheadTemplateUrl)&&popUpEl.attr("template-url",attrs.typeaheadTemplateUrl),angular.isDefined(attrs.typeaheadPopupTemplateUrl)&&popUpEl.attr("popup-template-url",attrs.typeaheadPopupTemplateUrl);var resetMatches=function(){scope.matches=[],scope.activeIdx=-1,element.attr("aria-expanded",!1)},getMatchId=function(index){return popupId+"-option-"+index};scope.$watch("activeIdx",function(index){index<0?element.removeAttr("aria-activedescendant"):element.attr("aria-activedescendant",getMatchId(index))});var inputIsExactMatch=function(inputValue,index){return!!(scope.matches.length>index&&inputValue)&&inputValue.toUpperCase()===scope.matches[index].label.toUpperCase()},getMatchesAsync=function(inputValue){var locals={$viewValue:inputValue};isLoadingSetter(originalScope,!0),isNoResultsSetter(originalScope,!1),$q.when(parserResult.source(originalScope,locals)).then(function(matches){var onCurrentRequest=inputValue===modelCtrl.$viewValue;if(onCurrentRequest&&hasFocus)if(matches&&matches.length>0){scope.activeIdx=focusFirst?0:-1,isNoResultsSetter(originalScope,!1),scope.matches.length=0;for(var i=0;i<matches.length;i++)locals[parserResult.itemName]=matches[i],scope.matches.push({id:getMatchId(i),label:parserResult.viewMapper(scope,locals),model:matches[i]});scope.query=inputValue,recalculatePosition(),element.attr("aria-expanded",!0),selectOnExact&&1===scope.matches.length&&inputIsExactMatch(inputValue,0)&&scope.select(0)}else resetMatches(),isNoResultsSetter(originalScope,!0);onCurrentRequest&&isLoadingSetter(originalScope,!1)},function(){resetMatches(),isLoadingSetter(originalScope,!1),isNoResultsSetter(originalScope,!0)})};appendToBody&&(angular.element($window).bind("resize",fireRecalculating),$document.find("body").bind("scroll",fireRecalculating));var timeoutEventPromise;scope.moveInProgress=!1,resetMatches(),scope.query=void 0;var timeoutPromise,scheduleSearchWithTimeout=function(inputValue){timeoutPromise=$timeout(function(){getMatchesAsync(inputValue)},waitTime)},cancelPreviousTimeout=function(){timeoutPromise&&$timeout.cancel(timeoutPromise)};modelCtrl.$parsers.unshift(function(inputValue){return hasFocus=!0,0===minLength||inputValue&&inputValue.length>=minLength?waitTime>0?(cancelPreviousTimeout(),scheduleSearchWithTimeout(inputValue)):getMatchesAsync(inputValue):(isLoadingSetter(originalScope,!1),cancelPreviousTimeout(),resetMatches()),isEditable?inputValue:inputValue?void modelCtrl.$setValidity("editable",!1):(modelCtrl.$setValidity("editable",!0),null)}),modelCtrl.$formatters.push(function(modelValue){var candidateViewValue,emptyViewValue,locals={};return isEditable||modelCtrl.$setValidity("editable",!0),inputFormatter?(locals.$model=modelValue,inputFormatter(originalScope,locals)):(locals[parserResult.itemName]=modelValue,candidateViewValue=parserResult.viewMapper(originalScope,locals),locals[parserResult.itemName]=void 0,emptyViewValue=parserResult.viewMapper(originalScope,locals),candidateViewValue!==emptyViewValue?candidateViewValue:modelValue)}),scope.select=function(activeIdx){var model,item,locals={};selected=!0,locals[parserResult.itemName]=item=scope.matches[activeIdx].model,model=parserResult.modelMapper(originalScope,locals),$setModelValue(originalScope,model),modelCtrl.$setValidity("editable",!0),modelCtrl.$setValidity("parse",!0),onSelectCallback(originalScope,{$item:item,$model:model,$label:parserResult.viewMapper(originalScope,locals)}),resetMatches(),!1!==scope.$eval(attrs.typeaheadFocusOnSelect)&&$timeout(function(){element[0].focus()},0,!1)},element.bind("keydown",function(evt){if(0!==scope.matches.length&&-1!==HOT_KEYS.indexOf(evt.which)){if(-1===scope.activeIdx&&(9===evt.which||13===evt.which))return resetMatches(),void scope.$digest();evt.preventDefault(),40===evt.which?(scope.activeIdx=(scope.activeIdx+1)%scope.matches.length,scope.$digest()):38===evt.which?(scope.activeIdx=(scope.activeIdx>0?scope.activeIdx:scope.matches.length)-1,scope.$digest()):13===evt.which||9===evt.which?scope.$apply(function(){scope.select(scope.activeIdx)}):27===evt.which&&(evt.stopPropagation(),resetMatches(),scope.$digest())}}),element.bind("blur",function(){isSelectOnBlur&&scope.matches.length&&-1!==scope.activeIdx&&!selected&&(selected=!0,scope.$apply(function(){scope.select(scope.activeIdx)})),hasFocus=!1,selected=!1});var dismissClickHandler=function(evt){element[0]!==evt.target&&3!==evt.which&&0!==scope.matches.length&&(resetMatches(),$rootScope.$$phase||scope.$digest())};$document.bind("click",dismissClickHandler),originalScope.$on("$destroy",function(){$document.unbind("click",dismissClickHandler),appendToBody&&$popup.remove(),popUpEl.remove()});var $popup=$compile(popUpEl)(scope);appendToBody?$document.find("body").append($popup):element.after($popup)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"&",moveInProgress:"=",select:"&"},replace:!0,templateUrl:function(element,attrs){return attrs.popupTemplateUrl||"template/typeahead/typeahead-popup.html"},link:function(scope,element,attrs){scope.templateUrl=attrs.templateUrl,scope.isOpen=function(){return scope.matches.length>0},scope.isActive=function(matchIdx){return scope.active==matchIdx},scope.selectActive=function(matchIdx){scope.active=matchIdx},scope.selectMatch=function(activeIdx){scope.select({activeIdx:activeIdx})}}}}).directive("typeaheadMatch",["$templateRequest","$compile","$parse",function($templateRequest,$compile,$parse){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(scope,element,attrs){var tplUrl=$parse(attrs.templateUrl)(scope.$parent)||"template/typeahead/typeahead-match.html";$templateRequest(tplUrl).then(function(tplContent){$compile(tplContent.trim())(scope,function(clonedElement){element.replaceWith(clonedElement)})})}}}]).filter("typeaheadHighlight",["$sce","$injector","$log",function($sce,$injector,$log){function escapeRegexp(queryToEscape){return queryToEscape.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function containsHtml(matchItem){return/<.*>/g.test(matchItem)}var isSanitizePresent;return isSanitizePresent=$injector.has("$sanitize"),function(matchItem,query){return!isSanitizePresent&&containsHtml(matchItem)&&$log.warn("Unsafe use of typeahead please use ngSanitize"),matchItem=query?(""+matchItem).replace(new RegExp(escapeRegexp(query),"gi"),"<strong>$&</strong>"):matchItem,isSanitizePresent||(matchItem=$sce.trustAsHtml(matchItem)),matchItem}}]),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion-group.html",'<div class="panel {{panelClass || \'panel-default\'}}">\n  <div class="panel-heading" ng-keypress="toggleOpen($event)">\n    <h4 class="panel-title">\n      <a href tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" accordion-transclude="heading"><span ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></a>\n    </h4>\n  </div>\n  <div class="panel-collapse collapse" collapse="!isOpen">\n\t  <div class="panel-body" ng-transclude></div>\n  </div>\n</div>\n')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion.html",'<div class="panel-group" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/alert/alert.html",'<div class="alert" ng-class="[\'alert-\' + (type || \'warning\'), closeable ? \'alert-dismissible\' : null]" role="alert">\n    <button ng-show="closeable" type="button" class="close" ng-click="close($event)">\n        <span aria-hidden="true">&times;</span>\n        <span class="sr-only">Close</span>\n    </button>\n    <div ng-transclude></div>\n</div>\n')}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides | orderBy:indexOfSlide track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-left"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-right"></span></a>\n</div>\n')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/slide.html",'<div ng-class="{\n    \'active\': active\n  }" class="item text-center" ng-transclude></div>\n')}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)">\n  <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n  <monthpicker ng-switch-when="month" tabindex="0"></monthpicker>\n  <yearpicker ng-switch-when="year" tabindex="0"></yearpicker>\n</div>')}]),angular.module("template/datepicker/day.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/day.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="{{::5 + showWeeks}}"><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n    <tr>\n      <th ng-if="showWeeks" class="text-center"></th>\n      <th ng-repeat="label in ::labels track by $index" class="text-center"><small aria-label="{{::label.full}}">{{::label.abbr}}</small></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-if="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}" ng-class="::dt.customClass">\n        <button type="button" style="min-width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/month.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/month.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}" ng-class="::dt.customClass">\n        <button type="button" style="min-width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/popup.html",'<ul class="dropdown-menu" ng-if="isOpen" style="display: block" ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()">\n\t<li ng-transclude></li>\n\t<li ng-if="showButtonBar" style="padding:10px 9px 2px">\n\t\t<span class="btn-group pull-left">\n\t\t\t<button type="button" class="btn btn-sm btn-info" ng-click="select(\'today\')" ng-disabled="isDisabled(\'today\')">{{ getText(\'current\') }}</button>\n\t\t\t<button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>\n\t\t</span>\n\t\t<button type="button" class="btn btn-sm btn-success pull-right" ng-click="close()">{{ getText(\'close\') }}</button>\n\t</li>\n</ul>\n')}]),angular.module("template/datepicker/year.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/year.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="3"><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}">\n        <button type="button" style="min-width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/backdrop.html",'<div class="modal-backdrop"\n     modal-animation-class="fade"\n     modal-in-class="in"\n     ng-style="{\'z-index\': 1040 + (index && 1 || 0) + index*10}"\n></div>\n')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/window.html",'<div modal-render="{{$isRendered}}" tabindex="-1" role="dialog" class="modal"\n    modal-animation-class="fade"\n    modal-in-class="in"\n\tng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog" ng-class="size ? \'modal-\' + size : \'\'"><div class="modal-content" modal-transclude></div></div>\n</div>\n')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pager.html",'<ul class="pager">\n  <li ng-class="{disabled: noPrevious()||ngDisabled, previous: align}"><a href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext()||ngDisabled, next: align}"><a href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a></li>\n</ul>\n')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-if="::boundaryLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first"><a href ng-click="selectPage(1, $event)">{{::getText(\'first\')}}</a></li>\n  <li ng-if="::directionLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-prev"><a href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}" class="pagination-page"><a href ng-click="selectPage(page.number, $event)">{{page.text}}</a></li>\n  <li ng-if="::directionLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-next"><a href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a></li>\n  <li ng-if="::boundaryLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last"><a href ng-click="selectPage(totalPages, $event)">{{::getText(\'last\')}}</a></li>\n</ul>\n')}]),angular.module("template/tooltip/tooltip-html-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind-html="contentExp()"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-template-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-template-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner"\n    tooltip-template-transclude="contentExp()"\n    tooltip-template-transclude-scope="originScope()"></div>\n</div>\n')}]),angular.module("template/popover/popover-html.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover-html.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content" ng-bind-html="contentExp()"></div>\n  </div>\n</div>\n')}]),angular.module("template/popover/popover-template.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover-template.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content"\n        tooltip-template-transclude="contentExp()"\n        tooltip-template-transclude-scope="originScope()"></div>\n  </div>\n</div>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/bar.html",'<div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: (percent < 100 ? percent : 100) + \'%\'}" aria-valuetext="{{percent | number:0}}%" style="min-width: 0;" ng-transclude></div>\n')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progress.html",'<div class="progress" ng-transclude></div>')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progressbar.html",'<div class="progress">\n  <div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: (percent < 100 ? percent : 100) + \'%\'}" aria-valuetext="{{percent | number:0}}%" style="min-width: 0;" ng-transclude></div>\n</div>\n')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rating/rating.html",'<span ng-mouseleave="reset()" ng-keydown="onKeydown($event)" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="{{range.length}}" aria-valuenow="{{value}}">\n    <span ng-repeat-start="r in range track by $index" class="sr-only">({{ $index < value ? \'*\' : \' \' }})</span>\n    <i ng-repeat-end ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="glyphicon" ng-class="$index < value && (r.stateOn || \'glyphicon-star\') || (r.stateOff || \'glyphicon-star-empty\')" ng-attr-title="{{r.title}}" ></i>\n</span>\n')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tab.html",'<li ng-class="{active: active, disabled: disabled}">\n  <a href ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</li>\n')}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tabset.html",'<div>\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="tab-content">\n    <div class="tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/timepicker/timepicker.html",'<table>\n  <tbody>\n    <tr class="text-center" ng-show="::showSpinners">\n      <td><a ng-click="incrementHours()" ng-class="{disabled: noIncrementHours()}" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n      <td>&nbsp;</td>\n      <td><a ng-click="incrementMinutes()" ng-class="{disabled: noIncrementMinutes()}" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n      <td ng-show="showMeridian"></td>\n    </tr>\n    <tr>\n      <td class="form-group" ng-class="{\'has-error\': invalidHours}">\n        <input style="width:50px;" type="text" ng-model="hours" ng-change="updateHours()" class="form-control text-center" ng-readonly="::readonlyInput" maxlength="2">\n      </td>\n      <td>:</td>\n      <td class="form-group" ng-class="{\'has-error\': invalidMinutes}">\n        <input style="width:50px;" type="text" ng-model="minutes" ng-change="updateMinutes()" class="form-control text-center" ng-readonly="::readonlyInput" maxlength="2">\n      </td>\n      <td ng-show="showMeridian"><button type="button" ng-class="{disabled: noToggleMeridian()}" class="btn btn-default text-center" ng-click="toggleMeridian()">{{meridian}}</button></td>\n    </tr>\n    <tr class="text-center" ng-show="::showSpinners">\n      <td><a ng-click="decrementHours()" ng-class="{disabled: noDecrementHours()}" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n      <td>&nbsp;</td>\n      <td><a ng-click="decrementMinutes()" ng-class="{disabled: noDecrementMinutes()}" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n      <td ng-show="showMeridian"></td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-match.html",'<a href tabindex="-1" ng-bind-html="match.label | typeaheadHighlight:query"></a>\n')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-show="isOpen() && !moveInProgress" ng-style="{top: position().top+\'px\', left: position().left+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">\n    <li ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{::match.id}}">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>\n')}]),!angular.$$csp()&&angular.element(document).find("head").prepend('<style type="text/css">.ng-animate.item:not(.left):not(.right){-webkit-transition:0s ease-in-out left;transition:0s ease-in-out left}</style>'),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.satellizer=factory()}(this,function(){"use strict";function joinUrl(baseUrl,url){if(/^(?:[a-z]+:)?\/\//i.test(url))return url;var joined=[baseUrl,url].join("/");return function(str){return str.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}(joined)}function getFullUrlPath(location){var isHttps="https:"===location.protocol;return location.protocol+"//"+location.hostname+":"+(location.port||(isHttps?"443":"80"))+(/^\//.test(location.pathname)?location.pathname:"/"+location.pathname)}function parseQueryString(str){var key,value,obj={};return angular.forEach((str||"").split("&"),function(keyValue){keyValue&&(value=keyValue.split("="),key=decodeURIComponent(value[0]),obj[key]=!angular.isDefined(value[1])||decodeURIComponent(value[1]))}),obj}function decodeBase64(str){var buffer;if("undefined"!=typeof module&&module.exports)try{buffer=require("buffer").Buffer}catch(err){}var fromCharCode=String.fromCharCode,re_btou=new RegExp(["[-][-]","[-][-]{2}","[-][-]{3}"].join("|"),"g"),cb_btou=function(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return fromCharCode(55296+(offset>>>10))+fromCharCode(56320+(1023&offset));case 3:return fromCharCode((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}},btou=function(b){return b.replace(re_btou,cb_btou)};return(buffer?function(a){return(a.constructor===buffer.constructor?a:new buffer(a,"base64")).toString()}:function(a){return btou(atob(a))})(String(str).replace(/[-_]/g,function(m0){return"-"===m0?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}var Config=function(){function Config(){this.baseUrl="/",this.loginUrl="/auth/login",this.signupUrl="/auth/signup",this.unlinkUrl="/auth/unlink/",this.tokenName="token",this.tokenPrefix="satellizer",this.tokenHeader="Authorization",this.tokenType="Bearer",this.storageType="localStorage",this.tokenRoot=null,this.withCredentials=!1,this.providers={facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin,requiredUrlParams:["scope"],optionalUrlParams:["display","state"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:window.location.origin,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:window.location.origin,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:window.location.origin,requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin,oauthType:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",redirectUri:window.location.origin,requiredUrlParams:["scope"],scope:["user_read"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:window.location.origin,requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",redirectUri:window.location.origin,scope:[],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:559,height:519}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:window.location.origin+"/",requiredUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1028,height:529}},spotify:{name:"spotify",url:"/auth/spotify",authorizationEndpoint:"https://accounts.spotify.com/authorize",redirectUri:window.location.origin,optionalUrlParams:["state"],requiredUrlParams:["scope"],scope:["user-read-email"],scopePrefix:"",scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:500,height:530},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}}},this.httpInterceptor=function(){return!0}}return Object.defineProperty(Config,"getConstant",{get:function(){return new Config},enumerable:!0,configurable:!0}),Config}(),AuthProvider=function(){function AuthProvider(SatellizerConfig){this.SatellizerConfig=SatellizerConfig}return Object.defineProperty(AuthProvider.prototype,"baseUrl",{get:function(){return this.SatellizerConfig.baseUrl},set:function(value){this.SatellizerConfig.baseUrl=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"loginUrl",{get:function(){return this.SatellizerConfig.loginUrl},set:function(value){this.SatellizerConfig.loginUrl=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"signupUrl",{get:function(){return this.SatellizerConfig.signupUrl},set:function(value){this.SatellizerConfig.signupUrl=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"unlinkUrl",{get:function(){return this.SatellizerConfig.unlinkUrl},set:function(value){this.SatellizerConfig.unlinkUrl=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"tokenRoot",{get:function(){return this.SatellizerConfig.tokenRoot},set:function(value){this.SatellizerConfig.tokenRoot=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"tokenName",{get:function(){return this.SatellizerConfig.tokenName},set:function(value){this.SatellizerConfig.tokenName=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"tokenPrefix",{get:function(){return this.SatellizerConfig.tokenPrefix},set:function(value){this.SatellizerConfig.tokenPrefix=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"tokenHeader",{get:function(){return this.SatellizerConfig.tokenHeader},set:function(value){this.SatellizerConfig.tokenHeader=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"tokenType",{get:function(){return this.SatellizerConfig.tokenType},set:function(value){this.SatellizerConfig.tokenType=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"withCredentials",{get:function(){return this.SatellizerConfig.withCredentials},set:function(value){this.SatellizerConfig.withCredentials=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"storageType",{get:function(){return this.SatellizerConfig.storageType},set:function(value){this.SatellizerConfig.storageType=value},enumerable:!0,configurable:!0}),Object.defineProperty(AuthProvider.prototype,"httpInterceptor",{get:function(){return this.SatellizerConfig.httpInterceptor},set:function(value){this.SatellizerConfig.httpInterceptor="function"==typeof value?value:function(){return value}},enumerable:!0,configurable:!0}),AuthProvider.prototype.facebook=function(options){angular.extend(this.SatellizerConfig.providers.facebook,options)},AuthProvider.prototype.google=function(options){angular.extend(this.SatellizerConfig.providers.google,options)},AuthProvider.prototype.github=function(options){angular.extend(this.SatellizerConfig.providers.github,options)},AuthProvider.prototype.instagram=function(options){angular.extend(this.SatellizerConfig.providers.instagram,options)},AuthProvider.prototype.linkedin=function(options){angular.extend(this.SatellizerConfig.providers.linkedin,options)},AuthProvider.prototype.twitter=function(options){angular.extend(this.SatellizerConfig.providers.twitter,options)},AuthProvider.prototype.twitch=function(options){angular.extend(this.SatellizerConfig.providers.twitch,options)},AuthProvider.prototype.live=function(options){angular.extend(this.SatellizerConfig.providers.live,options)},AuthProvider.prototype.yahoo=function(options){angular.extend(this.SatellizerConfig.providers.yahoo,options)},AuthProvider.prototype.bitbucket=function(options){angular.extend(this.SatellizerConfig.providers.bitbucket,options)},AuthProvider.prototype.spotify=function(options){angular.extend(this.SatellizerConfig.providers.spotify,options)},AuthProvider.prototype.oauth1=function(options){this.SatellizerConfig.providers[options.name]=angular.extend(options,{oauthType:"1.0"})},AuthProvider.prototype.oauth2=function(options){this.SatellizerConfig.providers[options.name]=angular.extend(options,{oauthType:"2.0"})},AuthProvider.prototype.$get=function(SatellizerShared,SatellizerLocal,SatellizerOAuth){return{login:function(user,options){return SatellizerLocal.login(user,options)},signup:function(user,options){return SatellizerLocal.signup(user,options)},logout:function(){return SatellizerShared.logout()},authenticate:function(name,data){return SatellizerOAuth.authenticate(name,data)},link:function(name,data){return SatellizerOAuth.authenticate(name,data)},unlink:function(name,options){return SatellizerOAuth.unlink(name,options)},isAuthenticated:function(){return SatellizerShared.isAuthenticated()},getPayload:function(){return SatellizerShared.getPayload()},getToken:function(){return SatellizerShared.getToken()},setToken:function(token){return SatellizerShared.setToken({access_token:token})},removeToken:function(){return SatellizerShared.removeToken()},setStorageType:function(type){return SatellizerShared.setStorageType(type)}}},AuthProvider.$inject=["SatellizerConfig"],AuthProvider}();AuthProvider.prototype.$get.$inject=["SatellizerShared","SatellizerLocal","SatellizerOAuth"];var Shared=function(){function Shared($q,$window,SatellizerConfig,SatellizerStorage){this.$q=$q,this.$window=$window,this.SatellizerConfig=SatellizerConfig,this.SatellizerStorage=SatellizerStorage;var _a=this.SatellizerConfig,tokenName=_a.tokenName,tokenPrefix=_a.tokenPrefix;this.prefixedTokenName=tokenPrefix?[tokenPrefix,tokenName].join("_"):tokenName}return Shared.prototype.getToken=function(){return this.SatellizerStorage.get(this.prefixedTokenName)},Shared.prototype.getPayload=function(){var token=this.SatellizerStorage.get(this.prefixedTokenName);if(token&&3===token.split(".").length)try{var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return JSON.parse(decodeBase64(base64))}catch(e){}},Shared.prototype.setToken=function(response){var token,tokenRoot=this.SatellizerConfig.tokenRoot,tokenName=this.SatellizerConfig.tokenName,accessToken=response&&response.access_token;if(accessToken&&(angular.isObject(accessToken)&&angular.isObject(accessToken.data)?response=accessToken:angular.isString(accessToken)&&(token=accessToken)),!token&&response){var tokenRootData=tokenRoot&&tokenRoot.split(".").reduce(function(o,x){return o[x]},response.data);token=tokenRootData?tokenRootData[tokenName]:response.data&&response.data[tokenName]}token&&this.SatellizerStorage.set(this.prefixedTokenName,token)},Shared.prototype.removeToken=function(){this.SatellizerStorage.remove(this.prefixedTokenName)},Shared.prototype.isAuthenticated=function(){var token=this.SatellizerStorage.get(this.prefixedTokenName);if(token){if(3===token.split(".").length)try{var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/"),exp=JSON.parse(this.$window.atob(base64)).exp;if("number"==typeof exp)return Math.round((new Date).getTime()/1e3)<exp}catch(e){return!0}return!0}return!1},Shared.prototype.logout=function(){return this.SatellizerStorage.remove(this.prefixedTokenName),this.$q.when()},Shared.prototype.setStorageType=function(type){this.SatellizerConfig.storageType=type},Shared.$inject=["$q","$window","SatellizerConfig","SatellizerStorage"],Shared}(),Local=function(){function Local($http,SatellizerConfig,SatellizerShared){this.$http=$http,this.SatellizerConfig=SatellizerConfig,this.SatellizerShared=SatellizerShared}return Local.prototype.login=function(user,options){var _this=this;return void 0===options&&(options={}),options.url=options.url?options.url:joinUrl(this.SatellizerConfig.baseUrl,this.SatellizerConfig.loginUrl),options.data=user||options.data,options.method=options.method||"POST",options.withCredentials=options.withCredentials||this.SatellizerConfig.withCredentials,this.$http(options).then(function(response){return _this.SatellizerShared.setToken(response),response})},Local.prototype.signup=function(user,options){return void 0===options&&(options={}),options.url=options.url?options.url:joinUrl(this.SatellizerConfig.baseUrl,this.SatellizerConfig.signupUrl),options.data=user||options.data,options.method=options.method||"POST",options.withCredentials=options.withCredentials||this.SatellizerConfig.withCredentials,this.$http(options)},Local.$inject=["$http","SatellizerConfig","SatellizerShared"],Local}(),Popup=function(){function Popup($interval,$window,$q){this.$interval=$interval,this.$window=$window,this.$q=$q,this.popup=null,this.defaults={redirectUri:null}}return Popup.prototype.stringifyOptions=function(options){var parts=[];return angular.forEach(options,function(value,key){parts.push(key+"="+value)}),parts.join(",")},Popup.prototype.open=function(url,name,popupOptions,redirectUri,dontPoll){var width=popupOptions.width||500,height=popupOptions.height||500,options=this.stringifyOptions({width:width,height:height,top:this.$window.screenY+(this.$window.outerHeight-height)/2.5,left:this.$window.screenX+(this.$window.outerWidth-width)/2}),popupName=this.$window.cordova||this.$window.navigator.userAgent.indexOf("CriOS")>-1?"_blank":name;if(this.popup=this.$window.open(url,popupName,options),this.popup&&this.popup.focus&&this.popup.focus(),!dontPoll)return this.$window.cordova?this.eventListener(redirectUri):("about:blank"===url&&(this.popup.location=url),this.polling(redirectUri))},Popup.prototype.polling=function(redirectUri){var _this=this;return this.$q(function(resolve,reject){var redirectUriParser=document.createElement("a");redirectUriParser.href=redirectUri;var redirectUriPath=getFullUrlPath(redirectUriParser),polling=_this.$interval(function(){_this.popup&&!_this.popup.closed&&void 0!==_this.popup.closed||(_this.$interval.cancel(polling),reject(new Error("The popup window was closed")));try{if(getFullUrlPath(_this.popup.location)===redirectUriPath){if(_this.popup.location.search||_this.popup.location.hash){var query=parseQueryString(_this.popup.location.search.substring(1).replace(/\/$/,"")),hash=parseQueryString(_this.popup.location.hash.substring(1).replace(/[\/$]/,"")),params=angular.extend({},query,hash);params.error?reject(new Error(params.error)):resolve(params)}else reject(new Error("OAuth redirect has occurred but no query or hash parameters were found. They were either not set during the redirect, or were removedtypically by a routing librarybefore Satellizer could read it."));_this.$interval.cancel(polling),_this.popup.close()}}catch(error){}},500)})},Popup.prototype.eventListener=function(redirectUri){var _this=this;return this.$q(function(resolve,reject){_this.popup.addEventListener("loadstart",function(event){if(0===event.url.indexOf(redirectUri)){var parser=document.createElement("a");if(parser.href=event.url,parser.search||parser.hash){var query=parseQueryString(parser.search.substring(1).replace(/\/$/,"")),hash=parseQueryString(parser.hash.substring(1).replace(/[\/$]/,"")),params=angular.extend({},query,hash);params.error?reject(new Error(params.error)):resolve(params),_this.popup.close()}}}),_this.popup.addEventListener("loaderror",function(){reject(new Error("Authorization failed"))}),_this.popup.addEventListener("exit",function(){reject(new Error("The popup window was closed"))})})},Popup.$inject=["$interval","$window","$q"],Popup}(),OAuth1=function(){function OAuth1($http,$window,SatellizerConfig,SatellizerPopup){this.$http=$http,this.$window=$window,this.SatellizerConfig=SatellizerConfig,this.SatellizerPopup=SatellizerPopup,this.defaults={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{width:null,height:null}}}return OAuth1.prototype.init=function(options,userData){var _this=this;angular.extend(this.defaults,options);var name=options.name,popupOptions=options.popupOptions,redirectUri=this.defaults.redirectUri;return this.$window.cordova||this.SatellizerPopup.open("about:blank",name,popupOptions,redirectUri,!0),this.getRequestToken().then(function(response){return _this.openPopup(options,response).then(function(popupResponse){return _this.exchangeForToken(popupResponse,userData)})})},OAuth1.prototype.openPopup=function(options,response){var url=[options.authorizationEndpoint,this.buildQueryString(response.data)].join("?"),redirectUri=this.defaults.redirectUri;return this.$window.cordova?this.SatellizerPopup.open(url,options.name,options.popupOptions,redirectUri):(this.SatellizerPopup.popup.location=url,this.SatellizerPopup.polling(redirectUri))},OAuth1.prototype.getRequestToken=function(){var url=this.SatellizerConfig.baseUrl?joinUrl(this.SatellizerConfig.baseUrl,this.defaults.url):this.defaults.url;return this.$http.post(url,this.defaults)},OAuth1.prototype.exchangeForToken=function(oauthData,userData){var payload=angular.extend({},userData,oauthData),exchangeForTokenUrl=this.SatellizerConfig.baseUrl?joinUrl(this.SatellizerConfig.baseUrl,this.defaults.url):this.defaults.url;return this.$http.post(exchangeForTokenUrl,payload,{withCredentials:this.SatellizerConfig.withCredentials})},OAuth1.prototype.buildQueryString=function(obj){var str=[];return angular.forEach(obj,function(value,key){str.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}),str.join("&")},OAuth1.$inject=["$http","$window","SatellizerConfig","SatellizerPopup"],OAuth1}(),OAuth2=function(){function OAuth2($http,$window,$timeout,$q,SatellizerConfig,SatellizerPopup,SatellizerStorage){this.$http=$http,this.$window=$window,this.$timeout=$timeout,this.$q=$q,this.SatellizerConfig=SatellizerConfig,this.SatellizerPopup=SatellizerPopup,this.SatellizerStorage=SatellizerStorage,this.defaults={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{width:null,height:null}}}return OAuth2.camelCase=function(name){return name.replace(/([\:\-\_]+(.))/g,function(_,separator,letter,offset){return offset?letter.toUpperCase():letter})},OAuth2.prototype.init=function(options,userData){var _this=this;return this.$q(function(resolve,reject){angular.extend(_this.defaults,options);var stateName=_this.defaults.name+"_state",_a=_this.defaults,name=_a.name,state=_a.state,popupOptions=_a.popupOptions,redirectUri=_a.redirectUri,responseType=_a.responseType;"function"==typeof state?_this.SatellizerStorage.set(stateName,state()):"string"==typeof state&&_this.SatellizerStorage.set(stateName,state);var url=[_this.defaults.authorizationEndpoint,_this.buildQueryString()].join("?");_this.SatellizerPopup.open(url,name,popupOptions,redirectUri).then(function(oauth){return"token"!==responseType&&url?oauth.state&&oauth.state!==_this.SatellizerStorage.get(stateName)?reject(new Error("The value returned in the state parameter does not match the state value from your original authorization code request.")):void resolve(_this.exchangeForToken(oauth,userData)):resolve(oauth)}).catch(function(error){return reject(error)})})},OAuth2.prototype.exchangeForToken=function(oauthData,userData){var _this=this,payload=angular.extend({},userData);angular.forEach(this.defaults.responseParams,function(value,key){switch(key){case"code":payload[value]=oauthData.code;break;case"clientId":payload[value]=_this.defaults.clientId;break;case"redirectUri":payload[value]=_this.defaults.redirectUri;break;default:payload[value]=oauthData[key]}}),oauthData.state&&(payload.state=oauthData.state);var exchangeForTokenUrl=this.SatellizerConfig.baseUrl?joinUrl(this.SatellizerConfig.baseUrl,this.defaults.url):this.defaults.url;return this.$http.post(exchangeForTokenUrl,payload,{withCredentials:this.SatellizerConfig.withCredentials})},OAuth2.prototype.buildQueryString=function(){var _this=this,keyValuePairs=[],urlParamsCategories=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return angular.forEach(urlParamsCategories,function(paramsCategory){angular.forEach(_this.defaults[paramsCategory],function(paramName){var camelizedName=OAuth2.camelCase(paramName),paramValue=angular.isFunction(_this.defaults[paramName])?_this.defaults[paramName]():_this.defaults[camelizedName];if("redirect_uri"!==paramName||paramValue){if("state"===paramName){var stateName=_this.defaults.name+"_state";paramValue=encodeURIComponent(_this.SatellizerStorage.get(stateName))}"scope"===paramName&&Array.isArray(paramValue)&&(paramValue=paramValue.join(_this.defaults.scopeDelimiter),_this.defaults.scopePrefix&&(paramValue=[_this.defaults.scopePrefix,paramValue].join(_this.defaults.scopeDelimiter))),keyValuePairs.push([paramName,paramValue])}})}),keyValuePairs.map(function(pair){return pair.join("=")}).join("&")},OAuth2.$inject=["$http","$window","$timeout","$q","SatellizerConfig","SatellizerPopup","SatellizerStorage"],OAuth2}(),OAuth=function(){function OAuth($http,$window,$timeout,$q,SatellizerConfig,SatellizerPopup,SatellizerStorage,SatellizerShared,SatellizerOAuth1,SatellizerOAuth2){this.$http=$http,this.$window=$window,this.$timeout=$timeout,this.$q=$q,this.SatellizerConfig=SatellizerConfig,this.SatellizerPopup=SatellizerPopup,this.SatellizerStorage=SatellizerStorage,this.SatellizerShared=SatellizerShared,this.SatellizerOAuth1=SatellizerOAuth1,this.SatellizerOAuth2=SatellizerOAuth2}return OAuth.prototype.authenticate=function(name,userData){var _this=this;return this.$q(function(resolve,reject){var provider=_this.SatellizerConfig.providers[name],oauth=null;switch(provider.oauthType){case"1.0":oauth=new OAuth1(_this.$http,_this.$window,_this.SatellizerConfig,_this.SatellizerPopup);break;case"2.0":oauth=new OAuth2(_this.$http,_this.$window,_this.$timeout,_this.$q,_this.SatellizerConfig,_this.SatellizerPopup,_this.SatellizerStorage);break;default:return reject(new Error("Invalid OAuth Type"))}return oauth.init(provider,userData).then(function(response){provider.url&&_this.SatellizerShared.setToken(response),resolve(response)}).catch(function(error){reject(error)})})},OAuth.prototype.unlink=function(provider,httpOptions){return void 0===httpOptions&&(httpOptions={}),httpOptions.url=httpOptions.url?httpOptions.url:joinUrl(this.SatellizerConfig.baseUrl,this.SatellizerConfig.unlinkUrl),httpOptions.data={provider:provider}||httpOptions.data,httpOptions.method=httpOptions.method||"POST",httpOptions.withCredentials=httpOptions.withCredentials||this.SatellizerConfig.withCredentials,this.$http(httpOptions)},OAuth.$inject=["$http","$window","$timeout","$q","SatellizerConfig","SatellizerPopup","SatellizerStorage","SatellizerShared","SatellizerOAuth1","SatellizerOAuth2"],OAuth}(),Storage=function(){function Storage($window,SatellizerConfig){this.$window=$window,this.SatellizerConfig=SatellizerConfig,this.memoryStore={}}return Storage.prototype.get=function(key){try{return this.$window[this.SatellizerConfig.storageType].getItem(key)}catch(e){return this.memoryStore[key]}},Storage.prototype.set=function(key,value){try{this.$window[this.SatellizerConfig.storageType].setItem(key,value)}catch(e){this.memoryStore[key]=value}},Storage.prototype.remove=function(key){try{this.$window[this.SatellizerConfig.storageType].removeItem(key)}catch(e){delete this.memoryStore[key]}},Storage.$inject=["$window","SatellizerConfig"],Storage}(),Interceptor=function(){function Interceptor(SatellizerConfig,SatellizerShared,SatellizerStorage){var _this=this;this.SatellizerConfig=SatellizerConfig,this.SatellizerShared=SatellizerShared,this.SatellizerStorage=SatellizerStorage,this.request=function(config){if(config.skipAuthorization)return config;if(_this.SatellizerShared.isAuthenticated()&&_this.SatellizerConfig.httpInterceptor()){var tokenName=_this.SatellizerConfig.tokenPrefix?[_this.SatellizerConfig.tokenPrefix,_this.SatellizerConfig.tokenName].join("_"):_this.SatellizerConfig.tokenName,token=_this.SatellizerStorage.get(tokenName);_this.SatellizerConfig.tokenHeader&&_this.SatellizerConfig.tokenType&&(token=_this.SatellizerConfig.tokenType+" "+token),config.headers[_this.SatellizerConfig.tokenHeader]=token}return config}}return Interceptor.Factory=function(SatellizerConfig,SatellizerShared,SatellizerStorage){return new Interceptor(SatellizerConfig,SatellizerShared,SatellizerStorage)},Interceptor.$inject=["SatellizerConfig","SatellizerShared","SatellizerStorage"],Interceptor}();Interceptor.Factory.$inject=["SatellizerConfig","SatellizerShared","SatellizerStorage"];var HttpProviderConfig=function(){function HttpProviderConfig($httpProvider){this.$httpProvider=$httpProvider,$httpProvider.interceptors.push(Interceptor.Factory)}return HttpProviderConfig.$inject=["$httpProvider"],HttpProviderConfig}();angular.module("satellizer",[]).provider("$auth",["SatellizerConfig",function(SatellizerConfig){return new AuthProvider(SatellizerConfig)}]).constant("SatellizerConfig",Config.getConstant).service("SatellizerShared",Shared).service("SatellizerLocal",Local).service("SatellizerPopup",Popup).service("SatellizerOAuth",OAuth).service("SatellizerOAuth2",OAuth2).service("SatellizerOAuth1",OAuth1).service("SatellizerStorage",Storage).service("SatellizerInterceptor",Interceptor).config(["$httpProvider",function($httpProvider){return new HttpProviderConfig($httpProvider)}]);return"satellizer"});var duScrollDefaultEasing=function(x){"use strict";return x<.5?Math.pow(2*x,2)/2:1-Math.pow(2*(1-x),2)/2},duScroll=angular.module("duScroll",["duScroll.scrollspy","duScroll.smoothScroll","duScroll.scrollContainer","duScroll.spyContext","duScroll.scrollHelpers"]).value("duScrollDuration",350).value("duScrollSpyWait",100).value("duScrollSpyRefreshInterval",0).value("duScrollGreedy",!1).value("duScrollOffset",0).value("duScrollEasing",duScrollDefaultEasing).value("duScrollCancelOnEvents","scroll mousedown mousewheel touchmove keydown").value("duScrollBottomSpy",!1).value("duScrollActiveClass","active");"undefined"!=typeof module&&module&&module.exports&&(module.exports=duScroll),angular.module("duScroll.scrollHelpers",["duScroll.requestAnimation"]).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset","duScrollCancelOnEvents",function($window,$q,cancelAnimation,requestAnimation,duScrollEasing,duScrollDuration,duScrollOffset,duScrollCancelOnEvents){"use strict";var proto={},isDocument=function(el){return"undefined"!=typeof HTMLDocument&&el instanceof HTMLDocument||el.nodeType&&el.nodeType===el.DOCUMENT_NODE},isElement=function(el){return"undefined"!=typeof HTMLElement&&el instanceof HTMLElement||el.nodeType&&el.nodeType===el.ELEMENT_NODE},unwrap=function(el){return isElement(el)||isDocument(el)?el:el[0]};proto.duScrollTo=function(left,top,duration,easing){var aliasFn;if(angular.isElement(left)?aliasFn=this.duScrollToElement:angular.isDefined(duration)&&(aliasFn=this.duScrollToAnimated),aliasFn)return aliasFn.apply(this,arguments);var el=unwrap(this);if(isDocument(el))return $window.scrollTo(left,top);el.scrollLeft=left,el.scrollTop=top};var scrollAnimation,deferred;proto.duScrollToAnimated=function(left,top,duration,easing){duration&&!easing&&(easing=duScrollEasing);var startLeft=this.duScrollLeft(),startTop=this.duScrollTop(),deltaLeft=Math.round(left-startLeft),deltaTop=Math.round(top-startTop),startTime=null,progress=0,el=this,cancelScrollAnimation=function($event){(!$event||progress&&$event.which>0)&&(duScrollCancelOnEvents&&el.unbind(duScrollCancelOnEvents,cancelScrollAnimation),cancelAnimation(scrollAnimation),deferred.reject(),scrollAnimation=null)};if(scrollAnimation&&cancelScrollAnimation(),deferred=$q.defer(),0===duration||!deltaLeft&&!deltaTop)return 0===duration&&el.duScrollTo(left,top),deferred.resolve(),deferred.promise;var animationStep=function(timestamp){null===startTime&&(startTime=timestamp),progress=timestamp-startTime;var percent=progress>=duration?1:easing(progress/duration);el.scrollTo(startLeft+Math.ceil(deltaLeft*percent),startTop+Math.ceil(deltaTop*percent)),percent<1?scrollAnimation=requestAnimation(animationStep):(duScrollCancelOnEvents&&el.unbind(duScrollCancelOnEvents,cancelScrollAnimation),scrollAnimation=null,deferred.resolve())};return el.duScrollTo(startLeft,startTop),duScrollCancelOnEvents&&el.bind(duScrollCancelOnEvents,cancelScrollAnimation),scrollAnimation=requestAnimation(animationStep),deferred.promise},proto.duScrollToElement=function(target,offset,duration,easing){var el=unwrap(this);angular.isNumber(offset)&&!isNaN(offset)||(offset=duScrollOffset);var top=this.duScrollTop()+unwrap(target).getBoundingClientRect().top-offset;return isElement(el)&&(top-=el.getBoundingClientRect().top),this.duScrollTo(0,top,duration,easing)},proto.duScrollLeft=function(value,duration,easing){if(angular.isNumber(value))return this.duScrollTo(value,this.duScrollTop(),duration,easing);var el=unwrap(this);return isDocument(el)?$window.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft:el.scrollLeft},proto.duScrollTop=function(value,duration,easing){if(angular.isNumber(value))return this.duScrollTo(this.duScrollLeft(),value,duration,easing);var el=unwrap(this);return isDocument(el)?$window.scrollY||document.documentElement.scrollTop||document.body.scrollTop:el.scrollTop},proto.duScrollToElementAnimated=function(target,offset,duration,easing){return this.duScrollToElement(target,offset,duration||duScrollDuration,easing)},proto.duScrollTopAnimated=function(top,duration,easing){return this.duScrollTop(top,duration||duScrollDuration,easing)},proto.duScrollLeftAnimated=function(left,duration,easing){return this.duScrollLeft(left,duration||duScrollDuration,easing)},angular.forEach(proto,function(fn,key){angular.element.prototype[key]=fn;var unprefixed=key.replace(/^duScroll/,"scroll");angular.isUndefined(angular.element.prototype[unprefixed])&&(angular.element.prototype[unprefixed]=fn)})}]),angular.module("duScroll.polyfill",[]).factory("polyfill",["$window",function($window){"use strict";var vendors=["webkit","moz","o","ms"];return function(fnName,fallback){if($window[fnName])return $window[fnName];for(var key,suffix=fnName.substr(0,1).toUpperCase()+fnName.substr(1),i=0;i<vendors.length;i++)if(key=vendors[i]+suffix,$window[key])return $window[key];return fallback}}]),angular.module("duScroll.requestAnimation",["duScroll.polyfill"]).factory("requestAnimation",["polyfill","$timeout",function(polyfill,$timeout){"use strict";var lastTime=0;return polyfill("requestAnimationFrame",function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=$timeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id})}]).factory("cancelAnimation",["polyfill","$timeout",function(polyfill,$timeout){"use strict";return polyfill("cancelAnimationFrame",function(promise){$timeout.cancel(promise)})}]),angular.module("duScroll.spyAPI",["duScroll.scrollContainerAPI"]).factory("spyAPI",["$rootScope","$timeout","$interval","$window","$document","scrollContainerAPI","duScrollGreedy","duScrollSpyWait","duScrollSpyRefreshInterval","duScrollBottomSpy","duScrollActiveClass",function($rootScope,$timeout,$interval,$window,$document,scrollContainerAPI,duScrollGreedy,duScrollSpyWait,duScrollSpyRefreshInterval,duScrollBottomSpy,duScrollActiveClass){"use strict";var createScrollHandler=function(context){var timer=!1,queued=!1,handler=function(){queued=!1;var bottomReached,container=context.container,containerEl=container[0],containerOffset=0;if("undefined"!=typeof HTMLElement&&containerEl instanceof HTMLElement||containerEl.nodeType&&containerEl.nodeType===containerEl.ELEMENT_NODE)containerOffset=containerEl.getBoundingClientRect().top,bottomReached=Math.round(containerEl.scrollTop+containerEl.clientHeight)>=containerEl.scrollHeight;else{var documentScrollHeight=$document[0].body.scrollHeight||$document[0].documentElement.scrollHeight;bottomReached=Math.round($window.pageYOffset+$window.innerHeight)>=documentScrollHeight}var i,currentlyActive,toBeActive,spies,spy,pos,compareProperty=duScrollBottomSpy&&bottomReached?"bottom":"top";for(spies=context.spies,currentlyActive=context.currentlyActive,toBeActive=void 0,i=0;i<spies.length;i++)spy=spies[i],(pos=spy.getTargetPosition())&&spy.$element&&(duScrollBottomSpy&&bottomReached||pos.top+spy.offset-containerOffset<20&&(duScrollGreedy||-1*pos.top+containerOffset)<pos.height)&&(!toBeActive||toBeActive[compareProperty]<pos[compareProperty])&&(toBeActive={spy:spy},toBeActive[compareProperty]=pos[compareProperty]);toBeActive&&(toBeActive=toBeActive.spy),currentlyActive===toBeActive||duScrollGreedy&&!toBeActive||(currentlyActive&&currentlyActive.$element&&(currentlyActive.$element.removeClass(duScrollActiveClass),$rootScope.$broadcast("duScrollspy:becameInactive",currentlyActive.$element,angular.element(currentlyActive.getTargetElement()))),toBeActive&&(toBeActive.$element.addClass(duScrollActiveClass),$rootScope.$broadcast("duScrollspy:becameActive",toBeActive.$element,angular.element(toBeActive.getTargetElement()))),context.currentlyActive=toBeActive)};return duScrollSpyWait?function(){timer?queued=!0:(handler(),timer=$timeout(function(){timer=!1,queued&&handler()},duScrollSpyWait,!1))}:handler},contexts={},createContext=function($scope){var id=$scope.$id,context={spies:[]};return context.handler=createScrollHandler(context),contexts[id]=context,$scope.$on("$destroy",function(){destroyContext($scope)}),id},destroyContext=function($scope){var id=$scope.$id,context=contexts[id],container=context.container;context.intervalPromise&&$interval.cancel(context.intervalPromise),container&&container.off("scroll",context.handler),delete contexts[id]},defaultContextId=createContext($rootScope),getContextForScope=function(scope){return contexts[scope.$id]?contexts[scope.$id]:scope.$parent?getContextForScope(scope.$parent):contexts[defaultContextId]},getContextForSpy=function(spy){var context,contextId,scope=spy.$scope;if(scope)return getContextForScope(scope);for(contextId in contexts)if(context=contexts[contextId],-1!==context.spies.indexOf(spy))return context},isElementInDocument=function(element){for(;element.parentNode;)if((element=element.parentNode)===document)return!0;return!1};return{addSpy:function(spy){var context=getContextForSpy(spy);context&&(context.spies.push(spy),context.container&&isElementInDocument(context.container)||(context.container&&context.container.off("scroll",context.handler),context.container=scrollContainerAPI.getContainer(spy.$scope),duScrollSpyRefreshInterval&&!context.intervalPromise&&(context.intervalPromise=$interval(context.handler,duScrollSpyRefreshInterval,0,!1)),context.container.on("scroll",context.handler).triggerHandler("scroll")))},removeSpy:function(spy){var context=getContextForSpy(spy);spy===context.currentlyActive&&($rootScope.$broadcast("duScrollspy:becameInactive",context.currentlyActive.$element),context.currentlyActive=null);var i=context.spies.indexOf(spy);-1!==i&&context.spies.splice(i,1),spy.$element=null},createContext:createContext,destroyContext:destroyContext,getContextForScope:getContextForScope}}]),angular.module("duScroll.scrollContainerAPI",[]).factory("scrollContainerAPI",["$document",function($document){"use strict";var containers={},setContainer=function(scope,element){var id=scope.$id;return containers[id]=element,id},getContainerId=function(scope){return containers[scope.$id]?scope.$id:scope.$parent?getContainerId(scope.$parent):void 0};return{getContainerId:getContainerId,getContainer:function(scope){var id=getContainerId(scope);return id?containers[id]:$document},setContainer:setContainer,removeContainer:function(scope){var id=getContainerId(scope);id&&delete containers[id]}}}]),angular.module("duScroll.smoothScroll",["duScroll.scrollHelpers","duScroll.scrollContainerAPI"]).directive("duSmoothScroll",["duScrollDuration","duScrollOffset","scrollContainerAPI",function(duScrollDuration,duScrollOffset,scrollContainerAPI){"use strict";return{link:function($scope,$element,$attr){$element.on("click",function(e){if($attr.href&&-1!==$attr.href.indexOf("#")||""!==$attr.duSmoothScroll){var id=$attr.href?$attr.href.replace(/.*(?=#[^\s]+$)/,"").substring(1):$attr.duSmoothScroll,target=document.getElementById(id)||document.getElementsByName(id)[0];if(target&&target.getBoundingClientRect){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var offset=$attr.offset?parseInt($attr.offset,10):duScrollOffset,duration=$attr.duration?parseInt($attr.duration,10):duScrollDuration;scrollContainerAPI.getContainer($scope).duScrollToElement(angular.element(target),isNaN(offset)?0:offset,isNaN(duration)?0:duration)}}})}}}]),angular.module("duScroll.spyContext",["duScroll.spyAPI"]).directive("duSpyContext",["spyAPI",function(spyAPI){"use strict";return{restrict:"A",scope:!0,compile:function(tElement,tAttrs,transclude){return{pre:function($scope,iElement,iAttrs,controller){spyAPI.createContext($scope)}}}}}]),angular.module("duScroll.scrollContainer",["duScroll.scrollContainerAPI"]).directive("duScrollContainer",["scrollContainerAPI",function(scrollContainerAPI){"use strict";return{restrict:"A",scope:!0,compile:function(tElement,tAttrs,transclude){return{pre:function($scope,iElement,iAttrs,controller){iAttrs.$observe("duScrollContainer",function(element){angular.isString(element)&&(element=document.getElementById(element)),element=angular.isElement(element)?angular.element(element):iElement,scrollContainerAPI.setContainer($scope,element),$scope.$on("$destroy",function(){scrollContainerAPI.removeContainer($scope)})})}}}}}]),angular.module("duScroll.scrollspy",["duScroll.spyAPI"]).directive("duScrollspy",["spyAPI","duScrollOffset","$timeout","$rootScope",function(spyAPI,duScrollOffset,$timeout,$rootScope){"use strict";var Spy=function(targetElementOrId,$scope,$element,offset){angular.isElement(targetElementOrId)?this.target=targetElementOrId:angular.isString(targetElementOrId)&&(this.targetId=targetElementOrId),this.$scope=$scope,this.$element=$element,this.offset=offset};return Spy.prototype.getTargetElement=function(){return!this.target&&this.targetId&&(this.target=document.getElementById(this.targetId)||document.getElementsByName(this.targetId)[0]),this.target},Spy.prototype.getTargetPosition=function(){var target=this.getTargetElement();if(target)return target.getBoundingClientRect()},Spy.prototype.flushTargetCache=function(){this.targetId&&(this.target=void 0)},{link:function($scope,$element,$attr){var targetId,href=$attr.ngHref||$attr.href;if(href&&-1!==href.indexOf("#")?targetId=href.replace(/.*(?=#[^\s]+$)/,"").substring(1):$attr.duScrollspy?targetId=$attr.duScrollspy:$attr.duSmoothScroll&&(targetId=$attr.duSmoothScroll),targetId){var timeoutPromise=$timeout(function(){var spy=new Spy(targetId,$scope,$element,-($attr.offset?parseInt($attr.offset,10):duScrollOffset));spyAPI.addSpy(spy),$scope.$on("$locationChangeSuccess",spy.flushTargetCache.bind(spy));var deregisterOnStateChange=$rootScope.$on("$stateChangeSuccess",spy.flushTargetCache.bind(spy));$scope.$on("$destroy",function(){spyAPI.removeSpy(spy),deregisterOnStateChange()})},0,!1);$scope.$on("$destroy",function(){$timeout.cancel(timeoutPromise)})}}}}]),function(factory){"use strict";"object"==typeof exports?module.exports=factory("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof Chart?Chart:require("chart.js")):"function"==typeof define&&define.amd?define(["angular","chart"],factory):factory(angular,Chart)}(function(angular,Chart){"use strict";function ChartJsProvider(){var options={},ChartJs={Chart:Chart,getOptions:function(type){var typeOptions=type&&options[type]||{};return angular.extend({},options,typeOptions)}};this.setOptions=function(type,customOptions){if(!customOptions)return customOptions=type,void(options=angular.extend(options,customOptions));options[type]=angular.extend(options[type]||{},customOptions)},this.$get=function(){return ChartJs}}function ChartJsFactory(ChartJs,$timeout){function canUpdateChart(newVal,oldVal){return!!(newVal&&oldVal&&newVal.length&&oldVal.length)&&(Array.isArray(newVal[0])?newVal.length===oldVal.length&&newVal.every(function(element,index){return element.length===oldVal[index].length}):oldVal.reduce(sum,0)>0&&newVal.length===oldVal.length)}function sum(carry,val){return carry+val}function getEventHandler(scope,chart,action,triggerOnlyOnChange){var lastState=null;return function(evt){var atEvent=chart.getPointsAtEvent||chart.getBarsAtEvent||chart.getSegmentsAtEvent;if(atEvent){var activePoints=atEvent.call(chart,evt);!1!==triggerOnlyOnChange&&!1!==angular.equals(lastState,activePoints)||(lastState=activePoints,scope[action](activePoints,evt),scope.$apply())}}}function getColours(type,scope){for(var notEnoughColours=!1,colours=angular.copy(scope.colours||ChartJs.getOptions(type).colours||Chart.defaults.global.colours);colours.length<scope.data.length;)colours.push(scope.getColour()),notEnoughColours=!0;return notEnoughColours&&(scope.colours=colours),colours.map(convertColour)}function convertColour(colour){return"object"==typeof colour&&null!==colour?colour:"string"==typeof colour&&"#"===colour[0]?getColour(hexToRgb(colour.substr(1))):getRandomColour()}function getRandomColour(){return getColour([getRandomInt(0,255),getRandomInt(0,255),getRandomInt(0,255)])}function getColour(colour){return{fillColor:rgba(colour,.2),strokeColor:rgba(colour,1),pointColor:rgba(colour,1),pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:rgba(colour,.8)}}function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}function rgba(colour,alpha){return usingExcanvas?"rgb("+colour.join(",")+")":"rgba("+colour.concat(alpha).join(",")+")"}function hexToRgb(hex){var bigint=parseInt(hex,16);return[bigint>>16&255,bigint>>8&255,255&bigint]}function getDataSets(labels,data,series,colours){return{labels:labels,datasets:data.map(function(item,i){return angular.extend({},colours[i],{label:series[i],data:item})})}}function getData(labels,data,colours){return labels.map(function(label,i){return angular.extend({},colours[i],{label:label,value:data[i],color:colours[i].strokeColor,highlight:colours[i].pointHighlightStroke})})}function setLegend(elem,chart){var $parent=elem.parent(),$oldLegend=$parent.find("chart-legend"),legend="<chart-legend>"+chart.generateLegend()+"</chart-legend>";$oldLegend.length?$oldLegend.replaceWith(legend):$parent.append(legend)}function updateChart(chart,values,scope,elem){Array.isArray(scope.data[0])?chart.datasets.forEach(function(dataset,i){(dataset.points||dataset.bars).forEach(function(dataItem,j){dataItem.value=values[i][j]})}):chart.segments.forEach(function(segment,i){segment.value=values[i]}),chart.update(),scope.$emit("update",chart),scope.legend&&"false"!==scope.legend&&setLegend(elem,chart)}function isEmpty(value){return!value||Array.isArray(value)&&!value.length||"object"==typeof value&&!Object.keys(value).length}function isResponsive(type,scope){return angular.extend({},Chart.defaults.global,ChartJs.getOptions(type),scope.options).responsive}return function(type){return{restrict:"CA",scope:{data:"=?",labels:"=?",options:"=?",series:"=?",colours:"=?",getColour:"=?",chartType:"=",legend:"@",click:"=?",hover:"=?",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColours:"=?",chartLegend:"@",chartClick:"=?",chartHover:"=?"},link:function(scope,elem){function aliasVar(fromName,toName){scope.$watch(fromName,function(newVal){void 0!==newVal&&(scope[toName]=newVal)})}function resetChart(newVal,oldVal){if(!isEmpty(newVal)&&!angular.equals(newVal,oldVal)){var chartType=type||scope.chartType;chartType&&(chart&&chart.destroy(),createChart(chartType))}}function createChart(type){if(isResponsive(type,scope)&&0===elem[0].clientHeight&&0===container.clientHeight)return $timeout(function(){createChart(type)},50,!1);if(scope.data&&scope.data.length){scope.getColour="function"==typeof scope.getColour?scope.getColour:getRandomColour;var colours=getColours(type,scope),cvs=elem[0],ctx=cvs.getContext("2d"),data=Array.isArray(scope.data[0])?getDataSets(scope.labels,scope.data,scope.series||[],colours):getData(scope.labels,scope.data,colours),options=angular.extend({},ChartJs.getOptions(type),scope.options);chart=new ChartJs.Chart(ctx)[type](data,options),scope.$emit("create",chart),cvs.onclick=scope.click?getEventHandler(scope,chart,"click",!1):angular.noop,cvs.onmousemove=scope.hover?getEventHandler(scope,chart,"hover",!0):angular.noop,scope.legend&&"false"!==scope.legend&&setLegend(elem,chart)}}function deprecated(attr){if("undefined"!=typeof console&&"test"!==ChartJs.getOptions().env){var warn="function"==typeof console.warn?console.warn:console.log;scope[attr]&&warn.call(console,'"%s" is deprecated and will be removed in a future version. Please use "chart-%s" instead.',attr,attr)}}var chart,container=document.createElement("div");container.className="chart-container",elem.replaceWith(container),container.appendChild(elem[0]),usingExcanvas&&window.G_vmlCanvasManager.initElement(elem[0]),["data","labels","options","series","colours","legend","click","hover"].forEach(deprecated),aliasVar("chartData","data"),aliasVar("chartLabels","labels"),aliasVar("chartOptions","options"),aliasVar("chartSeries","series"),aliasVar("chartColours","colours"),aliasVar("chartLegend","legend"),aliasVar("chartClick","click"),aliasVar("chartHover","hover"),scope.$watch("data",function(newVal,oldVal){if(newVal&&newVal.length&&(!Array.isArray(newVal[0])||newVal[0].length)){var chartType=type||scope.chartType;if(chartType){if(chart){if(canUpdateChart(newVal,oldVal))return updateChart(chart,newVal,scope,elem);chart.destroy()}createChart(chartType)}}},!0),scope.$watch("series",resetChart,!0),scope.$watch("labels",resetChart,!0),scope.$watch("options",resetChart,!0),scope.$watch("colours",resetChart,!0),scope.$watch("chartType",function(newVal,oldVal){isEmpty(newVal)||angular.equals(newVal,oldVal)||(chart&&chart.destroy(),createChart(newVal))}),scope.$on("$destroy",function(){chart&&chart.destroy()})}}}}Chart.defaults.global.responsive=!0,Chart.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>",Chart.defaults.global.colours=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var usingExcanvas="object"==typeof window.G_vmlCanvasManager&&null!==window.G_vmlCanvasManager&&"function"==typeof window.G_vmlCanvasManager.initElement;return usingExcanvas&&(Chart.defaults.global.animation=!1),angular.module("chart.js",[]).provider("ChartJs",ChartJsProvider).factory("ChartJsFactory",["ChartJs","$timeout",ChartJsFactory]).directive("chartBase",["ChartJsFactory",function(ChartJsFactory){return new ChartJsFactory}]).directive("chartLine",["ChartJsFactory",function(ChartJsFactory){return new ChartJsFactory("Line")}]).directive("chartBar",["ChartJsFactory",function(ChartJsFactory){return new ChartJsFactory("Bar")}]).directive("chartRadar",["ChartJsFactory",function(ChartJsFactory){return new ChartJsFactory("Radar")}]).directive("chartDoughnut",["ChartJsFactory",function(ChartJsFactory){return new ChartJsFactory("Doughnut")}]).directive("chartPie",["ChartJsFactory",function(ChartJsFactory){return new ChartJsFactory("Pie")}]).directive("chartPolarArea",["ChartJsFactory",function(ChartJsFactory){return new ChartJsFactory("PolarArea")}])}),function(){angular.module("angular-jwt",["angular-jwt.interceptor","angular-jwt.jwt"]),angular.module("angular-jwt.interceptor",[]).provider("jwtInterceptor",function(){this.urlParam=null,this.authHeader="Authorization",this.authPrefix="Bearer ",this.tokenGetter=function(){return null};var config=this;this.$get=["$q","$injector","$rootScope",function($q,$injector,$rootScope){return{request:function(request){if(request.skipAuthorization)return request;if(config.urlParam){if(request.params=request.params||{},request.params[config.urlParam])return request}else if(request.headers=request.headers||{},request.headers[config.authHeader])return request;return $q.when($injector.invoke(config.tokenGetter,this,{config:request})).then(function(token){return token&&(config.urlParam?request.params[config.urlParam]=token:request.headers[config.authHeader]=config.authPrefix+token),request})},responseError:function(response){return 401===response.status&&$rootScope.$broadcast("unauthenticated",response),$q.reject(response)}}}]}),angular.module("angular-jwt.jwt",[]).service("jwtHelper",function(){this.urlBase64Decode=function(str){var output=str.replace(/-/g,"+").replace(/_/g,"/");switch(output.length%4){case 0:break;case 2:output+="==";break;case 3:output+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(escape(window.atob(output)))},this.decodeToken=function(token){var parts=token.split(".");if(3!==parts.length)throw new Error("JWT must have 3 parts");var decoded=this.urlBase64Decode(parts[1]);if(!decoded)throw new Error("Cannot decode the token");return JSON.parse(decoded)},this.getTokenExpirationDate=function(token){var decoded;if(decoded=this.decodeToken(token),void 0===decoded.exp)return null;var d=new Date(0);return d.setUTCSeconds(decoded.exp),d},this.isTokenExpired=function(token,offsetSeconds){var d=this.getTokenExpirationDate(token);return offsetSeconds=offsetSeconds||0,null!==d&&!(d.valueOf()>(new Date).valueOf()+1e3*offsetSeconds)}})}(),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("angular")):"function"==typeof define&&define.amd?define(["angular"],factory):"object"==typeof exports?exports.angularCacheModuleName=factory(require("angular")):root.angularCacheModuleName=factory(root.angular)}(this,function(__WEBPACK_EXTERNAL_MODULE_1__){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function bubbleUp(heap,weightFunc,n){for(var element=heap[n],weight=weightFunc(element);n>0;){var parentN=Math.floor((n+1)/2)-1,_parent=heap[parentN];if(weight>=weightFunc(_parent))break;heap[parentN]=element,heap[n]=_parent,n=parentN}}var angular=__webpack_require__(1),_keys=function(collection){var keys=[],key=void 0;for(key in collection)collection.hasOwnProperty(key)&&keys.push(key);return keys},_isPromiseLike=function(v){return v&&"function"==typeof v.then},_stringifyNumber=function(number){return angular.isNumber(number)?number.toString():number},_keySet=function(collection){var keySet={},key=void 0;for(key in collection)collection.hasOwnProperty(key)&&(keySet[key]=key);return keySet},bubbleDown=function(heap,weightFunc,n){for(var length=heap.length,node=heap[n],nodeWeight=weightFunc(node);;){var child2N=2*(n+1),child1N=child2N-1,swap=null;if(child1N<length){weightFunc(heap[child1N])<nodeWeight&&(swap=child1N)}if(child2N<length){weightFunc(heap[child2N])<(null===swap?nodeWeight:weightFunc(heap[child1N]))&&(swap=child2N)}if(null===swap)break;heap[n]=heap[swap],heap[swap]=node,n=swap}},BinaryHeap=function BinaryHeap(weightFunc,compareFunc){var _this=this;if(_classCallCheck(this,BinaryHeap),weightFunc||(weightFunc=function(x){return x}),compareFunc||(compareFunc=function(x,y){return x===y}),"function"!=typeof weightFunc)throw new Error('BinaryHeap([weightFunc][, compareFunc]): "weightFunc" must be a function!');if("function"!=typeof compareFunc)throw new Error('BinaryHeap([weightFunc][, compareFunc]): "compareFunc" must be a function!');this.weightFunc=weightFunc,this.compareFunc=compareFunc,this.heap=[],this.push=function(node){_this.heap.push(node),bubbleUp(_this.heap,_this.weightFunc,_this.heap.length-1)},this.peek=function(){return _this.heap.length?_this.heap[0]:void 0},this.pop=function(){var front=_this.heap[0],end=_this.heap.pop();return _this.heap.length>0&&(_this.heap[0]=end,bubbleDown(_this.heap,_this.weightFunc,0)),front},this.remove=function(node){for(var length=_this.heap.length,i=0;i<length;i++)if(_this.compareFunc(_this.heap[i],node)){var removed=_this.heap[i],end=_this.heap.pop();return i!==length-1&&(_this.heap[i]=end,bubbleUp(_this.heap,_this.weightFunc,i),bubbleDown(_this.heap,_this.weightFunc,i)),removed}return null},this.removeAll=function(){_this.heap=[]},this.size=function(){return _this.heap.length}},BinaryHeapProvider=function BinaryHeapProvider(){_classCallCheck(this,BinaryHeapProvider),this.$get=function(){return BinaryHeap}},CacheFactoryProvider=function CacheFactoryProvider(){var _this5=this;_classCallCheck(this,CacheFactoryProvider);var defaults=this.defaults={capacity:Number.MAX_VALUE,maxAge:Number.MAX_VALUE,deleteOnExpire:"none",onExpire:null,cacheFlushInterval:null,recycleFreq:1e3,storageMode:"memory",storageImpl:null,disabled:!1,storagePrefix:"angular-cache.caches.",storeOnResolve:!1,storeOnReject:!1};this.$get=["$q",function($q){function CacheFactory(cacheId,options){return createCache(cacheId,options)}var caches={},createCache=function(cacheId,options){if(cacheId in caches)throw new Error(cacheId+" already exists!");if(!angular.isString(cacheId))throw new Error("cacheId must be a string!");var $$data={},$$promises={},$$storage=null,$$expiresHeap=new BinaryHeap(function(x){return x.expires},angular.equals),$$lruHeap=new BinaryHeap(function(x){return x.accessed},angular.equals),cache=caches[cacheId]={$$id:cacheId,destroy:function(){clearInterval(this.$$cacheFlushIntervalId),clearInterval(this.$$recycleFreqId),this.removeAll(),$$storage&&($$storage().removeItem(this.$$prefix+".keys"),$$storage().removeItem(this.$$prefix)),$$storage=null,$$data=null,$$lruHeap=null,$$expiresHeap=null,this.$$prefix=null,delete caches[this.$$id]},disable:function(){this.$$disabled=!0},enable:function(){delete this.$$disabled},get:function(key,options){var _this2=this;if(angular.isArray(key)){var _ret=function(){var keys=key,values=[];return angular.forEach(keys,function(key){var value=_this2.get(key,options);null!==value&&void 0!==value&&values.push(value)}),{v:values}}();if("object"==typeof _ret)return _ret.v}else if(key=_stringifyNumber(key),this.$$disabled)return;if(options=options||{},!angular.isString(key))throw new Error("key must be a string!");if(options&&!angular.isObject(options))throw new Error("options must be an object!");if(options.onExpire&&!angular.isFunction(options.onExpire))throw new Error("options.onExpire must be a function!");var item=void 0;if($$storage){if($$promises[key])return $$promises[key];var itemJson=$$storage().getItem(this.$$prefix+".data."+key);if(!itemJson)return;item=angular.fromJson(itemJson)}else{if(!(key in $$data))return;item=$$data[key]}var value=item.value,now=(new Date).getTime();return $$storage?($$lruHeap.remove({key:key,accessed:item.accessed}),item.accessed=now,$$lruHeap.push({key:key,accessed:now})):($$lruHeap.remove(item),item.accessed=now,$$lruHeap.push(item)),"passive"===this.$$deleteOnExpire&&"expires"in item&&item.expires<now?(this.remove(key),this.$$onExpire?this.$$onExpire.call(this,key,item.value,options.onExpire):options.onExpire&&options.onExpire.call(this,key,item.value),value=void 0):$$storage&&$$storage().setItem(this.$$prefix+".data."+key,JSON.stringify(item)),value},info:function(key){if(key){var item=void 0;if($$storage){var itemJson=$$storage().getItem(this.$$prefix+".data."+key);return itemJson?(item=angular.fromJson(itemJson),{created:item.created,accessed:item.accessed,expires:item.expires,isExpired:(new Date).getTime()-item.created>this.$$maxAge}):void 0}return key in $$data?(item=$$data[key],{created:item.created,accessed:item.accessed,expires:item.expires,isExpired:(new Date).getTime()-item.created>this.$$maxAge}):void 0}return{id:this.$$id,capacity:this.$$capacity,maxAge:this.$$maxAge,deleteOnExpire:this.$$deleteOnExpire,onExpire:this.$$onExpire,cacheFlushInterval:this.$$cacheFlushInterval,recycleFreq:this.$$recycleFreq,storageMode:this.$$storageMode,storageImpl:$$storage?$$storage():void 0,disabled:!!this.$$disabled,size:$$lruHeap&&$$lruHeap.size()||0}},keys:function(){if($$storage){var keysJson=$$storage().getItem(this.$$prefix+".keys");return keysJson?angular.fromJson(keysJson):[]}return _keys($$data)},keySet:function(){if($$storage){var keysJson=$$storage().getItem(this.$$prefix+".keys"),kSet={};if(keysJson)for(var keys=angular.fromJson(keysJson),i=0;i<keys.length;i++)kSet[keys[i]]=keys[i];return kSet}return _keySet($$data)},put:function(key,value,options){var _this3=this;options=options||{};var storeOnResolve="storeOnResolve"in options?!!options.storeOnResolve:this.$$storeOnResolve,storeOnReject="storeOnReject"in options?!!options.storeOnReject:this.$$storeOnReject,getHandler=function(store,isError){return function(v){return store&&(delete $$promises[key],angular.isObject(v)&&"status"in v&&"data"in v?(v=[v.status,v.data,v.headers(),v.statusText],_this3.put(key,v)):_this3.put(key,v)),isError?$q.reject(v):v}};if(!this.$$disabled&&null!==value&&void 0!==value){if(key=_stringifyNumber(key),!angular.isString(key))throw new Error("key must be a string!");var now=(new Date).getTime(),item={key:key,value:_isPromiseLike(value)?value.then(getHandler(storeOnResolve,!1),getHandler(storeOnReject,!0)):value,created:now,accessed:now};if(item.expires=item.created+this.$$maxAge,$$storage){if(_isPromiseLike(item.value))return $$promises[key]=item.value,$$promises[key];var keysJson=$$storage().getItem(this.$$prefix+".keys"),keys=keysJson?angular.fromJson(keysJson):[];$$storage().getItem(this.$$prefix+".data."+key)&&this.remove(key),$$expiresHeap.push({key:key,expires:item.expires}),$$lruHeap.push({key:key,accessed:item.accessed}),$$storage().setItem(this.$$prefix+".data."+key,JSON.stringify(item));for(var exists=!1,i=0;i<keys.length;i++)if(keys[i]===key){exists=!0;break}exists||keys.push(key),$$storage().setItem(this.$$prefix+".keys",JSON.stringify(keys))}else $$data[key]&&this.remove(key),$$expiresHeap.push(item),$$lruHeap.push(item),$$data[key]=item,delete $$promises[key];return $$lruHeap.size()>this.$$capacity&&this.remove($$lruHeap.peek().key),value}},remove:function(key){if(key+="",delete $$promises[key],!$$storage){var value=$$data[key]?$$data[key].value:void 0;return $$lruHeap.remove($$data[key]),$$expiresHeap.remove($$data[key]),$$data[key]=null,delete $$data[key],value}var itemJson=$$storage().getItem(this.$$prefix+".data."+key);if(itemJson){var item=angular.fromJson(itemJson);$$lruHeap.remove({key:key,accessed:item.accessed}),$$expiresHeap.remove({key:key,expires:item.expires}),$$storage().removeItem(this.$$prefix+".data."+key);var keysJson=$$storage().getItem(this.$$prefix+".keys"),keys=keysJson?angular.fromJson(keysJson):[],index=keys.indexOf(key);return index>=0&&keys.splice(index,1),$$storage().setItem(this.$$prefix+".keys",JSON.stringify(keys)),item.value}},removeAll:function(){if($$storage){$$lruHeap.removeAll(),$$expiresHeap.removeAll();var keysJson=$$storage().getItem(this.$$prefix+".keys");if(keysJson)for(var keys=angular.fromJson(keysJson),i=0;i<keys.length;i++)this.remove(keys[i]);$$storage().setItem(this.$$prefix+".keys",JSON.stringify([]))}else{$$lruHeap.removeAll(),$$expiresHeap.removeAll();for(var key in $$data)$$data[key]=null;$$data={}}$$promises={}},removeExpired:function(){for(var now=(new Date).getTime(),expired={},key=void 0,expiredItem=void 0;(expiredItem=$$expiresHeap.peek())&&expiredItem.expires<=now;)expired[expiredItem.key]=expiredItem.value?expiredItem.value:null,$$expiresHeap.pop();if($$storage)for(key in expired){var itemJson=$$storage().getItem(this.$$prefix+".data."+key);itemJson&&(expired[key]=angular.fromJson(itemJson).value,this.remove(key))}else for(key in expired)this.remove(key);if(this.$$onExpire)for(key in expired)this.$$onExpire.call(this,key,expired[key]);return expired},setCacheFlushInterval:function(cacheFlushInterval){if(null===cacheFlushInterval)delete this.$$cacheFlushInterval;else{if(!angular.isNumber(cacheFlushInterval))throw new Error("cacheFlushInterval must be a number!");if(cacheFlushInterval<0)throw new Error("cacheFlushInterval must be greater than zero!");cacheFlushInterval!==this.$$cacheFlushInterval&&(this.$$cacheFlushInterval=cacheFlushInterval,clearInterval(this.$$cacheFlushIntervalId),function(self){self.$$cacheFlushIntervalId=setInterval(function(){self.removeAll()},self.$$cacheFlushInterval)}(this))}},setCapacity:function(capacity){if(null===capacity)delete this.$$capacity;else{if(!angular.isNumber(capacity))throw new Error("capacity must be a number!");if(capacity<0)throw new Error("capacity must be greater than zero!");this.$$capacity=capacity}for(var removed={};$$lruHeap.size()>this.$$capacity;)removed[$$lruHeap.peek().key]=this.remove($$lruHeap.peek().key);return removed},setDeleteOnExpire:function(deleteOnExpire,setRecycleFreq){if(null===deleteOnExpire)delete this.$$deleteOnExpire;else{if(!angular.isString(deleteOnExpire))throw new Error("deleteOnExpire must be a string!");if("none"!==deleteOnExpire&&"passive"!==deleteOnExpire&&"aggressive"!==deleteOnExpire)throw new Error('deleteOnExpire must be "none", "passive" or "aggressive"!');this.$$deleteOnExpire=deleteOnExpire}!1!==setRecycleFreq&&this.setRecycleFreq(this.$$recycleFreq)},setMaxAge:function(maxAge){if(null===maxAge)this.$$maxAge=Number.MAX_VALUE;else{if(!angular.isNumber(maxAge))throw new Error("maxAge must be a number!");if(maxAge<0)throw new Error("maxAge must be greater than zero!");this.$$maxAge=maxAge}var i=void 0,keys=void 0,key=void 0;if($$expiresHeap.removeAll(),$$storage){var keysJson=$$storage().getItem(this.$$prefix+".keys");for(keys=keysJson?angular.fromJson(keysJson):[],i=0;i<keys.length;i++){key=keys[i];var itemJson=$$storage().getItem(this.$$prefix+".data."+key);if(itemJson){var item=angular.fromJson(itemJson);this.$$maxAge===Number.MAX_VALUE?item.expires=Number.MAX_VALUE:item.expires=item.created+this.$$maxAge,$$expiresHeap.push({key:key,expires:item.expires})}}}else for(keys=_keys($$data),i=0;i<keys.length;i++)key=keys[i],this.$$maxAge===Number.MAX_VALUE?$$data[key].expires=Number.MAX_VALUE:$$data[key].expires=$$data[key].created+this.$$maxAge,$$expiresHeap.push($$data[key]);return"aggressive"===this.$$deleteOnExpire?this.removeExpired():{}},setOnExpire:function(onExpire){if(null===onExpire)delete this.$$onExpire;else{if(!angular.isFunction(onExpire))throw new Error("onExpire must be a function!");this.$$onExpire=onExpire}},setOptions:function(cacheOptions,strict){if(cacheOptions=cacheOptions||{},strict=!!strict,!angular.isObject(cacheOptions))throw new Error("cacheOptions must be an object!");"storagePrefix"in cacheOptions?this.$$storagePrefix=cacheOptions.storagePrefix:strict&&(this.$$storagePrefix=defaults.storagePrefix),this.$$prefix=this.$$storagePrefix+this.$$id,"disabled"in cacheOptions?this.$$disabled=!!cacheOptions.disabled:strict&&(this.$$disabled=defaults.disabled),"storageMode"in cacheOptions||"storageImpl"in cacheOptions?this.setStorageMode(cacheOptions.storageMode||defaults.storageMode,cacheOptions.storageImpl||defaults.storageImpl):strict&&this.setStorageMode(defaults.storageMode,defaults.storageImpl),"storeOnResolve"in cacheOptions?this.$$storeOnResolve=!!cacheOptions.storeOnResolve:strict&&(this.$$storeOnResolve=defaults.storeOnResolve),"storeOnReject"in cacheOptions?this.$$storeOnReject=!!cacheOptions.storeOnReject:strict&&(this.$$storeOnReject=defaults.storeOnReject),"capacity"in cacheOptions?this.setCapacity(cacheOptions.capacity):strict&&this.setCapacity(defaults.capacity),"deleteOnExpire"in cacheOptions?this.setDeleteOnExpire(cacheOptions.deleteOnExpire,!1):strict&&this.setDeleteOnExpire(defaults.deleteOnExpire,!1),"maxAge"in cacheOptions?this.setMaxAge(cacheOptions.maxAge):strict&&this.setMaxAge(defaults.maxAge),"recycleFreq"in cacheOptions?this.setRecycleFreq(cacheOptions.recycleFreq):strict&&this.setRecycleFreq(defaults.recycleFreq),"cacheFlushInterval"in cacheOptions?this.setCacheFlushInterval(cacheOptions.cacheFlushInterval):strict&&this.setCacheFlushInterval(defaults.cacheFlushInterval),"onExpire"in cacheOptions?this.setOnExpire(cacheOptions.onExpire):strict&&this.setOnExpire(defaults.onExpire)},setRecycleFreq:function(recycleFreq){if(null===recycleFreq)delete this.$$recycleFreq;else{if(!angular.isNumber(recycleFreq))throw new Error("recycleFreq must be a number!");if(recycleFreq<0)throw new Error("recycleFreq must be greater than zero!");this.$$recycleFreq=recycleFreq}clearInterval(this.$$recycleFreqId),"aggressive"===this.$$deleteOnExpire?function(self){self.$$recycleFreqId=setInterval(function(){self.removeExpired()},self.$$recycleFreq)}(this):delete this.$$recycleFreqId},setStorageMode:function(storageMode,storageImpl){if(!angular.isString(storageMode))throw new Error("storageMode must be a string!");if("memory"!==storageMode&&"localStorage"!==storageMode&&"sessionStorage"!==storageMode)throw new Error('storageMode must be "memory", "localStorage" or "sessionStorage"!');var shouldReInsert=!1,items={};if("string"==typeof this.$$storageMode&&this.$$storageMode!==storageMode){var keys=this.keys();if(keys.length){for(var i=0;i<keys.length;i++)items[keys[i]]=this.get(keys[i]);for(i=0;i<keys.length;i++)this.remove(keys[i]);shouldReInsert=!0}}if(this.$$storageMode=storageMode,storageImpl){if(!angular.isObject(storageImpl))throw new Error("storageImpl must be an object!");if(!("setItem"in storageImpl&&"function"==typeof storageImpl.setItem))throw new Error('storageImpl must implement "setItem(key, value)"!');if(!("getItem"in storageImpl&&"function"==typeof storageImpl.getItem))throw new Error('storageImpl must implement "getItem(key)"!');if(!("removeItem"in storageImpl)||"function"!=typeof storageImpl.removeItem)throw new Error('storageImpl must implement "removeItem(key)"!');$$storage=function(){return storageImpl}}else if("localStorage"===this.$$storageMode)try{localStorage.setItem("angular-cache","angular-cache"),localStorage.removeItem("angular-cache"),$$storage=function(){return localStorage}}catch(e){$$storage=null,this.$$storageMode="memory"}else if("sessionStorage"===this.$$storageMode)try{sessionStorage.setItem("angular-cache","angular-cache"),sessionStorage.removeItem("angular-cache"),$$storage=function(){return sessionStorage}}catch(e){$$storage=null,this.$$storageMode="memory"}if(shouldReInsert)for(var key in items)this.put(key,items[key])},touch:function(key){var _this4=this;if(key){var val=this.get(key,{onExpire:function(k,v){return _this4.put(k,v)}});val&&this.put(key,val)}else for(var keys=this.keys(),i=0;i<keys.length;i++)this.touch(keys[i])}};return cache.setOptions(options,!0),cache};return CacheFactory.createCache=createCache,CacheFactory.info=function(){var keys=_keys(caches),info={size:keys.length,caches:{}};angular.extend(info,_this5.defaults);for(var i=0;i<keys.length;i++){var key=keys[i];info.caches[key]=caches[key].info()}return info},CacheFactory.get=function(cacheId){return caches[cacheId]},CacheFactory.keySet=function(){return _keySet(caches)},CacheFactory.keys=function(){return _keys(caches)},CacheFactory.destroy=function(cacheId){caches[cacheId]&&(caches[cacheId].destroy(),delete caches[cacheId])},CacheFactory.destroyAll=function(){for(var cacheId in caches)caches[cacheId].destroy();caches={}},CacheFactory.clearAll=function(){for(var cacheId in caches)caches[cacheId].removeAll()},CacheFactory.removeExpiredFromAll=function(){var expired={};for(var cacheId in caches)expired[cacheId]=caches[cacheId].removeExpired();return expired},CacheFactory.enableAll=function(){for(var cacheId in caches)caches[cacheId].$$disabled=!1},CacheFactory.disableAll=function(){for(var cacheId in caches)caches[cacheId].$$disabled=!0},CacheFactory.touchAll=function(){for(var cacheId in caches)caches[cacheId].touch()},CacheFactory}]};angular.module("angular-cache",[]).provider("BinaryHeap",BinaryHeapProvider).provider("CacheFactory",CacheFactoryProvider),module.exports="angular-cache",module.exports.name="angular-cache"},function(module,exports,__webpack_require__){module.exports=__WEBPACK_EXTERNAL_MODULE_1__}])}),function(){"use strict";function angularMoment(angular,moment){return angular.module("angularMoment",[]).constant("angularMomentConfig",{preprocess:null,timezone:"",format:null,statefulFilters:!0}).constant("moment",moment).constant("amTimeAgoConfig",{withoutSuffix:!1,serverTime:null,titleFormat:null}).directive("amTimeAgo",["$window","moment","amMoment","amTimeAgoConfig","angularMomentConfig",function($window,moment,amMoment,amTimeAgoConfig,angularMomentConfig){return function(scope,element,attr){function getNow(){var now;if(amTimeAgoConfig.serverTime){var localNow=(new Date).getTime(),nowMillis=localNow-localDate+amTimeAgoConfig.serverTime;now=moment(nowMillis)}else now=moment();return now}function cancelTimer(){activeTimeout&&($window.clearTimeout(activeTimeout),activeTimeout=null)}function updateTime(momentInstance){if(element.text(momentInstance.from(getNow(),withoutSuffix)),titleFormat&&!element.attr("title")&&element.attr("title",momentInstance.local().format(titleFormat)),!isBindOnce){var howOld=Math.abs(getNow().diff(momentInstance,"minute")),secondsUntilUpdate=3600;howOld<1?secondsUntilUpdate=1:howOld<60?secondsUntilUpdate=30:howOld<180&&(secondsUntilUpdate=300),activeTimeout=$window.setTimeout(function(){updateTime(momentInstance)},1e3*secondsUntilUpdate)}}function updateDateTimeAttr(value){isTimeElement&&element.attr("datetime",value)}function updateMoment(){if(cancelTimer(),currentValue){var momentValue=amMoment.preprocessDate(currentValue,preprocess,currentFormat);updateTime(momentValue),updateDateTimeAttr(momentValue.toISOString())}}var currentValue,unwatchChanges,activeTimeout=null,currentFormat=angularMomentConfig.format,withoutSuffix=amTimeAgoConfig.withoutSuffix,titleFormat=amTimeAgoConfig.titleFormat,localDate=(new Date).getTime(),preprocess=angularMomentConfig.preprocess,modelName=attr.amTimeAgo.replace(/^::/,""),isBindOnce=0===attr.amTimeAgo.indexOf("::"),isTimeElement="TIME"===element[0].nodeName.toUpperCase();unwatchChanges=scope.$watch(modelName,function(value){if(void 0===value||null===value||""===value)return cancelTimer(),void(currentValue&&(element.text(""),updateDateTimeAttr(""),currentValue=null));currentValue=value,updateMoment(),void 0!==value&&isBindOnce&&unwatchChanges()}),angular.isDefined(attr.amWithoutSuffix)&&scope.$watch(attr.amWithoutSuffix,function(value){"boolean"==typeof value?(withoutSuffix=value,updateMoment()):withoutSuffix=amTimeAgoConfig.withoutSuffix}),attr.$observe("amFormat",function(format){void 0!==format&&(currentFormat=format,updateMoment())}),attr.$observe("amPreprocess",function(newValue){preprocess=newValue,updateMoment()}),scope.$on("$destroy",function(){cancelTimer()}),scope.$on("amMoment:localeChanged",function(){updateMoment()})}}]).service("amMoment",["moment","$rootScope","$log","angularMomentConfig",function(moment,$rootScope,$log,angularMomentConfig){this.preprocessors={utc:moment.utc,unix:moment.unix},this.changeLocale=function(locale,customization){var result=moment.locale(locale,customization);return angular.isDefined(locale)&&$rootScope.$broadcast("amMoment:localeChanged"),result},this.changeTimezone=function(timezone){angularMomentConfig.timezone=timezone,$rootScope.$broadcast("amMoment:timezoneChanged")},this.preprocessDate=function(value,preprocess,format){return angular.isUndefined(preprocess)&&(preprocess=angularMomentConfig.preprocess),this.preprocessors[preprocess]?this.preprocessors[preprocess](value,format):(preprocess&&$log.warn("angular-moment: Ignoring unsupported value for preprocess: "+preprocess),!isNaN(parseFloat(value))&&isFinite(value)?moment(parseInt(value,10)):moment(value,format))},this.applyTimezone=function(aMoment){var timezone=angularMomentConfig.timezone;return aMoment&&timezone&&(aMoment.tz?aMoment=aMoment.tz(timezone):$log.warn("angular-moment: timezone specified but moment.tz() is undefined. Did you forget to include moment-timezone.js?")),aMoment}}]).filter("amCalendar",["moment","amMoment","angularMomentConfig",function(moment,amMoment,angularMomentConfig){function amCalendarFilter(value,preprocess){if(void 0===value||null===value)return"";value=amMoment.preprocessDate(value,preprocess);var date=moment(value);return date.isValid()?amMoment.applyTimezone(date).calendar():""}return amCalendarFilter.$stateful=angularMomentConfig.statefulFilters,amCalendarFilter}]).filter("amDifference",["moment","amMoment","angularMomentConfig",function(moment,amMoment,angularMomentConfig){function amDifferenceFilter(value,otherValue,unit,usePrecision,preprocessValue,preprocessOtherValue){if(void 0===value||null===value)return"";value=amMoment.preprocessDate(value,preprocessValue);var date=moment(value);if(!date.isValid())return"";var date2;if(void 0===otherValue||null===otherValue)date2=moment();else if(otherValue=amMoment.preprocessDate(otherValue,preprocessOtherValue),date2=moment(otherValue),!date2.isValid())return"";return amMoment.applyTimezone(date).diff(amMoment.applyTimezone(date2),unit,usePrecision)}return amDifferenceFilter.$stateful=angularMomentConfig.statefulFilters,amDifferenceFilter}]).filter("amDateFormat",["moment","amMoment","angularMomentConfig",function(moment,amMoment,angularMomentConfig){function amDateFormatFilter(value,format,preprocess){if(void 0===value||null===value)return"";value=amMoment.preprocessDate(value,preprocess);var date=moment(value);return date.isValid()?amMoment.applyTimezone(date).format(format):""}return amDateFormatFilter.$stateful=angularMomentConfig.statefulFilters,amDateFormatFilter}]).filter("amDurationFormat",["moment","angularMomentConfig",function(moment,angularMomentConfig){function amDurationFormatFilter(value,format,suffix){return void 0===value||null===value?"":moment.duration(value,format).humanize(suffix)}return amDurationFormatFilter.$stateful=angularMomentConfig.statefulFilters,amDurationFormatFilter}]).filter("amTimeAgo",["moment","amMoment","angularMomentConfig",function(moment,amMoment,angularMomentConfig){function amTimeAgoFilter(value,preprocess,suffix){if(void 0===value||null===value)return"";value=amMoment.preprocessDate(value,preprocess);var date=moment(value);return date.isValid()?amMoment.applyTimezone(date).fromNow(suffix):""}return amTimeAgoFilter.$stateful=angularMomentConfig.statefulFilters,amTimeAgoFilter}])}"function"==typeof define&&define.amd?define(["angular","moment"],angularMoment):"undefined"!=typeof module&&module&&module.exports?angularMoment(angular,require("moment")):angularMoment(angular,window.moment)}(),function(angular){"use strict";angular.module("720kb.socialshare",[]).directive("socialshare",["$window","$location",function($window,$location){return{restrict:"A",link:function($scope,element,attr){var key,attributeName,properties={},propDefaults={url:"",redirectUri:"",provider:"",type:"",text:"",caption:"",to:"",ref:"",display:"",from:"",media:"",hashtags:"",via:"",description:"",source:"",subreddit:"",follow:"",popupHeight:500,popupWidth:500};for(key in propDefaults)propDefaults.hasOwnProperty(key)&&(attributeName="socialshare"+key.substring(0,1).toUpperCase()+key.substring(1),function(keyName){attr.$observe(attributeName,function(value){value&&(properties[keyName]=value)})}(key),void 0===properties[key]&&(properties[key]=propDefaults[key]));properties.eventTrigger=attr.socialshareTrigger||"click",$scope.facebookShare=function(data){if(data.type&&"feed"===data.type){var urlString="https://www.facebook.com/dialog/feed?display=popup&app_id="+encodeURI(data.via)+"&redirect_uri="+encodeURI(data.redirectUri);data.url&&(urlString+="&link="+encodeURIComponent(data.url)),data.to&&(urlString+="&to="+encodeURIComponent(data.to)),data.display&&(urlString+="&display="+encodeURIComponent(data.display)),data.ref&&(urlString+="&ref="+encodeURIComponent(data.ref)),data.from&&(urlString+="&from="+encodeURIComponent(data.from)),data.description&&(urlString+="&description="+encodeURIComponent(data.description)),data.text&&(urlString+="&name="+encodeURIComponent(data.text)),data.caption&&(urlString+="&caption="+encodeURIComponent(data.caption)),data.media&&(urlString+="&picture="+encodeURIComponent(data.media)),data.source&&(urlString+="&source="+encodeURIComponent(data.source)),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)}else $window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(data.url||$location.absUrl()),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.twitterShare=function(data){var urlString="https://www.twitter.com/intent/tweet?";data.text&&(urlString+="text="+encodeURIComponent(data.text)),data.via&&(urlString+="&via="+encodeURI(data.via)),data.hashtags&&(urlString+="&hashtags="+encodeURI(data.hashtags)),urlString+="&url="+encodeURIComponent(data.url||$location.absUrl()),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.googlePlusShare=function(data){$window.open("https://plus.google.com/share?url="+encodeURIComponent(data.url||$location.absUrl()),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.redditShare=function(data){var urlString="https://www.reddit.com/";data.subreddit?urlString+="r/"+data.subreddit+"/submit?url=":urlString+="submit?url=",data.popupWidth<900&&(data.popupWidth=900),data.popupHeight<650&&(data.popupHeight=650),$window.open(urlString+encodeURIComponent(data.url||$location.absUrl())+"&title="+encodeURIComponent(data.text),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.stumbleuponShare=function(data){$window.open("https://www.stumbleupon.com/submit?url="+encodeURIComponent(data.url||$location.absUrl())+"&title="+encodeURIComponent(data.text),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.linkedinShare=function(data){var urlString="https://www.linkedin.com/shareArticle?mini=true";urlString+="&url="+encodeURIComponent(data.url||$location.absUrl()),data.text&&(urlString+="&title="+encodeURIComponent(data.text)),data.description&&(urlString+="&summary="+encodeURIComponent(data.description)),data.source&&(urlString+="&source="+encodeURIComponent(data.source)),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.pinterestShare=function(data){$window.open("https://www.pinterest.com/pin/create/button/?url="+encodeURIComponent(data.url||$location.absUrl())+"&media="+encodeURI(data.media)+"&description="+encodeURIComponent(data.text),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.diggShare=function(data){$window.open("https://www.digg.com/submit?url="+encodeURIComponent(data.url||$location.absUrl())+"&title="+encodeURIComponent(data.text),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.tumblrShare=function(data){if(data.media){var urlString="https://www.tumblr.com/share/photo?source="+encodeURIComponent(data.media);data.text&&(urlString+="&caption="+encodeURIComponent(data.text)),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)}else $window.open("https://www.tumblr.com/share/link?url="+encodeURIComponent(data.url)+"&description="+encodeURIComponent(data.text),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.vkShare=function(data){$window.open("https://www.vk.com/share.php?url="+encodeURIComponent(data.url||$location.absUrl()),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.deliciousShare=function(data){$window.open("https://www.delicious.com/save?v=5&noui&jump=close&url="+encodeURIComponent(data.url||$location.absUrl())+"&title="+encodeURIComponent(data.text),"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.bufferShare=function(data){var urlString="https://bufferapp.com/add?";data.text&&(urlString+="text="+encodeURIComponent(data.text)),data.via&&(urlString+="&via="+encodeURI(data.via)),urlString+="&url="+encodeURIComponent(data.url||$location.absUrl()),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.hackernewsShare=function(data){var urlString="https://news.ycombinator.com/submitlink?";data.text&&(urlString+="t="+encodeURIComponent(data.text)+"&"),urlString+="u="+encodeURIComponent(data.url||$location.absUrl()),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.flipboardShare=function(data){var urlString="https://share.flipboard.com/bookmarklet/popout?v=2&";data.text&&(urlString+="title="+encodeURIComponent(data.text)+"&"),urlString+="url="+encodeURIComponent(data.url||$location.absUrl()),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.pocketShare=function(data){var urlString="https://getpocket.com/save?";data.text&&(urlString+="text="+encodeURIComponent(data.text)+"&"),urlString+="url="+encodeURIComponent(data.url||$location.absUrl()),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.wordpressShare=function(data){var urlString="http://wordpress.com/press-this.php?";data.text&&(urlString+="t="+encodeURIComponent(data.text)+"&"),data.media&&(urlString+="i="+encodeURIComponent(data.media)+"&"),urlString+="u="+encodeURIComponent(data.url||$location.absUrl()),$window.open(urlString,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},$scope.xingShare=function(data){var followUrl="";data.follow&&(followUrl="&follow_url="+encodeURIComponent(data.follow)),$window.open("https://www.xing.com/spi/shares/new?url="+encodeURIComponent(data.url||$location.absUrl())+followUrl,"sharer","toolbar=0,status=0,width="+data.popupWidth+",height="+data.popupHeight)},element.bind(properties.eventTrigger,function(){switch(properties.provider){case"facebook":$scope.facebookShare(properties);break;case"google+":$scope.googlePlusShare(properties);break;case"twitter":$scope.twitterShare(properties);break;case"stumbleupon":$scope.stumbleuponShare(properties);break;case"reddit":$scope.redditShare(properties);break;case"pinterest":$scope.pinterestShare(properties);break;case"linkedin":$scope.linkedinShare(properties);break;case"digg":$scope.diggShare(properties);break;case"tumblr":$scope.tumblrShare(properties);break;case"delicious":$scope.deliciousShare(properties);break;case"vk":$scope.vkShare(properties);break;case"buffer":$scope.bufferShare(properties);break;case"pocket":$scope.pocketShare(properties);break;case"wordpress":$scope.wordpressShare(properties);break;case"flipboard":$scope.flipboardShare(properties);break;case"hackernews":$scope.hackernewsShare(properties);break;case"xing":$scope.xingShare(properties);break;default:return}})}}}])}(angular),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.angularCreditCards=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function ap(args,fn){return function(){var rest=[].slice.call(arguments),first=args.slice();return first.push.apply(first,rest),fn.apply(this,first)}}function pa(args,fn){return function(){var rest=[].slice.call(arguments);return rest.push.apply(rest,args),fn.apply(this,rest)}}function apa(left,right,fn){return function(){return fn.apply(this,left.concat.apply(left,arguments).concat(right))}}function partial(fn){return ap([].slice.call(arguments,1),fn)}function partialRight(fn){return pa([].slice.call(arguments,1),fn)}function curry(fn){return partial(partial,fn)}exports=module.exports=ap,exports.pa=pa,exports.apa=apa,exports.partial=partial,exports.partialRight=partialRight,exports.curry=curry,exports.curryRight=function(fn){return partial(partialRight,fn)}},{}],2:[function(_dereq_,module,exports){"use strict";var isArray=_dereq_("isarray");module.exports=function(value){return isArray(value)?value:[value]}},{isarray:18}],3:[function(_dereq_,module,exports){"use strict";var types=exports.types=_dereq_("./src/types");exports.Type=_dereq_("./src/type"),exports.find=function(callback){for(var typeName in types){var type=types[typeName];if(callback(type))return type}}},{"./src/type":4,"./src/types":5}],4:[function(_dereq_,module,exports){"use strict";function CardType(name,config){extend(this,{name:name},config)}var extend=_dereq_("xtend/mutable");module.exports=CardType,CardType.prototype.cvcLength=3,CardType.prototype.luhn=!0,CardType.prototype.groupPattern=/(\d{1,4})(\d{1,4})?(\d{1,4})?(\d{1,4})?/,CardType.prototype.group=function(number){return(number.match(this.groupPattern)||[]).slice(1).filter(Boolean)},CardType.prototype.test=function(number,eager){return this[eager?"eagerPattern":"pattern"].test(number)}},{"xtend/mutable":26}],5:[function(_dereq_,module,exports){"use strict";var Type=_dereq_("./type"),group19=/(\d{1,4})(\d{1,4})?(\d{1,4})?(\d{1,4})?(\d{1,3})?/;exports.visa=new Type("Visa",{pattern:/^4\d{12}(\d{3}|\d{6})?$/,eagerPattern:/^4/,groupPattern:group19}),exports.maestro=new Type("Maestro",{pattern:/^(?:5[06789]\d\d|(?!6011[0234])(?!60117[4789])(?!60118[6789])(?!60119)(?!64[456789])(?!65)6\d{3})\d{8,15}$/,eagerPattern:/^(5(018|0[23]|[68])|6[37]|60111|60115|60117([56]|7[56])|60118[0-5]|64[0-3]|66)/,groupPattern:group19}),exports.forbrugsforeningen=new Type("Forbrugsforeningen",{pattern:/^600722\d{10}$/,eagerPattern:/^600/}),exports.dankort=new Type("Dankort",{pattern:/^5019\d{12}$/,eagerPattern:/^5019/}),exports.masterCard=new Type("MasterCard",{pattern:/^(5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)\d{12}$/,eagerPattern:/^(2|5[1-5])/}),exports.americanExpress=new Type("American Express",{pattern:/^3[47]\d{13}$/,eagerPattern:/^3[47]/,groupPattern:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,cvcLength:4}),exports.dinersClub=new Type("Diners Club",{pattern:/^3(0[0-5]|[68]\d)\d{11}$/,eagerPattern:/^3(0|[68])/,groupPattern:/(\d{1,4})?(\d{1,6})?(\d{1,4})?/}),exports.discover=new Type("Discover",{pattern:/^6(011(0[0-9]|[2-4]\d|74|7[7-9]|8[6-9]|9[0-9])|4[4-9]\d{3}|5\d{4})\d{10}$/,eagerPattern:/^6(011(0[0-9]|[2-4]|74|7[7-9]|8[6-9]|9[0-9])|4[4-9]|5)/}),exports.jcb=new Type("JCB",{pattern:/^35\d{14}$/,eagerPattern:/^35/}),exports.unionPay=new Type("UnionPay",{pattern:/^62[0-5]\d{13,16}$/,eagerPattern:/^62/,groupPattern:group19,luhn:!1}),exports.troy=new Type("Troy",{pattern:/^9792\d{12}$/,eagerPattern:/^9792/})},{"./type":4}],6:[function(_dereq_,module,exports){"use strict";function parseCard(number){return"string"!=typeof number?"":number.replace(/[^\d]/g,"")}function formatCard(number,separator){var type=getType(number,!0);return type?type.group(number).join(separator||" "):number}function cardType(number,eager){var type=getType(number,eager);return type?type.name:void 0}function isCardValid(number,type){return!!(type=type?types.get(type):getType(number))&&((!type.luhn||luhn(number))&&type.test(number))}function getType(number,eager){return types.find(function(type){return type.test(number,eager)})}var luhn=_dereq_("fast-luhn"),types=_dereq_("./types");module.exports={types:types,parse:parseCard,format:formatCard,type:cardType,luhn:luhn,isValid:isCardValid}},{"./types":10,"fast-luhn":12}],7:[function(_dereq_,module,exports){"use strict";function cvcIsValid(cvc,type){return"string"==typeof cvc&&(!!cvcRegex.test(cvc)&&(!type||types.get(type).cvcLength===cvc.length))}var types=_dereq_("./types"),cvcRegex=/^\d{3,4}$/;module.exports={isValid:cvcIsValid}},{"./types":10}],8:[function(_dereq_,module,exports){"use strict";function isPast(month,year){return Date.now()>=new Date(year,month)}function parseMonth(month){return parseIntStrict(month)}function formatExpYear(year,strip){return year=year.toString(),strip?year.substr(2,4):year}function isExpYearValid(year){return"number"==typeof year&&(year=parseIntStrict(year))>0}function isExpYearPast(year){return(new Date).getFullYear()>year}var isValidMonth=_dereq_("is-valid-month"),parseIntStrict=_dereq_("parse-int"),parseYear=_dereq_("parse-year");module.exports={isPast:isPast,month:{parse:parseMonth,isValid:isValidMonth},year:{parse:parseYear,format:formatExpYear,isValid:isExpYearValid,isPast:isExpYearPast}}},{"is-valid-month":17,"parse-int":20,"parse-year":21}],9:[function(_dereq_,module,exports){"use strict";module.exports={card:_dereq_("./card"),cvc:_dereq_("./cvc"),expiration:_dereq_("./expiration")}},{"./card":6,"./cvc":7,"./expiration":8}],10:[function(_dereq_,module,exports){"use strict";var ccTypes=_dereq_("creditcards-types"),camel=_dereq_("to-camel-case"),extend=_dereq_("xtend");module.exports=extend(ccTypes,{get:function(name){return ccTypes.types[camel(name)]}})},{"creditcards-types":3,"to-camel-case":22,xtend:25}],11:[function(_dereq_,module,exports){"use strict";var zeroFill=_dereq_("zero-fill"),parseIntStrict=_dereq_("parse-int"),pad=zeroFill(2);module.exports=function(year,now){now=now||new Date;var base=now.getFullYear().toString().substr(0,2);return year=parseIntStrict(year),parseIntStrict(base+pad(year))}},{"parse-int":20,"zero-fill":27}],12:[function(_dereq_,module,exports){"use strict";module.exports=function(array){return function(number){if("string"!=typeof number)throw new TypeError("Expected string input");if(!number)return!1;for(var value,length=number.length,bit=1,sum=0;length;)value=parseInt(number.charAt(--length),10),sum+=(bit^=1)?array[value]:value;return!!sum&&sum%10==0}}([0,2,4,6,8,1,3,5,7,9])},{}],13:[function(_dereq_,module,exports){"use strict";var slice=Array.prototype.slice,toStr=Object.prototype.toString;module.exports=function(that){var target=this;if("function"!=typeof target||"[object Function]"!==toStr.call(target))throw new TypeError("Function.prototype.bind called on incompatible "+target);for(var bound,args=slice.call(arguments,1),binder=function(){if(this instanceof bound){var result=target.apply(this,args.concat(slice.call(arguments)));return Object(result)===result?result:this}return target.apply(that,args.concat(slice.call(arguments)))},boundLength=Math.max(0,target.length-args.length),boundArgs=[],i=0;i<boundLength;i++)boundArgs.push("$"+i);if(bound=Function("binder","return function ("+boundArgs.join(",")+"){ return binder.apply(this,arguments); }")(binder),target.prototype){var Empty=function(){};Empty.prototype=target.prototype,bound.prototype=new Empty,Empty.prototype=null}return bound}},{}],14:[function(_dereq_,module,exports){"use strict";var implementation=_dereq_("./implementation");module.exports=Function.prototype.bind||implementation},{"./implementation":13}],15:[function(_dereq_,module,exports){"use strict";var numberIsNan=_dereq_("number-is-nan");module.exports=Number.isFinite||function(val){return!("number"!=typeof val||numberIsNan(val)||val===1/0||val===-1/0)}},{"number-is-nan":19}],16:[function(_dereq_,module,exports){var isFinite=_dereq_("is-finite");module.exports=Number.isInteger||function(val){return"number"==typeof val&&isFinite(val)&&Math.floor(val)===val}},{"is-finite":15}],17:[function(_dereq_,module,exports){"use strict";var isInteger=_dereq_("is-integer");module.exports=function(month){return!("number"!=typeof month||!isInteger(month))&&(month>=1&&month<=12)}},{"is-integer":16}],18:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],19:[function(_dereq_,module,exports){"use strict";module.exports=Number.isNaN||function(x){return x!==x}},{}],20:[function(_dereq_,module,exports){"use strict";var isInteger=_dereq_("is-integer");module.exports=function(integer){return"number"==typeof integer?isInteger(integer)?integer:void 0:"string"==typeof integer&&/^-?\d+$/.test(integer)?parseInt(integer,10):void 0}},{"is-integer":16}],21:[function(_dereq_,module,exports){"use strict";var parseIntStrict=_dereq_("parse-int"),expandYear=_dereq_("expand-year");module.exports=function(year,expand,now){if(null!=(year=parseIntStrict(year)))return expand?expandYear(year,now):year}},{"expand-year":11,"parse-int":20}],22:[function(_dereq_,module,exports){function toCamelCase(string){return space(string).replace(/\s(\w)/g,function(matches,letter){return letter.toUpperCase()})}var space=_dereq_("to-space-case");module.exports=toCamelCase},{"to-space-case":24}],23:[function(_dereq_,module,exports){function toNoCase(string){return hasSpace.test(string)?string.toLowerCase():hasSeparator.test(string)?(unseparate(string)||string).toLowerCase():hasCamel.test(string)?uncamelize(string).toLowerCase():string.toLowerCase()}function unseparate(string){return string.replace(separatorSplitter,function(m,next){return next?" "+next:""})}function uncamelize(string){return string.replace(camelSplitter,function(m,previous,uppers){return previous+" "+uppers.toLowerCase().split("").join(" ")})}module.exports=toNoCase;var hasSpace=/\s/,hasSeparator=/(_|-|\.|:)/,hasCamel=/([a-z][A-Z]|[A-Z][a-z])/,separatorSplitter=/[\W_]+(.|$)/g,camelSplitter=/(.)([A-Z]+)/g},{}],24:[function(_dereq_,module,exports){function toSpaceCase(string){return clean(string).replace(/[\W_]+(.|$)/g,function(matches,match){return match?" "+match:""}).trim()}var clean=_dereq_("to-no-case");module.exports=toSpaceCase},{"to-no-case":23}],25:[function(_dereq_,module,exports){function extend(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source)hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}module.exports=extend;var hasOwnProperty=Object.prototype.hasOwnProperty},{}],26:[function(_dereq_,module,exports){function extend(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}module.exports=extend;var hasOwnProperty=Object.prototype.hasOwnProperty},{}],27:[function(_dereq_,module,exports){module.exports=function zeroFill(width,number,pad){return void 0===number?function(number,pad){return zeroFill(width,number,pad)}:(void 0===pad&&(pad="0"),width-=number.toString().length,width>0?new Array(width+(/\./.test(number)?2:1)).join(pad)+number:number+"")}},{}],28:[function(_dereq_,module,exports){"use strict";function factory($parse){return{restrict:"A",require:"ngModel",compile:function(element,attributes){return attributes.$set("maxlength",4),attributes.$set("pattern","[0-9]*"),attributes.$set("xAutocompletetype","cc-csc"),function(scope,element,attributes,ngModel){ngModel.$validators.ccCvc=function(value){return ngModel.$isEmpty(ngModel.$viewValue)||cvc.isValid(value,$parse(attributes.ccType)(scope))},attributes.ccType&&scope.$watch(attributes.ccType,bind.call(ngModel.$validate,ngModel))}}}}var cvc=_dereq_("creditcards").cvc,bind=_dereq_("function-bind");module.exports=factory,factory.$inject=["$parse"]},{creditcards:9,"function-bind":14}],29:[function(_dereq_,module,exports){"use strict";function CcExpController($scope,$element){function setValidity(exp){var expMonth=exp.month,expYear=exp.year,valid=null==expMonth&&null==expYear||!!expMonth&&!!expYear&&!expiration.isPast(expMonth,expYear);parentForm.$setValidity("ccExp",valid,$element)}var nullFormCtrl={$setValidity:noop},parentForm=$element.inheritedData("$formController")||nullFormCtrl,ngModel={year:{},month:{}};this.setMonth=function(monthCtrl){ngModel.month=monthCtrl},this.setYear=function(yearCtrl){ngModel.year=yearCtrl},this.$watch=function(){$scope.$watch(function(){return{month:ngModel.month.$modelValue,year:ngModel.year.$modelValue}},setValidity,!0)}}function noop(){}var expiration=_dereq_("creditcards").expiration,month=expiration.month,year=expiration.year,ap=_dereq_("ap");exports=module.exports=function(){return{restrict:"AE",require:"ccExp",controller:CcExpController,link:function(scope,element,attributes,ccExp){ccExp.$watch()}}},CcExpController.$inject=["$scope","$element"];var nullCcExp={setMonth:noop,setYear:noop};exports.month=function(){return{restrict:"A",require:["ngModel","^?ccExp"],compile:function(element,attributes){return attributes.$set("maxlength",2),attributes.$set("pattern","[0-9]*"),attributes.$set("xAutocompletetype","cc-exp-month"),function(scope,element,attributes,controllers){var ngModel=controllers[0];(controllers[1]||nullCcExp).setMonth(ngModel),ngModel.$parsers.unshift(month.parse),ngModel.$validators.ccExpMonth=function(value){return ngModel.$isEmpty(ngModel.$viewValue)||month.isValid(value)}}}}},exports.year=function(){return{restrict:"A",require:["ngModel","^?ccExp"],compile:function(element,attributes){var fullYear=void 0!==attributes.fullYear;return attributes.$set("maxlength",fullYear?4:2),attributes.$set("pattern","[0-9]*"),attributes.$set("xAutocompletetype","cc-exp-year"),function(scope,element,attributes,controllers){var ngModel=controllers[0];(controllers[1]||nullCcExp).setYear(ngModel),ngModel.$parsers.unshift(ap.partialRight(year.parse,!fullYear)),ngModel.$formatters.unshift(function(value){return value?year.format(value,!fullYear):""}),ngModel.$validators.ccExpYear=function(value){return ngModel.$isEmpty(ngModel.$viewValue)||year.isValid(value)&&!year.isPast(value)}}}}}},{ap:1,creditcards:9}],30:[function(_dereq_,module,exports){"use strict";function factory($parse,$timeout){return{restrict:"A",require:["ngModel","ccNumber"],controller:function(){this.type=null,this.eagerType=null},compile:function($element,$attributes){return $attributes.$set("pattern","[0-9]*"),$attributes.$set("xAutocompletetype","cc-number"),function($scope,$element,$attributes,controllers){function $viewValue(){return ngModel.$viewValue}function setCursorPostion(element,position){$timeout(function(){if(element.setSelectionRange)element.setSelectionRange(position,position);else if(element.createTextRange){var range=element.createTextRange();range.move("character",position),range.select()}},0)}var ngModel=controllers[0],ccNumber=controllers[1];$scope.$watch($attributes.ngModel,function(number){ngModel.$ccType=ccNumber.type=card.type(number)}),null!=$attributes.ccEagerType&&$scope.$watch($viewValue,function(number){number=card.parse(number),ngModel.$ccEagerType=ccNumber.eagerType=card.type(number,!0)}),$attributes.ccType&&$scope.$watch($attributes.ccType,function(){ngModel.$validate()}),null!=$attributes.ccFormat&&(ngModel.$formatters.unshift(card.format),$element.on("input",function(){var input=$element.val(),previous=$viewValue();if(input){var element=$element[0],formatted=card.format(card.parse(input)),selectionEnd=element.selectionEnd;ngModel.$setViewValue(formatted),ngModel.$render(),previous&&selectionEnd===previous.length&&previous.length<formatted.length&&(selectionEnd=formatted.length),setCursorPostion(element,selectionEnd)}})),ngModel.$parsers.unshift(card.parse),ngModel.$validators.ccNumber=function(number){return ngModel.$isEmpty(ngModel.$viewValue)||card.isValid(number)},ngModel.$validators.ccNumberType=function(number){if(ngModel.$isEmpty(ngModel.$viewValue))return!0;var type=$parse($attributes.ccType)($scope);return type||card.isValid(number),array(type).some(partial(card.isValid,number))}}}}}var card=_dereq_("creditcards").card,array=_dereq_("cast-array"),partial=_dereq_("ap").partial;module.exports=factory,factory.$inject=["$parse","$timeout"]},{ap:1,"cast-array":2,creditcards:9}],31:[function(_dereq_,module,exports){(function(global){"use strict";var angular="undefined"!=typeof window?window.angular:void 0!==global?global.angular:null,creditcards=_dereq_("creditcards"),number=_dereq_("./number"),cvc=_dereq_("./cvc"),expiration=_dereq_("./expiration");module.exports=angular.module("credit-cards",[]).value("creditcards",creditcards).directive("ccNumber",number).directive("ccExp",expiration).directive("ccExpMonth",expiration.month).directive("ccExpYear",expiration.year).directive("ccCvc",cvc).name}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cvc":28,"./expiration":29,"./number":30,creditcards:9}]},{},[31])(31)}),function(root,factory){"use strict";if("function"==typeof define&&define.amd)define(["angular"],factory);else if("object"==typeof module&&module.exports){var angularObj=angular||require("angular");angularObj&&angularObj.module||"undefined"==typeof angular||(angularObj=angular),module.exports=factory(angularObj)}else factory(root.angular)}(this,function(angular){"use strict";var module=angular.module("rzModule",[]).factory("RzSliderOptions",function(){var defaultOptions={floor:0,ceil:null,step:1,precision:0,minRange:null,maxRange:null,pushRange:!1,minLimit:null,maxLimit:null,id:null,translate:null,getLegend:null,stepsArray:null,bindIndexForStepsArray:!1,draggableRange:!1,draggableRangeOnly:!1,showSelectionBar:!1,showSelectionBarEnd:!1,showSelectionBarFromValue:null,hidePointerLabels:!1,hideLimitLabels:!1,autoHideLimitLabels:!0,readOnly:!1,disabled:!1,interval:350,showTicks:!1,showTicksValues:!1,ticksArray:null,ticksTooltip:null,ticksValuesTooltip:null,vertical:!1,getSelectionBarColor:null,getTickColor:null,getPointerColor:null,keyboardSupport:!0,scale:1,enforceStep:!0,enforceRange:!1,noSwitching:!1,onlyBindHandles:!1,onStart:null,onChange:null,onEnd:null,rightToLeft:!1,boundPointerLabels:!0,mergeRangeLabelsIfSame:!1,customTemplateScope:null,logScale:!1,customValueToPosition:null,customPositionToValue:null,selectionBarGradient:null},globalOptions={},factory={};return factory.options=function(value){angular.extend(globalOptions,value)},factory.getOptions=function(options){return angular.extend({},defaultOptions,globalOptions,options)},factory}).factory("rzThrottle",["$timeout",function($timeout){return function(func,wait,options){var context,args,result,getTime=Date.now||function(){return(new Date).getTime()},timeout=null,previous=0;options=options||{};var later=function(){previous=getTime(),timeout=null,result=func.apply(context,args),context=args=null};return function(){var now=getTime(),remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?($timeout.cancel(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||!1===options.trailing||(timeout=$timeout(later,remaining)),result}}}]).factory("RzSlider",["$timeout","$document","$window","$compile","RzSliderOptions","rzThrottle",function($timeout,$document,$window,$compile,RzSliderOptions,rzThrottle){var Slider=function(scope,sliderElem){this.scope=scope,this.lowValue=0,this.highValue=0,this.sliderElem=sliderElem,this.range=void 0!==this.scope.rzSliderModel&&void 0!==this.scope.rzSliderHigh,this.dragging={active:!1,value:0,difference:0,position:0,lowLimit:0,highLimit:0},this.positionProperty="left",this.dimensionProperty="width",this.handleHalfDim=0,this.maxPos=0,this.precision=0,this.step=1,this.tracking="",this.minValue=0,this.maxValue=0,this.valueRange=0,this.intermediateTicks=!1,this.initHasRun=!1,this.firstKeyDown=!1,this.internalChange=!1,this.cmbLabelShown=!1,this.currentFocusElement=null,this.fullBar=null,this.selBar=null,this.minH=null,this.maxH=null,this.flrLab=null,this.ceilLab=null,this.minLab=null,this.maxLab=null,this.cmbLab=null,this.ticks=null,this.init()};return Slider.prototype={init:function(){var thrLow,thrHigh,self=this,calcDimFn=function(){self.calcViewDimensions()};this.applyOptions(),this.syncLowValue(),this.range&&this.syncHighValue(),this.initElemHandles(),this.manageElementsStyle(),this.setDisabledState(),this.calcViewDimensions(),this.setMinAndMax(),this.addAccessibility(),this.updateCeilLab(),this.updateFloorLab(),this.initHandles(),this.manageEventsBindings(),this.scope.$on("reCalcViewDimensions",calcDimFn),angular.element($window).on("resize",calcDimFn),this.initHasRun=!0,thrLow=rzThrottle(function(){self.onLowHandleChange()},self.options.interval),thrHigh=rzThrottle(function(){self.onHighHandleChange()},self.options.interval),this.scope.$on("rzSliderForceRender",function(){self.resetLabelsValue(),thrLow(),self.range&&thrHigh(),self.resetSlider()}),this.scope.$watch("rzSliderOptions()",function(newValue,oldValue){newValue!==oldValue&&(self.applyOptions(),self.syncLowValue(),self.range&&self.syncHighValue(),self.resetSlider())},!0),this.scope.$watch("rzSliderModel",function(newValue,oldValue){self.internalChange||newValue!==oldValue&&thrLow()}),this.scope.$watch("rzSliderHigh",function(newValue,oldValue){self.internalChange||newValue!==oldValue&&(null!=newValue&&thrHigh(),(self.range&&null==newValue||!self.range&&null!=newValue)&&(self.applyOptions(),self.resetSlider()))}),this.scope.$on("$destroy",function(){self.unbindEvents(),angular.element($window).off("resize",calcDimFn),self.currentFocusElement=null})},findStepIndex:function(modelValue){for(var index=0,i=0;i<this.options.stepsArray.length;i++){var step=this.options.stepsArray[i];if(step===modelValue){index=i;break}if(angular.isDate(step)){if(step.getTime()===modelValue.getTime()){index=i;break}}else if(angular.isObject(step)&&(angular.isDate(step.value)&&step.value.getTime()===modelValue.getTime()||step.value===modelValue)){index=i;break}}return index},syncLowValue:function(){this.options.stepsArray?this.options.bindIndexForStepsArray?this.lowValue=this.scope.rzSliderModel:this.lowValue=this.findStepIndex(this.scope.rzSliderModel):this.lowValue=this.scope.rzSliderModel},syncHighValue:function(){this.options.stepsArray?this.options.bindIndexForStepsArray?this.highValue=this.scope.rzSliderHigh:this.highValue=this.findStepIndex(this.scope.rzSliderHigh):this.highValue=this.scope.rzSliderHigh},getStepValue:function(sliderValue){var step=this.options.stepsArray[sliderValue];return angular.isDate(step)?step:angular.isObject(step)?step.value:step},applyLowValue:function(){this.options.stepsArray?this.options.bindIndexForStepsArray?this.scope.rzSliderModel=this.lowValue:this.scope.rzSliderModel=this.getStepValue(this.lowValue):this.scope.rzSliderModel=this.lowValue},applyHighValue:function(){this.options.stepsArray?this.options.bindIndexForStepsArray?this.scope.rzSliderHigh=this.highValue:this.scope.rzSliderHigh=this.getStepValue(this.highValue):this.scope.rzSliderHigh=this.highValue},onLowHandleChange:function(){this.syncLowValue(),this.range&&this.syncHighValue(),this.setMinAndMax(),this.updateLowHandle(this.valueToPosition(this.lowValue)),this.updateSelectionBar(),this.updateTicksScale(),this.updateAriaAttributes(),this.range&&this.updateCmbLabel()},onHighHandleChange:function(){this.syncLowValue(),this.syncHighValue(),this.setMinAndMax(),this.updateHighHandle(this.valueToPosition(this.highValue)),this.updateSelectionBar(),this.updateTicksScale(),this.updateCmbLabel(),this.updateAriaAttributes()},applyOptions:function(){var sliderOptions;sliderOptions=this.scope.rzSliderOptions?this.scope.rzSliderOptions():{},this.options=RzSliderOptions.getOptions(sliderOptions),this.options.step<=0&&(this.options.step=1),this.range=void 0!==this.scope.rzSliderModel&&void 0!==this.scope.rzSliderHigh,this.options.draggableRange=this.range&&this.options.draggableRange,this.options.draggableRangeOnly=this.range&&this.options.draggableRangeOnly,this.options.draggableRangeOnly&&(this.options.draggableRange=!0),this.options.showTicks=this.options.showTicks||this.options.showTicksValues||!!this.options.ticksArray,this.scope.showTicks=this.options.showTicks,(angular.isNumber(this.options.showTicks)||this.options.ticksArray)&&(this.intermediateTicks=!0),this.options.showSelectionBar=this.options.showSelectionBar||this.options.showSelectionBarEnd||null!==this.options.showSelectionBarFromValue,this.options.stepsArray?this.parseStepsArray():(this.options.translate?this.customTrFn=this.options.translate:this.customTrFn=function(value){return String(value)},this.getLegend=this.options.getLegend),this.options.vertical&&(this.positionProperty="bottom",this.dimensionProperty="height"),this.options.customTemplateScope&&(this.scope.custom=this.options.customTemplateScope)},parseStepsArray:function(){this.options.floor=0,this.options.ceil=this.options.stepsArray.length-1,this.options.step=1,this.options.translate?this.customTrFn=this.options.translate:this.customTrFn=function(modelValue){return this.options.bindIndexForStepsArray?this.getStepValue(modelValue):modelValue},this.getLegend=function(index){var step=this.options.stepsArray[index];return angular.isObject(step)?step.legend:null}},resetSlider:function(){this.manageElementsStyle(),this.addAccessibility(),this.setMinAndMax(),this.updateCeilLab(),this.updateFloorLab(),this.unbindEvents(),this.manageEventsBindings(),this.setDisabledState(),this.calcViewDimensions(),this.refocusPointerIfNeeded()},refocusPointerIfNeeded:function(){this.currentFocusElement&&(this.onPointerFocus(this.currentFocusElement.pointer,this.currentFocusElement.ref),this.focusElement(this.currentFocusElement.pointer))},initElemHandles:function(){angular.forEach(this.sliderElem.children(),function(elem,index){var jElem=angular.element(elem);switch(index){case 0:this.fullBar=jElem;break;case 1:this.selBar=jElem;break;case 2:this.minH=jElem;break;case 3:this.maxH=jElem;break;case 4:this.flrLab=jElem;break;case 5:this.ceilLab=jElem;break;case 6:this.minLab=jElem;break;case 7:this.maxLab=jElem;break;case 8:this.cmbLab=jElem;break;case 9:this.ticks=jElem}},this),this.selBar.rzsp=0,this.minH.rzsp=0,this.maxH.rzsp=0,this.flrLab.rzsp=0,this.ceilLab.rzsp=0,this.minLab.rzsp=0,this.maxLab.rzsp=0,this.cmbLab.rzsp=0},manageElementsStyle:function(){this.range?this.maxH.css("display",""):this.maxH.css("display","none"),this.alwaysHide(this.flrLab,this.options.showTicksValues||this.options.hideLimitLabels),this.alwaysHide(this.ceilLab,this.options.showTicksValues||this.options.hideLimitLabels);var hideLabelsForTicks=this.options.showTicksValues&&!this.intermediateTicks;this.alwaysHide(this.minLab,hideLabelsForTicks||this.options.hidePointerLabels),this.alwaysHide(this.maxLab,hideLabelsForTicks||!this.range||this.options.hidePointerLabels),this.alwaysHide(this.cmbLab,hideLabelsForTicks||!this.range||this.options.hidePointerLabels),this.alwaysHide(this.selBar,!this.range&&!this.options.showSelectionBar),this.options.vertical&&this.sliderElem.addClass("rz-vertical"),this.options.draggableRange?this.selBar.addClass("rz-draggable"):this.selBar.removeClass("rz-draggable"),this.intermediateTicks&&this.options.showTicksValues&&this.ticks.addClass("rz-ticks-values-under")},alwaysHide:function(el,hide){el.rzAlwaysHide=hide,hide?this.hideEl(el):this.showEl(el)},manageEventsBindings:function(){this.options.disabled||this.options.readOnly?this.unbindEvents():this.bindEvents()},setDisabledState:function(){this.options.disabled?this.sliderElem.attr("disabled","disabled"):this.sliderElem.attr("disabled",null)},resetLabelsValue:function(){this.minLab.rzsv=void 0,this.maxLab.rzsv=void 0},initHandles:function(){this.updateLowHandle(this.valueToPosition(this.lowValue)),this.range&&this.updateHighHandle(this.valueToPosition(this.highValue)),this.updateSelectionBar(),this.range&&this.updateCmbLabel(),this.updateTicksScale()},translateFn:function(value,label,which,useCustomTr){useCustomTr=void 0===useCustomTr||useCustomTr;var valStr="",getDimension=!1,noLabelInjection=label.hasClass("no-label-injection");useCustomTr?(this.options.stepsArray&&!this.options.bindIndexForStepsArray&&(value=this.getStepValue(value)),valStr=String(this.customTrFn(value,this.options.id,which))):valStr=String(value),(void 0===label.rzsv||label.rzsv.length!==valStr.length||label.rzsv.length>0&&0===label.rzsd)&&(getDimension=!0,label.rzsv=valStr),noLabelInjection||label.html(valStr),this.scope[which+"Label"]=valStr,getDimension&&this.getDimension(label)},setMinAndMax:function(){if(this.step=+this.options.step,this.precision=+this.options.precision,this.minValue=this.options.floor,this.options.logScale&&0===this.minValue)throw Error("Can't use floor=0 with logarithmic scale");this.options.enforceStep&&(this.lowValue=this.roundStep(this.lowValue),this.range&&(this.highValue=this.roundStep(this.highValue))),null!=this.options.ceil?this.maxValue=this.options.ceil:this.maxValue=this.options.ceil=this.range?this.highValue:this.lowValue,this.options.enforceRange&&(this.lowValue=this.sanitizeValue(this.lowValue),this.range&&(this.highValue=this.sanitizeValue(this.highValue))),this.applyLowValue(),this.range&&this.applyHighValue(),this.valueRange=this.maxValue-this.minValue},addAccessibility:function(){this.minH.attr("role","slider"),this.updateAriaAttributes(),!this.options.keyboardSupport||this.options.readOnly||this.options.disabled?this.minH.attr("tabindex",""):this.minH.attr("tabindex","0"),this.options.vertical&&this.minH.attr("aria-orientation","vertical"),this.range&&(this.maxH.attr("role","slider"),!this.options.keyboardSupport||this.options.readOnly||this.options.disabled?this.maxH.attr("tabindex",""):this.maxH.attr("tabindex","0"),this.options.vertical&&this.maxH.attr("aria-orientation","vertical"))},updateAriaAttributes:function(){this.minH.attr({"aria-valuenow":this.scope.rzSliderModel,"aria-valuetext":this.customTrFn(this.scope.rzSliderModel,this.options.id,"model"),"aria-valuemin":this.minValue,"aria-valuemax":this.maxValue}),this.range&&this.maxH.attr({"aria-valuenow":this.scope.rzSliderHigh,"aria-valuetext":this.customTrFn(this.scope.rzSliderHigh,this.options.id,"high"),"aria-valuemin":this.minValue,"aria-valuemax":this.maxValue})},calcViewDimensions:function(){var handleWidth=this.getDimension(this.minH);if(this.handleHalfDim=handleWidth/2,this.barDimension=this.getDimension(this.fullBar),this.maxPos=this.barDimension-handleWidth,this.getDimension(this.sliderElem),this.sliderElem.rzsp=this.sliderElem[0].getBoundingClientRect()[this.positionProperty],this.initHasRun){this.updateFloorLab(),this.updateCeilLab(),this.initHandles();var self=this;$timeout(function(){self.updateTicksScale()})}},updateTicksScale:function(){if(this.options.showTicks){var ticksArray=this.options.ticksArray||this.getTicksArray(),translate=this.options.vertical?"translateY":"translateX",self=this;this.options.rightToLeft&&ticksArray.reverse(),this.scope.ticks=ticksArray.map(function(value){var position=self.valueToPosition(value);self.options.vertical&&(position=self.maxPos-position);var tick={selected:self.isTickSelected(value),style:{transform:translate+"("+Math.round(position)+"px)"}};if(tick.selected&&self.options.getSelectionBarColor&&(tick.style["background-color"]=self.getSelectionBarColor()),!tick.selected&&self.options.getTickColor&&(tick.style["background-color"]=self.getTickColor(value)),self.options.ticksTooltip&&(tick.tooltip=self.options.ticksTooltip(value),tick.tooltipPlacement=self.options.vertical?"right":"top"),self.options.showTicksValues&&(tick.value=self.getDisplayValue(value,"tick-value"),self.options.ticksValuesTooltip&&(tick.valueTooltip=self.options.ticksValuesTooltip(value),tick.valueTooltipPlacement=self.options.vertical?"right":"top")),self.getLegend){var legend=self.getLegend(value,self.options.id);legend&&(tick.legend=legend)}return tick})}},getTicksArray:function(){var step=this.step,ticksArray=[];this.intermediateTicks&&(step=this.options.showTicks);for(var value=this.minValue;value<=this.maxValue;value+=step)ticksArray.push(value);return ticksArray},isTickSelected:function(value){if(!this.range)if(null!==this.options.showSelectionBarFromValue){var center=this.options.showSelectionBarFromValue;if(this.lowValue>center&&value>=center&&value<=this.lowValue)return!0;if(this.lowValue<center&&value<=center&&value>=this.lowValue)return!0}else if(this.options.showSelectionBarEnd){if(value>=this.lowValue)return!0}else if(this.options.showSelectionBar&&value<=this.lowValue)return!0;return!!(this.range&&value>=this.lowValue&&value<=this.highValue)},updateFloorLab:function(){this.translateFn(this.minValue,this.flrLab,"floor"),this.getDimension(this.flrLab);var position=this.options.rightToLeft?this.barDimension-this.flrLab.rzsd:0;this.setPosition(this.flrLab,position)},updateCeilLab:function(){this.translateFn(this.maxValue,this.ceilLab,"ceil"),this.getDimension(this.ceilLab);var position=this.options.rightToLeft?0:this.barDimension-this.ceilLab.rzsd;this.setPosition(this.ceilLab,position)},updateHandles:function(which,newPos){"lowValue"===which?this.updateLowHandle(newPos):this.updateHighHandle(newPos),this.updateSelectionBar(),this.updateTicksScale(),this.range&&this.updateCmbLabel()},getHandleLabelPos:function(labelName,newPos){var labelRzsd=this[labelName].rzsd,nearHandlePos=newPos-labelRzsd/2+this.handleHalfDim,endOfBarPos=this.barDimension-labelRzsd;return this.options.boundPointerLabels?this.options.rightToLeft&&"minLab"===labelName||!this.options.rightToLeft&&"maxLab"===labelName?Math.min(nearHandlePos,endOfBarPos):Math.min(Math.max(nearHandlePos,0),endOfBarPos):nearHandlePos},updateLowHandle:function(newPos){if(this.setPosition(this.minH,newPos),this.translateFn(this.lowValue,this.minLab,"model"),this.setPosition(this.minLab,this.getHandleLabelPos("minLab",newPos)),this.options.getPointerColor){var pointercolor=this.getPointerColor("min");this.scope.minPointerStyle={backgroundColor:pointercolor}}this.options.autoHideLimitLabels&&this.shFloorCeil()},updateHighHandle:function(newPos){if(this.setPosition(this.maxH,newPos),this.translateFn(this.highValue,this.maxLab,"high"),this.setPosition(this.maxLab,this.getHandleLabelPos("maxLab",newPos)),this.options.getPointerColor){var pointercolor=this.getPointerColor("max");this.scope.maxPointerStyle={backgroundColor:pointercolor}}this.options.autoHideLimitLabels&&this.shFloorCeil()},shFloorCeil:function(){if(!this.options.hidePointerLabels){var flHidden=!1,clHidden=!1,isMinLabAtFloor=this.isLabelBelowFloorLab(this.minLab),isMinLabAtCeil=this.isLabelAboveCeilLab(this.minLab),isMaxLabAtCeil=this.isLabelAboveCeilLab(this.maxLab),isCmbLabAtFloor=this.isLabelBelowFloorLab(this.cmbLab),isCmbLabAtCeil=this.isLabelAboveCeilLab(this.cmbLab);if(isMinLabAtFloor?(flHidden=!0,this.hideEl(this.flrLab)):(flHidden=!1,this.showEl(this.flrLab)),isMinLabAtCeil?(clHidden=!0,this.hideEl(this.ceilLab)):(clHidden=!1,this.showEl(this.ceilLab)),this.range){var hideCeil=this.cmbLabelShown?isCmbLabAtCeil:isMaxLabAtCeil,hideFloor=this.cmbLabelShown?isCmbLabAtFloor:isMinLabAtFloor;hideCeil?this.hideEl(this.ceilLab):clHidden||this.showEl(this.ceilLab),hideFloor?this.hideEl(this.flrLab):flHidden||this.showEl(this.flrLab)}}},isLabelBelowFloorLab:function(label){var isRTL=this.options.rightToLeft,pos=label.rzsp,dim=label.rzsd,floorPos=this.flrLab.rzsp,floorDim=this.flrLab.rzsd;return isRTL?pos+dim>=floorPos-2:pos<=floorPos+floorDim+2},isLabelAboveCeilLab:function(label){var isRTL=this.options.rightToLeft,pos=label.rzsp,dim=label.rzsd,ceilPos=this.ceilLab.rzsp,ceilDim=this.ceilLab.rzsd;return isRTL?pos<=ceilPos+ceilDim+2:pos+dim>=ceilPos-2},updateSelectionBar:function(){var position=0,dimension=0,isSelectionBarFromRight=this.options.rightToLeft?!this.options.showSelectionBarEnd:this.options.showSelectionBarEnd,positionForRange=this.options.rightToLeft?this.maxH.rzsp+this.handleHalfDim:this.minH.rzsp+this.handleHalfDim;if(this.range)dimension=Math.abs(this.maxH.rzsp-this.minH.rzsp),position=positionForRange;else if(null!==this.options.showSelectionBarFromValue){var center=this.options.showSelectionBarFromValue,centerPosition=this.valueToPosition(center),isModelGreaterThanCenter=this.options.rightToLeft?this.lowValue<=center:this.lowValue>center;isModelGreaterThanCenter?(dimension=this.minH.rzsp-centerPosition,position=centerPosition+this.handleHalfDim):(dimension=centerPosition-this.minH.rzsp,position=this.minH.rzsp+this.handleHalfDim)}else isSelectionBarFromRight?(dimension=Math.abs(this.maxPos-this.minH.rzsp)+this.handleHalfDim,position=this.minH.rzsp+this.handleHalfDim):(dimension=Math.abs(this.maxH.rzsp-this.minH.rzsp)+this.handleHalfDim,position=0);if(this.setDimension(this.selBar,dimension),this.setPosition(this.selBar,position),this.options.getSelectionBarColor){var color=this.getSelectionBarColor();this.scope.barStyle={backgroundColor:color}}else if(this.options.selectionBarGradient){var offset=null!==this.options.showSelectionBarFromValue?this.valueToPosition(this.options.showSelectionBarFromValue):0,reversed=offset-position>0^isSelectionBarFromRight,direction=this.options.vertical?reversed?"bottom":"top":reversed?"left":"right";this.scope.barStyle={backgroundImage:"linear-gradient(to "+direction+", "+this.options.selectionBarGradient.from+" 0%,"+this.options.selectionBarGradient.to+" 100%)"},this.options.vertical?(this.scope.barStyle.backgroundPosition="center "+(offset+dimension+position+(reversed?-this.handleHalfDim:0))+"px",this.scope.barStyle.backgroundSize="100% "+(this.barDimension-this.handleHalfDim)+"px"):(this.scope.barStyle.backgroundPosition=offset-position+(reversed?this.handleHalfDim:0)+"px center",this.scope.barStyle.backgroundSize=this.barDimension-this.handleHalfDim+"px 100%")}},getSelectionBarColor:function(){return this.range?this.options.getSelectionBarColor(this.scope.rzSliderModel,this.scope.rzSliderHigh):this.options.getSelectionBarColor(this.scope.rzSliderModel)},getPointerColor:function(pointerType){return"max"===pointerType?this.options.getPointerColor(this.scope.rzSliderHigh,pointerType):this.options.getPointerColor(this.scope.rzSliderModel,pointerType)},getTickColor:function(value){return this.options.getTickColor(value)},updateCmbLabel:function(){if(this.options.rightToLeft?this.minLab.rzsp-this.minLab.rzsd-10<=this.maxLab.rzsp:this.minLab.rzsp+this.minLab.rzsd+10>=this.maxLab.rzsp){var lowTr=this.getDisplayValue(this.lowValue,"model"),highTr=this.getDisplayValue(this.highValue,"high"),labelVal="";labelVal=this.options.mergeRangeLabelsIfSame&&lowTr===highTr?lowTr:this.options.rightToLeft?highTr+" - "+lowTr:lowTr+" - "+highTr,this.translateFn(labelVal,this.cmbLab,"cmb",!1);var pos=this.options.boundPointerLabels?Math.min(Math.max(this.selBar.rzsp+this.selBar.rzsd/2-this.cmbLab.rzsd/2,0),this.barDimension-this.cmbLab.rzsd):this.selBar.rzsp+this.selBar.rzsd/2-this.cmbLab.rzsd/2;this.setPosition(this.cmbLab,pos),this.cmbLabelShown=!0,this.hideEl(this.minLab),this.hideEl(this.maxLab),this.showEl(this.cmbLab)}else this.cmbLabelShown=!1,this.showEl(this.maxLab),this.showEl(this.minLab),this.hideEl(this.cmbLab);this.options.autoHideLimitLabels&&this.shFloorCeil()},getDisplayValue:function(value,which){return this.options.stepsArray&&!this.options.bindIndexForStepsArray&&(value=this.getStepValue(value)),this.customTrFn(value,this.options.id,which)},roundStep:function(value,customStep){var step=customStep||this.step,steppedDifference=parseFloat((value-this.minValue)/step).toPrecision(12);return steppedDifference=Math.round(+steppedDifference)*step,+(this.minValue+steppedDifference).toFixed(this.precision)},hideEl:function(element){return element.css({visibility:"hidden"})},showEl:function(element){return element.rzAlwaysHide?element:element.css({visibility:"visible"})},setPosition:function(elem,pos){elem.rzsp=pos;var css={};return css[this.positionProperty]=Math.round(pos)+"px",elem.css(css),pos},getDimension:function(elem){var val=elem[0].getBoundingClientRect();return this.options.vertical?elem.rzsd=(val.bottom-val.top)*this.options.scale:elem.rzsd=(val.right-val.left)*this.options.scale,elem.rzsd},setDimension:function(elem,dim){elem.rzsd=dim;var css={};return css[this.dimensionProperty]=Math.round(dim)+"px",elem.css(css),dim},sanitizeValue:function(val){return Math.min(Math.max(val,this.minValue),this.maxValue)},valueToPosition:function(val){var fn=this.linearValueToPosition;this.options.customValueToPosition?fn=this.options.customValueToPosition:this.options.logScale&&(fn=this.logValueToPosition),val=this.sanitizeValue(val);var percent=fn(val,this.minValue,this.maxValue)||0;return this.options.rightToLeft&&(percent=1-percent),percent*this.maxPos},linearValueToPosition:function(val,minVal,maxVal){return(val-minVal)/(maxVal-minVal)},logValueToPosition:function(val,minVal,maxVal){return val=Math.log(val),minVal=Math.log(minVal),maxVal=Math.log(maxVal),(val-minVal)/(maxVal-minVal)},positionToValue:function(position){var percent=position/this.maxPos;this.options.rightToLeft&&(percent=1-percent);var fn=this.linearPositionToValue;return this.options.customPositionToValue?fn=this.options.customPositionToValue:this.options.logScale&&(fn=this.logPositionToValue),fn(percent,this.minValue,this.maxValue)||0},linearPositionToValue:function(percent,minVal,maxVal){return percent*(maxVal-minVal)+minVal},logPositionToValue:function(percent,minVal,maxVal){minVal=Math.log(minVal),maxVal=Math.log(maxVal);var value=percent*(maxVal-minVal)+minVal;return Math.exp(value)},getEventXY:function(event){var clientXY=this.options.vertical?"clientY":"clientX";return void 0!==event[clientXY]?event[clientXY]:void 0===event.originalEvent?event.touches[0][clientXY]:event.originalEvent.touches[0][clientXY]},getEventPosition:function(event){var sliderPos=this.sliderElem.rzsp;return(this.options.vertical?-this.getEventXY(event)+sliderPos:this.getEventXY(event)-sliderPos)*this.options.scale-this.handleHalfDim},getEventNames:function(event){var eventNames={moveEvent:"",endEvent:""};return event.touches||void 0!==event.originalEvent&&event.originalEvent.touches?(eventNames.moveEvent="touchmove",eventNames.endEvent="touchend"):(eventNames.moveEvent="mousemove",eventNames.endEvent="mouseup"),eventNames},getNearestHandle:function(event){if(!this.range)return this.minH;var position=this.getEventPosition(event),distanceMin=Math.abs(position-this.minH.rzsp),distanceMax=Math.abs(position-this.maxH.rzsp);return distanceMin<distanceMax?this.minH:distanceMin>distanceMax?this.maxH:this.options.rightToLeft?position>this.minH.rzsp?this.minH:this.maxH:position<this.minH.rzsp?this.minH:this.maxH},focusElement:function(el){el[0].focus()},bindEvents:function(){var barTracking,barStart,barMove;this.options.draggableRange?(barTracking="rzSliderDrag",barStart=this.onDragStart,barMove=this.onDragMove):(barTracking="lowValue",barStart=this.onStart,barMove=this.onMove),this.options.onlyBindHandles||(this.selBar.on("mousedown",angular.bind(this,barStart,null,barTracking)),this.selBar.on("mousedown",angular.bind(this,barMove,this.selBar))),this.options.draggableRangeOnly?(this.minH.on("mousedown",angular.bind(this,barStart,null,barTracking)),this.maxH.on("mousedown",angular.bind(this,barStart,null,barTracking))):(this.minH.on("mousedown",angular.bind(this,this.onStart,this.minH,"lowValue")),this.range&&this.maxH.on("mousedown",angular.bind(this,this.onStart,this.maxH,"highValue")),this.options.onlyBindHandles||(this.fullBar.on("mousedown",angular.bind(this,this.onStart,null,null)),this.fullBar.on("mousedown",angular.bind(this,this.onMove,this.fullBar)),this.ticks.on("mousedown",angular.bind(this,this.onStart,null,null)),this.ticks.on("mousedown",angular.bind(this,this.onTickClick,this.ticks)))),this.options.onlyBindHandles||(this.selBar.on("touchstart",angular.bind(this,barStart,null,barTracking)),this.selBar.on("touchstart",angular.bind(this,barMove,this.selBar))),this.options.draggableRangeOnly?(this.minH.on("touchstart",angular.bind(this,barStart,null,barTracking)),this.maxH.on("touchstart",angular.bind(this,barStart,null,barTracking))):(this.minH.on("touchstart",angular.bind(this,this.onStart,this.minH,"lowValue")),this.range&&this.maxH.on("touchstart",angular.bind(this,this.onStart,this.maxH,"highValue")),this.options.onlyBindHandles||(this.fullBar.on("touchstart",angular.bind(this,this.onStart,null,null)),this.fullBar.on("touchstart",angular.bind(this,this.onMove,this.fullBar)),this.ticks.on("touchstart",angular.bind(this,this.onStart,null,null)),this.ticks.on("touchstart",angular.bind(this,this.onTickClick,this.ticks)))),this.options.keyboardSupport&&(this.minH.on("focus",angular.bind(this,this.onPointerFocus,this.minH,"lowValue")),this.range&&this.maxH.on("focus",angular.bind(this,this.onPointerFocus,this.maxH,"highValue")))},unbindEvents:function(){this.minH.off(),this.maxH.off(),this.fullBar.off(),this.selBar.off(),this.ticks.off()},onStart:function(pointer,ref,event){var ehMove,ehEnd,eventNames=this.getEventNames(event);event.stopPropagation(),event.preventDefault(),this.calcViewDimensions(),pointer?this.tracking=ref:(pointer=this.getNearestHandle(event),this.tracking=pointer===this.minH?"lowValue":"highValue"),pointer.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(pointer),ehMove=angular.bind(this,this.dragging.active?this.onDragMove:this.onMove,pointer),ehEnd=angular.bind(this,this.onEnd,ehMove),$document.on(eventNames.moveEvent,ehMove),$document.one(eventNames.endEvent,ehEnd),this.callOnStart()},onMove:function(pointer,event,fromTick){var newValue,newPos=this.getEventPosition(event),ceilValue=this.options.rightToLeft?this.minValue:this.maxValue,flrValue=this.options.rightToLeft?this.maxValue:this.minValue;newPos<=0?newValue=flrValue:newPos>=this.maxPos?newValue=ceilValue:(newValue=this.positionToValue(newPos),newValue=fromTick&&angular.isNumber(this.options.showTicks)?this.roundStep(newValue,this.options.showTicks):this.roundStep(newValue)),this.positionTrackingHandle(newValue)},onEnd:function(ehMove,event){var moveEventName=this.getEventNames(event).moveEvent;this.options.keyboardSupport||(this.minH.removeClass("rz-active"),this.maxH.removeClass("rz-active"),this.tracking=""),this.dragging.active=!1,$document.off(moveEventName,ehMove),this.callOnEnd()},onTickClick:function(pointer,event){this.onMove(pointer,event,!0)},onPointerFocus:function(pointer,ref){this.tracking=ref,pointer.one("blur",angular.bind(this,this.onPointerBlur,pointer)),pointer.on("keydown",angular.bind(this,this.onKeyboardEvent)),pointer.on("keyup",angular.bind(this,this.onKeyUp)),this.firstKeyDown=!0,pointer.addClass("rz-active"),this.currentFocusElement={pointer:pointer,ref:ref}},onKeyUp:function(){this.firstKeyDown=!0,this.callOnEnd()},onPointerBlur:function(pointer){pointer.off("keydown"),pointer.off("keyup"),this.tracking="",pointer.removeClass("rz-active"),this.currentFocusElement=null},getKeyActions:function(currentValue){var increaseStep=currentValue+this.step,decreaseStep=currentValue-this.step,increasePage=currentValue+this.valueRange/10,decreasePage=currentValue-this.valueRange/10,actions={UP:increaseStep,DOWN:decreaseStep,LEFT:decreaseStep,RIGHT:increaseStep,PAGEUP:increasePage,PAGEDOWN:decreasePage,HOME:this.minValue,END:this.maxValue};return this.options.rightToLeft&&(actions.LEFT=increaseStep,actions.RIGHT=decreaseStep,this.options.vertical&&(actions.UP=decreaseStep,actions.DOWN=increaseStep)),actions},onKeyboardEvent:function(event){var currentValue=this[this.tracking],keyCode=event.keyCode||event.which,keys={38:"UP",40:"DOWN",37:"LEFT",39:"RIGHT",33:"PAGEUP",34:"PAGEDOWN",36:"HOME",35:"END"},actions=this.getKeyActions(currentValue),key=keys[keyCode],action=actions[key];if(null!=action&&""!==this.tracking){event.preventDefault(),this.firstKeyDown&&(this.firstKeyDown=!1,this.callOnStart());var self=this;$timeout(function(){var newValue=self.roundStep(self.sanitizeValue(action));if(self.options.draggableRangeOnly){var newMinValue,newMaxValue,difference=self.highValue-self.lowValue;"lowValue"===self.tracking?(newMinValue=newValue,(newMaxValue=newValue+difference)>self.maxValue&&(newMaxValue=self.maxValue,newMinValue=newMaxValue-difference)):(newMaxValue=newValue,(newMinValue=newValue-difference)<self.minValue&&(newMinValue=self.minValue,newMaxValue=newMinValue+difference)),self.positionTrackingBar(newMinValue,newMaxValue)}else self.positionTrackingHandle(newValue)})}},onDragStart:function(pointer,ref,event){var position=this.getEventPosition(event);this.dragging={active:!0,value:this.positionToValue(position),difference:this.highValue-this.lowValue,lowLimit:this.options.rightToLeft?this.minH.rzsp-position:position-this.minH.rzsp,highLimit:this.options.rightToLeft?position-this.maxH.rzsp:this.maxH.rzsp-position},this.onStart(pointer,ref,event)},getValue:function(type,newPos,outOfBounds,isAbove){var isRTL=this.options.rightToLeft,value=null;return value="min"===type?outOfBounds?isAbove?isRTL?this.minValue:this.maxValue-this.dragging.difference:isRTL?this.maxValue-this.dragging.difference:this.minValue:isRTL?this.positionToValue(newPos+this.dragging.lowLimit):this.positionToValue(newPos-this.dragging.lowLimit):outOfBounds?isAbove?isRTL?this.minValue+this.dragging.difference:this.maxValue:isRTL?this.maxValue:this.minValue+this.dragging.difference:isRTL?this.positionToValue(newPos+this.dragging.lowLimit)+this.dragging.difference:this.positionToValue(newPos-this.dragging.lowLimit)+this.dragging.difference,this.roundStep(value)},onDragMove:function(pointer,event){var newMinValue,newMaxValue,ceilLimit,flrLimit,isUnderFlrLimit,isOverCeilLimit,flrH,ceilH,newPos=this.getEventPosition(event);if(this.options.rightToLeft?(ceilLimit=this.dragging.lowLimit,flrLimit=this.dragging.highLimit,flrH=this.maxH,ceilH=this.minH):(ceilLimit=this.dragging.highLimit,flrLimit=this.dragging.lowLimit,flrH=this.minH,ceilH=this.maxH),isUnderFlrLimit=newPos<=flrLimit,isOverCeilLimit=newPos>=this.maxPos-ceilLimit,isUnderFlrLimit){if(0===flrH.rzsp)return;newMinValue=this.getValue("min",newPos,!0,!1),newMaxValue=this.getValue("max",newPos,!0,!1)}else if(isOverCeilLimit){if(ceilH.rzsp===this.maxPos)return;newMaxValue=this.getValue("max",newPos,!0,!0),newMinValue=this.getValue("min",newPos,!0,!0)}else newMinValue=this.getValue("min",newPos,!1),newMaxValue=this.getValue("max",newPos,!1);this.positionTrackingBar(newMinValue,newMaxValue)},positionTrackingBar:function(newMinValue,newMaxValue){null!=this.options.minLimit&&newMinValue<this.options.minLimit&&(newMinValue=this.options.minLimit,newMaxValue=newMinValue+this.dragging.difference),null!=this.options.maxLimit&&newMaxValue>this.options.maxLimit&&(newMaxValue=this.options.maxLimit,newMinValue=newMaxValue-this.dragging.difference),this.lowValue=newMinValue,this.highValue=newMaxValue,this.applyLowValue(),this.range&&this.applyHighValue(),this.applyModel(),this.updateHandles("lowValue",this.valueToPosition(newMinValue)),this.updateHandles("highValue",this.valueToPosition(newMaxValue))},positionTrackingHandle:function(newValue){var valueChanged=!1;newValue=this.applyMinMaxLimit(newValue),this.range&&(this.options.pushRange?(newValue=this.applyPushRange(newValue),valueChanged=!0):(this.options.noSwitching&&("lowValue"===this.tracking&&newValue>this.highValue?newValue=this.applyMinMaxRange(this.highValue):"highValue"===this.tracking&&newValue<this.lowValue&&(newValue=this.applyMinMaxRange(this.lowValue))),newValue=this.applyMinMaxRange(newValue),"lowValue"===this.tracking&&newValue>this.highValue?(this.lowValue=this.highValue,this.applyLowValue(),this.updateHandles(this.tracking,this.maxH.rzsp),this.updateAriaAttributes(),this.tracking="highValue",this.minH.removeClass("rz-active"),this.maxH.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(this.maxH),valueChanged=!0):"highValue"===this.tracking&&newValue<this.lowValue&&(this.highValue=this.lowValue,this.applyHighValue(),this.updateHandles(this.tracking,this.minH.rzsp),this.updateAriaAttributes(),this.tracking="lowValue",this.maxH.removeClass("rz-active"),this.minH.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(this.minH),valueChanged=!0))),this[this.tracking]!==newValue&&(this[this.tracking]=newValue,"lowValue"===this.tracking?this.applyLowValue():this.applyHighValue(),this.updateHandles(this.tracking,this.valueToPosition(newValue)),this.updateAriaAttributes(),valueChanged=!0),valueChanged&&this.applyModel()},applyMinMaxLimit:function(newValue){return null!=this.options.minLimit&&newValue<this.options.minLimit?this.options.minLimit:null!=this.options.maxLimit&&newValue>this.options.maxLimit?this.options.maxLimit:newValue},applyMinMaxRange:function(newValue){var oppositeValue="lowValue"===this.tracking?this.highValue:this.lowValue,difference=Math.abs(newValue-oppositeValue);return null!=this.options.minRange&&difference<this.options.minRange?"lowValue"===this.tracking?this.highValue-this.options.minRange:this.lowValue+this.options.minRange:null!=this.options.maxRange&&difference>this.options.maxRange?"lowValue"===this.tracking?this.highValue-this.options.maxRange:this.lowValue+this.options.maxRange:newValue},applyPushRange:function(newValue){var difference="lowValue"===this.tracking?this.highValue-newValue:newValue-this.lowValue,minRange=null!==this.options.minRange?this.options.minRange:this.options.step,maxRange=this.options.maxRange;return difference<minRange?("lowValue"===this.tracking?(this.highValue=Math.min(newValue+minRange,this.maxValue),newValue=this.highValue-minRange,this.applyHighValue(),this.updateHandles("highValue",this.valueToPosition(this.highValue))):(this.lowValue=Math.max(newValue-minRange,this.minValue),newValue=this.lowValue+minRange,this.applyLowValue(),this.updateHandles("lowValue",this.valueToPosition(this.lowValue))),this.updateAriaAttributes()):null!==maxRange&&difference>maxRange&&("lowValue"===this.tracking?(this.highValue=newValue+maxRange,this.applyHighValue(),this.updateHandles("highValue",this.valueToPosition(this.highValue))):(this.lowValue=newValue-maxRange,this.applyLowValue(),this.updateHandles("lowValue",this.valueToPosition(this.lowValue))),this.updateAriaAttributes()),newValue},applyModel:function(){this.internalChange=!0,this.scope.$apply(),this.callOnChange(),this.internalChange=!1},callOnStart:function(){if(this.options.onStart){var self=this,pointerType="lowValue"===this.tracking?"min":"max";this.scope.$evalAsync(function(){self.options.onStart(self.options.id,self.scope.rzSliderModel,self.scope.rzSliderHigh,pointerType)})}},callOnChange:function(){if(this.options.onChange){var self=this,pointerType="lowValue"===this.tracking?"min":"max";this.scope.$evalAsync(function(){self.options.onChange(self.options.id,self.scope.rzSliderModel,self.scope.rzSliderHigh,pointerType)})}},callOnEnd:function(){if(this.options.onEnd){var self=this,pointerType="lowValue"===this.tracking?"min":"max";this.scope.$evalAsync(function(){self.options.onEnd(self.options.id,self.scope.rzSliderModel,self.scope.rzSliderHigh,pointerType)})}this.scope.$emit("slideEnded")}},Slider}]).directive("rzslider",["RzSlider",function(RzSlider){return{restrict:"AE",replace:!0,scope:{rzSliderModel:"=?",rzSliderHigh:"=?",rzSliderOptions:"&?",rzSliderTplUrl:"@"},templateUrl:function(elem,attrs){return attrs.rzSliderTplUrl||"rzSliderTpl.html"},link:function(scope,elem){scope.slider=new RzSlider(scope,elem)}}}]);return module.run(["$templateCache",function($templateCache){$templateCache.put("rzSliderTpl.html",'<div class=rzslider><span class=rz-bar-wrapper><span class=rz-bar></span></span> <span class=rz-bar-wrapper><span class="rz-bar rz-selection" ng-style=barStyle></span></span> <span class="rz-pointer rz-pointer-min" ng-style=minPointerStyle></span> <span class="rz-pointer rz-pointer-max" ng-style=maxPointerStyle></span> <span class="rz-bubble rz-limit rz-floor"></span> <span class="rz-bubble rz-limit rz-ceil"></span> <span class=rz-bubble></span> <span class=rz-bubble></span> <span class=rz-bubble></span><ul ng-show=showTicks class=rz-ticks><li ng-repeat="t in ticks track by $index" class=rz-tick ng-class="{\'rz-selected\': t.selected}" ng-style=t.style ng-attr-uib-tooltip="{{ t.tooltip }}" ng-attr-tooltip-placement={{t.tooltipPlacement}} ng-attr-tooltip-append-to-body="{{ t.tooltip ? true : undefined}}"><span ng-if="t.value != null" class=rz-tick-value ng-attr-uib-tooltip="{{ t.valueTooltip }}" ng-attr-tooltip-placement={{t.valueTooltipPlacement}}>{{ t.value }}</span> <span ng-if="t.legend != null" class=rz-tick-legend>{{ t.legend }}</span></li></ul></div>')}]),module.name}),function(){"use strict";angular.module("app.templates",[])}(),function(){"use strict";function run(_,$window,featureCheckerService){function initFeatureFlags(event){featureCheckerService.init(event.detail)}$window.addEventListener("featureFlags",initFeatureFlags,!1)}run.$inject=["_","$window","featureCheckerService"],angular.module("app.shared.feature_flag",[]).run(run)}(),function(){"use strict";function config($httpProvider){$httpProvider.interceptors.push("jsVersionInterceptor")}function run(utmService){utmService.saveUTMParams(utmService.parseUTMParamsFromURL()),utmService.initUTMTrackerListener()}config.$inject=["$httpProvider"],run.$inject=["utmService"],angular.module("app.core",[]).constant("moment",window.moment).constant("_",window._).constant("Rx",window.Rx).constant("grecaptcha",window.grecaptcha).constant("Raven",window.Raven).constant("googletag",window.googletag).constant("he",window.he).config(config).run(run)}(),angular.module("app.banner",[]),angular.module("app.input",[]),function(){"use strict";function config($httpProvider){}config.$inject=["$httpProvider"],angular.module("app.permission",[]).config(config)}(),function(){"use strict";function config(_,$httpProvider,$authProvider,Routes,$provide){function satellizerStorageDecorator($delegate){function get(key){return _.endsWith(key,"_state")?key+"_IZY1IBQWYHHB8":null}return $delegate.get=get,$delegate.set=_.noop,$delegate.remove=_.noop,$delegate}satellizerStorageDecorator.$inject=["$delegate"];var facebookClientId=window.facebook_id||null,googleClientId=window.gplus_id||null,twitterClientId=window.twitter_id||null,linkedInClientId=window.linkedin_id||null;$authProvider.httpInterceptor=!1,$authProvider.baseUrl="/",$authProvider.loginUrl=Routes.AUTH.LOGIN.USER_PASS,$authProvider.signupUrl="/signup",$authProvider.tokenRoot="data",$authProvider.tokenName="refresh_token",$authProvider.facebook({url:Routes.AUTH.LOGIN.FACEBOOK,clientId:facebookClientId}),$authProvider.google({url:Routes.AUTH.LOGIN.GOOGLE,clientId:googleClientId}),$authProvider.twitter({url:Routes.AUTH.LOGIN.TWITTER,clientId:twitterClientId}),$authProvider.linkedin({url:Routes.AUTH.LOGIN.LINKEDIN,clientId:linkedInClientId}),$httpProvider.interceptors.push("authAccessTokenInterceptor"),$httpProvider.interceptors.push("actionInterceptor"),$provide.decorator("SatellizerStorage",satellizerStorageDecorator)}function run(QuerystringRouter,authModalService,UrlService,authService,authTokenSyncService,UserService){function confirmPassword(data){/^([a-f0-9]{32})$/.test(data.token)&&authModalService.openConfirmPassword(data)}function resetPassword(){authModalService.openResetPassword()}function confirmEmail(data){/^([0-9]+)$/.test(data.uid)&&/^([a-f0-9]{32})$/.test(data.token)&&authModalService.openConfirmEmail(data)}function confirmAccount(data){/^([a-f0-9]{32})$/.test(data.token)&&authModalService.openActivateAccount(data)}function campaignSignup(data){authModalService.setSubscribeSource("Direct"),authModalService.openSignup("campaign_signup",data)}function companySignup(data){authModalService.setSubscribeSource("Direct"),authModalService.openSignup("company_signup",data)}function login(data){function onLoginSuccess(){data.referer&&UrlService.changeUrl(resolveReferer(data.referer))}authModalService.openLogin("default",data).then(onLoginSuccess)}function signup(data){authModalService.setSubscribeSource("Direct"),authModalService.openSignup("default",data)}function openSuccessfullyRegistered(data){authModalService.openSuccessfullyRegistered(data)}function openAccountsSignup(data){authModalService.openAccountsSignup(data)}function confirmUserEmail(data){authModalService.openConfirmUserEmail(data)}function refreshAccessToken(){if(UserService.getCurrentUser().isLoggedIn())return authService.refreshAccessToken();authModalService.openLogin("default")}function resolveReferer(refererUrl){switch(refererUrl){case"create-password":return"/spa#/app/account/personal/create-password"}return refererUrl}return authService.init(),authTokenSyncService.init(),QuerystringRouter.when("confirm_password",confirmPassword).when("reset_password",resetPassword).when("confirm_email",confirmEmail).when("confirm_account",confirmAccount).when("campaign_signup",campaignSignup).when("company_signup",companySignup).when("login",login).when("signup",signup).when("conferences_success",openSuccessfullyRegistered).when("accounts",openAccountsSignup).when("refresh",refreshAccessToken).when("confirm_user_email",confirmUserEmail)}config.$inject=["_","$httpProvider","$authProvider","Routes","$provide"],run.$inject=["QuerystringRouter","authModalService","UrlService","authService","authTokenSyncService","UserService"],angular.module("app.auth",["satellizer","app.data"]).config(config).run(run)}(),function(){"use strict";function config($httpProvider){$httpProvider.interceptors.push("signatureInterceptor")}function run(){}config.$inject=["$httpProvider"],angular.module("app.sign",[]).config(config).run(run)}(),function(){function config($httpProvider){$httpProvider.interceptors.push("identityInterceptor")}function run(authStream,UserService,userIdentityService){userIdentityService.init(),authStream.USER_CHANGED.subscribe(UserService.onUserChanged)}config.$inject=["$httpProvider"],run.$inject=["authStream","UserService","userIdentityService"],angular.module("app.user",[]).config(config).run(run)}(),function(){"use strict";function run(authStream,AccountService){authStream.USER_CHANGED.subscribe(AccountService.onUserChanged)}run.$inject=["authStream","AccountService"],angular.module("app.mua",[]).run(run)}(),function(){"use strict";function config(){}function run(wallTrackingService){wallTrackingService.init()}run.$inject=["wallTrackingService"],angular.module("app.wall",[]).config(config).run(run)}(),function(){"use strict";function config(){}function run(authStream,godService){authStream.USER_CHANGED.subscribe(godService.onUserChanged)}run.$inject=["authStream","godService"],angular.module("app.god_bar",[]).config(config).run(run)}(),angular.module("app.data",[]),angular.module("app.company",[]),function(){"use strict";function config(){}function run(_,$log,$injector,authStream,bofListenerService,snowplowEventListenerService){function onUserChanged(user){bofListenerService.setUser(user),snowplowEventListenerService.setUser(user),bofListenerService.init()}_.each(["intercomTransformerService","intercomListenerService","dataLayerPageviewListenerService","gaEventListenerService","gaPageViewListenerService","gaArticleLinksListenerService"],function(serviceName){try{$injector.get(serviceName).init()}catch(e){$log.debug('app.tracker::run:: Injector does not contain service "%s". Service not initted!',serviceName)}}),authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}run.$inject=["_","$log","$injector","authStream","bofListenerService","snowplowEventListenerService"],angular.module("app.tracker",[]).config(config).run(run)}(),function(){"use strict";function run(snowplowListenerService,snowplowService){snowplowService.init(),snowplowListenerService.init()}run.$inject=["snowplowListenerService","snowplowService"],angular.module("app.track",[]).run(run)}(),angular.module("app.ui",[]).run(["_","DomService","EventManager","UiEvents","$evalAsync","$rootScope","$timeout","$window","QuerystringRouter","UiModalService","UiTemplates",function(_,DomService,EventManager,UiEvents,$evalAsync,$rootScope,$timeout,$window,QuerystringRouter,UiModalService,UiTemplates){DomService.bind("click",function(event){$evalAsync(function(){EventManager.emit(UiEvents.WINDOW_CLICK,{status:!0,event:event})})}),DomService.bindRxThrottle("touchend",150,function(event){$evalAsync(function(){EventManager.emit(UiEvents.WINDOW_CLICK,{status:!0,event:event})})}),EventManager.emit(UiEvents.WINDOW_RESIZE,{status:!0}),DomService.bind("resize",function(){$evalAsync(function(){EventManager.emit(UiEvents.WINDOW_RESIZE,{status:!0})})}),DomService.bindRxThrottle("scroll",150,function(){EventManager.emit(UiEvents.WINDOW_SCROLL,{status:!0})}),DomService.bindRxThrottle("touchmove",150,function(){EventManager.emit(UiEvents.WINDOW_SCROLL,{status:!0})}),$rootScope.$on("$stateChangeStart",function(evt,to,params){EventManager.emit(UiEvents.ROUTE_CHANGED,{params:params,routeName:to.name})}),$window.addEventListener("message",function(event){EventManager.emit(UiEvents.POST_MESSAGE,event)},!1),QuerystringRouter.when("open_feedback_modal",function(){UiModalService.openModal(_.assign(UiTemplates.OPEN_FEEDBACK_MODAL,{backdrop:!1}),{type_id:1})})}]),angular.module("app.bootstrap",[]),angular.module("app.ratelimit",[]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("RateLimitInterceptor")}]),function(){"use strict";function config($httpProvider){$httpProvider.interceptors.push("errorHandlerInterceptor")}config.$inject=["$httpProvider"],angular.module("app.shared.error_handler",[]).config(config)}(),function(){"use strict";angular.module("app.shared.article",["app.core"])}(),function(){"use strict";function run(authStream,featureFlagStream,storageService,savedArticleService){function onFeatureFlagsLoaded(featureFlags){featureFlags.isEnabled("SAVED_ARTICLES")&&(authStream.USER_DATA_CHANGED.subscribe(savedArticleService.onUserDataChanged),storageService.STORAGE_STREAM.subscribe(savedArticleService.onLocalStorageChange))}featureFlagStream.FEATURE_FLAGS_CHANGED.subscribe(onFeatureFlagsLoaded)}run.$inject=["authStream","featureFlagStream","storageService","savedArticleService"],angular.module("app.shared.saved_article",["app.core"]).run(run)}(),function(){"use strict";angular.module("app.bof500",[])}(),angular.module("app.disqus",["ngDisqus"]).config(function(){}),function(){"use strict";function config(){}function run(){}angular.module("app.membership",[]).config(config).run(run)}(),angular.module("app.share",[]).config(function(){}),angular.module("app.pusher",[]).run(["PusherService","$window",function(PusherService,$window){}]),angular.module("app.nav",[]).run(["DomService","EventManager","UiEvents",function(DomService,EventManager,UiEvents){"use strict";EventManager.on(UiEvents.WINDOW_CLICK,function(data){EventManager.emit("NavigationChangeDropdown",{emitter:null,status:!1})}),EventManager.on(UiEvents.WINDOW_SCROLL,function(data){EventManager.emit("NavigationClose",{})})}]),angular.module("app.home",[]),angular.module("app.discussion",[]),angular.module("app.daily_digest",[]),function(){"use strict";function run(wallStream,TwitterWidgetService,InstagramWidgetService,TrackerService,trackService){wallStream.ARTICLE_LOADED.subscribe(function(payload){TwitterWidgetService.initTwitterWidgetScript(),InstagramWidgetService.initInstagramWidgetScript(),TrackerService.track("Article","PageView",{id:payload.article_id}),trackService.track({subject:"user",action:"view",object:"article",objectId:payload.article_id})})}run.$inject=["wallStream","TwitterWidgetService","InstagramWidgetService","TrackerService","trackService"],angular.module("app.article",[]).run(run)}(),angular.module("app.education",["chart.js"]).config(["ChartJsProvider",function(ChartJsProvider){ChartJsProvider.setOptions({responsive:!0,showTooltips:!1,segmentStrokeWidth:2,percentageInnerCutout:80,animationEasing:"easeOutQuart",scaleShowGridLines:!1,scaleShowHorizontalLines:!1,scaleShowVerticalLines:!1})}]),angular.module("app.newsletter",[]).config(function(){}),angular.module("app.menu",[]),angular.module("app.career",[]),angular.module("app.profile",[]),angular.module("app.search",[]).config(function(){}),function(){"use strict";function run(doubleClickService,authStream){doubleClickService.init(),authStream.USER_CHANGED.subscribe(doubleClickService.onUserChanged)}run.$inject=["doubleClickService","authStream"],angular.module("app.ads",[]).run(run)}(),angular.module("app.youtube",[]).config(function(){}),angular.module("app.show",[]).config(function(){}),function(){"use strict";angular.module("app.legacy-track",[])}(),angular.module("app.subscription",[]).run(["EventManager","SubscriptionService","AuthEvents",function(EventManager,SubscriptionService,AuthEvents){"use strict";EventManager.on(AuthEvents.USER_CHANGED,function(user){user.id&&SubscriptionService.init()})}]),function(){"use strict";function config(){}function run(_,$window,authStream,intercomService){function initIntercom(){function onIntercomInitted(){authStream.USER_CHANGED.subscribe(intercomService.onUserChanged)}intercomService.init().then(onIntercomInitted)}var initIntercomOnce=_.once(initIntercom);$window.addEventListener("initIntercom",initIntercomOnce,!1)}run.$inject=["_","$window","authStream","intercomService"],angular.module("app.intercom",[]).config(config).run(run)}(),angular.module("app.crypt",[]).constant("CryptoJS",CryptoJS).constant("Crc32",crc32),function(){angular.module("app.community",[])}(),angular.module("app.conference",[]).config(function(){}),angular.module("app.board",[]).config(function(){}),function(){"use strict";function config(recurlyServiceProvider,RecurlyServiceLegacyProvider,GlobalParams){recurlyServiceProvider.setPublicKey(GlobalParams.RECURLY_PUBLIC_KEY),RecurlyServiceLegacyProvider.setPublicKey(GlobalParams.RECURLY_PUBLIC_KEY)}function run(_,recurlyStream,errorLoggerService,recurlyDownModalService){function onRecurlyError(error){if(!error||!error.code||!_.includes(["validation","invalid-parameter","not-found"],error.code)){var errorMessage=_.get(error,"message")||"Error on recurly form";errorMessage="FE Recurly Error: "+errorMessage,errorLoggerService.log(errorMessage,error,"memberships")}}recurlyStream.ERROR.subscribe(onRecurlyError),recurlyDownModalService.init()}config.$inject=["recurlyServiceProvider","RecurlyServiceLegacyProvider","GlobalParams"],run.$inject=["_","recurlyStream","errorLoggerService","recurlyDownModalService"],angular.module("app.recurly",[]).config(config).run(run)}(),angular.module("app.news",[]),angular.module("app.payment",[]).config(function(){}),angular.module("app.coupon",[]).config(function(){}),angular.module("app.shared.education",[]).config(function(){}).run(["QuerystringRouter","EducationUrlService",function(QuerystringRouter,EducationUrlService){"use strict";QuerystringRouter.when("enroll",function(data){EducationUrlService.autoOpenPayment=!0})}]),angular.module("app.site.user",[]),angular.module("app.sticky_header",[]).config(function(){}),angular.module("app.owl_carousel",[]),function(){"use strict";function config(){}function run(){}angular.module("app.site.promos",[]).config(config).run(run)}(),function(){"use strict";function config($httpProvider){$httpProvider.interceptors.push("captchaInterceptor")}function run(){}config.$inject=["$httpProvider"],angular.module("app.captcha",[]).config(config).run(run)}(),function(){"use strict";angular.module("app.browser_event",[])}(),function(){"use strict";function config(){}function run(){}angular.module("app.site.podcast",[]).config(config).run(run)}(),angular.module("app.voices.animation",[]).config(function(){}),angular.module("app.shared.job",[]),angular.module("app.shared.newsletter",[]),angular.module("app.shared.message",[]),angular.module("app.shared.swiperCarousel",[]),function(){"use strict";function run(consentRepaperingService){consentRepaperingService.init()}run.$inject=["consentRepaperingService"],angular.module("app.shared.consentJourney",[]).run(run)}(),function(){"use strict";angular.module("app.shared.account",[])}(),function(){"use strict";angular.module("app.shared.membership",[])}(),function(){"use strict";angular.module("app.shared.organisation",[])}(),angular.module("app.salesforce",[]).config(function(){}),function(){function featureCheckerService(_,featureFlagModel,featureFlagStream){function init(gtmFeatureFlags){var featureFlag=new featureFlagModel(gtmFeatureFlags);featureFlagStream.FEATURE_FLAGS_CHANGED.onNext(featureFlag)}return{init:_.once(init)}}featureCheckerService.$inject=["_","featureFlagModel","featureFlagStream"],angular.module("app.shared.feature_flag").factory("featureCheckerService",featureCheckerService)}(),function(){"use strict";function FeatureFlagController($log,featureFlagStream){function $onInit(){$ctrl.featureEnabled=!1,listener=featureFlagStream.FEATURE_FLAGS_CHANGED.subscribe(onFeatureFlagChanged)}function $onDestroy(){listener.dispose()}function onFeatureFlagChanged(FeatureFlags){$log.debug("featureFlag::FeatureFlagController::onFeatureFlagChanged::",FeatureFlags),$ctrl.featureEnabled=FeatureFlags.isEnabled($ctrl.feature)}var listener,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var featureFlagComponent={template:'<span ng-if="$ctrl.featureEnabled" ng-transclude></span>',transclude:!0,bindings:{feature:"@"},controller:FeatureFlagController};angular.module("app.shared.feature_flag").component("featureFlag",featureFlagComponent)}(),function(){"use strict";function featureFlagModel(){function FeatureFlag(FEATURE_FLAG_PAYLOAD){function isEnabled(featureKey){return!!FEATURE_FLAG_PAYLOAD[featureKey]}this.isEnabled=isEnabled}return FeatureFlag}angular.module("app.shared.feature_flag").factory("featureFlagModel",featureFlagModel)}(),function(){"use strict";function featureFlagStream(LazyStream){return{FEATURE_FLAGS_CHANGED:new LazyStream}}featureFlagStream.$inject=["LazyStream"],angular.module("app.shared.feature_flag").factory("featureFlagStream",featureFlagStream)}(),angular.module("app.core").constant("CoreConstants",{DATE_FORMAT:{DB:"YYYY-MM-DD HH:mm:ss",SIMPLE:"MMMM Do YYYY",DEFAULT:"D MMMM YYYY"}}),angular.module("app.core").constant("CoreEvents",{REPAINT:"CoreRepaint",PREVENT_LINK_DEFAULT:"CoreLinkPrevent"}),function(){angular.module("app.core").constant("FlagKeys",{MARKETING_PAGE_VIEW:"MEM-MPV"})}(),function(){angular.module("app.core").constant("StorageKeys",{ACCESS_TOKEN:"ACC_TKN",REFRESH_TOKEN:"RFR_TKN",COOKIE_NOTIFICATION:"acceptedCookies",ALREADY_LOGGED_IN:"alreadyLoggedIn",SESSION_ID:"_SID",DEVICE_ID:"_UH",LAST_USER_ID:"_LUID",GOD_TOKEN:"_ADMIN_TOKEN",LAST_VISITED_URL:"LastRef",SPA_MENU_OPENED:"SPAMenuStatus",CURRENT_ACCOUNT_ID:"currentAccountId",BOF_PROFESSIONAL_DISMISSAL_DATE:"BoFProfessionalBannerDismissalTimestamp",RANKINGS_PROMO_FOOTER_DISMISSED:"dismissRankingsPromoFooter",BEST_COMPANIES_PROMO_FOOTER_DISMISSED:"dismissBestCompaniesPromoFooter",USER_REGISTRATION_EMAIL:"userRegistrationEmail",GROUP_MEMBERSHIP_PARAMETERS:"GRP_PAR",BOF_PROFESSIONAL_DWELL_DISMISSAL_DATE:"DWT",MEMBERSHIP_SHARED_LOGIN_DISMISSAL_DATE:"SLD",PAYMENT_DETAILS_UPDATE_DATE:"PDU",SAVED_ARTICLES:"SA",SAVED_ARTICLES_QUEUE:"SAQ",UTM_FIRST_TOUCH:"UTMFirstTouch",UTM_LAST_TOUCH:"UTMLastTouch",JOB_ALERTS_FILTERS:"CreateJobAlertsQueryFilters",LAST_REPAPERING_SKIP:"LRS",REPAPERING_SKIP_COUNT:"RSC"})}(),angular.module("app.core").constant("CoreValidations",{EMAIL:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,DIGIT:/^\d+$/,URL:/((http|https):\/\/)?[a-zA-Z0-9.\/?:@\-_=#]+\.([a-zA-Z0-9&.\/?:@\-_=#])*/,PASSWORD:/(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).{8,50}/,PHONE_NUMBER:/^\+?[\d()-]*$/}),angular.module("app.core").directive("agentSettings",["$log","AgentService",function($log,AgentService){return{restrict:"A",link:function(scope,element,attrs){var classConcat,classList=[],ngElm=angular.element(element);AgentService.isTouch()?classList.push("touchscreen"):classList.push("desktop"),AgentService.isIE()&&classList.push("browser_ie"),classConcat=classList.join(" "),ngElm.addClass(classConcat)}}}]),angular.module("app.core").directive("href",["EventManager","EventManagerUtility","UrlService","CoreEvents",function(EventManager,EventManagerUtility,UrlService,CoreEvents){"use strict";return{restrict:"A",link:function(scope,element,attrs){var listeners=[],isAnchor=!!attrs.href&&0===attrs.href.indexOf("#"),destination=isAnchor?UrlService.getCurrentUrl()+attrs.href:attrs.href,openInTab=!1;element.bind("click",function(event){openInTab&&(event.stopImmediatePropagation(),event.preventDefault(),event.stopPropagation(),UrlService.openNewTab(destination))}),listeners.push(EventManager.on(CoreEvents.PREVENT_LINK_DEFAULT,function(data){openInTab=data.status})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.core").directive("anchorReload",["$timeout","$window","DomService","UrlService",function($timeout,$window,DomService,UrlService){"use strict";return{restrict:"A",link:function(scope,element,attrs){var timeout="true"===attrs.immediate?1e3:3e3;$timeout(function(){UrlService.hasAnchor()&&($window.location.href=$window.location.href),attrs.offset&&DomService.setBodyScroll(DomService.getBodyScroll()-parseInt(attrs.offset,10))},timeout)}}}]),angular.module("app.core").directive("autofocus",["$timeout",function($timeout){"use strict";return{restrict:"A",link:function(scope,element){$timeout(function(){element[0].focus()},500)}}}]),angular.module("app.core").directive("disableIfPreFilled",["$timeout",function($timeout){"use strict";return{restrict:"A",require:"ngModel",link:function(scope,element,ctrl){var watchRef=null;watchRef=scope.$watch(function(){return element.val()},function(nv,ov){nv&&element.attr("disabled","disabled"),watchRef()})}}}]),angular.module("app.core").directive("embeddableCode",["$timeout","DomService",function($timeout,DomService){"use strict";return{restrict:"E",transclude:!0,replace:!0,template:'<input ng-click="selectText()" class="form-control" value="{[{ value }]}" type="text" autocapitalize="off" autocorrect="off" autocomplete="off"/>',scope:{isolate:"@"},link:function(scope,element,attrs,controller,transclude){var domElement=element[0],domEmbeddableCode=transclude();scope.value=DomService.DOMtoString(domEmbeddableCode),scope.selectText=function(){domElement.select()},element.bind("keypress",function(e){e.preventDefault()})}}}]),angular.module("app.core").directive("fastClick",function(){"use strict";return{restrict:"A",link:function(scope,element){element.bind("touchend",function(event){event.stopPropagation()})}}}),angular.module("app.core").directive("formControl",["_","$timeout","$log",function(_,$timeout,$log){return{restrict:"A",require:["ngModel","^formGroup"],link:function(scope,element,attrs,ctrls){var timer=null,watchRef=(element[0],null),watchRefDirty=null,ngModel=ctrls[0],formGroup=ctrls[1],formGroupField=attrs.id||attrs.name;formGroup.setField(ngModel,formGroupField),$log.debug("formControl::link::setField",formGroupField),ngModel.$timedout=_.get(attrs,"timedout",!1),ngModel.$forceInvalid=!1,watchRef=scope.$watch(function(){return element.val()},function(nv,ov){nv===ov||ngModel.$viewValue||(ngModel.$setViewValue(nv),watchRef())}),watchRefDirty=scope.$watch(function(){return ngModel.$viewValue},function(nv,ov){_.isEmpty(nv)||(ngModel.$setDirty(),watchRefDirty())}),scope.startTimer=function(timeLimit){timer=$timeout(function(){scope.$apply(function(){ngModel.$timedout=!0})},timeLimit)},scope.cancelTimer=function(){$timeout.cancel(timer),ngModel.$timedout=!1},element.bind("keydown",function(){attrs.hasServerSideValidation&&ngModel.$setValidity("server",!0),timer&&scope.cancelTimer(),scope.startTimer(1e3)}),element.bind("touchend",function(event){event.stopPropagation()})}}}]),angular.module("app.core").directive("formGroup",function(){return{template:'<div class="has-feedback form-group"     ng-class="{\'has-error\': ($field.$forceInvalid && $field.$timedout) || ($field.$invalid && $field.$dirty && $field.$timedout), \'input-fixed\': fixed }">    <label ng-if="::(label)" for="{{inputId}}" class="{[{::classLabel}]}">        {{::label}}    </label>    <div ng-transclude></div>    <span class="inline text-error"          ng-if="(($field.$forceInvalid && $field.$timedout) || ($field.$invalid && $field.$dirty && $field.$timedout)) && help !== undefined && !$field.$pristine">        {[{::help}]}    </span>    <span ng-if="::(fixed)"          class="inline text-error">&nbsp;</span></div>',replace:!0,restrict:"E",transclude:!0,scope:{help:"@",label:"@",classLabel:"@",fixed:"@"},controller:["$scope",function($scope){this.setField=function(field,id){$scope.$field=field,$scope.inputId=id,field.$helpMessage=$scope.help}}]}}),angular.module("app.core").directive("formatDate",["$log","moment","DateService",function($log,moment,DateService){"use strict";return{scope:{maxHours:"@",date:"@",formatFallback:"@"},template:"<span>{[{formattedDate}]}</span>",replace:!0,restrict:"E",transclude:!1,link:function(scope,element,attrs){scope.formattedDate="";var maxHours=parseInt(scope.maxHours,10),test=moment().subtract(maxHours,"hours"),original=moment(DateService.fromString(scope.date)),currentDate=new Date,yesterday=original.isSame(currentDate.setDate(currentDate.getDate()-1),"day");if(maxHours>0)if(original>test)scope.formattedDate=original.fromNow();else if(yesterday)scope.formattedDate="yesterday";else{var format=scope.formatFallback||"DD/MM/YYYY";scope.formattedDate=original.format(format)}else scope.formattedDate=original.fromNow()}}}]),angular.module("app.core").directive("imgBase64",["$log","CanvasService",function($log,CanvasService){"use strict";return{restrict:"E",replace:!0,template:"<img></img>",link:function(scope,element,attrs){var canvas=new CanvasService,e=element[0];canvas.addImage(attrs.source,attrs.width).then(function(data){e.src=canvas.getDataURL()})}}}]),angular.module("app.core").directive("imgCover",["$log","ImageService","DomService",function($log,ImageService,DomService){"use strict";return{restrict:"E",replace:"true",template:'<div class="c_img-cover"></div>',scope:{src:"@",ngSrc:"@"},link:function(scope,element,attrs){var osrc=scope.src?scope.src:scope.ngSrc,img=scope.responsiveSrc?scope.responsiveSrc:osrc,src=null,linked=!1,el=element[0],containerWidth=(angular.element(el),0),containerHeight=0;containerWidth=DomService.getParentWidth(element),containerHeight=DomService.getParentHeight(element),src=ImageService.getImageDimension(img,containerWidth,containerHeight),scope.refresh=function(){if(!linked){if(DomService.getBottom(el)+100>=0){$log.debug("imgCover::refresh:: Loading image:",src),linked=!0;var image=new Image;image.onload=function(){el.style.backgroundImage="url("+image.src+")"},image.src=src}DomService.requestAnimationFrame(scope.refresh)}},scope.refresh()}}}]),angular.module("app.core").directive("imgResponsive",["$log","ImageService","DomService","$timeout","AgentService",function($log,ImageService,DomService,$timeout,AgentService){"use strict";return{restrict:"C",scope:{src:"@",ngSrc:"@",responsiveSrc:"@",responsiveSrcMobile:"@",background:"@",maxWidth:"@",lazy:"@"},link:function(scope,element,attrs){var osrc=scope.src?scope.src:scope.ngSrc,img=(AgentService.isMobile()?scope.responsiveSrcMobile||scope.responsiveSrc:scope.responsiveSrc)||osrc,containerWidth=scope.maxWidth?parseInt(scope.maxWidth):null,src=null,linked=!1,el=element[0],elRef=angular.element(el),lazy="true"===scope.lazy;containerWidth||(containerWidth=DomService.getParentWidth(element)),src=ImageService.getImage(img,containerWidth),scope.refresh=function(){if(!linked){if(DomService.getBottom(el)+100>=0){linked=!0,elRef.addClass("init");var image=new Image;image.onload=function(){scope.background?el.style.backgroundImage="url("+image.src+")":el.src=image.src,elRef.addClass("loaded")},image.src=src}DomService.requestAnimationFrame(scope.refresh)}},lazy?$timeout(function(){scope.refresh()},300):scope.refresh()}}}]),angular.module("app.core").directive("maxWordCount",function(){"use strict";return{require:"ngModel",link:function(scope,element,attrs,ctrl){var maxLimit=attrs.maxWordCount;ctrl.$parsers.unshift(function(value){var valid=!0;return value&&(valid=value.split(" ").length<=maxLimit),ctrl.$setValidity("maxWordCount",valid),valid?value:void 0}),ctrl.$formatters.unshift(function(value){var valid=!0;return value&&(valid=value.split(" ").length<=maxLimit),ctrl.$setValidity("maxWordCount",valid),value})}}}),angular.module("app.core").directive("ngLazyMouseover",["$log","$parse","GlobalTick",function($log,$parse,GlobalTick){"use strict";return{restrict:"A",compile:function($element,attr){var fn=$parse(attr.ngLazyMouseover,null,!0);return function(scope,element){element.on("mouseout",function(event){GlobalTick.cancel()}),element.on("mousepress",function(event){GlobalTick.cancel()}),element.on("mouseover",function(event){var callback=function(){fn(scope,{$event:event})};GlobalTick.execute(callback,350)})}}}}]),angular.module("app.auth").directive("modalOpenBackDrop",["EventManager","AgentService","DomService","AuthEvents",function(EventManager,AgentService,DomService,AuthEvents){"use strict";return{restrict:"A",link:function(scope,element,attrs){var backDrop=angular.element(element[0]),parentNode=DomService.getHtmlTag();EventManager.on(AuthEvents.PROTECT_CONTENT,function(data){data.status?(data.preventBlur||backDrop.addClass("modal-drop"),parentNode.addClass("freeze-page")):(backDrop.removeClass("modal-drop"),parentNode.removeClass("freeze-page"))})}}}]),angular.module("app.core").directive("promiseButton",["$log","$timeout",function($log,$timeout){return{scope:{id:"@",action:"&",test:"&",buttonClass:"@",defaultLabel:"@",busyLabel:"@",successLabel:"@",errorLabel:"@",defaultMessage:"@",busyMessage:"@",successMessage:"@",errorMessage:"@",disabled:"@",preventMultipleSubmissions:"@"},template:'<div><button ng-disabled="{[{::disabled}]}" class="relative btn" id="{[{::id}]}" ng-class="{disabled:isWaiting,\'is-loading\':isWaiting}" ng-click="submit()"><span class="button-label">{[{label}]}</span><span class="button-label" ng-transclude>{[{label}]}</span><span class="spinner icon-spin5 animate-spin"></span></button><div class="text-error text-center">{[{message}]}</div></div>',replace:!0,transclude:!0,restrict:"E",link:function(scope,element,attrs){scope.label=scope.defaultLabel,scope.message="",scope.isWaiting=!1,scope.isSuccessfullySent=!1;var buttonElement=angular.element(element[0].childNodes[0]),messageElement=angular.element(element[0].childNodes[1]),buttonStatusColour={default:attrs.defaultButtonClass||"btn-danger",wait:attrs.waitButtonClass||"btn-warning",error:attrs.errorButtonClass||"btn-danger",success:attrs.successButtonClass||"btn-success"},labelStatusColour={default:attrs.defaultTextClass||"text-danger",wait:attrs.waitTextClass||"text-warning",error:attrs.errorTextClass||"text-danger",success:attrs.successTextClass||"text-success"};scope.buttonClass?buttonElement.addClass(scope.buttonClass):buttonElement.addClass("btn-default"),scope.checktest=function(){return!scope.test||scope.test()},scope.resetCss=function(){buttonElement.removeClass(buttonStatusColour.error),messageElement.removeClass(labelStatusColour.error),buttonElement.removeClass(buttonStatusColour.success),messageElement.removeClass(labelStatusColour.success),buttonElement.removeClass(buttonStatusColour.default),messageElement.removeClass(labelStatusColour.default),buttonElement.removeClass(buttonStatusColour.wait),messageElement.removeClass(labelStatusColour.wait)},scope.defaultButton=function(){scope.resetCss(),scope.label=scope.defaultLabel,scope.message=scope.defaultMessage,buttonElement.addClass(buttonStatusColour.default),messageElement.addClass(labelStatusColour.default)},scope.defaultButton(),scope.resetToDefault=function(){$timeout.cancel(scope.timer),scope.timer=$timeout(function(){scope.defaultButton()},3e3)},scope.resetStatus=function(){scope.isWaiting=!1,buttonElement.removeAttr("disabled"),scope.resetCss()},scope.busyStatus=function(){scope.isWaiting=!0,buttonElement.attr("disabled","disabled"),scope.label=scope.busyLabel,scope.message=scope.busyMessage,scope.resetCss(),buttonElement.addClass(buttonStatusColour.default),messageElement.addClass(labelStatusColour.default)},scope.successStatus=function(){scope.resetStatus(),scope.label=scope.successLabel,scope.message=scope.successMessage,scope.resetCss(),buttonElement.addClass(buttonStatusColour.success),messageElement.addClass(labelStatusColour.success),scope.isSuccessfullySent=!0,scope.preventMultipleSubmissions||scope.resetToDefault()},scope.errorStatus=function(){scope.resetStatus(),scope.label=scope.errorLabel,scope.message=scope.errorMessage,scope.resetCss(),buttonElement.addClass(buttonStatusColour.error),messageElement.addClass(labelStatusColour.error),scope.resetToDefault()},scope.submit=function(){scope.isSuccessfullySent&&scope.preventMultipleSubmissions||(scope.defaultButton(),scope.checktest()?(scope.busyStatus(),scope.action().then(function(result){result&&!0===result.canceled?(scope.resetStatus(),scope.defaultButton()):scope.successStatus()},function(result){scope.errorStatus()})):(buttonElement.addClass("shake animated"),scope.message=scope.errorMessage,$timeout(function(){buttonElement.removeClass("shake animated"),scope.defaultButton()},6e3)))}}}}]),angular.module("app.core").directive("saveImage",["CanvasService","$window",function(CanvasService,$window){"use strict";return{restrict:"A",link:function(scope,element,attrs){var Canvas=new CanvasService,filename=void 0!==attrs.filename?attrs.filename:"image.png";Canvas.addImage(attrs.href).then(function(){}),element.bind("click",function(e){e.preventDefault();var newUrl=Canvas.getStreamContent();e.download=filename,$window.location.href=newUrl})}}}]),angular.module("app.core").directive("selectReload",["UrlService",function(UrlService){"use strict";return{restrict:"A",link:function(scope,element,attrs){scope.selectModel=attrs.current||{},scope.handleSelect=function(){var url=scope.selectModel;attrs.attachCurrentQueryString&&(url+=UrlService.getQueryString(UrlService.parseQuery())),UrlService.changeUrl(url)}}}}]),angular.module("app.core").directive("showHideBlock",["EventManager","$localStorage","DomService",function(EventManager,$localStorage,DomService){return{scope:{id:"@",offset:"@",isVisible:"@",storeData:"@",animate:"@"},template:'<div ng-cloak><div class="animate-hide" ng-show="status" ng-transclude></div></div>',replace:!0,transclude:!0,restrict:"E",link:function(scope,element,attrs){var blockOffset=parseInt(scope.offset,10)||0,storeData="false"!==scope.storeData,animationEnabled="false"!==scope.animate;scope.status="false"!==scope.isVisible,storeData&&(void 0!==$localStorage[scope.id]?scope.status=$localStorage[scope.id]:scope.status=!0),scope.handleStatus=function(status){scope.status=status,storeData&&($localStorage[scope.id]=status)},EventManager.on("hideOnClick",function(data){data.id===scope.id&&(scope.handleStatus(data.status),data.status&&animationEnabled&&DomService.scrollToElement(element,blockOffset,2e3))})}}}]).directive("showHideBlockEmitter",["EventManager",function(EventManager){return{restrict:"E",transclude:!0,replace:!0,scope:{id:"@",status:"@",preventDefault:"@"},template:'<div ng-transclude ng-click="handleClick($event)"></div>',link:function(scope,element,attrs){var emitStatus="true"===scope.status,preventDefault="true"===scope.preventDefault;scope.handleClick=function(event){preventDefault&&event.preventDefault(),EventManager.emit("hideOnClick",{id:scope.id,status:emitStatus})}}}}]),angular.module("app.core").directive("stopPropagation",function(){"use strict";return{restrict:"A",link:function(scope,element){element.bind("touchend",function(event){event.stopPropagation()}),element.bind("click",function(event){event.stopPropagation()})}}}),angular.module("app.core").directive("stopScroll",["$log","AgentService","DomService",function($log,AgentService,DomService){return{restrict:"A",link:function(scope,element,attrs){var ref=element[0];element.bind("touchmove",function(event){0!==DomService.getTop(ref)&&event.preventDefault()})}}}]),angular.module("app.core").filter("moment_dateformat",["_","moment","CoreConstants",function(_,moment,CoreConstants){"use strict";return function(value,format){return format=format||CoreConstants.DATE_FORMAT.DEFAULT,_.has(CoreConstants.DATE_FORMAT,format)&&(format=CoreConstants.DATE_FORMAT[format]),moment(value).format(format)}}]).filter("moment_default_dateformat",["_","moment",function(_,moment){"use strict";return function(value){return _.isEmpty(value)?"":moment(value).format("DD/MM/YYYY")}}]).filter("sanitise_html",function(){"use strict";return function(value){return value.replace(/<[\/\!]*(DOCTYPE)[^>]*>/gi,"").replace(/<br[\s\/]*>/gi," ").replace(/<[\/\s]*(span|body|head|html|a|title|h1|h2|h3|h4|h5)[^>]*>/gi,"")}}),angular.module("app.core").filter("openross",["ImageService",function(ImageService){"use strict";return function(src,width,height,ratio,mode,offsetX,offsetY){return mode=mode||"magic",ratio&&(height=parseInt(width*ratio,10)),height=height||width,ImageService.getOpenRossImage(src,width,height,mode,offsetX,offsetY)}}]).filter("joinAttribute",function(){"use strict";return function(items,attr,separator,finalSeperator){separator=separator||", ",finalSeperator=finalSeperator||" And ";var clonedItems=items.slice(0),lastitem=clonedItems.pop(),res=[];return 0===clonedItems.length?lastitem[attr]:(angular.forEach(clonedItems,function(item){res.push(item[attr])}),res.join(separator)+finalSeperator+lastitem[attr])}}).filter("join",function(){"use strict";return function(items,attr,separator){return separator=separator||", ",items.join(separator)}}).filter("newlineToBR",function(){"use strict";return function(value){return value?value.replace(/[\n\r]/g,"<br/>"):value}}).filter("stripquotes",function(){"use strict";return function(value){return value?value.replace(/[\"\']+/g,"`"):value}}).filter("capitalise",["_",function(_){"use strict";return function(value){return value?_.capitalize(value):value}}]).filter("unescape",["_",function(_){"use strict";return function(value){return value?_.unescape(value).replace(/&amp;/g,"&").replace(/&#039;/g,"'").replace(/&#034;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/&#34;/g,'"').replace(/&ndash;/g,"-").replace(/&quot;/g,'"').replace(/&ldquo;/g,"'").replace(/&rdquo;/g,'"').replace(/&rsquo;/g,'"').replace(/&.*;/g,"").replace(/[\]/g,"-").replace(/(<([^(>|br|p)]+)>)/gi,""):value}}]).filter("dateformat",["moment",function(moment){"use strict";return function(value,format){return moment(value).format("D MMMM YYYY")}}]).filter("dayformat",["moment",function(moment){"use strict";return function(value,format){return moment(value).format("dddd")}}]).filter("getFirstVideoID",function(){"use strict";return function(item){return item.videos&&item.videos.length>0?item.videos[0].embed:""}}).filter("authorProfile",["_","joinAttributeFilter",function(_,joinAttributeFilter){"use strict";return function(item,key,fallback){if(item.authors.length>0){var author=item.authors[0];if(!_.isEmpty(author.profile)){if(void 0!==key&&key.constructor===Array){var res=[];return angular.forEach(key,function(att){res.push(author.profile[att])}),res.join(", ")}return author.profile[key]}return fallback=fallback||"display_name",joinAttributeFilter(item.authors,fallback)}return null}}]).filter("authors",["_","joinAttributeFilter",function(_,joinAttributeFilter){"use strict";return function(authors,key,fallback){return authors&&authors.length>0?(fallback=fallback||"display_name",joinAttributeFilter(authors,fallback)):null}}]).filter("taxonomyCategories",["$sce",function($sce){"use strict";return function(items,className,separator,category){className=className||"",separator=separator||", ";var res=[],candidate=items[0],found=!1;return angular.forEach(items,function(item){(!found&&void 0!==item.parent||category&&item.term_slug==category)&&(candidate=item,found=!0)}),res.push('<a href="'+candidate.url+'" class="'+className+'">'+candidate.term_name+"</a>"),$sce.trustAsHtml(res.join(separator))}}]).filter("excludeTaxonomyCategory",["$sce",function($sce){"use strict";return function(items,categoryName){return angular.forEach(items,function(item,index){item.hasOwnProperty("term_slug")&&item.term_slug===categoryName&&items.splice(index,1)}),items}}]).filter("raw",["$sce",function($sce){"use strict";return function(src){return $sce.trustAsHtml(src)}}]).filter("raw_url",["$sce",function($sce){"use strict";return function(src){return $sce.trustAsResourceUrl(src)}}]).filter("number_format",["$filter",function($filter){"use strict";return function(src){return $filter("number")(src)}}]).filter("striptags",function(){"use strict";return function(src){return src}}).filter("commentsWidget",["$sce","commonWidgetFilter",function($sce,commonWidgetFilter){"use strict";return function(src,includeText,includeIcon){return $sce.trustAsHtml(commonWidgetFilter(parseInt(src.comment_metrics.total_comments,10),void 0===includeText||includeText,void 0===includeIcon||includeIcon,"icon-comment","Comment","Comments"))}}]).filter("sharesWidget",["$sce","commonWidgetFilter",function($sce,commonWidgetFilter){"use strict";return function(src,includeText,includeIcon){return $sce.trustAsHtml(commonWidgetFilter(parseInt(src.social_metrics.total_shares,10),void 0===includeText||includeText,void 0===includeIcon||includeIcon,"icon-share","Share","Shares"))}}]).filter("commonWidget",["number_formatFilter",function(number_formatFilter){"use strict";return function(totals,includeText,includeIcon,icon,text,pluralText){if(!includeText&&!includeIcon)return totals>0?number_formatFilter(totals):"";var out="";return includeText&&(out=totals>1?"<b>"+number_formatFilter(totals)+"</b> "+pluralText:1==totals?"<b>1</b> "+text:text),includeIcon?'<i class="'+icon+'"></i> '+out:out}}]).filter("number_format",function(){"use strict";return function(number,decimals,dec_point,thousands_sep){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+number)?+number:0,prec=isFinite(+decimals)?Math.abs(decimals):0,sep=void 0===thousands_sep?",":thousands_sep,dec=void 0===dec_point?".":dec_point,s="";return s=(prec?function(n,prec){var k=Math.pow(10,prec);return""+Math.round(n*k)/k}(n,prec):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec)}}).filter("flatten",["_","$sce",function(_,$sce){return function(data,key,separator){return separator=separator||", ",$sce.trustAsHtml(_.map(data,key).join(separator))}}]).filter("geticon",function(){"use strict";return function(label,type,size){return size=size||"md",["/assets-access-layer/images",type,size,label+".png"].join("/")}}).filter("toList",["_","$sce",function(_,$sce){return function(data,key){return _.map(data,key)}}]).filter("pick",["_",function(_){return function(sequence,keys){var picker=function(val){return val[keys]};return _.isArray(keys)&&(picker=function(val){_.pick(val,keys)}),_.map(sequence,picker)}}]),function(){"use strict";function $evalAsync($rootScope){return function(callable){$rootScope.$evalAsync(callable)}}$evalAsync.$inject=["$rootScope"],angular.module("app.core").factory("$evalAsync",$evalAsync)}(),angular.module("app.core").factory("AgentService",["$log","$window",function($log,$window){"use strict";function Factory(){this.isTouch=function(){return"ontouchstart"in $window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},this.isMobilePhone=function(){return $window.innerWidth<730},this.isMobile=function(){return $window.innerWidth<=780},this.isDesktop=function(){return $window.innerWidth>=1024},this.isIE=function(){return new RegExp(/edge|trident|msie/i).test(navigator.userAgent)},this.isLegacyIE=function(){return new RegExp(/trident|msie/i).test(navigator.userAgent)},this.isSafari=function(){return new RegExp(/^((?!chrome|android).)*safari/i).test(navigator.userAgent)},this.isIOS=function(){return new RegExp(/(iPad|iPhone|iPod)/g).test(navigator.userAgent)}}return new Factory}]),angular.module("app.core").factory("AnimateFactory",["$q","$timeout",function($q,$timeout){"use strict";function Factory(elm,classes,duration){var transitionDuration=duration;this.enter=function(initCb){var deferred=$q.defer();return initCb&&initCb(),elm.classList.add.apply(elm.classList,classes.enter),duration||(transitionDuration=getTransitionDuration(elm)),$timeout(function(){elm.classList.remove.apply(elm.classList,classes.enter),deferred.resolve("done")},transitionDuration),deferred.promise},this.leave=function(initCb){var deferred=$q.defer();return initCb&&initCb(),elm.classList.add.apply(elm.classList,classes.leave),duration||(transitionDuration=getTransitionDuration(elm)),$timeout(function(){elm.classList.remove.apply(elm.classList,classes.leave),deferred.resolve("done")},transitionDuration),deferred.promise}}function getTransitionDuration(elm){var style=window.getComputedStyle(elm,null),duration=style.animationDuration;return duration.match(/\ds$/g)&&(duration=duration.replace("s",""),duration=1e3*parseFloat(duration)),duration}return Factory}]),angular.module("app.core").service("AntiCacheService",["$log","moment","CacheFactory",function($log,moment,CacheFactory){"use strict";this.add=function(){return{anticache:moment().format("XX")}}}]),angular.module("app.core").service("ArrayService",["$log","DateService",function($log,DateService){"use strict";this.range=function(n,steps,start){for(var results=[],i=start;i<=n*steps;i+=steps)results.push(i);return results},this.dateRange=function(n,skipWeekends){for(var i=0,results=[],date=new Date,cnt=0,base=date.getTime();i<n;)date=new Date(base+864e5*cnt),DateService.isWeekend(date)&&skipWeekends||(results.push(DateService.toString(date)),i+=1),cnt+=1;return results},this.timeRange=function(step){var results=[],date=new Date("2015/01/01 00:00:00"),toDate=new Date("2015/01/02 00:00:00"),base=date.getTime(),cnt=0;for(step=60*step*1e3;date<=toDate;)results.push({label:DateService.toTimeString(date),value:cnt*step}),cnt+=1,date=new Date(base+cnt*step);return results},this.rangePow=function(base,i,max){for(var results=[],n=0;n<max;)n=Math.floor(Math.pow(base,i)),results.push(n),i+=1;return results},this.remove=function(items,item){var index=null;angular.forEach(items,function(i,x){if(i.$$hashKey===item.$$hashKey)return index=x,!1}),index>=0&&items.splice(index,1)},this.replace=function(original,replace){angular.forEach(original,function(o){angular.forEach(replace,function(val,key){o[key]=val})})},this.select=function(items,key,value){var selected=null;return angular.forEach(items,function(item){if(item[key]===value)return selected=item,!1}),selected},this.selectAll=function(items,key,value){return items.filter(function(item){return item[key]===value})},this.extract=function(items,key){return items.map(function(item){return item[key]})},this.exists=function(items,key,value){var exists=!1;return angular.forEach(items,function(item){if(item[key]===value)return exists=!0,!1}),exists},this.inArray=function(items,item){return-1!==items.indexOf(item)},this.limit=function(items,limit){return items.splice(0,limit)}}]),angular.module("app.core").factory("CanvasService",["$log","$window","$q",function($log,$window,$q){"use strict";function Factory(){var self=this,element=$window.document.createElement("canvas"),context=element.getContext("2d"),canvas=$window.document.createDocumentFragment().appendChild(element);this.addImage=function(url,maxWidth){var deferred=$q.defer(),img=new Image;return img.crossOrigin="anonymous",img.onload=function(data){var res=self.drawImage(img,maxWidth);deferred.resolve(res)},img.src=url,deferred.promise},this.drawImage=function(img,maxWidth){maxWidth=parseInt(maxWidth,10)||200;var k=img.width/img.height;return context.canvas.width=maxWidth,context.canvas.height=maxWidth/k,context.drawImage(img,0,0,maxWidth,maxWidth/k),{canvas:canvas,image:this.getDataURL(),width:maxWidth,height:maxWidth/k}},this.getDataURL=function(){return canvas.toDataURL("image/jpg",.9)},this.getStreamContent=function(mime){return this.getDataURL().replace(/^data:image\/jpg/,"data:application/octet-stream")}}return Factory}]),angular.module("app.core").factory("ChannelManagerFactory",["EventDispatcher",function(EventDispatcher){"use strict";function Factory(debugEnabled){var channels={};this.get=function(name){var channel=null;return channels.hasOwnProperty(name)?channel=channels[name]:(channel=new EventDispatcher(name,debugEnabled),channels[name]=channel),channel},this.subscribe=function(name){return this.get(name)},this.destroy=function(name){channels.hasOwnProperty(name)&&(channels[name].destroy(),delete channels[name])}}return Factory}]).provider("ChannelManager",function(){"use strict";var DEBUG=!1;this.debugEnabled=function(value){DEBUG=value},this.$get=["ChannelManagerFactory",function(ChannelManagerFactory){return new ChannelManagerFactory(DEBUG)}]}),angular.module("app.core").service("DataService",["_","$log","moment","ArrayService",function(_,$log,moment,ArrayService){"use strict";var self=this;this.createFilters=function(defaultFilters,filters){return angular.extend(angular.copy(defaultFilters),filters)},this.normalise=function(items,removePrefix){if(angular.isArray(items))return items;var data=[],index=0,self=this;return angular.forEach(items,function(value,key){removePrefix&&(value=self.removePrefix(value)),value.selected=!1,value.index=index++,value.masterId=key,data.push(value)}),$log.debug("DataService:normalise",data),data},this.removePrefix=function(obj){var data={},keySplit=null;return angular.forEach(obj,function(value,key){keySplit=key.split("_");var cnt=-1;keySplit.length>2&&(cnt=-(keySplit.length-1)),keySplit=keySplit.splice(cnt).join("_"),data[keySplit]=value}),data},this.transformRequest=function(data){if(void 0===data)return data;var fd=new FormData;return angular.forEach(data,function(value,key){value instanceof FileList?1===value.length?fd.append(key,value[0]):angular.forEach(value,function(file,index){fd.append(key+"_"+index,file)}):fd.append(key,value)}),fd},this.buildDataFromAttributes=function(attrs,prefix){var res={},parts=[];return angular.forEach(attrs,function(val,key){parts=key.split(prefix),2===parts.length&&""!==parts[1]&&(res[parts[1]]=val)}),res},this.filterExtract=function(items,filterKey,extractKey){return items.filter(function(item){return item[filterKey]}).map(function(item){return item[extractKey]})},this.flatten=function(items,extractKey){return items.map(function(item){return item[extractKey]})},this.mergeAggregations=function(items,aggregationItems,originalKey,matchingKey){originalKey=originalKey||"id",matchingKey=matchingKey||"key";var active=ArrayService.extract(aggregationItems,matchingKey);items.map(function(item){item.enabled=ArrayService.inArray(active,item[originalKey]),item.enabled?item.count=ArrayService.select(aggregationItems,"key",item[originalKey]).doc_count:item.count=0})},this.sanitiseDataForQuerystring=function(dataObject,useKey,delimitator,sort){useKey=useKey||"id",delimitator=delimitator||",";var data={},newVal=null;return _.forEach(dataObject,function(value,key){if(_.isArray(value))if(value.length>0){var tmpVal=_.map(value,useKey);sort&&(tmpVal=_.sortBy(tmpVal)),newVal=tmpVal.join(delimitator)}else newVal=null;else newVal=value;newVal&&(data[key]=newVal)}),data},this.rebuildDataFromQuerystring=function(dataObject,filters,selectedKey,forceInt){selectedKey=selectedKey||"status",forceInt=!_.isBoolean(forceInt)||forceInt;var arrayData=null,selected={},converted=null,compacted=this.compactObject(dataObject),result={};return _.forEach(compacted,function(value,group){arrayData=value?value.split(","):[],_.isArray(arrayData)||(arrayData=[arrayData]),_.forEach(arrayData,function(itemId){filters.hasOwnProperty(group)&&(converted=parseInt(itemId,10),(selected=_.find(filters[group],["id",converted>0&&forceInt?converted:itemId]))&&(selected[selectedKey]=!0))})}),angular.forEach(filters,function(value,group){result[group]=value.filter(function(item){return item[selectedKey]})}),result},this.convertFilterQueryObject=function(filters){var newFilters=this.createFilters(filters),queryObj=_.clone(newFilters.query);return delete newFilters.query,_.assign(newFilters,queryObj),newFilters},this.compactObject=function(data){return _.pickBy(data,_.negate(_.isEmpty))},this.replace=function(source,originalData,key,hasToMerge){var selectedIndex=-1,data=_.clone(originalData);_.isArray(data)||(data=[data]),_.map(source,function(sourceItem,index){(selectedIndex=_.findIndex(data,[key,sourceItem[key]]))>-1&&(source[index]=hasToMerge?_.assign({},source[index],data[selectedIndex]):data[selectedIndex],data.splice(selectedIndex,1))}),_.isEmpty(data)||this.add(source,data,!0)},this.updateAsync=function(source,originalData,key,resourceLambda){var ids=(_.intersectionBy(originalData,source,key),_.map(source,function(x){return x[key]}));_.isEmpty(ids)||resourceLambda(ids).then(function(res){return self.addTrackBy(res.data.results,key),self.replace(originalData,res.data.results,key),res})},this.addAsync=function(source,originalData,key,resourceLambda,prepend){var ids=_.map(source,function(x){return x[key]});_.isEmpty(ids)||resourceLambda(ids).then(function(res){return self.addTrackBy(res.data.results,key),self.add(originalData,res.data.results,key,prepend),res})},this.add=function(source,data,prepend){_.isArray(data)||(data=[data]),_.map(data,function(dataItem,index){prepend?source.unshift(dataItem):source.push(dataItem)})},this.delete=function(source,data,key){_.isArray(data)||(data=[data]),_.map(data,function(dataItem,index){_.remove(source,function(sourceItem){return sourceItem[key]===dataItem[key]})})},this.deleteBy=function(source,data,key){_.isArray(data)||(data=[data]),_.map(data,function(dataItem,index){_.remove(source,function(sourceItem){return _.indexOf(data,sourceItem[key])>-1})})},this.findAndMerge=function(items,key,value,data){_.map(items,function(item){return item[key]===value&&_.assign(item,data),item})},this.addTrackBy=function(entity,key,date){if(!entity)return entity;var dateTime=_.isDate(date)?date.getTime():(new Date).getTime();return _.isArray(entity)?_.map(entity,function(i){i.trackBy=i[key]+"_"+dateTime}):entity.trackBy=entity[key]+"_"+dateTime,entity},this.addIndex=function(entity,key){return _.isArray(entity)&&_.map(entity,function(i,index){i[key]=index}),entity},this.normaliseFormData=function(data,pickKeys,allowedKeys,acceptNull){pickKeys=pickKeys||["id","label"];var res={};return _.forEach(data,function(value,key){(!_.isObject(value)&&!_.isEmpty(value)||_.isNumber(value)||_.isBoolean(value))&&(res[key]=value)}),_.forEach(data,function(value,key){_.isDate(value)?res[key]=moment(value).format("YYYY-MM-DD HH:mm:00"):_.isObject(value)&&_.forEach(pickKeys,function(k){(!_.isEmpty(value[k])||_.isNumber(value[k])||null===value[k]&&acceptNull)&&(res[key+"_"+k]=value[k])})}),allowedKeys&&(res=_.pick(res,allowedKeys)),_.map(res,function(value,key){res[key]=/^[\d]+$/.test(value)?parseInt(value,10):value}),res},this.normaliseData=function(data){var parts=[],newKey="";_.isArray(data)||(data=[data]),_.map(data,function(item){_.map(item,function(value,key){parts=key.split("_"),parts.length>1&&(newKey=parts.splice(1).join("_"),item[newKey]=value)})})},this.remapObject=function(data,lookupTable){var res={};return _.forEach(data,function(value,key){_.has(lookupTable,key)?res[lookupTable[key]]=value:res[key]=value}),res},this.flattenMultipleCollections=function(data,excludeArray,groupKey,uniqueKey){excludeArray=excludeArray||[],groupKey=groupKey||"group",uniqueKey=uniqueKey||"uniqueId";var res=[];return _.forEach(_.omit(data,excludeArray),function(collection,group){_.isArray(collection)&&(_.map(collection,function(item){item[groupKey]=group,item[uniqueKey]=group+"_"+item.id}),self.add(res,collection))}),res},this.filterCollectionBy=function(data,group,value){_.map(data,function(item){item.showItem=_.indexOf(item[group],value)>-1||0===value})},this.filterCollectionByArray=function(data,key,inArray){return _.filter(data,function(item){return _.includes(inArray,item.id)})},this.countObjectCollections=function(data){var res={};return _.forEach(data,function(v,k){res[k]=v.length}),res},this.zipData=function(arrayA,arrayB,keys){var res=[],temp={},zipped=_.zip(arrayA,arrayB);return _.map(zipped,function(item){temp={},_.forEach(keys,function(key,index){temp[key]=item[index]}),res.push(temp)}),res},this.createBulkData=function(data,key,keyValues){var res=[];return _.map(keyValues,function(value){res.push(_.assign(_.zipObject([key],[value]),data))}),res},this.createAssociativeStruct=function(data,input){var lookUp=[],res=[],original=[];return data.map(function(x){original.push(_.assign(_.omit(x,[input]),{relations:_.map(x[input],"id")})),x[input].map(function(y){if(!lookUp[y.id]){var temp=_.assign({},y);temp.relations=[],res.push(temp),lookUp[y.id]=temp}lookUp[y.id].relations.push(x.id)})}),{original:original,result:res}}}]),angular.module("app.core").service("DateService",["_","$log","moment",function(_,$log,moment){this.fromString=function(date){return new Date(date.replace(/-/g,"/").split(".")[0])},this.fromEuroString=function(data){return moment(data,"DD-MM-YYYY HH:mm").toDate()},this.toString=function(date){return date.getFullYear()+"-"+this.formatDate(date.getMonth()+1,2)+"-"+this.formatDate(date.getDate(),2)},this.toTimeString=function(date){return this.formatDate(date.getHours(),2)+":"+this.formatDate(date.getMinutes(),2)},this.toNormalisedString=function(date){return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+date.getMinutes()+":"+date.getSeconds()},this.toWeekOfYear=function(date){var currentDate=moment(date),week=currentDate.week(),year=currentDate.year();return 11===currentDate.month()&&1===week&&(year+=1),week+"-"+year},this.formatDate=function(number,zeroPadding){return(1e15+number+"").slice(-zeroPadding)},this.isWeekend=function(date){return 0===date.getDay()||6===date.getDay()},this.fromTimeString=function(time){var response=time.split(":"),date=new Date;return date.setHours(parseInt(response[0])),date.setMinutes(parseInt(response[1])),date},this.addDays=function(date,days){return new Date(+Date.parse(date)+864e5*days)},this.removeDays=function(date,days){return new Date(+Date.parse(date)-864e5*days)},this.addHours=function(date,hours){return new Date(+Date.parse(date)+36e5*hours)},this.getTimezones=function(){if(moment.tz){var res=[];return _.map(moment.tz.names(),function(value,key){res.push({id:value,label:value.replace(/[\_]/g," ")})}),res}},this.getCurrentTimezone=function(){moment.tz&&moment.tz.guess()},this.getTimezoneOffset=function(timezoneString){if(moment.tz)return"UTC"+moment.tz([],timezoneString).format("ZZ").substr(0,3)}}]),angular.module("app.core").service("DomService",["_","$log","$window","$document","$location","$anchorScroll","$timeout",function(_,$log,$window,$document,$location,$anchorScroll,$timeout){"use strict";var bodyElement=angular.element($document[0].body),htmlElement=angular.element(document.getElementsByTagName("html")[0]),cnt=1,windowRef=angular.element($window);this.bind=function(event,callback){return windowRef.on(event,callback)},this.bindRxThrottle=function(eventName,ttl,callback,element){return element=element||window,Rx.Observable.fromEvent(element,eventName).sample(ttl).subscribe(callback)},this.getElement=function(selector){return angular.element($window.document.querySelector(selector))},this.getElements=function(selector){return angular.element($window.document.querySelectorAll(selector))},this.getElementById=function(id){return angular.element(document.getElementById(id))},this.getHeight=function(element){return element?parseInt(element.getBoundingClientRect().height,10):$window.innerHeight},this.getWidth=function(element){return element?parseInt(element.getBoundingClientRect().width,10):$window.innerWidth},this.getParentWidth=function(element){for(var parent=null,width=0,i=0;i<10;i++){if(parent=angular.element(element).parent()[0],(width=this.getWidth(parent))>0)return width;element=parent}return null},this.getParentHeight=function(element){for(var parent=null,height=0,i=0;i<10;i++){if(parent=angular.element(element).parent()[0],(height=this.getHeight(parent))>0)return height;element=parent}return null},this.getTop=function(element){return parseInt(element.getBoundingClientRect().top,10)},this.getAbsoluteTop=function(element){return parseInt($window.pageYOffset+element.getBoundingClientRect().top,10)},this.getAbsoluteBottom=function(element){return parseInt(element.getBoundingClientRect().bottom-$window.innerHeight,10)},this.getBottom=function(element){return parseInt($window.innerHeight-element.getBoundingClientRect().top,10)},this.getLeft=function(element){return parseInt(element.getBoundingClientRect().left,10)},this.getRect=function(element){return element.getBoundingClientRect()},this.scrollToElement=function(element,offset,duration,parentNode){offset=offset||0,parentNode=parentNode||$document,duration=void 0!==duration?duration:500,angular.element(parentNode).scrollTo(element,offset,duration)},this.scrollToAnchor=function(id){$location.hash(id).replace(),$anchorScroll()},this.resetScroll=function(){$document.scrollToElement(bodyElement[0],0,500)},this.goToAnchor=function(){$window.location.hash&&($window.location.href=$window.location.href)},this.getBodyScroll=function(){return window.scrollY},this.setBodyScroll=function(scroll){bodyElement[0].scrollTop=scroll},this.bodyScrollable=function(status){status?(htmlElement.removeClass("noscroll"),bodyElement.removeClass("noscroll")):(htmlElement.addClass("noscroll"),bodyElement.addClass("noscroll"))},this.getBody=function(){return bodyElement},this.getWindowMaxSize=function(){return $window.screen.availHeight>$window.screen.availWidth?$window.screen.availWidth:$window.screen.availHeight},this.getPointerPosition=function(event){return{top:event.pageY,left:event.pageX}},this.getUniqueId=function(){return"unique_"+cnt++},this.getHtmlTag=function(){return htmlElement},this.DOMtoString=function(DOMNodeList){var HTMLstring=[];return _.remove(DOMNodeList,function(elm,index,array){if(1!==elm.nodeType)return elm}),_.forEach(DOMNodeList,function(elm,index,array){HTMLstring.push(elm.outerHTML)}),HTMLstring.join("").replace("ng-scope","")},this.requestAnimationFrame=function(callback){($window.requestAnimationFrame||$window.webkitRequestAnimationFrame||$window.mozRequestAnimationFrame||function(callback){$timeout(callback,1e3/30)})(callback)},this.isVisible=function(element){var coordinates=element.getBoundingClientRect();return coordinates.top>0&&coordinates.top<$window.innerHeight},this.resetScrollOnOnload=function(){Rx.Observable.fromEvent(window,"unload").subscribe(function(){window.scrollTo(0,0)})}}]),angular.module("app.core").service("DownloadService",["$log","$window","$timeout",function($log,$window,$timeout){"use strict";this.downloadFile=function(url,filename,target){var a=$window.document.createElement("a");a.href=url,a.target=target||"_blank",a.download=filename||"filename",$log.debug("DownloadService downloading: "+url);var el=$window.document.body.appendChild(a);$timeout(function(){a.click(),el.remove()},1e3)}}]),angular.module("app.core").factory("EventDispatcher",["_","$log","$timeout",function(_,$log,$timeout){"use strict";function Dispatcher(name,channel,debug){var rxRetain=new Rx.ReplaySubject(1),rxFresh=new Rx.Subject,eventName=name,channelName=channel;this.getSubject=function(doRetain){return doRetain?rxRetain:rxFresh},this.getStream=function(){return this.getSubject()},this.getLazyStream=function(){return this.getSubject(!0)},this.on=function(listener,doNotRetain){var listenerFunction=function(event){try{listener(event)}catch(e){$log.error("Error::"+channelName+":"+eventName,e)}},RxService=doNotRetain?rxFresh:rxRetain,subscription=null;return subscription=RxService.subscribe(listenerFunction,function(e){$log.error("Error::"+channelName+":"+eventName,e)}),function(){subscription.dispose()}},this.subscribe=this.on,this.emit=function(event){if(!_.isObject(event))return void $log.error("Error::"+channelName+":"+eventName);try{rxRetain.onNext(event),rxFresh.onNext(event)}catch(e){$log.error("Error::"+channelName+":"+eventName,e)}},this.removeAll=function(){rxRetain.dispose(),rxFresh.dispose()}}function EventFactory(name,debug){var dispatchers={},channelName=name,debugEnabled=debug;this.get=function(name){var dispatcher=null;return dispatchers.hasOwnProperty(name)?dispatcher=dispatchers[name]:(dispatcher=new Dispatcher(name,channelName,debugEnabled),dispatchers[name]=dispatcher),dispatcher},this.on=function(name,listener,doNotRetain){return name?this.get(name).on(listener,doNotRetain):void $log.error("EventDispatcher No Name Defined!")},this.onFresh=function(name,listener){return this.on(name,listener,!0)},this.emit=function(name,data,copyData){if(!name)return void $log.error("EventDispatcher No Name Defined!");this.get(name).emit(copyData?_.clone(data):data)},this.destroy=function(){_.forEach(dispatchers,function(dispatcher,dispatcherName){dispatcher.removeAll()}),dispatchers={}}}return EventFactory}]).provider("EventManager",function(){"use strict";var DEBUG=!1;this.debugEnabled=function(value){DEBUG=value},this.$get=["EventDispatcher",function(EventDispatcher){return new EventDispatcher("GLOBAL",DEBUG)}]}).service("EventManagerUtility",["_",function(_){this.removeListeners=function(listeners){_.forEach(listeners,function(removeListenerCallback){_.isFunction(removeListenerCallback)?removeListenerCallback():removeListenerCallback.dispose()})}}]),angular.module("app.core").service("FilterService",["_",function(_){"use strict";this.toMask=function(values){return _.isArray(values)||(values=_.map(values.split(","),function(x){return parseInt(x,10)})),_(values).map(function(x){return 1<<x-1}).reduce(function(x,a){return x+a})},this.fromString=function(filter){var status="-"!==_.head(filter.split(""));return{status:status,key:status?filter:_.last(filter.split("-"))}}}]),angular.module("app.core").factory("FormServiceFactory",function(){"use strict";function Factory(formObj){this.formObj=formObj,this.isValid=function(){return!!this.formObj.ref.$valid},this.canSubmit=function(){var valid=this.formObj.ref.$valid;return valid||this.showErrors(),valid},this.canSubmitErrors=function(){return this.formObj.ref.$valid?[]:this.showErrors(this.formObj)},this.showErrors=function(){var errors=[];return angular.forEach(this.formObj.ref,function(field,name){"string"!=typeof name||name.match("^[\\$]")||field.$valid||(field.$setViewValue(field.$value),field.$setDirty(),field.$timedout=!0,errors.push(field.$helpMessage))}),errors},this.setDirty=function(){angular.forEach(this.formObj.ref,function(field,name){"string"!=typeof name||name.match("^[\\$]")||(field.$setViewValue(field.$value),field.$setDirty())})},this.cleanAll=function(){angular.forEach(this.formObj.ref,function(field,name){"string"!=typeof name||name.match("^[\\$]")||(field.$timedout=!1)})}}return Factory}),angular.module("app.core").service("GenericApiService",["_","$resource",function(_,$resource){this.createParams=function(URI){var apiParamsObject={},interpolationRegExp=/(\:[a-z])/i;_(URI.split("/")).filter(function(x){return interpolationRegExp.test(x)}).map(function(x){var o=x.substr(1);apiParamsObject[o]="@"+o}).value();return apiParamsObject},this.create=function(URI,paramsConfig){return $resource(URI,paramsConfig,{})},this.remap=function(data,paramsKeys){return{params:_.pick(data,paramsKeys),payload:_.omit(data,paramsKeys)}}}]).factory("GenericApiFactory",["_","DataService","GenericApiService",function(_,DataService,GenericApiService){"use strict";function Factory(URI,params){var apiURI=URI,apiParams=params,paramsConfig=GenericApiService.createParams(apiURI),paramsConfigKeys=_.keys(paramsConfig);this.get=function(filters){return filters=filters||{},GenericApiService.create(apiURI,paramsConfig).get(_.assign({},apiParams,DataService.convertFilterQueryObject(filters))).$promise},this.getSuggestions=function(filters){return filters=filters||{},GenericApiService.create(apiURI,paramsConfig).get(_.assign({},filters,apiParams,{limit:10})).$promise},this.patch=function(data){var apiData=GenericApiService.remap(data,paramsConfigKeys);return GenericApiService.create(apiURI,paramsConfig).save(_.assign({_method:"PATCH"},apiData.params,apiParams),apiData.payload).$promise},this.put=function(data){var apiData=GenericApiService.remap(data,paramsConfigKeys);return GenericApiService.create(apiURI,paramsConfig).save(_.assign({_method:"PUT"},apiData.params,apiParams),apiData.payload).$promise},this.post=function(data){var apiData=GenericApiService.remap(data,paramsConfigKeys);return GenericApiService.create(apiURI,paramsConfig).save(_.assign({},apiData.params,apiParams),apiData.payload).$promise},this.delete=function(data){var apiData=GenericApiService.remap(data,paramsConfigKeys);return GenericApiService.create(apiURI,paramsConfig).save(_.assign({_method:"DELETE"},apiData.params,apiParams),apiData.payload).$promise}}return Factory}]).factory("GenericApiStreamFactory",["GenericApiFactory",function(GenericApiFactory){function Factory(URI,params){var api=new GenericApiFactory(URI,params),createObservable=function(promise){return Rx.Observable.fromPromise(promise)};this.get=function(filters){return createObservable(api.get(filters))},this.getSuggestions=function(filters){return createObservable(api.getSuggestions(filters))},this.patch=function(data){return createObservable(api.patch(data))},this.put=function(data){return createObservable(api.put(data))},this.post=function(data){return createObservable(api.post(data))},this.delete=function(data){return createObservable(api.delete(data))}}return Factory}]),angular.module("app.core").factory("GlobalTick",["$log","$timeout",function($log,$timeout){"use strict";function Factory(){var timer=null;this.execute=function(callback,timeout){this.cancel(),timer=$timeout(function(){callback()},timeout)},this.cancel=function(){timer&&$timeout.cancel(timer)}}return new Factory}]),angular.module("app.core").factory("HistoryServiceFactory",["_","$window","$sessionStorage",function(_,$window,$sessionStorage){"use strict";function Factory(appName){var app=appName;this.goBack=function(){$window.history.length>1?$window.history.back():$window.location.href="/"},this.getAll=function(){var stack=$sessionStorage.history||[];return stack.length>5&&stack.shift(),stack},this.pushState=function(){var storage=this.getAll();storage.push({url:$window.location.href,env:app}),$sessionStorage.history=storage},this.goBackPreviousApp=function(){var storage=this.getAll(),lastUrl=_.findLast(storage,function(i){return i.env!=app});$window.location.href=lastUrl?lastUrl.url:"/"}}return Factory}]).provider("HistoryService",function(){"use strict";var APP="default";this.setApp=function(value){APP=value},this.$get=["HistoryServiceFactory",function(HistoryServiceFactory){return new HistoryServiceFactory(APP)}]}),function(){"use strict";function ImageService(_,$log,$window,DomService,GlobalParams,UrlService){var ImgixClient=$window.ImgixClient,self=this,imgixClient=new ImgixClient({host:GlobalParams.IMGIX_HOST,includeLibraryParam:!1});self.imageDomainReg=new RegExp("/"+GlobalParams.IMGIX_HOST+"/","i"),self.cdnDomainRegex=new RegExp("^https?://(cdn|images).businessoffashion.com/","i");var maxBoxDimension=$window.screen.availHeight>$window.screen.availWidth?$window.screen.availWidth:$window.screen.availHeight,ratio=$window.devicePixelRatio?$window.devicePixelRatio:1,boxSize=Math.ceil(maxBoxDimension*ratio);self.boxSize=boxSize<1800?boxSize:1800,self.thumbSize=100,ratio>1&&(ratio=1.2),self._getImageSize=function(size){return parseInt(size*ratio,10)},self._normalise=function(dim){var k=1;(dim.w>1800||dim.h>1800)&&(k=dim.w/dim.h,dim.w>dim.h?(dim.w=1800,dim.h=parseInt(dim.w/k)):dim.w<dim.h?(dim.h=1800,dim.w=parseInt(dim.h*k)):(dim.w=1800,dim.h=1800))},self._magicMode=function(w,h){var squareRatioMargin,ratio;return squareRatioMargin=.1,ratio=h/(1*w)-1,ratio<squareRatioMargin||h>w?{fit:"crop",crop:"top"}:{fit:"crop"}},self.recomputeImageDimensions=function(w,h,containerWidth,containerHeight){var k=1,dim={w:self._getImageSize(parseInt(w)),h:self._getImageSize(parseInt(h))};return containerWidth&&containerHeight?(dim.w=self._getImageSize(containerWidth),dim.h=self._getImageSize(containerHeight)):containerWidth&&(k=dim.w/dim.h,dim.w=self._getImageSize(containerWidth),dim.h=parseInt(dim.w/k)),self._normalise(dim),dim},self._buildImgixURL=function(src,containerWidth,containerHeight){var query,fullPath,relativePath,dim,fitParam;return self.imageDomainReg.test(src)?(query=UrlService.parseQuery(src),fullPath=UrlService.getPath(src),relativePath=fullPath.split(GlobalParams.IMGIX_HOST)[1],dim=self.recomputeImageDimensions(query.w,query.h,containerWidth,containerHeight),query.h=dim.h,query.w=dim.w,query.fit?imgixClient.buildURL(relativePath,query):(fitParam=self._magicMode(dim.w,dim.h),query.fit=fitParam.fit,fitParam.crop&&(query.crop=fitParam.crop),query)):src=src||"/profiles/default/placeholder.jpg"},self.getImage=function(src,containerWidth){return self._buildImgixURL(src,containerWidth)},self.getImageDimension=function(src,containerWidth,containerHeight){return self._buildImgixURL(src,containerWidth,containerHeight)},self._sanitizeOriginalImageSrc=function(src){return self.cdnDomainRegex.test(src)&&(src=src.replace(self.cdnDomainRegex,"")),src},self.getOpenRossImage=function(src,w,h,mode,offsetX,offsetY){var fitParam,imgParams={w:w,auto:"format,compress"};if(h&&(imgParams.h=h),src=self._sanitizeOriginalImageSrc(src),mode)switch(mode){case"cropcustomcenter":imgParams.fit="crop";break;case"cropcustomtopleft":imgParams.fit="crop",imgParams.crop="top,left";break;case"cropcustomtop":imgParams.fit="crop",imgParams.crop="top";break;case"cropcustomtopright":imgParams.fit="crop",imgParams.crop="top,right";break;case"cropcustomleft":imgParams.fit="crop",imgParams.crop="left";break;case"cropcustomright":imgParams.fit="crop",imgParams.crop="right";break;case"cropcustombottomleft":imgParams.fit="crop",imgParams.crop="bottom,left";break;case"cropcustombottom":imgParams.fit="crop",imgParams.crop="bottom";break;case"cropcustombottomright":imgParams.fit="crop",imgParams.crop="bottom,right";break;case"cropcustomoffset":imgParams.fit="crop",_.isNumber(offsetX)&&_.isNumber(offsetY)&&offsetX>=0&&offsetY>=0?(imgParams.crop="focalpoint",imgParams["fp-z"]=1,imgParams["fp-x"]=offsetX/100,imgParams["fp-y"]=offsetY/100):imgParams.crop="faces,entropy";break;case"resize":imgParams.fit="clip";break;case"clamp":imgParams.fit="clamp";break;case"crop_focal_trim_auto":imgParams.fit="crop",imgParams.crop="faces,entropy",imgParams.trim="auto";break;default:fitParam=self._magicMode(w,h),imgParams.fit=fitParam.fit,fitParam.crop&&(imgParams.crop=fitParam.crop)}return src=src||"/profiles/default/placeholder.jpg",imgixClient.buildURL(src,imgParams)}}ImageService.$inject=["_","$log","$window","DomService","GlobalParams","UrlService"],angular.module("app.core").service("ImageService",ImageService)}(),angular.module("app.core").service("InputUtil",function(){"use strict";var boolTest=/^(true|1)$/i;this.toBoolean=function(data){return boolTest.test(data)},this.toInt=function(data,defaultValue){return defaultValue=defaultValue||0,parseInt(data,10)||defaultValue}}),angular.module("app.core").service("PageCountService",["$log","$sessionStorage",function($log,$sessionStorage){"use strict";var name="BOFPV";this.increase=function(){$sessionStorage[name]?$sessionStorage[name]++:$sessionStorage[name]=1},this.getPageCount=function(){return $sessionStorage[name]},this.reset=function(){$sessionStorage[name]=0}}]),angular.module("app.core").service("PaginationService",["moment","DateService",function(moment,DateService){"use strict";this.defaults=function(filters){filters.offset=0,filters.limit=5},this.nextPage=function(filters){var newOffset=filters.offset+filters.limit;filters.offset=newOffset},this.prevPage=function(filters){var newOffset=filters.offset-filters.limit;newOffset>=0&&(filters.offset=newOffset)},this.setPage=function(filters,page){filters.offset=filters.limit*(page-1)},this.getPage=function(filters){return filters.offset>0?filters.offset/filters.limit+1:1},this.reset=function(filters){filters.offset=0},this.isEnabled=function(filters,itemsCount){return itemsCount===filters.limit},this.prevDay=function(filters){var date=DateService.fromString(filters.date);filters.date=moment(date).subtract(1,"day").format("YYYY-MM-DD")}}]),angular.module("app.core").factory("PdfService",["_","$log","$window","$q","CanvasService","$http","AgentService",function(_,$log,$window,$q,CanvasService,$http,AgentService){"use strict";function Factory(element){var self=this,targetElement=element;element.parentElement,$window.pixelRatio;this.addRecursion=function(){if(_.isEmpty(self.elements)){var deferred=$q.defer();return deferred.resolve(!0),deferred.promise}return self.doc.addPage(),self.exportNodeChild()},this.addWatermark=function(){var deferred=$q.defer();return self.doc.setFontSize(9),self.doc.setTextColor(100),self.doc.text(67,290,"Application powered by The Business of Fashion"),deferred.resolve(!0),deferred.promise},this.customRender=function(element){var childElements=_.filter(element.childNodes,{nodeType:1}),textPositionY=15;self.doc.setTextColor(0),_.forEach(childElements,function(value,key){var movePointer;"h2"==value.localName||"h3"==value.localName?(textPositionY=0===key?textPositionY:textPositionY+10,self.doc.setFontType("bold"),self.doc.setFontSize(14),movePointer=10):(self.doc.setFontType("normal"),self.doc.setFontSize(10),movePointer=6);var splitText=self.doc.splitTextToSize(value.innerText,180);_.forEach(splitText,function(splitValue){self.doc.text(15,textPositionY,splitValue),(textPositionY+=movePointer)>280&&(self.addWatermark(),self.doc.addPage(),textPositionY=15)})})},this.renderContent=function(element){AgentService.isLegacyIE()?self.customRender(element):self.doc.fromHTML(element,15,15,{pagesplit:!0,width:180})},this.exportNodeChild=function(){var e=self.elements.shift();if("IMG"===e.nodeName){var canvas=new CanvasService,imageUrl=e.src;return imageUrl+=(imageUrl.indexOf("?")>0?"&":"?")+"browserCache=false",canvas.addImage(imageUrl,600).then(function(data){return self.doc.addImage(data.image,25,15),self.addWatermark().then(function(){return self.addRecursion()})},function(error){return self.addRecursion()})}return self.renderContent(e),self.addWatermark().then(function(){return self.addRecursion()})},this.export=function(filename){return filename=filename||"noname",self.doc=new jsPDF("p","mm","a4"),self.elements=_.filter(targetElement.childNodes,{nodeType:1}),self.exportNodeChild().then(function(image){return AgentService.isSafari()?self.doc.output("dataurlnewwindow"):self.doc.save(filename+".pdf"),!0})}}return Factory}]),angular.module("app.core").service("PersistentStorageService",["_","$q","$log","moment","PersistentStorageLocalStorageService","PersistentStorageSessionStorageService","PersistentStorageWebSqlService","PersistentStorageIndexedDbService",function(_,$q,$log,moment,PersistentStorageLocalStorageService,PersistentStorageSessionStorageService,PersistentStorageWebSqlService,PersistentStorageIndexedDbService){"use strict";var STORAGE_STRATEGIES=[PersistentStorageLocalStorageService,PersistentStorageWebSqlService,PersistentStorageIndexedDbService,PersistentStorageSessionStorageService],cacheData={},cacheFetchingPromises={},getDataFromStores=function(key){for(var dataSourcePromises=[],i=0;i<STORAGE_STRATEGIES.length;i++)dataSourcePromises.push(STORAGE_STRATEGIES[i].retrieve(key));var wrappedDataSourcePromises=_.map(dataSourcePromises,function(promise){return promise.then(function(data){return data}).catch(function(){return null})});return $q.all(wrappedDataSourcePromises).then(function(results){return _.find(results,function(o){return!_.isEmpty(o)})})};this.get=function(key){return key in cacheData?$q.when(cacheData[key]):(key in cacheFetchingPromises||(cacheFetchingPromises[key]=getDataFromStores(key).then(function(data){return cacheData[key]=data,data})),cacheFetchingPromises[key])},this.set=function(key,data){cacheData[key]=data,STORAGE_STRATEGIES.forEach(function(service){service.store(key,data)})}}]),angular.module("app.core").factory("PostMessageFactory",["$window","EventManager",function($window,EventManager){"use strict";function PostMessageFactory(element){var ref=element,initialised=!1;this.createIframe=function(url){if(!initialised){url=url||"/backdoor";var iframe=document.createElement("iframe");iframe.src=url,iframe.width=100,iframe.height=100;return document.getElementsByTagName("body")[0].appendChild(iframe),initialised=!0,iframe}return null},this.openWindow=function(url){$window.open(url,"temp","width=10, height=10, left=0, top=0, outerHeight=1, outerWidth=1, menubar=0, toolbar=0, location=0")},this.parentEmit=function(data){$window.parent.postMessage(data,"*")},this.openerEmit=function(data){$window.opener.postMessage(data,"*")},this.emit=function(data){ref.contentWindow.postMessage(data,"*")},this.on=function(callback){window.addEventListener("message",function(data){callback(data)},!1)}}return PostMessageFactory}]),angular.module("app.core").service("QuerystringRouter",["UrlService",function(UrlService){"use strict";this.routingTable={},this.init=function(){var params=UrlService.parseQuery(),action=params.action;if(this.routingTable.hasOwnProperty(action)){var callback=this.routingTable[action];callback&&callback(params),UrlService.clearQuery()}},this.when=function(action,params){return this.routingTable[action]=params,this}}]),angular.module("app.core").service("ScriptLoadService",["_","$log","$q",function(_,$log,$q){"use strict";var getScriptContainer=function(){return document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]},buildScriptTag=function(src,successCallback,errorCallback){var script=document.createElement("script");return script.type="text/javascript",script.async=!0,script.src=src,_.isFunction(successCallback)&&(script.onreadystatechange=script.onload=function(){successCallback.done||script.readyState&&!/loaded|complete/.test(script.readyState)||(successCallback.done=!0,$log.info("Script Loaded!",src),successCallback())}),_.isFunction(errorCallback)&&(script.onerror=function(){$log.info("Script failed to load!",src),errorCallback()}),script},hasScriptTagInPlace=function(container,scriptSrc){var script,i,scripts=container.getElementsByTagName("script");for(i=0;i<scripts.length;i+=1)if(script=scripts[i],~script.src.indexOf(scriptSrc))return!0;return!1};this.addScriptTag=function(scriptSrc){var container=getScriptContainer(),deferred=$q.defer();return hasScriptTagInPlace(container,scriptSrc)?($log.info("Script already loaded, skipping..",scriptSrc),deferred.resolve(),deferred.promise):($log.info("Loading script...",scriptSrc),container.appendChild(buildScriptTag(scriptSrc,function(){deferred.resolve()},function(){deferred.reject("Script failed to load",scriptSrc)})),deferred.promise)}}]),angular.module("app.core").factory("Stream",["$log","$timeout",function($log,$timeout){"use strict";return function(__super__){function Stream(source){__super__.call(this)}return Rx.internals.inherits(Stream,__super__),Stream.prototype.filterById=function(id){return this.filter(function(data){return data.id===id})},Stream.prototype.emit=function(data){return this.onNext(data)},Stream.prototype.on=function(data){return this.subscribe(data)},Stream}(Rx.Subject)}]).factory("LazyStream",["$log","$timeout",function($log,$timeout){"use strict";return function(__super__){function Stream(source){__super__.call(this,1)}return Rx.internals.inherits(Stream,__super__),Stream.prototype.filterById=function(id){return this.filter(function(data){return data.id===id})},Stream.prototype.emit=function(data){return this.onNext(data)},Stream.prototype.on=function(data){return this.subscribe(data)},Stream}(Rx.ReplaySubject)}]).service("StreamService",["$log","$timeout",function($log,$timeout){"use strict";this.merge=function(streams){return Rx.Observable.merge(streams)},this.fromPromise=function(promise){return Rx.Observable.fromPromise(promise)}}]).factory("BootstrapStream",["_","Stream",function(_,Stream){function Bootstrap(){var bootstrapChannel=new Stream;this.init=function(bootstrapComponents,streams){return streams=streams||[],streams.push(bootstrapChannel),bootstrapChannel.filter(function(x){return _.includes(bootstrapComponents,x.id)}).map(function(x){return 1}).scan(function(acc,x){return x+acc}).subscribe(function(acc){acc===bootstrapComponents.length&&bootstrapChannel.onCompleted()}),Rx.Observable.forkJoin(streams)},this.notify=function(id){bootstrapChannel.onNext({id:id})}}return Bootstrap}]),angular.module("app.core").service("UrlService",["_","$location","$window","storageService",function(_,$location,$window,storageService){"use strict";this.getLast=function(url){return"/"+url.split("/").slice(-1).pop()},this.getPath=function(url){return url.split("?")[0]},this.changePath=function(url){$window.location.pathname=url},this.changeUrl=function(href){$window.location.href=href},this.gotoHomepage=function(path){this.changeUrl("/")},this.isSecure=function(){return"https:"===$window.location.protocol},this.getHost=function(){return $window.location.host},this.getCurrentBaseUrl=function(){return $window.location.protocol+"//"+$window.location.hostname},this.getCurrentPath=function(){return $window.location.pathname},this.getCurrentFullPath=function(){return $window.location.pathname+$window.location.hash},this.getCurrentUrl=function(){return $window.location.href},this.getCurrentHostname=function(short){var hostname=$window.location.hostname;return short&&(hostname=hostname.replace(/^www\./i,"")),hostname},this.setQueryParams=function(params){this.setAbsolutePath({},"",$window.location.pathname+this.getQueryString(params))},this.reloadCurrentPage=function(){$window.location.reload()},this.setAbsolutePath=function(data,title,path,replaceHistory){title=title||$window.document.title,$window.history&&(replaceHistory?$window.history.replaceState(data,title,path):$window.history.pushState(data,title,path)),$window.document.title=title},this.parseQuery=function(url){url=url||$window.location.search;var k,temp=url.split(/[\?\&]/),obj={};return angular.forEach(temp,function(part){k=part.split("="),2===k.length&&(obj[k[0]]=decodeURIComponent(k[1]))}),obj},this.getQueryString=function(params){var queryString=[];return _.isEmpty(params)?"":(angular.forEach(params,function(value,key){queryString.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}),"?"+queryString.join("&"))},this.clearQuery=function(){$window.history&&$window.history.replaceState({},$window.document.title,this.getPath($window.location.href))},this.setUrlToCache=function(customUrl){storageService.set(storageService.KEY.LAST_VISITED_URL,customUrl||$window.location.href)},this.goToCachedUrl=function(){var cached=storageService.get(storageService.KEY.LAST_VISITED_URL);cached!==$window.location.href&&cached&&($window.location.href=cached)},this.hasAnchor=function(){return _.includes($window.location.href,"#")},this.openNewTab=function(url){var newTab=$window.open(url);return!(!newTab||newTab.closed||void 0===newTab.closed)}}]),function(){"use strict";function CacheService(CacheFactory,GlobalParams,FlagKeys){function get(model){return CacheFactory.get(model)||CacheFactory(model,{storageMode:"localStorage"})}function getData(model,key){return get(model).get(key||"data")}function shortCache(model){return buildCache(model,5,10)}function longCache(model){return buildCache(model,720,5)}function monthCache(model){return buildCache(model,43200,1)}function buildCache(model,mins,capacity){var maxAge=getMaxAge(mins),cacheFlushInterval=getCacheFlushInterval();capacity=getCapacity(capacity);var selected=CacheFactory.get(model);return selected||CacheFactory(model,{maxAge:maxAge,cacheFlushInterval:cacheFlushInterval,deleteOnExpire:"aggressive",storageMode:"localStorage",capacity:capacity})}function destroy(model){var cache=CacheFactory.get(model);cache&&cache.destroy()}function getMaxAge(mins){return GlobalParams.DEV_ENABLE_FULLCACHE?6048e5:6e4*mins}function getCacheFlushInterval(){return GlobalParams.DEV_ENABLE_FULLCACHE?6048e5:36e5}function getCapacity(capacity){return GlobalParams.DEV_ENABLE_FULLCACHE?50:capacity}return{get:get,getData:getData,shortCache:shortCache,longCache:longCache,monthCache:monthCache,buildCache:buildCache,destroy:destroy,KEY:FlagKeys}}CacheService.$inject=["CacheFactory","GlobalParams","FlagKeys"],angular.module("app.core").factory("CacheService",CacheService)}(),function(){"use strict";function errorLoggerService(errorReportingApi){function log(message,errorPayload,channel){var payload={message:message,payload:errorPayload};channel&&(payload.channel=channel),errorReportingApi.post(payload)}return{log:log}}errorLoggerService.$inject=["errorReportingApi"],angular.module("app.core").factory("errorLoggerService",errorLoggerService)}(),function(){"use strict";function storageServiceProvider(){var strategyService=localStorageStrategy;try{localStorage.setItem("testKey","test"),localStorage.removeItem("testKey"),strategyService=localStorageStrategy}catch(e){strategyService=cookieStorageStrategy}return{$get:strategyService}}function localStorageStrategy(_,$window,$timeout,$log,$localStorage,GlobalParams,StorageKeys,Stream){function set(key,value){$log.debug("storageService::set::localStorage::[%s]",key,value),$localStorage[key]=value}function get(key){var value=$localStorage[key];return $log.debug("storageService::get::localStorage::[%s]",key,value),value}function has(key){var has=!_.isUndefined($localStorage[key]);return $log.debug("storageService::has::localStorage::[%s]",key,has),has}function remove(key){$log.debug("storageService::remove::localStorage::[%s]",key),delete $localStorage[key]}function storageChange(event){_.startsWith(event.key,GlobalParams.LOCALSTORAGE_PREFIX)&&$timeout(function(){try{STORAGE_STREAM.onNext({storageKey:_.replace(event.key,GlobalParams.LOCALSTORAGE_PREFIX,""),newValue:angular.fromJson(event.newValue),oldValue:angular.fromJson(event.oldValue)})}catch(err){}})}var STORAGE_STREAM=new Stream;return $window.addEventListener("storage",storageChange,!1),{set:set,get:get,has:has,remove:remove,KEY:StorageKeys,STORAGE_STREAM:STORAGE_STREAM}}function cookieStorageStrategy(_,Stream,$log,StorageKeys,$cookies){function set(key,value){$log.debug("storageService::set::cookieStorage::[%s]",key,value),$cookies.putObject(key,{val:value})}function get(key){var value,cookieObject=$cookies.getObject(key);return _.isObject(cookieObject)&&(value=cookieObject.val),$log.debug("storageService::get::cookieStorage::[%s]",key,value),value}function has(key){var has=!_.isUndefined($cookies.getObject(key));return $log.debug("storageService::has::cookieStorage::[%s]",key,has),has}function remove(key){$log.debug("storageService::remove::cookieStorage::[%s]",key),$cookies.remove(key)}return{set:set,get:get,has:has,remove:remove,KEY:StorageKeys,STORAGE_STREAM:new Stream}}localStorageStrategy.$inject=["_","$window","$timeout","$log","$localStorage","GlobalParams","StorageKeys","Stream"],angular.module("app.core").provider("storageService",storageServiceProvider)}(),function(){"use strict";function errorReportingApi(GenericApiFactory,Routes){function post(data){return errorReportingApi.post(data)}var errorReportingApi=new GenericApiFactory(Routes.UTILITY.ERROR_REPORTING);return{post:post}}errorReportingApi.$inject=["GenericApiFactory","Routes"],angular.module("app.core").factory("errorReportingApi",errorReportingApi)}(),function(){"use strict";function genericApi($http,_){function post(url,data){return $http({method:"POST",url:url,data:data||{}})}function get(url,params){function resolveResponse(response){return _.get(response,"data.data")}return $http({method:"GET",url:url,params:params||{}}).then(resolveResponse)}return{get:get,post:post}}genericApi.$inject=["$http","_"],angular.module("app.core").factory("genericApi",genericApi)}(),function(){"use strict";function AnchorScrollWatcherController(_,$timeout,anchorScrollService,UrlService,$window,TrackerService){function $onInit(){$ctrl.scrollToUrl&&(scrollWatcherEnabled=!1,$timeout(function(){anchorScrollService.anchorScrollToElement("","",$ctrl.scrollToUrl,PREFIX,SCROLL_OFFSET,0),scrollWatcherEnabled=!0},1e3));var onScrollStream=Rx.Observable.fromEvent(document,"scroll");subscription=onScrollStream.subscribe(detectActiveElement)}function detectActiveElement(){scrollWatcherEnabled&&($timeout.cancel(scrollTimeout),scrollTimeout=$timeout(debounceDetectActiveElement,SCROLL_DEBOUNCE))}function debounceDetectActiveElement(){for(var active="",prevActive="",i=0;i<elements.length;i++)if(elements[i].tagName){var box=elements[i].getBoundingClientRect();if(prevActive=active,box.top>-SCROLL_TOP_OFFSET&&$window.innerHeight-SCROLL_TOP_OFFSET>=box.top?active=elements[i]:box.bottom>SCROLL_BOTTOM_OFFSET&&0>box.top&&(active=elements[i]),active&&prevActive)break}if(active=prevActive||active,lastActiveElement!=active)if(lastActiveElement=active,$timeout.cancel(viewTimeout),active){var itemSlug=active.getAttribute("id").replace(PREFIX,"");UrlService.setAbsolutePath("","",active.getAttribute("url"),!0),trackImpression(itemSlug,$ctrl.trackingLabelImpression),viewTimeout=$timeout(function(){trackImpression(itemSlug,$ctrl.trackingLabelView)},VIEW_TIMEOUT)}else UrlService.setAbsolutePath("","",$ctrl.baseUrl,!0)}function trackImpression(itemSlug,trackingLabel){_.isEmpty($ctrl.trackingDomain)||_.isEmpty($ctrl.trackingCategory)||_.isEmpty(trackingLabel)||TrackerService.track($ctrl.trackingDomain,$ctrl.trackingCategory,{Label:trackingLabel+"."+itemSlug,Page:$ctrl.trackingPage,Action:"impression"},"impression")}function $onDestroy(){subscription.dispose()}var subscription,viewTimeout,elements=document.getElementsByClassName("company-card"),lastActiveElement="",scrollTimeout="",$ctrl=this,scrollWatcherEnabled=!0;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}AnchorScrollWatcherController.$inject=["_","$timeout","anchorScrollService","UrlService","$window","TrackerService"];var SCROLL_OFFSET=100,PREFIX="scrollto-",SCROLL_DEBOUNCE=200,SCROLL_TOP_OFFSET=150,SCROLL_BOTTOM_OFFSET=350,VIEW_TIMEOUT=5e3,anchorScrollWatcherComponent={bindings:{scrollToUrl:"@",baseUrl:"@",trackingDomain:"@",trackingCategory:"@",trackingPage:"@",trackingLabelView:"@",trackingLabelImpression:"@"},controller:AnchorScrollWatcherController};angular.module("app.core").component("anchorScrollWatcher",anchorScrollWatcherComponent)}(),function(){"use strict";function BlurOnEventController($element,uiStream){function $onInit(){blurListener=uiStream.BLUR_COMPONENT.subscribe(blurComponent)}function $onDestroy(){blurListener.dispose()}function blurComponent(blur){$ctrl.isBlurred=blur;for(var links=$element[0].querySelectorAll("a"),i=0;i<links.length;i++){var btn=links[i].querySelectorAll("button");blur?(angular.element(links[i]).on("click",function(e){e.preventDefault(),e.stopPropagation()}),angular.element(btn).on("click",function(e){e.preventDefault(),e.stopPropagation()})):(angular.element(links[i]).off("click"),angular.element(btn).off("click"))}}var $ctrl=this,blurListener=null;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit,$ctrl.isBlurred=!1}var blurOnEventComponent={transclude:!0,template:"<div ng-class=\"{'effect-blur': $ctrl.isBlurred}\"><ng-transclude></ng-transclude></div>",controller:BlurOnEventController};angular.module("app.ui").component("blurOnEvent",blurOnEventComponent)}(),function(){"use strict";function InViewController(EventManager,$element,DomService,EventManagerUtility,UiEvents,ChannelManager){function $onInit(){listeners.push(EventManager.onFresh(UiEvents.WINDOW_SCROLL,function(){emitNewState(DomService.isVisible(elRef))})),emitNewState(DomService.isVisible(elRef))}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function emitNewState(newStatus){status!=newStatus&&(status=newStatus,EventDispatcher.emit(UiEvents.CHANGE_IN_VIEW,{id:$ctrl.id,data:{status:status}}))}var $ctrl=this,EventDispatcher=ChannelManager.subscribe($ctrl.channel),elRef=$element[0],listeners=[],status=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}InViewController.$inject=["EventManager","$element","DomService","EventManagerUtility","UiEvents","ChannelManager"],angular.module("app.core").component("inView",{bindings:{id:"@",channel:"@"},controller:InViewController})}(),function(){"use strict";function ReadMoreController(){function toggle(){ctrl.isReadMoreVisible=!ctrl.isReadMoreVisible}var ctrl=this;ctrl.toggle=toggle,ctrl.isReadMoreVisible=!0}var readMoreComponent={template:'<ng-transclude ng-class="{ \'company-card__content-read-more-cutter\': $ctrl.isReadMoreVisible } "></ng-transclude><a ng-show="$ctrl.isReadMoreVisible" ng-click="$ctrl.toggle()" class="company-card__content-read-more block sans-serif"><div class="company-card__content-read-more-separator"></div>Read more<i class="icon icon-dropdown block"></i></a><a ng-show="!$ctrl.isReadMoreVisible" class="company-card__content-read-less block sans-serif" ng-click="$ctrl.toggle()"><i class="icon icon-dropdown block"></i>Read less</a>',bindings:{height:"@"},transclude:!0,controller:ReadMoreController};angular.module("app.core").component("readMore",readMoreComponent)}(),function(){"use strict";function SetFlagController(CacheService){function $onInit(){CacheService.destroy($ctrl.name);var maxAge=$ctrl.maxAge||36e5,cache=CacheService.buildCache(CacheService.KEY[$ctrl.flagKey],maxAge,1);$ctrl.data=$ctrl.data||!0,cache.put("data",$ctrl.data)}var $ctrl=this;$ctrl.$onInit=$onInit}var setFlagComponent={bindings:{flagKey:"@",maxAge:"<",data:"<"},controller:SetFlagController};angular.module("app.core").component("setFlag",setFlagComponent)}(),function(){"use strict";function anchorScroll(anchorScrollService){function postLink(scope,element,attrs){function onClick(event){event.preventDefault(),anchorScrollService.anchorScrollToElement("","",element[0].href,PREFIX,SCROLL_OFFSET)}element.on("click",onClick)}var SCROLL_OFFSET=110,PREFIX="scrollto-";return{restrict:"A",scope:{scrollToUrl:"@"},link:postLink}}anchorScroll.$inject=["anchorScrollService"],angular.module("app.ui").directive("anchorScroll",anchorScroll)}(),function(){"use strict";function bofTranslateFilter(_,$window){function getTranslation(key){return _.get($window.ALTranslations,key)}return getTranslation}bofTranslateFilter.$inject=["_","$window"],angular.module("app.core").filter("bofTranslate",bofTranslateFilter)}(),function(){"use strict";function widthFilter(ImgIxService){return function(url,parameters){var imgIxObj=ImgIxService.toParams(url);return imgIxObj.params.w=parameters,ImgIxService.toUrl(imgIxObj.path,imgIxObj.params)}}function heightFilter(ImgIxService){return function(url,parameters){var imgIxObj=ImgIxService.toParams(url);return imgIxObj.params.h=parameters,ImgIxService.toUrl(imgIxObj.path,imgIxObj.params)}}function brightnessFilter(ImgIxService){return function(url,parameters){var imgIxObj=ImgIxService.toParams(url);return imgIxObj.params.bri=parameters,ImgIxService.toUrl(imgIxObj.path,imgIxObj.params)}}function contrastFilter(ImgIxService){return function(url,parameters){var imgIxObj=ImgIxService.toParams(url);return imgIxObj.params.con=parameters,ImgIxService.toUrl(imgIxObj.path,imgIxObj.params)}}widthFilter.$inject=["ImgIxService"],heightFilter.$inject=["ImgIxService"],brightnessFilter.$inject=["ImgIxService"],contrastFilter.$inject=["ImgIxService"],angular.module("app.core").filter("ixW",widthFilter).filter("ixH",heightFilter).filter("ixBri",brightnessFilter).filter("ixCon",contrastFilter)}(),function(){"use strict";function pathFilter(_,$window){function getUrl(path,parameters){var url=_.get($window.ALRouting,path);return _.each(parameters,function(value,key){url=url.replace(":"+key,value)}),url}return getUrl}pathFilter.$inject=["_","$window"],angular.module("app.core").filter("path",pathFilter)}(),function(){"use strict";function jsVersionInterceptor(GlobalParams){function requestInterceptor(config){return config.bypassIntercepors?config:(config.headers=config.headers||{},config.headers[VERSION_HEADER]=GlobalParams.APP_VERSION,config)}var VERSION_HEADER="X-App-Version";return{request:requestInterceptor}}jsVersionInterceptor.$inject=["GlobalParams"],angular.module("app.core").factory("jsVersionInterceptor",jsVersionInterceptor)}(),function(){"use strict";function anchorScrollService(_,UrlService,DomService){function anchorScrollToElement(data,title,url,prefix,scrollOffset,duration){var lastUrlPart=_.last(url.split("/")),goToElement=angular.element(document.querySelector("#"+prefix+lastUrlPart));DomService.scrollToElement(goToElement,scrollOffset,duration)}return{anchorScrollToElement:anchorScrollToElement}}anchorScrollService.$inject=["_","UrlService","DomService"],angular.module("app.core").factory("anchorScrollService",anchorScrollService)}(),function(){"use strict";function ImgIx(_,$window,GlobalParams){function toParams(url){return{path:getPath(url),params:getParams(url)}}function toUrl(path,params){return new(0,$window.ImgixClient)({host:GlobalParams.IMGIX_HOST}).buildURL(path,params)}function getPath(url){return url=_.replace(url,"https://"+GlobalParams.IMGIX_HOST+"/",""),url=url.split("?")[0]}function getParams(url){var params=url.split("?")[1],obj={};return params&&_.each(params.split("&"),function(param){if(param){var key_value=param.split("=");obj[key_value[0]]=key_value[1]}}),obj}return{toParams:toParams,toUrl:toUrl}}ImgIx.$inject=["_","$window","GlobalParams"],angular.module("app.core").factory("ImgIxService",ImgIx)}(),function(){"use strict";function utmService(_,storageService,StorageKeys,trackerStream,UrlService){function parseUTMParamsFromURL(){var utmParamsBlueprint={utm_source:null,utm_medium:null,utm_content:null,utm_campaign:null,utm_term:null},utmParams=_.pick(UrlService.parseQuery(),_.keys(utmParamsBlueprint));return!_.isEmpty(utmParams)&&_.assign(utmParamsBlueprint,utmParams)}function saveUTMParams(utmParams){!1!==utmParams&&(storageService.has(StorageKeys.UTM_FIRST_TOUCH)||storageService.set(StorageKeys.UTM_FIRST_TOUCH,utmParams),storageService.set(StorageKeys.UTM_LAST_TOUCH,utmParams))}function getUTMParams(){return{firstTouch:storageService.get(StorageKeys.UTM_FIRST_TOUCH),lastTouch:storageService.get(StorageKeys.UTM_LAST_TOUCH)}}function setUtmParamsFromTracker(event){if(event.Source||event.Medium||event.Content||event.Campaign||event.Term){saveUTMParams({utm_source:event.Source||null,utm_medium:event.Medium||null,utm_content:event.Content||null,utm_campaign:event.Campaign||null,utm_term:event.Term||null})}}function initUTMTrackerListener(){trackerStream.EVENT.filter(isApplicableEvent).subscribe(setUtmParamsFromTracker)}function isApplicableEvent(event){return"Memberships.Marketing"===_.get(event,"Cat")}return{saveUTMParams:saveUTMParams,getUTMParams:getUTMParams,parseUTMParamsFromURL:parseUTMParamsFromURL,initUTMTrackerListener:initUTMTrackerListener}}utmService.$inject=["_","storageService","StorageKeys","trackerStream","UrlService"],angular.module("app.core").factory("utmService",utmService)}(),function(){"use strict";function formStream(EventManagerUtility,LazyStream){return{FORM_ERROR:new LazyStream,unsubscribe:EventManagerUtility.removeListeners}}formStream.$inject=["EventManagerUtility","LazyStream"],angular.module("app.core").factory("formStream",formStream)}(),angular.module("app.core").service("PersistentStorageIndexedDbService",["$q","$window","CryptService",function($q,$window,CryptService){"use strict";var isSupported=function(){return"indexedDB"in $window},getDatabaseHandle=function(){var deferred=$q.defer();if(isSupported())try{var dbOpenRequest=$window.indexedDB.open("kv",1);dbOpenRequest.onupgradeneeded=function(event){var db=event.target.result;db.objectStoreNames.contains("ps")||db.createObjectStore("ps")},dbOpenRequest.onsuccess=function(event){deferred.resolve(event.target.result)},dbOpenRequest.onerror=function(event){deferred.reject()}}catch(e){deferred.reject()}else deferred.reject();return deferred.promise};this.store=function(key,data){var deferred=$q.defer(),encryptedData=CryptService.encryptJson(data);return getDatabaseHandle().then(function(db){var request=db.transaction(["ps"],"readwrite").objectStore("ps").put(encryptedData,key);request.onsuccess=function(event){deferred.resolve()},request.onerror=deferred.reject}).catch(deferred.reject),deferred.promise},this.retrieve=function(key){var deferred=$q.defer();return getDatabaseHandle().then(function(db){var request=db.transaction(["ps"],"readonly").objectStore("ps").get(key);request.onsuccess=function(event){try{if(event.target.result){var decryptedData=CryptService.decryptJson(event.target.result);deferred.resolve(decryptedData)}else deferred.reject()}catch(error){deferred.reject()}},request.onerror=deferred.reject}).catch(deferred.reject),deferred.promise}}]),angular.module("app.core").service("PersistentStorageLocalStorageService",["_","$q","$localStorage","CryptService",function(_,$q,$localStorage,CryptService){"use strict";this.store=function(key,data){return $localStorage[key]=CryptService.encryptJson(data),$q.when(!0)},this.retrieve=function(key){try{var data=CryptService.decryptJson($localStorage[key]);return data=_.keys(data).length?data:null,$q.when(data)}catch(error){return $q.when(null)}}}]),angular.module("app.core").service("PersistentStorageSessionStorageService",["_","$q","$sessionStorage","CryptService",function(_,$q,$sessionStorage,CryptService){"use strict";this.store=function(key,data){return $sessionStorage[key]=CryptService.encryptJson(data),$q.when(!0)},this.retrieve=function(key){try{var data=CryptService.decryptJson($sessionStorage[key]);return data=_.keys(data).length?data:null,$q.when(data)}catch(error){return $q.when(null)}}}]),angular.module("app.core").service("PersistentStorageWebSqlService",["$q","$window","CryptService",function($q,$window,CryptService){"use strict";var SQL_SELECT="SELECT * FROM kv WHERE key LIKE ?",isSupported=function(){return"openDatabase"in $window},getDatabaseHandle=function(){var deferred=$q.defer();if(isSupported())try{var db=$window.openDatabase("ps",1,"ps",51200);db?db.transaction(function(transaction){transaction.executeSql("CREATE TABLE IF NOT EXISTS kv(key TEXT PRIMARY KEY, data TEXT)",[],function(){deferred.resolve(db)},deferred.reject)}):deferred.reject()}catch(e){deferred.reject()}else deferred.reject();return deferred.promise};this.store=function(key,data){var deferred=$q.defer(),encryptedData=CryptService.encryptJson(data);return getDatabaseHandle().then(function(db){db.transaction(function(transaction){transaction.executeSql(SQL_SELECT,[key],function(transaction,result){result.rows.length?transaction.executeSql("UPDATE kv SET data = ? WHERE key = ?",[encryptedData,key],deferred.resolve,deferred.reject):transaction.executeSql("INSERT INTO kv VALUES(?, ?)",[key,encryptedData],deferred.resolve,deferred.reject)},deferred.reject)})}).catch(deferred.reject),deferred.promise},this.retrieve=function(key){var deferred=$q.defer();return getDatabaseHandle().then(function(db){db.transaction(function(transaction){transaction.executeSql(SQL_SELECT,[key],function(transaction,result){try{if(result.rows.length){var decryptedData=CryptService.decryptJson(result.rows.item(0));deferred.resolve(decryptedData)}else deferred.reject()}catch(error){deferred.reject()}},deferred.reject)})}).catch(deferred.reject),deferred.promise}}]),function(){"use strict";function BofProfessionalDwellModalController(_,$log,$timeout,authStream,UiModalService,AuthEvents,EventManager,AgentService,moment,storageService){function $onInit(){$ctrl.showModal=!0,$ctrl.backdropStatus=!1,$ctrl.label=AgentService.isMobilePhone()?"DwellModal.Centered.MobileAppCopy.CopyWithPhoneImage":"DwellModal.Centered.SubscriptionCopy.CopyWithPhoneImage",userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged),protectContentSub=EventManager.on(AuthEvents.PROTECT_CONTENT,backdropStatusUpdate)}function onUserChanged(user){userIsMember=user.hasMembership(),$ctrl.showModal=!isBannerDismissed()&&user.isLoggedIn(),$ctrl.showModal&&_.isUndefined(activityStreamSub)&&initStreams(),userIsMember&&($ctrl.label="DwellModal.Centered.ExclusiveArticlesCopy.CopyWithBrainImageBck"),timer&&$timeout.cancel(timer)}function initStreams(){$log.debug("BofProfessionalDwellModalController::initStreams"),onMouseMoveStream=Rx.Observable.fromEvent(document,"mousemove"),onKeyDownStream=Rx.Observable.fromEvent(document,"keydown"),onClickStream=Rx.Observable.fromEvent(document,"click"),onScrollStream=Rx.Observable.fromEvent(document,"scroll"),activityStream=Rx.Observable.merge(onMouseMoveStream,onKeyDownStream,onClickStream,onScrollStream).throttle(1e3),activityStreamSub=activityStream.subscribe(onUserActivity)}function backdropStatusUpdate(data){$ctrl.backdropStatus=data.status}function startCounter(){$timeout.cancel(timer),timer=$timeout(openModal,12e4)}function openModal(){if($ctrl.backdropStatus)return void startCounter();EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0,preventBlur:!0});var templateUrl="/assets-access-layer/js/shared/Banner/templates/bof-professional-dwell-modal.html";userIsMember&&(templateUrl="/assets-access-layer/js/shared/Banner/templates/bof-exclusive-dwell-modal.html"),UiModalService.openModal({controller:"ModalGenericController",template:templateUrl,size:"dwell",backdrop:"static",backdropClass:"modal-backdrop--dark",keyboard:!1},{page:$ctrl.page,label:$ctrl.label}).then(function(){storageService.set(storageService.KEY.BOF_PROFESSIONAL_DWELL_DISMISSAL_DATE,moment()),EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!1})}),$ctrl.showModal=!1}function onUserActivity(){$ctrl.showModal&&startCounter()}function $onDestroy(){userChangedSub.dispose(),activityStreamSub.dispose(),protectContentSub.dispose(),$timeout.cancel(timer)}function isBannerDismissed(){var modalDismissalTimestamp=storageService.get(storageService.KEY.BOF_PROFESSIONAL_DWELL_DISMISSAL_DATE);return modalDismissalTimestamp&&moment().diff(modalDismissalTimestamp,"days")<MODAL_DISMISSAL_DAYS}var userChangedSub,onMouseMoveStream,onKeyDownStream,onClickStream,onScrollStream,activityStream,activityStreamSub,protectContentSub,timer,$ctrl=this,userIsMember=!1,MODAL_DISMISSAL_DAYS=3;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var bofProfessionalDwellModalComponent={bindings:{page:"@"},controller:BofProfessionalDwellModalController};angular.module("app.banner").component("bofProfessionalDwellModal",bofProfessionalDwellModalComponent)}(),function(){"use strict";function BofProfessionalMobileButtonController($document,authStream){function $onInit(){$ctrl.showButton=!1,userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){$ctrl.showButton=!user.hasMembership()}function $onDestroy(){userChangedSub.dispose()}var userChangedSub,$ctrl=this;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var bofProfessionalMobileButtonComponent={bindings:{url:"@",page:"@",label:"@",articleSlug:"@"},templateUrl:"/assets-access-layer/js/shared/Banner/templates/bof-professional-mobile-button.html",controller:BofProfessionalMobileButtonController};angular.module("app.banner").component("bofProfessionalMobileButton",bofProfessionalMobileButtonComponent)}(),function(){"use strict";function BofProfessionalStickyBannerController(_,$evalAsync,$window,authStream,stickyStream,DomService){function $onInit(){$ctrl.showBanner=!1,$ctrl.addClass=!1,$ctrl.sticky=!1,BofProBanner=DomService.getElementById("bof-professional-banner"),BofProBannerBottom=_.isEmpty(BofProBanner)?0:DomService.getAbsoluteTop(BofProBanner[0])+DomService.getHeight(BofProBanner[0]),onScrollStream=Rx.Observable.fromEvent(document,"scroll").map(function(){return!!($window.scrollY>=BofProBannerBottom&&$ctrl.sticky)}).distinctUntilChanged(),onScrollSub=onScrollStream.subscribe(onScroll),userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged),stickyHeaderChangedSub=stickyStream.NAVIGATION_STICKY_HEADER_CHANGED.subscribe(onStickyHeaderChanged)}function onScroll(addClass){$evalAsync(function(){$ctrl.addClass=addClass})}function onUserChanged(user){$ctrl.showBanner=!user.hasMembership(),stickyStream.BOF_PROFESSIONAL_STICKY_CHANGED.onNext({offset:$ctrl.showBanner?46:0})}function onStickyHeaderChanged(data){$ctrl.sticky=data.fixed}function $onDestroy(){userChangedSub.dispose(),stickyHeaderChangedSub.dispose(),onScrollSub.dispose()}var userChangedSub,stickyHeaderChangedSub,onScrollStream,onScrollSub,BofProBanner,BofProBannerBottom,$ctrl=this;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var bofProfessionalStickyBannerComponent={bindings:{url:"@",page:"@",label:"@"},templateUrl:"/assets-access-layer/js/shared/Banner/templates/bof-professional-sticky-banner.html",controller:BofProfessionalStickyBannerController};angular.module("app.banner").component("bofProfessionalStickyBanner",bofProfessionalStickyBannerComponent)}(),function(){"use strict";function SmartAppBannerController($window,_,$log,authStream){function $onInit(){authStreamSub=authStream.USER_CHANGED.subscribe(onUserChanged)}function $onDestroy(){authStreamSub&&authStreamSub.dispose()}function onUserChanged(user){user.hasMembership()&&showBannerOnce()}function showBanner(){$log.debug("SmartAppBannerController::showBanner::");var meta=document.createElement("meta");meta.name="apple-itunes-app",meta.content="app-id="+APP_STORE_ID,document.head.appendChild(meta)}var authStreamSub,$ctrl=this,APP_STORE_ID=1173812396,document=$window.document,showBannerOnce=_.once(showBanner);$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var smartAppBannerComponent={controller:SmartAppBannerController};angular.module("app.banner").component("smartAppBanner",smartAppBannerComponent)}(),angular.module("app.input").constant("InputTemplates",{INPUT_TYPE_AHEAD_WRAPPER_COMPONENT:"/assets-access-layer/js/shared/Input/templates/input_type_ahead_wrapper.html",INPUT_SELECT:"/assets-access-layer/js/shared/Input/templates/input-select.html",INPUT_TITLE:"/assets-access-layer/js/shared/Input/templates/input_title.html",INPUT_ACADEMIC_EMAIL:"/assets-access-layer/js/shared/Input/templates/input_academic_email.html",INPUT_COMPANY:"/assets-access-layer/js/shared/Input/templates/input_company.html",INPUT_TYPEAHEAD:"/assets-access-layer/js/shared/Input/templates/input_typeahead.html"}),angular.module("app.input").component("inputCompany",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_COMPANY},bindings:{value:"=ngModel",name:"@",fieldClass:"@",labelClass:"@",label:"@",help:"@",editable:"@",required:"@",placeholder:"@",domainSource:"@",onReady:"&"},controller:["_","userSuggestionApi","organisationApi","$log",function(_,userSuggestionApi,organisationApi,$log){"use strict";$log.debug("inputCompany::");var ctrl=this;ctrl.name=ctrl.name||"input_company",ctrl.domainSource=ctrl.domainSource||null,ctrl.getSuggestions=function($event){var query=$event.queryValue;return!_.isString(query)||query.length<2?[]:($log.debug("inputCompany::getSuggestions::query:%s",query),"organisations"===ctrl.domainSource?organisationApi.get({query:query,transformations:"typeahead"}):userSuggestionApi.fetchSuggestions("organisations",query))},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputCompanySize",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},require:"^form",replace:!0,bindings:{value:"=ngModel",fieldClass:"@",required:"@",label:"@",name:"@",onReady:"&"},controller:["_","SharedDataApis",function(_,SharedDataApis){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_company_size",ctrl.$onInit=function(){SharedDataApis.COMPANY_SIZE().then(function(res){var values={};_.map(res.data,function(item){values[item.title_id]=item.title}),ctrl.values=values})},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputCourseTitle",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_TYPEAHEAD},bindings:{value:"=ngModel",name:"@",label:"@",help:"@",placeholder:"@",fieldClass:"@",labelClass:"@",required:"@",editable:"@",onReady:"&"},controller:["_","SharedDataApiFactory","$log",function(_,SharedDataApiFactory,$log){"use strict";var ctrl=this,schoolCourseApi=new SharedDataApiFactory({type:"school-courses",limit:6}).get;ctrl.name=ctrl.name||"input_course_title",ctrl.getSuggestions=function($event){var query=$event.queryValue;return!_.isString(query)||query.length<2?[]:($log.debug("inputCourseTitle::getSuggestions::query:%s",query),schoolCourseApi({query:query}))},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputGraduationYear",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},require:"^form",replace:!0,bindings:{value:"=ngModel",fieldClass:"@",required:"@",label:"@",labelClass:"@",name:"@",onReady:"&"},controller:["_","moment",function(_,moment){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_graduation_year",ctrl.values={};for(var i=1;i<5;i++)ctrl.values[String(moment().year()+i)]=String(moment().year()+i);ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputGroupSize",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},require:"^form",replace:!0,bindings:{value:"=ngModel",placeholder:"@",fieldClass:"@",required:"@",label:"@",labelClass:"@",name:"@",onReady:"&"},controller:["_",function(_){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_group_size",ctrl.values={"5 - 15":"5 - 15","16 - 50":"16 - 50","51 - 500":"51 - 500","501 - 1000":"501 - 1000","1001 +":"1001 +"},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputJobFunction",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},require:"^form",replace:!0,bindings:{value:"=ngModel",fieldClass:"@",required:"@",label:"@",name:"@",onReady:"&"},controller:["_","SharedDataApis",function(_,SharedDataApis){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_job_function",ctrl.$onInit=function(){SharedDataApis.JOB_RESPONSIBILITY().then(function(res){var values={};_.map(res.data,function(item){values[item.id]=item.title}),ctrl.values=values})},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputJobIndustry",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},require:"^form",replace:!0,bindings:{value:"=ngModel",name:"@",fieldClass:"@",required:"@",label:"@",onReady:"&"},controller:["_","SharedDataApis",function(_,SharedDataApis){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_job_industry",ctrl.$onInit=function(){SharedDataApis.JOB_INDUSTRY().then(function(res){var values={};_.map(res.data,function(item){values[item.id]=item.title}),ctrl.values=values})},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputJobLevel",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},bindings:{value:"=ngModel",name:"@",label:"@",placeholder:"@",fieldClass:"@",required:"@",onReady:"&"},controller:["_","SharedDataApis",function(_,SharedDataApis){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_job_level",ctrl.$onInit=function(){SharedDataApis.JOB_LEVEL().then(function(res){var values={};_.map(res.data,function(item){values[item.id]=item.title}),ctrl.values=values})},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputSchoolProgrammeType",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},require:"^form",replace:!0,bindings:{value:"=ngModel",name:"@",fieldClass:"@",labelClass:"@",required:"@",label:"@",onReady:"&"},controller:["_","SharedDataApis","$log",function(_,SharedDataApis,$log){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_school_programme_type",ctrl.values={},ctrl.$onInit=function(){SharedDataApis.SCHOOL_PROGRAMME_TYPE().then(function(res){$log.debug("inputSchoolProgrammeType::SCHOOL_PROGRAMME_TYPE_LOADED Loaded schools",res),_.map(res.data,function(item){ctrl.values[item.id]=item.title})})},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputSchoolTitle",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_TYPEAHEAD},bindings:{value:"=ngModel",name:"@",label:"@",help:"@",placeholder:"@",fieldClass:"@",labelClass:"@",required:"@",editable:"@",onReady:"&"},controller:["_","SharedDataApiFactory","$log",function(_,SharedDataApiFactory,$log){"use strict";var ctrl=this,companyApi=new SharedDataApiFactory({type:"schools",limit:6}).get;ctrl.name=ctrl.name||"input_school_title",ctrl.getSuggestions=function($event){var query=$event.queryValue;return!_.isString(query)||query.length<2?[]:($log.debug("inputSchoolTitle::getSuggestions::query:%s",query),companyApi({query:query}))},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").component("inputTitle",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_TITLE},bindings:{value:"=ngModel",name:"@",label:"@",required:"@"},controller:function(){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_title"}}),angular.module("app.input").directive("inputTypeAheadWrapper",["_","ChannelManager","InputTemplates","AccountEvents",function(_,ChannelManager,InputTemplates,AccountEvents){"use strict";return{templateUrl:InputTemplates.INPUT_TYPE_AHEAD_WRAPPER_COMPONENT,replace:!0,restrict:"E",scope:{channel:"@",model:"=",field:"@",nameProperty:"@",edit:"="},link:function(scope){var ChannelEventManager=ChannelManager.subscribe(scope.channel);scope.filters=[];var _clearFilters=function(){scope.filters=[]};scope.addFilter=function(item,model){_.remove(scope.criteria,function(obj){return obj[scope.nameProperty]===model}),scope.filters.push(item),scope.model="",scope.emitFilterUpdateEvent()},scope.getSuggestions=function(query){return _.filter(scope.criteria,function(obj){return-1!=obj[scope.nameProperty].toLowerCase().indexOf(query.toLowerCase())})},scope.emitFilterUpdateEvent=function(){ChannelEventManager.emit(AccountEvents.JOB_ALERTS_FILTERS_UPDATE,{field:scope.field,filters:scope.filters})},scope.removeFilter=function(item){_.remove(scope.filters,function(obj){return obj[scope.nameProperty]===item[scope.nameProperty]}),scope.criteria.push(item),scope.criteria=_.sortBy(scope.criteria,scope.nameProperty),scope.emitFilterUpdateEvent()},ChannelEventManager.on(AccountEvents.JOB_ALERTS_CRITERIA_LOAD,function(payload){scope.criteria=payload[scope.field]}),ChannelEventManager.onFresh(AccountEvents.JOB_ALERTS_USER_FILTERS_LOAD,function(payload){_clearFilters(),payload[scope.field].forEach(function(obj){scope.addFilter(obj,obj[scope.nameProperty])})}),ChannelEventManager.on(AccountEvents.JOB_ALERTS_REMOVAL,function(){_.clone(scope.filters).forEach(function(item){scope.removeFilter(item)})})}}}]),angular.module("app.input").component("inputUserJobLevelType",{templateUrl:function(InputTemplates){return InputTemplates.INPUT_SELECT},bindings:{value:"=ngModel",name:"@",label:"@",placeholder:"@",fieldClass:"@",required:"@",onReady:"&"},controller:["_","SharedDataApis",function(_,SharedDataApis){"use strict";var ctrl=this;ctrl.name=ctrl.name||"input_user_job_level_type",ctrl.$onInit=function(){SharedDataApis.USER_JOB_LEVEL_TYPE().then(function(res){var values={};_.map(res.data,function(item){values[item.user_job_level_type_id]=item.user_job_level_type_title}),ctrl.values=values})},ctrl.$postLink=function(){_.isFunction(ctrl.onReady)&&ctrl.onReady()}}]}),angular.module("app.input").directive("inputVatNumber",["$q","vatValidationApi",function($q,vatValidationApi){return{require:"ngModel",restrict:"A",link:function(scope,element,attrs,ngModel){ngModel.$asyncValidators.vatRegistrationNumber=function(modelValue,viewValue){var vatNumber=modelValue||viewValue;return vatNumber?vatValidationApi.get({vatNumber:vatNumber}).then(function(response){return!!response.data.valid||$q.reject()}):attrs.required?$q.reject():$q.resolve()}}}}]),function(){"use strict";function InputCityController(_,$evalAsync,$log,sharedDataCityApi,locationApi){function $onInit(){function onModelChaned(){if(_.isObject($ctrl.model.$viewValue)){_.get($ctrl.model,"$viewValue.id"),_.get($ctrl.model,"$viewValue.title")}$ctrl.value=$ctrl.model.$viewValue}$ctrl.name=$ctrl.name||DEFAULT_FIELD_NAME,$ctrl.model.$render=onModelChaned,$evalAsync(initFromApi)}function $onChanges(changesObj){if(changesObj.countryId){var newValue=_.parseInt(changesObj.countryId.currentValue),oldValue=_.parseInt(changesObj.countryId.previousValue);_.isInteger(newValue)&&_.isNaN(oldValue)?$ctrl.currentCountryId=newValue:_.isInteger(newValue)&&_.isInteger(oldValue)&&resetCity(newValue)}}function $postLink(){_.isFunction($ctrl.onReady)&&$ctrl.onReady()}function initFromApi(){function onLocationGetSuccess(res){function onCityGetSuccess(res){var cityId=_.get(res,"city_id")||null,cityTitle=_.get(res,"city_name")||geoCityTitle;if($ctrl.currentCountryId&&$ctrl.currentCountryId!==geoCountryId)return $log.debug("Input::inputCity::initFromApi::onCityGetSuccess:: Aborting: $ctrl.currentCountryId[%s], geoCountryId[%s]",$ctrl.currentCountryId,geoCountryId),!1;setValue(cityId,cityTitle),$log.debug("Input::inputCity::fetchCityForCountry::onCityGetSuccess::",getValue())}var geoCityTitle=_.get(res,"data.city");return geoCountryId=_.parseInt(_.get(res,"data.country_id")),$ctrl.value||!geoCityTitle?($log.debug("Input::inputCity::initFromApi::onLocationGetSuccess:: Aborting: $ctrl.value[%s], cityTitle[%s]",$ctrl.value,geoCityTitle),!1):!geoCountryId||$ctrl.currentCountryId&&$ctrl.currentCountryId!==geoCountryId?($log.debug("Input::inputCity::initFromApi::onLocationGetSuccess:: Aborting: $ctrl.currentCountryId[%s], geoCountryId[%s]",$ctrl.currentCountryId,geoCountryId),!1):($log.debug("Input::inputCity::initFromApi::onLocationGetSuccess:: geoCountryId[%s], geoCityTitle[%s]",geoCountryId,geoCityTitle),sharedDataCityApi.get(geoCountryId,geoCityTitle).then(onCityGetSuccess),!0)}if(!0===$ctrl.initFromApi&&!$ctrl.value)return locationApi.get().then(onLocationGetSuccess)}function onChange(value){setValue(_.get(value,"id"),_.get(value,"title"))}function setValue(id,title){$log.debug("Input::inputCity::setValue::",id,title),id=id||null,title=title||null,$ctrl.value={id:id,title:title},$ctrl.model.$setViewValue($ctrl.value),$ctrl.required&&$ctrl.model.$setValidity("required",!!title)}function getValue(){return $ctrl.value}function resetCity(countryId){if($ctrl.currentCountryId===countryId)return!1;$ctrl.currentCountryId=countryId||null,setValue()}function getSuggestions($event){var query=$event.queryValue;return!_.isString(query)||query.length<2?[]:($log.debug("Input::inputCity::getSuggestions::",query,$ctrl.currentCountryId),sharedDataCityApi.search($ctrl.currentCountryId,query).then(function(res){return _.map(res,function(city){return{id:city.city_id,title:city.city_name}})}))}var geoCountryId,$ctrl=this,DEFAULT_FIELD_NAME="input_city";$ctrl.currentCountryId=null,$ctrl.value=null,$ctrl.onChange=onChange,$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$postLink=$postLink,$ctrl.getSuggestions=getSuggestions}var inputCityComponent={templateUrl:"/assets-access-layer/js/shared/Input/templates/input-city.html",require:{model:"ngModel"},bindings:{countryId:"<",initFromApi:"<",required:"@",onReady:"&",name:"@",placeholder:"@",class:"@",fieldClass:"@",labelClass:"@",label:"@",help:"@",editable:"@"},controller:InputCityController};angular.module("app.input").component("inputCity",inputCityComponent)}(),function(){"use strict";function InputCountryController(_,locationApi,SharedDataApis,InputUtil){function $onInit(){function onCountriesLoadedSuccess(res){var values={};_.map(res.data,function(item){values[item[$ctrl.valueType]]=item.country_name}),$ctrl.values=values,allCountries=res.data,preloadCurrentCountry(),onSelectChange()}$ctrl.name=$ctrl.name||DEFAULT_FIELD_NAME,$ctrl.valueType="country_code"===$ctrl.valueType||"country_id",SharedDataApis.COUNTRIES().then(onCountriesLoadedSuccess)}function $postLink(){_.isFunction($ctrl.onReady)&&$ctrl.onReady()}function onSelectChange(){var searchFor={};if(searchFor[$ctrl.valueType]=$ctrl.value,_.isFunction($ctrl.onChange)){var newValue=_.find(allCountries,searchFor)||null;$ctrl.onChange({newValue:newValue})}}function preloadCurrentCountry(){function _onPreloadSuccess(res){var countryCode=_.get(res,"data.country_code");if(!$ctrl.value&&countryCode){var country=_.find(allCountries,{country_code:_.toLower(countryCode)});country&&($ctrl.value=country[$ctrl.valueType])}}InputUtil.toBoolean($ctrl.initFromApi)&&!$ctrl.value&&locationApi.get().then(_onPreloadSuccess)}var allCountries,$ctrl=this,DEFAULT_FIELD_NAME="input_country";$ctrl.$onInit=$onInit,$ctrl.$postLink=$postLink,$ctrl.onSelectChange=onSelectChange}var inputCountryComponent={templateUrl:"/assets-access-layer/js/shared/Input/templates/input-select.html",bindings:{value:"=ngModel",valueType:"@",name:"@",label:"@",placeholder:"@",initFromApi:"@",fieldClass:"@",required:"@",disabled:"@",onReady:"&",onChange:"&",labelClass:"@"},controller:InputCountryController};angular.module("app.input").component("inputCountry",inputCountryComponent)}(),function(){"use strict";function InputLocationController(_,$log,sharedDataLocationApi){function $onInit(){function onModelChanged(){if(_.isObject($ctrl.model.$viewValue)){_.get($ctrl.model,"$viewValue.id"),_.get($ctrl.model,"$viewValue.title")}$ctrl.value=$ctrl.model.$viewValue}$ctrl.name=$ctrl.name||DEFAULT_FIELD_NAME,$ctrl.model.$render=onModelChanged}function onChange(value){$ctrl.onInputChange({value:value}),$ctrl.clearInputOnChange?setValue():setValue(_.get(value,"id"),_.get(value,"title"))}function setValue(id,title){$log.debug("Input::inputLocation::setValue::",id,title),id=id||null,title=title||null,$ctrl.value={id:id,title:title},$ctrl.model.$setViewValue($ctrl.value),$ctrl.required&&$ctrl.model.$setValidity("required",!!title)}function getSuggestions($event){var query=$event.queryValue;return!_.isString(query)||query.length<2?[]:($log.debug("Input::inputCity::getSuggestions::",query),sharedDataLocationApi.search(query).then(function(res){var countries=_.map(res.countries,function(country){return{id:country.country_id,title:country.country_title,type:"country"}});countries=_.filter(countries,function(country){return!_.find($ctrl.excludeCountries,{id:country.id})});var cities=_.map(res.cities,function(city){return{id:city.city_id,title:city.city_title+", "+city.country_title,type:"city"}});return cities=_.filter(cities,function(city){return!_.find($ctrl.excludeCities,{id:city.id})}),_.concat(countries,cities)}))}var $ctrl=this,DEFAULT_FIELD_NAME="input_location";$ctrl.value=null,$ctrl.onChange=onChange,$ctrl.$onInit=$onInit,$ctrl.getSuggestions=getSuggestions}var inputLocationComponent={templateUrl:"/assets-access-layer/js/shared/Input/templates/input-location.html",require:{model:"ngModel"},bindings:{editable:"@allowCustomInput",required:"@",label:"@",disabled:"<",onInputChange:"&",clearInputOnChange:"@",excludeCities:"<",excludeCountries:"<",name:"@",placeholder:"@",fieldClass:"@",labelClass:"@",wrapperClass:"@"},controller:InputLocationController};angular.module("app.input").component("inputLocation",inputLocationComponent)}(),function(){"use strict";function InputJobTitleController(_,SharedDataApiFactory,$log){function $onInit(){$ctrl.name=$ctrl.name||DEFAULT_FIELD_NAME,$ctrl.labelClass=$ctrl.labelClass||"text-label--set-2 t_text-uppercase"}function $postLink(){_.isFunction($ctrl.onReady)&&$ctrl.onReady()}function getSuggestions($event){var query=$event.queryValue;return!_.isString(query)||query.length<MIN_STR_LENGTH_FOR_QUERY?[]:($log.debug("companyInput::getSuggestions::query:%s",query),companyApi({query:query}))}var $ctrl=this,DEFAULT_FIELD_NAME="input_job_title",MIN_STR_LENGTH_FOR_QUERY=2,companyApi=new SharedDataApiFactory({type:"job-titles",limit:6}).get;$ctrl.$onInit=$onInit,$ctrl.$postLink=$postLink,$ctrl.getSuggestions=getSuggestions}var inputJobTitleComponent={templateUrl:"/assets-access-layer/js/shared/Input/components/input-job-title.html",bindings:{value:"=ngModel",name:"@",placeholder:"@",fieldClass:"@",required:"@",editable:"@",onReady:"&",label:"@",labelClass:"@",helpBlockText:"@",helpBlockClass:"@"},controller:InputJobTitleController};angular.module("app.input").component("inputJobTitle",inputJobTitleComponent)}(),function(){"use strict";function RegistrationFormGroupController(_,$log,authModalService,authStream,CoreValidations){function $onInit(){$ctrl.displayTitle=!!$ctrl.displayTitle||!1,$ctrl.emailPattern=CoreValidations.EMAIL,$ctrl.passwordPattern=CoreValidations.PASSWORD}function $onDestroy(){}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var registrationFormGroupComponent={templateUrl:"/assets-access-layer/js/shared/Input/components/registration-form-group.html",bindings:{model:"<",displayTitle:"<"},controller:RegistrationFormGroupController};angular.module("app.input").component("registrationFormGroup",registrationFormGroupComponent)}(),function(){"use strict";function SignupInputGroupController(_,$log,authModalService,authStream,CoreValidations){function $onInit(){var formFieldRemaps=_.pick($ctrl.remap,_.keys($ctrl.formFieldNames));_.each(formFieldRemaps,function(value,key){$ctrl.formFieldNames[key]=value}),$ctrl.emailPattern=CoreValidations.EMAIL,userChangedSubscription=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function $onDestroy(){userChangedSubscription.dispose()}function openLogin(event){event.preventDefault(),authModalService.openLogin("default",{},!0)}function onUserChanged(user){$log.debug("onUserChanged::",user),$ctrl.userLoggedIn=user.isLoggedIn(),$ctrl.model.email_address=user.getEmail()}var userChangedSubscription,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.openLogin=openLogin}var signupInputGroupComponent={templateUrl:"/assets-access-layer/js/shared/Input/components/signup-input-group.html",bindings:{model:"<",remap:"<",onChange:"&"},controller:SignupInputGroupController};angular.module("app.input").component("signupInputGroup",signupInputGroupComponent)}(),angular.module("app.permission").constant("PermissionEvents",{DENIED:"UserDenied"}),angular.module("app.permission").constant("PermissionRoles",{USER:"ROLE_USER",ADMIN:"ROLE_ADMIN",SUPER_ADMIN:"ROLE_SUPER_ADMIN",AGENCY:"ROLE_CALL_INS",BOARD_MANAGER:"ROLE_BOARD_MANAGER"}),angular.module("app.permission").factory("PermissionInterceptor",["PermissionEvents","EventManager","$q",function(PermissionEvents,EventManager,$q){return{responseError:function(config){return 401===config.status&&EventManager.emit(PermissionEvents.DENIED,{}),$q.reject(config)}}}]),angular.module("app.auth").constant("AuthConstant",{PROVIDER:{USER_PASS:"user_pass",FACEBOOK:"facebook",TWITTER:"twitter",LINKEDIN:"linkedin",GOOGLE:"google"}});angular.module("app.auth").constant("AuthError",{NO_REFRESH_TOKEN:{message:"authService::refreshAccessToken:: No refresh token! Login first!. Aborting!"},NO_ACCESS_TOKEN:{message:"authService::refreshAccessToken::onRefreshTokenSuccess:: Token missing from response!"},ACCESS_TOKEN_EXPIRED:{message:"authService::refreshAccessToken::onRefreshTokenSuccess:: Token from refresh has already expired!"},ACCESS_TOKEN_REFRESH_ERROR:{message:"authService::refreshAccessToken::onRefreshTokenError:: Response for token refresh error!"},INVALID_AUTH_PROVIDER:{message:"authService::login:: Invalid authentication provider"},ALREADY_LOGGED_IN:{message:"authService::login:: Already logged in. Aborting!"}}),angular.module("app.auth").constant("AuthEvents",{USER_CHANGED:"userDataChanged",USER_SIGNUP:"userSignUp",COMPANY_CHANGED:"userCompanyDataChanged",PROTECT_CONTENT:"modalStatusChange"}),function(){"use strict";function authApi(_,$q,Routes,$http,CoreValidations,authErrorService){function getHttpService(route,refreshToken,params){return $http({method:"POST",timeout:MAX_TIMEOUT_MS,url:route,data:params||{},headers:{"x-refresh-token":refreshToken}})}function tokenRefresh(refreshToken){return getHttpService(Routes.AUTH.REFRESH,refreshToken).then(onTokenRefreshSuccess)}function logout(refreshToken){return getHttpService(Routes.AUTH.LOGOUT,refreshToken)}function getSwitchUserHttpService(userIdOrEmail){var data=CoreValidations.EMAIL.test(userIdOrEmail)?{email:userIdOrEmail}:{user_id:userIdOrEmail};return function(refreshToken){return getHttpService(Routes.AUTH.SWITCH,refreshToken,data).then(onTokenRefreshSuccess)}}function onTokenRefreshSuccess(response){var accessToken=_.get(response,"data.data.access_token");return accessToken?$q.resolve(accessToken):authErrorService.getErrorPromise("NO_ACCESS_TOKEN",response)}var MAX_TIMEOUT_MS=2e4;return{tokenRefresh:tokenRefresh,logout:logout,switch:getSwitchUserHttpService}}authApi.$inject=["_","$q","Routes","$http","CoreValidations","authErrorService"],angular.module("app.auth").factory("authApi",authApi)}(),function(){"use strict";function emailChangeApi(_,Routes,GenericApiFactory,$log,$q,CoreValidations){function requestEmailChange(email){return email&&CoreValidations.EMAIL.test(email)?emailChangeRequestApi.post({email:email}).then(function(res){return _.get(res,"data")||[]}):($log.error("auth::emailChangeApi::requestEmailChange:: Invalid / Missing email",email),$q.reject())}function confirmEmailChange(userId,token){return userId&&token?emailChangeConfirmApi.post({user_id:userId,token:token}).then(function(res){return _.get(res,"data")||[]}):($log.error("auth::emailChangeApi::confirmEmailChange:: Invalid / Missing userId or token",userId,token),$q.reject())}var emailChangeRequestApi=new GenericApiFactory(Routes.USER.EMAIL_CHANGE.REQUEST),emailChangeConfirmApi=new GenericApiFactory(Routes.USER.EMAIL_CHANGE.CONFIRM);return{requestEmailChange:requestEmailChange,confirmEmailChange:confirmEmailChange}}emailChangeApi.$inject=["_","Routes","GenericApiFactory","$log","$q","CoreValidations"],angular.module("app.auth").factory("emailChangeApi",emailChangeApi)}(),function(){"use strict";function registrationApi(_,Routes,GenericApiFactory,$log,$http){function register(data){var REGISTRATION_FIELDS=["firstname","lastname","title","email","location_country_id","password","newsletter","location_city_id","location_city_title","source","source_params","signup_referer_url","signup_referer_campaign_id","company_id","company_title","job_title","job_title_id","job_position_id","registration_type","extra","job_alerts","consents","journey_id"];return data=_.pick(data,REGISTRATION_FIELDS),$log.debug("auth::registrationApi::register",data),$http({method:"POST",url:Routes.REGISTRATION.REGISTER,data:data,validateCaptcha:!0})}function confirm(token){return $log.debug("auth::registrationApi::confirm",token),confirmApi.post({token:token})}function getUser(data){return getUserApi.get(data).then(function(res){return _.get(res,"data")||[]})}var confirmApi=new GenericApiFactory(Routes.REGISTRATION.CONFIRM),getUserApi=new GenericApiFactory(Routes.REGISTRATION.GET_USER);return{register:register,confirm:confirm,getUser:getUser}}registrationApi.$inject=["_","Routes","GenericApiFactory","$log","$http"],angular.module("app.auth").factory("registrationApi",registrationApi)}(),function(){"use strict";function resetPasswordApi(Routes,GenericApiFactory,$log){function requestResetPassword(email){return $log.debug("auth::resetPasswordApi::requestResetPassword::",email),resetPasswordApi.post({email:email})}function confirmResetPassword(token,newPassword){return $log.debug("auth::resetPasswordApi::confirmResetPassword::",token,newPassword),confirmPasswordApi.post({token:token,password:newPassword})}var resetPasswordApi=new GenericApiFactory(Routes.USER.RESET_PASSWORD.REQUEST),confirmPasswordApi=new GenericApiFactory(Routes.USER.RESET_PASSWORD.CONFIRM);return{requestResetPassword:requestResetPassword,confirmResetPassword:confirmResetPassword}}resetPasswordApi.$inject=["Routes","GenericApiFactory","$log"],angular.module("app.auth").factory("resetPasswordApi",resetPasswordApi)}(),function(){"use strict";function userSuggestionApi(_,Routes,GenericApiFactory,$log,$q){function fetchSuggestions(type,query,limit,offset){function onGetSuggestionsSuccess(res){return _.get(res,"data")||[]}if(!type||!_.includes(VALID_SUGGESTION_TYPES,type))return $log.error("auth::userSuggestionApi::fetchSuggestions:: missing or invalid type",type),$q.reject();if(!query)return $log.error("auth::userSuggestionApi::fetchSuggestions:: missing or invalid query",query),$q.reject();$log.debug("auth::userSuggestionApi::fetchSuggestions::",type,query,limit,offset);var payload={type:type};return query&&(payload.query=query),limit&&(payload.limit=limit),offset&&(payload.offset=offset),suggestApi.getSuggestions(payload).then(onGetSuggestionsSuccess)}var VALID_SUGGESTION_TYPES=["organisations","job-titles"],suggestApi=new GenericApiFactory(Routes.USER.SUGGESTION);return{fetchSuggestions:fetchSuggestions}}userSuggestionApi.$inject=["_","Routes","GenericApiFactory","$log","$q"],angular.module("app.auth").factory("userSuggestionApi",userSuggestionApi)}(),function(){"use strict";function AuthCheckController(_,authStream){function $onInit(){$ctrl.show=!1,authListener=authStream.USER_DATA_CHANGED.subscribe(onUserDataChanged)}function onUserDataChanged(user){$ctrl.show=!0,_.isNil($ctrl.loggedIn)||($ctrl.show=user.isLoggedIn()===$ctrl.loggedIn),_.isNil($ctrl.professional)||($ctrl.show=$ctrl.show&&user.hasMembership()===$ctrl.professional)}function $onDestroy(){authListener.dispose()}var $ctrl=this,authListener=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var authCheckComponent={template:'<ng-transclude ng-if="$ctrl.show"></ng-transclude>',bindings:{loggedIn:"<",professional:"<"},transclude:!0,controller:AuthCheckController};angular.module("app.auth").component("authCheck",authCheckComponent)}(),function(){"use strict";function AuthPermissionSectionController(_,$log,muaStream,InputUtil,UserService){function $onInit(){listener=muaStream.PERMISSIONS_CHANGED.subscribe(onPermissionsChanged)}function $onDestroy(){listener.dispose()}function hasPermission(permissions,requiredPermission){return!!_.find(permissions,function(currentPermission){return _.startsWith(currentPermission,requiredPermission)})}function onPermissionsChanged(payload){$ctrl.authorised=isSuperAllowed&&UserService.getCurrentUser().roles.isSuperAdmin()||hasPermission(payload.permissions,$ctrl.value),$log.debug("auth::authPermissionSection::onPermissionsChanged::",$ctrl.value,$ctrl.authorised)}var listener,$ctrl=this,isSuperAllowed=InputUtil.toBoolean($ctrl.allowSuper);$ctrl.authorised=!1,$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var authPermissionSectionComponent={template:'<div ng-if="$ctrl.authorised" ng-transclude></div>',bindings:{value:"@",allowSuper:"@"},transclude:!0,controller:AuthPermissionSectionController};angular.module("app.auth").component("authPermissionSection",authPermissionSectionComponent)}(),function(){"use strict";var authSocialComponent={templateUrl:"/assets-access-layer/js/shared/Auth/templates/social_authentication.html",bindings:{socialTitle:"@"}};angular.module("app.auth").component("authSocial",authSocialComponent)}(),function(){"use strict";function InputEmailChangeController(_,$q,CoreValidations,ChannelManager,EventManagerUtility,emailChangeApi){function onEmailToggle(event){$ctrl.editing=event.editing}function toggleEdit(){$ctrl.editing=!$ctrl.editing,$ctrl.formSuccess="",ChannelEventManager.emit("INPUT_EMAIL_TOGGLED",{editing:$ctrl.editing})}function onChange(){$ctrl.formSuccess="",$ctrl.formError=""}function testSubmit(){return CoreValidations.EMAIL.test($ctrl.newEmail)?_.toLower($ctrl.email)!==_.toLower($ctrl.newEmail)||($ctrl.formError="SAME_EMAIL",!1):($ctrl.formError="INVALID_EMAIL",!1)}function changeEmail(){function onChangeEmailSuccess(){return $ctrl.formSuccess=!0,$ctrl.editing=!1,$q.resolve()}function onChangeEmailError(response){return $ctrl.formError=_.get(response,"data.message")||"GENERIC_ERROR",$q.reject()}return emailChangeApi.requestEmailChange($ctrl.newEmail).then(onChangeEmailSuccess,onChangeEmailError)}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}var $ctrl=this,listeners=[];$ctrl.editing=!1,$ctrl.formError="",$ctrl.formSuccess="",$ctrl.newEmail="",$ctrl.toggleEdit=toggleEdit,$ctrl.onChange=onChange,$ctrl.testSubmit=testSubmit,$ctrl.changeEmail=changeEmail,$ctrl.$onDestroy=$onDestroy;var ChannelEventManager=ChannelManager.subscribe($ctrl.channel||"INPUT_EMAIL_CHANGE");listeners.push(ChannelEventManager.on("INPUT_EMAIL_TOGGLE",onEmailToggle))}var inputEmailChangeComponent={templateUrl:"/assets-access-layer/js/shared/Auth/templates/input_email_change.html",bindings:{email:"<",channel:"@"},controller:InputEmailChangeController};angular.module("app.auth").component("inputEmailChange",inputEmailChangeComponent)}(),function(){"use strict";function LoginModalController(_,EventManager,FormServiceFactory,UrlService,ChannelManager,SharedDataCompanyApiFactory,UiEvents,$q,$scope,resetPasswordApi,modalData,AuthEvents,UserEmailApi,emailChangeApi,authService,authLoginService,registrationApi,UserService,TrackerService,authRegistrationService,captchaService,authStream,formStream,$log,consentData,CONSENT_JOURNEY,journeyId,CAREERS_EVENT,consentJourneyTrackerService,trackService){function cleanFeedback(){$scope.feedback={error:null,message:null}}function close(){$modalInstance.dismiss()}function onSuccess(closeModal){closeModal?$modalInstance.close():$scope.status="complete"}function closeAndOpenModal(template){$modalInstance.close(template)}function remapErrors(message){return _.get({USER_NOT_CONFIRMED:"confirmation_sent",USER_VALID_NOT_CONFIRMED:"confirmation_sent",CONFIRM_USER_EMAIL_SENT:"confirmation_sent",ACTIVATION_LINK_EXPIRED:"link_expired",INVALID_DATA_PROVIDED:"invalid_data",INVALID_TOKEN:"invalid_token",INVALID_SOCIAL_AUTH_PAYLOAD:"invalid_social_payload"},message,!1)}function onRequestFailed(res){$log.debug("auth::LoginModalController::onRequestFailed::",res);var message=_.get(res,"data.message"),mappedMessage=remapErrors(message);return formStream.FORM_ERROR.onNext(_.get(res,"data")),!1===mappedMessage?($scope.feedback=message,$q.reject()):($scope.status=mappedMessage,res)}function login(){function executeLogin(){function onLoginSuccess(res){return $scope.onSuccess(!0),res}return authLoginService.login($scope.data).then(onLoginSuccess,onRequestFailed)}return $scope.cleanFeedback(),authService.logout().finally(executeLogin)}function register(){function onRegistrationSuccess(response){$scope.onSuccess(!1),UrlService.setUrlToCache(),authStream.USER_SIGNUP.onNext(response.data),TrackerService.track("Auth","ModalRegister",{finalStep:"submit",source:modalData.source}),trackService.track({subject:"user",subjectId:_.get(response,"data.data.user_id"),action:"register"})}var consentData=buildConsentsDataForSubmit($scope.registrationRequiredConsents,$scope.registrationOptionalConsents,$scope.registrationOptionalSelectedConsents);return $scope.cleanFeedback(),$scope.data.location_city_id=_.get($scope,"data.location_city.id",null),$scope.data.location_city_title=_.get($scope,"data.location_city.title",null),trackJobAlerts(),$scope.data.consents=consentData,$scope.data.journey_id=journeyId||CONSENT_JOURNEY.Register,$log.debug("auth::LoginModalController::register::",$scope.data),sendTracking($scope.data.journey_id),registrationApi.register($scope.data).then(onRegistrationSuccess,onRequestFailed)}function onCaptchaReady($event){function onReistrationSuccess(){registerPromise&&(registerPromise.resolve(),registerPromise=null)}function onReistrationError(){$scope.captchaReload=!$scope.captchaReload,registerPromise&&(registerPromise.reject(),registerPromise=null)}var tmpRegisterPromise;return $event.token&&"timedOut"!==$event.token?register().then(onReistrationSuccess,onReistrationError):($scope.feedback="timedOut"===$event.token?null:"CAPTCHA_INVALID",registerPromise?(registerPromise.reject(),tmpRegisterPromise=registerPromise,registerPromise=null,tmpRegisterPromise.promise):$q.reject())}function registerWithCaptcha(){return cleanFeedback(),$scope.captchaExecute=!$scope.captchaExecute,registerPromise&&(registerPromise.reject(),registerPromise=null),registerPromise=$q.defer(),registerPromise.promise}function activateAccount(){function executeActivateAccount(){function afterLoginSuccess(response){$scope.onSuccess(!0);var redirect=_.get($scope,"data.redirect");return redirect?(UrlService.changeUrl(redirect),response):(UrlService.goToCachedUrl(),response)}return authRegistrationService.activateAccount(token).then(afterLoginSuccess,onRequestFailed)}$scope.cleanFeedback();var token=_.get($scope.data,"token");return token||($log.debug("auth::LoginModalController::activateAccount:: Missing token!"),$q.reject()),authService.logout().finally(executeActivateAccount)}function socialLogin(provider){function executeLogin(){function onLoginSuccess(res){return $scope.onSuccess(!0),res}var socialData=_.omit($scope.data,["email","password"]);return $log.debug("auth::LoginModalController::socialLogin::executeLogin::",socialData),authLoginService.loginSocial(provider,$scope.data).then(onLoginSuccess,onRequestFailed)}return $scope.cleanFeedback(),authService.logout().finally(executeLogin)}function canSubmit(){return FormService.canSubmit()}function resetPassword(){function onRequestResetPasswordSuccess(res){return $scope.status="complete",res}$scope.cleanFeedback();var email=_.get($scope,"data.email");return resetPasswordApi.requestResetPassword(email).then(onRequestResetPasswordSuccess,onRequestFailed)}function confirmPassword(){function onConfirmResetPasswordSuccess(res){return $scope.status="complete",res}$scope.cleanFeedback();var token=_.get($scope,"data.token"),newPassword=_.get($scope,"data.password");return resetPasswordApi.confirmResetPassword(token,newPassword).then(onConfirmResetPasswordSuccess,onRequestFailed)}function confirmEmailChange(){function onConfirmEmailChangeSuccess(res){return $scope.status="complete",res}var userId,token;return userId=_.get($scope,"data.uid"),token=_.get($scope,"data.token"),emailChangeApi.confirmEmailChange(userId,token).then(onConfirmEmailChangeSuccess,onRequestFailed)}function isSubscribed(listIds,user){return UserService.isSubscribed(listIds,user)}function isNotSubscribed(listIds,user){return!isSubscribed(listIds,user)}function confirmUserEmail(){function onConfirmUserEmailSuccess(){$scope.data.redirectTo&&UrlService.changeUrl($scope.data.redirectTo)}function onConfirmUserEmailError(error){$scope.status="invalid_data"}return UserEmailApi.confirm({token:$scope.data.token}).then(onConfirmUserEmailSuccess,onConfirmUserEmailError)}function onQueryTypeAhead(data){if(typeAheadSuggestions.hasOwnProperty(data.id)){var serviceConfig=typeAheadSuggestions[data.id];serviceConfig.service(serviceConfig.getParams({query:data.query,limit:4})).then(function(res){ChannelEventManager.emit(UiEvents.INJECT_TYPEAHEAD,{id:data.id,results:res.data})})}}function prepareRegistrationConsentItems(consentData){$scope.registrationRequiredConsents=_.pickBy(consentData.groups,{is_required:!0}),$scope.registrationOptionalConsents=_.pickBy(consentData.groups,{is_required:!1}),$scope.registrationOptionalConsentsOrdered=_.orderBy($scope.registrationOptionalConsents,"consent_group_order_index"),$scope.journeyFooterTitle=consentData.journey_footer_title,$scope.journeyFooterDescription=consentData.journey_footer_description,$scope.registrationOptionalSelectedConsents=_.mapKeys($scope.registrationOptionalConsents,function(group){return group.consent_group_id}),$scope.registrationOptionalSelectedConsents=_.mapValues($scope.registrationOptionalSelectedConsents,function(group){return _.get(group,"default_preset",void 0)})}function consentChange(changeData,consentGroupKey,consentSectionKey){$scope.registrationOptionalSelectedConsents[consentGroupKey]=changeData.value,$scope.registrationAllConsentsEnabled=_.reduce($scope.registrationOptionalSelectedConsents,function(value,acceptAll){return acceptAll&&!!value}),enableAllChangesTrackingRecords[consentSectionKey]||(enableAllChangesTrackingRecords[consentSectionKey]={}),enableAllChangesTrackingRecords[consentSectionKey][consentGroupKey]=changeData.value}function enableAllConsents(){_.each($scope.registrationOptionalSelectedConsents,function(value,key){$scope.registrationOptionalSelectedConsents[key]=!0}),$scope.registrationAllConsentsEnabled=!0,enableAllTrackingRecords.newsletters=!0}function clearAllConsents(){_.each($scope.registrationOptionalSelectedConsents,function(value,key){$scope.registrationOptionalSelectedConsents[key]=void 0})}function buildConsentsDataForSubmit(requiredConsents,optionalConsents,optionalSelectedConsents){var acceptedConsents=[];return _.each(requiredConsents,function(group){group._items.forEach(function(consent){acceptedConsents.push({consent_id:consent.consent_id,consent_version_major:consent.consent_version_major,consent_version_minor:consent.consent_version_minor,is_enabled:!0})})}),_.each(optionalConsents,function(group){group._items.forEach(function(consent){void 0!==optionalSelectedConsents[group.consent_group_id]&&acceptedConsents.push({consent_id:consent.consent_id,consent_version_major:consent.consent_version_major,consent_version_minor:consent.consent_version_minor,is_enabled:optionalSelectedConsents[group.consent_group_id],subscribe:optionalSelectedConsents[group.consent_group_id]})})}),acceptedConsents}function recordSeeMoreClick(trackingData){_.get(seeMoreTrackingRecords,trackingData.consent_group_id)||(seeMoreTrackingRecords[trackingData.consent_group_id]=!0)}function sendTracking(journeyId){_.each(seeMoreTrackingRecords,function(value,key){value&&consentJourneyTrackerService.trackSeeMore(journeyId,key)}),_.each(enableAllTrackingRecords,function(value,key){value&&consentJourneyTrackerService.trackEnableAll(journeyId,key)}),_.each(enableAllChangesTrackingRecords,function(sectionConsents,sectionKey){_.each(sectionConsents,function(value,key){consentJourneyTrackerService.trackEnableAllChange(journeyId,sectionKey,key,!!enableAllTrackingRecords[sectionKey],value)})})}function trackJobAlerts(){var jobAlertConsentGroupId;_.forEach($scope.registrationOptionalConsents,function(consent){"exclusive-job-alerts"===consent.consent_group_key&&(jobAlertConsentGroupId=consent.consent_group_id)}),jobAlertConsentGroupId&&$scope.registrationOptionalSelectedConsents[jobAlertConsentGroupId]&&!0===$scope.registrationOptionalSelectedConsents[jobAlertConsentGroupId]&&TrackerService.track(CAREERS_EVENT.DOMAIN,"JobAlert",{Label:"JobAlertConfirmation.RegistrationPage.NewUser.CreateJobAlert"})}$scope.channel="subscribeSubchannel",$scope.form={},$scope.error={messageType:"none"},$scope.feedback=null,$scope.data=modalData||{},$scope.status=modalData.status,$scope.consentData=consentData,$scope.registrationRequiredConsents={},$scope.registrationOptionalConsents={},$scope.registrationOptionalSelectedConsents={},$scope.registrationAllConsentsEnabled=!1,$scope.cleanFeedback=cleanFeedback,$scope.close=close,$scope.onSuccess=onSuccess,$scope.closeAndOpenModal=closeAndOpenModal,$scope.login=login,$scope.register=register,$scope.registerWithCaptcha=registerWithCaptcha,$scope.activateAccount=activateAccount,$scope.socialLogin=socialLogin,$scope.canSubmit=canSubmit,$scope.resetPassword=resetPassword,$scope.confirmPassword=confirmPassword,$scope.confirmEmailChange=confirmEmailChange,$scope.isSubscribed=isSubscribed,$scope.isNotSubscribed=isNotSubscribed,$scope.confirmUserEmail=confirmUserEmail,$scope.onCaptchaReady=onCaptchaReady,$scope.prepareRegistrationConsentItems=prepareRegistrationConsentItems,$scope.consentChange=consentChange,$scope.enableAllConsents=enableAllConsents,$scope.clearAllConsents=clearAllConsents,$scope.recordSeeMoreClick=recordSeeMoreClick;var registerPromise,enableAllTrackingRecords={},enableAllChangesTrackingRecords={newsletters:{}},seeMoreTrackingRecords={},FormService=new FormServiceFactory($scope.form),ChannelEventManager=ChannelManager.subscribe($scope.channel),listeners=[],typeAheadSuggestions={company:{service:(new SharedDataCompanyApiFactory).get,getParams:function(filters){return filters}}},$modalInstance=modalData.modalInstance();listeners.push(ChannelEventManager.on(UiEvents.QUERY_TYPEAHEAD,onQueryTypeAhead,!0))}LoginModalController.$inject=["_","EventManager","FormServiceFactory","UrlService","ChannelManager","SharedDataCompanyApiFactory","UiEvents","$q","$scope","resetPasswordApi","modalData","AuthEvents","UserEmailApi","emailChangeApi","authService","authLoginService","registrationApi","UserService","TrackerService","authRegistrationService","captchaService","authStream","formStream","$log","consentData","CONSENT_JOURNEY","journeyId","CAREERS_EVENT","consentJourneyTrackerService","trackService"],angular.module("app.auth").controller("LoginModalController",LoginModalController)}(),function(){"use strict";function authActionWrapper(authModalService,authStream,UrlService){function postLink(scope,element,attrs){function onClick(event){function onLoginSuccess(){scope.redirectUrl&&UrlService.changeUrl(scope.redirectUrl)}isLoggedIn||(event.preventDefault(),event.stopPropagation(),authModalService.setSubscribeSource(scope.source),modalAction(status,{status:status,firewall:!0,source:scope.source},force).then(onLoginSuccess))}function onUserChanged(user){isLoggedIn=user.isLoggedIn()}function onDestroy(){listener.dispose()}var isLoggedIn=!1,status=attrs.status||"default",modalAction="signup"===scope.action?authModalService.openSignup:authModalService.openLogin,listener=authStream.USER_CHANGED.subscribe(onUserChanged),force="signup"!==scope.action&&!0===scope.force||null;scope.$on("$destroy",onDestroy),element.bind("click",onClick)}return{priority:-10,restrict:"A",scope:{source:"@",action:"@",redirectUrl:"@",force:"="},link:postLink}}authActionWrapper.$inject=["authModalService","authStream","UrlService"],angular.module("app.auth").directive("authActionWrapper",authActionWrapper)}(),function(){"use strict";function authFirewall(EventManager,authModalService,authStream,UrlService,AuthEvents){function link(scope){function onUserChanged(user){function onModalClose(){UrlService.gotoHomepage(),EventManager.emit("articleInjectChange",null),EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0})}user.isLoggedIn()||(authModalService.setSubscribeSource(scope.source),authModalService.setSubscribeSourceParams(scope.sourceParameters),authModalService.openLogin(status).catch(onModalClose))}var status=scope.status||"default";authStream.USER_CHANGED.subscribe(onUserChanged)}return{restrict:"E",scope:{status:"@",source:"@",sourceParameters:"@"},link:link}}authFirewall.$inject=["EventManager","authModalService","authStream","UrlService","AuthEvents"],angular.module("app.auth").directive("authFirewall",authFirewall)}(),function(){"use strict";function authLogin(authStream,EventManagerUtility){function link(scope){function onUserChanged(user){scope.isLoggedIn=user.isLoggedIn(),scope.hasMembership=user.hasMembership()}function onDestroy(){EventManagerUtility.removeListeners(listeners)}var listeners=[];scope.isLoggedIn=!1,scope.hasMembership=!1,scope.$on("$destroy",onDestroy),listeners.push(authStream.USER_CHANGED.subscribe(onUserChanged))}return{restrict:"A",link:link}}authLogin.$inject=["authStream","EventManagerUtility"],angular.module("app.auth").directive("authLogin",authLogin)}(),function(){"use strict";function authReadLimit(EventManager,AuthEvents,ViewCounterService,authModalService,UrlService,authStream,$log){function link(scope){function onUserChanged(user){function onModalClose(){UrlService.gotoHomepage(),EventManager.emit("articleInjectChange",null),EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0})}user.isLoggedIn()||(limitCounter=scope.uniqueId?ViewCounterService.getUniqueMonthlyViews(store,scope.uniqueId):ViewCounterService.getMonthlyViews(store))>limit&&($log.debug("auth::authReadLimit::onUserChanged:: limit hit!"),authModalService.setSubscribeSource(scope.source),authModalService.openLogin("contentLimit",{firewall:!0}).catch(onModalClose))}var limit=parseInt(scope.limit,10)||10,store=scope.store||"content_token",limitCounter=0;authStream.USER_CHANGED.subscribe(onUserChanged)}return{restrict:"E",scope:{store:"@",limit:"@",source:"@",uniqueId:"@"},link:link}}authReadLimit.$inject=["EventManager","AuthEvents","ViewCounterService","authModalService","UrlService","authStream","$log"],angular.module("app.auth").directive("authReadLimit",authReadLimit)}(),function(){"use strict";function actionInterceptor(_,$log,$q,$injector){function responseInterceptor(config){var actionHeader=_.isFunction(config.headers)?config.headers(ACTION_HEADER):null;return actionHeader&&_.isFunction(ACTION_HANDLERS[actionHeader])?ACTION_HANDLERS[actionHeader](config,!1):config}function responseErrorInterceptor(config){var actionHeader=_.isFunction(config.headers)?config.headers(ACTION_HEADER):null;return actionHeader&&_.isFunction(ACTION_HANDLERS[actionHeader])?ACTION_HANDLERS[actionHeader](config,!0):$q.reject(config)}function logoutAction(config,isError){return $log.debug("auth::AuthInvalidRefreshTokenInterceptor::ACTION_HANDLERS::logoutAction"),$injector.get("authService").logout(),isError?$q.reject(config):config}function retryExpiredAccessTokenAction(config,isError){function onRefreshAccessTokenSuccess(){retried=!0,$injector.get("$http")(config.config).then(deferred.resolve,deferred.reject)}function onRefreshAccessTokenError(){return retried=!0,deferred.reject(config)}$log.debug("auth::AuthInvalidRefreshTokenInterceptor::ACTION_HANDLERS::retryExpiredAccessTokenAction");var retried=!1;if(!0===retried)return $log.error("auth::AuthInvalidRefreshTokenInterceptor::ACTION_HANDLERS::retryExpiredAccessTokenAction already retried!"),isError?$q.reject(config):config;if(!config.config)return $log.error("auth::AuthInvalidRefreshTokenInterceptor::ACTION_HANDLERS::retryExpiredAccessTokenAction empty config!"),isError?$q.reject(config):config;var deferred=$q.defer();return $injector.get("authService").refreshAccessToken().then(onRefreshAccessTokenSuccess,onRefreshAccessTokenError),deferred.promise}function refreshAccessTokenAction(config,isError){return $log.debug("auth::AuthInvalidRefreshTokenInterceptor::ACTION_HANDLERS::REFRESH_ACCESS_TOKEN"),$injector.get("authService").refreshAccessToken(),isError?$q.reject(config):config}function autoLoginAction(config,isError){$log.debug("auth::AuthInvalidRefreshTokenInterceptor::ACTION_HANDLERS::autoLoginAction");var email=_.get(config,"config.data.email"),password=_.get(config,"config.data.password");return email&&password&&$injector.get("authLoginService").login({email:email,password:password}),isError?$q.reject(config):config}function removeObsoleteAccessTokenAction(config,isError){return $log.debug("auth::AuthInvalidRefreshTokenInterceptor::ACTION_HANDLERS::removeObsoleteAccessTokenAction"),delete window.localStorage.satellizer_token,isError?$q.reject(config):config}var ACTION_HEADER="x-action",ACTION_HANDLERS={LOGOUT:logoutAction,RETRY_EXPIRED_ACCESS_TOKEN:retryExpiredAccessTokenAction,REFRESH_ACCESS_TOKEN:refreshAccessTokenAction,LOGIN:autoLoginAction,REMOVE_OBSOLETE_ACCESS_TOKEN:removeObsoleteAccessTokenAction};return{response:responseInterceptor,responseError:responseErrorInterceptor}}actionInterceptor.$inject=["_","$log","$q","$injector"],angular.module("app.auth").factory("actionInterceptor",actionInterceptor)}(),function(){"use strict";function authAccessTokenInterceptor(_,$injector,$log,$q){function isAccessTokenRequired(config){return _.isEmpty(config.headers["x-refresh-token"])&&_.startsWith(config.url,"/xhr")&&!_.startsWith(config.url,"/xhr/registration")&&!_.startsWith(config.url,"/xhr/articles")}function requestInterceptor(config){if(!isAccessTokenRequired(config))return config;var authTokenService=$injector.get("authTokenService"),accessToken=authTokenService.getAccessToken();return authTokenService.getRefreshToken()&&accessToken?authTokenService.isAccessTokenExpired()?($log.debug("auth::authAccessTokenInterceptor:: AccessToken is expired. Pausing request:",config.url),refreshAccessTokenAndResume(config)):(config.headers[ACCESS_TOKEN_HEADER]="Bearer "+accessToken,config):config}function refreshAccessTokenAndResume(config){function onRefreshAccessTokenSuccess(){var accessTokenNew=authTokenService.getAccessToken();accessTokenNew&&!authTokenService.isAccessTokenExpired()&&(config.headers[ACCESS_TOKEN_HEADER]="Bearer "+accessTokenNew),deferred.resolve(config)}function onRefreshAccessTokenError(){deferred.reject(config)}var deferred=$q.defer(),authService=$injector.get("authService"),authTokenService=$injector.get("authTokenService");return authService.refreshAccessToken().then(onRefreshAccessTokenSuccess,onRefreshAccessTokenError),deferred.promise}var ACCESS_TOKEN_HEADER="x-access-token";return{request:requestInterceptor}}authAccessTokenInterceptor.$inject=["_","$injector","$log","$q"],angular.module("app.auth").factory("authAccessTokenInterceptor",authAccessTokenInterceptor)}(),angular.module("app.auth").service("ViewCounterService",["_","$localStorage","moment","CryptService",function(_,$localStorage,moment,CryptService){"use strict";this.getMonthlyViews=function(store){var perDayReadContent=CryptService.decryptJson($localStorage[store]),rollingDateLimit=moment().subtract(30,"days"),currentDate=moment().format("YYYY-MM-DD"),counter=0,currentIndex=null;return 0===Object.keys(perDayReadContent).length&&(perDayReadContent[currentDate]=0),currentIndex=Object.keys(perDayReadContent).sort().pop(),perDayReadContent[currentIndex]+=1,moment(currentIndex).isAfter(rollingDateLimit)?counter=perDayReadContent[currentIndex]:perDayReadContent[currentDate]=1,$localStorage[store]=CryptService.encryptJson(perDayReadContent),counter},this.getUniqueMonthlyViews=function(store,uniqueId){var perDayReadContent=CryptService.decryptJson($localStorage[store]),rollingDateLimit=moment().subtract(30,"days"),currentDate=moment().format("YYYY-MM-DD"),counter=0,currentIndex=null;return 0===Object.keys(perDayReadContent).length&&(perDayReadContent[currentDate]=[]),currentIndex=Object.keys(perDayReadContent).sort().pop(),_.indexOf(perDayReadContent[currentIndex],uniqueId)<0&&perDayReadContent[currentIndex].push(uniqueId),moment(currentIndex).isAfter(rollingDateLimit)?counter=perDayReadContent[currentIndex].length:perDayReadContent[currentDate]=[],$localStorage[store]=CryptService.encryptJson(perDayReadContent),counter}}]),function(){"use strict";function authCookieService(_,$log,$cookies,$window){function removeCookies(){$log.debug("auth::authCookieService::removeCookies::"),$cookies.remove("PHPSESSID",cookieOptions),$cookies.remove("REMEMBERME",cookieOptions)}function setRememberMeCookie(rememberMeCookie,expiresTimestamp){$log.debug("auth::authCookieService::setRememberMeCookie:: Storing rememberMeCookie %s with expires date timestamp %s",rememberMeCookie,expiresTimestamp),$cookies.put("REMEMBERME",rememberMeCookie,_.assign(cookieOptions,{expires:new Date(1e3*expiresTimestamp)}))}var cookieOptions={secure:!0,path:"/",domain:$window.location.hostname};return{removeCookies:removeCookies,setRememberMeCookie:setRememberMeCookie}}authCookieService.$inject=["_","$log","$cookies","$window"],angular.module("app.auth").factory("authCookieService",authCookieService)}(),function(){"use strict";function authErrorService($log,$q,AuthError,GlobalParams){function getErrorPromise(authErrorKey,response){var message=AuthError[authErrorKey]?AuthError[authErrorKey].message:authErrorKey;GlobalParams.DEV_ENABLED&&$log.error("auth::authErrorService:: ",message);var payload={message_key:authErrorKey,message:message};return response&&(payload.response=response),$q.reject(payload)}return{getErrorPromise:getErrorPromise}}authErrorService.$inject=["$log","$q","AuthError","GlobalParams"],angular.module("app.auth").factory("authErrorService",authErrorService)}(),function(){"use strict";function authLoginService(_,$auth,$log,$q,AuthConstant,authTokenService,authService,authErrorService,authCookieService,AuthError,UrlService){function setRememberMeCookie(rememberMeCookie,expires){rememberMeCookie&&authCookieService.setRememberMeCookie(rememberMeCookie,expires)}function onLoginError(loginResponse){return function(response){return response.status>0?$log.debug("auth::authLoginService::login:: Error Logging in.",response):$log.debug("auth::authLoginService::login:: Timeout logging in",response),loginResponse.reject(response)}}function onLoginSuccess(loginResponse){return function(response){function onRefreshTokenSuccess(res){return $log.debug("auth::authLoginService::onLoginSuccess::refreshAccessToken::",res),loginResponse.resolve(res)}function onRefreshTokenError(res){return $log.error("auth::authLoginService::onLoginSuccess::refreshAccessToken::",res),loginResponse.reject(res)}$log.debug("auth::authLoginService::onLoginSuccess Login successful!",response);var refreshToken=_.get(response,"data.data.refresh_token",null);if(!refreshToken)return loginResponse.reject(),authErrorService.getErrorPromise("Missing refresh_token from response!","",response);authTokenService.setRefreshToken(refreshToken),setRememberMeCookie(_.get(response,"data.data.remember_me"),authTokenService.getRefreshTokenExpiryTimestamp()),authService.refreshAccessToken(!0).then(onRefreshTokenSuccess,onRefreshTokenError)}}function login(data){if(authTokenService.getRefreshToken())return authErrorService.getErrorPromise(AuthError.ALREADY_LOGGED_IN);var loginResponse=$q.defer(),ALLOWED_DATA_FIELDS=["email","password","remember_me","source","signup_referer_url"];return data=_.pick(data||{},ALLOWED_DATA_FIELDS),data.signup_referer_url=data.signup_referer_url||UrlService.getCurrentUrl(),$auth.login(data).then(onLoginSuccess(loginResponse),onLoginError(loginResponse)),loginResponse.promise}function loginSocial(provider,data){if(!_.includes(AuthConstant.PROVIDER,provider))return authErrorService.getErrorPromise(AuthError.INVALID_AUTH_PROVIDER,provider);if(authTokenService.getRefreshToken())return authErrorService.getErrorPromise(AuthError.ALREADY_LOGGED_IN);var loginResponse=$q.defer(),ALLOWED_DATA_FIELDS=["source","signup_referer_url"];return data=_.pick(data||{},ALLOWED_DATA_FIELDS),data.authenticationServiceKey=provider,data.signup_referer_url=data.signup_referer_url||UrlService.getCurrentUrl(),$auth.authenticate(provider,data).then(onLoginSuccess(loginResponse),onLoginError(loginResponse)),loginResponse.promise}function manualLogin(refreshToken,rememberMeCookie){function executeLogin(){function onRefreshTokenSuccess(res){return loginResponse.resolve(res)}function onRefreshTokenError(res){return $log.error("auth::authLoginService::manualLogin:: refreshAccessToken failed!",res),loginResponse.reject(res)}$log.debug("auth::authLoginService::manualLogin Executing manual login"),authTokenService.setRefreshToken(refreshToken),setRememberMeCookie(rememberMeCookie,authTokenService.getRefreshTokenExpiryTimestamp()),authService.refreshAccessToken().then(onRefreshTokenSuccess,onRefreshTokenError)}var loginResponse=$q.defer();return authService.logout().finally(executeLogin),loginResponse.promise}return{login:login,loginSocial:loginSocial,manualLogin:manualLogin}}authLoginService.$inject=["_","$auth","$log","$q","AuthConstant","authTokenService","authService","authErrorService","authCookieService","AuthError","UrlService"],angular.module("app.auth").factory("authLoginService",authLoginService)}(),function(){"use strict";function authModalServiceProvider(){function setNamespace(namespace){FE_NAMESPACE=namespace}return{setNamespace:setNamespace,$get:authModalService}}function authModalService(_,UserService,userIdentityService,EventManager,TrackerService,$q,$window,PageCountService,UrlService,$timeout,AgentService,AuthEvents,authService,MuaUserInviteService,consentJourneyApi,CONSENT_JOURNEY,modalService){function setSubscribeSource(source){subscriberSource=source}function setSubscribeSourceParams(sourceParams){subscriberSourceParams=sourceParams}function setTemplateNamespace(namespace){templateNamespace=namespace}function setLegacyMode(status){legacy=status}function toggleBackdrop(status){EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!_.isBoolean(status)||status})}function openModal(template,data){var journeyId=CONSENT_JOURNEY.Register,signupUrl=UrlService.getCurrentPath();_.startsWith(signupUrl,"/careers")&&(journeyId=CONSENT_JOURNEY.RegisterCareers),_.startsWith(signupUrl,"/education")&&(journeyId=CONSENT_JOURNEY.RegisterEducation);var modalInstance=modalService.open({templateUrl:templateNamespace+template,controller:"LoginModalController",size:data.size||"md",backdrop:!0,animation:!AgentService.isIE(),resolve:{modalData:function(){return _.assign(data,{modalInstance:function(){return modalInstance}})},consentData:consentJourneyApi.get(journeyId),journeyId:journeyId}},!0);return modalInstance}function trackEvent(template,firewall){function track(){var eventParams={firewall:firewall,source:subscriberSource};TrackerService.track("Auth",templateEvent[template],eventParams)}var templateEvent={"login.html":"ModalLogin",register:"ModalRegister","reset_password.html":"ModalResetPassword","confirm_password.html":"ModalChangePassword","confirm_email.html":"ModalChangeEmail","activate_account.html":"ModalActivateAccount","register_conferences.html":"ModalSignupConferences","confirm_user_email.html":"ModalUserEmail"};return $timeout(track)}function openAuthModal(template,data,injectUser){function onModalSuccess(res){if(res)switch(closeModal(!0),res){case"login":return openLogin("",data,!0);case"register":return openSignup("",data);case"reset_password":return openResetPassword();case"confirm_password":return openConfirmPassword(data);case"confirm_email":return openConfirmEmail(data);case"activate_account":return openActivateAccount(data);case"sucessfully_registered":return openSuccessfullyRegistered(data);case"confirm_user_email":return openConfirmUserEmail(data);default:return openAuthModal(res,{status:data.status,email:data.email,password:data.password,source:data.source,source_params:data.source_params,firstname:data.firstname,lastname:data.lastname,company_title:data.company})}return generator?(closeModal(!0),generator()):(closeModal(),res)}function onModalError(){return closeModal(),$q.reject()}return PageCountService.reset(),data=data?angular.extend({source:subscriberSource,source_params:subscriberSourceParams},data):{},injectUser&&(data=angular.extend(UserService.getCurrent(),data)),popupOpen?$q.reject():(popupOpen=!0,toggleBackdrop(),trackEvent(template,!0===data.firewall),openModal(template,data).result.then(onModalSuccess,onModalError))}function extendData(messageType,data){return data=data||{},angular.extend(data,{status:messageType,signup_referer_url:$window.location.href})}function openLogin(messageType,data,force,customTemplate,injectUser){var extendedData=extendData(messageType,data),template=null,promise=null;return extendedData.size="md",extendedData.size=extendedData.size||"md",setTemplateNamespace(FE_NAMESPACE),userIdentityService.hasEverBeenLoggedIn()||force?(template=customTemplate?"login_"+messageType+".html":"login.html",promise=openAuthModal(template,extendedData,injectUser),promise.then(function(res){return userIdentityService.markLoggedIn(),legacy&&$timeout(function(){UrlService.reloadCurrentPage()},1e3),res}),promise):openSignup(messageType,data,customTemplate,injectUser)}function openSignup(messageType,data,customTemplate,injectUser,injectGenerator,stayLogin){var template=null,extendedData=extendData(messageType,data);return extendedData.size="lg-registration",extendedData.size=extendedData.size||"lg-registration",setTemplateNamespace(BE_NAMESPACE),template=customTemplate?"register_"+messageType:"register",stayLogin||openLogout(!1,!0),generator=injectGenerator?function(){return generator=null,openAuthModal(template,extendedData,injectUser)}:null,openAuthModal(template,extendedData,injectUser)}function openAccountsSignup(data){setSubscribeSource("Accounts"),MuaUserInviteService.getByToken(data.token,data.account_id).then(function(data){openSignup("accounts",data,!0,!0,!1,!1)},function(data){openSignup("accounts",data,!0,!0,!1,!1)})}function openResetPassword(){return setTemplateNamespace(FE_NAMESPACE),openAuthModal("reset_password.html")}function openConfirmPassword(data){return setTemplateNamespace(FE_NAMESPACE),openAuthModal("confirm_password.html",data)}function openConfirmEmail(data){return setTemplateNamespace(FE_NAMESPACE),openLogout(!1,!0),openAuthModal("confirm_email.html",data)}function openActivateAccount(data){return setTemplateNamespace(FE_NAMESPACE),openLogout(!1,!0),openAuthModal("activate_account.html",data)}function openSuccessfullyRegistered(data){return setTemplateNamespace(FE_NAMESPACE),openAuthModal("sucessfully_registered.html",data)}function openConfirmUserEmail(data){return openAuthModal("confirm_user_email.html",data)}function openLogout(track,ignoreLegacy){function afterLogout(res){return legacy&&!ignoreLegacy&&$timeout(function(){UrlService.gotoHomepage()},1e3),res}return authService.logout(!0).then(afterLogout)}function closeModal(preventEmit){preventEmit||toggleBackdrop(!1),popupOpen=!1}function isModalOpened(){return popupOpen}var popupOpen=!1,subscriberSource="",subscriberSourceParams=null,legacy=!1,templateNamespace=FE_NAMESPACE,generator=null;return{setSubscribeSource:setSubscribeSource,setSubscribeSourceParams:setSubscribeSourceParams,setTemplateNamespace:setTemplateNamespace,setLegacyMode:setLegacyMode,openAuthModal:openAuthModal,openLogin:openLogin,openSignup:openSignup,openAccountsSignup:openAccountsSignup,openResetPassword:openResetPassword,openConfirmPassword:openConfirmPassword,openConfirmEmail:openConfirmEmail,openActivateAccount:openActivateAccount,openSuccessfullyRegistered:openSuccessfullyRegistered,openConfirmUserEmail:openConfirmUserEmail,openLogout:openLogout,isModalOpened:isModalOpened}}authModalService.$inject=["_","UserService","userIdentityService","EventManager","TrackerService","$q","$window","PageCountService","UrlService","$timeout","AgentService","AuthEvents","authService","MuaUserInviteService","consentJourneyApi","CONSENT_JOURNEY","modalService"],angular.module("app.auth").provider("authModalService",authModalServiceProvider);var FE_NAMESPACE="/assets-access-layer/js/shared/Auth/templates/",BE_NAMESPACE="/templates/Auth/"}(),function(){"use strict";function authRegistrationService(_,$log,$q,authLoginService,registrationApi){function activateAccount(token){function onActivationSuccess(response){$log.debug("auth::authRegistrationService::onActivationSuccess",response);var refreshToken=_.get(response,"data.refresh_token"),rememberMeCookie=_.get(response,"data.remember_me");if(refreshToken)return authLoginService.manualLogin(refreshToken,rememberMeCookie).then(deferred.resolve,deferred.reject)}var deferred=$q.defer();return registrationApi.confirm(token).then(onActivationSuccess,deferred.reject),deferred.promise}return{activateAccount:activateAccount}}authRegistrationService.$inject=["_","$log","$q","authLoginService","registrationApi"],angular.module("app.auth").factory("authRegistrationService",authRegistrationService)}(),function(){"use strict";function authTokenSyncService(_,storageService,$log,$timeout,authTokenService,authUserService){function init(){storageService.STORAGE_STREAM.filter(filterTokenChanges).subscribe(onTokenChanged)}function filterTokenChanges(event){return event.storageKey===storageService.KEY.REFRESH_TOKEN||event.storageKey===storageService.KEY.ACCESS_TOKEN}function onTokenChanged(event){if($log.debug("auth::authTokenSyncService::init:: Detected change in [%s] token",event.storageKey,event),event.storageKey===storageService.KEY.REFRESH_TOKEN)return authTokenService.setRefreshToken(event.newValue,!0);authTokenService.setAccessToken(event.newValue,!0),$timeout(emitUserChanged,100)}function emitUserChanged(){authUserService.emitUserChanged()}return{init:_.once(init)}}authTokenSyncService.$inject=["_","storageService","$log","$timeout","authTokenService","authUserService"],angular.module("app.auth").factory("authTokenSyncService",authTokenSyncService)}(),function(){"use strict";function authTokenTimerService(_,$log,$timeout,$q){function resetErrorCount(){timesFailed=0}function clearTimer(){timerPromise&&($timeout.cancel(timerPromise),timerPromise=null)}function getSuccessTimer(accessTokenSecondsRemaining){if(clearTimer(),timesSucceeded>CONFIG.maxRefreshesWithinSessionCount)return $log.debug("auth::authTokenTimerService::getSuccessTimer:: Reached maximum refreshes for session!"),$q.reject();accessTokenSecondsRemaining=accessTokenSecondsRemaining||0;var TTLms=calculateTimeoutTimeMS(accessTokenSecondsRemaining);return $log.debug("auth::authTokenTimerService::getSuccessTimer:: timer set to [%s] sec",TTLms/1e3),timerPromise=$timeout(onTimeoutSuccess,TTLms)}function getErrorTimer(){clearTimer();var retryAfterMS=getBackoffMS(timesFailed);return $log.debug("auth::authTokenTimerService::getErrorTimer:: token refresh timer to [%s] sec",retryAfterMS/1e3),timesFailed++,timerPromise=$timeout(onTimeoutSuccess,retryAfterMS)}function getBackoffMS(counter){if(counter<1)return CONFIG.incrementalTimeoutMS;var ms=Math.pow(2,counter)*CONFIG.incrementalTimeoutMS;return ms<CONFIG.minIncrementalTimeoutMS&&(ms=CONFIG.minIncrementalTimeoutMS),ms>CONFIG.maxIncrementalTimeoutMS&&(ms=CONFIG.maxIncrementalTimeoutMS),ms}function hasTooManyFailures(){return timesFailed>CONFIG.maxFailCount}function onTimeoutSuccess(){timerPromise=null,timesSucceeded++}function calculateTimeoutTimeMS(accessTokenSecondsRemaining){var TTLsec=accessTokenSecondsRemaining>CONFIG.maxAccessTokenRefreshSeconds?CONFIG.maxAccessTokenRefreshSeconds:accessTokenSecondsRemaining-CONFIG.beforeAccessTokenRefreshSeconds;return TTLsec<10?1e4:1e3*TTLsec}var timerPromise,timesFailed=0,timesSucceeded=0,CONFIG={maxFailCount:0,incrementalTimeoutMS:1e4,minIncrementalTimeoutMS:1e4,maxIncrementalTimeoutMS:3e5,maxRefreshesWithinSessionCount:10,beforeAccessTokenRefreshSeconds:60,maxAccessTokenRefreshSeconds:1080};return{clearTimer:clearTimer,resetErrorCount:resetErrorCount,getSuccessTimer:getSuccessTimer,getErrorTimer:getErrorTimer,hasTooManyFailures:hasTooManyFailures}}authTokenTimerService.$inject=["_","$log","$timeout","$q"],angular.module("app.auth").factory("authTokenTimerService",authTokenTimerService)}(),function(){"use strict";function authTokenService(_,$log,moment,GlobalParams,storageService,authUtilService){function init(){accessToken=storageService.get(storageService.KEY.ACCESS_TOKEN),refreshToken=storageService.get(storageService.KEY.REFRESH_TOKEN),!refreshToken&&accessToken?setAccessToken(null):refreshToken&&(accessTokenPayload=accessToken?authUtilService.decodeToken(accessToken):{},refreshTokenPayload=refreshToken?authUtilService.decodeToken(refreshToken):{}),$log.debug("auth::authTokenService:: RefreshTokenPayload:",refreshTokenPayload),$log.debug("auth::authTokenService:: AccessTokenPayload:",accessTokenPayload)}function getAccessToken(){return accessToken}function setAccessToken(newAccessToken,skipSetStorage){if(accessToken=newAccessToken,skipSetStorage||(newAccessToken?storageService.set(storageService.KEY.ACCESS_TOKEN,newAccessToken):storageService.remove(storageService.KEY.ACCESS_TOKEN)),accessTokenPayload=accessToken?authUtilService.decodeToken(accessToken):{},GlobalParams.DEV_ENABLED){var tokenIssueTime=moment.unix(accessTokenPayload.iat).format("MMMM Do YYYY, h:mm:ss a"),tokenExpTime=moment.unix(accessTokenPayload.exp).format("MMMM Do YYYY, h:mm:ss a");$log.debug("auth::authTokenService::setAccessToken Token issue [%s] expiry [%s]",tokenIssueTime,tokenExpTime,accessTokenPayload)}}function getUserPayload(){return authUtilService.extractPayload(accessTokenPayload)}function isAccessTokenExpired(){return _.isEmpty(accessTokenPayload)||authUtilService.isExpiredPayload(accessTokenPayload)}function getAccessTokenRemainingSeconds(){return authUtilService.getPayloadExpirySeconds(accessTokenPayload)}function getRefreshTokenExpiryTimestamp(){return refreshTokenPayload.exp}function getRefreshToken(){return refreshToken}function setRefreshToken(newRefreshToken,skipSetStorage){$log.debug("auth::authTokenService::setRefreshToken Storing new refresh token",newRefreshToken),refreshToken=newRefreshToken,skipSetStorage||(newRefreshToken?storageService.set(storageService.KEY.REFRESH_TOKEN,newRefreshToken):storageService.remove(storageService.KEY.REFRESH_TOKEN)),refreshTokenPayload=refreshToken?authUtilService.decodeToken(refreshToken):{}}function isRefreshTokenExpired(){return authUtilService.isExpiredPayload(refreshTokenPayload)}var accessToken=null,accessTokenPayload={},refreshToken=null,refreshTokenPayload={};return{init:_.once(init),getAccessToken:getAccessToken,setAccessToken:setAccessToken,getUserPayload:getUserPayload,isAccessTokenExpired:isAccessTokenExpired,getAccessTokenRemainingSeconds:getAccessTokenRemainingSeconds,getRefreshTokenExpiryTimestamp:getRefreshTokenExpiryTimestamp,getRefreshToken:getRefreshToken,setRefreshToken:setRefreshToken,isRefreshTokenExpired:isRefreshTokenExpired}}authTokenService.$inject=["_","$log","moment","GlobalParams","storageService","authUtilService"],angular.module("app.auth").factory("authTokenService",authTokenService)}(),function(){"use strict";function authUserService(_,$log,User,authTokenService,authStream){function emitUserChanged(newUserPayload){if(newUserPayload=newUserPayload||authTokenService.getUserPayload(),payloadEqualsPrevious(newUserPayload))return void $log.debug("auth::authUserService::emitUserChanged:: newUserPayload equals emittedUserPayloadJson. Skipping emit!");var user=new User(newUserPayload);$log.debug("auth::authUserService::emitUserChanged::",user),authStream.USER_DATA_CHANGED.onNext(user),user.getId()!==currentUserId&&(authStream.USER_CHANGED.onNext(user),currentUserId=user.getId())}function payloadEqualsPrevious(newPayload){var payload=angular.toJson(_.omit(newPayload,["disqs"])),payloadsEqual=emittedUserPayloadJson===payload;return emittedUserPayloadJson=payload,payloadsEqual}var currentUserId,emittedUserPayloadJson=null;return{emitUserChanged:emitUserChanged}}authUserService.$inject=["_","$log","User","authTokenService","authStream"],angular.module("app.auth").factory("authUserService",authUserService)}(),function(){"use strict";function authUtilService(_,moment){function decodeBase64(str){var fromCharCode=String.fromCharCode,re_btou=new RegExp(["[-][-]","[-][-]{2}","[-][-]{3}"].join("|"),"g"),cb_btou=function(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return fromCharCode(55296+(offset>>>10))+fromCharCode(56320+(1023&offset));case 3:return fromCharCode((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}},btou=function(b){return b.replace(re_btou,cb_btou)};return function(a){return btou(atob(a))}(String(str).replace(/[-_]/g,function(m0){return"-"===m0?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}function decodeToken(token){if(token&&3===token.split(".").length)try{var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return angular.fromJson(decodeBase64(base64))}catch(e){}}function getPayloadExpiryMinutes(payload){return _.floor(getPayloadExpirySeconds(payload)/60)}function getPayloadExpirySeconds(payload){if(!payload.exp)return 0;var secondsRemaining=moment.unix(payload.exp).diff(moment(),"seconds");return secondsRemaining>0?secondsRemaining:0}function isExpiredPayload(payload){return getPayloadExpirySeconds(payload)<30}function extractPayload(accessToken){return _.get(accessToken,ACCESS_TOKEN_USER_KEY)||{}}var ACCESS_TOKEN_USER_KEY="usr";return{decodeBase64:decodeBase64,decodeToken:decodeToken,getPayloadExpiryMinutes:getPayloadExpiryMinutes,getPayloadExpirySeconds:getPayloadExpirySeconds,isExpiredPayload:isExpiredPayload,extractPayload:extractPayload}}authUtilService.$inject=["_","moment"],angular.module("app.auth").factory("authUtilService",authUtilService)}(),function(){"use strict";function authService(_,$log,$q,$timeout,User,authApi,authTokenService,authTokenTimerService,authUserService,authCookieService,errorStream){function init(){if(authTokenService.init(),!authTokenService.getRefreshToken())return $log.debug("auth::authService::init:: No refresh token, emitting user"),void authUserService.emitUserChanged();if(authTokenService.isRefreshTokenExpired())return $log.debug("auth::authService::init:: Refresh token expired, logging out.."),void logout();if(!authTokenService.getAccessToken())return $log.debug("auth::authService::init:: Missing access token"),void refreshAccessToken();if(authTokenService.isAccessTokenExpired())return $log.debug("auth::authService::init:: Access Token has expired, refreshing now.."),authUserService.emitUserChanged(),void refreshAccessToken();authUserService.emitUserChanged();var accessTokenSecondsRemaining=authTokenService.getAccessTokenRemainingSeconds();authTokenTimerService.getSuccessTimer(accessTokenSecondsRemaining).then(refreshAccessToken)}function refreshAccessToken(force){return $log.debug("auth::authService::refreshAccessToken::",arguments),refreshPromiseLock&&!force?($log.debug("auth::authService::refreshAccessToken:: Returning lock already in progress"),refreshPromiseLock.promise):(!force&&authTokenService.getRefreshToken()||rejectPromiseLock(),authTokenService.getRefreshToken()?($log.debug("auth::authService::refreshAccessToken:: Refreshing Access Token ..."),refreshPromiseLock=refreshPromiseLock||$q.defer(),authTokenTimerService.clearTimer(),executeApiRequest(),refreshPromiseLock.promise):($log.debug("auth::authService::refreshAccessToken:: No refresh token, cannot call API"),$q.reject()))}function onRefreshAccessTokenSuccess(accessToken){if($log.debug("auth::authService::onRefreshAccessTokenSuccess::"),authTokenService.setAccessToken(accessToken),authUserService.emitUserChanged(),authTokenService.isAccessTokenExpired())return $log.error("auth::authService::onRefreshAccessTokenSuccess:: Token already expired! Retrying"),void authTokenTimerService.getErrorTimer().then(executeApiRequest);var accessTokenSecondsRemaining=authTokenService.getAccessTokenRemainingSeconds();if(authTokenTimerService.resetErrorCount(),authTokenTimerService.getSuccessTimer(accessTokenSecondsRemaining).then(refreshAccessToken),clearStreamError(),!refreshPromiseLock)return void $log.error("auth::authService::onRefreshAccessTokenSuccess:: Critical error, no promise left to resolve!");refreshPromiseLock.resolve({}),refreshPromiseLock=null}function emitStreamError(errorKey){errorStream.SERVER_RESPONSE_ERROR.onNext({messageType:errorKey})}function clearStreamError(){errorStream.SERVER_RESPONSE_ERROR.onNext({messageType:!1})}function onRefreshAccessTokenError(response){return authTokenService.isRefreshTokenExpired()?void $log.debug("auth::authService::onRefreshAccessTokenError:: Refresh Token no longer valid!"):response&&response.status>=0?(authTokenTimerService.hasTooManyFailures()&&emitStreamError("SERVER_ERROR"),authTokenTimerService.getErrorTimer().then(executeApiRequest)):(emitStreamError("DISCONNECT"),authTokenTimerService.getErrorTimer().then(executeApiRequest))}function executeApiRequest(){return $log.debug("auth::authService::executeApiRequest::"),authTokenService.isRefreshTokenExpired()?($log.debug("auth::authService::executeApiRequest:: skipping method as refreshToken was removed!"),$q.reject()):refreshTokenApi(authTokenService.getRefreshToken()).then(onRefreshAccessTokenSuccess,onRefreshAccessTokenError)}function setRefreshTokenService(switchUserTo){$log.debug("auth::authService::setRefreshTokenService:: Setting refresh token API endpoint for user_id [%s]",switchUserTo),refreshTokenApi=!0===switchUserTo?authApi.tokenRefresh:authApi.switch(switchUserTo)}function removeAuthCredentials(){authTokenService.setRefreshToken(null),authTokenService.setAccessToken(null),authCookieService.removeCookies()}function rejectPromiseLock(){refreshPromiseLock&&($log.debug("auth::authService::rejectPromiseLock::"),refreshPromiseLock.reject(),refreshPromiseLock=null),authTokenTimerService.clearTimer()}function logout(executeApiCall){var deferred=$q.defer(),refreshToken=authTokenService.getRefreshToken();return refreshToken?($log.debug("auth::authService::logout:: Logging out .."),executeApiCall&&authApi.logout(refreshToken),removeAuthCredentials(),authUserService.emitUserChanged(),deferred.resolve()):($log.debug("auth::authService::logout:: User not logged in! Cant logout! (Removing any auth credentials)"),removeAuthCredentials(),deferred.reject()),setRefreshTokenService(!0),rejectPromiseLock(),deferred.promise}var refreshPromiseLock=null,refreshTokenApi=authApi.tokenRefresh;return{init:_.once(init),setRefreshTokenService:setRefreshTokenService,refreshAccessToken:refreshAccessToken,logout:logout}}authService.$inject=["_","$log","$q","$timeout","User","authApi","authTokenService","authTokenTimerService","authUserService","authCookieService","errorStream"],angular.module("app.auth").factory("authService",authService)}(),function(){"use strict";function authStream(EventManager,EventManagerUtility,AuthEvents,LazyStream){var USER_CHANGED=new LazyStream,USER_DATA_CHANGED=new LazyStream,USER_SIGNUP=new LazyStream;return function(){function onUserChanged(user){EventManager.emit(AuthEvents.USER_CHANGED,user)}USER_DATA_CHANGED.subscribe(onUserChanged)}(),{USER_CHANGED:USER_CHANGED,USER_DATA_CHANGED:USER_DATA_CHANGED,USER_SIGNUP:USER_SIGNUP,unsubscribe:EventManagerUtility.removeListeners}}authStream.$inject=["EventManager","EventManagerUtility","AuthEvents","LazyStream"],angular.module("app.auth").factory("authStream",authStream)}(),function(){"use strict";function signatureInterceptor(_,signatureService){function requestInterceptor(config){return isSignatureRequired(config)&&(config.headers=config.headers||{},config.headers[SIGNATURE_HEADER]=signatureService.generateSignature(config)),config}function isSignatureRequired(config){return _.startsWith(config.url,"/xhr/")}var SIGNATURE_HEADER="X-Signature";return{request:requestInterceptor}}signatureInterceptor.$inject=["_","signatureService"],angular.module("app.sign").factory("signatureInterceptor",signatureInterceptor)}(),function(){"use strict";function signatureService(_,Crc32){function createSignature(data){return data=_.isEmpty(data)?"7yaSda41":data,data=_.isObject(data)?angular.toJson(data):data,Crc32(data)}function extractUrlInfo(url){var questionMarkPosition=url.indexOf("?");return questionMarkPosition>0&&(url=url.substr(0,questionMarkPosition)),url=_.trimEnd(url,"/")}function generateSignature(requestConfig){var payloadSignature=createSignature(requestConfig.data);return payloadSignature+"."+createSignature(extractUrlInfo(requestConfig.url)+payloadSignature)}return{generateSignature:generateSignature}}signatureService.$inject=["_","Crc32"],angular.module("app.sign").factory("signatureService",signatureService)}(),angular.module("app.user").constant("UserConfig",{EMAIL_TYPE:{ACADEMIC:1}}),angular.module("app.user").constant("UserCaches",{DATA_CACHE:"UserDataCache"}),angular.module("app.user").component("selectUserData",{bindings:{modelId:"=",modelLabel:"=",name:"@",placeholder:"@"},template:'<div>               <input type="text"                       class="form-control"                       name="{[{::$ctrl.name}]}"                       placeholder="{[{::$ctrl.placeholder}]}"                       form-control                       typeahead="item as item.title for item in $ctrl.getSuggestions($viewValue)"                       typeahead-focus-first="false"                       typeahead-on-select="$ctrl.handleSelection($item, $model, $label)"                       typeahead-wait-ms="300"                       ng-model="$ctrl.model"                       ng-keyup="$ctrl.handleKeyUp($event)"                       ng-minlength="2"                       required /></div>',controller:["_","userSuggestionApi",function(_,userSuggestionApi){var ctrl=this;ctrl.model=ctrl.modelLabel,ctrl.getSuggestions=function(query){return userSuggestionApi.fetchSuggestions(ctrl.name,query).then(function(res){return _.isEmpty(res)&&(ctrl.modelId=0),res})},ctrl.handleSelection=function(item,model){model&&(ctrl.modelId=model.id,ctrl.modelLabel=model.label)},ctrl.handleKeyUp=function(){_.isObject(ctrl.model)||(ctrl.modelLabel=ctrl.model,ctrl.modelId=0)}}]}),angular.module("app.user").directive("selectUserTitle",["_",function(_){"use strict";return{restrict:"E",scope:{modelId:"=",name:"@",placeholder:"@",classSelect:"@",disabled:"@"},replace:!0,template:'<div>              <select class="form-control {[{::classSelect}]}" form-control name="{[{::name}]}" ng-model="model.selected" ng-options="item.label for item in itemList track by item.id" ng-change="handleChange()" required ng-disabled="{[{::disabled}]}">                   <option value="">{[{placeholder}]}</option>               </select>           </div>',link:function(scope){scope.itemList=[{id:"mr",label:"Mr"},{id:"ms",label:"Ms"},{id:"other",label:"Other"}],scope.model={selected:null},scope.modelId&&(scope.model.selected=_.find(scope.itemList,function(item){return item.id==scope.modelId})),scope.handleChange=function(){scope.model.selected&&(scope.modelId=scope.model.selected.id)}}}}]),angular.module("app.user").component("userFirstName",{template:"<span>{[{ $ctrl.user.firstname }]}</span>",replace:!0,controller:["EventManager","AuthEvents",function(EventManager,AuthEvents){var ctrl=this;ctrl.user={},EventManager.on(AuthEvents.USER_CHANGED,function(user){ctrl.user=user})}]}),angular.module("app.user").directive("userLoggedInShow",["EventManager","AuthEvents",function(EventManager,AuthEvents){"use strict";return{restrict:"A",link:function(scope,element,attrs){var negate="true"===attrs.negate,elementRef=angular.element(element);EventManager.on(AuthEvents.USER_CHANGED,function(user){user.id^negate?elementRef.addClass("hide"):elementRef.removeClass("hide")})}}}]),angular.module("app.user").service("AcademicEmailValidateApi",["_","GenericApiFactory","Routes","$log","$q",function(_,GenericApiFactory,Routes,$log,$q){"use strict";var AcademicEmailValidateApi=new GenericApiFactory(Routes.ORGANISATION.SCHOOL.VALIDATE_EMAIL);this.check=function(email){return AcademicEmailValidateApi.post({email:email}).then(function(response){var isValid=_.get(response,"data.is_valid");return $log.debug('AcademicEmailValidateApi::check Email "%s" validation result: %s',email,isValid),isValid||$q.reject(isValid)})}}]),angular.module("app.user").service("UserEmailApi",["GenericApiFactory","Routes","UserConfig",function(GenericApiFactory,Routes,UserConfig){"use strict";var UserEmailApi=new GenericApiFactory(Routes.CURRENT_USER.USER_EMAIL),UserEmailConfirmApi=new GenericApiFactory(Routes.CURRENT_USER.USER_EMAIL_CONFIRM);this.get=function(params){return UserEmailApi.get(params)},this.put=function(data){return UserEmailApi.put(data)},this.putAcademicEmail=function(email){return this.put({user_email:email,email_type_id:UserConfig.EMAIL_TYPE.ACADEMIC})},this.confirm=function(data){return UserEmailConfirmApi.put(data)}}]),angular.module("app.auth").service("UserRefreshTokenApi",["Routes","GenericApiFactory","$log",function(Routes,GenericApiFactory,$log){"use strict";var refreshTokenApi=new GenericApiFactory(Routes.CURRENT_USER.REFRESH_TOKEN);this.fetchRefreshTokens=function(limit,offset){$log.debug("UserRefreshTokenApi::fetchRefreshTokens::",limit,offset);var payload={};return limit&&(payload.limit=limit),offset&&(payload.offset=offset),refreshTokenApi.get(payload)}}]),angular.module("app.user").service("UserSchoolApi",["_","GenericApiFactory","Routes","DataService",function(_,GenericApiFactory,Routes,DataService){"use strict";var UserSchoolApi=new GenericApiFactory(Routes.CURRENT_USER.SCHOOL),userSchoolFields=["user_email","user_school_id","school_programme_type_id","graduation_year","school_course_title","organisation_title","school_user_type_id","is_topshop_optin"],prepareData=function(data){return DataService.normaliseFormData(data,["id","title"],userSchoolFields,!0)};this.get=function(){return UserSchoolApi.get().then(function(response){var responseData=_.pick(response.data,userSchoolFields);return response.data.organisation_id&&(responseData.organisation={id:response.data.organisation_id,title:response.data.organisation_title}),response.data.school_course_id&&(responseData.school_course={id:response.data.school_course_id,title:response.data.school_course_title}),responseData})},this.update=function(data){return UserSchoolApi.put(prepareData(data))}}]),angular.module("app.user").service("UserSubscriptionApi",["GenericApiFactory","Routes",function(GenericApiFactory,Routes){"use strict";var UserSubscriptionApi=new GenericApiFactory(Routes.CURRENT_USER.SUBSCRIPTION);this.get=function(params){return UserSubscriptionApi.get(params)},this.put=function(data){return UserSubscriptionApi.put(data)}}]),angular.module("app.user").service("UserSubscriptionConsentsApi",["GenericApiFactory","Routes",function(GenericApiFactory,Routes){"use strict";var UserSubscriptionConsentsApi=new GenericApiFactory(Routes.CURRENT_USER.SUBSCRIPTION_CONSENTS);this.put=function(data){return UserSubscriptionConsentsApi.put(data)}}]),angular.module("app.user").service("UserSubscriptionSingleApi",["GenericApiFactory","Routes",function(GenericApiFactory,Routes){"use strict";var UserSubscriptionSingleApi=new GenericApiFactory(Routes.CURRENT_USER.SUBSCRIPTION_SINGLE);this.put=function(data){return UserSubscriptionSingleApi.put(data)}}]),angular.module("app.user").factory("UserAccount",["_",function(_){function UserAccount(accounts){accounts=accounts||{};var self=this;this.getAccount=function(){return accounts.individual||{}},this.getProducts=function(){return _.has(self.getAccount(),"products")?self.getAccount().products:null},this.getProduct=function(productKey){return _.find(this.getProducts(),{product_key:productKey})},this.hasActiveProduct=function(productKey){var product=this.getProduct(productKey);return product&&!0===product.is_active},this.hasOrganisationAccounts=function(){return!_.isEmpty(accounts.org)},this.getOrganisationAccounts=function(){return this.hasOrganisationAccounts()?accounts.org:[]},this.getOrganisationAccountIds=function(){var organisationAccounts=accounts.org;return _.isEmpty(organisationAccounts)?[]:_.map(organisationAccounts,"id")}}return UserAccount}]),angular.module("app.user").factory("UserRole",["_","PermissionRoles",function(_,PermissionRoles){function UserRole(roles){var self=this;this.isSuperAdmin=function(){return!_.isEmpty(roles)&&_.includes(roles,PermissionRoles.SUPER_ADMIN)},this.isAdmin=function(){return this.isSuperAdmin()||_.includes(roles,PermissionRoles.SUPER_ADMIN)},this.hasRole=function(role,ignoreAdmin){return!_.isEmpty(roles)&&(ignoreAdmin?_.includes(roles,role):self.isAdmin()||_.includes(roles,role))},this.getRolesObject=function(){var res={};return _.isEmpty(roles)||_.map(roles,function(item){res[item]=!0}),res}}return UserRole}]),angular.module("app.user").factory("UserSchool",["_","$q","UserEmailApi",function(_,$q,UserEmailApi){function UserSchool(payload){this.getStudentEmail=function(){return UserEmailApi.get({email_type_ids:1}).then(function(res){return _.first(res.data)})}}return UserSchool}]),function(){"use strict";function userService(GenericApiFactory,EventManagerUtility,Routes,User,$log){function onUserChanged(user){currentUser=user}function getCurrent(){return currentUser.getPayload()}function getCurrentUser(){return currentUser}function isSubscribed(listIds){getCurrentUser().newsletters.isSubscribed(listIds)}function getFullDetails(){return currentUserApi.get().then(function(response){return response.data})}var currentUser=new User({}),currentUserApi=new GenericApiFactory(Routes.CURRENT_USER.ROOT,{action:"fetch"});return{onUserChanged:onUserChanged,getCurrent:getCurrent,getCurrentUser:getCurrentUser,isSubscribed:isSubscribed,getFullDetails:getFullDetails}}userService.$inject=["GenericApiFactory","EventManagerUtility","Routes","User","$log"],angular.module("app.user").factory("UserService",userService)}(),function(){"use strict";function journeyContextService(_,UrlService){function addJourneyContextData(apiData,journeyId){var urlParameters=UrlService.parseQuery();return urlParameters.articleSlug&&(apiData.journey_context={journey_id:journeyId,article_slug:urlParameters.articleSlug}),urlParameters.courseSlug&&(apiData.journey_context={journey_id:journeyId,course_slug:urlParameters.courseSlug}),urlParameters.journeyContext&&(apiData.journey_context={journey_id:journeyId,journey_context:urlParameters.journeyContext}),apiData}function generatePaymentPlanUrl(url,journeyContextObject,isMembershipMarketingPage){isMembershipMarketingPage=!!isMembershipMarketingPage,journeyContextObject=journeyContextObject||{};var urlParameters=_.pick(UrlService.parseQuery(),["articleSlug","courseSlug","journeyContext"]),paymentPlanUrlParams=UrlService.parseQuery(url);_.isEmpty(urlParameters)&&(_.get(journeyContextObject,"articleSlug",null)?urlParameters={articleSlug:journeyContextObject.articleSlug}:_.get(journeyContextObject,"courseSlug",null)?urlParameters={courseSlug:journeyContextObject.courseSlug}:_.get(journeyContextObject,"journeyContext",null)?urlParameters={journeyContext:journeyContextObject.journeyContext}:isMembershipMarketingPage&&(urlParameters={journeyContext:"membership-marketing-page"}));var firstParam=!0;return _.forEach(urlParameters,function(value,key){var joinSign=firstParam&&_.isEmpty(paymentPlanUrlParams)?"?":"&";firstParam=!1,url+=joinSign+key+"="+value}),url}return{addJourneyContextData:addJourneyContextData,generatePaymentPlanUrl:generatePaymentPlanUrl}}journeyContextService.$inject=["_","UrlService"],angular.module("app.user").factory("journeyContextService",journeyContextService)}(),function(){"use strict";function userIdentityService(_,$log,$sessionStorage,storageService){function getDeviceId(){return deviceId}function getSessionId(){return sessionId}function getLastUserId(){return lastUserId}function generateUniqueId(){return(Date.now().toString(36)+Math.random().toString(36).substr(2,5)).toUpperCase()}function init(){sessionId=$sessionStorage[storageService.KEY.SESSION_ID],deviceId=storageService.get(storageService.KEY.DEVICE_ID),lastUserId=storageService.get(storageService.KEY.LAST_USER_ID),sessionId||(sessionId=generateUniqueId(),$sessionStorage[storageService.KEY.SESSION_ID]=sessionId,$log.debug('userIdentityService::initUserIdentity:: Setting sessionId to "%s"',sessionId)),deviceId||(deviceId=generateUniqueId(),storageService.set(storageService.KEY.DEVICE_ID,deviceId),$log.debug('userIdentityService::initUserIdentity:: Setting deviceId to "%s"',deviceId))}function hasEverBeenLoggedIn(){return!!storageService.get(storageService.KEY.ALREADY_LOGGED_IN)}function markLoggedIn(){storageService.set(storageService.KEY.ALREADY_LOGGED_IN,1)}function setLastUserId(userId){$log.debug("userIdentityService::setLastUserId::",userId),storageService.set(storageService.KEY.LAST_USER_ID,userId)}var sessionId,deviceId,lastUserId;return{init:_.once(init),getDeviceId:getDeviceId,getSessionId:getSessionId,getLastUserId:getLastUserId,hasEverBeenLoggedIn:hasEverBeenLoggedIn,markLoggedIn:markLoggedIn,setLastUserId:setLastUserId}}userIdentityService.$inject=["_","$log","$sessionStorage","storageService"],angular.module("app.user").factory("userIdentityService",userIdentityService)}(),function(){"use strict";function userPermissionsApi(_,Routes,$log,$http){function get(){function resolveUserPermissionsResponse(response){return _.get(response,"data.data")}$log.debug("User::permissions::get");var request={method:"GET",url:Routes.CURRENT_USER.PERMISSIONS};return $http(request).then(resolveUserPermissionsResponse)}return{get:get}}userPermissionsApi.$inject=["_","Routes","$log","$http"],angular.module("app.user").factory("userPermissionsApi",userPermissionsApi)}(),function(){"use strict";function userProfileApi(_,GenericApiFactory,Routes,$log){function get(){return userProfileApi.get().then(function(response){return response.data=_.pick(response.data,userFields),response.data.location_city={id:response.data.location_city_id,title:response.data.location_city_title},response.data.company={id:response.data.company_id,title:response.data.company_title},response.data.job={id:response.data.job_title_id,title:response.data.job_title},response})}function update(data){return $log.debug("userProfileApi::update::",data),userProfileApi.post(_prepareData(data))}function _prepareData(data){var dataPayload=_.pick(data,userFields);return data.new_password&&(dataPayload.repeat_password=data.new_password),data.location_country_id&&(dataPayload.location_country_id=data.location_country_id),data.job&&data.job.id?dataPayload.job_title_id=data.job.id:dataPayload.job_title_id=null,data.job&&data.job.title?dataPayload.job_title=data.job.title:dataPayload.job_title=null,data.location_city&&data.location_city.id&&(dataPayload.location_city_id=data.location_city.id),data.location_city&&data.location_city.title&&(dataPayload.location_city_title=data.location_city.title),data.company&&data.company.id?dataPayload.company_id=data.company.id:dataPayload.company_id=null,data.company&&data.company.title?dataPayload.company_title=data.company.title:dataPayload.company_title=null,_.each(["location_city_id","job_title_id","company_id","company_size_id","location_country_id","job_industry_id","job_position_id","job_responsibility_id"],function(key){dataPayload[key]&&(dataPayload[key]=_.parseInt(dataPayload[key]))}),dataPayload}var userProfileApi=new GenericApiFactory(Routes.CURRENT_USER.ROOT),userFields=["firstname","lastname","title","email","location_country_id","new_password","repeat_password","location_city_id","location_city_title","company_id","company_title","company_size_id","job_industry_id","job_title_id","job_title","job_position_id","job_responsibility_id"];return{get:get,update:update}}userProfileApi.$inject=["_","GenericApiFactory","Routes","$log"],angular.module("app.user").factory("userProfileApi",userProfileApi)}(),function(){"use strict";function UserMenuController(_,$log,GlobalParams,$injector,EventManagerUtility,UrlService,authModalService,muaStream,UiEvents,DomService,$element,EventManager,authStream,menuStream,NavigationManager){function $onInit(){authModalService.setLegacyMode("true"===$ctrl.legacy),$ctrl.hasAnyOrgMenuPermissions=!1,$ctrl.hasOneAccount=!1,$ctrl.hasMultipleAccounts=!1,$ctrl.status=!1,$ctrl.isAdmin=!1,$ctrl.isSuperAdmin=!1,$ctrl.permissions={},$ctrl.isMembershipPartner=!1,listeners.push(NavigationManager.onChange(onNavigationChange)),listeners.push(authStream.USER_CHANGED.subscribe(onUserChanged)),listeners.push(muaStream.ACCOUNT_CHANGED.subscribe(onAccountChange)),listeners.push(muaStream.PERMISSIONS_CHANGED.subscribe(onPermissionsChanged)),listeners.push(EventManager.on(UiEvents.ROUTE_CHANGED,onRouteChanged)),listeners.push(menuStream.TOGGLE_USER.subscribe(onMenuToggled))}function login(event){event.preventDefault(),authModalService.setSubscribeSource("MainMenu"),authModalService.openLogin("default",{},!0)}function signup(event){event.preventDefault(),authModalService.setSubscribeSource("MainMenu"),authModalService.openSignup("default",{})}function logout(event){event.preventDefault(),authModalService.openLogout()}function handleClose(){}function onMenuToggled(data){var windowHeight=(DomService.getElementById("mainNav"),DomService.getHeight()),menuHeight=DomService.getHeight(elRef.firstChild),navChildStylePropreties=$element.children()[0].style;data.status&&menuHeight>windowHeight?(navChildStylePropreties.maxHeight=windowHeight-NAV_HEIGHT+"px",navChildStylePropreties.overflowY="auto"):""!==navChildStylePropreties.maxHeight&&(navChildStylePropreties.removeProperty("max-height"),navChildStylePropreties.removeProperty("overflow-y")),$ctrl.status=data.status}function onRouteChanged(){menuStream.TOGGLE_USER.onNext({status:!1})}function onNavigationChange(data){data.container===$ctrl.name&&($ctrl.status=data.value,$ctrl.status&&DomService.getTop(elRef)>100&&DomService.scrollToElement(elRef,0,200))}function onUserChanged(user){$ctrl.isLoggedIn=user.isLoggedIn(),$ctrl.displayName=user.getDisplayName(),$ctrl.email=user.getEmail(),$ctrl.truncatedEmail=_.truncate(user.getEmail(),{length:35}),$ctrl.isAdmin=user.roles.isAdmin(),$ctrl.isSuperAdmin=user.roles.isSuperAdmin(),$ctrl.permissions=user.roles.getRolesObject(),$ctrl.displayTooltip=$ctrl.email!==$ctrl.truncatedEmail;var accountIds=user.accounts.getOrganisationAccountIds();$ctrl.hasOneAccount=1===accountIds.length,$ctrl.hasMultipleAccounts=accountIds.length>1,accounts=user.accounts.getOrganisationAccounts()}function onAccountChange(data){$log.debug("UserMenuComponent::onAccountChange::",data),currentAccountId=_.get(data,"account.account_id")||null,currentAccountId&&(currentAccountId=_.parseInt(currentAccountId)),currentAccountProfileId=_.get(data,"profile_id")||_.get(data,"account.profile_id")||null,currentAccountProfileSlug=_.get(data,"profile_slug")||_.get(data,"account.company.profile_slug")||null}function onPermissionsChanged(payload){var found=!1;_.every(MENU_PERMISSIONS,function(requiredPermission){return!(found=!!_.find(payload.permissions,function(currentPermission){return _.startsWith(currentPermission,requiredPermission)}))}),$ctrl.hasAnyOrgMenuPermissions=found}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function gotoSPAUrl(linkKey){var types={HOME:"/spa#/app/accounts/{account_id}/home",KPI:"/spa#/app/accounts/{account_id}/company/{profile_id}/kpi/home",MANAGER:"/organisations/{profile_slug}",CAREERS:"/spa#/app/accounts/{account_id}/company/{profile_id}/jobs/enabled/0",COMPANY_GALLERY:"/spa#/app/accounts/{account_id}/company/{profile_id}/gallery/home",FASHION_SHOWS:"/spa#/app/accounts/{account_id}/company/{profile_id}/moodboard/boards/0",GROUP_MEMBERSHIP:"/spa#/app/accounts/{account_id}/group-membership/list",MUA:"/spa#/app/accounts/{account_id}/mua/users/0",COURSES:"/spa#/app/course/course-enrollments/list",APPLICATIONS:"/spa#/app/account/applications",BOF_PROFESSIONAL:"/spa#/app/membership/account-overview",SETTINGS:"/spa#/app/account/personal/settings",SAVED_ARTICLES:"/spa#/app/saved-articles"};if(!types[linkKey])return $log.error("Error, link [%s] not defined!");var url=types[linkKey];return _.each(getUrlVars(),function(value,key){url=_.replace(url,"{"+key+"}",value)}),UrlService.changeUrl(url)}function gotoSPAState(linkKey){if("MANAGER"===linkKey)return gotoSPAUrl(linkKey);var types={HOME:"app.accounts.home",KPI:"app.accounts.company.kpi.home",CAREERS:"app.accounts.company.jobs.enabled",BOARDS:"app.accounts.company.moodboard.boards",GROUP_MEMBERSHIP:"app.accounts.groupmembership.list",MUA:"app.accounts.mua.users.paginate",COURSES:"app.account.personal.setting",APPLICATIONS:"app.membership.account_overview",BOF_PROFESSIONAL:"app.account.applications",SETTINGS:"app.course.course_enrollments.list",SAVED_ARTICLES:"app.saved_articles.list"};return types[linkKey]?$injector.get("state").go(types[linkKey],getUrlVars()):$log.error("Error, link [%s] not defined!")}function navigateTo(linkKey){"SPA"===GlobalParams.APP_NAME?gotoSPAState(linkKey):gotoSPAUrl(linkKey)}function getUrlVars(){var currentAccount=_.find(accounts,{id:currentAccountId}),curAccountProfileId=currentAccount&&currentAccount.p_id||currentAccountProfileId,curtAccountSlug=currentAccount&&currentAccount.p_s||currentAccountProfileSlug;return{account_id:currentAccountId,profile_id:curAccountProfileId,profile_slug:curtAccountSlug,companyId:curAccountProfileId,jobOffset:0,boardOffset:0,userOffset:0}}var accounts,currentAccountId,currentAccountProfileId,currentAccountProfileSlug,$ctrl=this,listeners=[],elRef=$element[0],MENU_PERMISSIONS=["kpi","account.company_profile","careers","boards","group-memberships.info.view","account.account_user_list.read"],NAV_HEIGHT=49;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.login=login,$ctrl.signup=signup,$ctrl.logout=logout,$ctrl.navigateTo=navigateTo,$ctrl.handleClose=handleClose}var userMenuComponent={templateUrl:"/assets-access-layer/js/shared/User/templates/user-menu.html",bindings:{channel:"@",name:"@",legacy:"@"},controller:UserMenuController};angular.module("app.user").component("userMenu",userMenuComponent)}(),function(){"use strict";function UserStatusController(_,$timeout,NavigationManager,authStream,uiStream,menuStream,savedArticleStream,SAVED_ARTICLE,AgentService,MembershipTypes){function $onInit(){$ctrl.isLoggedIn=!1,$ctrl.isStudent=!1,$ctrl.userDisplayName="",$ctrl.userInitials="",$ctrl.menuOpen=!1,$ctrl.articleSavedTooltipOpen=!1,$ctrl.handleClick=handleClick,authListener=authStream.USER_DATA_CHANGED.subscribe(onUserDataChanged),windowClickListener=uiStream.WINDOW_CLICK.subscribe(closeMenu),toggleMenuListener=menuStream.TOGGLE_USER.subscribe(toggleArrow),articleSavedListener=savedArticleStream.ARTICLE_SAVED.subscribe(onArticleSaved)}function $onDestroy(){authListener.dispose(),windowClickListener.dispose(),toggleMenuListener.dispose(),articleSavedListener&&articleSavedListener.dispose(),windowScrollListener&&windowScrollListener.dispose()}function handleClick(event){event.preventDefault(),$ctrl.menuOpen=!$ctrl.menuOpen,menuStream.TOGGLE_USER.onNext({status:$ctrl.menuOpen}),NavigationManager.toggle("user")}function onUserDataChanged(user){$ctrl.isLoggedIn=user.isLoggedIn(),$ctrl.userInitials=getUserInitials(user),user.hasMembership()?($ctrl.premium=!0,$ctrl.isStudent=user.getMembershipType()===MembershipTypes.INDIVIDUAL_STUDENT_KEY):($ctrl.premium=!1,$ctrl.isStudent=!1)}function toggleArrow(event){$ctrl.menuOpen=event.status}function closeMenu(){$ctrl.menuOpen=!1,menuStream.TOGGLE_USER.onNext({status:$ctrl.menuOpen}),NavigationManager.setValue("user",!1)}function getUserInitials(user){$ctrl.userDisplayName=user.getDisplayName();var firstLetter=_.get(user,"firstname","");firstLetter=_.isString(firstLetter)?firstLetter.charAt(0):"";var secondLetter=_.get(user,"lastname","");return secondLetter=_.isString(secondLetter)?secondLetter.charAt(0):"",$ctrl.isLoggedIn?firstLetter+secondLetter||"ME":""}function onArticleSaved(){hideArticleSavedTimeout&&($timeout.cancel(hideArticleSavedTimeout),hideArticleSavedTimeout=null),$ctrl.articleSavedTooltipOpen=!0,hideArticleSavedTimeout=$timeout(hideArticleSavedTooltip,SAVED_ARTICLE.TOOLTIP_DURATION),AgentService.isMobile()&&(windowScrollListener=uiStream.WINDOW_SCROLL.subscribe(hideArticleSavedTooltip))}function hideArticleSavedTooltip(){hideArticleSavedTimeout&&($timeout.cancel(hideArticleSavedTimeout),hideArticleSavedTimeout=null),windowScrollListener&&(windowScrollListener.dispose(),windowScrollListener=null),$timeout(function(){$ctrl.articleSavedTooltipOpen=!1})}var $ctrl=this,authListener=null,windowClickListener=null,windowScrollListener=null,toggleMenuListener=null,articleSavedListener=null,hideArticleSavedTimeout=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var userStatusComponent={templateUrl:"/assets-access-layer/js/shared/User/templates/user-status.template.html",controller:UserStatusController};angular.module("app.user").component("userStatus",userStatusComponent)}(),function(){"use strict";function identityInterceptor(_,userIdentityService){function isIdentityRequired(config){return _.startsWith(config.url,"/xhr/")}function requestInterceptor(config){return isIdentityRequired(config)&&(config.headers=config.headers||{},config.headers[DEVICE_ID_HEADER]=userIdentityService.getDeviceId(),config.headers[SESSION_ID_HEADER]=userIdentityService.getSessionId()),config}var DEVICE_ID_HEADER="X-Dev-Id",SESSION_ID_HEADER="X-Sess-Id";return{request:requestInterceptor}}identityInterceptor.$inject=["_","userIdentityService"],angular.module("app.user").factory("identityInterceptor",identityInterceptor)}(),function(){function UserNewsletter(_,NewsletterList){function UserNewsletter(subscriptions){function _isSubscribedTo(listId){return _.isNumber(listId)||(listId=NewsletterList[listId]),_.includes(subscriptions,listId)}function getSubscriptions(){return subscriptions}function isSubscribed(listIds){if(!subscriptions)return!1;if(_.isArray(listIds)){var subscribed=!0;return _.every(listIds,function(listId){return subscribed=_isSubscribedTo(listId)}),subscribed}return _isSubscribedTo(listIds)}return{getSubscriptions:getSubscriptions,isSubscribed:isSubscribed}}return UserNewsletter}UserNewsletter.$inject=["_","NewsletterList"],angular.module("app.user").factory("UserNewsletter",UserNewsletter)}(),function(){"use strict";function UserModel(_,userIdentityService,UserNewsletter,UserAccount,UserSchool,UserRole){function User(payload){function getId(){return payload.id||null}function getEmail(){return payload.email||null}function isLoggedIn(){return!_.isEmpty(payload)}function getDisplayName(){return _.trim((payload.firstname||"")+" "+(payload.lastname||""))}function getPayload(){return payload}function getDeviceId(){return userIdentityService.getDeviceId()}function getSessionId(){return userIdentityService.getSessionId()}function getDisqusPayload(){return payload.disqs}function getRepaperingStep(){var repaperingStep=payload.repapering_step;return _.isNull(repaperingStep)?repaperingStep:_.toInteger(repaperingStep)}function getCompanyData(){return{job_responsibility_id:payload.job_responsibility_id,job_level_id:payload.job_level_id}}function getMembershipType(){return _.get(payload,"membership.membership_type")||payload.membership_type}function getMembershipPaymentError(){return _.get(payload,"membership_payment_error")}function getSharedLoginCount(){return _.get(payload,"shared_login_count")||null}function hasMembership(){return!!getMembershipType()}function getPartnerId(){return _.get(payload,"membership.partner_id")}function isGod(){return user.roles.hasRole("ROLE_ALLOWED_TO_SWITCH",!0)&&user.roles.isSuperAdmin()&&(_.endsWith(getEmail(),"dlabs.si")||_.endsWith(getEmail(),"businessoffashion.com"))}function isInGodMode(){return _.get(payload,"g_mode")}var user=this;return _.extend(user,payload),user.roles=new UserRole(payload.roles),user.accounts=new UserAccount(payload.acc),user.newsletters=new UserNewsletter(payload.newsletter_subs),user.schools=new UserSchool(payload),user.getId=getId,user.getEmail=getEmail,user.isLoggedIn=isLoggedIn,user.getDisplayName=getDisplayName,user.getPayload=getPayload,user.getDeviceId=getDeviceId,user.getSessionId=getSessionId,user.hasMembership=hasMembership,user.getMembershipType=getMembershipType,user.getMembershipPaymentError=getMembershipPaymentError,user.getSharedLoginCount=getSharedLoginCount,user.getPartnerId=getPartnerId,user.getDisqusPayload=getDisqusPayload,user.isGod=isGod,user.isInGodMode=isInGodMode,user.getCompanyData=getCompanyData,user.getRepaperingStep=getRepaperingStep,user}return User}UserModel.$inject=["_","userIdentityService","UserNewsletter","UserAccount","UserSchool","UserRole"],angular.module("app.user").factory("User",UserModel)}(),angular.module("app.mua").constant("MuaRouteConfig",{ACCOUNTS:"/xhr/accounts/:accountId",ACCOUNT_PERMISSIONS:"/xhr/accounts/:accountId/permissions"}),angular.module("app.mua").factory("MuaUserInviteApi",["$resource",function($resource){"use strict";return $resource("/xhr/accounts/:accountId/invite/:token",{accountId:"@accountId",token:"@token"},{get:{method:"GET"}})}]).factory("MuaUserInviteApiFactory",["MuaUserInviteApi","DataService",function(MuaUserInviteApi,DataService){"use strict";function Factory(params){var apiParams=params;this.get=function(){return MuaUserInviteApi.get(apiParams,{}).$promise}}return Factory}]),function(){"use strict";function AccountService(_,$log,storageService,muaStream,AuthEvents,MuaRouteConfig,CompanyService,GenericApiFactory,EventManager){function onUserChanged(user){if(!user.getId())return currentUserId=null,void setCurrent(null);if(user.getId()!==currentUserId){if(currentUserId=user.getId(),$log.debug("AccountService::onUserChanged::"),currentAccountId&&userHasPermissionsToAccessAccount(user,currentAccountId))return void $log.debug("AccountService::onUserChanged::","userHasPermissionsToAccessAccount",currentAccountId);var userAccountIds=user.accounts.getOrganisationAccountIds();if(1===userAccountIds.length)return $log.debug("AccountService::onUserChanged::","(userAccountIds.length === 1)"),void setCurrent(_.parseInt(_.first(userAccountIds)));var accountIdFromLocalStorage=_.parseInt(storageService.get(storageService.KEY.CURRENT_ACCOUNT_ID));if(accountIdFromLocalStorage&&userHasPermissionsToAccessAccount(user,accountIdFromLocalStorage))return $log.debug("AccountService::onUserChanged::","accountIdFromLocalStorage"),void setCurrent(accountIdFromLocalStorage);setCurrent(null)}}function userHasPermissionsToAccessAccount(user,accountId){return user.roles.isSuperAdmin()||_.includes(user.accounts.getOrganisationAccountIds(),accountId)}function getCurrent(){return currentAccount}function setCurrent(accountId){function onAccountSuccess(res){currentAccount=_.get(res,"data.results[0]")||{},currentAccountId=_.parseInt(currentAccount.account_id),$log.debug("AccountService::setCurrent::onAccountSuccess::",currentAccount),currentAccountId?storageService.set(storageService.KEY.CURRENT_ACCOUNT_ID,currentAccountId):storageService.remove(storageService.KEY.CURRENT_ACCOUNT_ID),muaStream.ACCOUNT_CHANGED.onNext({account:currentAccount}),currentAccount.profile_id&&CompanyService.setCurrent(currentAccount.profile_id),refreshUserAccountPermissions()}function onAccountError(res){$log.debug("AccountService::setCurrent::onAccountError::",res),currentAccountId=previousAccountId}if($log.debug("AccountService::setCurrent::",accountId),!(accountId=_.parseInt(accountId)))return currentAccountId=null,currentAccount={},muaStream.ACCOUNT_CHANGED.onNext({account:currentAccount}),void $log.debug("AccountService::setCurrent::","Removing current account");if(accountId===currentAccountId)return void $log.debug("AccountService::setCurrent::accountId equals current [%s]",currentAccountId);var previousAccountId=currentAccountId;currentAccountId=accountId,accountApi.get({accountId:accountId,decorate:"native_image,company"}).then(onAccountSuccess,onAccountError)}function refreshUserAccountPermissions(){function onPermissionsLoaded(res){var permissions=_.get(res,"data.results");muaStream.PERMISSIONS_CHANGED.onNext({permissions:permissions})}_.isEmpty(currentAccount)||permissionApi.get({accountId:currentAccount.account_id}).then(onPermissionsLoaded)}var currentUserId,currentAccount={},currentAccountId=null,accountApi=new GenericApiFactory(MuaRouteConfig.ACCOUNTS),permissionApi=new GenericApiFactory(MuaRouteConfig.ACCOUNT_PERMISSIONS);return{onUserChanged:onUserChanged,getCurrent:getCurrent,setCurrent:setCurrent}}AccountService.$inject=["_","$log","storageService","muaStream","AuthEvents","MuaRouteConfig","CompanyService","GenericApiFactory","EventManager"],angular.module("app.mua").factory("AccountService",AccountService)}(),angular.module("app.mua").service("MuaUserInviteService",["DataService","MuaUserInviteApiFactory",function(DataService,MuaUserInviteApiFactory){"use strict";this.getByToken=function(token,account_id){return new MuaUserInviteApiFactory({accountId:account_id,token:token}).get().then(function(res){return res.data},function(res){return!1})}}]),function(){"use strict";function muaStream(LazyStream){return{ACCOUNT_CHANGED:new LazyStream,PERMISSIONS_CHANGED:new LazyStream}}muaStream.$inject=["LazyStream"],angular.module("app.mua").factory("muaStream",muaStream)}(),function(){"use strict";function WallCounterComponentController(){function $onInit(){$ctrl.parent.registerCounter($ctrl.name)}var $ctrl=this;$ctrl.$onInit=$onInit}var wallCounterComponent={require:{parent:"^wall"},bindings:{name:"@"},controller:WallCounterComponentController};angular.module("app.wall").component("wallCounter",wallCounterComponent)}(),function(){"use strict";function WallHandlerRegistrationWrappedController($log,authStream,TrackerService,ARTICLE_EVENT,WallConfig,wallStream,trackService){function $onInit(){userChangedSubscription=authStream.USER_CHANGED.subscribe(onUserChanged),itemBlockedSubscription=wallStream.ITEM_BLOCKED.filter(function(event){return event.type==WallConfig.BLOCK_TYPE_REGISTRATION&&(!$ctrl.itemId||event.itemId==$ctrl.itemId)}).subscribe(onItemBlocked)}function onItemBlocked(event){isLoggedIn||($log.info("Wall::wallHandlerRegistrationWrapped::onItemBlocked:: Showing registration wrapper with source:",event.source),$ctrl.source=event.source,$ctrl.enableBlocking=!0,TrackerService.track(ARTICLE_EVENT.DOMAIN,"RegWallView",{id:event.itemId}),trackService.track({subject:"user",action:"view",object:"registration_wall",preposition:"on",prepositionalObject:"fashion_week_collection",prepositionalObjectId:$ctrl.itemId}))}function onUserChanged(user){$log.info("Wall::wallHandlerRegistrationWrapped::onUserChanged::"),isLoggedIn=user.isLoggedIn(),$ctrl.enableBlocking=!isLoggedIn}function $onDestroy(){userChangedSubscription.dispose(),itemBlockedSubscription.dispose()}var userChangedSubscription,itemBlockedSubscription,isLoggedIn,$ctrl=this;$ctrl.source="",$ctrl.enableBlocking=!1,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var wallHandlerRegistrationWrappedComponent={transclude:!0,templateUrl:function($attrs){return $attrs.templateUrl},bindings:{itemId:"@"},controller:WallHandlerRegistrationWrappedController};angular.module("app.wall").component("wallHandlerRegistrationWrapped",wallHandlerRegistrationWrappedComponent)}(),function(){"use strict";function WallHandlerRegistrationController(_,$log,AuthEvents,authModalService,EventManager,authStream,UrlService,wallTrackingService,ARTICLE_EVENT,WallConfig,wallStream,utmService,trackService){function $onInit(){userChangedSubscription=authStream.USER_CHANGED.subscribe(onUserChanged),itemBlockedSubscription=wallStream.ITEM_BLOCKED.filter(function(event){return event.type==WallConfig.BLOCK_TYPE_REGISTRATION&&(!$ctrl.itemId||event.itemId==$ctrl.itemId)}).subscribe(onItemBlocked)}function onItemBlocked(event){if(!isLoggedIn){$log.info("Wall::wallHandlerRegistration::onItemBlocked:: Showing registration modal with source:",event.source);var type="contentLimit";"is-registered"==event.strategy&&(type="restrictedContent"),openAuthModal(type,event.source),wallTrackingService.track(ARTICLE_EVENT.DOMAIN,event),trackService.track({subject:"user",action:"view",object:"registration_wall",preposition:"on",prepositionalObject:"article",prepositionalObjectId:$ctrl.itemId}),utmService.saveUTMParams({utm_content:"MeteredPaywall",utm_term:_.get(event,"source")})}}function openAuthModal(type,source){function onLoggedInSuccess(){}function onLoggedInFailure(){UrlService.gotoHomepage(),EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0})}return authModalService.setSubscribeSource(source),authModalService.openLogin(type,{firewall:!0}).then(onLoggedInSuccess).catch(onLoggedInFailure)}function onUserChanged(user){$log.info("Wall::wallHandlerRegistration::onUserChanged::"),isLoggedIn=user.isLoggedIn()}function $onDestroy(){userChangedSubscription.dispose(),itemBlockedSubscription.dispose()}var itemBlockedSubscription,userChangedSubscription,isLoggedIn,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var wallHandlerRegistrationComponent={bindings:{itemId:"@"},controller:WallHandlerRegistrationController};angular.module("app.wall").component("wallHandlerRegistration",wallHandlerRegistrationComponent)}(),function(){"use strict";function WallHandlerSubscriptionWrappedController(_,$log,authStream,wallTrackingService,ARTICLE_EVENT,WallConfig,wallStream,ChannelManager,UiEvents,utmService){function $onInit(){userChangedSubscription=authStream.USER_CHANGED.subscribe(onUserChanged),itemBlockedSubscription=wallStream.ITEM_BLOCKED.filter(function(event){return event.type==WallConfig.BLOCK_TYPE_SUBSCRIPTION&&(!$ctrl.itemId||event.itemId==$ctrl.itemId)}).subscribe(onItemBlocked),ChannelManager.subscribe($ctrl.scrollInViewChannel).on(UiEvents.CHANGE_IN_VIEW,handleScrollIntoView)}function onItemBlocked(event){isUserMember||($log.info("Wall::wallHandlerSubscriptionWrapped::onItemBlocked:: Showing subscription block"),$ctrl.enableBlock=!0,"is-subscribed"==event.strategy&&($ctrl.blockReason="subscriber-only"),wallTrackingService.track(ARTICLE_EVENT.DOMAIN,event),utmService.saveUTMParams({utm_content:"HardPaywall",utm_term:_.get(event,"source")}))}function getTrackingLabel(eventType){return wallTrackingService.getLabel(null,eventType)}function getTrackingEvent(eventType){return wallTrackingService.getDBTrackingEventName(null,eventType)}function onUserChanged(user){$log.info("Wall::wallHandlerSubscriptionWrapped::onUserChanged::"),isUserMember=user.hasMembership(),isUserMember&&($ctrl.enableBlock=!1),$ctrl.userIsLoggedIn=user.isLoggedIn()}function handleScrollIntoView(event){1!=_.get(event,"data.status")||scrollInViewTrackerSent||(wallTrackingService.track(ARTICLE_EVENT.DOMAIN,{eventType:"scrollInView"}),scrollInViewTrackerSent=!0)}function $onDestroy(){userChangedSubscription.dispose(),itemBlockedSubscription.dispose()}var isUserMember,userChangedSubscription,itemBlockedSubscription,$ctrl=this,scrollInViewTrackerSent=!1;$ctrl.userIsLoggedIn=!1,$ctrl.enableBlock=!1,$ctrl.blockReason=null,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.getTrackingLabel=getTrackingLabel,$ctrl.getTrackingEvent=getTrackingEvent}var wallHandlerSubscriptionWrappedComponent={transclude:!0,templateUrl:function($attrs){return $attrs.templateUrl},bindings:{itemId:"@",articleSlug:"@",articleIsShowReview:"<",scrollInViewChannel:"@",utmSource:"@",utmMedium:"@",utmContent:"@",utmCampaign:"@",utmTerm:"@"},controller:WallHandlerSubscriptionWrappedController};angular.module("app.wall").component("wallHandlerSubscriptionWrapped",wallHandlerSubscriptionWrappedComponent)}(),function(){"use strict";function WallParamComponentController(){function $onInit(){$ctrl.parent.registerParameter($ctrl.name,$ctrl.value)}var $ctrl=this;$ctrl.$onInit=$onInit}var wallParamComponent={require:{parent:"^wall"},bindings:{name:"@",value:"@"},controller:WallParamComponentController};angular.module("app.wall").component("wallParam",wallParamComponent)}(),function(){"use strict";function WallRuleComponentController(){function $onInit(){$ctrl.params=angular.fromJson($ctrl.params),$ctrl.parent.registerRule($ctrl.strategy,$ctrl.params)}var $ctrl=this;$ctrl.$onInit=$onInit}var wallRuleComponent={require:{parent:"^wall"},bindings:{strategy:"@",params:"@"},controller:WallRuleComponentController};angular.module("app.wall").component("wallRule",wallRuleComponent)}(),function(){"use strict";function WallTrackComponentController(){function $onInit(){$ctrl.parent.registerTrackingParameter($ctrl.name,$ctrl.value)}var $ctrl=this;$ctrl.$onInit=$onInit}var wallTrackComponent={require:{parent:"^wall"},bindings:{name:"@",value:"@"},controller:WallTrackComponentController};angular.module("app.wall").component("wallTrack",wallTrackComponent)}(),function(){"use strict";function WallComponentController(_,$q,$log,authStream,wallStream,wallBusinessRule,wallService,wallTrackingService){function registerCounter(name){counterKeys.push(name)}function registerRule(strategy,params){rules.push({strategy:strategy,params:params})}function registerParameter(name,value){parameters[name]=value}function registerTrackingParameter(name,value){trackingParams[name]=value}function $postLink(){if(!$ctrl.itemId)return $log.error('Wall::Required <wall> parameter "item-id" not passed');wallTrackingService.setParams(trackingParams),userChangedSubscription=authStream.USER_CHANGED.subscribe(onUserChanged)}function logState(){$log.info("Wall::logState:: Processing rules for %s [ %s ].",$ctrl.itemType,$ctrl.itemId,$ctrl.debugMessage),_.each(counterKeys,function(counterKey){function onCounterRetrieved(counter){$log.info("Wall::logState:: Counter [%s] started [%s] with unique item count at page load [%s] and items:",counterKey,counter.getDate(),counter.getCountUnique(),counter.getItems())}wallService.retrieveCounter(counterKey).then(onCounterRetrieved)})}function onUserChanged(user){var rulePromises=[];logState(),_.each(rules,function(rule){var params=_.assign({},rule.params,parameters),ruleExecutionPromise=wallBusinessRule.execute(user,rule.strategy,params);rulePromises.push(ruleExecutionPromise)}),$q.all(rulePromises).then(onRulesExecuted)}function onRulesExecuted(ruleResults){var failedRule=!1;_.every(ruleResults,function(ruleResult){return!!ruleResult.passed||(failedRule=ruleResult,!1)}),handleRule(failedRule),_.each(counterKeys,function(counterKey){function onCounterRetrieved(counter){failedRule?(counter.addBlockedItem($ctrl.itemId),$log.info("Wall::onRulesExecuted::onCounterRetrieved:: Incrementing *blocked* counter [%s] with id:",counterKey,$ctrl.itemId)):_.get(hasCountedItem,counterKey)||(counter.addItem($ctrl.itemId),hasCountedItem[counterKey]=!0,$log.info("Wall::onRulesExecuted::onCounterRetrieved:: Incrementing counter [ %s ] with id:",counterKey,$ctrl.itemId)),wallService.storeCounter(counterKey,counter)}wallService.retrieveCounter(counterKey).then(onCounterRetrieved)})}function handleRule(failedRule){if(failedRule)return wallStream.ITEM_BLOCKED.onNext({strategy:failedRule.strategy,type:failedRule.block,source:failedRule.source||"",itemId:$ctrl.itemId,itemType:$ctrl.itemType}),void $log.warn("Wall::handleRule:: Rule triggered [%s]. [%s] wall hit",failedRule.strategy,_.upperFirst(failedRule.block));$log.info("Wall::handleRule:: All rules passed"),wallStream.ARTICLE_LOADED.onNext({article_id:$ctrl.itemId})}function $onDestroy(){userChangedSubscription.dispose()}var userChangedSubscription,$ctrl=this,rules=[],counterKeys=[],parameters={},trackingParams={},hasCountedItem={};$ctrl.$postLink=$postLink,$ctrl.$onDestroy=$onDestroy,$ctrl.registerCounter=registerCounter,$ctrl.registerRule=registerRule,$ctrl.registerParameter=registerParameter,$ctrl.registerTrackingParameter=registerTrackingParameter}var wallComponent={bindings:{itemId:"@",itemType:"@",debugMessage:"@"},controller:WallComponentController};angular.module("app.wall").component("wall",wallComponent)}(),function(){"use strict";var wallConfig={PERSISTENT_STORAGE_NAMESPACE:"wall",PERSISTENT_STORAGE_VERSION:1,BLOCK_TYPE_REGISTRATION:"registration",BLOCK_TYPE_SUBSCRIPTION:"subscription"};angular.module("app.wall").constant("WallConfig",wallConfig)}(),function(){"use strict";function WallCounterFactory(_,moment){function WallCounterModel(props){function toJSON(){return{date:self.getDate(),items:self.getItems(),blocked:self.getBlockedItems()}}function getCount(){return self.getItems().length}function getCountUnique(){return _.uniq(self.getItems()).length}function getDate(){return self.date}function getItems(){return self.items||[]}function getBlockedItems(){return self.blocked||[]}function addItem(item){self.items.push(item||null)}function addBlockedItem(item){self.blocked.push(item||null)}function isWithinExpiry(days){return moment(new Date(self.date)).isAfter(moment().subtract(Math.abs(days),"days"))}var self=this;return props=_.pick(props,["date","items","blocked"]),self.date=_.get(props,"date",moment().format("YYYY-MM-DD")),self.items=_.get(props,"items",[]),self.blocked=_.get(props,"blocked",[]),self.toJSON=toJSON,self.getCount=getCount,self.getCountUnique=getCountUnique,self.getDate=getDate,self.getItems=getItems,self.getBlockedItems=getBlockedItems,self.addItem=addItem,self.addBlockedItem=addBlockedItem,self.isWithinExpiry=isWithinExpiry,self}return WallCounterModel}WallCounterFactory.$inject=["_","moment"],angular.module("app.wall").factory("WallCounterModel",WallCounterFactory)}(),function(){"use strict";function wallBusinessRule(_,moment,$q,$log,WallConfig,wallService){function rulePassed(){return $q.when({passed:!0})}function ruleFailed(strategy,blockType,registrationSource){return $q.when({passed:!1,strategy:strategy,block:blockType,source:registrationSource})}function execute(user,strategy,params){return strategy in rules?bypassWallCheck(params)?rulePassed():rules[strategy](user,params):($log.error("Wall::wallBusinessRule::execute:: Missing rule definition for strategy:",strategy),$q.reject())}function bypassWallCheck(params){var daysNewer=_.get(params,"bypass_if_newer_than_days"),daysOlder=_.get(params,"bypass_if_older_than_days"),date=_.get(params,"date");if(daysNewer&&date){if(moment(date).isAfter(moment().subtract(daysNewer,"days")))return $log.info("Wall::wallBusinessRule:: Item date [%s] is within last %d days. Bypassing rule",date,daysNewer),!0;$log.info("Wall::wallBusinessRule:: Item date [%s] is not within last %d days. Applying rule",date,daysNewer)}if(daysOlder&&date){if(moment(date).add(daysOlder,"days").isBefore(moment()))return $log.info("Wall::wallBusinessRule:: Item date [%s] is OLDER than %d days. Bypassing rule",date,daysOlder),!0;$log.info("Wall::wallBusinessRule:: Item date [%s] is not OLDER than %d days. Applying rule",date,daysOlder)}return!1}function isRegisteredRule(user,params){var isRuleFailed=!user.isLoggedIn();return $log.info("Wall::wallBusinessRule::isRegisteredRule [%s]",isRuleFailed?"FAILED":"PASSED"),isRuleFailed?ruleFailed("is-registered",WallConfig.BLOCK_TYPE_REGISTRATION,_.get(params,"source")):rulePassed()}function isSubscribedRule(user,params){var isRuleFailed=!user.hasMembership();return $log.info("Wall::wallBusinessRule::isSubscribedRule [%s]",isRuleFailed?"FAILED":"PASSED"),isRuleFailed?ruleFailed("is-subscribed",WallConfig.BLOCK_TYPE_SUBSCRIPTION,_.get(params,"source")):rulePassed()}function meteredRegistrationRule(user,params){function onCounterRetrieved(counter){var uniqueCount=counter.getCountUnique(),isRuleFailed=uniqueCount>=limit;return $log.info("Wall::wallBusinessRule::meteredRegistrationRule:: Checking [%s] counter[%d] against limit[%d]. [%s]",counterKey,uniqueCount,limit,isRuleFailed?"FAILED":"PASSED"),isRuleFailed?ruleFailed("metered-registration",WallConfig.BLOCK_TYPE_REGISTRATION,registrationSource):rulePassed()}if(!_.has(params,"counter")||!_.has(params,"limit"))return $log.error("Wall::Rule 'metered-registration' requires counter and limit params. Got:",params),$q.defer().reject();var counterKey=_.get(params,"counter"),limit=_.get(params,"limit",0),registrationSource=_.get(params,"source");return user.isLoggedIn()?($log.info("Wall::wallBusinessRule::meteredRegistrationRule:: [PASSED]"),rulePassed()):wallService.retrieveCounter(counterKey).then(onCounterRetrieved)}function meteredSubscriptionRule(user,params){function onCounterRetrieved(counter){var uniqueCount=counter.getCountUnique(),isRuleFailed=uniqueCount>=limit;return $log.info("Wall::wallBusinessRule::meteredSubscriptionRule:: Checking [%s] counter[%d] against limit[%d]. [%s]",counterKey,uniqueCount,limit,isRuleFailed?"FAILED":"PASSED"),isRuleFailed?ruleFailed("metered-subscription",WallConfig.BLOCK_TYPE_SUBSCRIPTION):rulePassed()}if(!_.has(params,"counter")||!_.has(params,"limit"))return $log.error("Wall::Rule 'metered-subscription' requires counter and limit params. Got:",params),$q.reject();var counterKey=_.get(params,"counter"),limit=_.get(params,"limit",0);return user.hasMembership()?($log.info("Wall::wallBusinessRule::meteredSubscriptionRule:: [PASSED]"),rulePassed()):wallService.retrieveCounter(counterKey).then(onCounterRetrieved)}var rules={"is-registered":isRegisteredRule,"is-subscribed":isSubscribedRule,"metered-registration":meteredRegistrationRule,"metered-subscription":meteredSubscriptionRule};return{execute:execute}}wallBusinessRule.$inject=["_","moment","$q","$log","WallConfig","wallService"],angular.module("app.wall").factory("wallBusinessRule",wallBusinessRule)}(),function(){"use strict";function wallStorageService(PersistentStorageService,WallCounterModel,WallConfig){function getStorageKey(key){return WallConfig.PERSISTENT_STORAGE_NAMESPACE+"-"+WallConfig.PERSISTENT_STORAGE_VERSION+"-"+key}function retrieve(key){return PersistentStorageService.get(getStorageKey(key)).then(function(data){return new WallCounterModel(data)})}function store(key,counter){return PersistentStorageService.set(getStorageKey(key),counter.toJSON())}return{retrieve:retrieve,store:store}}wallStorageService.$inject=["PersistentStorageService","WallCounterModel","WallConfig"],angular.module("app.wall").factory("wallStorageService",wallStorageService)}(),function(){"use strict";function wallTrackingService(_,$log,authStream,TrackerService){function init(){authStream.USER_CHANGED.subscribe(onUserChanged)}function setParams(extraTrackingParams){_.assign(commonTrackingParams,extraTrackingParams)}function getParams(){return commonTrackingParams}function onUserChanged(latestUser){user=latestUser}function track(domain,event){$log.debug("Wall::wallTrackingService::track::",event);var eventParams=commonTrackingParams;void 0!==event.itemId&&(eventParams.wall_item_id=event.itemId),void 0!==event.itemType&&(eventParams.wall_item_type=event.itemType),void 0!==event.strategy&&(eventParams.wall_failing_rule=event.strategy),eventParams.Label=getLabel(eventParams,event.eventType||"manual"),$log.debug("Wall::wallTrackingService::track::",eventParams);var eventName="Memberships.Marketing";"fashion-show-review"===eventParams.article_category?eventName+=".ShowReview":eventName+=".Article",TrackerService.track(domain,eventName,eventParams),void 0!==eventParams.article_id&&TrackerService.track(domain,getDBTrackingEventName(eventParams,event.eventType||"manual"),_.assign({Id:eventParams.article_id},eventParams)),void 0!==eventParams.article_id&&TrackerService.track(domain,getIntercomTrackingEventName(eventParams,event.eventType||"manual"),_.omit(eventParams,["Id","id"]))}function getLabel(params,eventType){params=params||commonTrackingParams,$log.debug("Wall::wallTrackingService::getLabel::",params,eventType);var labelParams=[];switch(eventType){case"manual":labelParams.push("Paywall.Impression");break;case"click":labelParams.push("Paywall.Click");break;case"loginClick":labelParams.push("Paywall.LoginClick");break;case"packagesClick":labelParams.push("Paywall.PackagesClick");break;case"membershipCardClick":labelParams.push("Paywall.MembershipCardClick");break;case"scrollInView":labelParams.push("Paywall.ScrollInView");break;default:labelParams.push("Paywall")}return"fashion-show-review"===params.article_category?labelParams.push("FashionWeekPage["+params.article_category+"]"):labelParams.push("ArticlePage["+params.article_category+"]"),"member_access"===params.access_rule?labelParams.push("Hard"):labelParams.push("Metered"),user&&user.isLoggedIn()||"fashion-show-review"===params.article_category||"1"===params.article_is_exclusive?labelParams.push("ContentBlock"):labelParams.push("LoginPopup"),labelParams.push("article["+params.article_id+"]"),labelParams.join(".")}function getDBTrackingEventName(params,eventType){params=params||commonTrackingParams;var eventNameParams=["Paywall"];return"manual"===eventType?eventNameParams.push("Impression"):"click"===eventType?eventNameParams.push("Click"):"loginClick"===eventType?eventNameParams.push("Loginclick"):"scrollInView"===eventType&&eventNameParams.push("Scrollinview"),"member_access"===params.access_rule?eventNameParams.push("Hard"):eventNameParams.push("Metered"),eventNameParams.join("")}function getIntercomTrackingEventName(params,eventType){params=params||commonTrackingParams;var eventNameParams=["PaywallArticle"];return"manual"===eventType?eventNameParams.push("Impression"):"click"===eventType?eventNameParams.push("Click"):"loginClick"===eventType?eventNameParams.push("Loginclick"):"scrollInView"===eventType&&eventNameParams.push("Scrollinview"),user.getEmail()?eventNameParams.push("LogedInUser"):eventNameParams.push("NotLogedInUser"),"member_access"===params.access_rule?eventNameParams.push("Hard"):eventNameParams.push("Metered"),eventNameParams.join("")}var user=null,commonTrackingParams={};return{init:_.once(init),track:track,setParams:setParams,getParams:getParams,getLabel:getLabel,getDBTrackingEventName:getDBTrackingEventName}}wallTrackingService.$inject=["_","$log","authStream","TrackerService"],angular.module("app.wall").factory("wallTrackingService",wallTrackingService)}(),function(){"use strict";function wallService(WallCounterModel,wallStorageService){function retrieveCounter(key){return wallStorageService.retrieve(key).then(onKeyRetrieved)}function onKeyRetrieved(counter){return counter.isWithinExpiry(DEFAULT_COUNT_WINDOW_DAYS)?counter:new WallCounterModel}function storeCounter(key,counter){wallStorageService.store(key,counter)}var DEFAULT_COUNT_WINDOW_DAYS=30;return{retrieveCounter:retrieveCounter,storeCounter:storeCounter}}wallService.$inject=["WallCounterModel","wallStorageService"],angular.module("app.wall").factory("wallService",wallService)}(),function(){"use strict";function wallStream(LazyStream){return{ITEM_BLOCKED:new LazyStream,ARTICLE_LOADED:new LazyStream}}wallStream.$inject=["LazyStream"],angular.module("app.wall").factory("wallStream",wallStream)}(),function(){"use strict";function GWrapController(_,godStream){function $onInit(){$ctrl.isThereAGod=!1,listeners.push(godStream.GOD_LOADED.subscribe(onGodLoaded))}function onGodLoaded(god){$ctrl.isThereAGod=!_.isEmpty(god)}function $onDestroy(){godStream.unsubscribe(listeners)}var $ctrl=this,listeners=[];$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}
var gWrapComponent={template:'<div ng-if="$ctrl.isThereAGod"><god-bar></god-bar></div>',controller:GWrapController};angular.module("app.god_bar").component("gWrap",gWrapComponent)}(),function(){"use strict";function godService(_,$log,$q,authService,storageService,godStream){function init(){$log.debug("godService::init::"),currentGod=storageService.get(storageService.KEY.GOD_TOKEN),isThereAGod()&&($log.debug("godService::init::thereIsAGod god_user_id[%s] switched_user_id[%s]",currentGod.id,currentUserId),currentUserId!==currentGod.id&&authService.setRefreshTokenService(currentUserId),godStream.GOD_LOADED.onNext(currentGod))}function extractPayload(accessTokenPayload){return{id:accessTokenPayload.id,email:accessTokenPayload.email}}function isThereAGod(){return!!currentGod}function godIsInTheHouse(godTokenPayload){$log.debug("godService::godIsInTheHouse::"),currentGod=extractPayload(godTokenPayload),storageService.set(storageService.KEY.GOD_TOKEN,currentGod),godStream.GOD_LOADED.onNext(currentGod)}function godLeft(){$log.debug("godService::godLeft::"),storageService.remove(storageService.KEY.GOD_TOKEN),currentGod=null,godStream.GOD_LOADED.onNext({})}function onUserChanged(user){if(currentUserId=user.getId(),currentUserEmail=user.getEmail(),initOnce(),isThereAGod()){if(!user.isLoggedIn())return godLeft()}else user.isGod()&&godIsInTheHouse(user.getPayload())}function revertToGod(){return $log.debug("godService::revertToGod::"),authService.setRefreshTokenService(!0),authService.refreshAccessToken()}function setRefreshTokenService(switchUserIdOrEmail){switchUserIdOrEmail==currentGod.id||switchUserIdOrEmail==currentGod.email?authService.setRefreshTokenService(!0):authService.setRefreshTokenService(switchUserIdOrEmail)}function switchUserTo(switchUserIdOrEmail){function onSwitchError(){return $log.debug("godService::switchUserTo::onSwitchError::"),setRefreshTokenService(currentUserId),$q.reject()}return $log.debug("godService::switchUserTo:: currentUserId[%s] currentUserEmail[%s] switchUserIdOrEmail[%s]",currentUserId,currentUserEmail,switchUserIdOrEmail),switchUserIdOrEmail==currentUserId||switchUserIdOrEmail==currentUserEmail?($log.debug('godService::switchUserTo:: Current token user "%s" equals the one you want to change to. Aborting!',switchUserIdOrEmail),$q.reject()):(setRefreshTokenService(switchUserIdOrEmail),authService.refreshAccessToken(switchUserIdOrEmail).catch(onSwitchError))}var currentUserId,currentUserEmail,currentGod=null,initOnce=_.once(init);return{switchUserTo:switchUserTo,revertToGod:revertToGod,onUserChanged:onUserChanged,isThereAGod:isThereAGod}}godService.$inject=["_","$log","$q","authService","storageService","godStream"],angular.module("app.god_bar").factory("godService",godService)}(),function(){"use strict";function godStream(LazyStream,EventManagerUtility){return{GOD_LOADED:new LazyStream,unsubscribe:EventManagerUtility.removeListeners}}godStream.$inject=["LazyStream","EventManagerUtility"],angular.module("app.god_bar").factory("godStream",godStream)}(),function(){"use strict";function GodBarController(_,$window,godService,godStream,authStream,GlobalParams,$log){function $onInit(){$ctrl.godEmail=null,$ctrl.godUserId=null,$ctrl.isEnabled=!1,$ctrl.userInput="",$ctrl.refreshTokens=[],$ctrl.isDebugEnabled=GlobalParams.DEV_ENABLED,listeners.push(godStream.GOD_LOADED.subscribe(onGodLoaded)),listeners.push(authStream.USER_CHANGED.subscribe(onUserChanged))}function $onDestroy(){authStream.unsubscribe(listeners)}function handleDebugChange(){if($ctrl.isDebugEnabled)return $window.localStorage.setItem(GlobalParams.DEV_ENABLED_KEY,1);$window.localStorage.removeItem(GlobalParams.DEV_ENABLED_KEY)}function canSubmitSwitchUser(){return!!$ctrl.userInput}function isInGodMode(){return currentUserId!==$ctrl.godUserId}function handleOpenUserChange(){$ctrl.changeActive?$ctrl.userInput=$ctrl.userEmail:$ctrl.userInput="",$ctrl.changeActive=!$ctrl.changeActive}function handleSwitchUser(){function onSwitchSuccess(){$ctrl.changeActive=!1}function onSwitchError(){$ctrl.changeActive=!1,$ctrl.userInput=currentUserEmail,$ctrl.userEmail=currentUserEmail,$ctrl.userId=currentUserId}return godService.switchUserTo($ctrl.userInput).then(onSwitchSuccess,onSwitchError)}function handleExit(){function onRevertSuccess(){$ctrl.changeActive=!1}return godService.revertToGod().then(onRevertSuccess)}function onGodLoaded(godPayload){if(_.isEmpty(godPayload))return void($ctrl.isEnabled=!1);$ctrl.isEnabled=!0,$ctrl.godUserId=godPayload.id,$ctrl.godEmail=godPayload.email}function onUserChanged(user){currentUserId=user.getId(),currentUserEmail=user.getEmail(),$ctrl.userEmail=currentUserEmail,$ctrl.userId=currentUserId,$ctrl.userInput=$ctrl.userEmail}var $ctrl=this,listeners=[],currentUserEmail="",currentUserId="";$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleDebugChange=handleDebugChange,$ctrl.canSubmitSwitchUser=canSubmitSwitchUser,$ctrl.handleOpenUserChange=handleOpenUserChange,$ctrl.handleSwitchUser=handleSwitchUser,$ctrl.handleExit=handleExit,$ctrl.isInGodMode=isInGodMode}var godBarComponent={templateUrl:"/assets-access-layer/js/shared/GodBar/godbar.html",bindings:{},controller:GodBarController};angular.module("app.god_bar").component("godBar",godBarComponent)}(),angular.module("app.data").constant("GlobalParams",{APP_VERSION:window.appVer||"NO_VERSION",IMGIX_HOST:window.ImgixHost,DEV_ENABLED_KEY:"_BOF_ENABLE_DEV",DEV_ENABLED:!(!window.anddv&&!window.localStorage.getItem("_BOF_ENABLE_DEV")),DISQS_SHORTNAME:window.developmentShortname,CRYPT_SECRET:"59fa99da933506a84588f1739df157d4",APP_NAME:"SITE",SPA_APP_NAME:"SPA",FilePreviews:window.FilePreviews||"tfYlHlMuajKi1ml2VaFtb4aFkiMC1R",LOCALSTORAGE_PREFIX:"ngStorage-",DEV_ENABLE_FULLCACHE:!!window.devEnableApiFullCache,RECURLY_PUBLIC_KEY:window.recurlyPublicKey,AL_ROUTING:window.ALRouting||{},AL_TRANSLATIONS:window.ALTranslations||{},MOBILE_DOMAIN:"https://mobile.businessoffashion.com",CAPTCHA_SITE_KEY:window.captchaKey||null,INTERCOM_APP_ID:window.IntercomAppId||null,SENTRY_CLIENT_URL:window.SentryConfigUrl||null,SAFARI_WEB_ID:"",ONESIGNAL_APP_ID:"",SALESFORCE_UID:window.salesforceUid}),angular.module("app.data").constant("Routes",{ACCOUNT:{ROOT:"/xhr/accounts/:accountId",FAILED_PAYMENT_DATA:"/xhr/accounts/:accountId/failed-payment-data",MEMBERSHIP:"/xhr/accounts/:accountId/memberships",MEMBERSHIPS_PLAN:"/xhr/accounts/memberships/plan/:planCode"},CURRENT_USER:{ROOT:"/xhr/current-user",SCHOOL:"/xhr/current-user/schools",SHIPPING_ADDRESS:"/xhr/current-user/shipping-address",USER_EMAIL:"/xhr/current-user/user-emails",USER_EMAIL_CONFIRM:"/xhr/current-user/user-emails/:token/confirm",SUBSCRIPTION:"/xhr/current-user/newsletters",SUBSCRIPTION_SINGLE:"/xhr/current-user/newsletter",SUBSCRIPTION_CONSENTS:"/xhr/current-user/newsletters-consents",PRODUCT:"/xhr/current-user/products",REFRESH_TOKEN:"/xhr/current-user/tokens",PASSWORD:"/xhr/current-user/password",SAVED_ARTICLES:"/xhr/current-user/saved-articles-v2",SAVED_ARTICLES_CATEGORIES:"/xhr/current-user/saved-articles-categories",CONSENTS:"/xhr/current-user/consents",BOF_USAGE:"/xhr/current-user/bof-usage",MEMBERSHIP:{ROOT:"/xhr/current-user/memberships",FREE_TRIAL:"/xhr/current-user/memberships/free-trials",BILLING:"/xhr/current-user/membership/billing",COLLECT_INVOICE:"/xhr/current-user/membership/collect-invoice"},PERMISSIONS:"/xhr/current-user/permissions"},COMMUNITY:{FEATURED_MODULE:"/xhr/articles/featured-module"},COUPON:{ROOT:"/xhr/coupons/:coupon"},EDUCATION:{EDUCATION_HOME_URL:"/education",COURSE:{GET:"/xhr/education/courses/:course_ids",INTEREST:"/xhr/education/courses/interests",OTHER:"/xhr/education/courses/other"}},ORGANISATION:{SCHOOL:{VALIDATE_EMAIL:"xhr/organisations/schools/validate-email"},SUGGESTION:"/xhr/organisations/organisations"},NEWSLETTER:{LIST:"/xhr/newsletter/lists"},JOB:{BOOKMARK:"/xhr/jobs/bookmark",QUERY_FILTER:"/xhr/jobs/query_filters",ALERTS:{CRITERIA:"/xhr/jobs/alerts/criteria"},APPLICATION:{ROOT:"/xhr/accounts/:userId/applications",BASE:"/xhr/accounts/:userId/applications/:jobApplicationId",STATUS:"/xhr/accounts/:userId/applications/:jobApplicationId/status",UNARCHIVE:"/xhr/accounts/:userId/applications/:jobApplicationId/unarchive"}},MESSAGE:{ROOT:"/xhr/messages/:action",POOL_ANSWERS:"/xhr/messages/poll/answers",SUBMIT:"/xhr/messages/submit"},MEMBERSHIP:{INDIVIDUAL:"/xhr/memberships",INDIVIDUAL_REGISTER:"/xhr/memberships/register",INDIVIDUAL_UPGRADE:"/xhr/memberships/:account_id/change-plan",CANCEL:"/xhr/memberships/:account_id/cancel",CANCEL_REQUEST:"/xhr/memberships/:account_id/cancel_request",TIERS:"/xhr/accounts/memberships/group/tiers",GROUP_BASE_PLAN:"/xhr/accounts/memberships/group/base-plan",GROUP_BILLING:"/xhr/memberships/:account_id/billing",GROUP_COLLECT_INVOICE:"/xhr/memberships/:account_id/collect-invoice",LAST_FAILED_PAYMENT:"/xhr/memberships/:account_id/last-failed-payment",GROUP:"/xhr/accounts/memberships/group",GROUP_STEP_2:"/memberships/group/payment/:plan",VAT_VALIDATION_ENDPOINT:"/xhr/accounts/vat/:vatNumber",PARTNER_VALIDATION_ENDPOINT:"/xhr/memberships/partner-data"},UTILITY:{ERROR_REPORTING:"/xhr/data/error-reporting",CURRENCY_CONVERSION:"/xhr/shared-data/currency-conversion"},AUTH:{LOGIN:{USER_PASS:"/xhr/authentication/login",FACEBOOK:"/xhr/authentication/login/facebook",TWITTER:"/xhr/authentication/login/twitter",LINKEDIN:"/xhr/authentication/login/linkedin",GOOGLE:"/xhr/authentication/login/google"},REFRESH:"/xhr/authentication/refresh",LOGOUT:"/xhr/authentication/logout",SWITCH:"/xhr/authentication/switch"},REGISTRATION:{REGISTER:"/xhr/registration/register",CONFIRM:"/xhr/registration/confirm",GET_USER:"/xhr/registration/get-user"},USER:{EMAIL_CHANGE:{REQUEST:"/xhr/user/email-change/request",CONFIRM:"/xhr/user/email-change/confirm"},RESET_PASSWORD:{REQUEST:"/xhr/reset-password/request",CONFIRM:"/xhr/reset-password/confirm"},SUGGESTION:"/xhr/user/suggestions/:type",NEWSLETTER_SUBSCRIBE:"/xhr/user/newsletters/subscribe",CONSENT_JOURNEY_ENDPOINT:"/xhr/user/consent-journey"},SHARED_DATA:{ROOT:"/xhr/shared-data/:type",ID_GENERATOR:"/xhr/id-generator/:strategy",CITY:"/xhr/shared-data/countries/:countryId/cities",CITY_ID:"/xhr/shared-data/cities",LOCATION:"/xhr/shared-data/location"},TRACKER:"/xhr/tracker/track",ADVERT:"/xhr/adverts"}),angular.module("app.data").factory("SharedDataApiFactory",["_","Routes","$http","DataService","$log",function(_,Routes,$http,DataService,$log){"use strict";function SharedDataApiFactory(params,disableCache){var type=_.get(params,"type");type||$log.error("Every SharedDataApiFactory must have a type defined!"),params=_.omit(params,["type"]);var route=_.replace(Routes.SHARED_DATA.ROOT,":type",type),requestConfig={};disableCache||(requestConfig.cache=!0),this.get=function(filters){return filters=_.assign({},params,filters),$log.debug("SharedDataApiFactory::get:: Requesting URL [%s]",type,filters),requestConfig.params=filters,$http.get(route,requestConfig).then(function(res){var responseData=_.get(res,"data",[]);return $log.debug("SharedDataApiFactory::get:: Response from URL [%s]",type,responseData),responseData})}}return SharedDataApiFactory}]),angular.module("app.data").factory("SharedDataCityApi",["$resource",function($resource){"use strict";return $resource("/xhr/shared-data/countries/:countryId/cities",{type:"@type"},{get:{method:"GET",cache:!0}})}]).factory("SharedDataCityApiFactory",["_","SharedDataCityApi","$q","DataService",function(_,SharedDataCityApi,$q,DataService){"use strict";function Factory(params){var apiParams=params;this.get=function(filters){return SharedDataCityApi.get(_.assign({},apiParams,filters)).$promise.then(function(res){return DataService.normaliseData(res.data),_.map(res.data,function(item){item.title=item.name}),res})}}return Factory}]),angular.module("app.data").factory("SharedDataCompanyApi",["$resource",function($resource){"use strict";return $resource("/xhr/user/organisations/:action",{type:"@type"},{get:{method:"GET",cache:!0,params:{action:"suggest"}}})}]).factory("SharedDataCompanyApiFactory",["_","SharedDataCompanyApi","$q","DataService",function(_,SharedDataCompanyApi,$q,DataService){"use strict";function Factory(params){var apiParams=params;this.get=function(filters){return SharedDataCompanyApi.get(_.assign({},apiParams,filters)).$promise.then(function(res){return DataService.normaliseData(res.data),_.map(res.data,function(item){item.title=item.label}),res})}}return Factory}]),angular.module("app.data").factory("SharedDataTitleApiFactory",["$q",function($q){"use strict";function Factory(params){this.get=function(filters){var deferred=$q.defer();return deferred.resolve({data:[{id:"mr",title:"Mr"},{id:"ms",title:"Ms"},{id:"other",title:"Other"}]}),deferred.promise}}return Factory}]),function(){"use strict";function locationApi(_,$q,$http,SharedDataApiFactory){function get(){function onGeoIpSuccess(payload){function onCountriesLoaded(res){return payload.data.country_id=function(allCountries,countryCode){var country=_.find(allCountries,{country_code:_.toLower(countryCode)});return country?country.country_id:null}(res.data,payload.data.country_code),deferred.resolve(payload)}return countriesApi.get().then(onCountriesLoaded)}var deferred=$q.defer();return $http.get(GEOIP_URL,{cache:!0,bypassIntercepors:!0}).then(onGeoIpSuccess,deferred.reject),deferred.promise}var GEOIP_URL="https://geoip.businessoffashion.com/geoip",countriesApi=new SharedDataApiFactory({type:"countries"});return{get:get}}locationApi.$inject=["_","$q","$http","SharedDataApiFactory"],angular.module("app.data").factory("locationApi",locationApi)}(),function(){"use strict";function sharedDataApis(Routes,GenericApiFactory,SharedDataApiFactory){var idApi=new GenericApiFactory(Routes.SHARED_DATA.ID_GENERATOR,{strategy:"num"}),countriesApi=new SharedDataApiFactory({type:"countries"}),companySizeApi=new SharedDataApiFactory({type:"company-sizes"}),jobIndustryApi=new SharedDataApiFactory({type:"job-industries"}),userJobLevelTypeApi=new SharedDataApiFactory({type:"user-job-level-types"}),JobLevelApi=new SharedDataApiFactory({type:"job-levels"}),JobResponsibilityApi=new SharedDataApiFactory({type:"job-responsibilities"}),SchoolProgrammeTypeApi=new SharedDataApiFactory({type:"school-programme-types"});return{COUNTRIES:countriesApi.get,COMPANY_SIZE:companySizeApi.get,JOB_INDUSTRY:jobIndustryApi.get,JOB_LEVEL:JobLevelApi.get,JOB_RESPONSIBILITY:JobResponsibilityApi.get,SCHOOL_PROGRAMME_TYPE:SchoolProgrammeTypeApi.get,USER_JOB_LEVEL_TYPE:userJobLevelTypeApi.get,ID:idApi.get}}sharedDataApis.$inject=["Routes","GenericApiFactory","SharedDataApiFactory"],angular.module("app.data").factory("SharedDataApis",sharedDataApis)}(),function(){"use strict";function sharedDataCityApi(_,$log,$http,Routes){function get(countryId,cityName){$log.debug("Data::sharedDataCityApi::get::",countryId,cityName);var route=_.replace(Routes.SHARED_DATA.CITY,":countryId",countryId);return $http.get(route,{params:{city_name:cityName}}).then(function(response){var cityObject=_.get(response,"data.data[0]");return _.isEmpty(cityObject)?{}:cityObject})}function getByIds(cityIds){function onSuccess(response){return _.get(response,"data.data")}$log.debug("Data::sharedDataCityApi::getByIds::",cityIds.join(","));var params={city_id:cityIds.join(",")};return $http.get(Routes.SHARED_DATA.CITY_ID,{params:params}).then(onSuccess)}function search(countryId,cityName){$log.debug("Data::sharedDataCityApi::search::",countryId,cityName);var route=_.replace(Routes.SHARED_DATA.CITY,":countryId",countryId);return $http.get(route,{params:{query:cityName}}).then(function(response){var cityResults=_.get(response,"data.data");return _.isEmpty(cityResults)?[]:cityResults})}return{get:get,getByIds:getByIds,search:search}}sharedDataCityApi.$inject=["_","$log","$http","Routes"],angular.module("app.data").factory("sharedDataCityApi",sharedDataCityApi)}(),function(){"use strict";function sharedDataLocationApi(_,$log,$http,Routes){function search(query){return $log.debug("Data::sharedDataLocationApi::search::",query),$http.get(Routes.SHARED_DATA.LOCATION,{params:{query:query}}).then(function(response){var locationResults=_.get(response,"data.data");return _.isEmpty(locationResults)?[]:locationResults})}return{search:search}}sharedDataLocationApi.$inject=["_","$log","$http","Routes"],angular.module("app.data").factory("sharedDataLocationApi",sharedDataLocationApi)}(),function(){"use strict";function CompanyTypeaheadController(_,muaStream,AccountService,GenericApiFactory,MuaRouteConfig){function $onInit(){listener=muaStream.ACCOUNT_CHANGED.subscribe(onAccountChanged)}function getSuggestions(query){return accountApi.getSuggestions({query:query}).then(function(res){return _.isEmpty(res.data)?[]:res.data.results})}function handleSelect(item){var accountId=_.get(item,"account_id")||null;AccountService.setCurrent(accountId)}function onAccountChanged(data){$ctrl.currentAccount=data.account,$ctrl.query=data.account?data.account.account_title:null}function $onDestroy(){listener.dispose()}var $ctrl=this,listener=null,accountApi=new GenericApiFactory(MuaRouteConfig.ACCOUNTS,{order:"query"});$ctrl.currentAccount={},$ctrl.getSuggestions=getSuggestions,$ctrl.handleSelect=handleSelect,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var companyTypeaheadComponent={template:'<div class="c_profile-search input-group clearfix" ng-class="{\'block\':!$ctrl.currentAccount.thumbnail}">   <input type="text"      ng-model="$ctrl.query"      placeholder="Search Company"      class="form-control input-md no-border"      typeahead="item.account_title for item in $ctrl.getSuggestions($viewValue)"      typeahead-focus-first="true"      typeahead-on-select="$ctrl.handleSelect($item)"      typeahead-min-length="2"      ng-keyup="$ctrl.update($event)"      typeahead-wait-ms="300"   />   <span ng-if="$ctrl.currentAccount.thumbnail" class="input-group-addon no-border padding-vertical-xs-0 padding-horizontal-xs-3">       <img width="32" class="img-circle" ng-src="{[{ $ctrl.currentAccount.thumbnail.file | openross:50:50:1:\'magic\' }]}" />   </span></div>',controller:CompanyTypeaheadController};angular.module("app.company").component("companyTypeahead",companyTypeaheadComponent)}(),angular.module("app.company").constant("CompanyApiRoute",{COMPANY_ACCOUNT:"/xhr/accounts/:accountId",COMPANY:"/xhr/companies/:companyId"}),angular.module("app.company").factory("CompanyBrandApi",["$resource",function($resource){"use strict";return $resource("/xhr/companies/:companyId/brands",{companyId:"@companyId"},{})}]).factory("CompanyBrandApiFactory",["_","CompanyBrandApi",function(_,CompanyBrandApi){"use strict";function Factory(params){var apiParams=params;this.get=function(filters){return CompanyBrandApi.get(_.assign({},apiParams,filters)).$promise}}return Factory}]),function(){"use strict";function CompanyService(_,AuthEvents,CompanyApiRoute,GenericApiFactory,EventManager){function getCurrent(){return currentCompany}function setCurrent(companyId){function onCompanySuccess(res){return currentCompany=_.assign({},res.data,{id:res.data.profile_id,account_id:res.data.account?res.data.account.account_id:0}),EventManager.emit(AuthEvents.COMPANY_CHANGED,{company:currentCompany}),res}return companyApi.get({companyId:companyId}).then(onCompanySuccess)}function getCompanyData(companyId){function onCompanySuccess(res){return currentCompany=_.assign({},res.data,{id:res.data.profile_id,account_id:res.data.account?res.data.account.account_id:0})}return companyApi.get({companyId:companyId}).then(onCompanySuccess)}var currentCompany={},companyApi=new GenericApiFactory(CompanyApiRoute.COMPANY,{decorate:"native_image,account,job_permission,company_gallery",published:"null"});return{getCurrent:getCurrent,setCurrent:setCurrent,getCompanyData:getCompanyData}}CompanyService.$inject=["_","AuthEvents","CompanyApiRoute","GenericApiFactory","EventManager"],angular.module("app.company").factory("CompanyService",CompanyService)}(),function(){"use strict";function CompanyDropdownController(_,$q,$log,authStream,AccountService,GenericApiFactory,MuaRouteConfig,muaStream){function $onInit(){$log.debug("Company::companyDropdown::$onInit::"),$ctrl.currentAccount={},$ctrl.items=[],$ctrl.open=!1,userChangedSubscription=authStream.USER_CHANGED.subscribe(onUserChanged),accountChangedSubscription=muaStream.ACCOUNT_CHANGED.subscribe(onAccountChanged)}function $onDestroy(){$log.debug("Company::companyDropdown::$onDestroy::"),userChangedSubscription.dispose(),accountChangedSubscription.dispose()}function handleAccountChange(event,accountId){$log.debug("Company::companyDropdown::handleAccountChange::",accountId),event&&(event.preventDefault(),event.stopPropagation()),$ctrl.open=!$ctrl.open,$ctrl.currentAccount=_.find($ctrl.items,{account_id:accountId}),AccountService.setCurrent(accountId)}function onUserChanged(user){var organisationAccountIds=user.accounts.getOrganisationAccountIds();$log.debug("Company::companyDropdown::onUserChanged::",organisationAccountIds),(_.isUndefined(currentUserId)||currentUserId!==user.getId())&&($ctrl.open=!1,$ctrl.items=[],reloadAccountList(user)),currentUserId=user.getId()}function reloadAccountList(user){function onAccountListSuccess(res){var results=_.get(res,"data.results",[])||[];$log.debug("Company::companyDropdown::onUserChanged::onAccountListSuccess",results),$ctrl.items=_.map(results,pickAccountAttributes)}var organisationAccountIds=user.accounts.getOrganisationAccountIds();return organisationAccountIds.length>1?($log.debug("Company::companyDropdown::onUserChanged::hasOrganisationAccounts"),accountsApi.get({account_ids:organisationAccountIds.join(",")}).then(onAccountListSuccess)):$q.resolve()}function pickAccountAttributes(accountObj){return _.isEmpty(accountObj)?{}:(accountObj=_.isObject(accountObj)?accountObj:{},{account_id:accountObj.account_id,account_title:accountObj.account_title,thumbnail_url:_.get(accountObj,"thumbnail.file")||null})}function onAccountChanged(data){$ctrl.currentAccount=pickAccountAttributes(data.account),$log.debug("Company::companyDropdown::onAccountChanged::",$ctrl.currentAccount)}var currentUserId,userChangedSubscription,accountChangedSubscription,$ctrl=this,accountsApi=new GenericApiFactory(MuaRouteConfig.ACCOUNTS,{decorate:"native_image"});$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleAccountChange=handleAccountChange}var companyDropdownComponent={templateUrl:"/assets-access-layer/js/shared/Company/templates/company-dropdown.html",controller:CompanyDropdownController};angular.module("app.company").component("companyDropdown",companyDropdownComponent)}(),function(){"use strict";function trackerApi($log,GenericApiFactory,Routes){function post(data){return $log.debug("trackerApi::post::",data),trackApi.post(data)}var trackApi=new GenericApiFactory(Routes.TRACKER);return{post:post}}trackerApi.$inject=["$log","GenericApiFactory","Routes"],angular.module("app.tracker").factory("trackerApi",trackerApi)}(),angular.module("app.tracker").constant("ARTICLE_EVENT",{DOMAIN:"Article",EVENTS:["PageView","RegWallView","PayWallView","RegWallClick","PayWallClick","PayWallLogInClick","ArticleClick","Article.Marketing","ArticleInnerLinkClick","SaveArticleButtonClick","SliderIndicatorClick","SliderArrowLeftClick","SliderArrowRightClick","PaywallImpressionHard","PaywallImpressionMetered","PaywallClickHard","PaywallClickMetered","PaywallLoginclickHard","PaywallLoginclickMetered","PaywallScrollinviewHard","PaywallScrollinviewMetered","PaywallHard","PaywallMetered","PaywallArticleImpressionLogedInUserMetered","PaywallArticleImpressionLogedInUserHard"]}),angular.module("app.tracker").constant("AUTH_EVENT",{DOMAIN:"Auth",EVENTS:["ModalLogin","ModalRegister","ModalResetPassword","ModalChangePassword","ModalChangeEmail","ModalActivateAccount","ModalSignupConferences","ModalUserEmail"]}),angular.module("app.tracker").constant("BOARDS_EVENT",{DOMAIN:"Boards",EVENTS:["BoardsListPage","BoardsUploadPage","BoardsDetailsPage"]}),angular.module("app.tracker").constant("BOF500_EVENT",{DOMAIN:"BoF500",EVENTS:["ButtonClick","ImageClick","SponsorClick"]}),angular.module("app.tracker").constant("CAREERS_EVENT",{DOMAIN:"Careers",EVENTS:["BestCompanies","JobClick.BestCompanies","SearchJobClick.BestCompanies","OrganisationClick.BestCompanies","CompanySearchCompanyButtonClick","CompanySearchJobResultsButtonClick","SocialShare.BestCompanies","CTAClick.BestCompanies","FeaturedCompaniesClick.BestCompanies","JobPage","JobApplicationReviewPage","JobApplyClick","Careers.Marketing","JobAlert"]}),angular.module("app.tracker").constant("CHINAPRIZE_EVENT",{DOMAIN:"ChinaPrize",EVENTS:["ShanghaiFashionWeekImgClick","YuholdingsImgClick"]}),function(){angular.module("app.tracker").constant("COMMUNITY_EVENT",{DOMAIN:"Community",EVENTS:["FeaturedModuleCardImpression","FeaturedModuleCardClick","CompanyIndex","BoF500Index"]})}(),angular.module("app.tracker").constant("EDUCATION_EVENT",{DOMAIN:"Education",EVENTS:["CourseEnrollmentButtonImpression","CourseEnrollmentButtonClick","CoursePaymentButtonImpression","CoursePaymentButtonClick","BofEducationButtonImpression"]}),angular.module("app.tracker").constant("EVENTS_EVENT",{DOMAIN:"Events",EVENTS:["ApplyFor2018VoicesImgClick","MoreInfoBoFWestImgClick","MoreInfoBoFChinaSummitImgClick","MoreInfoBoF500ImgClick","ApplyFor2018VoicesBtnClick","MoreInfoBoFWestBtnClick","MoreInfoBoFChinaSummitBtnClick","MoreInfoBoF500BtnClick","SponsorClick"]}),angular.module("app.tracker").constant("JOB_EVENT",{DOMAIN:"Job",EVENTS:["PageView"]}),angular.module("app.tracker").constant("MEMBERSHIP_EVENT",{DOMAIN:"Membership",EVENTS:["MembershipMarketingPageview","MembershipPaymentPageview","MembershipPaymentConfirmationPageview","MembershipTeamMarketingPageview","MembershipTeamCustomizePageview","MembershipTeamPaymentPageview","MembershipTeamPaymentConfirmationPageview","MembershipFormTouch","MembershipBillingCountryChange","MembershipShippingToggle","MembershipValidFormSubmit","MembershipInvalidFormSubmit","MembershipAlreadySubscribedModal","MembershipEmailEdit","MembershipSelectionEdit","MembershipMainNavigationClick","MembershipSelectPackageClick","MembershipPlanClick","MembershipAskQuestionModalOpen","MembershipFatalErrorModalOpen","MembershipTrialUsedAlert","MembershipTeamCustomizeAskQuestionModalOpen","MembershipTeamPaymentConfirmationAskQuestionModalOpen","BofProfessionalDwellModalImpression","BofProfessionalDwellModalClose","BofProfessionalDwellModalClick","BofProfessionalMobileNavButtonClick","BofProfessionalStickyBannerClick","BofExclusiveDwellModalImpression","BofExclusiveDwellModalClose","BofExclusiveDwellModalClick","AccountRestrictedEmailNotificationImpression","AccountRestrictedEmailNotificationLinkClick","BofProfessionalBannerMobileClick","BofProfessionalBannerMobileImpression","BofProfessionalBannerMobileClose","BofProfessionalBannerClick","BofProfessionalBannerImpression","BofProfessionalDunningBannerClick","BofProfessionalDunningBannerImpression","BofProfessionalBannerClose","BofProfessionalButtonClick","BofProfessionalMobileButtonClick","MembershipStudentSponsorBannerImpression","MembershipStudentSponsorBannerClick","SpaBofProfessionalLinkClick","SpaBofProfessionalFindOutMoreButtonClick","SpaBofProfessionalPackagesButtonClick","ViewExclusiveArticleListingClick","ViewPreviousEventsClick","CancelSavesPageClick","BofProfessionalCardPageClick","ViewExclusiveAnalysisListingClick","CancelPollPageClick","SaveArticleJoinBofProfessionalLinkClick","SavedArticleJoinBofProfessionalTooltipImpression"]}),angular.module("app.tracker").constant("NAVIGATION_EVENT",{DOMAIN:"Navigation",EVENTS:["NavigationClick","SiteNavigation","Navigation"]}),angular.module("app.tracker").constant("NEWSLETTER_EVENT",{DOMAIN:"Newsletter",EVENTS:["SubscriberModal"]}),angular.module("app.tracker").constant("NOTIFICATIONS_EVENT",{DOMAIN:"Notifications",EVENTS:["ErrorNotification"]}),angular.module("app.tracker").constant("PAYMENT_EVENT",{DOMAIN:"Payment",EVENTS:["PaymentPageview","PaymentValidFormSubmit","PaymentInvalidFormSubmit","PaymentSubmitCardTokenError","PaymentCouponInvalid","PaymentCouponValid","PaymentSuccessful","PaymentAskQuestionModalOpen","PaymentFatalErrorModalOpen"]}),angular.module("app.tracker").constant("PODCASTS_EVENT",{DOMAIN:"Podcasts",EVENTS:["PodcastPlatformClick"]}),angular.module("app.tracker").constant("PRINT_EVENT",{DOMAIN:"Print",EVENTS:["ButtonClick","ImageClick","SponsorClick"]}),angular.module("app.tracker").constant("PROFILE_EVENT",{DOMAIN:"Profile",EVENTS:["liveMosaicView","liveMosaicClick"]}),angular.module("app.tracker").constant("SEARCH_EVENT",{DOMAIN:"Search",EVENTS:["Search.JobSearch"]}),function(){angular.module("app.tracker").constant("STATEOFFASHION_EVENT",{DOMAIN:"StateOfFashion",EVENTS:["StateOfFashionMarketingBannerClick","StateOfFashionMarketingBannerImpression"]})}(),angular.module("app.tracker").constant("USER_EVENT",{DOMAIN:"User",EVENTS:["SharedLoginModalImpression","SignUpModalCaptchaLoaded","SignUpModalCaptchaExecuted","SignUpModalCaptchaSolved","SignUpModalCaptchaReloaded","SignUpModalCaptchaClosed","Users.Impression","User.Consents"]}),angular.module("app.tracker").constant("VOICES_EVENT",{DOMAIN:"Voices",EVENTS:["VoicesLivePageview","VoicesLiveThinkingBigCalDownload","VoicesLiveTakingActionCalDownload","VoicesLiveBreakingGroundCalDownload","VoicesLiveQICLinkClick","VoicesLiveTopshopLinkClick","VoicesMarketingBannerImpression","ArticleClick","SponsorClick"]}),function(){"use strict";function carouselTracker(_,$log,DataService,TrackerService){function postLink(scope,element,attrs){function onClick(event){var indicatorIndex,slideDirection,eventName;indicatorIndex=getIndicatorIndex(event),_.isUndefined(indicatorIndex)?(slideDirection=getSlideDirection(event))&&(eventName="Left"===slideDirection?"SliderArrowLeftClick":"SliderArrowRightClick",sendEvent(eventName,slideDirection)):sendEvent("SliderIndicatorClick","SlideIndicator["+indicatorIndex+"]")}function getIndicatorIndex(eventObj){return _.get(eventObj,"target.attributes.indicator-index.nodeValue")}function getSlideDirection(eventObj){if(_.includes(eventObj.target.className,"icon-slider")){if(_.includes(eventObj.target.parentElement.className,"left"))return"Left";if(_.includes(eventObj.target.parentElement.className,"right"))return"Right";$log.error("carouselTracker::postLink::getSlideDirection::   slide direction could not be resolved.")}}function getEventDomain(){return attrs.carouselTracker}function getAttributes(){return DataService.buildDataFromAttributes(attrs,"tracker")}function sendEvent(eventName,suffix){var trackerParams=getAttributes();trackerParams.Label=trackerParams.Label+"."+suffix,TrackerService.track(getEventDomain(),eventName,trackerParams,"click")}element.on("click",onClick)}return{restrict:"A",link:postLink}}carouselTracker.$inject=["_","$log","DataService","TrackerService"],angular.module("app.tracker").directive("carouselTracker",carouselTracker)}(),function(){"use strict";function tracker(_,$log,$timeout,browserEventUtility,DataService,TrackerService,trackerEventService,authModalService,UrlService){function postLink(scope,element,attrs){function onClickWrapper(event){return _.isUndefined(trackerAttributes[TRACKER_ATTRIBUTES.INNER_CLICK_TRACK_MODE])?onClick(event):onInnerLinkClick(event)}function onInnerLinkClick(event){var trackerParameters,href;currentClickTimeout||(href=_.get(event,"target.href"))&&(trackerParameters=getTrackerParameters(),trackerParameters.Url=href,TrackerService.track(eventDomain,clickEvent,trackerParameters,"click"),browserEventUtility.isNewTab(event)||(event.preventDefault(),$log.debug("tracker::onInnerLinkClick:: Delaying click for %sms",CLICK_DELAY_MS),currentClickTimeout=$timeout(function(){UrlService.changeUrl(href)},CLICK_DELAY_MS)))}function onClick(event){if(!currentClickTimeout){var trackerParameters=getTrackerParameters();TrackerService.track(eventDomain,clickEvent,trackerParameters,"click");var href=_.get(event,"currentTarget.href");href&&(isClickPrevented()||browserEventUtility.isNewTab(event)||!isNotAuthModalPrevented(event)||(event.preventDefault(),$log.debug("tracker::onClick:: Delaying click for %sms",CLICK_DELAY_MS),currentClickTimeout=$timeout(function(){UrlService.changeUrl(href)},CLICK_DELAY_MS)))}}function isNotAuthModalPrevented(event){var hasAuthDirective=_.has(event.currentTarget.attributes,"auth-action-wrapper"),isAuthModalOpened=authModalService.isModalOpened();return!hasAuthDirective||hasAuthDirective&&!isAuthModalOpened}function isClickPrevented(){return!_.isUndefined(trackerAttributes[TRACKER_ATTRIBUTES.PREVENT_DEFAULT_DISABLE])}function getTrackerParameters(){return _.omit(DataService.buildDataFromAttributes(attrs,"tracker"),_.values(TRACKER_ATTRIBUTES))}var clickEvent,impressionEvent,trackerAttributes,currentClickTimeout,eventDomain=attrs.tracker,CLICK_DELAY_MS=400,TRACKER_ATTRIBUTES={IMPRESSION:"Imp",CLICK:"Clk",INNER_CLICK_TRACK_MODE:"TrackInnerLinkClicks",PREVENT_DEFAULT_DISABLE:"PreventClk"};return eventDomain?(trackerAttributes=DataService.buildDataFromAttributes(attrs,"tracker"),_.isUndefined(trackerAttributes[TRACKER_ATTRIBUTES.CLICK])||(clickEvent=trackerAttributes[TRACKER_ATTRIBUTES.CLICK]||trackerEventService.DEFAULTS.CLICK_EVENT_NAME),_.isUndefined(trackerAttributes[TRACKER_ATTRIBUTES.IMPRESSION])||(impressionEvent=trackerAttributes[TRACKER_ATTRIBUTES.IMPRESSION]||trackerEventService.DEFAULTS.IMP_EVENT_NAME),clickEvent||impressionEvent?(impressionEvent&&TrackerService.track(eventDomain,impressionEvent,getTrackerParameters(),"impression"),void(clickEvent&&element.on("click auxclick",onClickWrapper))):void $log.error("tracker:: The defined tracker directive is missing click(clk) and/or impression(imp) tag attributes!")):void $log.error('tracker:: The defined tracker directive is missing the domain attribute! define the directive like this: tracker="domainName"')}return{restrict:"A",link:postLink}}tracker.$inject=["_","$log","$timeout","browserEventUtility","DataService","TrackerService","trackerEventService","authModalService","UrlService"],angular.module("app.tracker").directive("tracker",tracker)}(),function(){"use strict";function trackerService(_,$log,trackerEventService,trackerStream){function track(eventDomain,eventName,eventParams,eventFireType){if(eventFireType=eventFireType||"manual",!trackerEventService.getEvent(eventDomain,eventName)){var domains=trackerEventService.getDomains();if(!_.includes(domains,eventDomain))return void $log.error('TrackerService::track:: The event tracking domain "%s" is missing! Please define it and configure it inside trackerEventService',eventDomain);$log.warn('TrackerService::track:: Requested event "%s" was not found inside domain "%s"!\nPlease define the event inside trackerEventService under the given domain!',eventName,eventDomain)}_.includes(eventFireTypes,eventFireType)||$log.warn('TrackerService::track:: The given eventFireType argument "%s" is not in the supported list:',eventFireType,eventFireTypes),eventParams=eventParams||{};var eventPayload=_.assign({eventDomain:eventDomain,eventName:eventName,eventFireType:eventFireType,eventParams:eventParams},eventParams);$log.debug("TrackerService::track::",eventPayload),trackerStream.EVENT.onNext(eventPayload)}var eventFireTypes=["impression","click","manual","search"];return{track:track}}trackerService.$inject=["_","$log","trackerEventService","trackerStream"],angular.module("app.tracker").factory("TrackerService",trackerService)}(),function(){"use strict";function bofListenerService(_,$log,trackerStream,trackerApi,ARTICLE_EVENT,PROFILE_EVENT,JOB_EVENT,USER_EVENT){function init(){initImpressionsGrouped(),initImpressions(),initNonImpressionsStream()}function getStream(){return trackerStream.EVENT.filter(function(event){return!(!_.has(event,"eventParams.id")&&!_.has(event,"eventParams.Id"))&&_.includes([ARTICLE_EVENT.DOMAIN,PROFILE_EVENT.DOMAIN,JOB_EVENT.DOMAIN,USER_EVENT.DOMAIN],event.eventDomain)})}function setUser(user){userData={},user.isLoggedIn()&&(userData.user_id=_.parseInt(user.id)),userData.user_hash=user.getDeviceId(),userData.user_session_id=user.getSessionId(),$log.debug("bofListenerService::setUser::",userData)}function recordEvents(events){var apiData={};apiData.events=_.map(events,function(object){return _.transform(object,function(result,value,key){result[_.snakeCase(key)]=value},{})}),trackerApi.post(_.assign(apiData,userData))}function initImpressions(){getImpressionStreamOnce().delaySubscription(GROUP_TRACK_IMPRESSION_TIME).subscribe(function(trackingEvent){$log.debug("bofListenerService::initImpressions::",trackingEvent),recordEvents([trackingEvent])})}function initNonImpressionsStream(){getNonImpressionsStreamOnce().subscribe(function(trackingEvent){$log.debug("bofListenerService::initNonImpressionsStream::",trackingEvent),recordEvents([trackingEvent])})}function initImpressionsGrouped(){getImpressionStreamOnce().bufferWithTime(GROUP_TRACK_IMPRESSION_TIME).take(1).subscribe(function(trackingEvents){_.isEmpty(trackingEvents)||($log.debug("bofListenerService::initImpressionsGrouped::",trackingEvents),recordEvents(trackingEvents))})}function getImpressionStream(){return getStreamOnce().filter(function(event){return"impression"===event.eventFireType})}function getNonImpressionsStream(){return getStreamOnce().filter(function(event){return"impression"!==event.eventFireType})}var GROUP_TRACK_IMPRESSION_TIME=800,userData={},getStreamOnce=_.once(getStream),getImpressionStreamOnce=_.once(getImpressionStream),getNonImpressionsStreamOnce=_.once(getNonImpressionsStream);return{setUser:setUser,init:_.once(init)}}bofListenerService.$inject=["_","$log","trackerStream","trackerApi","ARTICLE_EVENT","PROFILE_EVENT","JOB_EVENT","USER_EVENT"],angular.module("app.tracker").factory("bofListenerService",bofListenerService)}(),function(){"use strict";function dataLayerPageviewListenerService($log,$window,_,trackerStream,AUTH_EVENT,UrlService){function init(){return trackerStream.EVENT.filter(filterEvents).subscribe(trackVirtualPageView)}function filterEvents(event){return _.startsWith(event.eventName,"Modal")&&_.includes([AUTH_EVENT.DOMAIN],event.eventDomain)}function trackVirtualPageView(event){$window.dataLayer=$window.dataLayer||[];var virtualPageView=buildVirtualPageViewPath(event.eventName,event.source,event.finalStep);if(!virtualPageView)return $log.warning("dataLayerPageviewListenerService::trackVirtualPageView:: Invalid event passed for tracking!");var pageViewEvent={event:"virtualPage",category:AUTH_EVENT.DOMAIN,value:virtualPageView};$log.debug("dataLayerPageviewListenerService::subscribeToEvent::",pageViewEvent),$window.dataLayer.push(pageViewEvent)}function buildVirtualPageViewPath(eventName,source,finalStep){if(eventName=_.replace(eventName,"Modal",""),eventName=_.replace(_.snakeCase(eventName),"_","-")){var currentUrlPath=_.trim(UrlService.getCurrentPath(),"/");return currentUrlPath=currentUrlPath?currentUrlPath+"/":"",source=source?"?source="+source:"",finalStep=finalStep?"/"+finalStep:"",VIRTUAL_PAGEVIEW_URL_PREFIX+currentUrlPath+"modal/"+eventName+finalStep+source}}var VIRTUAL_PAGEVIEW_URL_PREFIX="/virtual/";return{init:_.once(init)}}dataLayerPageviewListenerService.$inject=["$log","$window","_","trackerStream","AUTH_EVENT","UrlService"],angular.module("app.tracker").factory("dataLayerPageviewListenerService",dataLayerPageviewListenerService)}(),function(){"use strict";function gaArticleLinksListenerService(_,$log,$window,trackerStream,ARTICLE_EVENT){function init(){return trackerStream.EVENT.filter(filterEvents).subscribe(handleEvent)}function filterEvents(event){return _.find(supportedDomains,function(supportedDomain){return event.eventDomain===supportedDomain&&isSupportedEvent(event)})}function isSupportedEvent(event){return _.find(supportedEvents,function(supportedEvent){return event.eventName===supportedEvent})&&isSupportedLink(event)}function isSupportedLink(event){var url=_.get(event,"eventParams.Url");return url&&(isArticleLink(url)||isProfileLink(url))}function isArticleLink(href){return _.includes(href,ARTICLE_URL_PREFIX)}function isProfileLink(href){return _.includes(href,PROFILE_URL_PREFIX)}function handleEvent(event){var label=_.get(event,"eventParams.Label")+getTrackLabel(event.eventParams.Url),pageViewEvent={event:"BoF Event",action:event.eventParams.Action||event.eventFireType||"click",category:_.get(event,"eventParams.Cat")||event.eventName,label:label};$window.dataLayer.push(pageViewEvent),$log.debug("gaArticleLinksListenerService::handleEvent::",pageViewEvent)}function getTrackLabel(href){return isProfileLink(href)?_.replace(".Profile[_slug_]","_slug_",href.substring(href.indexOf(PROFILE_URL_PREFIX))):_.replace(".Article[_slug_]","_slug_",href.substring(href.indexOf(ARTICLE_URL_PREFIX)))}var ARTICLE_URL_PREFIX="/articles/",PROFILE_URL_PREFIX="/community/",supportedDomains=[ARTICLE_EVENT.DOMAIN],supportedEvents=["ArticleInnerLinkClick"];return{init:_.once(init)}}gaArticleLinksListenerService.$inject=["_","$log","$window","trackerStream","ARTICLE_EVENT"],angular.module("app.tracker").factory("gaArticleLinksListenerService",gaArticleLinksListenerService)}(),function(){"use strict";function gaEventListenerService(_,$window,$log,trackerStream,MEMBERSHIP_EVENT,ARTICLE_EVENT,CAREERS_EVENT,NAVIGATION_EVENT,PRINT_EVENT,SEARCH_EVENT,NEWSLETTER_EVENT,EDUCATION_EVENT,BOF500_EVENT,PODCASTS_EVENT,VOICES_EVENT,USER_EVENT,BOARDS_EVENT,NOTIFICATIONS_EVENT,COMMUNITY_EVENT,EVENTS_EVENT,CHINAPRIZE_EVENT,STATEOFFASHION_EVENT){function init(){return trackerStream.EVENT.map(mapSpecialEventsBeforeFilter).filter(filterEvents).map(mapSpecialEventsAfterFilter).subscribe(handleEvent)}function mapSpecialEventsBeforeFilter(event){if(event.eventDomain===ARTICLE_EVENT.DOMAIN&&"PayWallClick"===event.eventName){var e=angular.copy(event);return e.eventDomain=MEMBERSHIP_EVENT.DOMAIN,e.eventName="Memberships.Marketing",e}return event}function filterEvents(event){return _.includes(supportedDomains,event.eventDomain)&&(_.includes(supportedEvents,event.eventName)||_.includes(supportedCategories,event.Cat))}function mapSpecialEventsAfterFilter(event){if(event.eventDomain===ARTICLE_EVENT.DOMAIN&&"Article.Marketing"===event.eventName){var e=angular.copy(event);return e.eventName=event.eventParams.Page,delete e.eventParams.Page,delete e.Page,e}return event}function handleEvent(event){var category=event.Cat||event.eventName;event.eventParams.Page&&(category+="."+event.eventParams.Page);var gaEvent={event:"BoF Event",category:category,action:event.eventParams.Action||event.eventFireType||"click",label:event.eventParams.Label};_.isUndefined(event.eventParams.Value)||(gaEvent.value=event.eventParams.Value),$log.debug("gaEventListenerService::handleEvent",gaEvent),$window.dataLayer.push(gaEvent)}var supportedDomains=[ARTICLE_EVENT.DOMAIN,MEMBERSHIP_EVENT.DOMAIN,CAREERS_EVENT.DOMAIN,NAVIGATION_EVENT.DOMAIN,PRINT_EVENT.DOMAIN,SEARCH_EVENT.DOMAIN,NEWSLETTER_EVENT.DOMAIN,EDUCATION_EVENT.DOMAIN,PODCASTS_EVENT.DOMAIN,BOF500_EVENT.DOMAIN,VOICES_EVENT.DOMAIN,USER_EVENT.DOMAIN,BOARDS_EVENT.DOMAIN,NOTIFICATIONS_EVENT.DOMAIN,COMMUNITY_EVENT.DOMAIN,EVENTS_EVENT.DOMAIN,CHINAPRIZE_EVENT.DOMAIN,STATEOFFASHION_EVENT.DOMAIN],supportedCategories=["Careers","Memberships.Marketing","Community.Marketing","Careers.JobApply","ArticleClick.HomePage","Careers.Marketing","JobClick.ApplicationManagementPage","ApplicationManagementPage","EmailSubscriptions","CourseEnrollment","JobPage","BoF500.Marketing","Voices.Marketing","JobClick.JobSearchResultsPage","JobAlertsClick.JobSearchResultsPage","CareersLandingPage","OrganisationClick.CompanySearchResultPage","JobResultsClick.JobSearchResultPage","Memberships.GDPR","Events.Homepage","ChinaPrize.Marketing","Community.Homepage","StateOfFashion.Marketing"],supportedEvents=["Article.Marketing","ArticleClick","BestCompanies","BestCompanies.2017.Marketing","BofProfessionalCardPageClick","ButtonClick","CancelPollPageClick","CancelSavesPageClick","CareersLandingPage","CTAClick","ExternalJobApplyConfirm","ExternalJobApplyDismiss","ImageClick","InternalJobApplySubmit","JobApplicationReviewPage","JobApplyClick","JobClick","JobPage","Memberships.Marketing","NavigationClick","OrganisationClick","OtherPartnersClick","PodcastPlatformClick","Print.Marketing","SaveArticleButtonClick","SaveArticleJoinBofProfessionalLinkClick","Search.JobSearch","SearchJobClick","ShopifyClick","SiteNavigation","SliderArrowClick","SliderIndicatorClick","SocialShare","SponsorClick","SubscriberModal","SharedLoginModalImpression","SignUpModalCaptchaLoaded","SignUpModalCaptchaExecuted","SignUpModalCaptchaSolved","SignUpModalCaptchaReloaded","SignUpModalCaptchaClosed","Users.Impression","BoardsListPage","BoardsUploadPage","BoardsDetailsPage","ErrorNotification","Memberships.Marketing","Memberships.Marketing.Article","Memberships.Marketing.HomePage","Memberships.Marketing.ShowReview","Memberships.Marketing.ArticleListingPage","CourseEnrollment.CoursePaymentPage","FeaturedModuleCardImpression","FeaturedModuleCardClick","CompanySearchCompanyButtonClick","CompanySearchJobResultsButtonClick","ProfessionalLandingHeroButton","User.Consents","MembershipIncludesLink","MembershipCard","HoverTooltip","StudentLink","DailyDigestLink","MembershipSelectPackageClick","ApplyFor2018VoicesImgClick","ApplyFor2018BoFWestImgClick","MoreInfoBoFChinaSummitImgClick","MoreInfoBoF500ImgClick","MoreInfoVoicesBtnClick","MoreInfoBoFWestBtnClick","MoreInfoBoFChinaSummitBtnClick","MoreInfoBoF500BtnClick","JobAlert","YuholdingsImgClick","ShanghaiFashionWeekImgClick","LondonFashionWeekImgClick","CompanyIndex","BoF500Index","Voices.Marketing","VoicesMarketingBannerClick","VoicesMarketingBannerImpression","StateOfFashion.Marketing","StateOfFashionMarketingBannerClick","StateOfFashionMarketingBannerImpression"];return{init:_.once(init)}}gaEventListenerService.$inject=["_","$window","$log","trackerStream","MEMBERSHIP_EVENT","ARTICLE_EVENT","CAREERS_EVENT","NAVIGATION_EVENT","PRINT_EVENT","SEARCH_EVENT","NEWSLETTER_EVENT","EDUCATION_EVENT","BOF500_EVENT","PODCASTS_EVENT","VOICES_EVENT","USER_EVENT","BOARDS_EVENT","NOTIFICATIONS_EVENT","COMMUNITY_EVENT","EVENTS_EVENT","CHINAPRIZE_EVENT","STATEOFFASHION_EVENT"],angular.module("app.tracker").factory("gaEventListenerService",gaEventListenerService)}(),function(){"use strict";function gaPageViewListenerService(_,$log,$window,trackerStream,SEARCH_EVENT){function init(){return trackerStream.EVENT.filter(filterEvents).subscribe(handleEvent)}function filterEvents(event){return _.find(supportedDomains,function(supportedDomain){return event.eventDomain===supportedDomain&&isSupportedEvent(event)})}function isSupportedEvent(event){return _.find(supportedEvents,function(supportedEvent){return event.eventName===supportedEvent})}function handleEvent(event){if(_.isEmpty(event.eventParams.Url))return void $log.error("gaPageViewListenerService::handleEvent:: eventParams.Url for event %s is missing",event.eventName);var pageViewEvent={event:"virtualPage",category:event.eventName,value:event.eventParams.Url};$window.dataLayer.push(pageViewEvent),$log.debug("gaPageViewListenerService::",pageViewEvent)}var supportedDomains=[SEARCH_EVENT.DOMAIN],supportedEvents=["Search.JobSearch"];return{init:_.once(init)}}gaPageViewListenerService.$inject=["_","$log","$window","trackerStream","SEARCH_EVENT"],angular.module("app.tracker").factory("gaPageViewListenerService",gaPageViewListenerService)}(),function(){"use strict";function gaSearchTrackerService(_,$log,TrackerService){function track(eventName,searchAttributes,resultsCount){eventName=_.upperFirst(_.camelCase(eventName));var query=prepareData(eventName,searchAttributes);$log.debug("gaSearchTrackerService::track",eventName,searchAttributes,resultsCount),TrackerService.track("Search","Search."+eventName,{Label:query,Action:"search",Value:resultsCount,Url:VIRTUAL_PAGEVIEW_URL_PREFIX+query},"search")}function prepareData(eventName,data){var compressedData=[];return _.each(data,function(val,key){key=key.replace("_ids","").split("_").map(function(item){return item[0]}).join(""),compressedData.push(key+"("+val+")"),compressedData[key]=val}),eventName+":"+compressedData.join()}var VIRTUAL_PAGEVIEW_URL_PREFIX="/virtual/search?q=";return{track:track}}gaSearchTrackerService.$inject=["_","$log","TrackerService"],angular.module("app.tracker").factory("gaSearchTrackerService",gaSearchTrackerService)}(),function(){"use strict";function intercomListenerService(_,$log,trackerStream,intercomService,intercomTransformerService,MEMBERSHIP_EVENT,CAREERS_EVENT,ARTICLE_EVENT,EDUCATION_EVENT){function init(){trackerStream.EVENT.filter(function(event){return event.eventDomain===MEMBERSHIP_EVENT.DOMAIN&&_.includes(["MembershipMarketingPageview","MembershipTeamMarketingPageview","MembershipPaymentPageview","MembershipPaymentConfirmationPageview","MembershipFormTouch","MembershipValidFormSubmit","MembershipInvalidFormSubmit","MembershipFatalErrorModalOpen","MembershipTeamCustomizePageview","MembershipTeamPaymentPageview","MembershipTeamPaymentConfirmationPageview","MembershipTeamCustomizeAskQuestionModalOpen","MembershipTeamPaymentConfirmationAskQuestionModalOpen"],event.eventName)||event.eventDomain===CAREERS_EVENT.DOMAIN&&_.includes(["CompanyRequestJoinFormSubmit","CompanyRequestJoinEmailClick"],event.eventName)||event.eventDomain===ARTICLE_EVENT.DOMAIN&&_.includes(["PaywallArticleImpressionLogedInUserMetered","PaywallArticleImpressionLogedInUserHard"],event.eventName)||event.eventDomain===EDUCATION_EVENT.DOMAIN&&_.includes(["BofEducationButtonImpression","CourseEnrollment.CoursePaymentPage"],event.eventName)&&(event.eventParams.Coursename||_.endsWith(event.eventParams.Label,"PaymentSuccessful"))}).subscribe(function(event){intercomTransformerService.transform(event);var eventTrack=_.assign({Event:event.eventName},event.eventParams);$log.debug("intercomListenerService::init::",eventTrack),intercomService.addEvent(eventTrack)})}return{init:_.once(init)}}intercomListenerService.$inject=["_","$log","trackerStream","intercomService","intercomTransformerService","MEMBERSHIP_EVENT","CAREERS_EVENT","ARTICLE_EVENT","EDUCATION_EVENT"],angular.module("app.tracker").factory("intercomListenerService",intercomListenerService)}(),function(){"use strict";function intercomTransformerService(_){function transform(event){transformCourseViewEvent(event),transformCoursePaymentEvent(event)}function transformCourseViewEvent(event){_.includes(["BofEducationButtonImpression"],event.eventName)&&event.eventParams.Coursename&&(event.eventName="coursePageView_"+_.camelCase(event.eventParams.Coursename))}function transformCoursePaymentEvent(event){_.includes(["CourseEnrollment.CoursePaymentPage"],event.eventName)&&_.endsWith(event.eventParams.Label,"PaymentSuccessful")&&(event.eventName="coursePaymentSuccessful_"+_.camelCase(event.eventParams.courseName))}return{transform:transform}}intercomTransformerService.$inject=["_"],angular.module("app.tracker").factory("intercomTransformerService",intercomTransformerService)}(),function(){"use strict";function snowplowEventListenerService(_,$window,$log,trackerStream,COMMUNITY_EVENT){function init(){return trackerStream.EVENT.filter(filterEvents).subscribe(handleEvent)}function setUser(user){userId=user.isLoggedIn()?_.parseInt(user.id):null,$log.debug("snowplowEventListenerService::setUser::",userId)}function filterEvents(event){return _.includes(supportedDomains,event.eventDomain)&&(_.includes(supportedEvents,event.eventName)||_.includes(supportedCategories,event.Cat))}function handleEvent(event){function transformSnowplowParams(result,value,key){if(_.startsWith(_.toLower(key),"sp")){result[_.snakeCase(key.substring(2))]=value}}if(!$window.snowplow)return void setTimeout(function(){handleEvent(_.cloneDeep(event))},100);var spEvent={schema:event.eventParams.Schema,data:_.transform(event,transformSnowplowParams)};spEvent.data.action=event.eventParams.Action||event.eventFireType||"click",$log.debug("snowplowEventListenerService::handleEvent",spEvent),$window.snowplow("setUserId",userId),$window.snowplow("trackUnstructEvent",spEvent)}var userId=null,supportedDomains=[COMMUNITY_EVENT.DOMAIN],supportedCategories=["Community.Marketing"],supportedEvents=["FeaturedModuleCardImpression","FeaturedModuleCardClick"];return{init:_.once(init),setUser:setUser}}snowplowEventListenerService.$inject=["_","$window","$log","trackerStream","COMMUNITY_EVENT"],angular.module("app.tracker").factory("snowplowEventListenerService",snowplowEventListenerService)}(),function(){"use strict";function trackerEventService(_,EDUCATION_EVENT,MEMBERSHIP_EVENT,VOICES_EVENT,ARTICLE_EVENT,PROFILE_EVENT,PAYMENT_EVENT,AUTH_EVENT,JOB_EVENT,CAREERS_EVENT,NAVIGATION_EVENT,PRINT_EVENT,SEARCH_EVENT,NEWSLETTER_EVENT,USER_EVENT,BOF500_EVENT,PODCASTS_EVENT,BOARDS_EVENT,NOTIFICATIONS_EVENT,COMMUNITY_EVENT,EVENTS_EVENT,CHINAPRIZE_EVENT,STATEOFFASHION_EVENT){function getDomains(){return _.keys(events)}function getEvent(eventDomain,eventName){if(events[eventDomain]){if(_.includes(DEFAULTS,eventName))return eventName;if(_.includes(events[eventDomain].EVENTS,eventName))return eventName}}var DEFAULTS={CLICK_EVENT_NAME:"Click",IMP_EVENT_NAME:"Impression"},events={};return events[AUTH_EVENT.DOMAIN]=AUTH_EVENT,events[MEMBERSHIP_EVENT.DOMAIN]=MEMBERSHIP_EVENT,events[EDUCATION_EVENT.DOMAIN]=EDUCATION_EVENT,events[ARTICLE_EVENT.DOMAIN]=ARTICLE_EVENT,events[USER_EVENT.DOMAIN]=USER_EVENT,events[PROFILE_EVENT.DOMAIN]=PROFILE_EVENT,events[PAYMENT_EVENT.DOMAIN]=PAYMENT_EVENT,events[VOICES_EVENT.DOMAIN]=VOICES_EVENT,events[JOB_EVENT.DOMAIN]=JOB_EVENT,events[CAREERS_EVENT.DOMAIN]=CAREERS_EVENT,events[PRINT_EVENT.DOMAIN]=PRINT_EVENT,events[NAVIGATION_EVENT.DOMAIN]=NAVIGATION_EVENT,events[SEARCH_EVENT.DOMAIN]=SEARCH_EVENT,events[NEWSLETTER_EVENT.DOMAIN]=NEWSLETTER_EVENT,events[PODCASTS_EVENT.DOMAIN]=PODCASTS_EVENT,events[BOF500_EVENT.DOMAIN]=BOF500_EVENT,events[BOARDS_EVENT.DOMAIN]=BOARDS_EVENT,events[NOTIFICATIONS_EVENT.DOMAIN]=NOTIFICATIONS_EVENT,events[COMMUNITY_EVENT.DOMAIN]=COMMUNITY_EVENT,events[EVENTS_EVENT.DOMAIN]=EVENTS_EVENT,events[CHINAPRIZE_EVENT.DOMAIN]=CHINAPRIZE_EVENT,events[STATEOFFASHION_EVENT.DOMAIN]=STATEOFFASHION_EVENT,{DEFAULTS:DEFAULTS,getDomains:getDomains,getEvent:getEvent}}trackerEventService.$inject=["_","EDUCATION_EVENT","MEMBERSHIP_EVENT","VOICES_EVENT","ARTICLE_EVENT","PROFILE_EVENT","PAYMENT_EVENT","AUTH_EVENT","JOB_EVENT","CAREERS_EVENT","NAVIGATION_EVENT","PRINT_EVENT","SEARCH_EVENT","NEWSLETTER_EVENT","USER_EVENT","BOF500_EVENT","PODCASTS_EVENT","BOARDS_EVENT","NOTIFICATIONS_EVENT","COMMUNITY_EVENT","EVENTS_EVENT","CHINAPRIZE_EVENT","STATEOFFASHION_EVENT"],angular.module("app.tracker").factory("trackerEventService",trackerEventService)}(),function(){"use strict";function trackerStream(Stream){return{EVENT:new Stream}}trackerStream.$inject=["Stream"],angular.module("app.tracker").factory("trackerStream",trackerStream)}(),function(){"use strict";function trackDirective(_,$log,trackService){function postLink(scope,element){function trackSelfDescribingEvent(){var trackPayload={subject:scope.trackSubject,subject_id:scope.trackSubjectId?parseInt(scope.trackSubjectId):null,action:scope.trackAction,object:scope.trackObject,object_id:scope.trackObjectId?parseInt(scope.trackObjectId):null,preposition:scope.trackPreposition,prepositional_object:scope.trackPrepositionalObject,prepositional_object_id:scope.trackPrepositionalObjectId?parseInt(scope.trackPrepositionalObjectId):null};trackPayload=_.omitBy(trackPayload,_.isNil),$log.debug("track::directive::trackPayload",trackPayload),trackService.emitEvent(trackPayload)}return validateTrigger(scope.trackTrigger),validateSubject(scope.trackSubject),validateAction(scope.trackAction),scope.trackTrigger===trackService.TRIGGERS.VIEW?void trackSelfDescribingEvent():scope.trackTrigger===trackService.TRIGGERS.CLICK?void element.on("click",trackSelfDescribingEvent):void 0}function validateTrigger(trigger){if(!trackService.validateTrigger(trigger))throw new Error("Invalid trigger for track directive given ["+trigger+"] Trigger can be one of "+_.values(trackService.TRIGGERS).join(", "));return!0}function validateSubject(subject){if("string"!=typeof subject)throw new Error("Missing track subject");return!0}function validateAction(action){if(!trackService.validateAction(action))throw new Error("Invalid action for track directive given ["+action+"]. Action can be one of "+_.values(trackService.ACTIONS).join(", "));return!0}return{restrict:"A",scope:{trackTrigger:"@",trackSubject:"@",trackSubjectId:"@",trackAction:"@",trackObject:"@",trackObjectId:"@",trackPreposition:"@",trackPrepositionalObject:"@",trackPrepositionalObjectId:"@"},link:postLink}}trackDirective.$inject=["_","$log","trackService"],angular.module("app.track").directive("track",trackDirective)}(),function(){"use strict";function snowplowListenerService(_,Rx,$log,authStream,trackStream){function init(){var trackerEventStream=trackStream.EVENT,snowplowReadyStream=trackStream.SNOWPLOW_READY,userChangedStream=authStream.USER_DATA_CHANGED,snowPlowUser$=Rx.Observable.combineLatest(snowplowReadyStream,userChangedStream);snowPlowUser$.distinctUntilChanged(function(eventPayload){return eventPayload[1].getId()}).subscribe(function(eventPayload){var snowplow=eventPayload[0],userId=eventPayload[1].getId();$log.debug("track::snowplowListenerService::userChanged::",userId),snowplow("setUserId",userId)}),snowPlowUser$.take(1).subscribe(function(snowplowUserPayload){function trackEvent(eventPayload){var event=_.get(eventPayload,"[0].payload"),user=_.get(eventPayload,"[1]");if(!event)throw new Error("Missing event payload");"user"===event.subject&&!event.subject_id&&user.isLoggedIn()&&(event.subject_id=user.getId()),trackSnowplowSelfDescribingEvent(event,snowplow)}var snowplow=snowplowUserPayload[0];snowplow("enableActivityTracking",15,10),snowplow("trackPageView"),$log.debug("track::snowplowListenerService::trackPageView"),trackerEventStream.withLatestFrom(userChangedStream).subscribe(trackEvent)})}function trackSnowplowSelfDescribingEvent(event,snowplow){$log.debug("track::snowplowListenerService::trackSDEvent::",event),snowplow("trackSelfDescribingEvent",{schema:SCHEMA,data:event})}var SCHEMA="iglu:com.businessoffashion/event_action/jsonschema/1-0-0";return{init:_.once(init)}}snowplowListenerService.$inject=["_","Rx","$log","authStream","trackStream"],angular.module("app.track").service("snowplowListenerService",snowplowListenerService)}(),function(){"use strict";function snowplowService(_,Rx,$log,$window,trackStream){function init(){new Rx.Observable.interval(500).takeUntil(trackStream.SNOWPLOW_READY).take(10).subscribe(checkInit)}function checkInit(){if(!$window.snowplow)return void $log.debug("track::snowplowService:: snowplow not ready yet!");$log.debug("track::snowplowService:: snowplow is now ready!"),trackStream.SNOWPLOW_READY.onNext($window.snowplow),trackStream.SNOWPLOW_READY.onCompleted()}return{init:_.once(init)}}snowplowService.$inject=["_","Rx","$log","$window","trackStream"],angular.module("app.track").service("snowplowService",snowplowService)}(),function(){"use strict";function trackService(_,trackStream){function track(payload){if(!validateAction(payload.action))throw new Error("Invalid action given ["+payload.action+"] Action can be one of "+_.values(ACTIONS).join(", "));emitEvent(preparePayload(payload))}function emitEvent(trackAttributes){trackStream.EVENT.onNext({payload:trackAttributes})}function validateTrigger(trigger){return _.includes(TRIGGERS,trigger)}function validateAction(action){return _.includes(ACTIONS,action)}function preparePayload(payload){var trackPayload={subject:payload.subject,subject_id:payload.subjectId?parseInt(payload.subjectId):null,action:payload.action,object:payload.object,object_id:payload.objectId?parseInt(payload.objectId):null,preposition:payload.preposition,prepositional_object:payload.prepositionalObject,prepositional_object_id:payload.prepositionalObjectId?parseInt(payload.prepositionalObjectId):null};return _.omitBy(trackPayload,_.isNil)}var TRIGGERS={VIEW:"view",IMPRESSION:"impression",CLICK:"click"},ACTIONS={VIEW:"view",REGISTER:"register",LOGIN:"login",CLICK:"click",SUBSCRIBE:"subscribe",EXPIRE:"expire",PURCHASE:"purchase",IMPORT:"import",PUBLISH:"publish",APPLY:"apply",INVITE:"invite",CLAIM:"claim",ENROLL:"enroll"};return{TRIGGERS:TRIGGERS,ACTIONS:ACTIONS,track:track,emitEvent:emitEvent,validateTrigger:validateTrigger,validateAction:validateAction}}trackService.$inject=["_","trackStream"],angular.module("app.track").service("trackService",trackService)}(),function(){"use strict";function trackStream(Rx,LazyStream){return{SNOWPLOW_READY:new LazyStream,EVENT:new Rx.ReplaySubject(10)}}trackStream.$inject=["Rx","LazyStream"],angular.module("app.track").factory("trackStream",trackStream)}(),angular.module("app.ui").component("subscribeToSeeVideo",{templateUrl:"/templates/Voices/subscribe_to_see_video",bindings:{youtubeUrl:"@"},controller:["moment","$timeout","$sce","$localStorage","EventManager","AuthEvents","EventManagerUtility","FormServiceFactory","NewsletterService","authModalService","DomService",function(moment,$timeout,$sce,$localStorage,EventManager,AuthEvents,EventManagerUtility,FormServiceFactory,NewsletterService,authModalService,DomService){"use strict";var listeners=[],ctrl=this;ctrl.form={ref:null},ctrl.data={list_id:1,source:"VoicesLive",email:null},ctrl.showVideo=!1,ctrl.userIsLoggedIn=!1,ctrl.url=$sce.trustAsResourceUrl(ctrl.youtubeUrl),listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){ctrl.showVideo=user.hasMembership(),ctrl.userIsLoggedIn=user.isLoggedIn(),$timeout(function(){DomService.resetScroll()},1e3)})),ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.ui").component("uiShowMoreToggle",{template:'<button class="btn btn-default t_width-xs-7" ng-click="$ctrl.toggle()">{[{ $ctrl.itemsVisible ? $ctrl.visibleLabel : $ctrl.hiddenLabel }]} <i class="inline-block animate-default icon-small-arrow" ng-class="$ctrl.itemsVisible ? \'icon-rotate-270\' : \'icon-rotate-90\'"></i></button>',replace:!0,bindings:{channel:"@",visibleLabel:"@",hiddenLabel:"@"},controller:["ChannelManager","$element","UiEvents",function(ChannelManager,$element,UiEvents){"use strict";var ctrl=this,channelEventManager=ChannelManager.subscribe(ctrl.channel);$element[0];ctrl.itemsVisible=!1,ctrl.toggle=function(){ctrl.itemsVisible=!ctrl.itemsVisible,channelEventManager.emit(UiEvents.CHANGE_STATE,{isVisible:ctrl.itemsVisible})}}]}).component("uiShowMoreItem",{template:'<div class="row animate-default" ng-class="{ hidden: !$ctrl.isVisible }" ng-transclude></div>',replace:!0,transclude:!0,bindings:{channel:"@",alwaysVisible:"<"},controller:["ChannelManager","EventManagerUtility","UiEvents","$element",function(ChannelManager,EventManagerUtility,UiEvents,$element){"use strict";var ctrl=this,listeners=[],channelEventManager=ChannelManager.subscribe(ctrl.channel);$element[0];ctrl.isVisible=ctrl.alwaysVisible,ctrl.alwaysVisible||listeners.push(channelEventManager.on(UiEvents.CHANGE_STATE,function(data){ctrl.isVisible=data.isVisible})),ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.ui").component("uiSortPopoverComponent",{templateUrl:function(UiTemplates,AgentService){return AgentService.isMobile()?UiTemplates.SORT_POPOVER_COMPONENT_MOBILE:UiTemplates.SORT_POPOVER_COMPONENT},bindings:{channel:"@",label:"@",invert:"@",key:"@",classIconColor:"@"},transclude:!0,controller:["AgentService","ChannelManager","UiEvents","EventManagerUtility",function(AgentService,ChannelManager,UiEvents,EventManagerUtility){"use strict";var ctrl=this,ChannelEventManager=ChannelManager.subscribe(ctrl.channel),listeners=[],invert="true"===ctrl.invert;ctrl.status=null,ctrl.popoverStatus=!1,ctrl.handleClick=function(e){e.preventDefault(),e.stopPropagation(),null!==ctrl.status?ctrl.status=!ctrl.status:ctrl.status=!invert,ChannelEventManager.emit(UiEvents.CHANGE_SORT,{key:ctrl.key,order:ctrl.status?ctrl.key:"-"+ctrl.key})},ctrl.togglePopover=function(){ctrl.popoverStatus=!ctrl.popoverStatus},listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_SORT,function(data){data.key!==ctrl.key&&(ctrl.status=null)})),ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.ui").component("uiTooltipComponent",{template:'<div class="t_inline" ng-click="$ctrl.handleClick($event)"ng-mouseenter="$ctrl.handleMouseenter()"tooltip-class="{[{ ::$ctrl.tooltipClass }]}"tooltip-is-open="$ctrl.status"tooltip-trigger="{[{ ::$ctrl.trigger }]}"tooltip-html="{[{ ::$ctrl.html }]}"><div class="t_inline" ng-transclude></div></div>',bindings:{channel:"@",tooltipClass:"@",html:"@",trigger:"@",index:"@"},transclude:!0,controller:["EventManager","ChannelManager","UiEvents","AgentService",function(EventManager,ChannelManager,UiEvents,AgentService){"use strict";var ctrl=this,ChannelEventManager=ChannelManager.subscribe(ctrl.channel),listeners=[];ctrl.status=!1,ctrl.handleMouseenter=function(){AgentService.isMobile()||(ctrl.status=!0),ChannelEventManager.emit(UiEvents.TOOLTIP_OPENED,{id:ctrl.index,data:{status:ctrl.status}})},ctrl.handleClick=function(e){e.preventDefault(),e.stopPropagation(),ctrl.status&&!AgentService.isMobile()&&(ctrl.status=!1)},listeners.push(EventManager.onFresh(UiEvents.WINDOW_CLICK,function(res){ctrl.status=!1})),listeners.push(ChannelEventManager.onFresh(UiEvents.TOOLTIP_OPENED,function(res){ctrl.status&&res.id!==ctrl.index&&(ctrl.status=!1)})),ctrl.$onDestroy=function(){}}]}),angular.module("app.ui").constant("UiEvents",{INIT_COMPONENT:"UiComponentInit",INJECT_COMPONENT:"UiComponentInject",CHANGE_COMPONENT:"UiComponentChange",MOVE_TO_COMPONENT:"UiComponentMoveTo",INITIAL_REPAINT:"UiEventInitialRepaint",CHANGE_FILTER:"UiEventFilterChange",APPLY_FILTERS:"UiEventFilterApply",CLEAR_FILTERS:"UiEventFilterClearAll",CHANGE_SWITCH:"UiEventSwitchChange",INJECT_SWITCH:"UiEventSwitchInject",CHANGE_IN_VIEW:"UiEventInViewChange",LOAD_MORE:"UiEventLoadMore",CHANGE_PAGINATION:"UiChangePagination",UPDATE_PAGINATION:"UiUpdatePagination",CHANGE_SWIPE:"UiUpdateSwipe",CHANGE_BADGE:"UiUpdateBadge",CHANGE_TAB:"UiUpdateTab",CHANGE_SELECT:"UiUpdateSelect",CHANGE_BULK:"UiUpdateBulk",CHANGE_MEDIA:"UiChangeMedia",INJECT_MEDIA:"UiInjectMedia",UPDATE_MEDIA:"UiUpdateMedia",CHANGE_CHECKBOX:"UiUpdateCheckbox",INJECT_CHECKBOX:"UiInjectCheckbox",CHANGE_TOGGLE:"UiUpdateToggle",INJECT_TOGGLE:"UiInjectToggle",INJECT_TOGGLE_COUNT:"UiInjectToggleCount",CHANGE_PROMOTE:"UiUpdatePromote",INJECT_PROMOTE:"UiInjectPromote",CHANGE_TAG:"UiChangeTag",REMOVE_TAG:"UiRemoveTag",CHANGE_SCROLL_TO:"UiChangeScrollTo",TOOLTIP_OPENED:"UiHideTooltip",CHANGE_TYPEAHEAD:"UiUpdateTypeahead",QUERY_TYPEAHEAD:"UiQueryTypeahead",INJECT_TYPEAHEAD:"UiInjectTypeahead",RESET_TYPEAHEAD:"UiResetTypeahead",INJECT_SOCIAL_META:"UiInjectSocialMeta",CHANGE_PROGRESS:"UiUpdateProgress",INJECT_MESSAGE:"UiInjectMessage",LOCK:"UiLock",INIT_STATE:"UiInitState",CHANGE_STATE:"UiChangeState",INJECT_STATE:"UiInjectState",CHANGE_SORT:"UiUpdateSort",INJECT_SORT:"UiInjectSort",CHANGE_CHOICE:"UiUpdateChoice",CHANGE_NOTE:"UiChangeNote",WINDOW_RESIZE:"UiWindowResize",WINDOW_CLICK:"UiWindowClick",WINDOW_SCROLL:"UiWindowScroll",ROUTE_CHANGED:"UiRouteChanged",POST_MESSAGE:"UiPostMessage",REFRESH_ITEM:"UiRefreshItem",SELECT_ITEM:"UiSelectItem",REMOVE_ITEM:"UiRemoveItem",CHANGE_ACTION:"UiEventActionChange",REFRESH:"UiEventRefresh",REPAINT:"UiEventRepaint",EXPORT_PDF:"UiEventPdfExport",EXPORT_PDF_COMPLETED:"UiEventPdfExportCompleted",EDIT_INLINE:"UiEventEditInline",MODAL_CHANGE_URL:"UiEventModalChangeUrl",MODAL_TOGGLE_CLOSE_BUTTON:"UiEventModalToggleCloseButton",PREVENT_CLICK:"UiEventPreventClick",ELEMENT_FOCUS:"UiEventElementFocus"}),angular.module("app.ui").controller("ModalGenericController",["$scope","$modalInstance","modalParams","ChannelManager","EventManagerUtility","UiEvents",function($scope,$modalInstance,modalParams,ChannelManager,EventManagerUtility,UiEvents){$scope.params=modalParams,$scope.params.closeButtonEnabled=$scope.params.closeButtonEnabled||!0;var channelEventManager=null,listeners=[];$scope.params.channel&&(channelEventManager=ChannelManager.subscribe($scope.params.channel),listeners.push(channelEventManager.on(UiEvents.MODAL_CHANGE_URL,function(data){$scope.params.url=data.url,$scope.$apply()})),listeners.push(channelEventManager.on(UiEvents.MODAL_TOGGLE_CLOSE_BUTTON,function(data){$scope.params.closeButtonEnabled=data.enabled,$scope.$apply()}))),$scope.close=function(){$modalInstance.close()},$scope.dismiss=function(){$modalInstance.dismiss()},$scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}]),angular.module("app.ui").controller("StateGenericController",["$scope","$state","EventManager","$rootScope","HeaderEvents","stateParams","RouterService",function($scope,$state,EventManager,$rootScope,HeaderEvents,stateParams,RouterService){var listener=$rootScope.$on("$stateChangeSuccess",function(){$scope.changeStatus()});$scope.changeStatus=function(){stateParams.state===$state.$current.name&&(EventManager.emit(HeaderEvents.UPDATE,{title:stateParams.title,state:stateParams.parentState,breadcrumbs:stateParams.breadcrumbs}),RouterService.pageView())},$scope.changeStatus(),$scope.$on("$destroy",function(){listener&&listener()})}]),angular.module("app.ui").component("uiAccordion",{template:'<accordion-group class="panel-accordion panel-secondary margin-bottom-xs-3 cursor-pointer  c_accordion" is-open="$ctrl.open"><accordion-heading><span class="padding-xs-3 padding-sm-5  align-center-y  c_accordion__heading"><span class="c_accordion__title sans-serif" ng-bind-html="$ctrl.heading"></span><span class="c_accordion__icon" ng-class="{\'icon-dropdown icon-rotate-180\': $ctrl.open, \'icon-dropdown\': !$ctrl.open}"></span></span></accordion-heading><div class="padding-sm-3 padding-top-xs-0" ng-transclude></div></accordion-group>',transclude:"true",bindings:{heading:"@"}}),angular.module("app.ui").directive("uiActionComponent",["ChannelManager","UiEvents",function(ChannelManager,UiEvents){return{template:'<div ng-click="handleClick($event)" ng-transclude></div>',replace:!0,transclude:!0,restrict:"E",scope:{channel:"@",id:"@",value:"@",flip:"@",action:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),flipStatus="true"===scope.flip;scope.status="1"===scope.value||"true"===scope.value,scope.handleClick=function(event){event.preventDefault(),event.stopPropagation(),ChannelEventManager.emit(UiEvents.CHANGE_ACTION,{id:scope.id,status:flipStatus?!scope.status:scope.status,action:scope.action})}}}}]),angular.module("app.ui").directive("uiAlertBoxComponent",["_","ChannelManager","UiEvents","EventManagerUtility","$timeout","BootstrapVersion",function(_,ChannelManager,UiEvents,EventManagerUtility,$timeout,BootstrapVersion){return{template:'<div class="animate-hide ng-hide" ng-show="alerts.length"><~alert class="panel-alert" type="{[{::type}]}" close="closeAlert($index)"><~accordion class="panel-reset panel-invisible no-margin no-padding"><~accordion-group class="panel-invisible" panel-class="no-margin" is-open="status"><~accordion-heading class=""><span class="text-anchor-reset sans-serif medium-size-font color-brand-white"><b>{[{alerts.length}]} {[{titleMessage}]}</b></span><i class="smaller-font  inline-block  icon-dropdown  text-right" ng-class="{\'icon-rotate-270\': !status}"></i></~accordion-heading><span class="block sans-serif" ng-repeat="alert in alerts">{[{alert}]}</span></~accordion-group></~accordion></~alert></div>'.replace(/~/g,BootstrapVersion.getNamespace()),replace:!0,transclude:!0,restrict:"E",scope:{channel:"@",id:"@",title:"@",titleMany:"@",type:"@",autoClose:"@",openList:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],autoClose="true"===scope.autoClose,timer=null,title={one:scope.title,many:scope.titleMany||scope.title};scope.titleMessage=null,scope.alerts=[],scope.status="true"===scope.openList,scope.closeAlert=function(){scope.alerts=[]},scope.closeAutomatically=function(){timer&&$timeout.cancel(timer),timer=$timeout(function(){scope.closeAlert()},15e3)},listeners.push(ChannelEventManager.onFresh(UiEvents.INJECT_MESSAGE,function(data){data.id===scope.id&&data.type===scope.type&&(_.isArray(data.value)?scope.alerts=data.clear?_.uniq(data.value):_.uniq(scope.alerts.concat(data.value)):scope.alerts.push(data.value),scope.titleMessage=1==scope.alerts.length?title.one:title.many),autoClose&&scope.closeAutomatically()})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiBadge",["ChannelManager","UiEvents","$timeout","EventManagerUtility",function(ChannelManager,UiEvents,$timeout,EventManagerUtility){return{template:"<span ng-class=\"{'is-animating': status}\">{[{value}]}</span>",replace:!0,restrict:"E",scope:{channel:"@",id:"@",duration:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],duration=scope.duration?parseInt(scope.duration):2e3;scope.status=!1,scope.value="",listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_BADGE,function(data){data.id===scope.id&&(scope.value=data.value,scope.status=!0),$timeout(function(){scope.status=!1},duration)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("checkRequired",function(){return{require:"ngModel",restrict:"A",link:function(scope,element,attrs,ngModel){ngModel.$validators.checkRequired=function(modelValue,viewValue){var value=modelValue||viewValue,match=scope.$eval(attrs.ngTrueValue)||!0;return value&&match===value}}}}),angular.module("app.ui").directive("uiCheckboxComponent",["_","ChannelManager","UiEvents","EventManagerUtility",function(_,ChannelManager,UiEvents,EventManagerUtility){return{restrict:"E",template:'<div>   <div class="{[{::wrapperClass}]}" ng-class="{ \'transparent-third\': !isEnabled }" ng-click="handleSelect($event)">       <i class="cursor-pointer" ng-class="valueBool ? \'icon-check-on\' : \'icon-check-off\'"></i>       <div class="{[{::transcludedClass || \'inline-block\'}]}" ng-transclude></div>{[{item}]}   </div></div>',replace:!0,transclude:!0,scope:{wrapperClass:"@",transcludedClass:"@",id:"@",value:"@",disabled:"@",channel:"@"},link:function(scope){var listeners=[],ChannelEventManager=ChannelManager.subscribe(scope.channel);scope.valueBool="1"===scope.value||"true"===scope.value,scope.isEnabled="true"!==scope.disabled,scope.handleSelect=function($event,forcedValue,forceEnable){if($event&&($event.preventDefault(),$event.stopPropagation()),forceEnable&&(scope.isEnabled=!0),scope.isEnabled){var newValue=_.isUndefined(forcedValue)?!scope.valueBool:forcedValue;scope.valueBool!=newValue&&(scope.valueBool=newValue,ChannelEventManager.emit(UiEvents.CHANGE_CHECKBOX,{id:scope.id,value:scope.valueBool}))}},listeners.push(ChannelEventManager.onFresh(UiEvents.INJECT_CHECKBOX,function(data){data.id!==scope.id&&"ALL"!==data.id||scope.handleSelect(null,data.value,data.forceEnable)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiChoiceComponent",["ChannelManager","UiEvents",function(ChannelManager,UiEvents){return{replace:!0,restrict:"E",templateUrl:function(elm,attr){return attr.type?"/templates/Spa/UI:choice_component_"+attr.type:"/templates/Spa/UI:choice_component"},scope:{id:"@",status:"@",channel:"@",disabled:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel);scope.componentStatus=parseInt(scope.status,10)||0,scope.handleSwitch=function(event,status){event.stopPropagation(),event.preventDefault(),scope.componentStatus=status,scope.disabled||ChannelEventManager.emit(UiEvents.CHANGE_CHOICE,{id:scope.id,status:status})}}}}]),angular.module("app.ui").component("uiDatePickerComponent",{template:function(BootstrapVersion){return'<div class="input-group"><input type="text" class="form-control background-white" placeholder="{[{ $ctrl.placeholder }]}" ng-model="$ctrl.date" is-open="$ctrl.datepicker.isOpen" ~datepicker-popup="dd-MM-yyyy" close-text="Close" /><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="$ctrl.openDatepicker()"><i class="icon icon-clock"></i></button></span><input class="hidden" form-control id="{[{::$ctrl.id}]}" name="{[{::$ctrl.id}]}" ng-model="model" ng-minlenght="2" /></div>'.replace(/~/g,BootstrapVersion.getNamespace())},bindings:{id:"@",placeholder:"@",channel:"@"},require:{ngModel:"ngModel"},controller:["$scope","moment","ChannelManager","UiEvents","EventManagerUtility","BootstrapVersion",function($scope,moment,ChannelManager,UiEvents,EventManagerUtility,BootstrapVersion){var ctrl=this,listeners=(ChannelManager.subscribe(ctrl.channel),[]);ctrl.model=null,ctrl.date=null,ctrl.datepicker={isOpen:!1},ctrl.handleChange=function(value){ctrl.ngModel.$setViewValue(moment(value).format("YYYY-MM-DD"))},ctrl.openDatepicker=function(value){ctrl.datepicker.isOpen=!0},$scope.$watch(function(){return ctrl.date},function(newVal,oldVal){newVal&&ctrl.handleChange(newVal)}),$scope.$watch(function(){return ctrl.ngModel.$modelValue},function(newVal,oldVal){newVal&&(ctrl.date=newVal)}),ctrl.$onInit=function(){},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.ui").directive("uiDropdownComponent",["_","ChannelManager","UiEvents","EventManagerUtility","BootstrapVersion",function(_,ChannelManager,UiEvents,EventManagerUtility,BootstrapVersion){return{restrict:"E",scope:{channel:"@",id:"@",value:"@",placeholder:"@"},template:'<div><div class="btn-group dropdown-menu-reset cursor-pointer" ~dropdown><span ~dropdown-toggle><span class="inline-block"><div><div ng-click="handleSelect($event)"><i ng-class="{\'icon-check-on\': valueBool,\'icon-check-off\': !valueBool}"></i><div class="{[{::transcludedClass || \'inline-block\'}]}"></div>{[{item}]}</div></div></span><i class="icon-sort-arrow"></i></span><ul class="dropdown-menu" ~dropdown-menu role="menu" aria-labelledby="btn-append-to-body"><li ng-repeat="item in items" role="menuitem" ng-click="handleChange(item)" class="dropdown-menu-item"><span class="padding-horizontal-xs-4 sans-serif">{[{::item.title}]}</span></li></ul></div></div>'.replace(/~/g,BootstrapVersion.getNamespace()),link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.items={},scope.data={},scope.valueBool=!1,scope.handleSelect=function(event){event.preventDefault(),event.stopPropagation(),scope.valueBool=!scope.valueBool,ChannelEventManager.emit(UiEvents.INJECT_CHECKBOX,{id:"ALL",value:scope.valueBool})},scope.handleChange=function(item){ChannelEventManager.emit(UiEvents.CHANGE_BULK,{key:item.key,value:item.value,patchObject:_.zipObject([item.key],[item.value])}),scope.valueBool=!1},listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,function(data){_.isEmpty(data.BULKS)||_.isEmpty(data.BULKS[scope.id])||(scope.items=data.BULKS[scope.id])})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiDropdownSelectComponent",["_","ChannelManager","UiEvents","EventManagerUtility","BootstrapVersion",function(_,ChannelManager,UiEvents,EventManagerUtility,BootstrapVersion){return{restrict:"E",scope:{channel:"@",placeholder:"@",id:"@",value:"@"},require:"ngModel",template:'<div><div class="dropdown-menu-reset cursor-pointer" ~dropdown keyboard-nav="true" is-open="isOpen"><span ~dropdown-toggle id="simple-btn-keyboard-nav"><span class="inline-block form-control"><span ng-class="{\'color-gray-medium\': !model}">{[{selected.title}]}</span><i class="caret corner-top-right margin-top-xs-4 margin-right-xs-3"></i></span></span><ul class="dropdown-menu full-width no-overflow" ~dropdown-menu role="menu" aria-labelledby="simple-btn-keyboard-nav"><li ng-repeat="item in items" role="menuitem" class="dropdown-menu-item padding-xs-0 sans-serif"><a class="b_reset-a" href="#" ng-click="handleChange(item, $event)"><div class="{[{::!item.remainingSeats ? \'dropdown-menu-item__disabled\' : \'\'}]}"><b class="">{[{::item.title}]}</b></div><div class="white-space-normal">{[{::item.descr}]}</div></a></li></ul></div><div style="height: 0; width: 0; overflow: hidden"><input style="" ng-focus="isOpen = true" form-control id="{[{::id}]}" name="{[{::id}]}" ng-model="model" required ng-minlenght="2" /></div></div>'.replace(/~/g,BootstrapVersion.getNamespace()),link:function(scope,element,attrs,ngModel){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.model=null,scope.items={},scope.data={},scope.selected={id:null,title:scope.placeholder},scope.handleChange=function(item,event){event&&(event.stopPropagation(),event.preventDefault()),item.remainingSeats>0&&(scope.selected=item,scope.model=item.title,ngModel.$setViewValue(item),scope.isOpen=!1)},listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,function(data){_.has(data,scope.id)&&(scope.items=data[scope.id]),_.has(data,"selected")&&scope.handleChange(_.find(scope.items,{id:data.selected}))})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiEditInlineComponent",["_","ChannelManager","UiEvents","UiTemplates","UiTemplateService","EventManagerUtility",function(_,ChannelManager,UiEvents,UiTemplates,UiTemplateService,EventManagerUtility){return{templateUrl:function(element,attrs){return attrs.template?UiTemplateService.getTemplate(attrs.template):UiTemplates.EDIT_INLINE_DEFAULT},replace:!0,restrict:"E",scope:{channel:"@",id:"@",label:"@",name:"@",value:"@",placeholder:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],inputElement=angular.element(element[0].children[1]),patchData={};scope.model=scope.value,scope.handleEnter=function(event,value){13===event.keyCode&&scope.handleChange("enterKey")},scope.handleFocus=function(){ChannelEventManager.emit(UiEvents.ELEMENT_FOCUS,{focused:!0})},scope.handleBlur=function(){scope.handleChange("blur"),ChannelEventManager.emit(UiEvents.ELEMENT_FOCUS,{focused:!1})},scope.handleChange=function(source){scope.model=inputElement.val().replace(/<[^>]+>/gm,""),patchData={},patchData[scope.name]=scope.model,ChannelEventManager.emit(UiEvents.EDIT_INLINE,{id:scope.id,patch:patchData,name:scope.name,value:scope.model,source:source})},listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,function(data){_.isEmpty(scope.value)&&data.inputs&&(scope.model=data.inputs[scope.id]||"")})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiFixedNav",["ChannelManager","EventManager","NavigationManager","DomService",function(ChannelManager,EventManager,NavigationManager,DomService){return{template:'<div class="o_layout-side-body__fixed-container"><div class="o_layout-side-body__fixed-offset" ng-style="customStyle" ng-class="{\'is-active\':status}" ng-transclude></div></div>',replace:!0,transclude:!0,restrict:"E",scope:{offset:"@",relative:"@"},link:function(scope,element,attrs){var container=element[0],topOffset=(container.childNodes[0],parseInt(scope.offset,10)||0),listenerOff=(parseInt(scope.height,10),null);scope.status=!1,scope.customStyle={top:topOffset+"px"},listenerOff=NavigationManager.onChange(function(data){"main"===data.container&&(scope.status=data.value)}),scope.$on("$destroy",function(){listenerOff()})}}}]),angular.module("app.ui").directive("uiFormatNumber",["$filter",function($filter){return{template:"<span ng-class=\"{'text-danger': !status}\">{[{value}]}</span>",replace:!0,restrict:"E",scope:{model:"=",format:"@",precision:"@"},link:function(scope,element,attrs){var precision=(scope.bindOnce,parseInt(scope.precision)||0),template=scope.format||"{value}";scope.value=null,scope.format=function(number){var num=parseInt(number,10);isNaN(num)?(scope.status=!1,scope.value="NA"):(scope.status=!0,scope.value=template.replace("{value}",$filter("number")(num,precision)))},scope.$watch("model",function(n,o){scope.format(n)})}}}]),angular.module("app.ui").directive("uiInitComponent",["EventManager","UiEvents","$evalAsync",function(EventManager,UiEvents,$evalAsync){return{restrict:"A",link:function(scope,element,attrs){angular.getTestability(element[0]).whenStable(function(){$evalAsync(function(){EventManager.emit(UiEvents.INITIAL_REPAINT,{})})})}}}]),angular.module("app.ui").directive("uiItemComponent",["ChannelManager","UiEvents","DomService","$animate","EventManagerUtility",function(ChannelManager,UiEvents,DomService,$animate,EventManagerUtility){return{template:"<div><div class=\"{[{::classComponent}]}\" ng-click=\"handleClick($event)\" ng-class=\"{'box-shadow-medium': status, 'box-shadow-light': !status, 't_transparent-sixth': isDisabled}\" ng-transclude></div></div>",replace:!0,transclude:!0,restrict:"E",scope:{channel:"@",id:"@",classComponent:"@",disabled:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],disabled="true"===scope.disabled;scope.status=0,scope.isDisabled=disabled,scope.handleClick=function(){disabled||ChannelEventManager.emit(UiEvents.SELECT_ITEM,{id:scope.id,status:!0})},listeners.push(ChannelEventManager.on(UiEvents.SELECT_ITEM,function(data){scope.status=data.id===scope.id})),listeners.push(ChannelEventManager.onFresh(UiEvents.REMOVE_ITEM,function(data){data.id===scope.id&&(element[0].style.height=DomService.getHeight(element[0])+"px",element.addClass("animate-collapse-vg"),$animate.leave(element).then(function(){ChannelEventManager.emit(UiEvents.REFRESH,{})}))})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("labelFilters",["_","ChannelManager","UiEvents","EventManagerUtility","UiTemplateService","UiTemplates",function(_,ChannelManager,UiEvents,EventManagerUtility,UiTemplateService,UiTemplates){"use strict";return{restrict:"E",scope:{id:"@",channel:"@",subchannel:"@",template:"@",radio:"@",bistatic:"@"},replace:!0,templateUrl:function(element,attrs){return attrs.template?UiTemplateService.getTemplate(attrs.template):UiTemplates.FILTER},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),SubChannelEventManager=ChannelManager.subscribe(scope.subchannel),selectedItems=[],isExclusive="true"===scope.radio,listeners=[];scope.propagate=function(){ChannelEventManager.emit(UiEvents.CHANGE_FILTER,{id:scope.id,value:selectedItems.join(",")})},scope.disableOthers=function(id){SubChannelEventManager.emit(UiEvents.INJECT_TOGGLE,{id:id,value:!0})},listeners.push(SubChannelEventManager.onFresh(UiEvents.CHANGE_TOGGLE,function(data){isExclusive?(scope.disableOthers(data.id),selectedItems=data.value?[data.id]:[]):data.value?selectedItems.push(data.id):_.pull(selectedItems,data.id),scope.propagate()})),listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,function(data){_.has(data,scope.id)&&(scope.items=data[scope.id].data,scope.disableOthers(data[scope.id].selected))})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiLoadMoreComponent",["_","ChannelManager","UiEvents","EventManagerUtility","DomService",function(_,ChannelManager,UiEvents,EventManagerUtility,DomService){"use strict";return{template:'<div><button class="{[{::classButton}]}" ng-click="handleClick()" ng-if="!loadLimit"><ng-transclude/></button></div>',restrict:"E",replace:!0,scope:{id:"@",channel:"@",classButton:"@",lazyCount:"@"},transclude:!0,link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),lazyCounter=_.isEmpty(scope.lazyCount)?0:parseInt(scope.lazyCount,10),counter=lazyCounter,lock=!0,componentId=scope.id||"loadMore",listeners=[];scope.loadLimit=!1,scope.handleClick=function(){ChannelEventManager.emit(UiEvents.LOAD_MORE,{id:componentId,data:{status:!0}})},listeners.push(ChannelEventManager.on(UiEvents.UPDATE_PAGINATION,function(res){var itemLoaded=res.page*res.limit;res.total<=itemLoaded?scope.loadLimit=!0:scope.loadLimit=!1,1===res.page&&(counter=lazyCounter),lock=!1})),scope.refresh=function(){!counter||lock||scope.loadLimit||DomService.getAbsoluteBottom(element[0])<0&&(counter-=1,scope.handleClick(),lock=!0),DomService.requestAnimationFrame(scope.refresh)},counter>0&&scope.refresh(),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiLockComponent",["ChannelManager","UiEvents","EventManagerUtility",function(ChannelManager,UiEvents,EventManagerUtility){return{template:'<div><div ng-if="!status" ng-transclude></div></div>',replace:!0,transclude:!0,restrict:"E",scope:{channel:"@",invert:"@",hide:"@"},link:function(scope,element,attrs){var listeners=[],ChannelEventManager=ChannelManager.subscribe(scope.channel),hasToInvert="true"===scope.invert;scope.hide;scope.status=!1,listeners.push(ChannelEventManager.on(UiEvents.LOCK,function(data){data.status^hasToInvert?(element.addClass("locked"),scope.status=!0):(element.removeClass("locked"),scope.status=!1)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiModalOpenComponent",["_","$injector","ChannelManager","UiEvents","UiModalService","AgentService","UiTemplateService",function(_,$injector,ChannelManager,UiEvents,UiModalService,AgentService,UiTemplateService){return{template:'<div class="cursor-pointer" ng-click="handleOpen($event, true)" fast-click ng-transclude></div>',replace:!0,transclude:!0,restrict:"E",scope:{channel:"@",id:"@",template:"@",autoOpen:"@"},link:function(scope,element,attrs){var autoOpen=(ChannelManager.subscribe(scope.channel),"false"!==scope.autoOpen),templateFileConfig=UiTemplateService.getTemplate(scope.template);scope.handleOpen=function(event,force){event&&(event.preventDefault(),event.stopPropagation()),UiModalService.openModal(_.assign(templateFileConfig,{backdrop:!AgentService.isMobile()&&templateFileConfig.backdrop}),{id:scope.id,channel:scope.channel})},!AgentService.isTouch()&&autoOpen&&scope.handleOpen()}}}]),angular.module("app.ui").directive("uiPaginationComponent",["ChannelManager","UiEvents","EventManagerUtility","BootstrapVersion",function(ChannelManager,UiEvents,EventManagerUtility,BootstrapVersion){"use strict";return{template:'<div ng-show="isVisible"><~pagination class="inline-block  pagination-md  no-margin" max-size="maxSize" total-items="totalItems" items-per-page="itemsPerPage" ng-model="currentPage" boundary-links="true" rotate="false" ng-change="handleChange()" num-pages="numPages"></~pagination></div>'.replace(/~/g,BootstrapVersion.getNamespace()),restrict:"E",replace:!0,scope:{channel:"@",max:"@"},transclude:!0,link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.itemsPerPage=0,scope.totalItems=0,scope.isVisible=!1,scope.maxSize=parseInt(scope.max)||10,scope.handleChange=function(){ChannelEventManager.emit(UiEvents.CHANGE_PAGINATION,{page:scope.currentPage})},listeners.push(ChannelEventManager.on(UiEvents.UPDATE_PAGINATION,function(res){scope.currentPage=res.page,scope.totalItems=res.total,scope.itemsPerPage=res.limit,scope.isVisible=scope.itemsPerPage<scope.totalItems||scope.currentPage>1})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiProgressComponent",["ChannelManager","UiEvents","EventManagerUtility","BootstrapVersion",function(ChannelManager,UiEvents,EventManagerUtility,BootstrapVersion){return{template:'<div><~progressbar class="progress-striped-x progress-normal no-margin" value="progress" type="{[{::type}]}"></~progressbar></div>'.replace(/~/g,BootstrapVersion.getNamespace()),replace:!0,transclude:!0,restrict:"E",scope:{channel:"@",id:"@",value:"@",type:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.progress=parseInt(scope.value,10)||0,listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_PROGRESS,function(data){data.id===scope.id&&(scope.progress=data.value)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiRepaint",["_","ChannelManager","UiEvents","$compile","EventManagerUtility","$timeout",function(_,ChannelManager,UiEvents,$compile,EventManagerUtility,$timeout){return{multiElement:!0,transclude:!0,terminal:!0,restrict:"E",scope:!0,link:function(scope,element,attrs,ctrl,transclude){var block={},listeners=[],ChannelEventManager=ChannelManager.subscribe(attrs.channel);scope.destroy=function(){_.isEmpty(block)||(block.scope.$destroy(),element.children().remove())},scope.repaint=function(){transclude(function(clone,newScope){scope.destroy(),_.assign(block,{ref:element.append(clone),clone:clone,scope:newScope})}),attrs.timeout&&$timeout(function(){scope.destroy()},parseInt(attrs.timeout,10))},listeners.push(ChannelEventManager.onFresh(UiEvents.REPAINT,function(){$timeout(function(){scope.repaint()},0)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiSavePdf",["PdfService","ChannelManager","UiEvents","EventManagerUtility","EventManager","AuthEvents",function(PdfService,ChannelManager,UiEvents,EventManagerUtility,EventManager,AuthEvents){"use strict";return{restrict:"A",link:function(scope,element,attrs){var pdf=new PdfService(element[0]),ChannelEventManager=ChannelManager.subscribe(attrs.channel),listeners=[];listeners.push(ChannelEventManager.on(UiEvents.EXPORT_PDF,function(data){setTimeout(function(){pdf.export(attrs.destination).then(function(){ChannelEventManager.emit(UiEvents.EXPORT_PDF_COMPLETED,{})})},1e3)},!1)),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiScrollToComponent",["ChannelManager","UiEvents","DomService","EventManagerUtility","$document",function(ChannelManager,UiEvents,DomService,EventManagerUtility,$document){return{restrict:"A",link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(attrs.channel),listeners=[];listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_SCROLL_TO,function(data){data.id===attrs.id&&DomService.scrollToElement(element,10,500,data.parent)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]).directive("modalContent",function(){return{restrict:"C",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){this.getElement=function(){return $element[0]}}]}}).directive("uiScrollToModalComponent",["ChannelManager","UiEvents","DomService","EventManagerUtility","$document",function(ChannelManager,UiEvents,DomService,EventManagerUtility,$document){return{restrict:"A",require:"^modalContent",link:function(scope,element,attrs,modalContent){var ChannelEventManager=ChannelManager.subscribe(attrs.channel),parent=modalContent.getElement(),listeners=[];listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_SCROLL_TO,function(data){data.id===attrs.id&&DomService.scrollToElement(element,10,500,parent)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiSelectComponent",["_","ChannelManager","UiEvents","EventManagerUtility",function(_,ChannelManager,UiEvents,EventManagerUtility){return{restrict:"E",scope:{channel:"@",id:"@",value:"@",placeholder:"@",required:"@",disabled:"@",inputClass:"@"},template:'<div><select class="{[{::inputClass}]}" ng-disabled="::disabled" form-control ng-model="data" name="{[{::id}]}" ng-options="item.label for item in items" ng-required="::required" ng-change="handleChange()"><option value="" ng-if="::placeholder" ng-disabled="::required">{[{::placeholder}]}</option></select></div>',link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.items={},scope.data=null,scope.handleChange=function(){ChannelEventManager.emit(UiEvents.CHANGE_SELECT,{id:scope.id,value:scope.data})},listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,function(data){if(data.options[scope.id]){scope.items=data.options[scope.id];var selected=data.selected[scope.id];selected?selected=_.head(selected):scope.data=_.find(scope.items,["id",scope.value]),_.isEmpty(selected)&&!scope.placeholder&&(selected=_.head(scope.items)),scope.data=selected}})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiShowOnstate",["$state","$rootScope","DomService",function($state,$rootScope,DomService){return{template:'<div><div ng-if="isState"><ng-transclude/></div></div>',replace:!0,transclude:!0,restrict:"E",scope:{state:"@"},link:function(scope,element,attrs){scope.isState=null,scope.checkState=function(){scope.isState=$state.is(scope.state)},scope.checkState(),$rootScope.$on("$stateChangeSuccess",function(){scope.checkState()})}}}]),angular.module("app.ui").directive("signupLink",["authModalService","EventManager","EventManagerUtility","AuthEvents",function(authModalService,EventManager,EventManagerUtility,AuthEvents){return{template:'<a href="#" ng-click="openSignUp($event)" ng-transclude></a>',replace:!0,transclude:!0,scope:{subscribeSource:"@",subscribeSourceParams:"@"},link:function($scope){var userLoggedIn=!1,listeners=[];$scope.openSignUp=function($event){$event.preventDefault(),$event.stopPropagation(),userLoggedIn||($scope.subscribeSource&&authModalService.setSubscribeSource($scope.subscribeSource),$scope.subscribeSourceParams&&authModalService.setSubscribeSourceParams($scope.subscribeSourceParams),authModalService.openLogin())},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){userLoggedIn=user.isLoggedIn()})),$scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiSocialSharingComponent",["_","ChannelManager","UiEvents","EventManagerUtility","DataService",function(_,ChannelManager,UiEvents,EventManagerUtility,DataService){return{template:'<div><span ng-repeat="item in items track by item.trackBy" class="cursor-pointer inline-block reset-line-height" socialshare socialshare-provider="{[{::item.id}]}" socialshare-text="{{::data.title}}" socialshare-url="{[{::data.url}]}"><i class="{[{::item.icon}]}"></i></span></div>',replace:!0,restrict:"E",scope:{channel:"@",title:"@",include:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],types=[{id:"facebook",icon:"icon-facebook social-circle-sm  social-circle--facebook  color-brand-white"},{id:"twitter",icon:"icon-twitter social-circle-sm  social-circle--twitter  color-brand-white"},{id:"linkedin",icon:"icon-linkedin social-circle-sm  social-circle--linkedin  color-brand-white"},{id:"reddit",icon:"icon-reddit social-circle-sm  social-circle--reddit  color-brand-white"},{id:"rss",icon:"icon-rss social-circle-sm  social-circle--rss  color-brand-white"}],filteredTypes=DataService.filterCollectionByArray(types,"id",scope.include.split(","));scope.items=[],scope.data={},listeners.push(ChannelEventManager.on(UiEvents.INJECT_SOCIAL_META,function(data){scope.data=data;var items=_.cloneDeep(filteredTypes);DataService.addTrackBy(items,"id"),DataService.replace(scope.items,items,"id")})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiSortComponent",["ChannelManager","UiEvents","EventManagerUtility",function(ChannelManager,UiEvents,EventManagerUtility){"use strict";return{template:"<div ng-click=\"handleClick()\" class=\"cursor-pointer\"><span ng-class=\"{'color-brand-danger': status != null}\" ng-transclude></span><i class=\"inline-block icon-sort-arrow-stack  tiny-font   {[{ ::(classIconColor ? classIconColor : 'color-gray-dark') }]}\" ng-class=\"{'color-brand-danger': status != null,'icon-sort-arrow-stack': status == null,'icon-sort-arrow': status == false,'icon-sort-arrow icon-rotate-180': status == true}\"/></div>",restrict:"E",replace:!0,scope:{channel:"@",label:"@",invert:"@",key:"@",classIconColor:"@",status:"@"},transclude:!0,link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],invert="true"===scope.invert;scope.status=null,scope.handleClick=function(){null!==scope.status?scope.status=!scope.status:scope.status=!invert,ChannelEventManager.emit(UiEvents.CHANGE_SORT,{key:scope.key,order:scope.status?scope.key:"-"+scope.key})},listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_SORT,function(data){data.key!==scope.key&&(scope.status=null)})),listeners.push(ChannelEventManager.on(UiEvents.INJECT_SORT,function(data){data.key===scope.key&&(scope.status=data.status)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiSwipeRowComponent",["ChannelManager","EventManager","UiEvents","DomService","$timeout","EventManagerUtility",function(ChannelManager,EventManager,UiEvents,DomService,$timeout,EventManagerUtility){"use strict";return{template:'<div class="relative" ng-style="parentStyle"><div class="swipe-component absolute" ng-style="customStyle" ng-swipe-right="handleToggle(false)" ng-swipe-left="handleToggle(true)" ng-transclude></div></div>',restrict:"E",replace:!0,scope:{offset:"@",disableDesktop:"@"},transclude:!0,link:function(scope,element,attrs){var isEmitter=!1,listeners=[],rowElement=element[0].children[0].children[0];scope.status=!1,scope.customStyle={position:"relative"},scope.parentStyle={},scope.handleToggle=function(status){scope.status=status,status?(isEmitter=!0,scope.customStyle.left=status?(scope.offset||10)+"px":0,EventManager.emit(UiEvents.CHANGE_SWIPE,{status:status})):scope.customStyle.left="0px"},listeners.push(EventManager.onFresh(UiEvents.CHANGE_SWIPE,function(data){isEmitter||scope.handleToggle(!1),isEmitter=!1})),$timeout(function(){scope.parentStyle={height:DomService.getHeight(rowElement)+"px"},scope.customStyle={position:"absolute",left:"0px",top:"0px"}},3e3),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").component("uiSwitchButton",{template:'<div class="inline-block-xxx"><div class="c_switch-button  margin-right-xs-2" ng-class="{\'is-active\': $ctrl.componentStatus, \'is-disabled\': $ctrl.disabledState, \'animate-generic\': $ctrl.isAnimated}" ng-click="$ctrl.toggle($event)" style="vertical-align: sub;"><small class="c_switch-button__controller" ng-class="{\'is-active\': $ctrl.componentStatus, \'animate-generic\': $ctrl.isAnimated}"></small></div>'+"<span class=\"{[{ $ctrl.labelClass || 'text-label--set-3' }]}\" ng-class=\"{'transparent-third': $ctrl.disabledState,'block': $ctrl.styleStack == 'true'}\">{[{$ctrl.test}]} {[{$ctrl.componentStatus ? $ctrl.statusOnLabel : $ctrl.statusOffLabel}]}</span></div>",bindings:{channel:"@",styleStack:"@",id:"@",status:"@",passive:"@",disabled:"@",statusOnLabel:"@",statusOffLabel:"@",labelClass:"@",lazy:"@"},controller:["ChannelManager","UiEvents","EventManagerUtility",function(ChannelManager,UiEvents,EventManagerUtility){var ctrl=this,ChannelEventManager=ChannelManager.subscribe(ctrl.channel),isActive="true"!==ctrl.passive,listeners=[];ctrl.disabledState="true"===ctrl.disabled||"1"===ctrl.disabled,ctrl.isAnimated=!1,ctrl.componentStatus="true"===ctrl.status||"1"===ctrl.status,ctrl.toggle=function(event){event.stopPropagation(),event.preventDefault(),ctrl.isAnimated=!0,ctrl.disabledState||(ChannelEventManager.emit(UiEvents.CHANGE_SWITCH,{id:ctrl.id,status:!ctrl.componentStatus}),isActive&&(ctrl.componentStatus=!ctrl.componentStatus))},ctrl.$onInit=function(){ctrl.disabledState||listeners.push(ChannelEventManager.onFresh(UiEvents.INJECT_SWITCH,function(data){data.id===ctrl.id&&(ctrl.componentStatus=data.status)}))},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.ui").directive("uiRadioTab",["ChannelManager","UiEvents","$state","EventManagerUtility",function(ChannelManager,UiEvents,$state,EventManagerUtility){return{template:'<span ng-class="{\'active\': status}" ng-click="handleClick($event)" class="cursor-pointer s_horizontal-list--block__item  text-navigation--set-1" ng-transclude></span>',replace:!0,transclude:!0,restrict:"E",scope:{channel:"@",id:"@",enabled:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.status="true"===scope.enabled,scope.handleClick=function(event){ChannelEventManager.emit(UiEvents.CHANGE_TAB,{id:scope.id,status:scope.status})},listeners.push(ChannelEventManager.on(UiEvents.CHANGE_TAB,function(data){scope.status=data.id===scope.id})),scope.status&&scope.handleClick(),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiTagSearchList",["_","ChannelManager","UiEvents","EventManagerUtility","DataService",function(_,ChannelManager,UiEvents,EventManagerUtility,DataService){"use strict";return{template:'<div class="c_search-tag"><span class="c_search-tag__placeholder  text-label--set-3" ng-class={\'invisible\':!items.length}>{[{::placeholder}]}</span><span class="c_search-tag__group" ng-repeat="item in items | orderBy:\'title\' track by item.trackBy" ><strong class="c_search-tag__label  sans-serif  animate-default" ng-click="removeTag(item)">{[{item.title}]}<i class="c_search-tag__icon  icon-cancel"></i></strong></span></div>',replace:!0,restrict:"E",scope:{placeholder:"@",exclude:"@",channel:"@"},link:function(scope){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],excludeArray=scope.exclude.split(",");scope.items=[],scope.removeTag=function(item){ChannelEventManager.emit(UiEvents.REMOVE_TAG,{data:item,group:item.group},!1)},scope.handleData=function(data){var newData=DataService.flattenMultipleCollections(_.cloneDeep(data),excludeArray);DataService.addTrackBy(newData,"uniqueId"),scope.items=newData},listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_TAG,function(data){scope.handleData(data.selected)})),listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,function(data){scope.handleData(data.selected)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").value("uiTinymceConfig",{skin:"lightgray",height:500,toolbar:"undo redo bold italic alignleft aligncenter alignright bullist numlist outdent indent",statusbar:!1,elementpath:!1,insert_toolbar:"",menu:{}}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","$filter",function($rootScope,$compile,$timeout,$window,$sce,uiTinymceConfig,$filter){uiTinymceConfig=uiTinymceConfig||{};var generatedIds=0;return uiTinymceConfig.baseUrl&&(tinymce.baseURL=uiTinymceConfig.baseUrl),{require:["ngModel","^?form","^formGroup"],priority:599,link:function(scope,element,attrs,ctrls){function toggleDisable(disabled){disabled?ensureInstance():(ensureInstance(),tinyInstance&&tinyInstance.settings.readonly)}function ensureInstance(){tinyInstance||(tinyInstance=tinymce.get(attrs.id))}if($window.tinymce){var ngModel=ctrls[0];ctrls[1];ctrls[2].setField(ctrls[0],attrs.id),ngModel.$timedout=!0;var expression,tinyInstance,options={debounce:!0},updateView=function(editor){var content=editor.getContent({format:options.format}).trim();content=$sce.trustAsHtml(content);var sanitised=$filter("sanitise_html")(content.toString());editor.setContent(sanitised),ngModel.$setViewValue(sanitised),$rootScope.$$phase||scope.$digest()};attrs.$set("id","ui-tinymce-"+generatedIds++),expression={},angular.extend(expression,scope.$eval(attrs.uiTinymce));var setupOptions={setup:function(ed){ed.on("init",function(){ngModel.$render(),ngModel.$setPristine(),ngModel.$viewValue&&(ed.save(),updateView(ed),ngModel.$setTouched(),$rootScope.$$phase||scope.$digest())}),ed.on("ExecCommand change NodeChange ObjectResized",function(){}),ed.on("blur",function(){element[0].blur(),ed.save(),updateView(ed),ngModel.$setTouched(),$rootScope.$$phase||scope.$digest()}),ed.on("remove",function(){element.remove()}),uiTinymceConfig.setup&&uiTinymceConfig.setup(ed,{updateView:updateView}),expression.setup&&expression.setup(ed,{updateView:updateView})},format:expression.format||"html",selector:"#"+attrs.id};angular.extend(options,uiTinymceConfig,expression,setupOptions),$timeout(function(){options.baseURL&&(tinymce.baseURL=options.baseURL),tinymce.init(options),toggleDisable(scope.$eval(attrs.ngDisabled))}),ngModel.$formatters.unshift(function(modelValue){return modelValue?$sce.trustAsHtml(modelValue):""}),ngModel.$parsers.unshift(function(viewValue){return viewValue?$sce.getTrustedHtml(viewValue):""}),ngModel.$render=function(){ensureInstance();var viewValue=ngModel.$viewValue?$sce.getTrustedHtml(ngModel.$viewValue):"";tinyInstance&&tinyInstance.getDoc()&&(tinyInstance.setContent(viewValue),tinyInstance.fire("change"))},attrs.$observe("disabled",toggleDisable),scope.$on("$tinymce:refresh",function(e,id){var eid=attrs.id;if(angular.isUndefined(id)||id===eid){var parentElement=element.parent(),clonedElement=element.clone();clonedElement.removeAttr("id"),clonedElement.removeAttr("style"),clonedElement.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,eid),parentElement.append($compile(clonedElement)(scope))}}),scope.$on("$destroy",function(){ensureInstance(),tinyInstance&&(tinyInstance.remove(),tinyInstance=null)})}}}}]),angular.module("app.ui").directive("uiToggleComponent",["ChannelManager","UiEvents","EventManagerUtility","$q","InputUtil",function(ChannelManager,UiEvents,EventManagerUtility,$q,InputUtil){return{restrict:"E",template:'<div><button class="btn btn-xs btn-outline-primary margin-right-xs-1 margin-bottom-xs-2" ng-disabled="!isEnabled" ng-class="{\'off\':!valueBool}" ng-click="handleSelect($event)"><span ng-class="padding-horizontal-xs-(valueBool ? 1 : 3)">{[{::label}]} <span ng-if="counter !== false">({[{counter}]}<span ng-if="limit">/{[{::limit}]}</span>)</span> <i ng-if="valueBool" class="cursor-pointer icon-tick"></i></span></button></div>',replace:!0,transclude:!0,scope:{id:"@",value:"@",label:"@",max:"@",disabled:"@",channel:"@",bistatic:"@"},link:function(scope,element,attrs){var listeners=[],isBistatic="true"===scope.bistatic,ChannelEventManager=ChannelManager.subscribe(scope.channel);scope.valueBool=InputUtil.toBoolean(scope.valueBool),scope.limit=scope.max,scope.isEnabled="true"!==scope.disabled,scope.counter=!1,scope.handleSelect=function(event){event&&(event.preventDefault(),event.stopPropagation()),scope.isEnabled&&(scope.valueBool=!isBistatic||!scope.valueBool,ChannelEventManager.emit(UiEvents.CHANGE_TOGGLE,{id:scope.id,value:scope.valueBool}))},listeners.push(ChannelEventManager.on(UiEvents.INJECT_TOGGLE,function(data){isBistatic?data.id!==scope.id&&(scope.valueBool=!1):scope.valueBool=data.id===scope.id})),listeners.push(ChannelEventManager.onFresh(UiEvents.INJECT_TOGGLE_COUNT,function(data){scope.counter=data.counters[scope.id]||0})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").directive("uiTypeAheadComponent",["_","ChannelManager","UiEvents","EventManagerUtility","$q","BootstrapVersion",function(_,ChannelManager,UiEvents,EventManagerUtility,$q,BootstrapVersion){return{restrict:"E",template:'<div class="c_profile-search"><input ng-disabled="{[{::disabled}]}"       class="{[{::inputClass}]}"       autocomplete="off"       type="text"       name="{[{::id}]}"       form-control       ng-model="queryModel"       placeholder="{[{::placeholder}]}"       ~typeahead="item.title for item in getSuggestions($viewValue)"       typeahead-focus-first="true"        typeahead-editable="false"       typeahead-select-on-blur="true"       typeahead-on-select="handleSelect($item, $model, $label, $event)"       typeahead-wait-ms="150"        typeahead-min-length="2"        ng-required="::isRequired"       ng-minlenght="2"        ng-blur="handleBlur($event)"/></div>'.replace(/~/g,BootstrapVersion.getNamespace()),replace:!0,require:"ngModel",scope:{inputClass:"@",id:"@",channel:"@",placeholder:"@",value:"@",editable:"@",disabled:"@",required:"@",acceptNull:"@"},link:function(scope,element,attrs,ngModel){var listeners=[],nullValue=scope.acceptNull?null:0,ChannelEventManager=ChannelManager.subscribe(scope.channel),resultPromise=null,currentQuery="",selectedItem={id:nullValue,title:scope.value||""};scope.items=[],scope.queryModel=scope.value||"",scope.isEditable="true"===scope.editable,scope.ready=!0,scope.isRequired="false"!==scope.required,scope.getSuggestions=function(query){return ChannelEventManager.emit(UiEvents.QUERY_TYPEAHEAD,{id:scope.id,query:query}),currentQuery=query,resultPromise&&resultPromise.reject(),resultPromise=$q.defer(),resultPromise.promise},scope.handleBlur=function(){selectedItem.id===nullValue&&ngModel.$setViewValue({id:nullValue,title:currentQuery})},scope.handleSelect=function(item,model,label,event){_.isEmpty(item)||(selectedItem=item,ngModel.$setViewValue(item),ChannelEventManager.emit(UiEvents.CHANGE_TYPEAHEAD,{id:scope.id,selected:item}))},listeners.push(ChannelEventManager.onFresh(UiEvents.INJECT_TYPEAHEAD,function(data){data.id===scope.id&&resultPromise&&(scope.isEditable&&data.results.unshift({id:nullValue,title:currentQuery}),_.isEmpty(data)?resultPromise.reject():resultPromise.resolve(data.results))})),listeners.push(ChannelEventManager.onFresh(UiEvents.RESET_TYPEAHEAD,function(data){data.id===scope.id&&(currentQuery="",scope.queryModel="",scope.handleBlur())})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.ui").component("uiTypeAheadV2",{template:'<div class="{[{ ::($ctrl.wrapperClass || \'ui-typeahead\') }]}">   <input form-control       type="text"       ng-model="$ctrl.value"       ng-required="::($ctrl.required)"       ng-disabled="$ctrl.disabled"       class="{[{ ::($ctrl.inputClass) }]}"       name="{[{ ::($ctrl.name) }]}"       placeholder="{[{ ::($ctrl.placeholder) }]}"       typeahead="item.title for item in $ctrl.getDropdownSuggestions($viewValue)"       typeahead-focus-first="true"        typeahead-editable="{[{ ::($ctrl.isEditable) }]}"       typeahead-select-on-blur="true"       typeahead-on-select="$ctrl.handleSelect($item, $model, $label, $event)"       typeahead-wait-ms="250"        typeahead-min-length="2"        ng-minlenght="2"        autocomplete="off"       ng-blur="$ctrl.handleBlur($event)"    /></div>',bindings:{value:"=ngModel",onChange:"&",getSuggestions:"&",editable:"@",disabled:"@",name:"@",acceptNull:"@",inputClass:"@",wrapperClass:"@",placeholder:"@",required:"@"},controller:["_","UiEvents","InputUtil","EventManagerUtility","$log",function(_,UiEvents,InputUtil,EventManagerUtility,$log){var nullValue,ctrl=this,listeners=[];ctrl.$postLink=function(){ctrl.acceptNull=ctrl.acceptNull||!0,ctrl.isEditable=""===ctrl.editable||InputUtil.toBoolean(ctrl.editable),nullValue=InputUtil.toBoolean(ctrl.acceptNull)?null:0},ctrl.handleBlur=function(){_.isObject(ctrl.value)||(ctrl.value=nullValue)};var buildSuggestions=function(queryValue,suggestions){var foundSuggestion=!1;return suggestions=_.map(suggestions,function(item){return foundSuggestion||_.toLower(item.title)!==_.toLower(queryValue)||(foundSuggestion=!0),item})||[],ctrl.isEditable&&!foundSuggestion&&suggestions.unshift({id:null,title:queryValue}),suggestions};ctrl.getDropdownSuggestions=function(queryValue){queryValue=_.replace(_.deburr(queryValue),/\s+/g," ");var suggestions=ctrl.getSuggestions({$event:{queryValue:queryValue}})||[];return _.isArray(suggestions)?($log.debug("uiTypeAheadV2::getDropdownSuggestions::",suggestions),buildSuggestions(queryValue,suggestions)):suggestions.then(function(response){return buildSuggestions(queryValue,response.data||response)})},ctrl.handleSelect=function(item,model,label,event){$log.debug("uiTypeAheadV2::handleSelect::",item),ctrl.value=item,_.isFunction(ctrl.onChange)&&ctrl.onChange({value:ctrl.value})},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),function(){function uiViewContainerDirective($state,$rootScope,DomService,uiStream){function link(scope,element){function repaint(){scope.customStyle={height:DomService.getHeight()-DomService.getTop(element[0])+"px"}}function changeStatus(){scope.state&&(scope.status=$state.is(scope.state))}var teardown=null,windowResizeListener=null,initialRepaintListener=null;scope.status=void 0===scope.state,scope.offset=DomService.getTop(element[0]),teardown=$rootScope.$on("$stateChangeSuccess",changeStatus),changeStatus(),repaint(),windowResizeListener=uiStream.WINDOW_RESIZE.subscribe(repaint),initialRepaintListener=uiStream.INITIAL_REPAINT.subscribe(repaint),scope.$on("$destroy",function(){teardown(),initialRepaintListener&&initialRepaintListener.dispose(),windowResizeListener&&windowResizeListener.dispose()})}return{template:'<div class="s_hide-view" ng-style="customStyle" ng-class="{\'is-active\': status}" ng-transclude></div>',replace:!0,transclude:!0,restrict:"E",scope:{state:"@",offset:"@"},link:link}}uiViewContainerDirective.$inject=["$state","$rootScope","DomService","uiStream"],angular.module("app.ui").directive("uiViewContainer",uiViewContainerDirective)}(),angular.module("app.ui").filter("currencySymbol",function(){return function(text){return{USD:"$",GBP:"",AUD:"$",EUR:"",CAD:"$",MIXED:"~"}[text]}}),angular.module("app.ui").factory("BootstrapVersionFactory",function(){function Factory(namespace){this.getNamespace=function(){return namespace}}return Factory}).provider("BootstrapVersion",function(){"use strict";var NAMESPACE="";this.setNamespace=function(namespace){NAMESPACE=namespace},this.$get=["BootstrapVersionFactory",function(BootstrapVersionFactory){return new BootstrapVersionFactory(NAMESPACE)}]}),angular.module("app.ui").factory("UiModalInterceptorFactory",["_","$q","UiModalService",function(_,$q,UiModalService){"use strict";function ModalInterceptor(config){var modalTemplates=config;this.handle=function(templateId,data){var deferred=$q.defer();return _.includes(_.keys(modalTemplates),templateId)?UiModalService.openModal(modalTemplates[templateId],{id:data.id,item:data}):(deferred.reject(),deferred.promise)}}return ModalInterceptor}]),function(){"use strict";function modalService($modal){function open(modalOptions,closeCurrent){return openedInstance&&closeCurrent&&closeCurrentInstance(),openNewModal(modalOptions)}function modalClosed(){openedInstance=null}function isOpen(){return!!openedInstance}function closeCurrentInstance(){openedInstance.dismiss({forceClose:!0})}function openNewModal(options){return openedInstance=$modal.open(options),openedInstance.result.finally(modalClosed),openedInstance}var openedInstance=null;return{open:open,isOpen:isOpen}}modalService.$inject=["$modal"],angular.module("app.ui").factory("modalService",modalService)}(),angular.module("app.ui").service("UiTemplateService",["_","$injector",function(_,$injector){"use strict";this.getTemplate=function(templateString){var parts=templateString.split("."),toInject=_.head(parts),templateUrl=_.tail(parts);return $injector.get(toInject)[templateUrl]}}]),angular.module("app.ui").service("UiModalService",["_","UiEvents","modalService","EventManager","AuthEvents","AgentService",function(_,UiEvents,modalService,EventManager,AuthEvents,AgentService){"use strict";var modalInstance=null;this.openModal=function(config,resolve,returnInstance,closeCurrent){return modalInstance=modalService.open({templateUrl:config.template,controller:config.controller,size:config.size||"md",backdrop:!_.isBoolean(config.backdrop)&&"static"!=config.backdrop||config.backdrop,backdropClass:config.backdropClass||"modal-backdrop--opaque",keyboard:!_.isBoolean(config.keyboard)||config.keyboard,animation:!AgentService.isIE(),ignoreBackdropClick:config.ignoreBackdropClick||!1,windowClass:config.css||"",resolve:{modalParams:_.assign(resolve,{modalInstance:function(){return modalInstance}})}},closeCurrent||!0),returnInstance?modalInstance:modalInstance.result}}]),function(){"use strict";function PageHeaderController(_,authStream){function $onInit(){$ctrl.isLoaded=!1,$ctrl.state=_.toUpper($ctrl.pageHeader),$ctrl.pageTitle=_.isUndefined($ctrl.pageTitle)?"":$ctrl.pageTitle,authListener=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function $onDestroy(){authListener.dispose()}function onUserChanged(user){$ctrl.isLoaded=!0,$ctrl.isMember=user.hasMembership(),$ctrl.isLoggedIn=user.isLoggedIn()}var authListener,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var bofPageHeaderComponent={bindings:{pageHeader:"@",pageTitle:"@"},templateUrl:"/assets-access-layer/js/shared/UI/components/bof-page-header.html",controller:PageHeaderController};angular.module("app.ui").component("bofPageHeader",bofPageHeaderComponent)}(),function(){"use strict";function HoverTooltipController(EventManager,UiEvents,AgentService,TrackerService){function $onInit(){$ctrl.status=!1,sub1=EventManager.onFresh(UiEvents.WINDOW_CLICK,closeTooltip)}function trackEvent(){$ctrl.trackOnOpenDomain&&TrackerService.track($ctrl.trackOnOpenDomain,$ctrl.trackOnOpenEvent,{Label:$ctrl.trackOnOpenLabel,Cat:$ctrl.trackOnOpenCat,Page:$ctrl.trackOnOpenPage})}function handleMouseenter(){$ctrl.status=!0,trackEvent()}function closeTooltip(){$ctrl.status=!1}function handleClick(e){AgentService.isMobile()&&(e.preventDefault(),e.stopPropagation(),$ctrl.status=!$ctrl.status,$ctrl.status&&trackEvent())}function $onDestroy(){sub1.unsubscribe()}var sub1,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleMouseleave=closeTooltip,$ctrl.handleMouseenter=handleMouseenter,$ctrl.handleClick=handleClick}HoverTooltipController.$inject=["EventManager","UiEvents","AgentService","TrackerService"];var hoverTooltip={bindings:{tooltipClass:"@",html:"@",trigger:"@",index:"@",trackOnOpenDomain:"@",trackOnOpenEvent:"@",trackOnOpenLabel:"@",trackOnOpenCat:"@",trackOnOpenPage:"@"},transclude:!0,templateUrl:"/assets-access-layer/js/shared/UI/templates/hover-tooltip.template.html",controller:HoverTooltipController};angular.module("app.ui").component("hoverTooltip",hoverTooltip)}(),function(){"use strict";function IfUrlController(){function $onInit(){locationUrl=location.pathname,$ctrl.matchReg?match=locationUrl.match($ctrl.matchReg):$ctrl.startsWith?match=locationUrl.substr(0,$ctrl.startsWith.length)===$ctrl.startsWith:$ctrl.includes&&(match=-1!==locationUrl.indexOf($ctrl.includes,0)),match&&($ctrl.display=!0)}function $onDestroy(){}var locationUrl,$ctrl=this,match=!1;$ctrl.display=!1,$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var ifUrl={template:'<div ng-if="$ctrl.display"><ng-transclude></ng-transclude></div>',bindings:{startsWith:"@",includes:"@",matchReg:"@"},transclude:!0,controller:IfUrlController};angular.module("app.ui").component("ifUrl",ifUrl)}(),function(){"use strict";function PromoFooterController(_,$timeout,storageService,StorageKeys,EventManagerUtility,EventManager,ChannelManager,NewsletterEvents,UiEvents){function $onInit(){$ctrl.status=!1,openDelay=$ctrl.openDelay?_.parseInt($ctrl.openDelay):0,$ctrl.dismissStorageKey&&(dismissedStorageKey=StorageKeys[$ctrl.dismissStorageKey]),listeners.push(EventManager.on(NewsletterEvents.SUBSCRIBE_MODAL_OPEN,function(){newsletterPopupOpened=!0})),listeners.push(ChannelEventManager.on(UiEvents.CHANGE_IN_VIEW,function(res){res.data&&!0===res.data.status&&"promoFooter"===res.id&&openModal()}))}function handleClose(){$ctrl.status=!1,storageService.set(dismissedStorageKey,1)}function openModal(){newsletterPopupOpened||storageService.has(dismissedStorageKey)||$timeout(function(){$ctrl.status=!newsletterPopupOpened},openDelay)}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}var openDelay,$ctrl=this,listeners=[],dismissedStorageKey=StorageKeys.RANKINGS_PROMO_FOOTER_DISMISSED,newsletterPopupOpened=!1,ChannelEventManager=ChannelManager.subscribe($ctrl.channel);$ctrl.$onInit=$onInit,$ctrl.handleClose=handleClose,$ctrl.$onDestroy=$onDestroy}PromoFooterController.$inject=["_","$timeout","storageService","StorageKeys","EventManagerUtility","EventManager","ChannelManager","NewsletterEvents","UiEvents"];var promoFooter={templateUrl:function($attrs,UiTemplateService){return UiTemplateService.getTemplate($attrs.template)},bindings:{channel:"@",dismissStorageKey:"@",openDelay:"@"},transclude:!0,controller:PromoFooterController};angular.module("app.ui").component("promoFooter",promoFooter)}(),function(){"use strict";function PromoteButtonController(ChannelManager,UiEvents,EventManagerUtility,InputUtil){function $onInit(){$ctrl.id=$ctrl.value,$ctrl.status=$ctrl.checked=InputUtil.toBoolean($ctrl.isChecked),$ctrl.enabled=!InputUtil.toBoolean($ctrl.isDisabled)}function handleSelect(event){$ctrl.status===$ctrl.checked&&(event&&(event.preventDefault(),event.stopPropagation()),$ctrl.enabled&&($ctrl.checked=!$ctrl.checked,ChannelEventManager.emit(UiEvents.CHANGE_PROMOTE,{id:$ctrl.id,name:$ctrl.name,checked:$ctrl.checked})))}var $ctrl=this,ChannelEventManager=ChannelManager.subscribe($ctrl.channel);$ctrl.$onInit=$onInit,$ctrl.handleSelect=handleSelect}var promoteButtonComponent={bindings:{value:"@",name:"@",title:"@",isDisabled:"@",isChecked:"@",channel:"@"},templateUrl:"/assets-access-layer/js/shared/UI/components/promote-button.html",controller:PromoteButtonController};angular.module("app.ui").component("promoteButton",promoteButtonComponent)}(),function(){"use strict";function ScrollTopController($window,$evalAsync){function $onInit(){var onScrollStream=Rx.Observable.fromEvent(document,"scroll").map(function(){return $window.scrollY>=MIN_VISIBLE_TRIGGER_HEIGHT}).distinctUntilChanged();subscription=onScrollStream.subscribe(showHide)}function showHide(showOrHide){$evalAsync(function(){$ctrl.show=showOrHide})}function $onDestroy(){subscription.dispose()}var subscription,$ctrl=this;$ctrl.show=!1,$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var MIN_VISIBLE_TRIGGER_HEIGHT=800,scrollTopComponent={template:'<a   href="#top"   class="back-to-top animate-default ng-show"   ng-class="{\'ng-show-active\': $ctrl.show }"   du-scrollspy   du-smooth-scroll   offset="90"><i class="icon icon-slider"></i></a>',bindings:{socialTitle:"@"},controller:ScrollTopController};angular.module("app.auth").component("scrollTop",scrollTopComponent)}(),function(){"use strict";function TaglistController(){function $onInit(){}function $onDestroy(){}var $ctrl=this;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var taglistComponent={template:'<div class="c_search-tag"><span ng-repeat="item in $ctrl.model">   <strong class="c_search-tag__label  sans-serif  animate-default">{[{ item.title }]}       <i ng-if="$ctrl.enableRemoveItem" class="c_search-tag__icon  icon-cancel"           ng-click="$ctrl.onRemoveItem({$item: item})"></i>   </strong></span></div>',bindings:{model:"<ngModel",enableRemoveItem:"<",onRemoveItem:"&"},controller:TaglistController};angular.module("app.ui").component("taglist",taglistComponent)}(),function(){"use strict";function VideoVolumeController(DomService){function $onInit(){$ctrl.video=DomService.getElementById($ctrl.videoId)[0],$ctrl.video.muted=!1,$ctrl.enabled=!1,$ctrl.video.addEventListener("playing",onReady)}function $onDestroy(){$ctrl.video.removeEventListener("playing")}
function onReady(){$ctrl.enabled=!0}function handleClick(e){$ctrl.enabled&&(e.preventDefault(),e.stopPropagation(),$ctrl.video.muted=!$ctrl.video.muted)}var $ctrl=this;$ctrl.handleClick=handleClick,$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var videoVolume={template:'<a class="voi-lp__heroes-volume-controls__link" ng-show="$ctrl.enabled" ng-click="$ctrl.handleClick($event)"><i ng-class="$ctrl.video.muted?\'icon-volume-off\':\'icon-volume-up\'"></i></a>',bindings:{videoId:"@"},transclude:!0,controller:VideoVolumeController};angular.module("app.ui").component("videoVolume",videoVolume)}(),angular.module("app.ui").constant("LayoutBreakpoints",{LAYOUTS:["SM","MD","LG"],SM:729,MD:730,LG:1024});angular.module("app.ui").constant("UiTemplates",{EDIT_INLINE_DEFAULT:"/templates/Spa/UI:edit_inline_default",EDIT_INLINE_SEARCH:"/templates/Spa/UI:edit_inline_search",EDIT_INLINE_SEARCH_MOBILE:"/assets-access-layer/js/shared/UI/templates/edit-inline-search-mobile.html",FILTER:"/templates/Spa/UI:filter",OPEN_FEEDBACK_MODAL:{controller:"ShareGenericController",template:"/templates/Message/feedback_form"},ACCORDION:"/templates/Accounts/accordion",SORT_POPOVER_COMPONENT:"/templates/Education/UI:sort_popover",SORT_POPOVER_COMPONENT_MOBILE:"/templates/Education/UI:sort_popover_mobile"}),function(){"use strict";function MobileCarouselController(AgentService,TrackerService,ARTICLE_EVENT){function setActiveSlide(slideIndex,isActive,isAd){if(isActive&&activeSlideIndex!==slideIndex){!$ctrl.adDisplayed&&isAd&&($ctrl.adDisplayed=!0),activeSlideIndex=slideIndex;var slideKey="slide"+activeSlideIndex;slideImpressions.hasOwnProperty(slideKey)||(slideImpressions[slideKey]=0),slideImpressions[slideKey]++,slideImpressions[slideKey]<10&&TrackerService.track(ARTICLE_EVENT.DOMAIN,"Article.Marketing",{Page:"HomePage",Action:"impression",Label:"Carousel.MainColumn.Manual.MobileAutoScroll.Article["+activeSlideIndex+"]"})}}function trackSwipeLeft(){trackSwipe("Left")}function trackSwipeRight(){trackSwipe("Right")}function trackSwipe(direction){$ctrl.swiped=!0,TrackerService.track(ARTICLE_EVENT.DOMAIN,"Article.Marketing",{Page:"HomePage",Action:"swipe",Label:"Carousel.MainColumn.Manual.MobileAutoScroll."+direction})}var $ctrl=this,activeSlideIndex=-1,slideImpressions={};$ctrl.swiped=!1,$ctrl.isMobile=AgentService.isMobilePhone(),$ctrl.adDisplayed=!1,$ctrl.setActiveSlide=setActiveSlide,$ctrl.trackSwipeLeft=trackSwipeLeft,$ctrl.trackSwipeRight=trackSwipeRight}MobileCarouselController.$inject=["AgentService","TrackerService","ARTICLE_EVENT"],angular.module("app.ui").controller("MobileCarouselController",MobileCarouselController)}(),function(){"use strict";function ifScreensize(_,LayoutBreakpoints,uiStream,ngIfDirective,$parse){function link($scope,$element,$attr){function handleViewportSizeChange(vs){viewportSize=vs,ifEvaluator=initialNgIf?function(){return $scope.$eval(initialNgIf)&&shouldDisplay(viewportSize)}:function(){return shouldDisplay(viewportSize)}}function shouldDisplay(viewportSize){return-1!==_.indexOf(sizes,viewportSize)}var sizes=[],uiListener=null,ifEvaluator=null,viewportSize=null,initialNgIf=$attr.ngIf;!function(inputSizes){var expression;try{expression=$parse(inputSizes)()}catch(err){}expression&&_.isArray(expression)||(expression=inputSizes.split(",")),(sizes=_.intersection(expression,LayoutBreakpoints.LAYOUTS))&&sizes.length||(sizes=LayoutBreakpoints.LAYOUTS)}($attr.ifScreensize),uiListener=uiStream.VIEWPORT_SIZE_CHANGE.subscribe(handleViewportSizeChange),$attr.ngIf=ifEvaluator,ngIf.link.apply(ngIf,arguments),$scope.$on("$destroy",function(){uiListener.dispose()})}var ngIf=ngIfDirective[0];return{transclude:ngIf.transclude,priority:ngIf.priority-1,terminal:ngIf.terminal,restrict:ngIf.restrict,link:link}}ifScreensize.$inject=["_","LayoutBreakpoints","uiStream","ngIfDirective","$parse"],angular.module("app.ui").directive("ifScreensize",ifScreensize)}(),function(){"use strict";function loaderOverlayDirective(uiStream){function link($scope){function handleDisplayLoaderOverlay(data){$scope.displayed=data.display,$scope.displayed||uiStream.INITIAL_REPAINT.onNext({})}var uiListener;!function(){$scope.displayed=!1,uiListener=uiStream.DISPLAY_LOADER_OVERLAY.subscribe(handleDisplayLoaderOverlay)}(),$scope.$on("$destroy",function(){uiListener.dispose()})}return{template:'<div class="loader-overlay" ng-if="displayed"><i class="icon-spin5 large-font animate-spin"></i></div>',replace:!0,restrict:"E",link:link}}loaderOverlayDirective.$inject=["uiStream"],angular.module("app.ui").directive("loaderOverlay",loaderOverlayDirective)}(),function(){"use strict";function videoLoadCondition(){function link(scope){if(!scope.loadMinWidth||window.innerWidth>=scope.loadMinWidth){var video=document.querySelector(scope.loadSelector);document.querySelectorAll(scope.loadSelector+" source").forEach(function(src){src.setAttribute("src",src.getAttribute("data-src"))}),video.load()}}return{link:link,restrict:"A",scope:{loadMinWidth:"@?",loadSelector:"@"}}}angular.module("app.ui").directive("videoLoadCondition",videoLoadCondition)}(),function(){"use strict";function formatCurrencyFilter(_,$filter){function filter(value,currency){var format=currencyFormat[currency]||":value "+currency;return _.replace(format,":value",numberFilter(value,2))}var numberFilter=$filter("number"),currencyFormat={USD:"$:value",GBP:":value",AUD:"$:value",EUR:":value",CAD:"$:value"};return filter}formatCurrencyFilter.$inject=["_","$filter"],angular.module("app.ui").filter("formatCurrency",formatCurrencyFilter)}(),function(){"use strict";function uiStream(Stream,LazyStream,EventManager,UiEvents,$window,LayoutBreakpoints){function onViewportChange(){var w=$window.innerWidth;return w<=LayoutBreakpoints.SM?"SM":w>=LayoutBreakpoints.MD&&w<LayoutBreakpoints.LG?"MD":$window.innerWidth>=LayoutBreakpoints.LG&&"LG"}var REDIRECT=new LazyStream,TOOLTIP=new LazyStream,DISPLAY_LOADER_OVERLAY=new LazyStream,BLUR_COMPONENT=new Stream,WINDOW_CLICK=EventManager.get(UiEvents.WINDOW_CLICK).getStream(),WINDOW_RESIZE=EventManager.get(UiEvents.WINDOW_RESIZE).getLazyStream();return{REDIRECT:REDIRECT,DISPLAY_LOADER_OVERLAY:DISPLAY_LOADER_OVERLAY,BLUR_COMPONENT:BLUR_COMPONENT,WINDOW_CLICK:WINDOW_CLICK,WINDOW_RESIZE:WINDOW_RESIZE,VIEWPORT_SIZE_CHANGE:WINDOW_RESIZE.map(onViewportChange),WINDOW_SCROLL:EventManager.get(UiEvents.WINDOW_SCROLL).getSubject(),INITIAL_REPAINT:EventManager.get(UiEvents.INITIAL_REPAINT).getSubject(),TOOLTIP:TOOLTIP}}uiStream.$inject=["Stream","LazyStream","EventManager","UiEvents","$window","LayoutBreakpoints"],angular.module("app.ui").factory("uiStream",uiStream)}(),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/datepicker/datepicker.html","template/datepicker/day.html","template/datepicker/month.html","template/datepicker/popup.html","template/datepicker/year.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-popup.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/tooltip/tooltip-template-popup.html","template/popover/popover-template.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/timepicker/timepicker.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion-group.html",'<div class="panel panel-default">\n  <div class="panel-heading">\n    <h4 class="panel-title">\n      <a href="#" tabindex="0" class="accordion-toggle" ng-click="$event.preventDefault(); toggleOpen()" accordion-transclude="heading"><span ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></a>\n    </h4>\n  </div>\n  <div class="panel-collapse collapse" collapse="!isOpen">\n\t  <div class="panel-body" ng-transclude></div>\n  </div>\n</div>\n')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion.html",'<div class="panel-group" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/alert/alert.html",'<div class="alert" ng-class="[\'alert-\' + (type || \'warning\'), closeable ? \'alert-dismissible\' : null]" role="alert">\n    <button ng-show="closeable" type="button" class="close" ng-click="close($event)">\n        <span aria-hidden="true">&times;</span>\n        <span class="sr-only">Close</span>\n    </button>\n    <div ng-transclude></div>\n</div>\n')}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides | orderBy:indexOfSlide track by $index" indicator-index={[{$index}]} ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="icon-slider icon-rotate-180"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="icon-slider"></span></a>\n</div>\n'),$templateCache.put("template/carousel/carousel-mobile.html",'<div>    <div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev(); pause();" ng-swipe-left="next(); pause();">       <div class="carousel-inner" ng-transclude></div>   </div>   <ol class="carousel-indicators" ng-show="slides.length > 1">       <li ng-repeat="slide in slides | orderBy:indexOfSlide track by $index" indicator-index={[{$index}]} ng-class="{ active: isActive(slide) }" ng-click="select(slide)" dummy="{{ slide.actual.cb($index + 1, isActive(slide), slide.actual.isAd) }}"></li>   </ol></div>')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/slide.html",'<div ng-class="{\n    \'active\': active\n  }" class="item text-center" ng-transclude></div>\n')}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)">\n  <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n  <monthpicker ng-switch-when="month" tabindex="0"></monthpicker>\n  <yearpicker ng-switch-when="year" tabindex="0"></yearpicker>\n</div>')}]),angular.module("template/datepicker/day.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/day.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="inline-block icon icon-slider icon-rotate-180"></i></button></th>\n      <th colspan="{{::5 + showWeeks}}"><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="inline-block icon icon-slider"></i></button></th>\n    </tr>\n    <tr>\n      <th ng-if="showWeeks" class="text-center"></th>\n      <th ng-repeat="label in ::labels track by $index" class="text-center"><small aria-label="{{::label.full}}" class="sans-serif">{{::label.abbr}}</small></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-if="showWeeks" class="text-center h6"><span>{{ weekNumbers[$index] }}</span></td>\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}" ng-class="::dt.customClass">\n        <button type="button" style="min-width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/month.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/month.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="inline-block icon icon-slider icon-rotate-180"></i></button></th>\n      <th><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="inline-block icon icon-slider"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}" ng-class="::dt.customClass">\n        <button type="button" style="min-width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/popup.html",'<ul class="dropdown-menu" ng-if="isOpen" style="display: block" ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()">\n\t<li ng-transclude></li>\n\t<li ng-if="showButtonBar" style="padding:10px 9px 2px">\n\t\t<span class="btn-group pull-left">\n\t\t\t<button type="button" class="btn btn-default btn-sm" ng-click="select(\'today\')">{{ getText(\'current\') }}</button>\n\t\t\t<button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>\n\t\t</span>\n\t\t<button type="button" class="btn btn-default btn-sm pull-right" ng-click="close()">{{ getText(\'close\') }}</button>\n\t</li>\n</ul>\n')}]),angular.module("template/datepicker/year.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/year.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="inline-block icon icon-slider icon-rotate-180"></i></button></th>\n      <th colspan="3"><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="inline-block icon icon-slider"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}">\n        <button type="button" style="min-width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/backdrop.html",'<div class="modal-backdrop"\n     modal-animation-class="fade"\n     modal-in-class="in"\n     ng-style="{\'z-index\': 1040 + (index && 1 || 0) + index*10}"\n></div>\n')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/window.html",'<div modal-render="{{$isRendered}}" tabindex="-1" role="dialog" class="modal"\n    modal-animation-class="fade"\n    modal-in-class="in"\n\tng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog" ng-class="size ? \'modal-\' + size : \'\'"><div class="modal-content" modal-transclude></div></div>\n</div>\n')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pager.html",'<ul class="pager">\n  <li ng-class="{disabled: noPrevious(), previous: align}"><a href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext(), next: align}"><a href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a></li>\n</ul>')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-if="::boundaryLinks" ng-class="{disabled: noPrevious()||ngDisabled}"><a class="text-label" href ng-click="selectPage(1, $event)">{{::getText(\'first\')}}</a></li>\n  <li ng-if="::directionLinks" ng-class="{disabled: noPrevious()||ngDisabled}"><a class="text-label" href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}"><a href ng-click="selectPage(page.number, $event)" class="text-label">{{page.text}}</a></li>\n  <li ng-if="::directionLinks" ng-class="{disabled: noNext()||ngDisabled}"><a class="text-label" href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a></li>\n  <li ng-if="::boundaryLinks" ng-class="{disabled: noNext()||ngDisabled}"><a href class="text-label" ng-click="selectPage(totalPages, $event)">{{::getText(\'last\')}}</a></li>\n</ul>\n')}]),angular.module("template/tooltip/tooltip-html-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind-html="contentExp()"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-template-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-template-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner"\n    tooltip-template-transclude="contentExp()"\n    tooltip-template-transclude-scope="originScope()"></div>\n</div>\n')}]),angular.module("template/popover/popover-html.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover-html.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content" ng-bind-html="contentExp()"></div>\n  </div>\n</div>\n')}]),angular.module("template/popover/popover-template.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover-template.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content"\n        tooltip-template-transclude="contentExp()"\n        tooltip-template-transclude-scope="originScope()"></div>\n  </div>\n</div>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/bar.html",'<div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: (percent < 100 ? percent : 100) + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>\n')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progress.html",'<div class="progress" ng-transclude></div>')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progressbar.html",'<div class="progress">\n  <div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: (percent < 100 ? percent : 100) + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>\n</div>\n')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rating/rating.html",'<span ng-mouseleave="reset()" ng-keydown="onKeydown($event)" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="{{range.length}}" aria-valuenow="{{value}}">\n    <i ng-repeat="r in range track by $index" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="glyphicon" ng-class="$index < value && (r.stateOn || \'glyphicon-star\') || (r.stateOff || \'glyphicon-star-empty\')">\n        <span class="sr-only">({{ $index < value ? \'*\' : \' \' }})</span>\n    </i>\n</span>')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tab.html",'<li ng-class="{active: active, disabled: disabled}">\n  <a href="#" ng-click="$event.preventDefault(); select()" tab-heading-transclude>{{heading}}</a>\n</li>\n')}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tabset.html",'<div>\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="tab-content">\n    <div class="tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/timepicker/timepicker.html",'<table>\n  <tbody>\n    <tr class="text-center" ng-show="::showSpinners">\n      <td><a ng-click="incrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n      <td>&nbsp;</td>\n      <td><a ng-click="incrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n      <td ng-show="showMeridian"></td>\n    </tr>\n    <tr>\n      <td class="form-group" ng-class="{\'has-error\': invalidHours}">\n        <input style="width:50px;" type="text" ng-model="hours" ng-change="updateHours()" class="form-control text-center" ng-readonly="::readonlyInput" maxlength="2">\n      </td>\n      <td>:</td>\n      <td class="form-group" ng-class="{\'has-error\': invalidMinutes}">\n        <input style="width:50px;" type="text" ng-model="minutes" ng-change="updateMinutes()" class="form-control text-center" ng-readonly="::readonlyInput" maxlength="2">\n      </td>\n      <td ng-show="showMeridian"><button type="button" class="btn btn-default text-center" ng-click="toggleMeridian()">{{meridian}}</button></td>\n    </tr>\n    <tr class="text-center" ng-show="::showSpinners">\n      <td><a ng-click="decrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n      <td>&nbsp;</td>\n      <td><a ng-click="decrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n      <td ng-show="showMeridian"></td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-match.html",'<a href tabindex="-1" ng-bind-html="match.label | typeaheadHighlight:query "></a>\n')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-show="isOpen() && !moveInProgress" ng-style="{top: position().top+\'px\', left: position().left+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">\n    <li ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{::match.id}}">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>\n')}]),angular.module("app.ratelimit").component("rateLimitNotification",{template:'<div ng-show="$ctrl.isVisible" class="navbar-default navbar rate-limit-notification text-center small-font background-brand-danger-flashy color-brand-white"><span class="rate-limit-notification-info inline-block sans-serif">You have exceeded the allowed number of requests. Please try again in {[{ $ctrl.duration }]}.</span><span class="rate-limit-notification-close pull-right hover-keep-color inherit-color" ng-click="$ctrl.closeNotification()"><i class="rate-limit-notification-close__icon icon-close cursor-pointer" aria-hidden="true"></i></span></div>',controller:["_","moment","EventManagerUtility","RateLimitStream",function(_,moment,EventManagerUtility,RateLimitStream){"use strict";var ctrl=this,listeners=[];ctrl.isVisible=!1,listeners.push(RateLimitStream.RATE_LIMIT_STREAM.subscribe(function(data){var durationConverted=_.ceil((data.retry_after?data.retry_after:120)/60);ctrl.duration=moment.duration(durationConverted,"minutes").humanize(),ctrl.isVisible=!0})),ctrl.closeNotification=function(){ctrl.isVisible=!1},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.ratelimit").factory("RateLimitInterceptor",["_","$q","RateLimitStream",function(_,$q,RateLimitStream){"use strict";return{responseError:function(config){return"RATE_LIMIT_EXCEPTION"===_.get(config,"data.message")&&RateLimitStream.RATE_LIMIT_STREAM.onNext({retry_after:config.headers("Retry-After")}),$q.reject(config)}}}]),angular.module("app.ratelimit").service("RateLimitStream",["LazyStream",function(LazyStream){this.RATE_LIMIT_STREAM=new LazyStream}]),function(){"use strict";function BadRequestModalController(UiModalService,ErrorHandlerConfig){function $onInit(){}function $onChanges(changesObj){changesObj.openModal&&!0===changesObj.openModal.currentValue&&openBadRequestModal()}function $onDestroy(){}function openBadRequestModal(){modalIsOpen||UiModalService.openModal({controller:"ModalGenericController",template:ErrorHandlerConfig.BAD_REQUEST_MODAL,backdrop:"static",keyboard:!0},{title:"Bad Request",message:"Something went wrong. Please try again.",onClosed:function(){modalIsOpen=!1,$ctrl.onClose()}},!0),modalIsOpen=!0}var $ctrl=this,modalIsOpen=!1;$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$onDestroy=$onDestroy}var badRequestModal={bindings:{title:"@",message:"@",buttonTitle:"@",openModal:"<",onClose:"&"},controller:BadRequestModalController};angular.module("app.shared.error_handler").component("badRequestModal",badRequestModal)}(),function(){"use strict";function ErrorHandlerController(errorStream,TrackerService){function $onInit(){subscription=errorStream.SERVER_RESPONSE_ERROR.subscribe(onError)}function $onDestroy(){subscription.dispose()}function onError(error){error=error||{},reset(),$ctrl.messageType=error.messageType,"BAD_REQUEST"===error.messageType?$ctrl.openBadRequestModal=!0:"ACCESS_DENIED"===error.messageType?$ctrl.openRedirectModal=!0:!1!==error.messageType&&($ctrl.showBanner=!0),trackEvent(error.messageType)}function reset(){$ctrl.messageType=null,$ctrl.showBanner=!1,$ctrl.openBadRequestModal=!1,$ctrl.openRedirectModal=!1}function trackEvent(messageType){if(messageType)switch(messageType){case"JOB_EDIT":TrackerService.track("Notifications","ErrorNotification",{Label:"JobEdit"},"impression");break;case"SERVER_ERROR":TrackerService.track("Notifications","ErrorNotification",{Label:"ServerError"},"impression");break;case"DISCONNECT":TrackerService.track("Notifications","ErrorNotification",{Label:"Disconnect"},"impression");break;default:TrackerService.track("Notifications","ErrorNotification",{Label:"General"},"impression")}}var subscription,$ctrl=this;$ctrl.showBanner=!1,$ctrl.messageType=null,$ctrl.showModal=!1,$ctrl.changeVal=!1,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.reset=reset}var errorHandlerComponent={templateUrl:"/assets-access-layer/js/shared/ErrorHandler/templates/error-handler.html",controller:ErrorHandlerController};angular.module("app.shared.error_handler").component("errorHandler",errorHandlerComponent)}(),function(){"use strict";function ErrorNotificationController(){function $onInit(){}function $onDestroy(){}function closeNotification(){$ctrl.onClose()}function getBackgroundClass(messageType){return messageType&&"DISCONNECT"!==messageType?"background-brand-danger-flashy":"background-gray-dark"}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.getBackgroundClass=getBackgroundClass,$ctrl.closeNotification=closeNotification}var errorNotificationComponent={templateUrl:"/assets-access-layer/js/shared/ErrorHandler/templates/error-notification.html",bindings:{messageType:"<",onClose:"&"},controller:ErrorNotificationController};angular.module("app.shared.error_handler").component("errorNotification",errorNotificationComponent)}(),function(){"use strict";function RedirectModalController(UiModalService,ErrorHandlerConfig){function $onInit(){}function $onChanges(changesObj){changesObj.openModal&&!0===changesObj.openModal.currentValue&&openRedirectModal()}function $onDestroy(){}function openRedirectModal(){UiModalService.openModal({controller:"redirectModalController",template:ErrorHandlerConfig.REDIRECT_MODAL,backdrop:"static",keyboard:!1},{redirectUrl:$ctrl.redirectTo,title:$ctrl.title,message:$ctrl.message})}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$onDestroy=$onDestroy}var redirectModal={bindings:{redirectTo:"@",title:"@",message:"@",openModal:"<"},controller:RedirectModalController};angular.module("app.shared.error_handler").component("redirectModal",redirectModal)}(),function(){"use strict";angular.module("app.shared.error_handler").constant("ErrorHandlerConfig",{REDIRECT_MODAL:"/assets-access-layer/js/shared/ErrorHandler/templates/redirect-modal.html",BAD_REQUEST_MODAL:"/assets-access-layer/js/shared/ErrorHandler/templates/bad-request-modal.html"})}(),function(){"use strict";function RedirectModalController($controller,$interval,$scope,$modalInstance,modalParams,UrlService){function redirectTo(){UrlService.changeUrl($scope.params.redirectUrl)}$controller("ModalGenericController",{$scope:$scope,$modalInstance:$modalInstance,modalParams:modalParams}),$scope.params=modalParams,$scope.delayUntilRedirect=5;var clearInterval=$interval(function(){1===$scope.delayUntilRedirect?($interval.cancel(clearInterval),redirectTo()):$scope.delayUntilRedirect--},1e3);$scope.redirectTo=redirectTo}RedirectModalController.$inject=["$controller","$interval","$scope","$modalInstance","modalParams","UrlService"],angular.module("app.ui").controller("redirectModalController",RedirectModalController)}(),function(){"use strict";function errorHandlerInterceptor($q,errorStream){function responseErrorInterceptor(config){return 403!==config.status||isResponseFromBoF(config)?403===config.status&&isResponseFromBoF(config)&&errorStream.SERVER_RESPONSE_ERROR.onNext({messageType:"ACCESS_DENIED",showModal:!0}):errorStream.SERVER_RESPONSE_ERROR.onNext({messageType:"JOB_EDIT"}),$q.reject(config)}function isResponseFromBoF(res){return res.data&&res.data.hasOwnProperty("action")&&res.data.hasOwnProperty("data")&&res.data.hasOwnProperty("error")&&res.data.hasOwnProperty("message")}return{responseError:responseErrorInterceptor}}errorHandlerInterceptor.$inject=["$q","errorStream"],angular.module("app.shared.error_handler").factory("errorHandlerInterceptor",errorHandlerInterceptor)}(),function(){"use strict";function errorStream(LazyStream){return{SERVER_RESPONSE_ERROR:new LazyStream}}errorStream.$inject=["LazyStream"],angular.module("app.shared.error_handler").factory("errorStream",errorStream)}(),function(){"use strict";function ArticleApi($resource){return $resource("/xhr/articles/:id",{id:"@id"},{getAll:{method:"GET"}})}ArticleApi.$inject=["$resource"],angular.module("app.shared.article").factory("ArticleApi",ArticleApi)}(),angular.module("app.shared.article").service("ArticleService",["DataService","ArticleApi",function(DataService,ArticleApi){"use strict";var self=this,defaultFilters={limit:4,offset:0,order:"article_id",categories:"",authors:"",attributes:"all",types:"post"};self.getAll=function(filters,disableCache){return filters=DataService.createFilters(defaultFilters,filters),"digest"===filters.categories&&(filters.categories=null),(disableCache?ArticleApi.get:ArticleApi.getAll)(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!1),res})},self.getAllSyndicatedTopStory=function(filters){return filters.source_type="syndicated",filters.feed="top-story",filters.categories=null,filters.types=null,self.getAll(filters)}}]),function(){"use strict";function savedArticlesCategoriesApi(_,$http,$log,Routes){function get(data){function resolveSavedArticlesResponse(response){return _.get(response,"data.data")}$log.debug("Article::savedArticleApi::get");var request={method:"GET",url:Routes.CURRENT_USER.SAVED_ARTICLES_CATEGORIES,params:data};return $http(request).then(resolveSavedArticlesResponse)}return{get:get}}savedArticlesCategoriesApi.$inject=["_","$http","$log","Routes"],angular.module("app.shared.saved_article").factory("savedArticlesCategoriesApi",savedArticlesCategoriesApi)}(),function(){"use strict";function savedArticleApi(_,$http,$log,Routes){function getAll(loadArticles){function resolveSavedArticlesResponse(response){return _.get(response,"data.data").results}$log.debug("Article::savedArticleApi::getAll");var request={method:"GET",url:Routes.CURRENT_USER.SAVED_ARTICLES,params:{}};return loadArticles&&(request.params.decorate="article"),$http(request).then(resolveSavedArticlesResponse)}function get(data){function resolveSavedArticlesResponse(response){return _.get(response,"data.data")}$log.debug("Article::savedArticleApi::get");var request={method:"GET",url:Routes.CURRENT_USER.SAVED_ARTICLES,params:data};return request.params.decorate="article",$http(request).then(resolveSavedArticlesResponse)}function post(data){return $log.debug("Article::savedArticleApi::post::",data),$http({method:"POST",url:Routes.CURRENT_USER.SAVED_ARTICLES,data:data})}return{getAll:getAll,get:get,post:post}}savedArticleApi.$inject=["_","$http","$log","Routes"],angular.module("app.shared.saved_article").factory("savedArticleApi",savedArticleApi)}(),function(){"use strict";function SaveArticleButtonController(_,$element,authStream,uiStream,savedArticleStream,savedArticleService){function $onInit(){$ctrl.isMember=!1,$ctrl.saved=!1,showNonMemberTooltip=$ctrl.showNonMemberTooltip||!1,$ctrl.nonMemberTooltipDisplayed=!1,articleId=_.parseInt($ctrl.articleId),authListener=authStream.USER_DATA_CHANGED.subscribe(onUserDataChanged),windowClickListener=uiStream.WINDOW_CLICK.subscribe(onWindowClick)}function onUserDataChanged(user){$ctrl.isMember=user.hasMembership(),$ctrl.trackerLabel=generateTrackingLabel(user.isLoggedIn()),$ctrl.isMember?($ctrl.nonMemberTooltipDisplayed=!1,subscribeToSavedArticleStream()):disposeSavedArticleListener()}function subscribeToSavedArticleStream(){savedArticleListener||(savedArticleListener=savedArticleStream.SAVED_ARTICLE_CHANGED(articleId).subscribe(onSavedArticleChanged))}function disposeSavedArticleListener(){savedArticleListener&&savedArticleListener.dispose()}function generateTrackingLabel(isLoggedIn){return[$ctrl.component,$ctrl.placement,isLoggedIn?$ctrl.isMember?"Member":"NonMember":"Anonymous","SaveArticleButton","article["+$ctrl.articleId+"]"].join(".")}function onSavedArticleChanged(isSaved){$ctrl.saved=isSaved}function $onDestroy(){authListener.dispose(),windowClickListener.dispose(),disposeSavedArticleListener()}function onClick($event){$event.preventDefault(),$event.stopPropagation(),$ctrl.isMember?($ctrl.saved=!$ctrl.saved,$ctrl.saved?savedArticleService.save(articleId):savedArticleService.unsave(articleId)):$ctrl.showNonMemberTooltip&&($ctrl.nonMemberTooltipDisplayed=!$ctrl.nonMemberTooltipDisplayed)}function preventDefault($event){$event.preventDefault(),$event.stopPropagation()}function onWindowClick(e){e.event.target.parentNode!==$element[0]&&($ctrl.nonMemberTooltipDisplayed=!1)}var $ctrl=this,authListener=null,savedArticleListener=null,windowClickListener=null,articleId=0,showNonMemberTooltip=!1;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.onClick=onClick,$ctrl.preventDefault=preventDefault}var saveArticleButtonComponent={templateUrl:"/assets-access-layer/js/shared/SavedArticle/components/save-article-button.html",transclude:!1,bindings:{articleId:"@",showNonMemberTooltip:"<",page:"@",component:"@",placement:"@"},controller:SaveArticleButtonController};angular.module("app.shared.saved_article").component("saveArticleButton",saveArticleButtonComponent)}(),function(){"use strict";angular.module("app.shared.saved_article").constant("SAVED_ARTICLE",{QUEUE_TIMEOUT:{NORMAL:2e3,EXTENDED:5e3},MAX_QUEUE_SYNC_ATTEMPTS:2,DATETIME_FORMAT:"YYYY-MM-DD HH:mm:ss",TOOLTIP_DURATION:3e3})}(),function(){"use strict";function savedArticlesService(_,moment,$log,$timeout,savedArticleStream,savedArticleApi,storageService,StorageKeys,SAVED_ARTICLE){function onUserDataChanged(user){if(!(userIsMember=user.hasMembership()))return userId=user.getId(),clearSavedArticles(),void emitSavedArticles();user.getId()!==userId&&(clearSavedArticles(),reloadSavedArticles(),userId=user.getId())}function reloadSavedArticles(){function onSavedArticlesLoaded(data){var savedArticles=[];_.each(data,function(a){savedArticles.push({id:a.article_id,dt:moment.utc(a.event_datetime,SAVED_ARTICLE.DATETIME_FORMAT)})}),storeSavedArticles(savedArticles)}if(userIsMember)return savedArticlesReloadPromise&&($timeout.cancel(savedArticlesReloadPromise),savedArticlesReloadPromise=null),savedArticlesReloadPromise=savedArticleApi.getAll().then(onSavedArticlesLoaded)}function clearSavedArticles(){storageService.remove(StorageKeys.SAVED_ARTICLES)}function clearQueue(){storageService.remove(StorageKeys.SAVED_ARTICLES_QUEUE)}function storeSavedArticles(articles){storageService.set(StorageKeys.SAVED_ARTICLES,articles),emitSavedArticles(articles)}function getSavedArticles(){return storageService.get(StorageKeys.SAVED_ARTICLES)||[]}function saveQueue(articles){storageService.set(StorageKeys.SAVED_ARTICLES_QUEUE,articles||[])}function getQueue(){return storageService.get(StorageKeys.SAVED_ARTICLES_QUEUE)||[]}function save(articleId){var savedArticles=getSavedArticles();if(_.find(savedArticles,{id:articleId}))return void $log.debug("savedArticleService::save:: Article [%d] already saved! Aborting!",articleId);var article={id:articleId,dt:moment()};return savedArticles.push(article),storeSavedArticles(savedArticles),savedArticleStream.ARTICLE_SAVED.onNext({datetime:moment().format()}),enqueueArticleEvent(articleId,!0,formatDate(article.dt.utc()))}function unsave(articleId){var savedArticles=getSavedArticles();return _.find(savedArticles,{id:articleId})?(_.remove(savedArticles,{id:articleId}),storeSavedArticles(savedArticles),enqueueArticleEvent(articleId,!1,formatDate(moment.utc()))):void $log.debug("savedArticleService::unsave:: Article [%d] not in article list! Aborting!",articleId)}function onLocalStorageChange(event){switch(event.storageKey){case StorageKeys.SAVED_ARTICLES:storeSavedArticles(event.newValue)}}function emitSavedArticles(savedArticles){$log.debug("savedArticleService::emitSavedArticles::",savedArticles),savedArticleStream.SAVED_ARTICLES_CHANGED.onNext(savedArticles)}function enqueueArticleEvent(articleId,isSaved,eventDateTime){var queue=getQueue(),inverseEvent={article_id:articleId,event_store_type_key:isSaved?"saved-article.unsaved":"saved-article.saved"};if(!(_.remove(queue,inverseEvent).length>0)){var data={article_id:articleId,event_store_type_key:isSaved?"saved-article.saved":"saved-article.unsaved",event_datetime:eventDateTime||formatDate(moment.utc())};queue.push(data)}saveQueue(queue),debounceQueue()}function debounceQueue(ms){cancelCurrentQueueTimeout(),ms=_.isNil(ms)?SAVED_ARTICLE.QUEUE_TIMEOUT.NORMAL:ms,queueProcessTimeout=$timeout(processQueue,ms)}function cancelCurrentQueueTimeout(){queueProcessTimeout&&($timeout.cancel(queueProcessTimeout),queueProcessTimeout=null)}function processQueue(){function onSuccess(){queueSyncAttempts=0,reloadSavedArticles()}function onError(){saveQueue(queue)}var queue=getQueue();clearQueue(),queue&&0!==queue.length&&(queueSyncAttempts++,savedArticleApi.post(queue).then(onSuccess,onError))}function formatDate(date){return date.format(SAVED_ARTICLE.DATETIME_FORMAT)}var queueProcessTimeout,userId,savedArticlesReloadPromise,userIsMember=!1,queueSyncAttempts=0;return{onUserDataChanged:onUserDataChanged,onLocalStorageChange:onLocalStorageChange,save:save,unsave:unsave}}savedArticlesService.$inject=["_","moment","$log","$timeout","savedArticleStream","savedArticleApi","storageService","StorageKeys","SAVED_ARTICLE"],angular.module("app.shared.saved_article").factory("savedArticleService",savedArticlesService)}(),function(){"use strict";function savedArticleStream(_,LazyStream,Stream){function CreateSavedArticleStream(articleId){function mapSavedArticle(savedArticles){return!!_.find(savedArticles,{id:articleId})}return SAVED_ARTICLES_CHANGED.map(mapSavedArticle).distinctUntilChanged()}var SAVED_ARTICLES_CHANGED=new LazyStream,ARTICLE_SAVED=new Stream;return{SAVED_ARTICLES_CHANGED:SAVED_ARTICLES_CHANGED,SAVED_ARTICLE_CHANGED:CreateSavedArticleStream,ARTICLE_SAVED:ARTICLE_SAVED}}savedArticleStream.$inject=["_","LazyStream","Stream"],angular.module("app.shared.saved_article").factory("savedArticleStream",savedArticleStream)}(),function(){"use strict";function HeroesBannerController($window){function isSmallScreen(){return $window.matchMedia("(max-width: 1216px)").matches}this.isSmallScreen=isSmallScreen}HeroesBannerController.$inject=["$window"],angular.module("app.bof500").component("heroesBanner",{bindings:{leftImgSrc:"@",leftImgSrcMobile:"@",rightImgSrc:"@",rightImgSrcMobile:"@",styleYear:"@"},templateUrl:"/assets-access-layer/js/site/Bof500/templates/heroes-banner.template.html",controller:HeroesBannerController})}(),angular.module("app.disqus").directive("articleInjectorTabs",["EventManager","$location","$timeout",function(EventManager,$location,$timeout){"use strict";return{template:'<div><tabset><tab ng-repeat="tab in tabs" ng-click="switchTab(tab)" heading="{{ tab.title }}" active="tab.active"></tab></tabset></div>',replace:!0,restrict:"E",transclude:!0,scope:{url:"@",title:"@"},link:function(scope,element,attrs){scope.active=!1;var discussion={active:!1,title:scope.title,url:scope.url};scope.tabs=[discussion],scope.switchTab=function(data){EventManager.emit("disqusThreadSwitch",data)},EventManager.on("articleInjectChange",function(data){discussion.active=!1,data.active=!0,scope.tabs[1]=data,scope.switchTab(data)})}}}]),angular.module("app.disqus").directive("disqusLoader",["$log","$timeout","$disqus","EventManager","AuthEvents","EventManagerUtility",function($log,$timeout,$disqus,EventManager,AuthEvents,EventManagerUtility){"use strict";return{restrict:"AC",replace:!0,scope:{url:"@",title:"@"},template:'<div id="disqus_thread"></div>',link:function(scope){var payload=null,listeners=[],url=scope.url,title=scope.title;scope.reloadDisqus=function(){$log.debug("disqusLoader::reloadDisqus::",url),$disqus.commit(url,title,payload)},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){payload=user.getDisqusPayload(),$log.debug("disqusLoader::userChanged:: Disqus Payload:",payload),scope.reloadDisqus()})),listeners.push(EventManager.on("disqusThreadSwitch",function(data){url=data.url,title=data.title,scope.reloadDisqus()})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]).directive("disqusThreadSwitcher",["EventManager",function(EventManager){"use strict";return{restrict:"A",link:function(scope,element,attrs){var data=attrs.disqusThreadSwitcher;element.on("click",function(){EventManager.emit("disqusThreadSwitch",{tab:data})})}}}]),function(angular,window){"use strict";angular.module("ngDisqus",[]).provider("$disqus",function(){function getScriptContainer(){return document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]}function getShortname(){return shortname||window.disqus_shortname}function getScriptSrc(shortname,file){return"//"+shortname+".disqus.com/"+file}function buildScriptTag(src){var script=document.createElement("script");return script.type="text/javascript",script.async=!0,script.src=src,script}function hasScriptTagInPlace(container,scriptSrc){var script,i,scripts=container.getElementsByTagName("script");for(i=0;i<scripts.length;i+=1)if(script=scripts[i],~script.src.indexOf(scriptSrc))return!0;return!1}function setGlobals(id,url,title,shortname,payload){window.disqus_identifier=id,window.disqus_url=url,window.disqus_shortname=shortname,window.disqus_disable_mobile=!0,window.disqus_config=function(){this.page.title=title,this.page.remote_auth_s3=payload,this.page.api_key=window.apiPublicKey}}function getCount(){var widgets=window.DISQUSWIDGETS;widgets&&angular.isFunction(widgets.getCount)&&widgets.getCount()}function resetCommit(id,url,title,payload){window.DISQUS.reset({reload:!0,config:function(){this.page.identifier=id,this.page.url=url,this.page.title=title,this.page.remote_auth_s3=payload,this.page.api_key=window.apiPublicKey}})}function addScriptTag(shortname,type){var container=getScriptContainer(),scriptSrc=getScriptSrc(shortname,type);hasScriptTagInPlace(container,scriptSrc)||container.appendChild(buildScriptTag(scriptSrc))}var shortname,TYPE_EMBED="embed.js";this.setShortname=function(sname){shortname=sname},this.$get=["$location",function($location){function commit(url,title,payload){var shortname=getShortname(),id=url.split("/").slice(-1).pop();if(url=location.protocol+"//"+location.host+url,!angular.isDefined(shortname))throw new Error("No disqus shortname defined");if(!angular.isDefined(id))throw new Error("No disqus thread id defined");angular.isDefined(window.DISQUS)?resetCommit(id,url,title,payload):(setGlobals(id,url,title,shortname,payload),addScriptTag(shortname,TYPE_EMBED))}function loadCount(id){setGlobals(id,$location.absUrl(),shortname),addScriptTag(getShortname(),TYPE_EMBED),addScriptTag(getShortname(),"count.js"),getCount()}return{commit:commit,getShortname:getShortname,loadCount:loadCount}}]})}(angular,this),angular.module("app.membership").directive("inputRecurly",["$timeout","RecurlyConfig","MembershipStream",function($timeout,RecurlyConfig,MembershipStream){return{template:'<div data-recurly="{{name}}" id="{{name}}"></div>',restrict:"E",replace:!1,require:["ngModel","^formGroup"],scope:{name:"@"},link:function(scope,element,attrs,controllers){var ngModel=controllers[0],formGroup=controllers[1],isValid=!1,isFocused=!1,isEmpty=!0,lastLength=0,firstTimeModified=!0,injectChannel=MembershipStream.INJECT;ngModel.$validators.checkIsValid=function(){return isValid||isFocused&&firstTimeModified},formGroup.setField(ngModel,attrs.id),ngModel.$timedout=!0,injectChannel.filterById(scope.name).subscribe(function(data){var status=data.data;isValid=status.valid,isFocused=status.focus,isEmpty=status.empty,isFocused||isEmpty||(firstTimeModified=!1),status.length!=lastLength&&ngModel.$setValidity("server",!0),lastLength=status.length,isEmpty||(ngModel.$setTouched(),ngModel.$setDirty(),ngModel.$setViewValue(Math.random()))})}}}]),angular.module("app.membership").directive("inputRecurlyDate",["$timeout","RecurlyConfig","MembershipStream",function($timeout,RecurlyConfig,MembershipStream){return{template:'<div data-recurly="{{name}}" id="{{name}}"></div>',restrict:"E",replace:!1,require:["ngModel","^formGroup"],scope:{name:"@",linkedTo:"@"},link:function(scope,element,attrs,controllers){var ngModel=controllers[0],formGroup=controllers[1],lastThisLength=0,lastLinkedLength=0,isThisFirstTimeModified=!0,isLinkedFirstTimeModified=!0,isThisValid=!1,isThisFocused=!1,isLinkedValid=!1,isLinkedFocused=!1,injectChannel=MembershipStream.INJECT;formGroup.setField(ngModel,attrs.id),ngModel.$timedout=!0,injectChannel.subscribe(function(data){data.id!=scope.name&&data.id!=scope.linkedTo||data.data.empty||(ngModel.$setTouched(),ngModel.$setDirty()),data.id==scope.name?(isThisValid=data.data.valid,isThisFocused=data.data.focus,data.data.length!=lastThisLength&&(ngModel.$setValidity("server",!0),ngModel.$setViewValue(data.data.length?Math.random():""),data.data.length&&ngModel.$setValidity("required",!0)),lastThisLength=data.data.length,isThisFocused||data.data.empty||(isThisFirstTimeModified=!1)):data.id==scope.linkedTo&&(isLinkedValid=data.data.valid,isLinkedFocused=data.data.focus,data.data.length!=lastLinkedLength&&(ngModel.$setValidity("server",!0),data.data.length&&ngModel.$setValidity("required",!0)),lastLinkedLength=data.data.length,isLinkedFocused||data.data.empty||(isLinkedFirstTimeModified=!1)),$timeout(function(){scope.$apply(function(){var validity=isThisValid||isLinkedValid||!lastThisLength||!lastLinkedLength||isLinkedFocused&&isLinkedFirstTimeModified||isThisFocused&&isThisFirstTimeModified;ngModel.$setValidity("areBothFieldsNotInvalid",validity)})})})}}}]),angular.module("app.membership").component("membershipContactForm",{templateUrl:"/templates/Accounts/Membership:group_contact_form",bindings:{channel:"@",membershipMarketingUrl:"@",cardClick:"@"},controller:["_","ShareService","DomService","UiEvents","DataService","EventManagerUtility","EventManager","AuthEvents","ChannelManager","FormServiceFactory","SharedDataApiFactory","CoreValidations","$log","userProfileApi","$timeout","SalesforceService","MessageConstants","FormFieldMappings","$q",function(_,ShareService,DomService,UiEvents,DataService,EventManagerUtility,EventManager,AuthEvents,ChannelManager,FormServiceFactory,SharedDataApiFactory,CoreValidations,$log,userProfileApi,$timeout,SalesforceService,MessageConstants,FormFieldMappings,$q){"use strict";var listeners=[],ctrl=this,ChannelEventManager=ChannelManager.subscribe(ctrl.channel),typeaheadSuggestions={job_title:new SharedDataApiFactory({type:"job-titles"}),company:new SharedDataApiFactory({type:"profile-organisations"})},selectDataServices={company_size:new SharedDataApiFactory({type:"company-sizes"}),phone_code:new SharedDataApiFactory({type:"countries"})};ctrl.form={ref:null,data:{type_id:MessageConstants.MESSAGE_TYPE.GROUP_MEMBERSHIP_ENQUIRY.ID,email:null,first_name:null,last_name:null,phone_number:null,company:{id:null,title:null},job_title:{title:null},company_website:null,company_size:null}},ctrl.loaded=!1,ctrl.job_disabled=!1,ctrl.done=!1,ctrl.user={},ctrl.selects={},ctrl.companySizeList=[],ctrl.regex=CoreValidations,ctrl.formSubmitFrontendError=!1,ctrl.formSubmitServerError=!1,ctrl.formSubmitServerErrorMessage=null;var FormService=new FormServiceFactory(ctrl.form);ctrl.canSubmit=function(){var valid=FormService.canSubmit();return showFrontendError(!valid),valid};var scrollToTopOfForm=function(){DomService.scrollToElement(DomService.getElement("#membership-group-contact-form"),100)},scrollToTopOfPage=function(){DomService.resetScroll()},showFrontendError=function(isInvalid){ctrl.formSubmitFrontendError=isInvalid,isInvalid&&scrollToTopOfForm()},transformSalesforceData=function(newData){var queryString="";""!==newData.card_click&&(queryString="?card="+newData.card_click);var phoneCode="",phoneNumber="";newData.phone_code>0&&(phoneCode="+"+newData.phone_code.toString()),newData.phone_number>0&&(phoneNumber=newData.phone_number.toString());var company_size=companySize(newData.company_size),requested_group_size=requestGroupSize(newData.requested_group_size);return{first_name:newData.first_name,last_name:newData.last_name,email:newData.email,phone:phoneCode+phoneNumber,title:newData.job_title_title,company:newData.company_title,URL:newData.company_website,"00N1r00000JwHAg":company_size,"00N1r00000JwHAl":requested_group_size,description:newData.message,lead_source:"Inbound","00N1r00000JwHB0":"/memberships/group/contact"+queryString}},requestGroupSize=function(requestGroupSize){return lookupInConstantKeyValuePair(requestGroupSize,FormFieldMappings.REQUEST_GROUP_SIZE,0)},companySize=function(companySize){return lookupInConstantKeyValuePair(companySize,FormFieldMappings.COMPANY_SIZE,0)},lookupInConstantKeyValuePair=function(key,mapping,returnDefault){var value=returnDefault;return _.forEach(mapping,function(option){option.KEY&&option.VALUE&&key===option.KEY&&(value=option.VALUE)}),value};ctrl.submit=function(){var newData=DataService.normaliseFormData(ctrl.form.data,["title"]);_.isNull(ctrl.cardClick)||(newData.card_click=ctrl.cardClick),newData.message=newData.message||"No message added by the user [automated message].";var salesforcePromise=SalesforceService.submitMessage(transformSalesforceData(newData)),sharePromise=ShareService.submitMessage(newData).then(function(res){return ctrl.done=!0,scrollToTopOfPage(),res},function(error){});return $q.all([salesforcePromise,sharePromise])},$log.debug("membershipContactForm::init"),_.forEach(selectDataServices,function(serviceData,name){serviceData.get().then(function(res){ctrl.selects[name]=res.data})});var onProfileApiGetSuccess=function(response){_.assign(ctrl.form.data,{first_name:response.data.firstname,last_name:response.data.lastname,email:response.data.email}),ctrl.form.data.job_title.title=response.data.job.title,ctrl.form.data.job_title.title&&(ctrl.job_disabled=!0),$timeout(setLoaded)},setLoaded=function(){ctrl.loaded=!0};listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){if(ctrl.loaded=!1,!user.isLoggedIn())return void $timeout(setLoaded);ctrl.loggedIn=user.isLoggedIn(),userProfileApi.get().then(onProfileApiGetSuccess),ChannelEventManager.emit(UiEvents.REPAINT,{})})),listeners.push(ChannelEventManager.on(UiEvents.QUERY_TYPEAHEAD,function(data){_.has(typeaheadSuggestions,data.id)&&typeaheadSuggestions[data.id].get({query:data.query,limit:4}).then(function(res){ChannelEventManager.emit(UiEvents.INJECT_TYPEAHEAD,{id:data.id,results:res.data})})})),ctrl.$postLink=function(){ChannelEventManager.emit(UiEvents.REPAINT,{})},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.membership").component("membershipIndividualActiveCheck",{bindings:{},controller:["$log","EventManager","AuthEvents","MembershipModals","MEMBERSHIP_EVENT","TrackerService","UiModalService",function($log,EventManager,AuthEvents,MembershipModals,MEMBERSHIP_EVENT,TrackerService,UiModalService){"use strict";var openAlreadySubscribedModal=function(){UiModalService.openModal({controller:"ModalGenericController",template:MembershipModals.ALREADY_SUBSCRIBED,backdrop:"static",keyboard:!1}),TrackerService.track(MEMBERSHIP_EVENT.DOMAIN,"MembershipAlreadySubscribedModal")};[].push(EventManager.on(AuthEvents.USER_CHANGED,function(user){user.accounts.hasActiveProduct("memberships")&&openAlreadySubscribedModal()}))}]}),angular.module("app.membership").component("membershipStudentDetailsForm",{templateUrl:"/templates/Accounts/Membership:student_details_form",bindings:{redirectUrl:"@"},controller:["_","$q","$log","$timeout","DomService","EventManagerUtility","EventManager","AuthEvents","FormServiceFactory","CoreValidations","UserSchoolApi","UrlService","MembershipStream","authService","CONSENT_JOURNEY","userConsentApi",function(_,$q,$log,$timeout,DomService,EventManagerUtility,EventManager,AuthEvents,FormServiceFactory,CoreValidations,UserSchoolApi,UrlService,MembershipStream,authService,CONSENT_JOURNEY,userConsentApi){"use strict";var listeners=[],readyComponents=[],ctrl=this;ctrl.form={ref:null},ctrl.consentsForm={},ctrl.triggerTracking=!1,ctrl.accountEmail=null,ctrl.selects={},ctrl.studentDetails={is_topshop_optin:!1},ctrl.regex=CoreValidations,ctrl.showLoader=!0,ctrl.errorResponse=!1;var FormService=new FormServiceFactory(ctrl.form),dismissLoader=function(){readyComponents.length>=4&&(ctrl.showLoader=!1)};ctrl.canSubmit=function(){ctrl.consentsForm.isValid||(ctrl.consentErrors=ctrl.consentsForm);var valid=FormService.canSubmit()&&ctrl.consentsForm.isValid;return valid||showFrontendError("FORM_DATA_INVALID"),valid},ctrl.onConsentsChange=function($event){ctrl.consentsForm=$event};var scrollToTopOfForm=function(){DomService.scrollToElement(DomService.getElement("#membership-student-details-form"),120)},showFrontendError=function(errorType){ctrl.errorResponse=errorType,scrollToTopOfForm()};ctrl.submit=function(){function onSuccess(){$log.debug("membershipStudentDetailsForm::submit::success Student details added!"),UrlService.changeUrl(ctrl.redirectUrl)}function onError(response){$log.debug("membershipStudentDetailsForm::submit::error Error trying to add student Details data!",response);var errorResponse=_.get(response,"data.message",null)||"An unexpected error has occurred.";showFrontendError(errorResponse)}ctrl.triggerTracking=!0;var userConsentsPromise=userConsentApi.update(_.get(ctrl.consentsForm,"formData"),ctrl.consentJourneyId,{user_email:ctrl.subscriberEmail}),userSchoolPromise=UserSchoolApi.update(ctrl.studentDetails);return $q.all([userConsentsPromise,userSchoolPromise]).then(function(){authService.refreshAccessToken().then(onSuccess).catch(onError)})},ctrl.onReady=function(component){readyComponents.push(component),dismissLoader()},listeners.push(MembershipStream.INJECT.subscribe(function(payload){$log.debug("membershipStudentDetailsForm::INJECT Loaded emails: ",payload),ctrl.accountEmail=payload.user_email,ctrl.studentDetails.user_email=payload.academic_email})),ctrl.$onInit=function(){ctrl.consentJourneyId=CONSENT_JOURNEY.MembershipsPurchaseStudent,UserSchoolApi.get().then(function(responseData){ctrl.studentDetails=_.merge(ctrl.studentDetails,responseData)})},ctrl.$postLink=function(){},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.membership").component("membershipStudentEmailConfirmationForm",{templateUrl:"/templates/Accounts/Membership:student_email_confirmation_form",bindings:{},controller:["$q","$log","FormServiceFactory","EventManagerUtility","UserEmailApi","EventManager","AuthEvents","CoreValidations","DomService",function($q,$log,FormServiceFactory,EventManagerUtility,UserEmailApi,EventManager,AuthEvents,CoreValidations,DomService){"use strict";var listeners=[],ctrl=this;ctrl.form={ref:null},ctrl.submitted=!1,ctrl.errorResponse=!1,ctrl.email_regex=CoreValidations.EMAIL;var FormService=new FormServiceFactory(ctrl.form),scrollToTop=function(){DomService.scrollToElement(DomService.getElement("#email-confirmation-block"),100)};ctrl.canSubmit=function(){return FormService.canSubmit()},ctrl.onEmailChange=function(){ctrl.errorResponse=!1},ctrl.submit=function(){return UserEmailApi.putAcademicEmail(ctrl.email).then(function(res){return ctrl.submitted=!0,scrollToTop(),$log.debug("membershipStudentEmailConfirmationForm::submit::success Email created!"),res},function(response){return $log.error("membershipStudentEmailConfirmationForm::submit::error Error trying to create an academic email!",response),ctrl.errorResponse=response.data?response.data.message:"An unexpected error has occurred.",$q.reject()})},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){ctrl.accountEmail=user.email})),ctrl.$onInit=function(){},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.membership").component("membershipStudentRedirect",{bindings:{plan:"@",redirectOnPlan:"@",redirectUrl:"@"},controller:["$log","EventManager","AuthEvents","UrlService","EventManagerUtility",function($log,EventManager,AuthEvents,UrlService,EventManagerUtility){"use strict";var ctrl=this,listeners=[];listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){user.schools.getStudentEmail().then(function(res){$log.debug("membershipStudentRedirect::USER_CHANGED User has confirmed academic email",res),ctrl.redirectOnPlan==ctrl.plan&&void 0===res&&UrlService.changeUrl(ctrl.redirectUrl)})})),ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.membership").component("membershipStudentWrapper",{templateUrl:"/templates/Accounts/Membership:student_details_page",bindings:{redirectUrl:"@"},controller:["$log","AuthEvents","EventManager","AcademicEmailValidateApi","EventManagerUtility","MembershipStream",function($log,AuthEvents,EventManager,AcademicEmailValidateApi,EventManagerUtility,MembershipStream){"use strict";var listeners=[],ctrl=this;ctrl.isLoaded=!1,ctrl.userHasValidStudentEmail=!1,listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){if(!user.isLoggedIn())return void $log.debug("membershipStudentWrapper::USER_CHANGED User not logged in, aborting ..");AcademicEmailValidateApi.check(user.email).then(function(){$log.debug('membershipStudentWrapper::USER_CHANGED User personal email "%s" is a valid academic email',user.email),ctrl.userHasValidStudentEmail=!0,ctrl.isLoaded=!0,emailsLoaded(user.email)},function(){user.schools.getStudentEmail().then(function(res){$log.debug('membershipStudentWrapper::USER_CHANGED User has confirmed academic email "%s"',res),emailsLoaded(user.email,res?res.user_email:null),ctrl.userHasValidStudentEmail=!!res,ctrl.isLoaded=!0})})}));var emailsLoaded=function(email,academicEmail){var payload={user_email:email,academic_email:academicEmail||email};$log.debug("membershipStudentWrapper::emailsLoaded Dispatching event",payload),MembershipStream.INJECT.onNext(payload)};ctrl.$onInit=function(){},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),function(){"use strict";function AccountCredentialsController(_,$timeout,CoreValidations,FormServiceFactory,authModalService,membershipStream,SharedDataApiFactory){function $onInit(){$ctrl.checkCompanyEmail&&companyEmailApi.get().then(onCompanyEmailApiSuccess),formData.email=$ctrl.userEmail,$ctrl.passwordPattern=CoreValidations.PASSWORD,$ctrl.form={ref:null,data:formData},FormService=new FormServiceFactory($ctrl.form),$ctrl.restrictionNotification=!1}function onCompanyEmailApiSuccess(res){tempRegex=res.data,checkEmailRestrictions()}function $postLink(){$timeout(onFormFieldChange)}function $onChanges(changesObj){changesObj.enableValidation&&!changesObj.enableValidation.isFirstChange()&&FormService&&FormService.canSubmit(),changesObj.userEmail&&changesObj.userEmail.currentValue&&(formData.email=$ctrl.userEmail)}function openLogin(event){event.preventDefault(),authModalService.setSubscribeSource("MembershipRegistrationFlow"),authModalService.openLogin("default",{},!0)}function onFormFieldChange(type){var formChangedPayload={formData:_.clone(formData),isValid:FormService.isValid()};"email"===type&&checkEmailRestrictions(),_.isEqual(formChangedPayload,emittedPayload)||(emittedPayload=formChangedPayload,membershipStream.USER_FORM_CHANGED.onNext(emittedPayload),$ctrl.onChange({$event:emittedPayload}))}function checkEmailRestrictions(){$ctrl.restrictionNotification=!1,$ctrl.form.ref.email.$valid&&_.forEach(tempRegex,function(regex){regex=new RegExp(regex),!_.isEmpty(formData.email)&&regex.test(formData.email.toLowerCase())&&$timeout(function(){$ctrl.restrictionNotification=!0},2500)})}function $onDestroy(){}var FormService,emittedPayload,$ctrl=this,formData={email:void 0,password:void 0},companyEmailApi=new SharedDataApiFactory({type:"email-patterns"}),tempRegex=[];_.isUndefined($ctrl.checkCompanyEmail)&&($ctrl.checkCompanyEmail=!0),$ctrl.openLogin=openLogin,$ctrl.onFormFieldChange=onFormFieldChange,$ctrl.$onInit=$onInit,$ctrl.$postLink=$postLink,$ctrl.$onChanges=$onChanges,$ctrl.$onDestroy=$onDestroy}var accountCredentialsComponent={templateUrl:function($attrs){return $attrs.templateUrl?$attrs.templateUrl:"/assets-access-layer/js/site/Membership/templates/account-credentials.html"},bindings:{isLoggedIn:"<",userEmail:"<",enableValidation:"<",checkCompanyEmail:"<",onChange:"&"},controller:AccountCredentialsController};angular.module("app.membership").component("accountCredentials",accountCredentialsComponent)}(),function(){"use strict";function BofProfessionalBannerController(_,storageService,EventManagerUtility,authStream,moment,AgentService,journeyContextService){function $onInit(){ctrl.countdownDays=diff<=0?"One Day":daysInWords[diff],ctrl.showBanner=!1,ctrl.sampleArticleLabel=ctrl.isSampleArticle&&"1"===ctrl.isSampleArticle?".sampleArticle":"",ctrl.label=AgentService.isMobilePhone()?"PromotionalBanner.BelowMainNavigation.MobileAppCopy.GreyBanner":"PromotionalBanner.BelowMainNavigation.SubscriptionCopy.GreyBanner",ctrl.label=ctrl.label+ctrl.sampleArticleLabel,ctrl.ctaUrl=journeyContextService.generatePaymentPlanUrl(ctrl.url,{articleSlug:ctrl.articleSlug}),listeners.push(authStream.USER_DATA_CHANGED.subscribe(onUserChanged))}function close(event){event&&(event.preventDefault(),event.stopPropagation()),storageService.set(storageService.KEY.BOF_PROFESSIONAL_DISMISSAL_DATE,moment()),ctrl.showBanner=!1}function isBannerDismissed(){var bannerDismissalTimestamp=storageService.get(storageService.KEY.BOF_PROFESSIONAL_DISMISSAL_DATE);return bannerDismissalTimestamp&&moment().diff(bannerDismissalTimestamp,"days")<BANNER_DISMISSAL_DAYS}function onUserChanged(user){ctrl.showBanner=!user.hasMembership()&&!isBannerDismissed()}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}var ctrl=this,listeners=[],BANNER_DISMISSAL_DAYS=3,diff=_.ceil(moment("20161025","YYYYMMDD").diff(moment(),"hours")/24),daysInWords={5:"Five Days",4:"Four Days",3:"Three Days",2:"Two Days",1:"One Day",0:"One Day"};ctrl.close=close,ctrl.$onDestroy=$onDestroy,ctrl.$onInit=$onInit}var bofProfessionalBannerComponent={bindings:{url:"@",location:"@",page:"@",source:"@",medium:"@",campaign:"@",isSampleArticle:"@",articleSlug:"@"},templateUrl:function(AgentService){return AgentService.isMobilePhone()?"/assets-access-layer/js/site/Membership/templates/bof-professional-banner-mobile.html":"/assets-access-layer/js/site/Membership/templates/bof-professional-banner.html"},controller:BofProfessionalBannerController};angular.module("app.membership").component("bofProfessionalBanner",bofProfessionalBannerComponent)}(),function(){"use strict";function BofProfessionalButtonController(authStream,moment,storageService,journeyContextService){function $onInit(){$ctrl.premium=!1,listener=authStream.USER_DATA_CHANGED.subscribe(onUserChanged),$ctrl.ctaUrl=$ctrl.articleSlug?journeyContextService.generatePaymentPlanUrl($ctrl.url,{articleSlug:$ctrl.articleSlug}):$ctrl.url}function onUserChanged(user){$ctrl.premium=user.hasMembership()}function $onDestroy(){listener.dispose()}var listener,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var bofProfessionalButtonComponent={bindings:{url:"@",location:"@",page:"@",label:"@",source:"@",medium:"@",campaign:"@",articleSlug:"@"},templateUrl:function(AgentService){return AgentService.isDesktop()?"/assets-access-layer/js/site/Membership/templates/bof_professional_button.html":"/assets-access-layer/js/site/Membership/templates/bof_professional_button_mobile.html"},controller:BofProfessionalButtonController};angular.module("app.membership").component("bofProfessionalButton",bofProfessionalButtonComponent)}(),function(){"use strict";function BofProfessionalDunningBannerController(_,authStream,storageService,moment,failedPaymentDataApi){function $onInit(){$ctrl.showBanner=!1,$ctrl.isAccAdmin=!1,$ctrl.accAdminEmail=null,$ctrl.usedSeats=0,$ctrl.bannerType="INDIVIDUAL",authListener=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){function onFailedPaymentDataGetSuccess(data){$ctrl.isAccAdmin=_.includes(data.admin_user_ids,$ctrl.userId),$ctrl.accAdminEmail=data.account_admin_email,$ctrl.usedSeats=data.active_seats;var forceShowBanner=!1;$ctrl.isAccAdmin?($ctrl.bannerType="ADMIN",forceShowBanner=!0):$ctrl.bannerType=1===data.account_type_id?"GROUP":"INDIVIDUAL",showBanner(forceShowBanner)}$ctrl.userId=user.getId(),$ctrl.showBanner=!1,$ctrl.accountId=_.get(user,"membership_payment_error.account_id"),paymentErr=_.get(user,"membership_payment_error.error_code"),hasMembership=user.hasMembership(),paymentErr&&failedPaymentDataApi.get($ctrl.accountId).then(onFailedPaymentDataGetSuccess);var paymentDetailsUpdateTimestamp=storageService.get(storageService.KEY.PAYMENT_DETAILS_UPDATE_DATE);paymentDetailsUpdateTimestamp&&(moment().diff(paymentDetailsUpdateTimestamp,"seconds")<120?$ctrl.showBanner=!1:storageService.remove(storageService.KEY.PAYMENT_DETAILS_UPDATE_DATE))}function showBanner(force){$ctrl.showBanner=force||hasMembership&&!!paymentErr}function $onDestroy(){authListener.dispose()}var authListener,hasMembership,paymentErr,$ctrl=this;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var bofProfessionalDunningBannerComponent={bindings:{location:"@",page:"@",source:"@",medium:"@",campaign:"@"},templateUrl:"/assets-access-layer/js/site/Membership/templates/bof-professional-dunning-banner.html",controller:BofProfessionalDunningBannerController};angular.module("app.membership").component("bofProfessionalDunningBanner",bofProfessionalDunningBannerComponent)}(),function(){"use strict";function BofProfessionalPageBannerController(authStream){function $onInit(){$ctrl.isLoaded=!1,authListener=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){$ctrl.isLoaded=!0,$ctrl.isMember=user.hasMembership()}function $onDestroy(){authListener.dispose()}var authListener,$ctrl=this;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var bofProfessionalPageBannerComponent={bindings:{joinUrl:"@"},templateUrl:"/assets-access-layer/js/site/Membership/Component/bof-professional-page-banner.html",controller:BofProfessionalPageBannerController};angular.module("app.membership").component("bofProfessionalPageBanner",bofProfessionalPageBannerComponent)}(),function(){"use strict";function MembershipContentBannerController(_,authStream,MembershipTypes){function $onInit(){$ctrl.showProfessionalBanner=!1,$ctrl.showPartnerBanner=!1,$ctrl.membershipType=!1,$ctrl.partnerData={},$ctrl.redirectSlug="this-week-in-fashion"===$ctrl.articleCategorySlug?$ctrl.articleCategorySlug:"professional",userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){if($ctrl.showProfessionalBanner=_.includes(["member-access"],$ctrl.articleAccessType)&&user.hasMembership()&&!_.includes(["fashion-show-review"],$ctrl.articleCategorySlug),$ctrl.membershipType=user.getMembershipType(),$ctrl.showPartnerBanner=_.includes([MembershipTypes.INDIVIDUAL_STUDENT_KEY,MembershipTypes.GROUPS_PARTNER_KEY],$ctrl.membershipType),"groups_partner"===$ctrl.membershipType){var partnerId=user.getPartnerId();$ctrl.partnerData=partnerData[partnerId]}}function $onDestroy(){userChangedSub.dispose()}var userChangedSub,$ctrl=this,partnerData={1:{class:"partner-pvh",company_title:"PVH Corp."},2:{class:"partner-conde-nast",company_title:"Conde Nast",brand_image_url:"assets-email/conde_nast_white.png",brand_image_width:121,brand_image_height:24},3:{class:"partner-tapestry",company_title:"Tapestry",brand_image_url:"assets-email/tapestry-logo-white.png",brand_image_width:121,brand_image_height:27},4:{class:"partner-farfetch",company_title:"Farfetch",brand_image_url:"assets-email/farfetch-logo-white.png",brand_image_width:112,brand_image_height:27},5:{class:"partner-burberry",company_title:"Burberry",brand_image_url:"assets-email/burberry-logo-white.png",brand_image_width:140,brand_image_height:18},6:{class:"partner-longchamp",company_title:"Longchamp",brand_image_url:"assets-email/longchamp-logo-white.png",brand_image_width:120,brand_image_height:35},7:{class:"partner-conde-nast",company_title:"Cond Nast International",brand_image_url:"assets-email/conde_nast_international_white.png",brand_image_width:121,brand_image_height:24},8:{class:"partner-mckinsey",company_title:"McKinsey & Company",brand_image_url:"assets-email/mckinsey_logo_white.png",brand_image_width:179,brand_image_height:24}};$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var membershipContentBannerComponent={templateUrl:"/assets-access-layer/js/site/Membership/Component/membership-content-banner.html",bindings:{page:"@",articleId:"@",articleCategorySlug:"@",articleAccessType:"@"},controller:MembershipContentBannerController};angular.module("app.membership").component("membershipContentBanner",membershipContentBannerComponent)}(),function(){"use strict";function MembershipDynamicFeatureHeaderController(_,ChannelManager,courseApi,UiEvents,UrlService,journeyContextService,authStream,MembershipTypes){function $onChanges(changes){_.isUndefined(changes.currencyCode)||updateCourseData()}function $onInit(){ChannelEventManager=ChannelManager.subscribe("paymentFormScroll"),$ctrl.featureObjectsMapping={CONTENT:["COURSE_LIBRARY","CONTENT","ACCESS_ALL_ARTICLES","IOS_PRO_APP","PRINT","COMMUNITY"],MONTHLY:["CONTENT","ACCESS_ALL_ARTICLES","IOS_APP"],COURSE:["COURSE_LIBRARY","CONTENT","ACCESS_ALL_ARTICLES","IOS_PRO_APP","PRINT","COMMUNITY"],"COURSE-UPSELL":["COURSE_LIBRARY","CONTENT","ACCESS_ALL_ARTICLES","IOS_PRO_APP","PRINT","COMMUNITY"],EDUCATION:["COURSE_LIBRARY","CONTENT","ACCESS_ALL_ARTICLES","IOS_PRO_APP","PRINT","COMMUNITY"]},$ctrl.isLoading=!0,$ctrl.showContactUs=!1,$ctrl.courseData=null,$ctrl.bgImageClassPrefix="mem-dynamic-header__background--",userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged),$ctrl.annualCtaUrl=journeyContextService.generatePaymentPlanUrl("/memberships/payment/v1_yearly")}function updateCourseData(){if(_.isNil($ctrl.courseData))return void($ctrl.isLoading=!1);if($ctrl.courseTitle=$ctrl.courseData.course_title,$ctrl.instructorTitle=_.get($ctrl.courseData,"instructor.first_name")+" "+_.get($ctrl.courseData,"instructor.last_name"),$ctrl.courseSlug=$ctrl.courseData.course_key,$ctrl.bgImageClass=$ctrl.bgImageClassPrefix+$ctrl.courseData.course_key+("COURSE-PAYMENT"===$ctrl.state?"--course-payment":""),$ctrl.coursePrice=0,!_.isUndefined($ctrl.currencyCode)){var price=_.find($ctrl.courseData.converted_prices,["currency",$ctrl.currencyCode]);$ctrl.coursePrice=price.price}$ctrl.isLoading=!1}function onUserChanged(user){function onCourseApiSuccess(res){$ctrl.courseData=res,updateCourseData()}var urlParameters=_.pick(UrlService.parseQuery(),["articleSlug","courseSlug","journeyContext","offer"]);user.hasMembership();if($ctrl.userType=_.camelCase(user.getMembershipType())||"anonymous",$ctrl.state=getHeaderState(urlParameters),$ctrl.camelCaseState=_.camelCase($ctrl.state),$ctrl.isLoading="COURSE"===$ctrl.state||"COURSE-PAYMENT"===$ctrl.state,"COURSE"===$ctrl.state||"COURSE-PAYMENT"===$ctrl.state){var courseIdentifier="COURSE"===$ctrl.state?urlParameters.courseSlug:_.toInteger($ctrl.courseId);courseApi.get(courseIdentifier,{decorate:"instructor"}).then(onCourseApiSuccess)}else $ctrl.bgImageClass=$ctrl.bgImageClassPrefix+_.toLower($ctrl.state)}function getHeaderState(urlParameters){if("course-offer"===urlParameters.offer)return"COURSE-UPSELL";if(!_.isNil($ctrl.courseId))return"COURSE-PAYMENT";if("v1_yearly"===$ctrl.planCode){if(!_.isNil(urlParameters.courseSlug))return"COURSE";if(!_.isNil(urlParameters.journeyContext)&&"education-marketing-page"===urlParameters.journeyContext)return"EDUCATION"}else if("v1_monthly"===$ctrl.planCode)return"MONTHLY";return"CONTENT"}function displayPricePlusTaxText(placement){placement=placement||"header";var price,showVATForEUR=!0;"roundal"===placement?price="EUR"===$ctrl.currencyCode?parseFloat($ctrl.priceSubtotalNext):parseFloat($ctrl.priceTotalNext):"singlecourse"===placement?(price=parseFloat($ctrl.coursePrice),showVATForEUR=!1):price="EUR"===$ctrl.currencyCode?parseFloat($ctrl.priceSubtotal):parseFloat($ctrl.priceTotal);var priceText="";return price>0&&(priceText+="USD"===$ctrl.currencyCode?"USD ":"",priceText+=$ctrl.currencySymbol+(price%1!=0?_.round(price,2).toFixed(2):price),priceText+="EUR"===$ctrl.currencyCode&&showVATForEUR?" + VAT":""),priceText}function scrollToPaymentForm(){ChannelEventManager.emit(UiEvents.CHANGE_SCROLL_TO,{id:"payment-form"})}function $onDestroy(){userChangedSub.dispose()}var ChannelEventManager,userChangedSub,$ctrl=this;$ctrl.$onChanges=$onChanges,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.displayPricePlusTaxText=displayPricePlusTaxText,$ctrl.scrollToPaymentForm=scrollToPaymentForm}var membershipDynamicFeatureHeaderComponent={templateUrl:"/assets-access-layer/js/site/Membership/Component/membership-dynamic-feature-header.html",bindings:{page:"@",planCode:"<",currencyCode:"<",currencySymbol:"<",priceTotal:"<",priceSubtotal:"<",taxType:"<",taxRate:"<",courseId:"<",priceSubtotalNext:"<",priceTotalNext:"<",priceTaxNext:"<"},controller:MembershipDynamicFeatureHeaderController};angular.module("app.membership").component("membershipDynamicFeatureHeader",membershipDynamicFeatureHeaderComponent)}(),function(){"use strict";var membershipFreeTrialCheckComponent={templateUrl:"/assets-access-layer/js/site/Membership/templates/membership-free-trial-check.html",bindings:{trialLengthDays:"<",hasUsedFreeTrial:"<"}};angular.module("app.membership").component("membershipFreeTrialCheck",membershipFreeTrialCheckComponent)}(),function(){"use strict";function MembershipGroupPaymentController(_,$log,$q,$timeout,TrackerService,MEMBERSHIP_EVENT,UrlService,MembershipTrackingService,membershipStream,recurlyStream,authStream,recurlyTokenApi,MembershipGroupApi,storageService){function $onInit(){step1Data=storageService.get(storageService.KEY.GROUP_MEMBERSHIP_PARAMETERS),step1Data||UrlService.changeUrl($ctrl.planChangeUrl),$ctrl.countryDisabled=!!step1Data.vat_number,$ctrl.vatNumber=step1Data.vat_number,$ctrl.numberOfSeats=step1Data.no_of_seats,$ctrl.defaultCountryCode=_.lowerCase(step1Data.default_country_code),$ctrl.isLoaded=!1,$ctrl.errorType=null,$ctrl.errorMessage="",$ctrl.isLoggedIn=!1,$ctrl.user={},$ctrl.shippingFormEnabled=!1,$ctrl.planTrialLengthDays=0,listeners.push(authStream.USER_DATA_CHANGED.subscribe(onUserChanged),recurlyStream.BILLING_FORM_CHANGED.subscribe(onBillingFormChanged),recurlyStream.BILLING_COUNTRY_CHANGED.subscribe(onCountryChanged),recurlyStream.PRICING_RELOADED.subscribe(onPricingChange),recurlyStream.COUPON_CHANGED.subscribe(onCouponChanged),membershipStream.TERMS_FORM_CHANGED.subscribe(onTermsCheckboxChanged))}function $onDestroy(){_.each(listeners,function(listener){listener.dispose()})}function onPricingChange(payload){$ctrl.isLoaded||($ctrl.isLoaded=!0),$ctrl.pricingData=payload.pricingData}function onCouponChanged(newCoupon){$ctrl.couponName=newCoupon.name,$ctrl.couponCode=newCoupon.code}function canSubmit(){$ctrl.enableValidation=!0;var isValid=form.billing.isValid&&form.terms.isValid&&$ctrl.isLoggedIn;return $log.debug("MembershipGroupPaymentController::canSubmit::isValid[%s]",isValid,form),isValid||handleError("VALIDATION_ERROR",null),TrackerService.track(MEMBERSHIP_EVENT.DOMAIN,isValid?"MembershipValidFormSubmit":"MembershipInvalidFormSubmit"),isValid}function buildDataForAPI(token){var billingCurrency=$ctrl.billingCountry.billing_currency;return{token:token,plan_code:$ctrl.planCode,currency:billingCurrency,coupon_code:$ctrl.couponCode,source_data:MembershipTrackingService.getUserTrackingData(),no_of_seats:step1Data.no_of_seats,organisation_name:step1Data.organisation_name,organisation_id:step1Data.organisation_id,team_name:step1Data.team_name,company_address_line_1:step1Data.company_address_line_1,company_address_line_2:step1Data.company_address_line_2,company_city:step1Data.company_city,company_postal_code:step1Data.company_postal_code,contact_email:step1Data.contact_email,vat_number:step1Data.vat_number}}function submit(){function onTokenGetSuccess(token){function onSubmitSuccess(response){storageService.remove(storageService.KEY.GROUP_MEMBERSHIP_PARAMETERS),$log.debug("MembershipGroupPaymentController::submit::onSubmitSuccess::",response),deferred.resolve(response),successAction(response)}function onSubmitError(response){$log.debug("MembershipGroupPaymentController::submit::onSubmitError::",response),handleError("SERVER_ERROR",response.data.message),deferred.reject(response)}return $log.debug("MembershipGroupPaymentController::submit::onTokenGetSuccess",token),MembershipGroupApi.create(buildDataForAPI(token)).then(onSubmitSuccess,onSubmitError)}function onTokenGetError(response){$log.debug("MembershipGroupPaymentController::submit::onTokenGetError",response),$ctrl.billingFormErrors=response,handleError("RECURLY",response.message),deferred.reject(response)}$log.debug("MembershipGroupPaymentController::submit::",form);var billingFormData=_.clone(form.billing.formData);step1Data.vat_number&&(billingFormData.vat_number=step1Data.vat_number),recurlyTokenApi.get(billingFormData).then(onTokenGetSuccess,onTokenGetError);var deferred=$q.defer();return deferred.promise}function handleError(errorType,errorMessage){$ctrl.errors={type:errorType,message:errorMessage}}function onUserChanged(user){$log.debug("membershipGroupPayment::onUserChanged::",user),$ctrl.isLoggedIn=user.isLoggedIn(),$ctrl.user={email:user.email,first_name:user.firstname,last_name:user.lastname}}function successAction(response){function redirectToConfirmationPage(){var accountId=_.get(response,"data.account_id"),params={};accountId&&(params.order_number=accountId),$ctrl.isLoggedIn||(params.registered=!0);var confirmationUrl=$ctrl.paymentConfirmationUrl+(_.isEmpty(params)?"":UrlService.getQueryString(params));UrlService.changeUrl(confirmationUrl)}$timeout(_.noop,2e3).then(redirectToConfirmationPage)}function onCountryChanged(payload){$ctrl.billingCountry=payload.newValue}function onBillingFormChanged(billingData){billingData.isValid&&handleError(),form.billing=billingData}function onTermsCheckboxChanged(termsData){form.terms=termsData}var step1Data,$ctrl=this,listeners=[],form={billing:{},terms:{},user:{},shipping:{}};$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit}var membershipGroupPaymentComponent={templateUrl:"/assets-access-layer/js/site/Membership/templates/membership-group-payment.html",bindings:{planCode:"@",planTitle:"@",planChangeUrl:"@",planIntervalMonths:"@",defaultCouponCode:"@",paymentConfirmationUrl:"@",membershipType:"@"},controller:MembershipGroupPaymentController};angular.module("app.membership").component("membershipGroupPayment",membershipGroupPaymentComponent)}(),function(){"use strict";function MembershipGroupsPurchaseStep1Controller(_,$q,$log,$filter,UiModalService,MembershipTierApi,MembershipModals,TrackerService,MEMBERSHIP_EVENT,GroupMembershipBasePlanApi,FormServiceFactory,MembershipConfig,recurlyPricingApi,InputUtil,Routes,SharedDataApis,authStream,storageService,authModalService,vatValidationApi,UrlService){function $onInit(){$ctrl.localData=storageService.get(storageService.KEY.GROUP_MEMBERSHIP_PARAMETERS),storageService.remove(storageService.KEY.GROUP_MEMBERSHIP_PARAMETERS),$ctrl.calculated={},$ctrl.isLoggedIn=!1,$ctrl.submitting=!1,$ctrl.params={},$ctrl.form={data:{no_of_seats:_.get($ctrl.localData,"[no_of_seats]")||InputUtil.toInt($ctrl.minNumberOfSeats),paymentMethod:void 0,vat_number:_.get($ctrl.localData,"[vat_number]")||"",organisation:{title:_.get($ctrl.localData,"[organisation_name]")||null,id:_.get($ctrl.localData,"[organisation_id]")||null},team_name:_.get($ctrl.localData,"[team_name]")||null,company_address_line_1:_.get($ctrl.localData,"[company_address_line_1]")||"",company_address_line_2:_.get($ctrl.localData,"[company_address_line_2]")||"",company_city:_.get($ctrl.localData,"[company_city]")||"",company_postal_code:_.get($ctrl.localData,"[company_postal_code]")||"",contact_email:_.get($ctrl.localData,"[contact_email]")||""}},$ctrl.paymentMethods=[],$ctrl.currencySymbol="",$ctrl.currency=$ctrl.defaultCurrency,$ctrl.noOfSeatsData=[],$ctrl.rateCards=[],$ctrl.taxRate=0,$ctrl.vatIncluded=!1,$ctrl.vatExempt=!1,$ctrl.channel="MembershipGroupsPurchaseStep1",$ctrl.postUrl="",$ctrl.refreshingPricing=!1,$ctrl.maxSeats=MembershipConfig.GROUP_PLAN_MAX_SEATS,$ctrl.countries=[],$ctrl.slider={value:$ctrl.form.data.no_of_seats,options:{floor:5,ceil:100,showSelectionBar:!0,ticksArray:[5,15,30,50,100],showTicksValues:!0,onEnd:function(){$ctrl.form.data.no_of_seats=$ctrl.slider.value>MembershipConfig.GROUP_PLAN_MAX_SEATS+1?MembershipConfig.GROUP_PLAN_MAX_SEATS+1:$ctrl.slider.value,$ctrl.onNoOfSeatsChange()},customValueToPosition:function(val){return val<15?(val-5)/10*.25:val<30?(val-15)/15*.25+.25:val<50?(val-30)/20*.25+.5:(val-50)/50*.25+.75},customPositionToValue:function(position){return position<.25?4*position*10+5:position<.5?4*(position-.25)*15+15:position<.75?4*(position-.5)*20+30:4*(position-.75)*50+50},translate:function(value,sliderId,label){return 100==value&&"tick-value"==label?"100+":value}}},FormService=new FormServiceFactory($ctrl.form),allPaymentMethods=[{key:"cc_monthly",planPeriod:MembershipConfig.MEMBERSHIP_PLAN_MONTHLY,title:"Annual Plan - Pay Monthly by card",minSeats:0,automatic:!0},{key:"cc_yearly",planPeriod:MembershipConfig.MEMBERSHIP_PLAN_YEARLY,title:"Annual Plan - Pay Annually by card",minSeats:0,automatic:!0},{key:"inv_yearly",planPeriod:MembershipConfig.MEMBERSHIP_PLAN_YEARLY,title:"Annual Plan - Annual Invoice",minSeats:30,automatic:!1}],$ctrl.form.data.paymentMethod=_.find(allPaymentMethods,{key:_.get($ctrl.localData,"[payment_method]")||"cc_yearly"}),updatePaymentMethods(),listeners.push(authStream.USER_CHANGED.subscribe(onUserChanged)),$q.all([MembershipTierApi.get(),GroupMembershipBasePlanApi.get()]).then(pricingInit),SharedDataApis.COUNTRIES().then(function(res){$ctrl.countries=res.data,$log.debug("membershipGroupsPurchaseStep1::initCountries::onCountriesLoadedSuccess",$ctrl.countries)})}function pricingInit(res){tiers=_.get(res,"[0]"),basePlans=_.get(res,"[1]"),$log.debug("membershipGroupsPurchaseStep1::tiers",tiers),$log.debug("membershipGroupsPurchaseStep1::basePlans",basePlans),onNoOfSeatsDropdownChange()}function onPricingLoaded(payload){$ctrl.isLoaded=!0,recurlyData=payload,$log.debug("membershipGroupsPurchaseStep1::recurlyData",recurlyData),$ctrl.currencySymbol=recurlyData.currency.symbol,applyRecurlyData(recurlyData),calculatePrice(),$ctrl.refreshingPricing=!1}function onUserChanged(user){$ctrl.isLoggedIn=user.isLoggedIn()}function onPaymentMethodChange(){refreshPricing()}function onVatChange(){var countryObject;$ctrl.form.data.vat_number?countryObject=_.find($ctrl.countries,{country_code:$ctrl.form.data.vat_number.match(/\w{2}/)[0].toLowerCase()}):$ctrl.vat_changed=!0,countryObject?($ctrl.company_country_iso=countryObject.country_code,$ctrl.currency=countryObject.billing_currency):($ctrl.company_country_iso="",$ctrl.currency=$ctrl.defaultCurrency),refreshPricing()}function onNoOfSeatsDropdownChange(){$ctrl.slider.value=$ctrl.form.data.no_of_seats,$ctrl.onNoOfSeatsChange()}function onNoOfSeatsChange(){$ctrl.form.data.no_of_seats<MembershipConfig.GROUP_PLAN_MIN_SEATS&&($ctrl.form.data.no_of_seats=MembershipConfig.GROUP_PLAN_MIN_SEATS),updatePaymentMethods(),refreshPricing()}function changeNoOfSeats(seats){var newSeats=$ctrl.noOfSeatsData.filter(function(noOfSeats){return noOfSeats.seats==seats})[0];$ctrl.form.data.no_of_seats=newSeats.seats,$ctrl.onNoOfSeatsChange(),$ctrl.slider.value=$ctrl.form.data.no_of_seats}function planPeriod(){switch($ctrl.form.data.paymentMethod.planPeriod){case MembershipConfig.MEMBERSHIP_PLAN_YEARLY:return"year";case MembershipConfig.MEMBERSHIP_PLAN_MONTHLY:return"month"}return""}function submit($event){if($ctrl.form.ref.$invalid&&$ctrl.form.ref.$pending)return void $event.preventDefault();$ctrl.params={no_of_seats:$ctrl.form.data.no_of_seats,team_name:$ctrl.form.data.team_name,payment_method:$ctrl.form.data.paymentMethod.key,company_address_line_1:$ctrl.form.data.company_address_line_1,company_address_line_2:$ctrl.form.data.company_address_line_2,company_city:$ctrl.form.data.company_city,company_postal_code:$ctrl.form.data.company_postal_code,contact_email:$ctrl.form.data.contact_email,organisation_name:$ctrl.form.data.organisation.title,organisation_id:$ctrl.form.data.organisation.id||0,vat_number:$ctrl.form.data.vat_number||""},$ctrl.submitting=!0,$ctrl.form.data.vat_number?vatValidationApi.get({vatNumber:$ctrl.form.data.vat_number}).then(function(response){$ctrl.params.default_country_code=response.data.country_code,goToPayment($event)}):($ctrl.params.default_country_code=$ctrl.defaultCountryCode,goToPayment($event))}function goToPayment($event){storageService.set(storageService.KEY.GROUP_MEMBERSHIP_PARAMETERS,$ctrl.params),$ctrl.isLoggedIn?UrlService.changeUrl($ctrl.postUrl):($event.preventDefault(),authModalService.setSubscribeSource("membershipsGroups"),authModalService.openLogin("default",{},!0),$ctrl.submitting=!1)}function formatAmount(amount){return amount%1==0?numberFilter(amount,0):numberFilter(amount,2)}function updatePaymentMethods(){$ctrl.paymentMethods=allPaymentMethods.filter(function(paymentMethod){return isPaymentMethodAvailable(paymentMethod)}),isPaymentMethodAvailable($ctrl.form.data.paymentMethod)||($ctrl.form.data.paymentMethod=_.find($ctrl.paymentMethods,{key:"cc_yearly"}))}function isPaymentMethodAvailable(paymentMethod){return paymentMethod&&$ctrl.form.data.no_of_seats>=paymentMethod.minSeats}function calculatePrice(){buildRateCardsData(),buildNoOfSeatsData()}function buildRateCardsData(){$ctrl.rateCards=[],tiers.forEach(function(tier){$ctrl.rateCards[tier.plan_period]||($ctrl.rateCards[tier.plan_period]=[]);var price=tier.addons[MembershipConfig.DEFAULT_PLAN_ADDON].unit_amount_in_cents[$ctrl.currency]/100;tier.discount=calculateDiscount(price,MembershipConfig.MEMBERSHIP_PLAN_MONTHLY),tier.price=price,$ctrl.rateCards[tier.plan_period].push(tier)}),$log.debug("membershipGroupsPurchaseStep1::rateCards",$ctrl.rateCards)}function buildNoOfSeatsData(){var rateCardsTmp=_.keyBy($ctrl.rateCards[$ctrl.form.data.paymentMethod.planPeriod],"plan_code");$ctrl.noOfSeatsData=[];for(var i=MembershipConfig.GROUP_PLAN_MIN_SEATS;i<=MembershipConfig.GROUP_PLAN_MAX_SEATS;i++){var plan=pickPlan(i,$ctrl.form.data.paymentMethod.planPeriod),price=rateCardsTmp[plan.plan_code].price;$ctrl.noOfSeatsData.push({seats:i,price:price,label:i+" users at "+$ctrl.currencySymbol+price+" per seat / per "+$ctrl.planPeriod()})}$ctrl.noOfSeatsData.push({seats:MembershipConfig.GROUP_PLAN_MAX_SEATS+1,price:0,label:"More than 50 members"}),$log.debug("membershipGroupsPurchaseStep1::noOfSeatsData",$ctrl.noOfSeatsData)}function applyRecurlyData(data){var addonPrice=parseFloat(data.addons[MembershipConfig.DEFAULT_PLAN_ADDON]),planPeriod=$ctrl.form.data.paymentMethod.planPeriod,periodFactor=planPeriod===MembershipConfig.MEMBERSHIP_PLAN_MONTHLY?12:1;$ctrl.taxRate=_.isEmpty(data.taxes)?0:data.taxes[0].rate,$ctrl.vatIncluded=!_.isEmpty(data.taxes)&&data.taxes[0].rate>0,$ctrl.vatExempt=!_.isEmpty(data.taxes)&&data.taxes[0].rate<=0,$ctrl.calculated.seat_price=addonPrice+addonPrice*$ctrl.taxRate,$ctrl.calculated.yearly_total=data.now.total*periodFactor,$ctrl.calculated.total=data.now.total,$ctrl.calculated.currency=data.currency.symbol,$ctrl.calculated.discount=calculateDiscount(addonPrice,planPeriod)}function refreshPricing(){$ctrl.refreshingPricing=!0;var noOfSeats=$ctrl.form.data.no_of_seats>MembershipConfig.GROUP_PLAN_MAX_SEATS?MembershipConfig.GROUP_PLAN_MAX_SEATS:$ctrl.form.data.no_of_seats,plan=pickPlan(noOfSeats,$ctrl.form.data.paymentMethod.planPeriod);if(plan){$ctrl.plan_code=plan.plan_code,$ctrl.planTitle=plan.title,$ctrl.postUrl=Routes.MEMBERSHIP.GROUP_STEP_2.replace(":plan",plan.plan_code);var vatNumber=$ctrl.form.data.vat_number,countryISOCode=$ctrl.company_country_iso||$ctrl.defaultCountryCode,addon={name:MembershipConfig.DEFAULT_PLAN_ADDON,options:{quantity:noOfSeats}};recurlyPricingApi.get(plan.plan_code,countryISOCode,$ctrl.currency,null,vatNumber,addon).then(onPricingLoaded)}else fatalErrorAction("Plan doesn't exist")}function pickPlan(no_of_seats,period){var plan=null;return _.forEach(tiers,function(value){no_of_seats>=value.seats_min&&no_of_seats<=value.seats_max&&value.plan_period==period&&(plan=value)}),plan}function calculateDiscount(selectedPlanPrice,plan){plan=plan||$ctrl.form.data.paymentMethod.planPeriod;var periodFactor=plan===MembershipConfig.MEMBERSHIP_PLAN_MONTHLY?1:12,selectedBasePlan=basePlans.filter(function(basePlan){if(basePlan.plan_period===MembershipConfig.MEMBERSHIP_PLAN_MONTHLY)return!0}),selectedBasePlanPrice=selectedBasePlan[0].unit_amount_in_cents[$ctrl.currency]/100*periodFactor,discount=100-selectedPlanPrice/selectedBasePlanPrice*100;return discount>0?parseInt(discount):0}function fatalErrorAction(data){spawnModal(MembershipModals.FATAL_ERROR),TrackerService.track(MEMBERSHIP_EVENT.DOMAIN,"MembershipGroupFatalErrorModalOpen"),$log.error("Payment form error:",data)}function spawnModal(template){UiModalService.openModal({controller:"ModalGenericController",template:template,backdrop:"static",keyboard:!1})}function $onDestroy(){_.each(listeners,function(listener){listener.dispose()})}var $ctrl=this,listeners=[],recurlyData={},tiers=[],basePlans=[],FormService=null,allPaymentMethods=[],numberFilter=$filter("number");$ctrl.$onInit=$onInit,$ctrl.onPaymentMethodChange=onPaymentMethodChange,$ctrl.onVatChange=onVatChange,$ctrl.onNoOfSeatsDropdownChange=onNoOfSeatsDropdownChange,$ctrl.onNoOfSeatsChange=onNoOfSeatsChange,$ctrl.changeNoOfSeats=changeNoOfSeats,$ctrl.planPeriod=planPeriod,$ctrl.submit=submit,$ctrl.formatAmount=formatAmount,$ctrl.$onDestroy=$onDestroy}var membershipGroupsPurchaseStep1Component={bindings:{defaultCountryCode:"@",defaultCurrency:"@",defaultPlan:"@",minNumberOfSeats:"@"},templateUrl:"/templates/Accounts/Membership:groups_purchase_step_1",controller:MembershipGroupsPurchaseStep1Controller};angular.module("app.membership").component("membershipGroupsPurchaseStep1",membershipGroupsPurchaseStep1Component)}(),function(){"use strict";function MembershipMonthlyPaymentController(_,$q,$log,$timeout,TrackerService,MEMBERSHIP_EVENT,UrlService,MembershipTrackingService,membershipStream,recurlyStream,authStream,recurlyTokenApi,membershipIndividualApi,storageService,userConsentApi,journeyContextService,CONSENT_JOURNEY,UiModalService,MembershipModals,trackService){function $onInit(){$ctrl.isLoaded=!1,$ctrl.errorType=null,$ctrl.errorMessage="",$ctrl.isLoggedIn=!1,$ctrl.user={},$ctrl.pricingData={},listeners.push(authStream.USER_DATA_CHANGED.subscribe(onUserChanged),recurlyStream.BILLING_FORM_CHANGED.subscribe(onBillingFormChanged),recurlyStream.BILLING_COUNTRY_CHANGED.subscribe(onCountryChanged),recurlyStream.PRICING_RELOADED.subscribe(onPricingChange),recurlyStream.COUPON_CHANGED.subscribe(onCouponChanged),membershipStream.USER_FORM_CHANGED.subscribe(onUserFormChanged))}function $onDestroy(){_.each(listeners,function(listener){listener.dispose()})}function onPricingChange(payload){$ctrl.isLoaded||($ctrl.isLoaded=!0),$ctrl.pricingData=payload.pricingData}function onCouponChanged(newCoupon){$ctrl.couponName=newCoupon.name,$ctrl.couponCode=newCoupon.code}function canSubmit(){$ctrl.enableValidation=!0;var isValid=form.billing.isValid&&form.consents.isValid&&($ctrl.isLoggedIn||form.user.isValid);return $log.debug("MembershipMonthlyPaymentController::canSubmit::isValid[%s]",isValid,form),isValid||(handleError("VALIDATION_ERROR",null),form.consents.isValid||($ctrl.consentErrors=form.consents)),TrackerService.track(MEMBERSHIP_EVENT.DOMAIN,isValid?"MembershipValidFormSubmit":"MembershipInvalidFormSubmit"),isValid}function buildDataForAPI(token){var apiData={token:token,plan_code:$ctrl.planCode,currency:$ctrl.billingCountry.billing_currency,coupon_code:$ctrl.couponCode,source_data:MembershipTrackingService.getUserTrackingData()};return $ctrl.isLoggedIn||(apiData.first_name=_.get(form,"billing.formData.first_name"),apiData.last_name=_.get(form,"billing.formData.last_name"),apiData.email=_.get(form,"user.formData.email"),apiData.password=_.get(form,"user.formData.password"),apiData.country_id=_.parseInt(_.get($ctrl,"billingCountry.country_id")),apiData.source=USER_REGISTER_SOURCE_KEY,apiData.consents=_.get(form,"consents.formData"),apiData.journey_id=$ctrl.consentJourneyId),journeyContextService.addJourneyContextData(apiData,$ctrl.consentJourneyId)}function submit(){function submitToRecurly(){recurlyTokenApi.get(form.billing.formData).then(onTokenGetSuccess,onTokenGetError)}function cancelPayment(){deferred.resolve({canceled:!0})}function onTokenGetSuccess(token){function handleConsentSuccess(response){return individualPaymentApi(buildDataForAPI(token))}function onSubmitSuccess(response){$log.debug("MembershipMonthlyPaymentController::submit::onSubmitSuccess::",response),deferred.resolve(response),successAction(response)}function onSubmitError(response){$log.debug("MembershipMonthlyPaymentController::submit::onSubmitError::",response);handleError("SERVER_ERROR",function(message){return"INVALID_CONSENT_FOR_JOURNEY"===message||"INVALID_JOURNEY_ID"===message||"MISSING_CONSENT_FOR_JOURNEY"===message}(response.data.message)?"There was an error processing your request.":response.data.message),deferred.reject(response)}return $log.debug("MembershipMonthlyPaymentController::submit::onTokenGetSuccess",token),function(){var resolvedPromise=$q.defer();return resolvedPromise.resolve(),$ctrl.isLoggedIn?updateConsents():resolvedPromise.promise}().then(handleConsentSuccess).then(onSubmitSuccess).catch(onSubmitError)}function onTokenGetError(response){$log.debug("MembershipMonthlyPaymentController::submit::onTokenGetError",response),$ctrl.billingFormErrors=response,handleError("RECURLY",response.message),deferred.reject(response)}$log.debug("MembershipMonthlyPaymentController::submit::",form),$ctrl.triggerTracking=!0;var deferred=$q.defer();return $ctrl.isLoggedIn&&"individual-student"===$ctrl.user.membership_type?showStudentUpsellModal().then(submitToRecurly,cancelPayment):submitToRecurly(),deferred.promise}function handleError(errorType,errorMessage){$ctrl.errors={type:errorType,message:errorMessage}}function showStudentUpsellModal(){return UiModalService.openModal({controller:"ModalGenericController",template:MembershipModals.STUDENT_MEMBER_UPSELL,backdrop:"static",keyboard:!1},{paymentPlan:"monthly"})}function onUserChanged(user){$log.debug("membershipMonthlyPayment::onUserChanged::",user),$ctrl.isLoggedIn=user.isLoggedIn(),$ctrl.consentJourneyId=$ctrl.isLoggedIn?CONSENT_JOURNEY.MembershipsPurchaseMonthlyLoggedinPayment:CONSENT_JOURNEY.MembershipsPurchaseMonthlyAnonymousPayment,$ctrl.user={email:user.email,first_name:user.firstname,last_name:user.lastname,membership_type:user.getMembershipType()},$ctrl.isLoggedIn?(individualPaymentApi=membershipIndividualApi.createSubscription,handleError()):individualPaymentApi=membershipIndividualApi.createUserAndSubscription}function successAction(response){function redirectToNextPage(){var accountId=_.get(response,"data.account_id"),journeyContextId=_.get(response,"data.journey_context_id"),userId=_.get(response,"data.user_id"),url=null,params={};accountId&&(params.order_number=accountId),journeyContextId&&(params.journey_context_id=journeyContextId),$ctrl.isLoggedIn||(params.registered=!0,trackService.track({subject:"user",subjectId:userId,action:"register"})),userId&&(params.user_id=userId),url=$ctrl.paymentConfirmationUrl,_.isEmpty(params)||(url+=UrlService.getQueryString(params)),UrlService.changeUrl(url)}storageService.set(storageService.KEY.USER_REGISTRATION_EMAIL,form.user.formData.email),$timeout(_.noop,2e3).then(redirectToNextPage)}function onCountryChanged(payload){$ctrl.billingCountry=payload.newValue}function onBillingFormChanged(billingData){billingData.isValid&&handleError(),form.billing=billingData}function onUserFormChanged(userData){form.user=userData}function onConsentsChange(event){form.consents=event}function updateConsents(){return userConsentApi.update(_.get(form,"consents.formData"),$ctrl.consentJourneyId,{source:"MembershipRegistrationConfirmationPage"})}var individualPaymentApi,$ctrl=this,listeners=[],USER_REGISTER_SOURCE_KEY="MembershipPaymentRegistration",form={billing:{},user:{},consents:{}};$ctrl.consentErrors=[],$ctrl.triggerTracking=!1,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,$ctrl.onConsentsChange=onConsentsChange}var membershipMonthlyPaymentComponent={templateUrl:"/assets-access-layer/js/site/Membership/Component/membership-monthly-payment.html",bindings:{planCode:"@",planTitle:"@",planChangeUrl:"@",planTrialLengthDays:"@",planIntervalMonths:"@",defaultCountryCode:"@",paymentConfirmationUrl:"@"},controller:MembershipMonthlyPaymentController};angular.module("app.membership").component("membershipMonthlyPayment",membershipMonthlyPaymentComponent)}(),function(){"use strict";function MembershipPartnerRefreshController($log,$timeout,authStream,authService){function $onInit(){$ctrl.status="PROCESSING",userChangedSub=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){currentUser=user,membershipType=currentUser.getMembershipType(),membershipType?$ctrl.status="SUCCESS":refreshToken()}function refreshToken(){if(refreshCount<=4){var countdown=refreshCount<=1?5e3:5e3*refreshCount;$timeout(function(){authService.refreshAccessToken().then(function(){$log.debug("membershipPartnerRefreshComponent::user token refreshed!"),refreshCount++,(membershipType=currentUser.getMembershipType())||refreshToken()})},countdown)}else $ctrl.status="ERROR"}function $onDestroy(){userChangedSub.dispose()}var membershipType,currentUser,userChangedSub,$ctrl=this,refreshCount=0;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var membershipPartnerRefreshComponent={templateUrl:"/assets-access-layer/js/site/Membership/templates/membership-partner-refresh.template.html",bindings:{page:"@"},controller:MembershipPartnerRefreshController};angular.module("app.membership").component("membershipPartnerRefresh",membershipPartnerRefreshComponent)}(),function(){"use strict";function MembershipPlanCardController(_,membershipPlanApi,utmService,UrlService,journeyContextService){function $onInit(){$ctrl.isLoaded=!1,$ctrl.pricingPeriod=$ctrl.pricingPeriod||null,$ctrl.planPaymentUrl=$ctrl.redirectUrl,compiledCallout=_.template($ctrl.callout),compiledPriceSummary1=_.template($ctrl.priceSummary1),compiledPriceSummary2=_.template($ctrl.priceSummary2),membershipPlanApi.get($ctrl.planCode,$ctrl.pricingPeriod).then(onPlanDataSuccess)}function onClick(){utmService.saveUTMParams({utm_source:"BoF",utm_medium:"direct",utm_content:$ctrl.source,utm_campaign:$ctrl.source}),UrlService.changeUrl($ctrl.planPaymentUrl)}function onPlanDataSuccess(plan){var journeyContextObject=$ctrl.articleSlug?{articleSlug:$ctrl.articleSlug}:{};if($ctrl.redirectUrl)$ctrl.planPaymentUrl=$ctrl.redirectUrl;else switch($ctrl.planPaymentUrl=journeyContextService.generatePaymentPlanUrl(plan.plan_payment_url,journeyContextObject,$ctrl.page&&"MembershipsMarketing"===$ctrl.page),$ctrl.source){case"ProfessionalHardPaywallWidget":$ctrl.planPaymentUrl+="&int_source=hard-paywall&int_medium=card&int_campaign=permanent-professional&int_content=professional-hard-paywall-annual&int_term=article";break;case"ProfessionalListingWidget":$ctrl.planPaymentUrl+="?int_source=category-page&int_medium=card&int_campaign=permanent-professional&int_content=professional-purchase-annually";break;case"voicesLivestreamPaywall":$ctrl.planPaymentUrl+="?int_source=voices-livestream-wall&int_medium=card&int_campaign=permanent-professional&int_content=professional-purchase-annually"}$ctrl.isDiscounted=!_.isNil(plan.plan_data.prices.original_price),$ctrl.currencySymbol=plan.plan_data.prices.symbol,$ctrl.originalPrice=plan.plan_data.prices.original_price,$ctrl.priceUnit=plan.plan_data.prices.price_unit,$ctrl.priceDecimal=plan.plan_data.prices.price_decimal,$ctrl.priceLabel=plan.plan_data.prices.price_label,$ctrl.callout&&($ctrl.calloutText=compiledCallout({currency:plan.currency,currencySymbol:$ctrl.currencySymbol})),$ctrl.priceSummary1&&($ctrl.priceSummary1Text=compiledPriceSummary1({currency:plan.currency,currencySymbol:$ctrl.currencySymbol,originalYearlyPrice:plan.plan_data.prices.original_yearly_price,pricingPeriod:$ctrl.pricingPeriod})),$ctrl.priceSummary2&&($ctrl.priceSummary2Text=compiledPriceSummary2({currencySymbol:$ctrl.currencySymbol})),$ctrl.isLoaded=!0}var compiledCallout,compiledPriceSummary1,compiledPriceSummary2,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.onClick=onClick}var membershipPlanCardComponent={templateUrl:"/assets-access-layer/js/site/Membership/Component/membership-plan-card.html",bindings:{planCode:"@",cssClass:"@",cardTitle:"@",subtitle:"@",discountedLabel:"@",buttonLabel:"@",callout:"@",priceSummary1:"@",priceSummary2:"@",pricingPeriod:"@",hoverEffect:"<",source:"@",articleSlug:"@",page:"@",showCoursesBadge:"<",redirectUrl:"@"},controller:MembershipPlanCardController};angular.module("app.membership").component("membershipPlanCard",membershipPlanCardComponent)}(),function(){"use strict";function MembershipRepaperingBannerController(_,consentStream,storageService,RepaperingSettings,moment){function $onInit(){$ctrl.showBanner=!1,consentStream.SHOW_MEMBERSHIP_REPAPERING.subscribe(onMembershipRepaperingChange)}function onMembershipRepaperingChange(data){$ctrl.showBanner=!(!data.is_visible||!isAfterRepaperingSkipPeriod())&&_.includes(["member-access"],$ctrl.articleAccessType),$ctrl.url=data.url}function isAfterRepaperingSkipPeriod(){var lastRepaperingSkip=storageService.get(storageService.KEY.LAST_REPAPERING_SKIP);return _.isNil(lastRepaperingSkip)||moment().isAfter(moment(lastRepaperingSkip).add(RepaperingSettings.MAX_CONSENT_SKIP_HOURS,"hours"))}function $onDestroy(){consentStream.dispose()}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var membershipRepaperingBannerComponent={templateUrl:"/assets-access-layer/js/site/Membership/Component/membership-repapering-banner.html",bindings:{page:"@",articleId:"@",articleCategorySlug:"@",articleAccessType:"@"},controller:MembershipRepaperingBannerController};angular.module("app.membership").component("membershipRepaperingBanner",membershipRepaperingBannerComponent)}(),function(){"use strict";function MembershipSharedLoginBannerController(_,moment,authStream,storageService,UiModalService,AuthEvents,EventManager){function $onInit(){userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){var ProductVariants={TEAMS_TIER_MANUAL:"TEAM",GROUPS_TIER_MANUAL:"TEAM",TEAMS_TIER_1_ANNUAL:"TEAM",TEAMS_TIER_2_ANNUAL:"TEAM",TEAMS_TIER_3_ANNUAL:"TEAM",TEAMS_TIER_1_MONTHLY:"TEAM",TEAMS_TIER_2_MONTHLY:"TEAM",TEAMS_TIER_3_MONTHLY:"TEAM",INDIVIDUAL_YEARLY:"INDIVIDUAL",INDIVIDUAL_MONTHLY:"INDIVIDUAL",INDIVIDUAL_STUDENT:"STUDENT"},membershipProductVariant=_.toUpper(_.replace(user.getMembershipType(),"-","_"));if(membershipProductVariant=_.get(ProductVariants,membershipProductVariant,"INDIVIDUAL"),user.isLoggedIn()&&!isBannerDismissed()&&user.shared_login_count>=SHARED_LOGIN_ALERT_COUNT){EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0});UiModalService.openModal({controller:"ModalGenericController",template:"/assets-access-layer/js/site/Membership/templates/bof-professional-shared-login-modal.html",backdrop:!1,keyboard:!1},{email:user.email,package:membershipProductVariant,label:_.capitalize(membershipProductVariant),page:$ctrl.page,userId:user.id,deviceId:user.getDeviceId()}).then(function(){storageService.set(storageService.KEY.MEMBERSHIP_SHARED_LOGIN_DISMISSAL_DATE,moment()),EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!1})})}}function isBannerDismissed(){var modalDismissalTimestamp=storageService.get(storageService.KEY.MEMBERSHIP_SHARED_LOGIN_DISMISSAL_DATE);return modalDismissalTimestamp&&moment().diff(modalDismissalTimestamp,"days")<MODAL_DISMISSAL_DAYS}function $onDestroy(){userChangedSub.dispose()}var userChangedSub,$ctrl=this,MODAL_DISMISSAL_DAYS=7,SHARED_LOGIN_ALERT_COUNT=10;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var membershipSharedLoginBannerComponent={bindings:{page:"@"},controller:MembershipSharedLoginBannerController};angular.module("app.membership").component("membershipSharedLoginBanner",membershipSharedLoginBannerComponent)}(),function(){"use strict";function MembershipYearlyPaymentController(_,$q,$log,$timeout,authModalService,TrackerService,MEMBERSHIP_EVENT,UrlService,MembershipTrackingService,membershipStream,recurlyStream,authStream,recurlyTokenApi,membershipIndividualApi,storageService,userConsentApi,journeyContextService,CONSENT_JOURNEY,UiModalService,MembershipModals,trackService){function $onInit(){$ctrl.isLoaded=!1,$ctrl.errorType=null,$ctrl.errorMessage="",$ctrl.isLoggedIn=!1,$ctrl.user={},$ctrl.pricingData={},$ctrl.shippingFormEnabled=!1,$ctrl.offerCode=$ctrl.offerCode?$ctrl.offerCode:null,$ctrl.offerUserId=null,$ctrl.offerDiscountCode=null,_.isString($ctrl.offerCode)&&("course-offer"===$ctrl.offerCode?$ctrl.offerDiscountCode="courseupselloffer_v1":($ctrl.offerUserId=_.toInteger(_.get($ctrl.offerCode.match(new RegExp("^[^-]+")),"[0]")),$ctrl.offerUserId=$ctrl.offerUserId?$ctrl.offerUserId:null,$ctrl.offerDiscountCode=_.get($ctrl.offerCode.match(new RegExp("-(.*)")),"[1]"))),listeners.push(authStream.USER_DATA_CHANGED.subscribe(onUserChanged),recurlyStream.BILLING_FORM_CHANGED.subscribe(onBillingFormChanged),recurlyStream.BILLING_COUNTRY_CHANGED.subscribe(onCountryChanged),recurlyStream.PRICING_RELOADED.subscribe(onPricingChange),recurlyStream.COUPON_CHANGED.subscribe(onCouponChanged),membershipStream.USER_FORM_CHANGED.subscribe(onUserFormChanged),membershipStream.SHIPPING_ADDRESS_CHANGED.subscribe(onShippingAddressChanged))}function $onDestroy(){_.each(listeners,function(listener){listener.dispose()})}function onPricingChange(payload){$ctrl.isLoaded||($ctrl.isLoaded=!0),$ctrl.pricingData=payload.pricingData}function onCouponChanged(newCoupon){$ctrl.couponName=newCoupon.name,$ctrl.couponCode=newCoupon.code}function canSubmit(){$ctrl.enableValidation=!0;var isValid=form.billing.isValid&&form.consents.isValid&&($ctrl.isLoggedIn||form.user.isValid)&&(!$ctrl.shippingFormEnabled||form.shipping.isValid);return $log.debug("MembershipYearlyPaymentController::canSubmit::isValid[%s]",isValid,form),isValid||(handleError("VALIDATION_ERROR",null),form.consents.isValid||($ctrl.consentErrors=form.consents)),TrackerService.track(MEMBERSHIP_EVENT.DOMAIN,isValid?"MembershipValidFormSubmit":"MembershipInvalidFormSubmit"),isValid}function buildDataForAPI(token){var apiData={token:token,plan_code:$ctrl.planCode,currency:$ctrl.billingCountry.billing_currency,coupon_code:$ctrl.couponCode,source_data:MembershipTrackingService.getUserTrackingData()};return $ctrl.isLoggedIn||(apiData.first_name=_.get(form,"billing.formData.first_name"),apiData.last_name=_.get(form,"billing.formData.last_name"),apiData.email=_.get(form,"user.formData.email"),apiData.password=_.get(form,"user.formData.password"),apiData.country_id=_.parseInt(_.get($ctrl,"billingCountry.country_id")),apiData.source=USER_REGISTER_SOURCE_KEY,apiData.consents=_.get(form,"consents.formData"),apiData.journey_id=$ctrl.consentJourneyId),$ctrl.shippingFormEnabled&&(_.assign(apiData,form.shipping.formData),apiData.shipping_country_id=_.parseInt(_.get(form,"shipping.formData.shipping_country_id"))||null),journeyContextService.addJourneyContextData(apiData,$ctrl.consentJourneyId)}function submit(){function submitToRecurly(){recurlyTokenApi.get(form.billing.formData).then(onTokenGetSuccess,onTokenGetError)}function cancelPayment(){deferred.resolve({canceled:!0})}function onTokenGetSuccess(token){function onSubmitSuccess(response){$log.debug("MembershipYearlyPaymentController::submit::onSubmitSuccess::",response),deferred.resolve(response),successAction(response)}function handleConsentSuccess(response){return individualPaymentApi(buildDataForAPI(token))}function onSubmitError(response){$log.debug("MembershipYearlyPaymentController::submit::onSubmitError::",response);handleError("SERVER_ERROR",function(message){return"INVALID_CONSENT_FOR_JOURNEY"===message||"INVALID_JOURNEY_ID"===message||"MISSING_CONSENT_FOR_JOURNEY"===message}(response.data.message)?"There was an error processing your request.":response.data.message),deferred.reject(response)}return $log.debug("MembershipYearlyPaymentController::submit::onTokenGetSuccess",token),function(){var resolvedPromise=$q.defer();return resolvedPromise.resolve(),$ctrl.isLoggedIn?updateConsents():resolvedPromise.promise}().then(handleConsentSuccess).then(onSubmitSuccess).catch(onSubmitError)}function onTokenGetError(response){$log.debug("MembershipYearlyPaymentController::submit::onTokenGetError",response),$ctrl.billingFormErrors=response,handleError("RECURLY",response.message),deferred.reject(response)}$log.debug("MembershipYearlyPaymentController::submit::",form),$ctrl.triggerTracking=!0;var deferred=$q.defer();return $ctrl.isLoggedIn&&"individual-student"===$ctrl.user.membership_type?showStudentUpsellModal().then(submitToRecurly,cancelPayment):submitToRecurly(),deferred.promise}function handleError(errorType,errorMessage){$ctrl.errors={type:errorType,message:errorMessage}}function showStudentUpsellModal(){return UiModalService.openModal({controller:"ModalGenericController",template:MembershipModals.STUDENT_MEMBER_UPSELL,backdrop:"static",keyboard:!1},{paymentPlan:"annual"})}function onUserChanged(user){$log.debug("membershipYearlyPayment::onUserChanged::",user),$ctrl.isLoggedIn=user.isLoggedIn(),$ctrl.consentJourneyId=$ctrl.isLoggedIn?CONSENT_JOURNEY.MembershipsPurchaseAnnualLoggedinPayment:CONSENT_JOURNEY.MembershipsPurchaseAnnualAnonymousPayment,$ctrl.user={email:user.email,first_name:user.firstname,last_name:user.lastname,membership_type:user.getMembershipType()},"course-offer"===$ctrl.offerCode&&($ctrl.defaultCouponCode=$ctrl.offerDiscountCode),$ctrl.isLoggedIn?(individualPaymentApi=membershipIndividualApi.createSubscription,handleError(),$ctrl.offerDiscountCode&&"course-offer"!==$ctrl.offerCode&&applyOfferDiscountCode(user.getId())):($ctrl.offerDiscountCode&&"course-offer"!==$ctrl.offerCode?onCouponChanged({}):$ctrl.offerDiscountCode&&"course-offer"===$ctrl.offerCode&&authModalService.openLogin("default",{},!0).catch(onModalClose),individualPaymentApi=membershipIndividualApi.createUserAndSubscription)}function onModalClose(){UrlService.gotoHomepage()}function applyOfferDiscountCode(userId){userId!==$ctrl.offerUserId?handleError("OFFER","This offer is not applicable to your account!"):$ctrl.defaultCouponCode=$ctrl.offerDiscountCode}function successAction(response){function redirectToNextPage(){var accountId=_.get(response,"data.account_id"),journeyContextId=_.get(response,"data.journey_context_id"),userId=_.get(response,"data.user_id"),url=null,params={};accountId&&(params.order_number=accountId),journeyContextId&&(params.journey_context_id=journeyContextId),$ctrl.isLoggedIn||(params.registered=!0,trackService.track({subject:"user",subjectId:userId,action:"register"})),userId&&(params.user_id=userId),url=$ctrl.paymentConfirmationUrl,_.isEmpty(params)||(url+=UrlService.getQueryString(params)),UrlService.changeUrl(url)}storageService.set(storageService.KEY.USER_REGISTRATION_EMAIL,form.user.formData.email),$timeout(_.noop,2e3).then(redirectToNextPage)}function onCountryChanged(payload){$ctrl.billingCountry=payload.newValue}function onBillingFormChanged(billingData){billingData.isValid&&handleError(),form.billing=billingData}function onShippingAddressChanged(shippingData){form.shipping=shippingData}function onUserFormChanged(userData){form.user=userData}function onShippingToggled(){}function onConsentsChange(event){form.consents=event}function updateConsents(){return userConsentApi.update(_.get(form,"consents.formData"),$ctrl.consentJourneyId,{source:"MembershipRegistrationConfirmationPage"})}var individualPaymentApi,$ctrl=this,listeners=[],USER_REGISTER_SOURCE_KEY="MembershipPaymentRegistration",form={billing:{},user:{},shipping:{},consents:{}};$ctrl.consentErrors=[],$ctrl.triggerTracking=!1,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.onShippingToggled=onShippingToggled,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,$ctrl.onConsentsChange=onConsentsChange}var membershipYearlyPaymentComponent={templateUrl:"/assets-access-layer/js/site/Membership/Component/membership-yearly-payment.html",bindings:{planCode:"@",planTitle:"@",planChangeUrl:"@",planTrialLengthDays:"@",planIntervalMonths:"@",planPrintIssueDate:"@",defaultCountryCode:"@",defaultCouponCode:"@",paymentConfirmationUrl:"@",offerCode:"@",courseKey:"@"},controller:MembershipYearlyPaymentController};angular.module("app.membership").component("membershipYearlyPayment",membershipYearlyPaymentComponent)}(),function(){"use strict";function ShippingAddressFormController(_,membershipStream,FormServiceFactory){function $onInit(){$ctrl.form={ref:null,data:formData},FormService=new FormServiceFactory($ctrl.form)}function $postLink(){enableValidationInitValue&&FormService.canSubmit()}function $onChanges(changesObj){changesObj.enableValidation&&changesObj.enableValidation.currentValue&&(FormService?FormService.canSubmit():enableValidationInitValue=!0),changesObj.firstName&&changesObj.firstName.currentValue&&!formData.shipping_first_name&&(formData.shipping_first_name=$ctrl.firstName),changesObj.lastName&&changesObj.lastName.currentValue&&!formData.shipping_last_name&&(formData.shipping_last_name=$ctrl.lastName),changesObj.countryId&&changesObj.countryId.currentValue&&!formData.shipping_country_id&&(formData.shipping_country_id=$ctrl.countryId)}function onFormFieldChange(){$ctrl.enableValidation&&FormService&&FormService.canSubmit(),emitChange()}function emitChange(){var formChangedPayload={formData:_.clone(formData),isValid:FormService.isValid()};_.isEqual(formChangedPayload,emittedPayload)||(emittedPayload=formChangedPayload,membershipStream.SHIPPING_ADDRESS_CHANGED.onNext(emittedPayload))}function $onDestroy(){}var FormService,emittedPayload,$ctrl=this,enableValidationInitValue=!1,formData={shipping_first_name:void 0,shipping_last_name:void 0,shipping_address_line_one:void 0,shipping_address_line_two:void 0,shipping_city_name:void 0,shipping_state:void 0,shipping_postal_code:void 0,shipping_country_id:void 0};$ctrl.onFormFieldChange=onFormFieldChange,$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$postLink=$postLink,$ctrl.$onDestroy=$onDestroy}var shippingAddressFormComponent={templateUrl:"/assets-access-layer/js/site/Membership/templates/shipping-address.html",bindings:{countryId:"<",firstName:"<",lastName:"<",enableValidation:"<"},controller:ShippingAddressFormController};angular.module("app.membership").component("shippingAddressForm",shippingAddressFormComponent)}(),function(){"use strict";function TermsFormController(membershipStream){function $onInit(){$ctrl.accepted_terms=!1,onCheckboxChange()}function onCheckboxChange(){membershipStream.TERMS_FORM_CHANGED.onNext({isValid:!!$ctrl.accepted_terms})}var $ctrl=this;$ctrl.onCheckboxChange=onCheckboxChange,$ctrl.$onInit=$onInit}var termsFormComponent={templateUrl:"/assets-access-layer/js/site/Membership/templates/terms-form.html",bindings:{enableValidation:"<"},controller:TermsFormController};angular.module("app.membership").component("termsForm",termsFormComponent)}(),angular.module("app.membership").constant("FormFieldMappings",{REQUEST_GROUP_SIZE:{REQUEST_GROUP_SIZE_1:{KEY:"5 - 15",VALUE:15},REQUEST_GROUP_SIZE_2:{KEY:"16 - 50",VALUE:50},REQUEST_GROUP_SIZE_3:{KEY:"51 - 500",VALUE:500},REQUEST_GROUP_SIZE_4:{KEY:"501 - 1000",VALUE:1e3},REQUEST_GROUP_SIZE_5:{KEY:"1001 +",VALUE:1e4}},COMPANY_SIZE:{COMPANY_SIZE_1:{KEY:"Myself only",VALUE:1},COMPANY_SIZE_2:{KEY:"2 - 10",VALUE:10},COMPANY_SIZE_3:{KEY:"11 - 50",VALUE:50},COMPANY_SIZE_4:{KEY:"51 - 200",VALUE:200},COMPANY_SIZE_5:{KEY:"201 - 500",VALUE:500},COMPANY_SIZE_6:{KEY:"501 - 1,000",VALUE:1e3},COMPANY_SIZE_7:{KEY:"1,001 - 5,000",VALUE:5e3},COMPANY_SIZE_8:{KEY:"5,001 - 10,000",VALUE:1e4},COMPANY_SIZE_9:{KEY:"> 10,000",VALUE:1e5}}}),angular.module("app.membership").constant("MembershipConfig",{MEMBERSHIP_PLAN_YEARLY:"yearly",MEMBERSHIP_PLAN_MONTHLY:"monthly",DEFAULT_PLAN_ADDON:"licence_1",GROUP_PLAN_MIN_SEATS:5,GROUP_PLAN_MAX_SEATS:50,SINGLE_COURSE_PRICE:195,SINGLE_COURSE_PRICE_CURRENCY:"USD"}),angular.module("app.membership").constant("MembershipModals",{FATAL_ERROR:"/templates/Accounts/Modal:fatal_error",ALREADY_SUBSCRIBED:"/templates/Accounts/Modal:already_subscribed",STUDENT_MEMBER_UPSELL:"/assets-access-layer/js/site/Membership/templates/modal-student-membership-upsell.template.html"}),angular.module("app.membership").service("MembershipStream",["$window","Stream","LazyStream",function($window,Stream,LazyStream){"use strict";return{INJECT:new LazyStream,CHANGE:new Stream,INIT:new Stream}}]),angular.module("app.membership").service("MembershipTrackingService",["_","$window","wallService","utmService",function(_,$window,wallService,utmService){"use strict";var articlesRead=[],articlesBlocked=[];wallService.retrieveCounter("article").then(function(counter){articlesRead=counter.getItems(),articlesBlocked=counter.getBlockedItems()}),this.getUserTrackingData=function(){var utmParams=utmService.getUTMParams();return{article_ids:articlesRead,last_article_id:_.last(articlesBlocked),source:_.get(utmParams,"firstTouch.utm_content")||null,source_last_touch:_.get(utmParams,"lastTouch.utm_content")||null,sub_source:_.get(utmParams,"firstTouch.utm_term")||null,sub_source_last_touch:_.get(utmParams,"lastTouch.utm_term")||null}}}]),function(){"use strict";function CurrencyConversionService(_,$q,$log,currencyConversionApi){var $ctrl=this;$ctrl.cache={},this.convert=function(price,currency){function cacheResponse(resolve){resolve($ctrl.cache[key])}function setCache(response){return $ctrl.cache[key]=response,response}if($log.debug("Membership::currencyConversion::get"),!price)throw new Error("Membership::currencyConversion::get::Missing price");_.isUndefined(currency)&&(currency="USD");var key=currency+"-"+price;return _.isUndefined($ctrl.cache[key])?currencyConversionApi.get(price,currency).then(setCache):$q(cacheResponse)}}CurrencyConversionService.$inject=["_","$q","$log","currencyConversionApi"],angular.module("app.membership").service("CurrencyConversionService",CurrencyConversionService)}(),function(){"use strict";function membershipProductVariantService(_){function getAdsTargetingKey(user){var membershipProductVariant=_.toUpper(_.replace(user.getMembershipType(),"-","_"));return membershipProductVariant=_.get(ProductVariants,[membershipProductVariant,"ads"],"non_member_registered")}var ProductVariants={TEAMS_TIER_MANUAL:{ads:"team_group"},GROUPS_TIER_MANUAL:{ads:"team_group"},TEAMS_TIER_1_ANNUAL:{ads:"team_group"},TEAMS_TIER_2_ANNUAL:{ads:"team_group"},TEAMS_TIER_3_ANNUAL:{ads:"team_group"},TEAMS_TIER_1_MONTHLY:{ads:"team_group"},TEAMS_TIER_2_MONTHLY:{ads:"team_group"},TEAMS_TIER_3_MONTHLY:{ads:"team_group"},INDIVIDUAL_YEARLY:{ads:"annual"},INDIVIDUAL_MONTHLY:{ads:"monthly"},INDIVIDUAL_STUDENT:{ads:"student"}};return{getAdsTargetingKey:getAdsTargetingKey}}membershipProductVariantService.$inject=["_"],angular.module("app.membership").factory("membershipProductVariantService",membershipProductVariantService)}(),angular.module("app.membership").service("GroupMembershipBasePlanApi",["_","GenericApiFactory","Routes","DataService",function(_,GenericApiFactory,Routes,DataService){"use strict";var GroupMembershipBasePlanApi=new GenericApiFactory(Routes.MEMBERSHIP.GROUP_BASE_PLAN),fields=["plan_code","seats_min","seats_max","unit_amount_in_cents","plan_period"];this.get=function(){return GroupMembershipBasePlanApi.get().then(function(response){return _.map(response.data,function(item){return item.unit_amount_in_cents=item.external_data.unit_amount_in_cents,_.pick(DataService.remapObject(item,{external_reference_id:"plan_code"}),fields)})})}}]),angular.module("app.membership").service("MembershipGroupApi",["GenericApiFactory","Routes",function(GenericApiFactory,Routes){"use strict";var MembershipGroupApi=new GenericApiFactory(Routes.MEMBERSHIP.GROUP);this.create=function(data){return MembershipGroupApi.post(data)}}]),angular.module("app.membership").service("MembershipTierApi",["_","GenericApiFactory","Routes","DataService",function(_,GenericApiFactory,Routes,DataService){"use strict";var MembershipTierApi=new GenericApiFactory(Routes.MEMBERSHIP.TIERS),fields=["title","plan_code","seats_min","seats_max","addons","plan_period"];this.get=function(){return MembershipTierApi.get().then(function(response){return _.map(response.data,function(item){return item.addons=_.keyBy(item.external_data.add_ons,"add_on_code"),item.title=item.product_variant_title,_.pick(DataService.remapObject(item,{external_reference_id:"plan_code"}),fields)})})}}]),function(){"use strict";function currencyConversionApi(_,$http,Routes){function get(price,currency){function resolveResponse(response){return _.get(response,"data.data")}var request={method:"GET",url:Routes.UTILITY.CURRENCY_CONVERSION,params:{price:price,currency:currency}};return $http(request).then(resolveResponse)}return{get:get}}currencyConversionApi.$inject=["_","$http","Routes"],angular.module("app.membership").factory("currencyConversionApi",currencyConversionApi)}(),function(){"use strict";function failedPaymentDataApi(_,Routes,$http){function get(accountId){return $http({method:"GET",url:_.replace(Routes.ACCOUNT.FAILED_PAYMENT_DATA,":accountId",accountId)}).then(function(response){return _.get(response,"data.data")})}return{get:get}}failedPaymentDataApi.$inject=["_","Routes","$http"],angular.module("app.membership").factory("failedPaymentDataApi",failedPaymentDataApi)}(),function(){"use strict";function freeTrialApi(_,Routes,GenericApiFactory){function get(){return freeTrialRequestApi.get().then(function(res){return _.get(res,"data")||[]})}var freeTrialRequestApi=new GenericApiFactory(Routes.CURRENT_USER.MEMBERSHIP.FREE_TRIAL);return{get:get}}freeTrialApi.$inject=["_","Routes","GenericApiFactory"],angular.module("app.membership").factory("freeTrialApi",freeTrialApi)}(),function(){"use strict";function membershipIndividualApi(_,$log,$http,GenericApiFactory,Routes){function createSubscription(data){return $log.debug("membershipIndividualApi::createSubscription::",data),MembershipIndividualApi.post(data)}function createUserAndSubscription(data){return $log.debug("membershipIndividualApi::createUserAndSubscription::",data),MembershipIndividualRegisterApi.post(data)}function upgradeSubscription(accountId,planCode){return $http({method:"POST",url:_.replace(Routes.MEMBERSHIP.INDIVIDUAL_UPGRADE,":account_id",accountId),data:{plan_code:planCode}})}var MembershipIndividualApi=new GenericApiFactory(Routes.MEMBERSHIP.INDIVIDUAL),MembershipIndividualRegisterApi=new GenericApiFactory(Routes.MEMBERSHIP.INDIVIDUAL_REGISTER);return{createSubscription:createSubscription,createUserAndSubscription:createUserAndSubscription,upgradeSubscription:upgradeSubscription}}membershipIndividualApi.$inject=["_","$log","$http","GenericApiFactory","Routes"],angular.module("app.membership").factory("membershipIndividualApi",membershipIndividualApi)}(),function(){"use strict";function membershipPlanApi(_,$http,$log,Routes){function get(planCode,pricingPeriod){function resolveResponse(response){return _.get(response,"data.data")}$log.debug("Membership::membershipPlanApi::get");var params=pricingPeriod?{pricing:pricingPeriod}:{};if(!planCode)throw new Error("Membership::membershipPlanApi::get::Missing planCode");var request={method:"GET",url:_.replace(Routes.ACCOUNT.MEMBERSHIPS_PLAN,":planCode",planCode),params:params};return $http(request).then(resolveResponse)}return{get:get}}membershipPlanApi.$inject=["_","$http","$log","Routes"],angular.module("app.membership").factory("membershipPlanApi",membershipPlanApi)}(),function(){"use strict";function partnerValidationApi(Routes,GenericApiFactory){function post(data){return partnerValidationApi.post(data)}var partnerValidationApi=new GenericApiFactory(Routes.MEMBERSHIP.PARTNER_VALIDATION_ENDPOINT);return{post:post}}partnerValidationApi.$inject=["Routes","GenericApiFactory"],angular.module("app.membership").factory("partnerValidationApi",partnerValidationApi)}(),function(){"use strict";function vatValidationApi(Routes,GenericApiFactory){function get(data){return vatValidationApi.get(data)}var vatValidationApi=new GenericApiFactory(Routes.MEMBERSHIP.VAT_VALIDATION_ENDPOINT);return{get:get}}vatValidationApi.$inject=["Routes","GenericApiFactory"],angular.module("app.membership").factory("vatValidationApi",vatValidationApi)}(),function(){"use strict";function MembershipCardController(_,$scope,authStream,freeTrialApi){function onUserChanged(user){vm.isLoggedIn=user.isLoggedIn(),vm.isLoaded=!0}function $destroy(){authStream.unsubscribe(listeners)}var vm=this,listeners=[];vm.isLoggedIn=!1,vm.isLoaded=!1,$scope.$on("$destroy",$destroy),listeners.push(authStream.USER_CHANGED.subscribe(onUserChanged))}MembershipCardController.$inject=["_","$scope","authStream","freeTrialApi"],angular.module("app.membership").controller("MembershipCardController",MembershipCardController)}(),function(){"use strict";function MembershipPartnerCheckModalController($scope,$sce,$modalInstance,$controller,modalParams,authModalService){function openSignup(){authModalService.setSubscribeSource("MembershipRegistrationFlow"),authModalService.openSignup("default",{email:modalParams.email})}function closeModal(){$scope.close()}$scope.email=modalParams.email,$scope.partner_id=modalParams.partner_id,$scope.partner_title=modalParams.partner_title,$scope.partner_description=$sce.trustAsHtml(modalParams.partner_description),$scope.brand_image_url=modalParams.brand_image_url,$scope.brand_image_width=modalParams.brand_image_width,$scope.brand_image_height=modalParams.brand_image_height,$scope.domain=modalParams.domain,$scope.openSignup=openSignup,$scope.closeModal=closeModal,function(){$controller("ModalGenericController",{$scope:$scope,$modalInstance:$modalInstance,modalParams:modalParams})}()}MembershipPartnerCheckModalController.$inject=["$scope","$sce","$modalInstance","$controller","modalParams","authModalService"],angular.module("app.membership").controller("MembershipPartnerCheckModalController",MembershipPartnerCheckModalController)}(),function(){"use strict";function membershipPartnerCheck(_,partnerValidationApi,UiModalService,EventManager,AuthEvents){function postLink(scope,element,attrs){function onBlur(event){(email=_.get(event,"currentTarget.value",null))&&checkIfPartner(email)}function checkIfPartner(email){partnerValidationApi.post({email:email}).then(function(res){_.isEmpty(res.data.account_id)||openModal(res.data)})}function openModal(data){EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0});var brand_image_url=_.get(data,"brand_image_url",null);UiModalService.openModal({controller:"MembershipPartnerCheckModalController",template:"/assets-access-layer/js/site/Membership/templates/membership-partner-modal.html",backdrop:"static",keyboard:!1},{email:email,partner_id:_.get(data,"partner_id",null),partner_title:_.get(data,"partner_title",null),partner_description:_.get(data,"partner_description",null),brand_image_url:brand_image_url?"assets-email"+brand_image_url:null,brand_image_width:_.get(data,"brand_image_width",null),brand_image_height:_.get(data,"brand_image_height",null),domain:_.get(data,"domain_name",null)}).then(function(){EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!1})})}var email=null;scope.redirectOnly="true"===scope.redirectOnly,element.bind("blur",onBlur)}return{restrict:"A",link:postLink}}membershipPartnerCheck.$inject=["_","partnerValidationApi","UiModalService","EventManager","AuthEvents"],angular.module("app.membership").directive("membershipPartnerCheck",membershipPartnerCheck)}(),angular.module("app.membership").service("membershipStream",["$window","Stream","LazyStream",function($window,Stream,LazyStream){"use strict";return{TERMS_FORM_CHANGED:new LazyStream,SHIPPING_ADDRESS_CHANGED:new LazyStream,USER_FORM_CHANGED:new LazyStream}}]),angular.module("app.share").controller("ShareGenericController",["$scope","$q","$window","FormServiceFactory","ShareService","UserService","modalParams","SalesforceService","SharedDataApis","_",function($scope,$q,$window,FormServiceFactory,ShareService,UserService,modalParams,SalesforceService,SharedDataApis,_){"use strict";function onCountriesLoadedSuccess(res){var values=[];_.map(res.data,function(item){values[item.country_id]=item.country_name}),$scope.countries=values}$scope.countries={},$scope.form={},$scope.data=modalParams||{},$scope.user=UserService.getCurrent(),$scope.done=!1,SharedDataApis.COUNTRIES().then(onCountriesLoadedSuccess);var $modalInstance=modalParams.modalInstance(),FormService=new FormServiceFactory($scope.form);$scope.canSubmit=function(){return FormService.canSubmit()},$scope.submit=function(){var data=angular.copy($scope.data),promise=null;if($scope.user.id&&angular.extend(data,{email:$scope.user.email,firstname:$scope.user.firstname,lastname:$scope.user.lastname}),data.article_id)promise=ShareService.shareArticle(data);else if(data.type_id){if(promise=ShareService.submitMessage(data),3===data.type_id){angular.extend(data,{country_id:$scope.user.country_id});var promise2=SalesforceService.submitMessage(transformSalesforceData(data));promise=$q.all([promise,promise2])}}else data.job_id?promise=ShareService.shareJob(data):data.course_id&&(promise=ShareService.shareCourse(data));return"BestCompanies"===data.type&&(promise=ShareService.shareBestCompanies(data)),promise.then(function(res){return $scope.done=!0,res},function(res){return $q.reject(res)}),promise},$scope.close=function(){$modalInstance.dismiss()};var transformSalesforceData=function(data){return{first_name:data.first_name,last_name:data.last_name,email:data.email,Secondary_Contact_Email__c:data.academic_email,phone:data.phone_number,country:$scope.countries[data.country_id]?$scope.countries[data.country_id]:"",company:data.school_institution,description:data.message,lead_source:"Inbound","00N1r00000JwHB0":"/education"}}}]),angular.module("app.share").directive("linkShare",["$modal","DataService","UiModalService",function($modal,DataService,UiModalService){"use strict";return{restrict:"A",scope:{sharedId:"@",jobId:"@",courseId:"@",message:"@",title:"@",titleSubmitted:"@",source:"@",type:"@",id:"@"},link:function(scope,element,attrs){element.bind("click",function(event){scope.openModal()}),scope.openModal=function(){var data={};scope.sharedId?data={article_id:scope.sharedId,message:scope.message,title:scope.title,titleSubmitted:scope.titleSubmitted,source:scope.source||"article"}:scope.jobId?data={job_id:parseInt(scope.jobId,10),message:scope.message,title:scope.title,titleSubmitted:scope.titleSubmitted,source:scope.source||"job"}:scope.courseId&&(data={course_id:parseInt(scope.courseId,10),message:scope.message,title:scope.title,titleSubmitted:scope.titleSubmitted,source:scope.source||"course"}),"BestCompanies"==scope.type&&(data={type:"BestCompanies",profile_id:parseInt(scope.id,10),source:scope.source||"BestCompanies"}),data.message=scope.message,data.title=scope.title,data.titleSubmitted=scope.titleSubmitted,UiModalService.openModal({template:"/templates/Message/share_form",controller:"ShareGenericController",size:"md"},data)}}}}]),angular.module("app.share").directive("sendModalForm",["modalService","EventManager","$window","authModalService","AuthEvents",function(modalService,EventManager,$window,authModalService,AuthEvents){"use strict";return{restrict:"A",scope:{sendModalMessage:"@",source:"@",modalTypeId:"@"},link:function(scope,element,attrs){var openModalBox,user=null,source=scope.source||"generic";openModalBox=function(typeId,templateUrlKey){modalService.open({templateUrl:"/templates/Form/"+templateUrlKey,controller:"ShareGenericController",size:"md",backdrop:!1,resolve:{modalData:function(){return{type_id:typeId,message:scope.message,source:source}}}},!0)},EventManager.on(AuthEvents.USER_CHANGED,function(data){user=data}),element.bind("click",function(){var templateUrlKey="feedback_form",typeId=scope.modalTypeId||1;"article"!=scope.sendModalMessage&&"opinion"!=scope.sendModalMessage||(typeId=2,templateUrlKey="article_form","generic"===source&&(source="pitch")),-1==["feedback_form","conferences_sponsorship","boards_form","course_apply_form"].indexOf(templateUrlKey)?user.id?openModalBox(typeId,templateUrlKey):(authModalService.setSubscribeSource(source),authModalService.openLogin("voicesLimit",{firewall:!0}).then(function(res){openModalBox(typeId,templateUrlKey)})):openModalBox(typeId,templateUrlKey)})}}}]),angular.module("app.share").directive("sendModalMessage",["_","EventManager","EventManagerUtility","UiModalService","AuthEvents","authModalService","UserService",function(_,EventManager,EventManagerUtility,UiModalService,AuthEvents,authModalService,UserService){"use strict";return{restrict:"A",scope:{sendModalMessage:"@",source:"@",modalTypeId:"@",backdrop:"@",hideAuthSwitch:"@"},link:function(scope,element){var openModalBox,listeners=[],isUserLoggedIn=!1,source=scope.source||"generic",hideAuthSwitchBool="true"===scope.hideAuthSwitch,user=UserService.getCurrent();listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(userData){isUserLoggedIn=userData.isLoggedIn(),user=isUserLoggedIn?userData:{}})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)}),openModalBox=function(typeId,templateUrlKey){UiModalService.openModal({template:"/templates/Message/"+templateUrlKey,controller:"ShareGenericController",size:"md",backdrop:"true"===scope.backdrop},{type_id:typeId,message:scope.message,source:source,hideAuthSwitch:hideAuthSwitchBool,url:window.location.href,first_name:user.firstname||"",last_name:user.lastname||"",academic_email:user.email||""})},element.bind("click",function(){var templateUrlKey="feedback_form",typeId=scope.modalTypeId||1;"article"!=scope.sendModalMessage&&"opinion"!=scope.sendModalMessage||(typeId=2,templateUrlKey="article_form","generic"===source&&(source="pitch")),"upsell"==scope.sendModalMessage&&(typeId=3,templateUrlKey="upsell_form"),"conferences-sponsorship"==scope.sendModalMessage&&(typeId=5,templateUrlKey="conferences_sponsorship"),"boards_application"==scope.sendModalMessage&&(typeId=8,templateUrlKey="boards_form"),"question"==scope.sendModalMessage&&(typeId=14,templateUrlKey="question_form"),"payment"==scope.sendModalMessage&&(typeId=15,templateUrlKey="question_form"),"student_question"==scope.sendModalMessage&&(typeId=16,templateUrlKey="student_question_form"),"groups_question"==scope.sendModalMessage&&(typeId=17,templateUrlKey="groups_question_form"),"voices_live"==scope.sendModalMessage&&(typeId=18,templateUrlKey="voices_live_form"),"shared_login"==scope.sendModalMessage&&(typeId=22,templateUrlKey="question_form"),"membership_partner"==scope.sendModalMessage&&(typeId=23,templateUrlKey="question_form");var nonLoggedInModalTypes=["feedback_form","conferences_sponsorship","boards_form","question_form","voices_live_form"];if(isUserLoggedIn||_.includes(nonLoggedInModalTypes,templateUrlKey))return void openModalBox(typeId,templateUrlKey);authModalService.setSubscribeSource(source),authModalService.openLogin("voicesLimit",{firewall:!0}).then(function(){openModalBox(typeId,templateUrlKey)})})}}}]),function(){"use strict";function ShareService(_,Routes,$http){function executeGenericShareHttp(routeAction,data){return $http({url:_.replace(Routes.MESSAGE.ROOT,":action",routeAction),method:"POST",data:data,validateCaptcha:!0})}function shareArticle(data){return executeGenericShareHttp("send_to_friend",data)}function shareJob(data){return executeGenericShareHttp("job_send_to_friend",data)}function shareCourse(data){return executeGenericShareHttp("course_send_to_friend",data)}function shareBestCompanies(data){return executeGenericShareHttp("best_companies_send_to_friend",data)}function submitMessage(data){return executeGenericShareHttp("submit",data)}return{shareArticle:shareArticle,shareJob:shareJob,shareCourse:shareCourse,shareBestCompanies:shareBestCompanies,submitMessage:submitMessage}}ShareService.$inject=["_","Routes","$http"],angular.module("app.share").factory("ShareService",ShareService)}(),angular.module("app.pusher").service("PusherService",["_","$pusher","ChannelManager","UserService","$evalAsync",function(_,$pusher,ChannelManager,UserService,$evalAsync){"use strict";var client=null,channels={};this.init=function(AppKey,AuthUrl){return client||(client=new Pusher(AppKey,{authEndpoint:AuthUrl,encrypted:!0})),$pusher(client)},this.destroy=function(){client&&(client.disconnect(),client=null)},this.get=function(){return client},this.subscribe=function(channel){return channels[channel]||(channels[channel]={pusherClient:client.subscribe(channel),channelManager:ChannelManager.subscribe(channel)},channels[channel].pusherClient.bind_all(function(event,data){$evalAsync(function(){channels[channel].channelManager.emit(event,data)})})),channels[channel].channelManager},this.isRequester=function(data){var currentUser=UserService.getCurrent();return!_.isEmpty(currentUser)&&parseInt(currentUser.id,10)===parseInt(data.updater_user_id,10)},this.getChannelName=function(channelNameTemplate,params){var res=[],part=[];return res=_.map(channelNameTemplate.split("-"),function(item){return part=item.split(":"),2===part.length?params[part[1]]||null:item}),_.filter(res).join("-")}}]),angular.module("app.nav").constant("MenuEvents",{TOGGLE_USER:"MenuToggleUser",TOGGLE_DROPDOWN:"MenuToggleDropdown"}),angular.module("app.nav").directive("navigationContainer",["$window","$timeout","EventManager","EventManagerUtility","DomService","NavigationManager","UiEvents",function($window,$timeout,EventManager,EventManagerUtility,DomService,NavigationManager,UiEvents){"use strict";return{restrict:"E",replace:!0,scope:{name:"@",swipe:"@",calculateHeight:"@"},template:'<div ng-style="customStyle" ng-class="{open: open}" ng-swipe-left="handleSwipeLeft()" ng-swipe-right="handleSwipeRight()" ng-transclude></div>',transclude:!0,link:function(scope,element,attrs){var elementRef=element[0],listeners=[];scope.open=!1,scope.customStyle={},NavigationManager.onChange(function(data){data.container===scope.name&&(scope.open=data.value)}),"left"==scope.swipe&&(scope.handleSwipeLeft=function(){NavigationManager.toggle(scope.name)}),"right"==scope.swipe&&(scope.handleSwipeRight=function(){NavigationManager.toggle(scope.name)}),scope.collapse=function(){NavigationManager.closeAll()},scope.repaint=function(){"spa"===scope.calculateHeight?scope.customStyle={height:DomService.getHeight()-DomService.getTop(elementRef)+"px"}:scope.customStyle={height:DomService.getHeight()+"px"}},scope.repaint(),listeners.push(EventManager.on(UiEvents.WINDOW_RESIZE,function(){scope.repaint()})),listeners.push(EventManager.on(UiEvents.INITIAL_REPAINT,function(){scope.repaint()})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.nav").directive("groupDropdown",["DomService","EventManager",function(DomService,EventManager){"use strict";return{restrict:"A",scope:{name:"@groupDropdown"},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){var uniqueId=DomService.getUniqueId(),status=!1;this.toggle=function(forceStatus){status=void 0===forceStatus?!status:forceStatus,status?$element.addClass("open"):$element.removeClass("open"),EventManager.emit("NavigationChangeDropdown",{emitter:uniqueId,status:status,container:$scope.name})},this.setActive=function(){$element.addClass("active")},this.getStatus=function(){return status},EventManager.on("NavigationChangeDropdown",function(data){data.emitter!==uniqueId&&(status=!1,$element.removeClass("open"))}),EventManager.on("NavigationClose",function(data){status&&(status=!1,$element.removeClass("open"))})}]}}]).directive("groupDropdownToggle",["$window","EventManager","GlobalTick","AgentService",function($window,EventManager,GlobalTick,AgentService){"use strict";return{restrict:"A",require:"^groupDropdown",link:function(scope,element,attrs,ctrl){var pathname=$window.location.pathname,disableMobile="true"===attrs.disableMobile;AgentService.isTouch()?disableMobile&&AgentService.isMobile()||element.on("click",function(event){event.preventDefault(),event.stopPropagation(),ctrl.toggle()}):(element.on("mouseout",function(event){GlobalTick.cancel()}),element.on("mouseover",function(event){event.preventDefault(),event.stopPropagation(),ctrl.getStatus()||GlobalTick.execute(function(){ctrl.toggle(!0)},500)})),-1!==pathname.indexOf(attrs.href)&&ctrl.setActive()}}}]).directive("groupDropdownMenu",["EventManager","GlobalTick",function(EventManager,GlobalTick){"use strict";return{restrict:"A",require:"^groupDropdown",link:function(scope,element,attrs,ctrl){element.on("mouseover",function(event){event.preventDefault(),event.stopPropagation()}),element.on("mouseout",function(event){event.preventDefault(),event.stopPropagation()})}}}]),angular.module("app.nav").directive("navigationItem",["NavigationManager",function(NavigationManager){"use strict";return{restrict:"A",replace:!0,transclude:!0,template:'<li ng-class="{active: active}" ng-transclude></li>',scope:!0,link:function(scope,element,attrs){scope.active=!1,scope.collapse=function(){NavigationManager.setValue("main",!1)}}}}]),angular.module("app.nav").directive("navigationOpener",["NavigationManager",function(NavigationManager){"use strict";return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(){scope.$apply(function(){NavigationManager.toggle("main")})})}}}]),angular.module("app.nav").factory("NavigationManager",["DomService","EventManager",function(DomService,EventManager){"use strict";function Factory(){this.listeners=[],this.containers={main:!1,user:!1},this.onChange=function(listener){return navigationEventManager.on(listener)},this.setValue=function(container,value){navigationEventManager.emit({container:container,value:value}),this.containers[container]=value},this.toggle=function(container){this.setValue(container,!this.containers[container])},this.closeAll=function(){var self=this;angular.forEach(this.containers,function(v,container){self.setValue(container,!1)})}}var navigationEventManager=(DomService.getBody(),EventManager.get("NavigationChange"));return new Factory}]),function(){"use strict";function menuStream(LazyStream){return{TOGGLE_USER:new LazyStream,TOGGLE_DROPDOWN:new LazyStream}}menuStream.$inject=["LazyStream"],angular.module("app.nav").factory("menuStream",menuStream)}(),angular.module("app.home").controller("IndexController",["$scope","$cookies","ArticleService",function($scope,$cookies,ArticleService){"use strict";$scope.data=[1,2,3,4],$scope.interval=5e3,$cookies.subscribePopupPageview?$cookies.subscribePopupPageview++:$cookies.subscribePopupPageview=1}]),angular.module("app.home").directive("cookiesNotification",["storageService",function(storageService){return{scope:{policyLink:"@"},template:'<div ng-show="show" class="navbar-default navbar navbar-notification text-center small-font background-gray-darkest color-brand-white"><span class="navbar-notification-info inline-block sans-serif">By continuing to use this site, you agree to the use of cookies. <a class="cursor-pointer inherit-color text-underline" href="{[{ policyLink }]}">Find out more</a>.</span><span class="navbar-notification-close pull-right hover-keep-color inherit-color" ng-click="closeCookies()"><i class="icon-close cursor-pointer" aria-hidden="true"></i></span></div>',replace:!0,restrict:"E",link:function(scope){scope.show=!storageService.get(storageService.KEY.COOKIE_NOTIFICATION),scope.closeCookies=function(){storageService.set(storageService.KEY.COOKIE_NOTIFICATION,1),scope.show=!1}}}}]),angular.module("app.home").directive("sectionExpander",["$localStorage",function($localStorage){return{template:'<div class="container section-expander padded"><div class="col-sm-24"><div class="row relative header text-center"><i ng-click="toggle()" class="section-expander__icon  icon--reset  pull-left" ng-class="{\'cursor-pointer icon-circle-arrow s_homepage-icon-animation\': collapsed, \'cursor-pointer icon-circle-arrow s_homepage-icon-animation icon-rotate-180\': !collapsed}"></i><a ng-if="titleLink" class="hover-no-underline" href="{[{titleLink}]}"><h2 class="no-top-margin heavy-font offset-bottom-small">{[{title}]} <span class="h4 icon-large-arrow" style="position:relative;top:-4px;"></span></h2><p>{[{subtitle}]}</p></a><div ng-if="!titleLink"><i ng-click="toggle()" class="section-expander__icon  icon--reset  pull-left" ng-class="{\'cursor-pointer icon-circle-arrow s_homepage-icon-animation\': collapsed, \'cursor-pointer icon-circle-arrow s_homepage-icon-animation icon-rotate-180\': !collapsed}"></i><h2 class="no-top-margin offset-bottom-half">{[{title}]} <span class="h4 icon-large-arrow" style="position:relative;top:-4px;"></span></h2><h5>{[{subtitle}]}</h5></div></div><div class="row content" ng-class="{collapsed: collapsed}" ng-transclude></div></div></div>',replace:!0,restrict:"E",transclude:!0,scope:{id:"@",title:"@",subtitle:"@",sponsor:"@",titleLink:"@"},link:function(scope,element,attrs){scope.collapsed=void 0!==$localStorage[scope.id]&&$localStorage[scope.id],scope.toggle=function(){scope.collapsed=!scope.collapsed,$localStorage[scope.id]=scope.collapsed}}}}]),angular.module("app.discussion").directive("submitOpinion",["modalService","EventManager","$window","AuthEvents",function(modalService,EventManager,$window,AuthEvents){"use strict";return{restrict:"AE",link:function(scope,element,attrs){EventManager.on(AuthEvents.USER_CHANGED,function(user){scope.userLogin=!1,user&&user.id&&(scope.userLogin=!0)}),element.bind("click",function(event){scope.userLogin?scope.openModal():$window.location.href="/login?anchor=modal"}),scope.openModal=function(){modalService.open({templateUrl:"/templates/Message/article_form",controller:"ShareGenericController",size:"md",resolve:{modalData:function(){return{typeId:2}}}},!0)},$window.location.href.indexOf("#modal")>0&&scope.openModal()}}}]),function(){"use strict";function DiscussionApi($resource){return $resource("/xhr/discussions/:id",{id:"@id"},{getAll:{method:"GET"}})}DiscussionApi.$inject=["$resource"],angular.module("app.discussion").factory("DiscussionApi",DiscussionApi)}(),angular.module("app.discussion").service("DiscussionService",["DataService","DiscussionApi",function(DataService,DiscussionApi){var defaultFilters={limit:4,offset:0,order:"article_id",attributes:"all"};this.getAll=function(filters){return filters=DataService.createFilters(defaultFilters,filters),DiscussionApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!1),res})}}]),angular.module("app.daily_digest").controller("DailyDigestController",["$scope",function($scope){"use strict"}]),angular.module("app.daily_digest").directive("dailyDigestEmbedly",["$timeout","$window","DomService","UrlService","EventManager","UiEvents","EmbedlyService",function($timeout,$window,DomService,UrlService,EventManager,UiEvents,EmbedlyService){"use strict";return{restrict:"E",scope:{cards:"@"},link:function(scope,element,attrs){var maxCounter=parseInt(scope.cards,10)||100,counter=0;EmbedlyService.init(),EventManager.on(UiEvents.REPAINT,function(data){counter<=maxCounter&&(UrlService.hasAnchor()&&($window.location.href=$window.location.href),counter+=1)})}}}]),angular.module("app.daily_digest").directive("dailyDigestLoadMore",["DailyDigestService","PaginationService","moment","DataService","DateService","DomService","legacyTrackService","$timeout","EventManager","UiEvents",function(DailyDigestService,PaginationService,moment,DataService,DateService,DomService,legacyTrackService,$timeout,EventManager,UiEvents){"use strict";return{templateUrl:"/templates/DailyDigest/daily_digest",replace:!0,restrict:"E",scope:{limit:"@",nextPage:"@",autoload:"@"},link:function(scope,element,attrs){scope.items=[];var lock=!1,box=element[0],cnt=scope.autoload?parseInt(scope.autoload,10):2,filters={include_related:"true",date:scope.nextPage,min_limit:0};scope.loadMore=function(){lock||(lock=!0,DailyDigestService.getAll(filters).then(function(res){var date=filters.date?DateService.fromString(filters.date):new Date,item={date:date,articles:res.data.related,dd_articles:res.data.articles};scope.items.push(item),filters.date=res.data.next_page,lock=!1,legacyTrackService.pageView("/"+moment(date).format("YYYY/MM/DD")),EventManager.emit(UiEvents.REPAINT,{})}))},scope.refresh=function(){!lock&&cnt>0&&DomService.getAbsoluteBottom(box)<0&&(cnt-=1,scope.$apply(function(){scope.loadMore()}))},DomService.bind("scroll",scope.refresh),DomService.bind("touchmove",scope.refresh),DomService.bind("gesturechange",scope.refresh),$timeout(function(){DomService.goToAnchor()},3e3)}}}]),function(){"use strict";function DailyDigestApi($resource){return $resource("/xhr/daily-digest/:id",{id:"@id"},{getAll:{method:"GET"}})}DailyDigestApi.$inject=["$resource"],angular.module("app.daily_digest").factory("DailyDigestApi",DailyDigestApi)}(),angular.module("app.daily_digest").service("DailyDigestService",["DataService","DailyDigestApi",function(DataService,DailyDigestApi){var self=this,defaultFilters={};self.getAll=function(filters,removePrefix){return filters=DataService.createFilters(defaultFilters,filters),DailyDigestApi.getAll(filters).$promise.then(function(res){return res})},self.getArticles=function(filters,removePrefix){return filters=DataService.createFilters(defaultFilters,filters),DailyDigestApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data.articles,!1),res})}}]),angular.module("app.daily_digest").service("EmbedlyService",["$window","$q","$timeout","$interval","EventManager","UiEvents",function($window,$q,$timeout,$interval,EventManager,UiEvents){"use strict";var self=this,embedlyRef=null,loader=null,initialised=!1;this.init=function(){if(!initialised){initialised=!0;var tag=document.createElement("script");tag.async=1,tag.src="//cdn.embedly.com/widgets/platform.js";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),loader=$interval(function(){$window.embedly&&($interval.cancel(loader),embedlyRef=$window.embedly,self.initListeners())},500)}},this.initListeners=function(){$window.embedly("on","card.rendered",function(iframe){EventManager.emit(UiEvents.REPAINT,{source:"embedly"})})}}]),angular.module("app.article").component("instagramWidget",{controller:["InstagramWidgetService",function(InstagramWidgetService){"use strict";InstagramWidgetService.addWidget()}]}),angular.module("app.article").component("twitterWidget",{controller:["TwitterWidgetService",function(TwitterWidgetService){"use strict";TwitterWidgetService.addWidget()}]}),function(){"use strict";function MemberOnlyNoticeController(EventManagerUtility,EventManager,AuthEvents){function $onInit(){$ctrl.display=!1,listeners.push(EventManager.on(AuthEvents.USER_CHANGED,onUserChanged))}function onUserChanged(user){$ctrl.display=user.hasMembership()}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}var $ctrl=this,listeners=[];$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var memberOnlyNoticeComponent={template:'<div ng-if="$ctrl.display" ng-transclude></div>',transclude:!0,controller:MemberOnlyNoticeController};angular.module("app.article").component("memberOnlyNotice",memberOnlyNoticeComponent)}(),function(){"use strict";function StickyLeftPanelController($document,$window,$timeout,DomService,AgentService){function $onInit(){$document.on("scroll",onScroll)}function onScroll(){var docScrollTop=$document.scrollTop(),triggerNode=getTriggerNode();if(!triggerNode||0===triggerNode.length)return void($ctrl.show=!1);$ctrl.show=docScrollTop>getTriggerPoint(triggerNode)}function getTriggerPoint(trigger){return DomService.getAbsoluteTop(trigger[0])+$ctrl.offset}function getTriggerType(){return AgentService.isDesktop()?"desktop":"mobile"}function getTriggerNode(){return"desktop"===getTriggerType()?DomService.getElement($ctrl.desktopMarkerSelector):DomService.getElement($ctrl.mobileMarkerSelector)}var $ctrl=this;$ctrl.$onInit=$onInit}var stickyLeftPanelComponent={template:'<div class="sticky-left-panel" ng-show="$ctrl.show" ng-transclude></div>',transclude:!0,bindings:{desktopMarkerSelector:"<",mobileMarkerSelector:"<",offset:"<",show:"@"},controller:StickyLeftPanelController};angular.module("app.auth").component("stickyLeftPanel",stickyLeftPanelComponent)}(),angular.module("app.article").directive("articleEdit",["EventManager","AuthEvents",function(EventManager,AuthEvents){"use strict";return{template:'<div><a ng-if="canEdit" href="/wp/wp-admin/post.php?post={[{articleId}]}&action=edit&lang=en" class="btn btn-primary">{[{editText}]}</a></div>',replace:!0,restrict:"E",scope:{articleId:"@",editText:"@"},link:function(scope){scope.canEdit=!1,scope.editText=scope.editText||"Edit Article",EventManager.on(AuthEvents.USER_CHANGED,function(user){scope.canEdit=user.roles.hasRole("ROLE_EDITOR")})}}}]),angular.module("app.article").directive("fashionaryPopover",["EventManager","DomService",function(EventManager,DomService){"use strict";return{restrict:"A",scope:{},link:function(scope,element,attrs){var box=element[0];element.on("mouseover",function(event){scope.showPopUp(event),scope.$apply()}),element.on("mouseout",function(event){scope.hidePopUp(event),scope.$apply()}),scope.showPopUp=function(event){EventManager.emit("fashionaryDataChanged",{status:!0,item:{title:attrs.title,summary:attrs.summary,definition:attrs.definition},position:DomService.getPointerPosition(event),direction:scope.getDirection()})},scope.getDirection=function(){return DomService.getTop(box)>350?"top":"bottom"},scope.hidePopUp=function(event){EventManager.emit("fashionaryDataChanged",{status:!1})}}}}]).directive("fashionaryPopoverContainer",["EventManager","ImageService","DomService","$timeout",function(EventManager,ImageService,DomService,$timeout){"use strict";return{restrict:"E",replace:!0,transclude:!0,scope:{width:"@"},template:'<div class="popover {[{direction}]} rounded-corners-small" ng-style="customStyle"><div class="popover-inner panel-content bof-article-widget-single text-center"><p class="semi-bold-font large-font serif no-margin reset-line-height border-bottom-separator-small" ng-bind-html="item.title | raw"> </p><p class="offset-top offset-bottom-half" ng-bind-html="item.summary | raw"></p></div></div>',link:function(scope,element){var timer=null,box=element[0],maxWidth=scope.width||200,relativeLeft=parseInt(maxWidth/2,10);scope.data={},scope.direction="top",scope.customStyle={opacity:0,width:maxWidth+"px"},EventManager.on("fashionaryDataChanged",function(data){$timeout.cancel(timer),data.status?(data.opacity=1,data.zIndex=10,scope.item=data.item,scope.direction=data.direction):(data.opacity=0,data.zIndex=-1),scope.repaint(data)}),scope.repaint=function(data){timer&&$timeout.cancel(timer),timer=$timeout(function(){scope.customStyle.opacity=data.opacity,scope.customStyle.zIndex=data.zIndex,data.position&&("top"===data.direction?scope.customStyle.top=data.position.top-DomService.getHeight(box)-15+"px":scope.customStyle.top=data.position.top+15+"px",scope.customStyle.left=data.position.left-relativeLeft+"px")},200)},scope.hide=function(){scope.$apply(function(){scope.customStyle.opacity=0,scope.customStyle.top=0,scope.customStyle.left=0})},DomService.bind("scroll",scope.hide),DomService.bind("touchmove",scope.hide),DomService.bind("gesturechange",scope.hide),DomService.bind("resize",scope.hide)}}}]),angular.module("app.article").directive("articleIncludeContainer",["DomService","EventManager","legacyTrackService","$location","UrlService",function(DomService,EventManager,legacyTrackService,$location,UrlService){"use strict";return{template:'<div class="injected container"><div ng-include="pageUrl"></div></div>',replace:!0,restrict:"E",scope:{},link:function(scope,element,attrs){var url=null,path=null,title=null,smoothScroll=!1;scope.pageUrl=null,EventManager.on("articleInjectChange",function(data){data?url!==data.url&&(url=data.url,title=data.title,path=data.path,smoothScroll=data.smoothScroll,scope.pageUrl=data.url+"?container=true",legacyTrackService.pageView()):scope.pageUrl=null}),scope.scrollToSection=function(){var animationTime=1;smoothScroll&&(animationTime=500),DomService.scrollToElement(element,80,animationTime)},scope.$on("$includeContentLoaded",function(event,data){scope.scrollToSection()}),scope.$on("$includeContentRequested",function(event,data){scope.scrollToSection(),UrlService.setAbsolutePath(data,title,path.slice(1))})}}}]),angular.module("app.article").directive("articleInjector",["EventManager","$location","$window","$timeout","UrlService",function(EventManager,$location,$window,$timeout,UrlService){"use strict";return{template:'<div class="injector" ng-click="inject(true)" ng-class="{active: active}" ng-transclude></div>',replace:!0,restrict:"EA",transclude:!0,scope:{href:"@",originalHref:"@",title:"@"},link:function(scope,element,attrs){scope.active=!1;var path=UrlService.getLast(scope.href),rootPath=UrlService.getLast(UrlService.getPath($window.location.href)),url=scope.originalHref;scope.inject=function(smoothScroll){EventManager.emit("articleInjectChange",{title:scope.title,url:url,href:scope.href,path:path,smoothScroll:smoothScroll})},EventManager.on("articleInjectChange",function(data){data&&(data.url===url?scope.active=!0:scope.active=!1)}),rootPath===path&&scope.inject(!1)}}}]),angular.module("app.article").directive("profilePopover",["EventManager","DomService",function(EventManager,DomService){"use strict";return{restrict:"A",scope:{},link:function(scope,element,attrs){var box=element[0];element.on("mouseover",function(event){scope.showPopUp(event),scope.$apply()}),element.on("mouseout",function(event){scope.hidePopUp(event),scope.$apply()}),scope.showPopUp=function(event){EventManager.emit("profileDataChanged",{status:!0,item:{title:attrs.title,subtitle:attrs.subtitle,content:attrs.content,img:attrs.img},position:DomService.getPointerPosition(event),direction:scope.getDirection()})},scope.getDirection=function(){return DomService.getTop(box)>350?"top":"bottom"},scope.hidePopUp=function(event){EventManager.emit("profileDataChanged",{status:!1})}}}}]).directive("profilePopoverContainer",["EventManager","ImageService","DomService","$timeout","EventManagerUtility",function(EventManager,ImageService,DomService,$timeout,EventManagerUtility){"use strict";return{restrict:"E",replace:!0,transclude:!0,scope:{width:"@"},template:'<div class="popover {[{direction}]} rounded-corners-small" ng-style="customStyle"><div class="popover-inner panel-content bof-article-widget-single text-center"><p class="semi-bold-font large-font serif no-margin offset-bottom-small" ng-bind-html="item.title | raw"> </p><p class="meta text-uppercase no-top-margin offset-bottom-small color-gray-darker" ng-bind-html="item.subtitle | raw"></p><div class="half-width auto-margin popover-image" ng-if="item.src"><img class="img-responsive img-fill" ng-src="{[{ item.src }]}"/></div><p class="offset-top-small offset-bottom-half" ng-bind-html="item.content | raw"></p></div></div>',link:function(scope,element){var timer=null,box=element[0],maxWidth=scope.width||200,listeners=[],relativeLeft=parseInt(maxWidth/2,10);scope.data={},scope.direction="top",scope.customStyle={opacity:0,width:maxWidth+"px"},scope.repaint=function(data){timer&&$timeout.cancel(timer),timer=$timeout(function(){scope.customStyle.opacity=data.opacity,scope.customStyle.zIndex=data.zIndex,data.position&&("top"===data.direction?scope.customStyle.top=data.position.top-DomService.getHeight(box)-15+"px":scope.customStyle.top=data.position.top+15+"px",scope.customStyle.left=data.position.left-relativeLeft+"px")},200)},listeners.push(EventManager.onFresh("profileDataChanged",function(data){if($timeout.cancel(timer),data.status){if(data.opacity=1,data.zIndex=999,scope.item=data.item,scope.item.job&&(scope.item.title=scope.item.job.title),data.item.img){var img=ImageService.getOpenRossImage(data.item.img,200);scope.item.src=img}else scope.item.src=null;scope.direction=data.direction}else data.opacity=0,data.zIndex=-1;scope.repaint(data)})),scope.hide=function(){scope.$apply(function(){scope.customStyle.opacity=0,scope.customStyle.top=0,scope.customStyle.left=0})},scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.article").directive("articleScrollspy",["$log","$rootScope","EventManager","DomService",function($log,$rootScope,EventManager,DomService){"use strict";return{restrict:"A",link:function(scope,element){element[0];$rootScope.$on("duScrollspy:becameActive",function(event,el){scope.scrollTo(el)}),EventManager.on("scrollspyMoveTo",function(data){scope.scrollTo(data.element)}),scope.scrollTo=function(el){var e=el[0],offsetTop=e.offsetTop,parentOffsetTop=e.parentNode.offsetTop;$log.debug("Coordinates!",offsetTop,parentOffsetTop),element.scrollTop(offsetTop-parentOffsetTop,500)}}}}]).directive("expandItem",["$log","EventManager",function($log,EventManager){"use strict";return{restrict:"A",link:function(scope,element,attrs){var toggle=!1;element.bind("click",function(){toggle=!toggle,toggle?(element.addClass("open"),EventManager.emit("scrollspyMoveTo",{id:attrs.id,element:element})):element.removeClass("open")})}}}]),angular.module("app.article").directive("showWhenInjected",["EventManager",function(EventManager){"use strict";return{restrict:"A",link:function(scope,element){element.addClass("hide"),EventManager.on("articleInjectChange",function(data){element.removeClass("hide")})}}}]),angular.module("app.article").directive("articlesLoadMore",["ArticleService","PaginationService","AgentService","ArrayService",function(ArticleService,PaginationService,AgentService,ArrayService){"use strict";return{templateUrl:"/templates/Articles/thumbnail_article",replace:!0,restrict:"E",scope:{attributes:"@",types:"@",order:"@",categories:"@",excludeCategories:"@",authors:"@",limit:"@",offset:"@",feed:"@",topics:"@",people:"@",organisations:"@",tags:"@",countries:"@",text:"@",gridClass:"@",spacer:"@",viewFeed:"@",trackers:"@"},link:function(scope,element,attrs){scope.items=[],scope.isMobile=AgentService.isMobile(),scope.enabled=!0,scope.buttonText=scope.text||"Load More Articles",scope.gridCss=scope.gridClass||"col-xs-24",scope.showSpacer="false"!==scope.spacer;var lock=!1,filters={offset:parseInt(scope.offset)||5,limit:parseInt(scope.limit)||4,sort:"DESC",types:scope.types||"post",attributes:scope.attributes||"all",order:scope.order||"article_id",categories:scope.categories,exclude_categories:scope.excludeCategories,authors:scope.authors,feed:scope.feed,topics:scope.topics||null,people:scope.people||null,countries:scope.countries||null,organisations:scope.organisations||null,tags:scope.tags||null},forceType=AgentService.isMobile()?"mobile":null,trackers=scope.trackers?angular.fromJson(scope.trackers):null;scope.loadMore=function(){lock||(lock=!0,ArticleService.getAll(filters,!0).then(function(res){scope.enabled=PaginationService.isEnabled(filters,res.data.length),scope.isMobile&&ArrayService.replace(res.data,{article_type:forceType||"post",view_feed:"default"}),scope.viewFeed&&ArrayService.replace(res.data,{view_feed:scope.viewFeed}),trackers&&(res.data=res.data.map(function(item){return angular.extend(item,{trackers:trackers})})),scope.items=scope.items.concat(res.data),PaginationService.nextPage(filters),lock=!1}))}}}}]),function(){"use strict";function MediaFormController(_,authStream,ChannelManager,CoreValidations,EventManagerUtility,FormServiceFactory,SharedDataApiFactory,UiEvents,SalesforceService,userProfileApi,SharedDataApis,$timeout,$q,ShareService,MessageConstants){function $onInit(){$ctrl.form={},$ctrl.selects={},$ctrl.done=!1,$ctrl.user={},$ctrl.companySizeList=[],$ctrl.regex=CoreValidations,$ctrl.data={type_id:MessageConstants.MESSAGE_TYPE.MEDIA.ID},$ctrl.loaded=!1,$ctrl.disabled={job_title:!1,company:!1},$ctrl.channel_job_title="media_form_job_title",$ctrl.channel_company="media_form_company",$ctrl.isFormValid=isFormValid,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,FormService=new FormServiceFactory($ctrl.form),ChannelEventManagerJobTitle=ChannelManager.subscribe($ctrl.channel_job_title),typeaheadSuggestionsJobTitle={job_title:new SharedDataApiFactory({type:"job-titles",attributes:"titles"})},queryTypeaheadListenerJobTitle=ChannelEventManagerJobTitle.on(UiEvents.QUERY_TYPEAHEAD,onQueryTypeaheadJobTitle),ChannelEventManagerCompany=ChannelManager.subscribe($ctrl.channel_company),typeaheadSuggestionsCompany={company:new SharedDataApiFactory({type:"profile-organisations",attributes:"titles"})},queryTypeaheadListenerCompany=ChannelEventManagerCompany.on(UiEvents.QUERY_TYPEAHEAD,onQueryTypeaheadCompany),userChangedListener=authStream.USER_CHANGED.subscribe(onUserChanged),SharedDataApis.COUNTRIES().then(onCountriesLoadedSuccess)}function onCountriesLoadedSuccess(res){var values=[];_.map(res.data,function(item){values[item.country_id]=item.country_name}),$ctrl.countries=values}function $onDestroy(){userChangedListener.dispose(),EventManagerUtility.removeListeners(queryTypeaheadListenerCompany),EventManagerUtility.removeListeners(queryTypeaheadListenerJobTitle)}function onUserChanged(data){function onProfileApiGetSuccess(response){_.assign($ctrl.data,{first_name:response.data.firstname,last_name:response.data.lastname,email:response.data.email,job:response.data.job,company:response.data.company,country:response.data.location_country_id}),$ctrl.data.job&&$ctrl.data.job.title&&($ctrl.disabled.job_title=!0),$ctrl.data.company&&$ctrl.data.company.title&&($ctrl.disabled.company=!0),$timeout(setLoaded)}return $ctrl.loaded=!1,data.isLoggedIn()?(_.assign($ctrl.user,{id:data.id}),userProfileApi.get().then(onProfileApiGetSuccess)):void $timeout(setLoaded)}function setLoaded(){$ctrl.loaded=!0}function onQueryTypeaheadJobTitle(data){onQueryTypeahead(data,"job_title")}function onQueryTypeaheadCompany(data){onQueryTypeahead(data,"company")}function onQueryTypeahead(data,type){var typeahead="company"===type?typeaheadSuggestionsCompany:typeaheadSuggestionsJobTitle,channeleventmanager="company"===type?ChannelEventManagerCompany:ChannelEventManagerJobTitle;typeahead.hasOwnProperty(data.id)&&typeahead[data.id].get({query:data.query,limit:4}).then(function(res){_.map(res.data,function(item){!item.title&&item.label&&(item.title=item.label)}),channeleventmanager.emit(UiEvents.INJECT_TYPEAHEAD,{id:data.id,results:res.data})})}function isFormValid(){return FormService.isValid()}function canSubmit(){return FormService.canSubmit()}function submit(){var ShareSubmitPromise=ShareService.submitMessage($ctrl.data),SalesforceSubmitPromise=SalesforceService.submitMessage(transformSalesforceData());return $q.all([ShareSubmitPromise,SalesforceSubmitPromise]).then(onSubmitSuccess)}function transformSalesforceData(){return{first_name:$ctrl.data.first_name,last_name:$ctrl.data.last_name,email:$ctrl.data.email,phone:$ctrl.data.phone_number,country:$ctrl.countries[$ctrl.data.country]?$ctrl.countries[$ctrl.data.country]:"",title:$ctrl.data.job.title,company:$ctrl.data.company.title,URL:$ctrl.data.company_url,description:$ctrl.data.message,lead_source:"Inbound","00N1r00000JwHB0":"/media"}}function onSubmitSuccess(){$ctrl.done=!0}var $ctrl=this,ChannelEventManagerCompany=null,ChannelEventManagerJobTitle=null,queryTypeaheadListenerJobTitle=null,queryTypeaheadListenerCompany=null,FormService=null,typeaheadSuggestionsJobTitle=null,typeaheadSuggestionsCompany=null,userChangedListener=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var mediaFormComponent={templateUrl:"/assets-access-layer/js/site/Article/templates/media-form.template.html",bindings:{active:"@"},controller:MediaFormController};angular.module("app.article").component("mediaForm",mediaFormComponent)}(),angular.module("app.article").service("InstagramWidgetService",["ScriptLoadService",function(ScriptLoadService){"use strict";var count=0,scriptLoaded=!1;this.addWidget=function(){count++,this.initInstagramWidgetScript()},this.initInstagramWidgetScript=function(){count>0&&!scriptLoaded&&(ScriptLoadService.addScriptTag("//platform.instagram.com/en_US/embeds.js"),scriptLoaded=!0,count=0)}}]),angular.module("app.article").service("TwitterWidgetService",["ScriptLoadService",function(ScriptLoadService){"use strict";var count=0,scriptLoaded=!1;this.addWidget=function(){count++,this.initTwitterWidgetScript()},this.initTwitterWidgetScript=function(){count>0&&!scriptLoaded&&(ScriptLoadService.addScriptTag("//platform.twitter.com/widgets.js"),scriptLoaded=!0,count=0)}}]),function(){"use strict";function BofProfessionalSampleArticleController(_,ArticleService,authStream){function $onInit(){authListener=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){function handleSuccess(res){$ctrl.article=_.get(res.data,"[0]")}$ctrl.isMember=user.hasMembership(),ArticleService.getAll(filters,!0).then(handleSuccess)}function $onDestroy(){authListener.dispose()}var authListener,$ctrl=this,filters={categories:"professional",limit:1,types:"post",order:"article_modified_date",sort:"DESC",features:"sample-article",article_access_type_ruleset_key:"open_access_no_counter"};$ctrl.article=null,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var bofProfessionalSampleArticleComponent={templateUrl:"/assets-access-layer/js/site/Article/components/bof-professional-sample-article/bof-professional-sample-article.html",controller:BofProfessionalSampleArticleController};angular.module("app.article").component("bofProfessionalSampleArticle",bofProfessionalSampleArticleComponent)}(),function(){"use strict";function NextStoryPromptController(DomService){function $onInit(){DomService.bind("scroll",fadeInOut)}function fadeInOut(evt){var containerElement=document.querySelector("next-story-prompt .next-story-prompt__links-container");if(containerElement){var distanceToTop=containerElement.getBoundingClientRect().top,opacity=0,anchor=document.querySelector("#"+$ctrl.refId);if(anchor){var anchorDistanceFromTop=anchor.getBoundingClientRect().top,bar=-1*(anchorDistanceFromTop-distanceToTop);bar>0&&(opacity=bar/300),containerElement.style.opacity=opacity,containerElement.style.display=opacity>0?"flex":"none"}}}var $ctrl=this;$ctrl.$onInit=$onInit}NextStoryPromptController.$inject=["DomService"],angular.module("app.article").component("nextStoryPrompt",{templateUrl:"/assets-access-layer/js/site/Article/components/next-story-prompt/next-story-prompt.html",controller:NextStoryPromptController,bindings:{refId:"@",lastArticleId:"@",lastArticleTitle:"@",lastArticleUrl:"@",lastArticleLabel:"@",nextArticleId:"@",nextArticleTitle:"@",nextArticleUrl:"@",nextArticleLabel:"@"}})}(),function(){"use strict";function RelatedContentController(_){function $onInit(){containerCounter+=1,$ctrl.containerId="relatedContent-"+containerCounter,$ctrl.numberOfRecommendations=4,Bibblio.getRelatedContentItems($ctrl.clientKey,$ctrl.contentId,[],getModuleConfig(),renderModule)}function renderModule(response){void 0!==response._links.tracking&&(trackingLink=response._links.tracking.href,activityId=Bibblio.getActivityId(trackingLink),catalogueIds=_.map(response.results,"catalogueId"),Bibblio.createModuleTrackingEntry(activityId),$ctrl.relatedArticles=response.results,initOnViewedListeners())}function initOnViewedListeners(){var submitViewedActivityData=_.partial(Bibblio.onRecommendationViewed,getModuleConfig(),$ctrl.contentId,catalogueIds,activityId,$ctrl.relatedArticles,trackingLink);Bibblio.setOnViewedListeners($ctrl.containerId,submitViewedActivityData,activityId,{})}function bibblioTileClicked(event){var submitClickedActivityData=_.partial(Bibblio.onRecommendationClick,$ctrl.containerId,$ctrl.contentId,catalogueIds,getModuleConfig(),activityId,$ctrl.relatedArticles,trackingLink,event.currentTarget.getAttribute("data"),event);Bibblio.triggerRecommendationClickedEvent(submitClickedActivityData,event)}function getArticleReference(url){var pattern=/\/[0-9]{4}\/[0-9]{2}\/(.*)\.html/i;return url.match(pattern)[1]}function getModuleConfig(){return{subtitleField:"datePublished"}}var trackingLink,activityId,catalogueIds,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.bibblioTileClicked=bibblioTileClicked,$ctrl.relatedArticles=!1,$ctrl.sourceQuery="bibblio",$ctrl.getArticleReference=getArticleReference}RelatedContentController.$inject=["_"];var containerCounter=0;angular.module("app.article").component("relatedContent",{templateUrl:"/assets-access-layer/js/site/Article/components/related-content/related-content.html",controller:RelatedContentController,bindings:{clientKey:"@",contentId:"@"}})}(),angular.module("app.education").component("certificateDownloadButton",{template:'<ui-repaint channel="{[{::$ctrl.subchannel}]}"><a    class="btn btn-default btn-gray-dark offset-bottom-small offset-right-small"   ng-disabled="::$ctrl.disabled"   ng-href="{[{::$ctrl.url}]}"   download   ng-transclude></a></ui-repaint>',replace:!0,transclude:!0,bindings:{shareType:"@"},controller:["ChannelManager","EventManagerUtility","UiEvents","CourseConfig","CourseEvents",function(ChannelManager,EventManagerUtility,UiEvents,CourseConfig,CourseEvents){var ctrl=this;ctrl.subchannel=CourseConfig.DOWNLOAD_BUTTON_SUBCHANNEL_PREFIX+ctrl.shareType,ctrl.text="",ctrl.url=null,ctrl.disabled=!0;var ChannelEventManager=ChannelManager.subscribe(CourseConfig.COURSE_COMPLETION_CHANNEL),SubChannelEventManager=ChannelManager.subscribe(ctrl.subchannel),listeners=[],handleCourseEnrollment=function(enrollment){ctrl.text=enrollment.text,updateState()},handleImage=function(image){image.shareType===ctrl.shareType&&(ctrl.url=image.src||ctrl.url||null,updateState())},updateState=function(){ctrl.disabled=!ctrl.text||!ctrl.url,ctrl.disabled||repaint()},repaint=function(){SubChannelEventManager.emit(UiEvents.REPAINT,{})};ctrl.$onInit=function(){ChannelEventManager.on(CourseEvents.COURSE_ENROLLMENT,handleCourseEnrollment),ChannelEventManager.on(CourseEvents.COURSE_CERTIFICATE_IMAGE,handleImage)},ctrl.$postLink=function(){repaint()},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.education").component("certificateShareButton",{template:'<ui-repaint channel="{[{::$ctrl.subchannel}]}"><button    class="btn  btn-default  offset-bottom-small"    ng-class="::$ctrl.buttonClass"    ng-disabled="::$ctrl.disabled"    socialshare    socialshare-provider="{[{::$ctrl.shareType}]}"    socialshare-text="{[{::$ctrl.text }]}"    socialshare-url="{[{::$ctrl.url }]}"    ng-transclude></button></ui-repaint>',replace:!0,transclude:!0,bindings:{shareType:"@",shareTypeImage:"@",buttonClass:"@"},controller:["ChannelManager","EventManagerUtility","UiEvents","CourseConfig","CourseEvents",function(ChannelManager,EventManagerUtility,UiEvents,CourseConfig,CourseEvents){var ctrl=this;ctrl.subchannel=CourseConfig.SHARE_BUTTON_SUBCHANNEL_PREFIX+ctrl.shareType,ctrl.text="",ctrl.slug="",ctrl.url=null,ctrl.src=null,ctrl.disabled=!0,ctrl.shareTypeImage=ctrl.shareTypeImage||ctrl.shareType;var ChannelEventManager=ChannelManager.subscribe(CourseConfig.COURSE_COMPLETION_CHANNEL),SubChannelEventManager=ChannelManager.subscribe(ctrl.subchannel),listeners=[],handleCourseEnrollment=function(enrollment){ctrl.url=enrollment.shareUrl,ctrl.text=enrollment.text,updateState()},handleImage=function(image){image.shareType===ctrl.shareTypeImage&&(ctrl.src=image.src||ctrl.src||null,updateState())},updateState=function(){ctrl.disabled=!ctrl.url||!ctrl.src,ctrl.disabled||repaint()},repaint=function(){SubChannelEventManager.emit(UiEvents.REPAINT,{})};ctrl.$onInit=function(){ChannelEventManager.on(CourseEvents.COURSE_ENROLLMENT,handleCourseEnrollment),ChannelEventManager.on(CourseEvents.COURSE_CERTIFICATE_IMAGE,handleImage)},ctrl.$postLink=function(){repaint()},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.education").component("certificateShareLinkedinProfile",{template:'<ui-repaint channel={[{::$ctrl.subchannel}]}><div class="margin-top-xs-3"><a ng-href="{[{::$ctrl.url }]}"   class="btn  btn-default  btn-linkedin  offset-bottom-small"   ng-disabled="::$ctrl.disabled"   target="_blank"   ng-transclude></a></div></ui-repaint>',replace:!0,transclude:!0,bindings:{},controller:["ChannelManager","EventManagerUtility","UiEvents","CourseConfig","CourseEvents",function(ChannelManager,EventManagerUtility,UiEvents,CourseConfig,CourseEvents){var ctrl=this;ctrl.subchannel=CourseConfig.SHARE_BUTTON_SUBCHANNEL_PREFIX+"Linkedin",ctrl.text="",ctrl.slug="",ctrl.url=null,ctrl.disabled=!0;var ChannelEventManager=ChannelManager.subscribe(CourseConfig.COURSE_COMPLETION_CHANNEL),SubChannelEventManager=ChannelManager.subscribe(ctrl.subchannel),listeners=[],handleCourseEnrollment=function(enrollment){ctrl.url=enrollment.linkedInProfileUrl,ctrl.text=enrollment.text,ctrl.disabled=!1,repaint()},repaint=function(){SubChannelEventManager.emit(UiEvents.REPAINT,{})};ctrl.$onInit=function(){ChannelEventManager.on(CourseEvents.COURSE_ENROLLMENT,handleCourseEnrollment)},ctrl.$postLink=function(){repaint()},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.education").component("courseCertificate",{template:function(CourseConfig){return'<div><div class="s_certificate-loader"><ui-repaint channel="'+CourseConfig.COURSE_COMPLETION_CHANNEL+'" class="s_certificate-loader__content"><div ng-if="::(!$ctrl.src)" class="s_certificate-loader__spinner" ng-transclude></div><img ng-if="::$ctrl.src" class="img-responsive" ng-src="{[{::$ctrl.src}]}" /></ui-repaint></div></div>'},replace:!0,transclude:!0,bindings:{channel:"@"},controller:["ChannelManager","EventManagerUtility","UiEvents","CourseConfig","CourseEvents","CourseConstants",function(ChannelManager,EventManagerUtility,UiEvents,CourseConfig,CourseEvents,CourseConstants){var ctrl=this;ctrl.src=null;var ChannelEventManager=ChannelManager.subscribe(CourseConfig.COURSE_COMPLETION_CHANNEL),listeners=[],repaint=function(){ChannelEventManager.emit(UiEvents.REPAINT,{})},handleImage=function(image){image.shareType===CourseConstants.BOF_CERTIFICATE_SHARE_TYPE&&(ctrl.src=image.src,repaint())};ctrl.$onInit=function(){listeners.push(ChannelEventManager.on(CourseEvents.COURSE_CERTIFICATE_IMAGE,handleImage))},ctrl.$postLink=function(){repaint()},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.education").component("courseCompletion",{bindings:{slug:"@",courseDetailsUrl:"@"},controller:CourseCompletion}),angular.module("app.education").component("talentPoolComponent",{templateUrl:function(TalentPoolTemplates){return TalentPoolTemplates.TALENT_POOL_FORM},replace:!0,bindings:{id:"@",channel:"@",courseTitle:"@",courseUrl:"@"},controller:["_","$q","$timeout","ChannelManager","TalentPoolService","UiEvents","EventManagerUtility","FormServiceFactory","TalentPoolConstants","PostMessageFactory","userConsentApi","CONSENT_JOURNEY",function(_,$q,$timeout,ChannelManager,TalentPoolService,UiEvents,EventManagerUtility,FormServiceFactory,TalentPoolConstants,PostMessageFactory,userConsentApi,CONSENT_JOURNEY){function onConsentsChange(event){$ctrl.consentsForm=event}function updateConsents(){return userConsentApi.update($ctrl.consentsForm.formData,$ctrl.consentJourneyId)}var $ctrl=this,ChannelEventManager=ChannelManager.subscribe($ctrl.channel),FormService=null,listeners=[],typeaheadSuggestions={},generalCodelistProviders=[],employmentCodelistProviders=[],educationCodelistProviders=[];new PostMessageFactory;$ctrl.user={},$ctrl.isLoaded=!1,$ctrl.state=TalentPoolConstants.STATE_NONE,$ctrl.form={ref:null},$ctrl.triggerTracking=!1,$ctrl.onConsentsChange=onConsentsChange,$ctrl.$onInit=function(){function onDataLoaded(){$ctrl.isLoaded=!0}generalCodelistProviders=[{id:"country",get:TalentPoolService.getCountries},{id:"title",get:TalentPoolService.getTitles},{id:"jobPosition",get:TalentPoolService.getJobPositions}],employmentCodelistProviders=[{id:"companyIndustry",get:TalentPoolService.getCompanyIndustries},{id:"jobResponsibility",get:TalentPoolService.getCompanyResponsibilities},{id:"lengthOfTimeInRole",get:TalentPoolService.getLengthOfTimeInRoleOptions},{id:"fieldOfEmployment",get:TalentPoolService.getFieldsOfEmployment}],educationCodelistProviders=[{id:"schoolProgrammeType",get:TalentPoolService.getSchoolProgrammeTypes},{id:"fieldOfStudy",get:TalentPoolService.getFieldsOfStudy}],$ctrl.consentJourneyId=CONSENT_JOURNEY.CoursePurchaseLoggedinConfigure,$ctrl.consentsForm={};var promises=[TalentPoolService.getUser().then(function(user){$ctrl.user=user,handleJobPositionChange(),$timeout(loadData,0)})];$q.all(promises).then(onDataLoaded)};var loadData=function(){FormService=new FormServiceFactory($ctrl.form),injectCodelists(generalCodelistProviders),reloadCodelists(),typeaheadSuggestions={city:_.isNil($ctrl.user.country)?TalentPoolService.getCitySuggestions:TalentPoolService.getCitySuggesterByCountryId($ctrl.user.country.id),school:TalentPoolService.getSchoolSuggestions,schoolCourse:TalentPoolService.getSchoolCourseSuggestions}},reloadCodelists=function(){$ctrl.state===TalentPoolConstants.STATE_EMPLOYMENT?injectCodelists(employmentCodelistProviders):$ctrl.state===TalentPoolConstants.STATE_EDUCATION&&injectCodelists(educationCodelistProviders)},injectCodelists=function(codelists){codelists.forEach(function(codelist){var selectedId=0;$ctrl.user[codelist.id]&&(selectedId=$ctrl.user[codelist.id].id),codelist.get(selectedId).then(function(data){$ctrl.user[codelist.id]=data.selected[0],fillSelect(codelist.id,data)})})},fillSelect=function(id,data){ChannelEventManager.emit(UiEvents.INIT_STATE,_.zipObjectDeep(["options."+id,"selected."+id],[data.items,data.selected]))};listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_SELECT,function(data){switch($ctrl.user[data.id]=data.value,data.id){case"country":hanldeCountryChange();break;case"jobPosition":handleJobPositionChange()}})),listeners.push(ChannelEventManager.on(UiEvents.QUERY_TYPEAHEAD,function(data){provideTypeaheadSuggestions(data.id,data.query)}));var provideTypeaheadSuggestions=function(id,query){query=_.isObject(query)?query:{query:query,limit:4},typeaheadSuggestions.hasOwnProperty(id)&&typeaheadSuggestions[id](query).then(function(data){sendTypeaheadSuggestions(id,data)})},sendTypeaheadSuggestions=function(id,response){ChannelEventManager.emit(UiEvents.INJECT_TYPEAHEAD,{id:id,results:response.data})},hanldeCountryChange=function(){ChannelEventManager.emit(UiEvents.RESET_TYPEAHEAD,{id:"city"}),typeaheadSuggestions.city=_.isNil($ctrl.user.country)?TalentPoolService.getCitySuggestions:TalentPoolService.getCitySuggesterByCountryId($ctrl.user.country.id)},handleJobPositionChange=function(){var previousState=$ctrl.state;_.isObject($ctrl.user.jobPosition)&&$ctrl.user.jobPosition.id>0?$ctrl.state=$ctrl.user.jobPosition.id!=TalentPoolConstants.STUDENT_JOB_POSITION_ID?TalentPoolConstants.STATE_EMPLOYMENT:TalentPoolConstants.STATE_EDUCATION:$ctrl.state=TalentPoolConstants.STATE_NONE,$ctrl.state!==previousState&&$timeout(reloadCodelists,0)};$ctrl.canSubmit=function(){return FormService.canSubmit()&&$ctrl.consentsForm.isValid},$ctrl.submit=function(){function onTalentPoolSuccess(response){return updateConsents().then(function(){window.location=response.data.url})}return $ctrl.triggerTracking=!0,TalentPoolService.submitTalentPool($ctrl.user,$ctrl.id).then(onTalentPoolSuccess)};$ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.education").constant("CourseConfig",{ENROLLMENT_API_ENDPOINT:"/xhr/education/enrollments/:slug",COURSE_COMPLETION_CHANNEL:"CourseCompletion",CERTIFICATE_PUSHER_CHANNEL_PREFIX:"UserChannel-",SHARE_BUTTON_SUBCHANNEL_PREFIX:"CertificateShareButton",DOWNLOAD_BUTTON_SUBCHANNEL_PREFIX:"CertificateDownloadButton"}),angular.module("app.education").constant("CourseConstants",{BOF_CERTIFICATE_SHARE_TYPE:"bof",FACEBOOK_CERTIFICATE_SHARE_TYPE:"facebook",TWITTER_CERTIFICATE_SHARE_TYPE:"twitter",INSTAGRAM_CERTIFICATE_SHARE_TYPE:"instagram",LINKEDIN_CERTIFICATE_SHARE_TYPE:"facebook"}),angular.module("app.education").constant("CourseEvents",{COURSE_CERTIFICATE_IMAGE:"CourseCertificateImage",COURSE_CERTIFICATE_DOWNLOAD_IMAGE:"CourseCertificateDownloadImage",COURSE_CERTIFICATE_GENERATED:"CourseCertificateCreated",COURSE_ENROLLMENT:"CourseEnrollment"}),angular.module("app.education").constant("CourseTemplates",{COURSE_SUGGESTION_FORM:"/templates/Education/course_suggestion_form",RANKING_DYNAMIC_SEARCH:"/templates/Education/ranking_dynamic_search",COURSE_PROMO_FOOTER:"/assets-access-layer/js/shared/UI/templates/course-promo-footer.template.html"}),angular.module("app.education").constant("EducationConfig",{RANKING_CACHE:"RankingCache"}),angular.module("app.education").constant("EducationEvents",{USER_APPLIED_FOR_COURSE:"UserAppliedForCourse",USER_LOADED:"EducationUserLoaded",INIT_BLOCK:"EducationInitBlock"}),angular.module("app.education").constant("TalentPoolConstants",{STUDENT_JOB_POSITION_ID:6,STATE_NONE:"none",STATE_EMPLOYMENT:"employment",STATE_EDUCATION:"education",TITLES:[{id:"mr",label:"Mr"},{id:"ms",label:"Ms"},{id:"other",label:"Other"}],FIELDS_OF_EMPLOYMENT_OR_STUDY:[{id:24,isFashion:!0,label:"Fashion"},{id:9,isFashion:!1,label:"Non-Fashion"}]}),angular.module("app.education").constant("TalentPoolTemplates",{TALENT_POOL_FORM:"/templates/Education/talent_pool_form"}),angular.module("app.education").controller("CourseApplyController",["_","$scope","$q","$modalInstance","modalParams","CoursesService","FormServiceFactory","ChannelManager","EducationEvents","EventManager","AuthEvents","registrationApi","EventManagerUtility","authModalService","CourseInterestService","formStream",function(_,$scope,$q,$modalInstance,modalParams,CoursesService,FormServiceFactory,ChannelManager,EducationEvents,EventManager,AuthEvents,registrationApi,EventManagerUtility,authModalService,CourseInterestService,formStream){"use strict";$scope.form={};var registerPromise,FormService=new FormServiceFactory($scope.form),ChannelEventManager=ChannelManager.subscribe(modalParams.channel),hasApplied=!1,listeners=[];$scope.data={newsletter:{}},$scope.done=!1,$scope.error=null,$scope.catalogueUrl=modalParams.catalogueUrl,$scope.course_title=modalParams.course,$scope.handleClose=function(){$modalInstance.dismiss()},$scope.handleLogin=function(){authModalService.openLogin(null,null,!0)},$scope.handleSuccess=function(){$modalInstance.close()},$scope.canSubmit=function(){return FormService.canSubmit()&&$scope.data.is_contactable};var _onApplyError=function(res){return $scope.error=_.get(res,"data.message","UNDEFINED"),$q.reject()},_getRequestPayload=function(){return{course_id_or_slug:modalParams.courseId,catalogue:modalParams.catalogue,job_level_id:_.parseInt($scope.data.job_level_id)||null,suggestion:$scope.data.suggestion,is_contactable:!!_.get($scope,"data.is_contactable"),newsletter:_.get($scope,"data.newsletter")}},_submitLoggedIn=function(){var _onApplySuccess=function(res){return hasApplied=!0,$scope.done=!0,$scope.status=res.message,ChannelEventManager.emit(EducationEvents.USER_APPLIED_FOR_COURSE,{}),res};return CourseInterestService.save(_getRequestPayload()).then(_onApplySuccess,_onApplyError)},_submitNewUser=function(){$scope.data.location_city_id=_.get($scope,"data.location_city.id",null),$scope.data.location_city_title=_.get($scope,"data.location_city.title",null);var payload=_.pick($scope.data,["email","password","firstname","lastname","location_country_id","location_city_id","location_city_title"]);payload.registration_type="CourseApply",payload.job_position_id=$scope.data.job_level_id,payload.newsletter=$scope.data.newsletter,payload.extra=_getRequestPayload(),payload.source="CourseInterestApply";var _onRegistrationSuccess=function(res){return hasApplied=!0,$scope.done=!0,$scope.status="NEW_REGISTERED_USER",ChannelEventManager.emit(EducationEvents.USER_APPLIED_FOR_COURSE,{}),res},_onRegistrationFailed=function(res){var message=_.get(res,"data.message");return formStream.FORM_ERROR.onNext(res.data),_.includes(["USER_VALID_EXISTS","USER_VALID_NOT_CONFIRMED"],message)?(hasApplied=!0,$scope.done=!0,$scope.status=message,ChannelEventManager.emit(EducationEvents.USER_APPLIED_FOR_COURSE,{}),res):($scope.error=message,$q.reject({}))};return registrationApi.register(payload).then(_onRegistrationSuccess,_onRegistrationFailed)};$scope.submit=function(){return $scope.isLoggedIn?_submitLoggedIn():_submitNewUser()},$scope.onCaptchaReady=function($event){function onReistrationSuccess(){registerPromise&&(registerPromise.resolve(),registerPromise=null)}function onReistrationError(){$scope.captchaReload=!$scope.captchaReload,registerPromise&&(registerPromise.reject(),registerPromise=null)}var tmpRegisterPromise;return $event.token&&"timedOut"!==$event.token?$scope.submit().then(onReistrationSuccess,onReistrationError):($scope.error="timedOut"===$event.token?null:"CAPTCHA_INVALID",registerPromise?(registerPromise.reject(),tmpRegisterPromise=registerPromise,registerPromise=null,tmpRegisterPromise.promise):$q.reject())},$scope.registerWithCaptcha=function(){return $scope.error="",$scope.captchaExecute=!$scope.captchaExecute,registerPromise&&(registerPromise.reject(),registerPromise=null),registerPromise=$q.defer(),registerPromise.promise};var _onUserChanged=function(user){$scope.isLoggedIn=user.isLoggedIn(),$scope.data.firstname=user.firstname,$scope.data.lastname=user.lastname,$scope.data.email=user.email,$scope.data.job_level_id=_.toString(_.get($scope,"data.job_level_id")||user.job_level_id),$scope.data.location_country_id=_.toString(_.get($scope,"data.location_country_id")||user.country_id),$scope.data.suggestion=_.get($scope,"data.suggestion",null),$scope.data.is_contactable=_.get($scope,"data.is_contactable",!0),$scope.data.newsletter.daily=_.get($scope,"data.newsletter.daily",!0)};listeners.push(EventManager.on(AuthEvents.USER_CHANGED,_onUserChanged)),$scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}]),angular.module("app.ui").controller("alreadyEnroledCourseModalController",["$controller","$interval","$scope","$modalInstance","modalParams","UrlService",function($controller,$interval,$scope,$modalInstance,modalParams,UrlService){function redirectToCourse(){UrlService.changeUrl($scope.params.courseUrl)}$controller("ModalGenericController",{$scope:$scope,$modalInstance:$modalInstance,modalParams:modalParams}),$scope.params=modalParams,$scope.delayUntilRedirect=5;var clearInterval=$interval(function(){1==$scope.delayUntilRedirect?($interval.cancel(clearInterval),redirectToCourse()):$scope.delayUntilRedirect--},1e3);$scope.redirectToCourse=redirectToCourse}]),angular.module("app.education").directive("courseApplyWrapper",["_","EventManager","ChannelManager","EducationEvents","CourseInterestService","CourseTemplates","EventManagerUtility","UiEvents","AuthEvents",function(_,EventManager,ChannelManager,EducationEvents,CourseInterestService,CourseTemplates,EventManagerUtility,UiEvents,AuthEvents){"use strict";return{restrict:"E",scope:{id:"@",course:"@",catalogue:"@",catalogueUrl:"@",channel:"@"},link:function(scope){var listeners=[],ChannelEventManager=ChannelManager.subscribe(scope.channel),isUserLoaded=!1;scope.user={},scope.userHasApplied=null,scope.propagateStatus=function(status){ChannelEventManager.emit(UiEvents.INIT_STATE,{id:scope.id,catalogue:scope.catalogue,catalogueUrl:scope.catalogueUrl,course:scope.course,status:status}),scope.userHasApplied=status},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){user.isLoggedIn()&&!isUserLoaded?(isUserLoaded=!0,scope.user=user.getPayload(),CourseInterestService.fetch().then(function(res){scope.propagateStatus(!_.isEmpty(_.find(res.data,["course_id",scope.id])))})):user.isLoggedIn()||(isUserLoaded=!1,scope.propagateStatus(!1),scope.userHasApplied=!1)})),listeners.push(ChannelEventManager.on(EducationEvents.USER_APPLIED_FOR_COURSE,function(){scope.propagateStatus(!0)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners),EventManager.unsubscribe()})}}}]),angular.module("app.education").directive("courseCatalogue",["EventManager","AuthEvents","CourseInterestsApiFactory","EventManagerUtility","UiEvents","ChannelManager","CourseInterestService",function(EventManager,AuthEvents,CourseInterestsApiFactory,EventManagerUtility,UiEvents,ChannelManager,CourseInterestService){"use strict";return{restrict:"E",scope:{catalogueId:"@",channel:"@"},link:function(scope){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.applied=!1,scope.user={},scope.handleChange=function(data){ChannelEventManager.emit(UiEvents.INIT_STATE,data)},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){if(scope.user=user.getPayload(),user.isLoggedIn())return CourseInterestService.fetch().then(function(res){scope.handleChange(res.data)});scope.handleChange({})})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.education").directive("courseContainer",function(){"use strict";return{restrict:"EA",scope:!0,controller:["$scope",function($scope){$scope.bibblio_count=0,$scope.setBibblioCount=function(count){$scope.bibblio_count=count}}],link:function(scope,element,attrs){scope.toggle=function(){scope.isOpen=!scope.isOpen}}}}),angular.module("app.education").directive("courseShowIfApplied",["_","ChannelManager","AuthEvents","EventManagerUtility","UiEvents",function(_,ChannelManager,AuthEvents,EventManagerUtility,UiEvents){"use strict";return{template:'<div><div class="no-ng-animate" ng-if="applied"><div ng-transclude></div></div></div>',replace:!0,transclude:!0,restrict:"E",scope:{courseId:"@",channel:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[];scope.applied=!1,listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,function(data){scope.applied=!_.isEmpty(_.find(data,["course_id",scope.courseId]))})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.education").directive("courseSuggestion",["_","FormServiceFactory","ShareService","AuthEvents","EventManager","EventManagerUtility","CourseTemplates",function(_,FormServiceFactory,ShareService,AuthEvents,EventManager,EventManagerUtility,CourseTemplates){"use strict";return{restrict:"E",replace:!0,templateUrl:CourseTemplates.COURSE_SUGGESTION_FORM,scope:{channel:"@"},link:function(scope){var listeners=[],FormService=new FormServiceFactory(scope.form);scope.done=!1,scope.data={type_id:"9"},scope.user={},scope.canSubmit=function(){return FormService.canSubmit()},scope.submit=function(){return ShareService.submitMessage(scope.data).then(function(res){return scope.done=!0,res})},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){scope.user=user.getPayload(),_.assign(scope.data,{firstname:user.firstname,lastname:user.lastname,email:user.email})})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.education").directive("rankingTableCtrl",function(){"use strict";return{controller:function(){this.headers=[],this.rankings=[],this.addHeader=function(header){this.headers.push(header)},this.addRow=function(row){this.rankings.push(row)}}}}).directive("rankingTable",function(){"use strict";return{restrict:"E",replace:!0,transclude:!1,priority:10,require:["^rankingTableCtrl"],templateUrl:"/templates/Education/ranking_table",link:function(scope,element,attrs,ctrls){scope.order="rank",scope.direction=!0,scope.animateRows=2,scope.headers=ctrls[0].headers,scope.rankings=ctrls[0].rankings,scope.sortBy=function(header){if(header.order)return scope.order!=header.order?(scope.order=header.order,void(scope.direction="asc"==header.direction)):void(scope.direction=!scope.direction)}}}}).directive("rankingTableHeader",function(){"use strict";return{restrict:"A",require:["^rankingTableCtrl"],link:function(scope,element,attrs,ctrls){angular.forEach(element.children(),function(el){ctrls[0].addHeader({title:el.innerHtml?el.innerHtml:el.textContent.trim(),class:el.getAttribute("class"),order:el.getAttribute("sortable"),direction:el.getAttribute("direction")})})}}}).directive("rankingTableRow",function(){"use strict";return{restrict:"A",require:["^rankingTableCtrl"],link:function(scope,element,attrs,ctrls){var row={};angular.forEach(element.children(),function(el){var field,value,type;type=el.getAttribute("type"),"int"==type?value=parseInt(el.textContent):"url"==type?(value=el.getElementsByTagName("a")[0],value=void 0!==value?value.getAttribute("href"):null):value="float"==type?parseFloat(el.textContent):el.innerHtml?el.innerHtml:el.textContent.trim(),(field=el.getAttribute("field"))&&(row[field]=value)}),ctrls[0].addRow(row)}}}),function(){"use strict";function programmeType(EventManager){function link(scope,element,attrs,ctrl){ctrl.addProgramme(attrs.type),scope.currentActive=!1,EventManager.on("rankingsTabChange",function(tabType){scope.currentActive=attrs.type==tabType.key})}return{restrict:"EA",scope:!0,require:"^schoolPage",link:link}}programmeType.$inject=["EventManager"],angular.module("app.education").directive("programmeType",programmeType)}(),function(){"use strict";function schoolPage(){return{bindToController:!0,controller:SchoolPageController,controllerAs:"$ctrl",restrict:"E"}}function SchoolPageController($scope,EventManager,UrlService){function $postLink(){var currentQuery=UrlService.parseQuery();$ctrl.currentProgramme=currentQuery.type?currentQuery.type:programmes[0],changeProgramme($ctrl.currentProgramme),$scope.$watch("$ctrl.currentProgramme",function(newVal,oldVal){newVal!==oldVal&&changeProgramme($ctrl.currentProgramme)})}function changeProgramme(programmeTypeKey){$ctrl.currentProgramme=programmeTypeKey,EventManager.emit("rankingsTabChange",{key:programmeTypeKey}),UrlService.setQueryParams({type:programmeTypeKey})}function addProgramme(type){programmes.push(type)}var $ctrl=this,programmes=[];$ctrl.$postLink=$postLink,$ctrl.addProgramme=addProgramme}SchoolPageController.$inject=["$scope","EventManager","UrlService"],angular.module("app.education").directive("schoolPage",schoolPage)}(),angular.module("app.education").factory("CourseInterestsApi",["$resource",function($resource){"use strict";return $resource("/xhr/education/courses/interests",{},{})}]).factory("CourseInterestsApiFactory",["_","CourseInterestsApi","AntiCacheService",function(_,CourseInterestsApi,AntiCacheService){"use strict";function Factory(params){var apiParams=params;this.getAll=function(filters){return CourseInterestsApi.get(_.assign({},apiParams,AntiCacheService.add())).$promise}}return Factory}]),function(){"use strict";function CoursesApi($resource){return $resource("/xhr/education/courses/:id",{id:"@id"},{getAll:{method:"GET"}})}CoursesApi.$inject=["$resource"],angular.module("app.education").factory("CoursesApi",CoursesApi)}(),function(){"use strict";function OrganisationsApi($resource){return $resource("/xhr/profiles/organisations/:id",{id:"@id"},{getAll:{method:"GET"}})}OrganisationsApi.$inject=["$resource"],angular.module("app.education").factory("OrganisationsApi",OrganisationsApi)}(),function(){"use strict";function rankingApi(_,$resource){function search(filters){if(currentRequest)try{currentRequest.$cancelRequest()}catch(e){}return currentRequest=resource.search(_.assign({},filters)),currentRequest.$promise}var currentRequest=null,resource=$resource("/xhr/education/rankings/:action",{action:"@action"},{search:{method:"GET",cancellable:!0}});return{search:search}}rankingApi.$inject=["_","$resource"],angular.module("app.education").factory("rankingApi",rankingApi)}(),angular.module("app.education").factory("RankingDynamicSearchApi",["$resource",function($resource){"use strict";return $resource("/xhr/education/rankings/search/:action",{action:"@action"},{search:{method:"GET"}})}]).factory("RankingDynamicSearchApiFactory",["_","$q","RankingDynamicSearchApi",function(_,$q,RankingDynamicSearchApi){"use strict";function Factory(params){var apiParams=params,currentRequest=null;this.search=function(filters){if(currentRequest)try{currentRequest.$cancelRequest()}catch(e){}return currentRequest=RankingDynamicSearchApi.search(_.assign({},apiParams,filters)),currentRequest.$promise}}return Factory}]),function(){"use strict";function RankingModel($resource){return $resource("/xhr/education/rankings-list",{},{fetch:{method:"GET"}})}RankingModel.$inject=["$resource"],angular.module("app.education").factory("RankingModel",RankingModel)}(),angular.module("app.education").factory("TalentPoolModelApi",["$resource",function($resource){"use strict";return $resource("/xhr/education/courses/:courseKey/talent-pool-save",{courseSlug:"@courseSlug"},{submit:{method:"POST"}})}]),function(){"use strict";function TermsApi($resource){return $resource("/xhr/education/terms/:id",{id:"@id"},{getAll:{method:"GET"}})}TermsApi.$inject=["$resource"],angular.module("app.education").factory("TermsApi",TermsApi)}(),angular.module("app.education").service("chartManager",function(){var colors={main:["#385056","#f1f1f3"],influence:["#E7BF6D","#f1f1f3"],experience:["#24396F","#f1f1f3"],value:["#BD2534","#f1f1f3"],mainDark:["#385056","#0D1A24"],influenceDark:["#E7BF6D","#0D1A24"],experienceDark:["#24396F","#0D1A24"],valueDark:["#BD2534","#0D1A24"]},borderColor={dark:"rgba(0,0,0,1)",invisible:"rgba(0,0,0,0)"};this.getColors=function(colorScheme){return colors[colorScheme]},this.getBorderColors=function(colorScheme){return borderColor[colorScheme]}}),angular.module("app.education").service("CourseInterestService",["Routes","GenericApiFactory","$log",function(Routes,GenericApiFactory,$log){"use strict";var CourseInterestAPI=new GenericApiFactory(Routes.EDUCATION.COURSE.INTEREST);this.fetch=function(filters){return $log.debug("CourseInterestService::fetch::",filters),CourseInterestAPI.get(filters)},this.save=function(data){return $log.debug("CourseInterestService::save::",data),CourseInterestAPI.post(data)}}]),angular.module("app.education").service("CoursesService",["DataService","CoursesApi",function(DataService,CoursesApi){"use strict";var defaultFilters={attributes:"courses"};this.getAll=function(filters){return filters=DataService.createFilters(defaultFilters,filters),CoursesApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,"course_id"),res})}}]),angular.module("app.education").service("SchoolsService",["DataService","OrganisationsApi",function(DataService,OrganisationsApi){"use strict";var defaultFilters={limit:4,offset:0,order:"rand",attributes:"all"};this.getAll=function(filters){return filters=DataService.createFilters(defaultFilters,filters),OrganisationsApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,"course_id"),res})}}]),angular.module("app.education").service("TalentPoolService",["_","$q","$log","$filter","UserService","SharedDataApiFactory","SharedDataCityApiFactory","SharedDataCompanyApiFactory","TalentPoolModelApi","TalentPoolConstants","UserSchoolApi",function(_,$q,$log,$filter,UserService,SharedDataApiFactory,SharedDataCityApiFactory,SharedDataCompanyApiFactory,TalentPoolModelApi,TalentPoolConstants,UserSchoolApi){"use strict";var self=this,citySuggestionApi=null,titles=($filter("orderBy"),TalentPoolConstants.TITLES),fieldOfEmploymentOrStudy=TalentPoolConstants.FIELDS_OF_EMPLOYMENT_OR_STUDY;self.getUser=function(){return $log.debug("TalentPoolService::getUser"),UserService.getFullDetails().then(function(user){var userData={firstname:user.firstname,lastname:user.lastname,country:{id:user.location_country_id,title:user.location_country},city:{id:user.location_city_id,title:user.location_city_id?user.location_city_title:null},title:{id:user.title},jobPosition:{id:user.job_position_id},company:{id:user.company_id,title:user.company_title},companyIndustry:{id:user.job_industry_id,title:user.job_industry_title},jobResponsibility:{id:user.job_responsibility_id,title:user.job_responsibility_title},lengthOfTimeInRole:{id:user.job_experience_type_id},fieldOfEmployment:{id:0},school:{id:user.school_company_id,title:user.school_company_title},schoolCourse:{id:user.school_course_id,title:user.school_course_title},schoolProgrammeType:{id:user.school_programme_type_id},fieldOfStudy:{id:0},courseExpectations:""};return _.isNull(user.company_is_fashion)||(userData.fieldOfEmployment=_.find(fieldOfEmploymentOrStudy,{isFashion:user.company_is_fashion>0})),_.isNull(user.school_is_fashion)||(userData.fieldOfStudy=_.find(fieldOfEmploymentOrStudy,{isFashion:user.school_is_fashion>0})),user.job_position_id==TalentPoolConstants.STUDENT_JOB_POSITION_ID?UserSchoolApi.get().then(function(responseData){return userData.school=responseData.organisation,userData.schoolCourse=responseData.school_course,userData.schoolProgrammeType={id:responseData.school_programme_type_id},userData}):userData})},self.submitTalentPool=function(user,courseKey){var params={courseKey:courseKey},data={location_country_id:user.country.id,location_city_title:user.city.title,title:user.title.id,job_position_id:user.jobPosition.id,firstname:user.firstname,lastname:user.lastname};return user.city.id>0&&(data.location_city_id=user.city.id),user.jobPosition.id!=TalentPoolConstants.STUDENT_JOB_POSITION_ID?(user.company.id>0&&(data.company_id=user.company.id),user.company&&user.company.title&&(data.company_title=user.company.title),user.companyIndustry&&(data.job_industry_id=user.companyIndustry.id),user.jobResponsibility&&(data.job_responsibility_id=user.jobResponsibility.id),user.lengthOfTimeInRole&&(data.job_experience_type_id=user.lengthOfTimeInRole.id),user.fieldOfEmployment&&(data.company_is_fashion=user.fieldOfEmployment.isFashion)):(user.school.id>0&&(data.school_company_id=user.school.id),user.school&&user.school.title&&(data.school_company_title=user.school.title),user.schoolCourse.id>0&&(data.school_course_id=user.schoolCourse.id),user.schoolCourse&&user.schoolCourse.title&&(data.school_course_title=user.schoolCourse.title),user.schoolProgrammeType&&(data.school_programme_type_id=user.schoolProgrammeType.id),user.fieldOfStudy&&(data.school_is_fashion=user.fieldOfStudy.isFashion)),user.courseExpectations&&(data.course_expectations=user.courseExpectations),TalentPoolModelApi.submit(params,data).$promise},self.getCountries=function(selectedId){return getSharedData("countries",countryMapper).then(function(data){return formatSharedData(data,selectedId)})},self.getTitles=function(selectedId){return $q.resolve(formatSharedData(titles,selectedId))},self.getJobPositions=function(selectedId){return getSharedData("user-job-level-types",userJobLevelTypeMapper).then(function(data){return formatSharedData(data,selectedId)})},self.getCompanyIndustries=function(selectedId){return getSharedData("job-industries",commonSharedDataMapper).then(function(data){return formatSharedData(data,selectedId)})},self.getCompanyResponsibilities=function(selectedId){return getSharedData("job-responsibilities",commonSharedDataMapper).then(function(data){return formatSharedData(data,selectedId)})},self.getLengthOfTimeInRoleOptions=function(selectedId){return getSharedData("job-experience-types",commonSharedDataMapper).then(function(data){return formatSharedData(data,selectedId)})},self.getFieldsOfEmployment=function(selectedId){return $q.resolve(formatSharedData(fieldOfEmploymentOrStudy,selectedId))},self.getSchoolProgrammeTypes=function(selectedId){return getSharedData("school-programme-types",commonSharedDataMapper).then(function(data){return formatSharedData(data,selectedId)})},self.getFieldsOfStudy=function(selectedId){return $q.resolve(formatSharedData(fieldOfEmploymentOrStudy,selectedId))};var getSharedData=function(type,mapper){return new SharedDataApiFactory({type:type}).get().then(function(response){return _.map(response.data,mapper)})},formatSharedData=function(items,selectedId){return{items:items,selected:[_.find(items,{id:selectedId})]}},countryMapper=function(country){return{id:country.country_id,label:country.country_name}},commonSharedDataMapper=function(item){return{id:item.id,label:item.title}},userJobLevelTypeMapper=function(item){return{id:item.user_job_level_type_id,label:item.user_job_level_type_title}};self.getSchoolSuggestions=new SharedDataApiFactory({type:"schools"}).get,self.getSchoolCourseSuggestions=new SharedDataApiFactory({type:"school-courses"}).get,self.getCitySuggestions=function(query){return citySuggestionApi=citySuggestionApi||new SharedDataApiFactory({type:"cities"}),citySuggestionApi.get(query).then(function(response){return{data:_.map(response.data,function(item){return{id:item.id,title:item.label}})}})},self.getCitySuggesterByCountryId=function(countryId){var api=new SharedDataCityApiFactory({countryId:countryId});return function(query){return api.get(query).then(function(response){return{data:_.map(response.data,function(item){return{id:item.city_id,title:item.city_name}})}})}}}]),angular.module("app.education").service("TermsService",["DataService","TermsApi",function(DataService,TermsApi){"use strict";var defaultFilters={limit:4,offset:0,attributes:"default"};this.fetch=function(filters){return filters=DataService.createFilters(defaultFilters,filters),TermsApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,"term_id"),res})}}]),function(){"use strict";function courseEnrolmentService($q,$http){function isUserEnroled(courseUrl){function onResponse(res){deferred.resolve({enrolled:res.data.data.enrolled,url:res.data.data.url})}function onError(err){deferred.reject(err)}var deferred=$q.defer();return $http.get(courseUrl,{}).then(onResponse,onError),deferred.promise}return{isUserEnroled:isUserEnroled}}courseEnrolmentService.$inject=["$q","$http"],angular.module("app.education").factory("courseEnrolmentService",courseEnrolmentService)}(),function(){"use strict";function courseApi(_,$http,Routes){function get(courseIdentifier,params){function resolveSavedArticlesResponse(response){return _.get(response,"data.data")}var request={method:"GET",url:_.replace(Routes.EDUCATION.COURSE.GET,":course_ids",courseIdentifier),params:params||{}};return $http(request).then(resolveSavedArticlesResponse)}return{get:get}}courseApi.$inject=["_","$http","Routes"],angular.module("app.education").factory("courseApi",courseApi)}(),function(){"use strict";function otherCoursesApi(GenericApiFactory,Routes){function get(){return otherCoursesApi.get()}var otherCoursesApi=new GenericApiFactory(Routes.EDUCATION.COURSE.OTHER);return{get:get}}otherCoursesApi.$inject=["GenericApiFactory","Routes"],angular.module("app.education").factory("otherCoursesApi",otherCoursesApi)}(),function(){"use strict";function BarChartController($timeout){function $postLink(){$ctrl.dynamic_score=0,$timeout(function(){$ctrl.dynamic_score=$ctrl.score},500)}var $ctrl=this;$ctrl.$postLink=$postLink}var barChart={templateUrl:"/assets-access-layer/js/site/Education/templates/bar-chart.template.html",controller:BarChartController,bindings:{label:"@",score:"@",disableAnimation:"@"}};angular.module("app.education").component("barChart",barChart)}(),function(){"use strict";function ControllerController(_,$modal,EventManager,ChannelManager,UiModalService,EventManagerUtility,UiEvents){function $onInit(){$ctrl.userHasApplied=null}function $postLink(){listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,onInitState))}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function openModal(){modalOpen||(modalOpen=!0,UiModalService.openModal({controller:"CourseApplyController",template:"/templates/Education/course_apply_form"},{channel:$ctrl.channel,catalogue:$ctrl.data.catalogue,catalogueUrl:$ctrl.data.catalogueUrl,courseId:$ctrl.id,course:$ctrl.data.course}).finally(function(){modalOpen=!1}))}function onInitState(data){if(_.isEmpty(data)||Array.isArray(data))return $ctrl.userHasApplied=!_.isEmpty(data)&&_.some(data,["course_id",$ctrl.id]),void($ctrl.data={id:$ctrl.id,catalogue:$ctrl.catalogue,catalogueUrl:$ctrl.catalogueUrl,course:$ctrl.course,status:status});$ctrl.userHasApplied=data.status,$ctrl.data=data}var $ctrl=this,listeners=[],ChannelEventManager=ChannelManager.subscribe($ctrl.channel),modalOpen=!1;$ctrl.$onInit=$onInit,$ctrl.$postLink=$postLink,$ctrl.$onDestroy=$onDestroy,$ctrl.openModal=openModal}ControllerController.$inject=["_","$modal","EventManager","ChannelManager","UiModalService","EventManagerUtility","UiEvents"],angular.module("app.education").component("courseApply",{templateUrl:"/assets-access-layer/js/site/Education/templates/course-apply.template.html",controller:ControllerController,bindings:{classExtButton:"@",id:"@",channel:"@",catalogue:"@",catalogueUrl:"@",course:"@"}})}(),function(){"use strict";function CoursePaymentDetailsController(){function $onInit(){}function $onDestroy(){}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var coursePaymentDetailsComponent={templateUrl:"/assets-access-layer/js/site/Education/templates/course-payment-details.template.html",bindings:{coupon:"<",productTitle:"<",currencyCode:"<",currencySymbol:"<",price:"<"},controller:CoursePaymentDetailsController};angular.module("app.education").component("coursePaymentDetails",coursePaymentDetailsComponent)}(),function(){"use strict";function CourseNavigationController(otherCoursesApi){function $onInit(){$ctrl.courses=[],otherCoursesApi.get().then(function(response){$ctrl.courses=response.data})}var $ctrl=this;$ctrl.$onInit=$onInit}var courseNavigationComponent={templateUrl:"/assets-access-layer/js/site/Education/templates/courses-navigation.template.html",controller:CourseNavigationController};angular.module("app.education").component("coursesNavigation",courseNavigationComponent)}(),function(){"use strict";function EducationDynamicBannerController(_,$log,$q,authStream,MembershipTypes,MembershipConfig,membershipPlanApi,CurrencyConversionService){function $onInit(){if($ctrl.showBanner=!1,$ctrl.canUpgrade=!1,$ctrl.MembershipTypes=MembershipTypes,$ctrl.paymentPagePath="",!$ctrl.plan)return void $log.error("educationDynamicBanner: plan and/or paymentPage not set - not displaying");authListener=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){function onDataSuccess(response){var plan=response[0],prices=response[1];$ctrl.currency=_.get(plan,"currency"),$ctrl.currencySymbol=_.get(plan,"plan_data.prices.symbol"),$ctrl.originalYearlyPrice=_.get(plan,"plan_data.prices.original_yearly_price");var price=_.find(prices,["currency",$ctrl.currency]);$ctrl.singleCoursePrice=price.price,$ctrl.showBanner=!$ctrl.isMember||$ctrl.membershipPlan===MembershipTypes.INDIVIDUAL_YEARLY_KEY||$ctrl.membershipPlan===MembershipTypes.INDIVIDUAL_STUDENT_KEY||$ctrl.membershipPlan===MembershipTypes.INDIVIDUAL_MONTHLY_KEY,$ctrl.canUpgrade=$ctrl.membershipPlan===MembershipTypes.INDIVIDUAL_STUDENT_KEY||$ctrl.membershipPlan===MembershipTypes.INDIVIDUAL_MONTHLY_KEY}$ctrl.membershipPlan=user.getMembershipType(),$ctrl.isMember=user.hasMembership(),$ctrl.hasAccessToAllCourses=$ctrl.membershipPlan===MembershipTypes.INDIVIDUAL_YEARLY_KEY,setPaymentPagePath();var promises=[membershipPlanApi.get($ctrl.plan),CurrencyConversionService.convert(MembershipConfig.SINGLE_COURSE_PRICE,MembershipConfig.SINGLE_COURSE_PRICE_CURRENCY)];$q.all(promises).then(onDataSuccess)}function $onDestroy(){authListener.dispose()}function setPaymentPagePath(){switch($ctrl.membershipPlan){case MembershipTypes.INDIVIDUAL_MONTHLY_KEY:$ctrl.paymentPagePath="/spa#/app/membership/packages";break;default:$ctrl.paymentPagePath="/memberships/payment/v1_yearly?journeyContext=education-marketing-page&int_source=direct&int_medium=banner&int_campaign=permanent-professional&int_content=education-dynamic-banner-top"}}var authListener,$ctrl=this;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit,$ctrl.displayPrice=function(price,showVATForEur){showVATForEur=!!_.isUndefined(showVATForEur)||showVATForEur;var formattedPrice="USD"===$ctrl.currency?"USD "+$ctrl.currencySymbol+price:$ctrl.currencySymbol+price;return"EUR"===$ctrl.currency&&showVATForEur&&(formattedPrice+=" + VAT"),formattedPrice}}var educationDynamicBannerComponent={templateUrl:"/assets-access-layer/js/site/Education/components/education-dynamic-banner.html",controller:EducationDynamicBannerController,bindings:{plan:"@"}};angular.module("app.education").component("educationDynamicBanner",educationDynamicBannerComponent)}(),function(){"use strict";function EducationDynamicFeatureHeaderController(_,courseApi,authStream,membershipPlanApi,$q,journeyContextService){function $onInit(){authSubscription=authStream.USER_DATA_CHANGED.subscribe(onUserDataChanged),$ctrl.bgImageClass="mem-dynamic-header__background--",$ctrl.isLoading=!0,$ctrl.annualCtaUrl=journeyContextService.generatePaymentPlanUrl("/memberships/payment/v1_yearly")}function onUserDataChanged(user){function handleSuccess(res){var course=res[0],plan=res[1];$ctrl.currency=_.get(plan,"currency"),$ctrl.currencySymbol=_.get(plan,"plan_data.prices.symbol"),$ctrl.originalYearlyPrice=_.get(plan,"plan_data.prices.original_yearly_price"),$ctrl.courseTitle=course.course_title,$ctrl.instructorTitle=_.get(course,"instructor.first_name")+" "+_.get(course,"instructor.last_name"),$ctrl.coursePrice=course.price,$ctrl.courseSlug=course.course_key,$ctrl.bgImageClass+=course.course_key,$ctrl.isLoading=!1}switch($ctrl.membershiptype=user.getMembershipType(),$ctrl.membershiptypeCamelCase=_.camelCase($ctrl.membershiptype),user.getMembershipType()){case"individual-yearly":$ctrl.membershipPackage="yearly";break;case"individual-monthly":$ctrl.membershipPackage="monthly";break;case"individual-student":$ctrl.membershipPackage="student";break;default:$ctrl.membershipPackage="group"}courseApiPromise=courseApi.get($ctrl.courseSlug,{decorate:"instructor"}),membershipPlanApiPromise=membershipPlanApi.get("v1_yearly"),$q.all([courseApiPromise,membershipPlanApiPromise]).then(handleSuccess)}function $onDestroy(){authSubscription.dispose()}var authSubscription,courseApiPromise,membershipPlanApiPromise,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var educationDynamicFeatureHeaderComponent={templateUrl:"/assets-access-layer/js/site/Education/components/education-dynamic-feature-header.html",bindings:{courseSlug:"@"},controller:EducationDynamicFeatureHeaderController};angular.module("app.education").component("educationDynamicFeatureHeader",educationDynamicFeatureHeaderComponent)}(),function(){"use strict";function FormErrorsController(_,authModalService,DomService){function $onInit(){}function $onChanges(){_.isUndefined($ctrl.error)||_.isUndefined($ctrl.error.type)||scrollToError()}function $onDestroy(){}function openLogin(event){event.preventDefault(),authModalService.openLogin("default",{},!0)}function scrollToError(){DomService.scrollToElement(DomService.getElement("#form-error"),100)}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$onDestroy=$onDestroy,$ctrl.openLogin=openLogin}FormErrorsController.$inject=["_","authModalService","DomService"];var formErrorsComponent={templateUrl:"/assets-access-layer/js/site/Education/templates/form-errors.template.html",bindings:{error:"<",errorSource:"@"},controller:FormErrorsController};angular.module("app.payment").component("formErrors",formErrorsComponent)}(),function(){"use strict";function RankingDynamicSearchController(_,RankingDynamicSearchApiFactory,EventManagerUtility,UrlService,DataService){function $onInit(){function lookUpTable(res){var mapId=_.map(res.data,function(item){return item.id=item.profile_id,item});return DataService.createAssociativeStruct(mapId,"years")}function assignSchoolsYears(data){$ctrl.schools=data.original,$ctrl.years=_.sortBy(data.result,function(year){return year.id}).reverse(),$ctrl.modelYear=_.find($ctrl.years,function(year){return year.id===$ctrl.year})}$ctrl.modelSchool=null,$ctrl.modelYear=null,$ctrl.schools=[],$ctrl.years=[],RankingApi.search().then(lookUpTable).then(assignSchoolsYears)}function filterItems(){$ctrl.modelSchool&&($ctrl.years=_.filter($ctrl.years,function(item){return _.includes($ctrl.modelSchool.relations,item.id)})),$ctrl.modelYear?$ctrl.schools=_.filter($ctrl.schools,function(item){return _.includes(item.relations,$ctrl.modelYear.id)}):$ctrl.schools=$ctrl.schools}function goToSearch(){var rankingPage=_.template("/education/rankings/${year}/${level}"),schoolPage=_.template("/education/rankings/${year}/schools/${school}"),url=UrlService.getCurrentUrl(),level=url.substr(url.lastIndexOf("/")+1);$ctrl.modelSchool?UrlService.changeUrl(schoolPage({year:$ctrl.modelYear?$ctrl.modelYear.id:_.find($ctrl.years,{id:_.last($ctrl.modelSchool.relations)}).id,school:$ctrl.modelSchool.profile_slug})):UrlService.changeUrl(rankingPage({year:$ctrl.modelYear.id,level:"bachelors"===level||"masters"===level?level:""}))}var $ctrl=this,RankingApi=new RankingDynamicSearchApiFactory;$ctrl.$onInit=$onInit,$ctrl.filterItems=filterItems,$ctrl.goToSearch=goToSearch}RankingDynamicSearchController.$inject=["_","RankingDynamicSearchApiFactory","EventManagerUtility","UrlService","DataService"];var rankingDynamicSearch={bindings:{year:"@",channel:"@"},templateUrl:"/templates/Education/ranking_dynamic_search",controller:RankingDynamicSearchController};angular.module("app.education").component("rankingDynamicSearch",rankingDynamicSearch)}();!function(){"use strict";function RankingResultRowController($log,UrlService){function $onInit(){var mainLink=$ctrl.item.url+"?type=";switch($ctrl.rowIndex=index++,$ctrl.item.programme_type_id){case 1:$ctrl.mainLink=mainLink+"bachelors";break;case 2:$ctrl.mainLink=mainLink+"masters";break;case 3:$ctrl.mainLink=mainLink+"business";break;default:$log.error("rankingResultRow::$onInit:: Invalid / Missing programme type:",$ctrl.item.programme_type_id)}}function visitSchoolRankings(){UrlService.changeUrl($ctrl.mainLink)}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.visitSchoolRankings=visitSchoolRankings}RankingResultRowController.$inject=["$log","UrlService"];var index=0,rankingResultRow={bindings:{item:"<"},templateUrl:"/assets-access-layer/js/site/Education/templates/ranking-result-row.template.html",controller:RankingResultRowController};angular.module("app.education").component("rankingResultRow",rankingResultRow)}(),function(){"use strict";function RankingResultController(ChannelManager,EventManagerUtility,rankingApi,InputUtil,DataService,UiEvents,PaginationService){function $onInit(){$ctrl.items=[],filters={offset:0,limit:InputUtil.toInt($ctrl.limit,12),order:"overall_rank",data_source_key:$ctrl.year},$ctrl.typeId&&(filters.programme_type_id=$ctrl.typeId),$ctrl.handleSearch(!1,!0),ChannelEventManager.emit(UiEvents.INJECT_SORT,{key:"overall_rank",status:!0}),listeners.push(ChannelEventManager.onFresh(UiEvents.LOAD_MORE,function(res){PaginationService.nextPage(filters),filters.limit=100,$ctrl.handleSearch(!0)})),listeners.push(ChannelEventManager.on(UiEvents.EDIT_INLINE,function(res){filters[res.id]=res.value.length>2?res.value:"",$ctrl.handleSearch(!1,!0)})),listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_SORT,function(res){filters.order=res.order,filters.offset=0,$ctrl.handleSearch(!1)}))}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function handleSearch(loadMore,resetPagination){rankingApi.search(filters).then(function(res){loadMore?DataService.add($ctrl.items,DataService.addTrackBy(res.data.results,"overall_rank")):$ctrl.items=DataService.addTrackBy(res.data.results,"overall_rank"),ChannelEventManager.emit(UiEvents.UPDATE_PAGINATION,{page:PaginationService.getPage(filters),total:res.data.total,limit:filters.limit})})}var filters,$ctrl=this,listeners=[],ChannelEventManager=ChannelManager.subscribe($ctrl.channel);$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleSearch=handleSearch}RankingResultController.$inject=["ChannelManager","EventManagerUtility","rankingApi","InputUtil","DataService","UiEvents","PaginationService"];var rankingResult={bindings:{channel:"@",limit:"@",typeId:"@",year:"@"},templateUrl:"/assets-access-layer/js/site/Education/templates/ranking-result.template.html",controller:RankingResultController};angular.module("app.education").component("rankingResult",rankingResult)}(),function(){"use strict";function RankingToggleController(_){function setActive(prId){$ctrl.ngModel=prId,_.forEach($ctrl.programTypes,function(pt){pt.active=pt.id===prId})}var $ctrl=this;$ctrl.setActive=setActive}RankingToggleController.$inject=["_"];var rankingToggle={bindings:{ngModel:"=?",programTypes:"="},templateUrl:"/assets-access-layer/js/site/Education/templates/ranking-toggle.template.html",controller:RankingToggleController};angular.module("app.education").component("rankingToggle",rankingToggle)}(),function(){"use strict";function ScoreChartController(chartManager,$filter){function $onInit(){var precision=$ctrl.precision?parseInt($ctrl.precision):0,label=$filter("number")($ctrl.score,precision);$ctrl.animationFlag="true"!==$ctrl.disableAnimation,$ctrl.chartColour=chartManager.getColors($ctrl.colour),$ctrl.chartLabel=[label,null],$ctrl.chartData=[$ctrl.score,($ctrl.totalScore||100)-$ctrl.score]}var $ctrl=this;$ctrl.$onInit=$onInit}var scoreChart={templateUrl:"/assets-access-layer/js/site/Education/templates/score-chart.template.html",controller:ScoreChartController,bindings:{score:"@",totalScore:"@",label:"@",colour:"@",disableAnimation:"@",precision:"@"}};angular.module("app.education").component("scoreChart",scoreChart)}(),function(){"use strict";function SignupWithPayController(_,$log,authModalService,CoreValidations,PaymentStream,FormServiceFactory,EventManagerUtility){function $onInit(){$ctrl.emailPattern=CoreValidations.EMAIL,$ctrl.passwordPattern=CoreValidations.PASSWORD,$ctrl.user=_.clone(formData),$ctrl.form={ref:"signup-with-pay",data:formData}}function $postLink(){FormService=new FormServiceFactory($ctrl.form)}function $onChanges(changesObj){changesObj.defaultFirstName&&!formData.firstname&&(formData.firstname=changesObj.defaultFirstName.currentValue),changesObj.defaultLastName&&!formData.lastname&&(formData.lastname=changesObj.defaultLastName.currentValue),changesObj.defaultEmail&&!formData.email&&(formData.email=changesObj.defaultEmail.currentValue),changesObj.triggerSubmit&&!changesObj.triggerSubmit.isFirstChange()&&onFormSubmitAttempt()}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function openLogin(event){event.preventDefault(),authModalService.openLogin("default",{},!0)}function onFormSubmitAttempt(){FormService.canSubmit()}function onFormFieldChange(type){var formChangedPayload={formData:_.clone(formData),isValid:FormService.isValid()};_.isEqual(formChangedPayload,lastEmittedPayload)||(lastEmittedPayload=formChangedPayload,$ctrl.onChange({$event:formChangedPayload}))}var lastEmittedPayload,FormService,$ctrl=this,listeners=[],formData={firstname:void 0,lastname:void 0,email:void 0,password:void 0};$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$postLink=$postLink,$ctrl.$onDestroy=$onDestroy,$ctrl.onFormFieldChange=onFormFieldChange,$ctrl.openLogin=openLogin}var signupWithPayComponent={templateUrl:"/assets-access-layer/js/site/Education/templates/signup-with-pay.template.html",bindings:{defaultFirstName:"<",defaultLastName:"<",defaultEmail:"<",isLoggedIn:"<",triggerSubmit:"<",onChange:"&"},controller:SignupWithPayController};angular.module("app.education").component("signupWithPay",signupWithPayComponent)}(),function(){"use strict";function EducationRankings(DataService,RankingModel){function fetch(filters){return filters=DataService.createFilters({limit:5,offset:0},filters),RankingModel.fetch(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data),res})}this.fetch=fetch}EducationRankings.$inject=["DataService","RankingModel"],angular.module("app.education").service("educationRankings",EducationRankings)}(),angular.module("app.newsletter").constant("NewsletterList",{DAILY:1,WEEKLY:4,FASHION_WEEK:8}).constant("NewsletterEvents",{SUBSCRIBE_MODAL_OPEN:"SUBSCRIBE_MODAL_OPEN"}),angular.module("app.newsletter").controller("subscribePopupController",["_","$scope","$timeout","$q","$window","$modalInstance","FormServiceFactory","NewsletterService","DomService","modalData","authModalService","SubscribePopupService",function(_,$scope,$timeout,$q,$window,$modalInstance,FormServiceFactory,NewsletterService,DomService,modalData,authModalService,SubscribePopupService){"use strict";$scope.form={},$scope.user=modalData.user,$scope.buttonLabel=modalData.buttonLabel,$scope.title=modalData.title,$scope.listId=modalData.listId,$scope.data={message:modalData.message,url:modalData.url,email:NewsletterService.isEmailValid($scope.user.email)?$scope.user.email:null,disabled:NewsletterService.isEmailValid($scope.user.email),list_id:modalData.listId,source:modalData.source};var FormService=new FormServiceFactory($scope.form);$scope.canSubmit=function(){return FormService.canSubmit()},$scope.close=function(){$modalInstance.close()},$scope.dismiss=function(){$modalInstance.dismiss(!1)},$scope.signup=function(){authModalService.openSignup("default",{email:$scope.data.email}),$scope.close()}}]),angular.module("app.newsletter").directive("subscribePopup",["_","$document","SubscribePopupService","EventManager","UserService","$timeout","AuthEvents","NewsletterEvents","AgentService","PageCountService","DataService","TrackerService","modalService",function(_,$document,SubscribePopupService,EventManager,UserService,$timeout,AuthEvents,NewsletterEvents,AgentService,PageCountService,DataService,TrackerService,modalService){"use strict";return{restrict:"E",scope:{email:"@",listId:"@",counter:"@",source:"@",openDelay:"@"},link:function(scope,element,attrs){var modalInstance=null,listId=scope.listId?parseInt(scope.listId,10):1,counter=(scope.email,scope.counter?parseInt(scope.counter,10):1),source=scope.source||"default",user={},openDelay=scope.openDelay?parseInt(scope.openDelay):2e3,trackerEventDomain=attrs.tracker,trackerClickEvent=attrs.trackerClk,trackerParameters=DataService.buildDataFromAttributes(attrs,"tracker"),init=!1;scope.trackEvent=function(action){TrackerService.track(trackerEventDomain,trackerClickEvent,trackerParameters,action)},scope.closeTemporarily=function(){SubscribePopupService.setExpiry(listId,1),scope.trackEvent("closeTemporarily")},scope.closePermanently=function(days){SubscribePopupService.setExpiry(listId,days),scope.trackEvent("closePermanently")},scope.openModal=function(){modalService.isOpen()||(EventManager.emit(NewsletterEvents.SUBSCRIBE_MODAL_OPEN,{}),scope.trackEvent("open"),modalInstance=modalService.open({templateUrl:"/assets-access-layer/js/site/Newsletter/templates/subscribe_newsletter.html",controller:"subscribePopupController",size:"md",backdrop:!1,windowClass:"modal-fixed-bottom s_modal-fixed-desktop",resolve:{modalData:function(){return{user:user,listId:listId,source:source}}}}),modalInstance.result.then(function(res){scope.closeTemporarily()},function(res){res?scope.trackEvent("closeAfterSubscribe"):scope.closePermanently(7)}))},trackerParameters=_.omit(trackerParameters,["Clk"]),EventManager.on(AuthEvents.USER_CHANGED,function(data){init||(init=!0,data.id&&(user=data),$timeout(function(){user.id||SubscribePopupService.isExpired(scope.listId)&&(!AgentService.isMobile()||AgentService.isMobile()&&PageCountService.getPageCount()>=counter)&&scope.openModal()},openDelay))})}}}]),angular.module("app.newsletter").directive("subscribeWidgetV2",["_","EventManager","FormServiceFactory","NewsletterService","AuthEvents","UserService","authModalService",function(_,EventManager,FormServiceFactory,NewsletterService,AuthEvents,UserService,authModalService){"use strict";return{scope:{type:"@",source:"@",listId:"@",classContainer:"@"},templateUrl:function(tElement,tAttrs){return"/templates/Newsletter/subscribe-widget-v2_"+(tAttrs.type||"default")},replace:!0,restrict:"E",link:function(scope,element,attr){var source=(attr.model,scope.source||"default"),listId=scope.listId?parseInt(scope.listId,10):1,FormService=new FormServiceFactory(scope.form);scope.data={email:scope.email,list_id:listId,source:source},scope.user={},scope.subscribed=!1,scope.complete=!1,scope.canSubmit=function(){return FormService.canSubmit()},scope.submit=function(){},scope.signup=function(){authModalService.setSubscribeSource("SubscribeWidget"),authModalService.openSignup("default",{email:scope.data.email})},scope.getState=function(){return scope.subscribed?scope.subscribed&&!scope.user.id?"is_subscribed_anon":scope.subscribed&&scope.user.id&&!scope.complete?"is_subscribed_logged_not-complete":scope.subscribed&&scope.user.id&&scope.complete?"is_subscribed_logged_complete":void 0:"is_not-subscribed"},EventManager.on(AuthEvents.USER_CHANGED,function(user){user.id?(scope.user=user.getPayload(),user.email&&(scope.data.email=NewsletterService.isEmailValid(user.email)?user.email:null,scope.data.disabled=NewsletterService.isEmailValid(user.email)),scope.subscribed=user.newsletters.isSubscribed(_.parseInt(listId)),scope.complete=user.complete):(scope.user={},scope.data.email="",scope.data.disabled=!1,scope.subscribed=!1,scope.complete=!1),scope.state=scope.getState()})}}}]).directive("subscribeWidgetHide",["EventManager","AuthEvents",function(EventManager,AuthEvents){return{replace:!0,transclude:!0,restrict:"E",template:'<div ng-hide="isSubscribed"><ng-transclude/></div>',scope:{listId:"@"},link:function(scope,element,attr){var listId=parseInt(scope.listId,10);scope.isSubscribed=!1,EventManager.on("SUBSCRIBE_WIDGET_IS-SUBSCRIBED",function(data){scope.isSubscribed=listId==data.listId}),EventManager.on(AuthEvents.USER_CHANGED,function(user){user.newsletters.isSubscribed(listId)})}}}]),angular.module("app.newsletter").directive("subscribeWidget",["_","$log","$q","$timeout","$window","NewsletterService","FormServiceFactory","EventManager","UserService","authModalService","AuthEvents",function(_,$log,$q,$timeout,$window,NewsletterService,FormServiceFactory,EventManager,UserService,authModalService,AuthEvents){"use strict";return{scope:{type:"@",listId:"@",source:"@",place:"@",blockHeading:"@",blockSubheading:"@"},templateUrl:"/templates/Newsletter/subscribe_widget",replace:!0,transclude:!0,restrict:"E",link:function(scope,element,attr){var FormService=new FormServiceFactory(scope.form),listId=scope.listId?scope.listId.split(","):[1],source=scope.source||"default";scope.data={email:scope.email,list_id:listId,source:source},scope.user={},scope.subscribed=!1,scope.complete=!1,scope.hideFollow="true"===attr.hideFollow,scope.showText="true"===attr.showText,EventManager.on(AuthEvents.USER_CHANGED,function(user){user.id?(scope.user=user.getPayload(),user.email&&(scope.data.email=NewsletterService.isEmailValid(user.email)?user.email:null,scope.data.disabled=NewsletterService.isEmailValid(user.email)),scope.subscribed=user.newsletters.isSubscribed(_.map(listId,_.parseInt)),scope.complete=user.complete):(scope.user={},scope.data.email="",scope.data.disabled=!1,scope.subscribed=!1,scope.complete=!1)}),scope.canSubmit=function(){return FormService.canSubmit()},scope.submit=function(){},scope.signup=function(){authModalService.setSubscribeSource("SubscribeWidget"),authModalService.openSignup("default",{email:scope.data.email})}}}}]),angular.module("app.newsletter").directive("subscribedShow",["EventManager","UserService","AuthEvents",function(EventManager,UserService,AuthEvents){"use strict";return{restrict:"A",scope:{listId:"@showIfNotSubscribed"},link:function(scope,element,attrs){var negate=(attrs.listId,"true"===attrs.negate),childNode=element[0].childNodes[0],childNodeElement=angular.element(childNode);EventManager.on(AuthEvents.USER_CHANGED,function(user){if(user.id){(user.complete&&UserService.isSubscribed(user,parseInt(scope.listId,10)))^negate&&childNodeElement.addClass("hide")}else childNodeElement.removeClass("hide")})}}}]),angular.module("app.newsletter").service("NewsletterService",["_","authService","Routes","GenericApiFactory",function(_,authService,Routes,GenericApiFactory){"use strict";var NewsletterApi=new GenericApiFactory(Routes.USER.NEWSLETTER_SUBSCRIBE);this.isEmailValid=function(email){if(email){var parts=email.split("@");if(parts.length>1)return parts[1].indexOf(".")>=0}return!1},this.subscribe=function(data){data=_.pick(data,["list_id","email","source"]);var _onSubscribeSuccess=function(res){return authService.refreshAccessToken(),res};return NewsletterApi.post(data).then(_onSubscribeSuccess)}}]),angular.module("app.newsletter").service("SubscribePopupService",["moment","CryptService","$localStorage",function(moment,CryptService,$localStorage){"use strict";this.getData=function(popupId){var data=$localStorage["bus_"+popupId];return data?CryptService.decryptJson(data):null},this.setData=function(popupId,data){$localStorage["bus_"+popupId]=CryptService.encryptJson(data)},this.setExpiry=function(popupId,days){this.setData(popupId,{expires:moment().add(days,"days").format("X")})},this.isExpired=function(popupId){var data=this.getData(popupId);return!data||parseInt(moment().format("X"),10)>parseInt(data.expires,10)}}]),function(){"use strict";function NewsLetterSubscribeFormController(_,$q,$window,$timeout,DomService,authService,authStream,CONSENT_JOURNEY,userConsentApi,FormServiceFactory){function $onInit(){$ctrl.form={ref:null},$ctrl.consentsForm={},FormService=new FormServiceFactory($ctrl.form),$ctrl.consentJourneyId=CONSENT_JOURNEY.NewslettersSubscribe,userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged)}function $onDestroy(){userChangedSub.dispose()}function onConsentsChange(event){$ctrl.consentsForm=event,$ctrl.isReady=!0}function canSubmit(){$ctrl.submitErrorMsg=null,setDirty();var isValid=FormService.canSubmit();return isValid||(scrollToFormError(),$ctrl.consentsForm.isValid||($ctrl.submitErrorMsg="For us to send you the newsletter, we need for you to consent to receiving it.")),isValid}function submit(){function onSuccess(res){function redirect(){$window.location.href=$ctrl.referer}authService.refreshAccessToken(),$timeout(redirect,300),deferred.resolve()}function onError(res){!0===_.get(res,"data.error")&&($ctrl.errors={type:"SERVER_ERROR"},$ctrl.errors.message="MALFORMED_EMAIL"===res.data.message?res.data.message:"GENERIC_FE_ERROR"),$ctrl.submitting=!1,deferred.reject()}$ctrl.submitting=!0;var deferred=$q.defer();return $ctrl.triggerTracking=!0,updateConsents().then(onSuccess,onError),deferred.promise}function onUserChanged(user){$ctrl.isLoggedIn=user.isLoggedIn(),$ctrl.subscriberEmail=user.getEmail()||$ctrl.emailPreset,$ctrl.questions=[],$ctrl.isUserInit?$ctrl.isLoggedIn&&userConsentApi.getUserConsents():($ctrl.isUserInit=!0,$ctrl.isReady=!1)}function updateConsents(){return userConsentApi.update(_.get($ctrl.consentsForm,"formData"),$ctrl.consentJourneyId,{user_email:$ctrl.subscriberEmail,source:$ctrl.source})}function setDirty(){$ctrl.form.ref.$setDirty(),iterateFields($ctrl.form.ref,function(field){field.$setDirty()})}function iterateFields(form,handler){_.forOwn(form,function(value){"object"==typeof value&&value.hasOwnProperty("$modelValue")&&handler(value)})}function scrollToFormError(){var scroll=!1;iterateFields($ctrl.form.ref,function(field){"_captcha"!==field.$name&&field.$invalid&&(scroll=!0)}),scroll&&DomService.scrollToElement(angular.element(DomService.getElement("#newsLetterSubscribeForm")),80,500)}var userChangedSub,FormService,$ctrl=this;$ctrl.isUserInit=!1,$ctrl.isReady=!1,$ctrl.consentErrors=[],$ctrl.triggerTracking=!1,$ctrl.$onInit=$onInit,$ctrl.onDestroy=$onDestroy,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,$ctrl.onConsentsChange=onConsentsChange}NewsLetterSubscribeFormController.$inject=["_","$q","$window","$timeout","DomService","authService","authStream","CONSENT_JOURNEY","userConsentApi","FormServiceFactory"],angular.module("app.newsletter").component("newsletterSubscribeForm",{bindings:{emailPreset:"@?",source:"@?",referer:"@",listId:"@?"},templateUrl:"/assets-access-layer/js/site/Newsletter/components/newsletter-subscribe-form/newsletter-subscribe-form.html",controller:NewsLetterSubscribeFormController})}(),function(){"use strict";function menuContainerDirective($window,EventManager){function link(scope){scope.pageUrl=null,scope.view="",scope.loading=!1,scope.items=[],scope.href="",scope.external=null,scope.link=function(){event.stopPropagation(),event.preventDefault(),$window.location.href=scope.href},EventManager.on("menuInjectChange",function(data){data.container===scope.id&&(data.external?(scope.external=data.external,scope.items=[],scope.loading=!1):(scope.external=null,scope.items=data.items,scope.view=data.view,scope.href=data.href,scope.loading=!1))})}return{templateUrl:"/assets-access-layer/js/site/Menu/templates/thumbnail-menu.html",replace:!0,restrict:"E",scope:{id:"@"},link:link}}menuContainerDirective.$inject=["$window","EventManager"],angular.module("app.menu").directive("menuContainer",menuContainerDirective)}(),function(){"use strict";function menuInjectorDirective($q,$log,$window,$timeout,EventManager,ArrayService,PaginationService,ArticleService,DiscussionService,CareerService,ProfileService,SchoolsService,CoursesService,TermsService,AgentService,DailyDigestService,educationRankings,ShowService){function link(scope){var items=[],dataPromise=null,href=scope.href,filters={offset:0,limit:5,attributes:"short",categories:scope.categories,types:scope.types||"post",sort:"DESC",has_composite_parents:scope.hasCompositeParents},articleCategoriesAllowed=["intelligence","professional","global-currents","fashion-tech","people","company-culture-guide","education","opinion","education-report-2015","video","voices","voices-video","beauty"];if(scope.link=function(event){event.stopPropagation(),event.preventDefault(),$window.location.href=href},scope.load=function(){var promise=null;if(ArrayService.inArray(articleCategoriesAllowed,scope.categories))promise=ArticleService.getAll(filters);else if(ArrayService.inArray(["digest"],scope.categories))promise=DailyDigestService.getArticles({},!0);else if(ArrayService.inArray(["syndicated"],scope.categories))promise=ArticleService.getAllSyndicatedTopStory(filters);else if(ArrayService.inArray(["discussion"],scope.categories))promise=DiscussionService.getAll(filters,!0);else if(ArrayService.inArray(["functions","companies","content"],scope.categories))promise=CareerService.getAll(filters,!0);else if(ArrayService.inArray(["bof500"],scope.categories))promise=ProfileService.getSearchAll(scope.collectionId,filters.limit);else if(ArrayService.inArray(["functions","courses","content"],scope.categories))promise=CoursesService.getAll(filters,!0);else if(ArrayService.inArray(["school"],scope.categories))promise=SchoolsService.getAll(filters,!0);else if(ArrayService.inArray(["term"],scope.categories))promise=TermsService.fetch();else if(ArrayService.inArray(["rankings"],scope.categories))promise=educationRankings.fetch();else{if(!ArrayService.inArray(["shows"],scope.categories))return $q.resolve();promise=ShowService.getFeaturedShows(scope.season,scope.week)}return promise.then(function(res){items=res.data})},scope.inject=function(event){event&&(event.stopPropagation(),event.preventDefault()),dataPromise||(dataPromise=scope.load()),dataPromise.then(function(){$log.debug("menuInjector::inject:: Inject into",scope.container,"View",scope.view,"Items",items),(items||scope.external)&&EventManager.emit("menuInjectChange",{container:scope.container,external:scope.external,view:scope.view,href:href,items:items})})},EventManager.on("menuInjectChange",function(data){data.container===scope.container&&(data.href===href?scope.active=!0:scope.active=!1)}),scope.active)var navigationChangeDropdownListener=EventManager.on("NavigationChangeDropdown",function(data){data.status&&data.container===scope.container&&(scope.inject(),navigationChangeDropdownListener())})}return{template:'<a ng-class="{active: active}" ng-lazy-mouseover="inject($event)" ng-click="link($event)" ng-transclude></a>',restrict:"A",transclude:!0,scope:{container:"@",view:"@",categories:"@",href:"@",active:"@",external:"@",types:"@",filters:"@",hasCompositeParents:"@",collectionId:"@",season:"@",week:"@"},link:link}}menuInjectorDirective.$inject=["$q","$log","$window","$timeout","EventManager","ArrayService","PaginationService","ArticleService","DiscussionService","CareerService","ProfileService","SchoolsService","CoursesService","TermsService","AgentService","DailyDigestService","educationRankings","ShowService"],angular.module("app.menu").directive("menuInjector",menuInjectorDirective)}(),angular.module("app.career").constant("CareerConfig",{COMPANY_CACHE:"CareerCompaniesCache",JOB_CACHE:"CareerJobCache",FILTER_CACHE:"CareerFilterCache"}),angular.module("app.career").constant("CareerEvents",{CHANGE_ALERT:"CareerChangeAlertEvent",TITLE_CHANGE:"CareerTitleChangeEvent"}),angular.module("app.career").constant("CareerPaths",{SPA_JOB_APPLICATIONS:"/spa#/app/account/applications"}),angular.module("app.career").constant("CareerTemplates",{SEARCH_RESULTS:"/templates/Careers/career_company_result",SEARCH_FILTER_SELECTED:"/templates/Careers/career_filter_selected",SEARCH_JOB_RESULTS:"/templates/Careers/career_job_result",JOB_APPLY_BUTTON:"/templates/Careers/job_apply_button",BEST_COMPANIES_PROMO_STICKY_FOOTER:"/assets-access-layer/js/site/Career/templates/best-companies-promo-sticky-footer.template.html",MODAL_RIGHT_TO_WORK:"/assets-access-layer/js/site/Career/templates/modal-job-application-right-to-work.template.html",MODAL_JOB_BOOKMARK_SUCCESSFUL:"/assets-access-layer/js/site/Career/templates/modal-job-bookmark-successful.template.html",BOOKMARK_JOB_FORM:"/assets-access-layer/js/site/Career/templates/bookmark-job-form.template.html"}),angular.module("app.career").directive("careerCompanyResult",["_","moment","UiEvents","ChannelManager","PaginationService","DataService","CareerOrganisationApiFactory","DomService","CareerTemplates","UrlService","EventManagerUtility","legacyTrackService","CareerService","AgentService",function(_,moment,UiEvents,ChannelManager,PaginationService,DataService,CareerOrganisationApiFactory,DomService,CareerTemplates,UrlService,EventManagerUtility,legacyTrackService,CareerService,AgentService){"use strict";return{restrict:"E",replace:!0,templateUrl:CareerTemplates.SEARCH_RESULTS,scope:{country:"@",companyType:"@",baseUri:"@",channel:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),listeners=[],filters={offset:0,limit:12,query:"",order:null},omitFilters=["limit","offset"],omitTrackFilters=["limit","offset","query","order","random_score"],selectOptions={order:[{id:"most_jobs",label:"By most jobs",generateRandom:!1},{id:"alphabetical",label:"Alphabetical",generateRandom:!1}]},CareerApi=new CareerOrganisationApiFactory;scope.items=[],scope.count=0,ChannelEventManager.on(UiEvents.INIT_STATE,function(data){data.rebuild},!0),scope.handleFilters=function(filters){ChannelEventManager.emit(UiEvents.CHANGE_STATE,filters,!1)},scope.handleRandom=function(value){value?filters.random_score=moment().format("x"):delete filters.random_score},scope.handleSearch=function(loadMore,resetPagination,initial){resetPagination&&PaginationService.reset(filters);var searchFilters=DataService.sanitiseDataForQuerystring(filters),newFilters=_.omit(searchFilters,omitFilters);_.omit(filters,omitTrackFilters);_.head(selectOptions.order).id===newFilters.order&&(newFilters=_.omit(newFilters,["order"]));var categoryUrl=CareerService.getCompanySearchCategoryUrl(filters,newFilters);if(UrlService.setQueryParams(newFilters),legacyTrackService.pageView(),initial&&scope.baseUri)return void UrlService.changePath(scope.baseUri);CareerApi.search(searchFilters).then(function(res){loadMore?DataService.add(scope.items,DataService.addTrackBy(res.data.results,"profile_id")):scope.items=DataService.addTrackBy(res.data.results,"profile_id"),loadMore||initial||!AgentService.isMobilePhone()||DomService.scrollToElement(element,90,1e3),scope.count=res.data.total,scope.handleFilters(res.data.aggregations),ChannelEventManager.emit(UiEvents.UPDATE_PAGINATION,{total:res.data.total,page:PaginationService.getPage(filters),limit:filters.limit}),ChannelEventManager.emit(UiEvents.INJECT_STATE,res.data.aggregations),ChannelEventManager.emit(UiEvents.INJECT_SOCIAL_META,{url:categoryUrl})},function(res){PaginationService.reset(filters)})},CareerApi.getFilters().then(function(res){var dataFilters=_.assign(res.data,selectOptions),urlData=UrlService.parseQuery(),selectedPageFilters=DataService.rebuildDataFromQuerystring({hq_country_ids:scope.country,organisation_type_ids:scope.companyType},dataFilters,"selected",!0),selectedFilters=DataService.rebuildDataFromQuerystring(urlData,dataFilters,"selected",!0),defaultOrder=_.head(selectOptions.order);urlData.query&&(selectedFilters.query=[{id:urlData.query,title:urlData.query}]),filters=_.assign(filters,selectedPageFilters,selectedFilters),_.isEmpty(selectedFilters.order)&&(selectedFilters.order=[defaultOrder],filters.order=defaultOrder.id),_.isEmpty(urlData.random_score)?_.head(selectedFilters.order).generateRandom&&scope.handleRandom(!0):filters.random_score=urlData.random_score,ChannelEventManager.emit(UiEvents.INIT_STATE,{selected:selectedFilters,all:res.data,options:selectOptions,inputs:urlData},!1),scope.handleSearch(!1,!1,!0)}),listeners.push(ChannelEventManager.on(UiEvents.CHANGE_PAGINATION,function(data){PaginationService.setPage(filters,data.page),scope.handleSearch(!1)},!0)),listeners.push(ChannelEventManager.on(UiEvents.LOAD_MORE,function(data){PaginationService.nextPage(filters),scope.handleSearch(!0)},!0)),listeners.push(ChannelEventManager.on(UiEvents.CHANGE_FILTER,function(data){filters[data.id]=data.items,scope.handleSearch(!1,!0),ChannelEventManager.emit(UiEvents.CHANGE_TAG,{selected:filters},!1)},!0)),listeners.push(ChannelEventManager.on(UiEvents.EDIT_INLINE,function(data){filters[data.id]=data.value.length>2?data.value:"",scope.handleSearch(!1,!0)},!0)),listeners.push(ChannelEventManager.on(UiEvents.CHANGE_SELECT,function(data){filters.order=data.value.id,scope.handleRandom(data.value.generateRandom),scope.handleSearch(!1,!0)},!0)),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.career").directive("careerJobResult",["_","moment","UiEvents","ChannelManager","PaginationService","DataService","CareerJobsApiFactory","DomService","CareerTemplates","UrlService","EventManagerUtility","legacyTrackService","CareerService","AgentService","CareerEvents","careerStream","gaSearchTrackerService",function(_,moment,UiEvents,ChannelManager,PaginationService,DataService,CareerJobsApiFactory,DomService,CareerTemplates,UrlService,EventManagerUtility,legacyTrackService,CareerService,AgentService,CareerEvents,careerStream,gaSearchTrackerService){"use strict";function handleFirstSelectedFilters(filters,scope){if((_.isUndefined(scope.city)||!_.isNumber(scope.city)||1===filters.city_ids.length)&&filters.city_ids.length>0&&(scope.city=filters.city_ids[0].id),(_.isUndefined(scope.function)||!_.isNumber(scope.function)||1===filters.function_type_ids.length)&&filters.function_type_ids.length>0&&(scope.function=filters.function_type_ids[0].id),filters.city_ids.length>1){var cityNeedle="";filters.city_ids=_.filter(filters.city_ids,function(item){return item.id!=scope.city||(cityNeedle=item,!1)}),cityNeedle&&filters.city_ids.unshift(cityNeedle)}if(filters.function_type_ids.length>1){var functionNeedle="";filters.function_type_ids=_.filter(filters.function_type_ids,function(item){return item.id!=scope.function||(functionNeedle=item,!1)}),functionNeedle&&filters.function_type_ids.unshift(functionNeedle)}}function generateTitle(filters){return filters.function_type_ids.length>0&&filters.city_ids.length>0?filters.function_type_ids[0].title+" jobs in "+filters.city_ids[0].title:filters.function_type_ids.length>0?filters.function_type_ids[0].title+" jobs":filters.city_ids.length>0?"Jobs in "+filters.city_ids[0].title:filters.country_ids.length>0?"Jobs in "+filters.country_ids[0].title:"BoF Careers"}function trackSearch(searchTrackingData,source,channel,clearTrackingData){_.includes(["enterKey","blur","filters"],source)&&!_.isEmpty(searchTrackingData)&&(gaSearchTrackerService.track(channel,searchTrackingData.searchFilters,searchTrackingData.resultsCount),clearTrackingData())}return{restrict:"E",replace:!0,templateUrl:CareerTemplates.SEARCH_JOB_RESULTS,scope:{city:"@",country:"@",level:"@",function:"@",baseUri:"@",limit:"@",hideHeader:"@",routerDisabled:"@",latestJobs:"@",channel:"@"},link:function(scope,element,attrs){var ChannelEventManager=ChannelManager.subscribe(scope.channel),lock=!1,listeners=[],filters={offset:0,limit:parseInt(scope.limit,10)||12,query:"",order:null},omitFilters=["limit","offset","order"],selectOptions={order:[{id:"latest",label:"Latest",generateRandom:!1},{id:"relevance",label:"Relevance",generateRandom:!1},{id:"salary",label:"Salary",generateRandom:!1}]},routerDisabled="true"===scope.routerDisabled,CareerApi=new CareerJobsApiFactory,lastSelection=[],searchTrackingData={};scope.items=[],scope.count=0,scope.advertIndex=9,scope.hideHeaderBool="true"===scope.hideHeader,ChannelEventManager.on(UiEvents.INIT_STATE,function(data){data.rebuild},!0),scope.handleLink=function(event,url){event.preventDefault(),event.stopPropagation(),UrlService.changeUrl(url)},scope.handleFilters=function(filters){ChannelEventManager.emit(UiEvents.CHANGE_STATE,filters,!1)},scope.handleRandom=function(value){value?filters.random_score=moment().format("x"):delete filters.random_score},scope.handleSearch=function(loadMore,resetPagination,initial,source){if(!lock){lock=!0,resetPagination&&PaginationService.reset(filters);var searchFilters=DataService.sanitiseDataForQuerystring(filters,null,null,!0),newFilters=_.omit(searchFilters,omitFilters),categoryUrl=CareerService.getJobSearchCategoryUrl(filters,newFilters);handleFirstSelectedFilters(filters,scope);var title=generateTitle(filters);if(ChannelEventManager.emit(CareerEvents.TITLE_CHANGE,{title:title}),routerDisabled||(categoryUrl=CareerService.getJobSearchUrl(filters,newFilters),UrlService.setAbsolutePath("",title,categoryUrl,!0)),legacyTrackService.pageView(),initial&&scope.baseUri)return void UrlService.changePath(scope.baseUri);ChannelEventManager.emit(CareerEvents.CHANGE_ALERT,filters),scope.latestJobs&&(searchFilters.latest_jobs=!0),_.isEqual(lastSelection,searchFilters)?(lock=!1,trackSearch(searchTrackingData,source,scope.channel,function(){searchTrackingData={}})):(careerStream.JOB_SEARCH_IN_PROGRESS.onNext(!0),lastSelection=searchFilters,CareerApi.search(searchFilters).then(function(res){searchTrackingData={searchFilters:_.omit(searchFilters,["order","limit"]),resultsCount:res.data.total},trackSearch(searchTrackingData,source,scope.channel,function(){searchTrackingData={}}),loadMore?DataService.add(scope.items,DataService.addTrackBy(res.data.results,"job_id")):scope.items=DataService.addTrackBy(res.data.results,"job_id"),loadMore||initial||!AgentService.isMobilePhone()||DomService.scrollToElement(element,90,1e3),scope.count=res.data.total,scope.handleFilters(res.data.aggregations),careerStream.JOB_SEARCH_RESULT_COUNT_UPDATE.onNext(scope.count||0),careerStream.JOB_SEARCH_IN_PROGRESS.onNext(!1),ChannelEventManager.emit(UiEvents.UPDATE_PAGINATION,{total:res.data.total,page:PaginationService.getPage(filters),limit:filters.limit}),ChannelEventManager.emit(UiEvents.INJECT_STATE,res.data.aggregations),ChannelEventManager.emit(UiEvents.INJECT_SOCIAL_META,{url:categoryUrl}),lock=!1},function(res){lock=!1,PaginationService.reset(filters)}))}},CareerApi.getFilters().then(function(res){var dataFilters=_.assign(res.data,selectOptions),urlData=UrlService.parseQuery(),selectedPageFilters=DataService.rebuildDataFromQuerystring({city_ids:scope.city,country_ids:scope.country,function_type_ids:scope.function,level_type_ids:scope.level},dataFilters,"selected",!0),selectedFilters=DataService.rebuildDataFromQuerystring(urlData,dataFilters,"selected",!0),defaultOrder=_.head(selectOptions.order);urlData.query&&(selectedFilters.query=[{id:urlData.query,title:urlData.query}],defaultOrder=selectOptions.order[1]),filters=_.assign(filters,selectedPageFilters,selectedFilters),_.isEmpty(selectedFilters.order)&&(selectedFilters.order=[defaultOrder],filters.order=defaultOrder.id),_.isEmpty(urlData.random_score)?_.head(selectedFilters.order).generateRandom&&scope.handleRandom(!0):filters.random_score=urlData.random_score,ChannelEventManager.emit(UiEvents.INIT_STATE,{selected:selectedFilters,all:res.data,options:selectOptions,inputs:urlData},!1),scope.handleSearch(!1,!1,!0)}),listeners.push(ChannelEventManager.on(UiEvents.CHANGE_PAGINATION,function(data){PaginationService.setPage(filters,data.page),scope.handleSearch(!1)},!0)),listeners.push(ChannelEventManager.on(UiEvents.LOAD_MORE,function(data){PaginationService.nextPage(filters),scope.handleSearch(!0)},!0)),listeners.push(ChannelEventManager.on(UiEvents.CHANGE_FILTER,function(data){lock=!1,filters[data.id]=data.items,scope.handleSearch(!1,!0,null,"filters"),ChannelEventManager.emit(UiEvents.CHANGE_TAG,{selected:filters},!1)},!0)),listeners.push(ChannelEventManager.on(UiEvents.EDIT_INLINE,function(data){data.value.length>2?(filters[data.id]=data.value,filters.order=selectOptions.order[1].id):(filters[data.id]="",filters.order=selectOptions.order[0].id),scope.handleSearch(!1,!0,null,_.get(data,"source"))},!0)),listeners.push(ChannelEventManager.on(UiEvents.CHANGE_SELECT,function(data){filters.order=data.value.id,scope.handleRandom(data.value.generateRandom),scope.handleSearch(!1,!0)},!0)),listeners.push(ChannelEventManager.on(UiEvents.PREVENT_CLICK,function(data){scope.preventClick=data.prevent},!1)),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.career").component("jobAlertSubscribe",{templateUrl:"/assets-access-layer/js/site/Career/templates/job-alert-subscribe.html",bindings:{countryId:"@",cityId:"@",countryLabel:"@",functionId:"@",functionLabel:"@",levelId:"@",levelLabel:"@",channel:"@",buttonLocation:"@",template:"@"},controller:["_","$log","$q","$timeout","storageService","EventManager","CareerJobFiltersApiFactory","AuthEvents","authModalService","EventManagerUtility","QueryFilterApi","userConsentApi","DataService","ChannelManager","CareerEvents","UrlService","TrackerService","CAREERS_EVENT",function(_,$log,$q,$timeout,storageService,EventManager,CareerJobFiltersApiFactory,AuthEvents,authModalService,EventManagerUtility,QueryFilterApi,userConsentApi,DataService,ChannelManager,CareerEvents,UrlService,TrackerService,CAREERS_EVENT){function _matchObjects(){$log.debug("jobAlertSubscribe::_matchObjects::");var missingFilters={};ctrl.missingQueryFiltersFlat=[],null!==currentUserQueryFilters&&(_.isEmpty(currentUserQueryFilters)&&(ctrl.noUserQueryFilters=!0),_.forEach(ctrl.criteriaSelected,function(value,key){var difference=_.differenceBy(_.get(ctrl.criteriaSelected,key),_.get(currentUserQueryFilters,key),"filter_value");_.isEmpty(difference)||(missingFilters[key]=difference,_.forEach(difference,function(value){ctrl.missingQueryFiltersFlat.push({filter_type_key:key,filter_value:_.get(value,"filter_value")})}))}),ctrl.missingQueryFilters=missingFilters)}function _init(){$log.debug("jobAlertSubscribe::_init:: called");var queryFilterApiPromise=QueryFilterApi.get(),userConsentApiPromise=userConsentApi.getUserConsents();return $q.all([queryFilterApiPromise,userConsentApiPromise]).then(function(res){$log.debug("jobAlertSubscribe::_init:: response",res),_checkUserConsents(_.get(res,"[1].data")),currentUserQueryFilters=ctrl.isLoggedIn?_.get(res,"[0].data"):null,_matchObjects()})}function _checkUserConsents(currentUserConsents){var consentsValid=_.some(currentUserConsents,{consent_id:2010,is_enabled:!0});ctrl.userHasConsents=consentsValid}function _saveQueryFilters(){if($log.debug("jobAlertSubscribe::_saveQueryFilters::",ctrl.missingQueryFiltersFlat),ctrl.userHasConsents)TrackerService.track(CAREERS_EVENT.DOMAIN,"JobAlert",{Label:"JobAlertConfirmation."+ctrl.buttonLocation+"."+(ctrl.noUserQueryFilters?"Create":"Update")+"JobAlert"}),ctrl.noUserQueryFilters=!1,QueryFilterApi.post({filters:ctrl.missingQueryFiltersFlat}).then(function(){ctrl.queryFiltersSaved=!0,_init(),saveAfterLogin=!1});else{storeFilters();var url="/user/consent/job_alerts?location="+ctrl.buttonLocation;"large"===ctrl.template?UrlService.changeUrl(url):$timeout(function(){UrlService.openNewTab(url)},100)}}function _onUserChanged(user){if(ctrl.isLoggedIn=user.isLoggedIn(),$log.debug("jobAlertSubscribe::_onUserChanged:: ctrl.isLoggedIn[%s] saveAfterLogin[%s]",ctrl.isLoggedIn,saveAfterLogin),ctrl.isLoggedIn)return _init().then(function(){saveAfterLogin&&_saveQueryFilters()});currentUserQueryFilters={},_matchObjects(),ctrl.queryFiltersSaved=!1}function _onQueryFilterChanged(data){var sanitalizedData={};sanitalizedData.ids=DataService.sanitiseDataForQuerystring(data,"id","|"),sanitalizedData.labels=DataService.sanitiseDataForQuerystring(data,"title","|"),_.isEmpty(sanitalizedData.ids.country_ids)?delete ctrl.criteriaSelected.country:ctrl.criteriaSelected.country=DataService.zipData(sanitalizedData.ids.country_ids.split("|"),sanitalizedData.labels.country_ids.split("|"),defaultZipKeys),_.isEmpty(sanitalizedData.ids.city_ids)?delete ctrl.criteriaSelected.city:ctrl.criteriaSelected.city=DataService.zipData(sanitalizedData.ids.city_ids.split("|"),sanitalizedData.labels.city_ids.split("|"),defaultZipKeys),_.isEmpty(sanitalizedData.ids.function_type_ids)?delete ctrl.criteriaSelected.function:ctrl.criteriaSelected.function=DataService.zipData(sanitalizedData.ids.function_type_ids.split("|"),sanitalizedData.labels.function_type_ids.split("|"),defaultZipKeys),_.isEmpty(sanitalizedData.ids.level_type_ids)?delete ctrl.criteriaSelected.level:ctrl.criteriaSelected.level=DataService.zipData(sanitalizedData.ids.level_type_ids.split("|"),sanitalizedData.labels.level_type_ids.split("|"),defaultZipKeys),_matchObjects(),ctrl.queryFiltersSaved=!1}function storeFilters(){function mapToIdTitle(item){return{id:item.filter_value,title:item.value_label}}var filters={countries:_.map(ctrl.missingQueryFilters.country,mapToIdTitle),cities:_.map(ctrl.missingQueryFilters.city,mapToIdTitle),functions:_.map(ctrl.missingQueryFilters.function,mapToIdTitle),levels:_.map(ctrl.missingQueryFilters.level,mapToIdTitle)};storageService.set(storageService.KEY.JOB_ALERTS_FILTERS,filters)}var ctrl=this,currentUserQueryFilters=null,saveAfterLogin=!1,listeners=[],defaultZipKeys=["filter_value","value_label"],ChannelEventManager=ChannelManager.subscribe(ctrl.channel);ctrl.missingQueryFilters={},ctrl.missingQueryFiltersFlat=[],ctrl.noData=!1,ctrl.isLoggedIn=!1,ctrl.queryFiltersSaved=!1,ctrl.criteriaSelected={},ctrl.userHasConsents=!1,_.isEmpty(ctrl.countryId)||(ctrl.criteriaSelected.country=DataService.zipData(ctrl.countryId.split("|"),ctrl.countryLabel.split("|"),defaultZipKeys)),_.isEmpty(ctrl.cityId)||(ctrl.criteriaSelected.city=DataService.zipData(ctrl.cityId.split("|"),ctrl.cityLabel.split("|"),defaultZipKeys)),_.isEmpty(ctrl.functionId)||(ctrl.criteriaSelected.function=DataService.zipData(ctrl.functionId.split("|"),ctrl.functionLabel.split("|"),defaultZipKeys)),_.isEmpty(ctrl.levelId)||(ctrl.criteriaSelected.level=DataService.zipData(ctrl.levelId.split("|"),ctrl.levelLabel.split("|"),defaultZipKeys)),ctrl.isEmpty=function(value){return _.isEmpty(value)},ctrl.handleCreateJobAlert=function(){_saveQueryFilters()},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,_onUserChanged),ChannelEventManager.on(CareerEvents.CHANGE_ALERT,_onQueryFilterChanged,!0)),ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.career").factory("AccountApplicationApi",["$resource",function($resource){"use strict";return $resource("/xhr/accounts/:userId/applications/:applicationId",{userId:"@userId"},{getAll:{method:"GET"}})}]).factory("AccountApplicationApiFactory",["_","AccountApplicationApi","DataService","UserService",function(_,AccountApplicationApi,DataService,UserService){"use strict";function Factory(params){var apiParams=params;this.getParams=function(){return _.assign({userId:UserService.getCurrent().id},apiParams)},this.getAll=function(filters){return AccountApplicationApi.getAll(_.assign({attributes:"ids"},this.getParams(),DataService.convertFilterQueryObject(filters))).$promise},this.getOne=function(id){return this.get({applicationId:id})},this.update=function(id,data){return AccountApplicationApi.update(_.assign({},this.getParams()),data).$promise}}return Factory}]),angular.module("app.career").factory("CareerJobFiltersApi",["$resource",function($resource){"use strict";return $resource("/xhr/jobs/query_filters/:filterId",{filterId:"@filterId"},{update:{type:"PUT"}})}]).factory("CareerJobFiltersApiFactory",["_","CareerJobFiltersApi",function(_,CareerJobFiltersApi){"use strict";function Factory(params){var apiParams=params;this.get=function(filters){return CareerJobFiltersApi.get(_.assign({},apiParams)).$promise},this.save=function(data){var res=[];return _.forEach(data,function(collection,key){_.map(collection,function(item){res.push({filter_type_key:key,filter_value:item.id})})}),CareerJobFiltersApi.save(_.assign({},apiParams),{filters:res}).$promise}}return Factory}]),function(){"use strict";function CareerJobsApiFactory(_,$resource){function Factory(params){var CareerJobsApi=$resource("/xhr/jobs/:action",{action:"@action"},{search:{method:"GET",cancellable:!0},getFilters:{method:"GET",params:{action:"filters"}}}),apiParams=params,currentRequest=null;this.search=function(filters){if(currentRequest)try{currentRequest.$cancelRequest()}catch(e){}return currentRequest=CareerJobsApi.search(_.assign({},apiParams,filters)),currentRequest.$promise},this.getFilters=function(){return CareerJobsApi.getFilters(_.assign({},apiParams)).$promise}}return Factory}CareerJobsApiFactory.$inject=["_","$resource"],angular.module("app.career").factory("CareerJobsApiFactory",CareerJobsApiFactory)}(),function(){"use strict";function CareerApi($resource){return $resource("/xhr/careers/:categories",{categories:"@categories"},{getAll:{method:"GET"}})}CareerApi.$inject=["$resource"],angular.module("app.career").factory("CareerApi",CareerApi)}(),angular.module("app.career").factory("CareerOrganisationApi",["$resource",function($resource){"use strict";return $resource("/xhr/organisations/:action",{action:"@action"},{search:{method:"GET",cancellable:!0},getFilters:{method:"GET",params:{action:"filters"}}})}]).factory("CareerOrganisationApiFactory",["_","CareerOrganisationApi",function(_,CareerOrganisationApi){"use strict";function Factory(params){var currentRequest=null,apiParams=params;this.search=function(filters){if(currentRequest)try{currentRequest.$cancelRequest()}catch(e){}return currentRequest=CareerOrganisationApi.search(_.assign({},apiParams,filters)),currentRequest.$promise},this.getFilters=function(){return CareerOrganisationApi.getFilters(_.assign({},apiParams)).$promise}}return Factory}]),angular.module("app.career").service("CareerService",["_","DataService","CareerApi","ArrayService","UrlService","$window","$filter",function(_,DataService,CareerApi,ArrayService,UrlService,$window,$filter){function removeItem(array,itemKey,removeId){array[itemKey]=array[itemKey].split(/[\s,]+/).filter(function(item){return item!=removeId}).join(","),0===array[itemKey].length&&delete array[itemKey]}var self=this,pathFilter=$filter("path"),defaultFilters={limit:4,offset:0,attributes:"short",order:"rand"};self.getAll=function(filters,removePrefix){return filters=DataService.createFilters(defaultFilters,filters),CareerApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!1),self.replaceThumbnails(res.data),res})},self.getJobs=function(){var filters=DataService.createFilters(defaultFilters,{categories:"functions"});return CareerApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!1),res.data})},self.getCountries=function(){var filters=DataService.createFilters(defaultFilters,{categories:"countries"});return CareerApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!1),res.data})},self.getCountriesFunctionsGrouped=function(){var filters=DataService.createFilters(defaultFilters,{categories:"countries_grouped"});return CareerApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!0),ArrayService.replace(res.data,{show:!0}),res.data})},self.getFunctionsCountriesGrouped=function(){var filters=DataService.createFilters(defaultFilters,{categories:"functions_grouped"});return CareerApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!1),ArrayService.replace(res.data,{show:!0}),res.data})},self.filterCountries=function(item,countries){item?angular.forEach(countries,function(country){country.show=item.countries.hasOwnProperty(country.country_id)}):ArrayService.replace(countries,{show:!0})},self.filterFunctions=function(item,job_functions){item?angular.forEach(job_functions,function(job_function){job_function.show=item.functions.hasOwnProperty(job_function.function_id)}):ArrayService.replace(job_functions,{show:!0})},self.replaceThumbnails=function(items){angular.forEach(items,function(item){item.thumbnail&&_.has(item,"sliders[0].file")&&(item.thumbnail.file=item.sliders[0].file)})},self.getCompanySearchCategoryUrl=function(selectedFilters,queryFilters){if(1===selectedFilters.hq_country_ids.length^1===selectedFilters.organisation_type_ids.length){var url=1===selectedFilters.hq_country_ids.length?"/companies/country/"+_.head(selectedFilters.hq_country_ids).slug:"/companies/type/"+_.head(selectedFilters.organisation_type_ids).slug;return UrlService.getCurrentBaseUrl()+url}return UrlService.getCurrentBaseUrl()+"/companies/search"+UrlService.getQueryString(queryFilters)},self.getJobSearchCategoryUrl=function(selectedFilters,queryFilters){if(1===(_.get(selectedFilters.country_ids.length)||0)^1===(_.get(selectedFilters.country_ids.length)||0)^1===(_.get(selectedFilters.country_ids.length)||0)){var url="/careers/jobs/";return url=selectedFilters.country_ids.length?url+"country/"+_.head(selectedFilters.country_ids).slug:selectedFilters.function_type_ids.length?url+"function/"+_.head(selectedFilters.function_type_ids).slug:url+"level/"+_.head(selectedFilters.level_type_ids).slug,UrlService.getCurrentBaseUrl()+url}return UrlService.getCurrentBaseUrl()+"/careers/jobs/search"+UrlService.getQueryString(queryFilters)},self.getJobSearchUrl=function(selectedFilters,queryFilters){var url,baseUrl=UrlService.getCurrentBaseUrl(),searchUrl=baseUrl+$window.ALRouting["careers.job.search"],functionTypeFilter=_.get(selectedFilters,"function_type_ids",[]),cityFilter=_.get(selectedFilters,"city_ids",[]),countryFilter=_.get(selectedFilters,"country_ids",[]),urlQueryParams=UrlService.parseQuery();urlQueryParams=_.omit(urlQueryParams,["query"]);var otherParamsKeys=_.difference(_.keys(urlQueryParams),_.keys(queryFilters));return queryFilters=_.merge(queryFilters,_.pick(urlQueryParams,otherParamsKeys)),functionTypeFilter.length>0&&cityFilter.length>0?(url=baseUrl+pathFilter("careers.job.search_by_category",{function_type_slug:functionTypeFilter[0].slug,city_slug:cityFilter[0].slug}),removeItem(queryFilters,"function_type_ids",functionTypeFilter[0].id),removeItem(queryFilters,"city_ids",cityFilter[0].id),url+UrlService.getQueryString(queryFilters)):functionTypeFilter.length>0?(url=baseUrl+pathFilter("careers.job.search_by_function",{function_type_slug:functionTypeFilter[0].slug}),removeItem(queryFilters,"function_type_ids",functionTypeFilter[0].id),url+UrlService.getQueryString(queryFilters)):cityFilter.length>0?(url=baseUrl+pathFilter("careers.job.search_by_city",{city_slug:cityFilter[0].slug}),removeItem(queryFilters,"city_ids",cityFilter[0].id),url+UrlService.getQueryString(queryFilters)):countryFilter.length>0?(url=baseUrl+pathFilter("careers.job.search_by_country",{country_slug:countryFilter[0].slug}),removeItem(queryFilters,"country_ids",countryFilter[0].id),url+UrlService.getQueryString(queryFilters)):searchUrl+UrlService.getQueryString(queryFilters)}}]),function(){"use strict";function jobApi($http,Routes,$log){function bookmark(jobId,email){return $http({method:"POST",url:Routes.JOB.BOOKMARK,data:{jobId:jobId,email:email}})}return{bookmark:bookmark}}jobApi.$inject=["$http","Routes","$log"],angular.module("app.career").factory("jobApi",jobApi)}(),function(){"use strict";function BookmarkJobButtonController($log,authStream,jobApi,UiModalService,CareerTemplates){function $onInit(){$ctrl.show=!1,authListener=authStream.USER_CHANGED.subscribe(onUserChanged)}function $onDestroy(){authListener.dispose()}function onUserChanged(user){$ctrl.isUserLoggedIn=user.isLoggedIn()}function handleClick(){if($ctrl.isUserLoggedIn)return bookmarkJob($ctrl.jobId);openNonLoggedModal($ctrl.jobId)}function openNonLoggedModal(jobId){function BookmarkJobFormController($scope,FormServiceFactory,jobApi,modalParams){function canSubmit(){return FormService.canSubmit()}function close(){$modalInstance.dismiss()}function submit(){function onSubmitSuccess(res){$scope.done=!0}return $log.debug("bookmarkJobButton::openNonLoggedModal::BookmarkJobFormController::submit::",$scope.data.jobId,$scope.data.email),jobApi.bookmark($scope.data.jobId,$scope.data.email).then(onSubmitSuccess)}$log.debug("bookmarkJobButton::openNonLoggedModal::BookmarkJobFormController"),$scope.form={},$scope.data=modalParams||{},$scope.done=!1;var $modalInstance=modalParams.modalInstance(),FormService=new FormServiceFactory($scope.form);$scope.canSubmit=canSubmit,$scope.close=close,$scope.submit=submit}var scopeParams={jobId:$ctrl.jobId};UiModalService.openModal({template:CareerTemplates.BOOKMARK_JOB_FORM,controller:BookmarkJobFormController},scopeParams)}function bookmarkJob(jobId){function onBookmarkSuccess(res){UiModalService.openModal({template:CareerTemplates.MODAL_JOB_BOOKMARK_SUCCESSFUL,controller:"ModalGenericController"})}return jobApi.bookmark(jobId).then(onBookmarkSuccess)}var $ctrl=this,authListener=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleClick=handleClick}var bookmarkJobButtonComponent={templateUrl:"/assets-access-layer/js/site/Career/templates/bookmark-job-button.template.html",bindings:{jobId:"@"},controller:BookmarkJobButtonController};angular.module("app.career").component("bookmarkJobButton",bookmarkJobButtonComponent)}(),function(){"use strict";function CareerCompanyJoinController(_,authStream,careerStream,ChannelManager,CoreValidations,DataService,EventManagerUtility,FormServiceFactory,SharedDataApiFactory,ShareService,UiEvents,SalesforceService,$q,SharedDataApis,userProfileApi,$timeout,$http,MessageConstants){function $onInit(){$ctrl.form={},$ctrl.selects={},$ctrl.done=!1,$ctrl.user={},$ctrl.companySizeList=[],$ctrl.regex=CoreValidations,$ctrl.data={type_id:MessageConstants.MESSAGE_TYPE.CAREER_COMPANY_REQ.ID},$ctrl.loaded=!1,$ctrl.disabled={company:!1},$ctrl.channel_company="media_form_company",$ctrl.isFormValid=isFormValid,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,$ctrl.current_country="",FormService=new FormServiceFactory($ctrl.form),ChannelEventManager=ChannelManager.subscribe($ctrl.channel_company),typeaheadSuggestions={company:new SharedDataApiFactory({type:"profile-organisations",attributes:"titles"})},queryTypeaheadListener=ChannelEventManager.on(UiEvents.QUERY_TYPEAHEAD,onQueryTypeahead),formSubmittedListener=careerStream.EMPLOYER_JOIN_FORM_SUBMIT.subscribe(onFormSubmitted),userChangedListener=authStream.USER_CHANGED.subscribe(onUserChanged),SharedDataApis.COUNTRIES().then(onCountriesLoadedSuccess)}function onCountriesLoadedSuccess(res){var values=[];_.map(res.data,function(item){values[item.country_id]=item.country_name}),$ctrl.countries=values}function $onDestroy(){userChangedListener.dispose(),formSubmittedListener.dispose(),EventManagerUtility.removeListeners(queryTypeaheadListener)}function onUserChanged(data){function onProfileApiGetSuccess(response){_.assign($ctrl.data,{title:response.data.title,first_name:response.data.firstname,last_name:response.data.lastname,email:response.data.email,company:response.data.company,country_id:response.data.location_country_id}),$ctrl.data.company&&$ctrl.data.company.title&&($ctrl.disabled.company=!0),$timeout(setLoaded)}return $http.get("/xhr/careers/current_country").then(function(result){$ctrl.current_country=result.data.data.country_name}),$ctrl.loaded=!1,data.isLoggedIn()?(_.assign($ctrl.user,{id:data.id}),userProfileApi.get().then(onProfileApiGetSuccess)):void $timeout(setLoaded)}function setLoaded(){$ctrl.loaded=!0}function onFormSubmitted(){$ctrl.done=!0}function onQueryTypeahead(data){typeaheadSuggestions.hasOwnProperty(data.id)&&typeaheadSuggestions[data.id].get({query:data.query,limit:4}).then(function(res){_.map(res.data,function(item){!item.title&&item.label&&(item.title=item.label)}),ChannelEventManager.emit(UiEvents.INJECT_TYPEAHEAD,{id:data.id,results:res.data})})}function isFormValid(){return FormService.isValid()}function canSubmit(){return FormService.canSubmit()}function submit(){var newData=DataService.normaliseFormData($ctrl.data,["id","title"]),promise1=ShareService.submitMessage(newData),promise2=SalesforceService.submitMessage(transformSalesforceData(newData));return $q.all([promise1,promise2]).then(onSubmitSuccess)}function transformSalesforceData(newData){return{first_name:newData.first_name,last_name:newData.last_name,email:newData.email,phone:newData.phone_number,country:$ctrl.countries[newData.country_id]||$ctrl.current_country,company:newData.company_title,description:newData.message,lead_source:"Inbound","00N1r00000JwHB0":"/careers/about/company"}}function onSubmitSuccess(){careerStream.EMPLOYER_JOIN_FORM_SUBMIT.onNext()}var $ctrl=this,ChannelEventManager=null,userChangedListener=null,formSubmittedListener=null,queryTypeaheadListener=null,FormService=null,typeaheadSuggestions=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var careerCompanyJoinComponent={templateUrl:"/assets-access-layer/js/site/Career/templates/request-company-joincareer.template.html",bindings:{componentPosition:"@"},controller:CareerCompanyJoinController};angular.module("app.career").component("careerCompanyJoin",careerCompanyJoinComponent)}(),function(){"use strict";function CareerFilterWrapperController(_,InputUtil,UrlService){function $onInit(){var query=UrlService.parseQuery(),openAccordions=[];try{openAccordions=_.get(JSON.parse($ctrl.openAccordions),$ctrl.mobile?"mobile":"desktop")}catch(e){}$ctrl.accordionConfig={},openAccordions&&_.forEach(openAccordions,function(item){$ctrl.accordionConfig["open"+_.upperFirst(item.trim())]=!0}),_.includes(_.keys(query),"company_ids")&&($ctrl.onlySelected=!0)}function $onDestroy(){}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.onDestroy=$onDestroy,$ctrl.mobile=InputUtil.toBoolean($ctrl.mobile)||!1}var careerFilterWrapperComponent={templateUrl:function(InputUtil,$attrs){return"/assets-access-layer/js/site/Career/templates/"+(InputUtil.toBoolean($attrs.mobile)?"mobile/":"")+"filter-wrapper-"+($attrs.type?$attrs.type:"")+".html"},bindings:{channel:"@",openAccordions:"@",onlySelected:"@",mobile:"@"},controller:CareerFilterWrapperController};angular.module("app.career").component("careerFilterWrapper",careerFilterWrapperComponent)}(),function(){"use strict";function CareerSearchController(_,$window,CareerService,TrackerService){function $onInit(){$ctrl.job_function=null,$ctrl.functions=[],$ctrl.countries=[],$ctrl.goToSearch=goToSearch,$ctrl.onFunctionChange=onFunctionChange,$ctrl.onCountryChange=onCountryChange,CareerService.getCountriesFunctionsGrouped().then(function(countries){$ctrl.countries=countries;var defaultCountry=_.find(countries,function(country){return country.country_id==$ctrl.userCountryId});defaultCountry?(preselectedCountry=!0,$ctrl.country=defaultCountry,track("SelectBox.MatchCountry","preselect")):track("SelectBox.NoMatchCountry","preselect")}),CareerService.getFunctionsCountriesGrouped().then(function(functions){$ctrl.functions=functions})}function $onDestroy(){}function goToSearch(){var urlQuery=["scrolldown=1"];$ctrl.job_function&&urlQuery.push("roles="+$ctrl.job_function.function_id),$ctrl.country&&urlQuery.push("countries="+$ctrl.country.country_id);var searchType;searchType=preselectedCountry&&!userCountryChange?"PreselectedCountry":preselectedCountry&&userCountryChange?"UserChangedCountry":userCountryChange?"UserSelectedCountry":"NoCountry",track("CTAButton.Search."+searchType,"click"),$window.location.href="/careers/search"+(urlQuery.length>0?"?"+urlQuery.join("&"):"")}function onFunctionChange(){filterCountries()}function onCountryChange(){preselectedCountry?track("SelectBox.UserCountryChange","select"):track("SelectBox.UserSelection","select"),userCountryChange=!0,filterFunctions()}function filterCountries(){CareerService.filterCountries($ctrl.job_function,$ctrl.countries)}function filterFunctions(){CareerService.filterFunctions($ctrl.country,$ctrl.functions)}function track(trackerLabel,trackerAction){$ctrl.trackerManual&&TrackerService.track($ctrl.trackerManual,$ctrl.trackerCat,{Label:$ctrl.trackerLabel+"."+trackerLabel,Action:trackerAction},"manual")}var $ctrl=this,preselectedCountry=!1,userCountryChange=!1;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var careerSearch={templateUrl:function($element,$attrs){return"plain"==$attrs.type?"/assets-access-layer/js/site/Career/templates/career-search-plain.html":"/assets-access-layer/js/site/Career/templates/career-search.html"},bindings:{title:"@",buttonLabel:"@",url:"@",userCountryId:"@",trackerManual:"@",trackerLabel:"@",trackerCat:"@"},controller:CareerSearchController};angular.module("app.career").component("careerSearch",careerSearch)}(),function(){"use strict";function FilterListController(_,ChannelManager,careerStream,UiEvents,DataService,EventManagerUtility,InputUtil){function $onInit(){$ctrl.filtered=null,$ctrl.selectedItemsCount=0,$ctrl.isOpenBool=InputUtil.toBoolean($ctrl.isOpen),$ctrl.canBeExpanded=canBeExpanded,$ctrl.canBeCollapsed=canBeCollapsed,$ctrl.collapse=collapse,$ctrl.expand=expand,ChannelEventManager=ChannelManager.subscribe($ctrl.channel),SubChannelEventManager=ChannelManager.subscribe($ctrl.subchannel),listeners.push(SubChannelEventManager.on(UiEvents.CHANGE_CHECKBOX,onChangeCheckBox,!0)),$ctrl.mobile&&(listeners.push(ChannelEventManager.on(UiEvents.APPLY_FILTERS,onApplyAllFilters,!0)),listeners.push(ChannelEventManager.on(UiEvents.CLEAR_FILTERS,onClearAllFilters,!0))),$ctrl.mobile||listeners.push(ChannelEventManager.on(UiEvents.REMOVE_TAG,onRemoveTag,!0)),listeners.push(ChannelEventManager.on(UiEvents.INIT_STATE,onInitState,!1)),listeners.push(ChannelEventManager.on(UiEvents.INJECT_STATE,onInjectState,!1))}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function onApplyAllFilters(){emitChange()}function onClearAllFilters(){SubChannelEventManager.emit(UiEvents.INJECT_CHECKBOX,{id:"ALL",value:!1,forceEnable:!0})}function onChangeCheckBox(data){careerStream.JOB_SEARCH_FILTERS_UPDATE.onNext({category:$ctrl.id,data:data});var selectedItem=_.find(items,["id",parseInt(data.id,10)]);selectedItem&&(selectedItem.selected=data.value),$ctrl.selectedItemsCount=_.filter(items,["selected",!0]).length,emitChange(data.value)}function onRemoveTag(res){if($ctrl.id==res.group){res.data.selected=!1;var selectedItem=_.find(items,["id",parseInt(res.data.id,10)]);selectedItem&&(selectedItem.selected=res.data.selected),DataService.addTrackBy(res.data,trackByKey),DataService.replace(items,res.data,trackByKey),$ctrl.selectedItemsCount=_.filter(items,["selected",!0]).length,careerStream.JOB_SEARCH_FILTERS_UPDATE.onNext({category:$ctrl.id,data:res.data}),emitChange()}}function onInitState(data){items=_.map(data.all[$ctrl.id],function(filter){var selected=_.find(data.selected[$ctrl.id],["id",filter.id]);return selected&&(filter.selected=selected.selected),filter}),$ctrl.selectedItemsCount=_.filter(items,["selected",!0]).length,_.isEmpty(_.get(data.selected,$ctrl.id))||($ctrl.isOpenBool=!0)}function onInjectState(data){var clonedData=_.cloneDeep(items);DataService.mergeAggregations(clonedData,data[$ctrl.id]),DataService.addTrackBy(clonedData,trackByKey),DataService.replace(items,clonedData,trackByKey),setJobFilters()}function setJobFilters(){atLeastOneFilterSelected()||(showOnlySelected=!1),available=_.filter(items,isAvailableJobFilter),$ctrl.filtered=_.take(_.orderBy(_.filter(available,showJobFilter),$ctrl.orderByKey),showLimit)}function atLeastOneFilterSelected(){return $ctrl.selectedItemsCount>0}function canBeExpanded(){return!$ctrl.filtered||$ctrl.filtered.length<available.length}function canBeCollapsed(){return!!$ctrl.filtered&&($ctrl.filtered.length>limit||atLeastOneFilterSelected()&&$ctrl.selectedItemsCount<$ctrl.filtered.length)}function isAvailableJobFilter(item){return!0===item.enabled||!0===item.selected}function showJobFilter(item){return!(showOnlySelected&&!item.selected)}function collapse(){showOnlySelected=!!atLeastOneFilterSelected(),showLimit=limit,setJobFilters()}function expand(){showOnlySelected=!1,showLimit=available.length,setJobFilters()}function emitChange(isSelected){isSelected&&($ctrl.userAddedFilter=!0),ChannelEventManager.emit(UiEvents.CHANGE_FILTER,{id:$ctrl.id,items:_.filter(items,["selected",!0])})}var $ctrl=this,ChannelEventManager=null,SubChannelEventManager=null,listeners=[],trackByKey="id",showLimit=10,limit=10,items=null,available=null,showOnlySelected=!0;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var filterListComponent={templateUrl:"/assets-access-layer/js/site/Career/templates/filter-list.template.html",bindings:{channel:"@",subchannel:"@",id:"@",orderBy:"@",onlySelected:"@",groupName:"@",isOpen:"@",mobile:"<"},controller:FilterListController};angular.module("app.career").component("filterList",filterListComponent)}(),function(){"use strict";function JobApplicationStatusBarController(_,authStream,careerStream,jobApplicationApi,CareerPaths,JobApplicationStatus,UrlService){function $onInit(){authListener=authStream.USER_CHANGED.subscribe(onUserChanged),jobApplicationListener=careerStream.JOB_APPLICATION_STATUS_UPDATE.subscribe(onJobApplicationUpdated)}function $onDestroy(){authStream.unsubscribe(authListener),careerStream.unsubscribe(jobApplicationListener)}function goToMyApplications(){return UrlService.changeUrl(spaJobApplicationsURL)}function onUserChanged(user){if(isUserLoggedIn=user.isLoggedIn(),userId=user.id,!isUserLoggedIn)return void($ctrl.show=!1);checkAlreadyApplied()}function onJobApplicationUpdated(status){jobApplicationStatus=_.parseInt(status.jobApplicationStatus),refreshBar()}function checkAlreadyApplied(){function onJobApplicationLoadedSuccess(res){var jobApplication=_.find(res.results,{job_id:$ctrl.jobId});jobApplication&&(jobApplicationStatus=_.parseInt(jobApplication.status_type_id))}return jobApplicationApi.getAll(userId,{job_ids:$ctrl.jobId,attributes:"short"}).then(onJobApplicationLoadedSuccess).finally(refreshBar)}function refreshBar(){return jobApplicationStatus===JobApplicationStatus.HIRED||jobApplicationStatus===JobApplicationStatus.APPLIED?($ctrl.show=!0,void($ctrl.jobApplicationStatus="applied")):jobApplicationStatus===JobApplicationStatus.SAVED?($ctrl.show=!0,void($ctrl.jobApplicationStatus="saved")):jobApplicationStatus===JobApplicationStatus.ARCHIVED?($ctrl.show=!1,void($ctrl.jobApplicationStatus="archived")):void 0}var $ctrl=this,authListener=null,jobApplicationListener=null,isUserLoggedIn=!1,userId=null,jobApplicationStatus=null,spaJobApplicationsURL=CareerPaths.SPA_JOB_APPLICATIONS;$ctrl.show=!1,$ctrl.jobApplicationStatus=null,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.goToMyApplications=goToMyApplications}var jobApplicationStatusBarComponent={templateUrl:"/assets-access-layer/js/site/Career/templates/job-application-status-bar.template.html",bindings:{jobId:"@"},controller:JobApplicationStatusBarController};angular.module("app.career").component("jobApplicationStatusBar",jobApplicationStatusBarComponent)}(),function(){"use strict";function JobApplyButtonController(_,$log,$http,$timeout,authModalService,authStream,careerStream,InputUtil,jobApplicationApi,CareerPaths,CareerTemplates,JobApplicationConfig,JobApplicationStatus,JobApplicationType,legacyTrackService,UiModalService,UrlService){function $onInit(){$ctrl.jobId=InputUtil.toInt($ctrl.jobId),$ctrl.buttonStatus=!1,$ctrl.buttonDisabled=!0,$ctrl.isExternal=InputUtil.toBoolean($ctrl.isExternal),$ctrl.checkRightToWork=InputUtil.toBoolean($ctrl.checkRightToWork),$ctrl.isEu=InputUtil.toBoolean($ctrl.isEu),authListener=authStream.USER_CHANGED.subscribe(onUserChanged)}function $onDestroy(){authStream.unsubscribe(authListener)}function onUserChanged(user){isUserLoggedIn=user.isLoggedIn(),userId=user.id,checkAlreadyApplied()}function checkAlreadyApplied(){function onJobApplicationLoadedSuccess(res){var jobApplication=_.find(res.results,{job_id:$ctrl.jobId});jobApplication&&(_.includes([JobApplicationStatus.HIRED,JobApplicationStatus.APPLIED,JobApplicationStatus.ARCHIVED],_.parseInt(jobApplication.status_type_id))?hasUserAppliedForCurrentJob=!0:_.parseInt(jobApplication.status_type_id)==JobApplicationStatus.ARCHIVED&&(jobApplicationIsArchived=!0))}return userId?jobApplicationApi.getAll(userId,{job_ids:$ctrl.jobId,attributes:"short"}).then(onJobApplicationLoadedSuccess).finally(refreshButtonStatus):(hasUserAppliedForCurrentJob=!1,refreshButtonStatus())}function refreshButtonStatus(){return"0"===$ctrl.isCompanyCareersProductActive||"1"===$ctrl.companyIsArchived||"0"===$ctrl.companyIsEnabled||"0"===$ctrl.companyIsPublished?($ctrl.buttonDisabled=!0,void($ctrl.buttonStatus="expired")):"archived"===$ctrl.status?($ctrl.buttonDisabled=!0,void($ctrl.buttonStatus="archived")):"pending"===$ctrl.status?($ctrl.buttonDisabled=!0,void($ctrl.buttonStatus="pending")):"expired"===$ctrl.status?($ctrl.buttonDisabled=!0,void($ctrl.buttonStatus="expired")):$ctrl.isExternal?($ctrl.buttonDisabled=!1,void($ctrl.buttonStatus="external")):hasUserAppliedForCurrentJob?($ctrl.buttonDisabled=!1,void($ctrl.buttonStatus="alreadyApplied")):void("published"===$ctrl.status&&($ctrl.buttonDisabled=!1,$ctrl.buttonStatus="published"))}function handleClick(){trackJobClick(),"alreadyApplied"===$ctrl.buttonStatus?UrlService.changeUrl(CareerPaths.SPA_JOB_APPLICATIONS):"published"===$ctrl.buttonStatus?isUserLoggedIn?openInternalJobModal():openLoginModal().then(openInternalJobModal):"external"===$ctrl.buttonStatus&&(isUserLoggedIn?handleApplyExternalJob():openLoginModal())}function trackJobClick(){if(_.isString($ctrl.trackingUrl)&&!_.isEmpty($ctrl.trackingUrl))return $http({method:"GET",url:$ctrl.trackingUrl})}function openLoginModal(){return authModalService.openLogin("default",{status:"default",firewall:!0,source:"careersApply"})}function handleApplyExternalJob(){function showConfirmationModal(res){opened&&!_.includes([JobApplicationStatus.APPLIED,JobApplicationStatus.HIRED],res.data.status_type_id)&&$timeout(openExternalApplicationConfirmationModal.bind(null,res.data.job_application_id),JobApplicationConfig.EXTERNAL_CONFIRMATION_MODAL_DELAY)}var opened=UrlService.openNewTab($ctrl.url);jobApplicationApi.recordOpenExternal(userId,JobApplicationType.EXTERNAL,InputUtil.toInt($ctrl.jobId)).then(showConfirmationModal)}function openExternalApplicationConfirmationModal(jobApplicationId){UiModalService.openModal({controller:"ExternalApplicationConfirmationModalController",template:"/assets-access-layer/js/shared/Job/templates/external-application-confirmation-modal.template.html",backdrop:"static",keyboard:!1},{jobId:$ctrl.jobId,jobTitle:$ctrl.jobTitle}).then(storeExternalApplicationConfirmationResult.bind(null,jobApplicationId))}function storeExternalApplicationConfirmationResult(jobApplicationId,jobApplicationStatus){jobApplicationApi.storeJobApplicationStatus(userId,jobApplicationId,jobApplicationStatus),jobApplicationStatus===JobApplicationStatus.NOT_APPLIED&&jobApplicationApi.archive(userId,jobApplicationId);var eventPayload={jobId:$ctrl.jobId,jobApplicationStatus:jobApplicationStatus};$log.debug("jobApplyButtonComponent::storeExternalApplicationConfirmationResult::emit",eventPayload),careerStream.JOB_APPLICATION_STATUS_UPDATE.emit(eventPayload)}function openInternalJobModal(){$ctrl.checkRightToWork&&!modalInstance?UiModalService.openModal({controller:"ModalGenericController",template:CareerTemplates.MODAL_RIGHT_TO_WORK,backdrop:"static",keyboard:!1},{jobId:$ctrl.jobId,isEu:$ctrl.isEu,country:$ctrl.country}).then(goToInternalApplication):goToInternalApplication()}function goToInternalApplication(){UrlService.changeUrl($ctrl.url)}var $ctrl=this,authListener=null,hasUserAppliedForCurrentJob=null,jobApplicationIsArchived=!1,modalInstance=null,isUserLoggedIn=!1,userId=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleClick=handleClick}var jobApplyButtonComponent={templateUrl:"/assets-access-layer/js/site/Career/templates/job-apply-button.template.html",bindings:{jobId:"@",url:"@",isExternal:"@",classExtButton:"@",trackingUrl:"@",status:"@",isCompanyCareersProductActive:"@",checkRightToWork:"@",isEu:"@",country:"@",jobTitle:"@",companyIsEnabled:"@",companyIsArchived:"@",companyIsPublished:"@"},controller:JobApplyButtonController};angular.module("app.career").component("jobApplyButton",jobApplyButtonComponent)}(),function(){"use strict";function JobCardWideController(moment){function $onInit(){}function $onDestroy(){}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var jobCardWideComponent={templateUrl:"/assets-access-layer/js/site/Career/templates/job-card-wide.html",bindings:{job:"<"},controller:JobCardWideController};angular.module("app.career").component("jobCardWide",jobCardWideComponent)}(),function(){"use strict";function MobileSearchFiltersController(_,$scope,$window,careerStream,AgentService,ChannelManager,DomService,EventManagerUtility,UiEvents,uiStream){function $onInit(){ChannelEventManager=ChannelManager.subscribe($ctrl.channel),jobFiltersInitListener=ChannelEventManager.on(UiEvents.INIT_STATE,onInitFilters),searchBarFocusListener=ChannelEventManager.on(UiEvents.ELEMENT_FOCUS,onInputFocusChange),jobResultsCountListener=careerStream.JOB_SEARCH_RESULT_COUNT_UPDATE.subscribe(onSearchResultsUpdate),jobFiltersListener=careerStream.JOB_SEARCH_FILTERS_UPDATE.subscribe(onSearchFiltersUpdate),jobSearchInProgressListener=careerStream.JOB_SEARCH_IN_PROGRESS.subscribe(onSearchInProgress)}function $postLink(){AgentService.isMobile()&&DomService.requestAnimationFrame(refresh)}function $onDestroy(){EventManagerUtility.removeListeners([jobFiltersInitListener,searchBarFocusListener]),jobResultsCountListener.dispose(),jobFiltersListener.dispose(),jobSearchInProgressListener.dispose()}function refresh(){if($window.scrollY>FIXED_BREAKPOINT_PX/6){var opacity=1-$window.scrollY/(FIXED_BREAKPOINT_PX/2);document.querySelectorAll(".sticky-container")[0].style.opacity=opacity,document.querySelectorAll(".text-header-big")[1].style.opacity=opacity}else document.querySelectorAll(".sticky-container")[0].style.opacity=1,document.querySelectorAll(".text-header-big")[1].style.opacity=1;$ctrl.isSticky&&$window.scrollY<FIXED_BREAKPOINT_PX?($ctrl.isSticky=!1,$ctrl.filtersBarOpen=!1,unlockScrolling(),focusResults(),allowClicks(),$scope.$apply()):!$ctrl.isSticky&&$window.scrollY>=FIXED_BREAKPOINT_PX&&($ctrl.isSticky=!0,$scope.$apply()),DomService.requestAnimationFrame(refresh)}function toggleFiltersBar(){$ctrl.filtersBarOpen=!$ctrl.filtersBarOpen,$ctrl.jobFiltersCount=countSelectedFilters(filters),$window.pageYOffset<FIXED_BREAKPOINT_PX&&$window.scrollTo(0,FIXED_BREAKPOINT_PX),$ctrl.filtersBarOpen?(blurResults(),preventClicks()):(focusResults(),allowClicks(),$ctrl.newFilters&&ChannelEventManager.emit(UiEvents.APPLY_FILTERS,{})),$ctrl.newFilters=!1}function closeFiltersBar(){$ctrl.filtersBarOpen=!1}function onInitFilters(data){filters=_.cloneDeep(data.selected),$ctrl.jobFiltersCount=countSelectedFilters(filters),$ctrl.filtersInitialized=!0}function onInputFocusChange(data){data.focused?(closeFiltersBar(),lockScrolling(),blurResults(),preventClicks()):(unlockScrolling(),focusResults(),allowClicks())}function onSearchResultsUpdate(count){$ctrl.jobResultsCount=count}function onSearchFiltersUpdate(changedFilter){changeFilter(filters[changedFilter.category],changedFilter.data),$ctrl.jobFiltersCount=countSelectedFilters(filters)}function onSearchInProgress(inProgress){$ctrl.filtersInitialized&&($ctrl.searchInProgress=inProgress)}function changeFilter(filtersArray,filter){1==filter.value?filtersArray.push(filter):filtersArray.splice(_.findIndex(filtersArray,{id:filter.id}),1)}function countSelectedFilters(selectedFilters){var sum=0;for(var category in selectedFilters)"order"!==category&&"query"!==category&&(sum+=selectedFilters[category].length);return sum}function clearAllFilters(){ChannelEventManager.emit(UiEvents.CLEAR_FILTERS,{})}function lockScrolling(){document.ontouchmove=function(e){e.preventDefault()}}function unlockScrolling(){document.ontouchmove=function(e){return!0}}function blurResults(){uiStream.BLUR_COMPONENT.onNext(!0)}function focusResults(){uiStream.BLUR_COMPONENT.onNext(!1)}function preventClicks(){ChannelEventManager.emit(UiEvents.PREVENT_CLICK,{prevent:!0})}function allowClicks(){ChannelEventManager.emit(UiEvents.PREVENT_CLICK,{prevent:!1})}var $ctrl=this,FIXED_BREAKPOINT_PX=120,filters=null;$ctrl.$onInit=$onInit,$ctrl.$postLink=$postLink,$ctrl.$onDestroy=$onDestroy,$ctrl.toggleFiltersBar=toggleFiltersBar,$ctrl.clearAllFilters=clearAllFilters,$ctrl.filtersBarOpen=!1,$ctrl.newFilters=!1,$ctrl.filtersInitialized=!1,$ctrl.isSticky=!1,$ctrl.jobResultsCount=null,$ctrl.jobFiltersCount=null,$ctrl.userSelectedFiltersCount=0,$ctrl.allowClickOnJob=!0,$ctrl.searchInProgress=!1;var ChannelEventManager=null,jobFiltersListener=null,jobResultsCountListener=null,jobFiltersInitListener=null,searchBarFocusListener=null,jobSearchInProgressListener=null}var mobileSearchFiltersComponent={templateUrl:"/assets-access-layer/js/site/Career/templates/mobile-search-filters.html",bindings:{channel:"@"},transclude:{search:"uiEditInlineComponent",filters:"careerFilterWrapper"},controller:MobileSearchFiltersController};angular.module("app.career").component("mobileSearchFilters",mobileSearchFiltersComponent)}(),function(){"use strict";function TargetedJobsWidgetController(_,UserService){function $onInit(){var user=UserService.getCurrentUser();getParams={width:$ctrl.widgetWidth,height:$ctrl.widgetHeight,limit:$ctrl.fetchJobs,tracking_label:$ctrl.trackingLabel,city_id:user.city_id,country_id:user.country_id,level_id:user.job_level_id,responsibility_id:user.job_responsibility_id},getParams=_.pickBy(getParams,function(value){return!!value}),paramsUrl=_.join(_.map(getParams,function(value,key){return!!value&&key+"="+value}),"&"),$ctrl.widgetUrl="/careers/widget/targeted_jobs?"+paramsUrl}function $onDestroy(){}var $ctrl=this,getParams={},paramsUrl="";$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var targetedJobsWidget={templateUrl:"/assets-access-layer/js/site/Career/templates/targeted-jobs-widget.template.html",bindings:{widgetHeight:"<",widgetWidth:"<",fetchJobs:"<",cityId:"<",countryId:"<",trackingLabel:"@"},controller:TargetedJobsWidgetController};angular.module("app.career").component("targetedJobsWidget",targetedJobsWidget)}(),function(){"use strict";function careerSearchTitleChange(ChannelManager,CareerEvents,EventManagerUtility){function postLink(scope,element){function _onCareerSearchTitleChange(data){"BoF Careers"===data.title?element.html('<span class="chronicle-display-bold">BoF</span> <span class="color-brand-careers-alternate chronicle-display-bold-italic">Careers</span>'):element.html(data.title)}function onDestroy(){EventManagerUtility.removeListeners(listeners)}var listeners=[],ChannelEventManager=ChannelManager.subscribe(scope.channel);scope.$on("$destroy",onDestroy),listeners.push(ChannelEventManager.on(CareerEvents.TITLE_CHANGE,_onCareerSearchTitleChange,!0))}return{restrict:"A",scope:{channel:"@"},link:postLink}}careerSearchTitleChange.$inject=["ChannelManager","CareerEvents","EventManagerUtility"],angular.module("app.career").directive("careerSearchTitleChange",careerSearchTitleChange)}(),function(){"use strict";function careerStream(EventManagerUtility,LazyStream,Stream){var JOB_APPLICATION_STATUS_UPDATE=new LazyStream,EMPLOYER_JOIN_FORM_SUBMIT=new Stream,JOB_SEARCH_RESULT_COUNT_UPDATE=new LazyStream,JOB_SEARCH_FILTER_COUNT_UPDATE=new LazyStream,JOB_SEARCH_FILTERS_UPDATE=new LazyStream;return{JOB_APPLICATION_STATUS_UPDATE:JOB_APPLICATION_STATUS_UPDATE,EMPLOYER_JOIN_FORM_SUBMIT:EMPLOYER_JOIN_FORM_SUBMIT,JOB_SEARCH_IN_PROGRESS:new Stream,JOB_SEARCH_FILTERS_UPDATE:JOB_SEARCH_FILTERS_UPDATE,JOB_SEARCH_RESULT_COUNT_UPDATE:JOB_SEARCH_RESULT_COUNT_UPDATE,JOB_SEARCH_FILTER_COUNT_UPDATE:JOB_SEARCH_FILTER_COUNT_UPDATE,unsubscribe:EventManagerUtility.removeListeners}}careerStream.$inject=["EventManagerUtility","LazyStream","Stream"],angular.module("app.career").factory("careerStream",careerStream)}(),angular.module("app.profile").constant("ProfileConfig",{GLOBAL_CHANNEL:"ProfileChannel",RENDER_COMPONENT:"RenderResultComponent",FILTER_COMPONENT:"FilterComponent",INPUT_COMPONENT:"InputComponent",TAG_COMPONENT:"TagComponent",LOAD_MORE:"LoadMore",SELECT_COMPONENT:"SelectComponent",SHUFFLE_BUTTON:"ShuffleButton"}),angular.module("app.profile").constant("ProfileCaches",{SHUFFLE_CACHE:"ShuffleCache",SHUFFLE_DATA_KEY:"data",PROFILE_CACHE:"ProfileCache",COMPANY_PROFILE_CACHE:"CompanyProfileCache",MOSAIC_CACHE:"MosaicCache",PROFILE_CACHE_VOLATILE:"ProfileVolatileCache"}),angular.module("app.profile").constant("ProfileEvents",{SEARCH_RESULT:"profileSearchChanged",FROM_FILTER:"profileSearchDataFromFilterChanged",INIT_FILTER:"profileSearchDataInitFilterChanged",TO_FILTER:"profileSearchDataToFilterChanged",REMOVE_FILTER:"profileSearchDataFilterRemoved",SWITCH_FILTER:"profileSearchDataFilterSWitch",RENDER_RESULTS:"profileSearchRenderResults",ON_LOAD_MORE:"profileSearchLoadMore",SHUFFLE_INIT:"profileShuffleInit",FROM_SHUFFLE_BUTTON:"profileShuffleButtonClick",CHANGE_TAG:"profileChangeTag"}).constant("MosaicEvents",{DATA_CHANGED:"mosaicDataChanged"}),angular.module("app.profile").component("followButton",{template:'<button class="btn btn-default sans-serif padded-horizontal-xs-3" style="background-color: {[{$ctrl.backgroundColor}]}" ng-click="$ctrl.toggle($event)"><span style="color: {[{$ctrl.labelColor}]}">{[{$ctrl.label}]}</span></button>',bindings:{activeText:"@",inactiveText:"@",backgroundColor:"@",labelColor:"@",id:"@"},controller:["EventManager","ArrayService","SubscriptionService","authModalService","SubscriptionEvents","AuthEvents","EventManagerUtility","InputUtil",function(EventManager,ArrayService,SubscriptionService,authModalService,SubscriptionEvents,AuthEvents,EventManagerUtility,InputUtil){var $ctrl=this,user={},listeners=[],status=!1,currentId=InputUtil.toInt($ctrl.id),labels={active:$ctrl.activeText||"Unfollow",inactive:$ctrl.inactiveText||"Follow"};$ctrl.label=labels.inactive,$ctrl.toggle=function(e){e&&e.stopPropagation(),user.id?(status=!status,SubscriptionService.update(currentId,status).then(function(data){}),$ctrl.changeLabel()):(authModalService.setSubscribeSource("Follow"),authModalService.openLogin(status,{status:"default",firewall:!0}).then(function(){$ctrl.toggle()}))},$ctrl.changeLabel=function(){$ctrl.label=status?labels.active:labels.inactive},listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(data){user=data})),listeners.push(EventManager.on(SubscriptionEvents.SUBSCRIPTION_CHANGED,function(data){status=ArrayService.inArray(data,currentId),$ctrl.changeLabel()})),$ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").directive("liveMosaic",["EventManager","MosaicService","AgentService","PaginationService","$timeout","MosaicEvents",function(EventManager,MosaicService,AgentService,PaginationService,$timeout,MosaicEvents){"use strict";return{template:'<div class="s_livemosaic"><carousel interval="defaultInterval"><slide ng-repeat="slideItem in slideList"><div class="row-sm"><div ng-repeat="slideData in slideItem" class="col-sm-12"><live-mosaic-template template-number="{[{ slideData.template }]}" items="slideData.items" class="text-left"></live-mosaic-template></div></div></slide></carousel></div>',restrict:"E",replace:!0,scope:{id:"@",type:"@"},link:function(scope,element,attrs){var combinations=[4,7,10],filters={offset:0,limit:1},init=!1,currentLoading=0,imageService="collection"===scope.type?MosaicService.getCollectionImages:MosaicService.getProfileImages;scope.isMobile=AgentService.isMobilePhone(),scope.slideList=[],scope.defaultInterval=1e4,scope.loadMore=function(){var templateListIndexes=MosaicService.randomiseTemplates(combinations,AgentService.isMobilePhone()),templateListItemNumber=MosaicService.remap(combinations,templateListIndexes);filters.limit=MosaicService.getTotalItems(templateListItemNumber),imageService(scope.id,filters).then(function(res){res.data.length?(scope.slideList.push(MosaicService.splitData(templateListItemNumber,res.data)),currentLoading+=1,1===currentLoading?scope.loadMore():currentLoading<10&&$timeout(function(){scope.loadMore()},5e3),scope.handleDataLoad(!0)):scope.handleDataLoad(!1)}),PaginationService.nextPage(filters)},scope.handleDataLoad=function(status){init||(init=!0,EventManager.emit(MosaicEvents.DATA_CHANGED,{status:status}))},scope.loadMore()}}}]).directive("liveMosaicTemplate",["$templateRequest","$compile",function($templateRequest,$compile){"use strict";return{restrict:"E",replace:!0,scope:{items:"="},link:function(scope,element,attrs){if(attrs.templateNumber>0){var templateLocation="/templates/Bof500/mosaic_template_"+attrs.templateNumber;$templateRequest(templateLocation).then(function(html){var template=angular.element(html);element.append(template),$compile(template)(scope)})}}}}]).directive("liveMosaicTile",["EventManager",function(EventManager){"use strict";return{templateUrl:"/templates/Bof500/mosaic_tile",restrict:"E",replace:!0,scope:{item:"=",width:"@"},link:function(scope,element,attrs){}}}]).directive("liveMosaicShow",["EventManager","MosaicEvents",function(EventManager,MosaicEvents){"use strict";return{restrict:"A",replace:!0,link:function(scope,element,attrs){EventManager.on(MosaicEvents.DATA_CHANGED,function(res){res.status&&element.removeClass("hide")})}}}]),angular.module("app.profile").directive("liveMosaicProfile",["_","EventManager","ProfileService","MosaicService","AgentService","PaginationService","$timeout","DataService",function(_,EventManager,ProfileService,MosaicService,AgentService,PaginationService,$timeout,DataService){"use strict";return{templateUrl:"/assets-access-layer/js/site/Profile/templates/mosaic_wrapper_members.html",restrict:"E",replace:!0,scope:{id:"@",collectionId:"@"},link:function(scope,element,attrs){var currentLoading=0,filters={offset:0,limit:30,order:"random",collections:[{id:scope.collectionId}]},slideData=[];scope.slideList=[],scope.defaultInterval=1e4,scope.loadMore=function(){var searchFilters=DataService.sanitiseDataForQuerystring(filters);ProfileService.search(searchFilters,!0).then(function(res){res.data.results&&(currentLoading+=1,slideData=AgentService.isMobilePhone()?_(res.data.results).chunk(3).map(function(item){return[item]}).value():_(res.data.results).chunk(6).map(function(item){return _.chunk(item,3)}).value(),scope.slideList=scope.slideList.concat(slideData),PaginationService.nextPage(filters))})},scope.loadMore()}}}]).directive("liveMosaicProfileTile",["EventManager",function(EventManager){"use strict";return{templateUrl:"/assets-access-layer/js/site/Profile/templates/mosaic_tile_member.html",restrict:"E",replace:!0,scope:{item:"=",width:"@"},link:function(scope,element,attrs){}}}]),angular.module("app.profile").directive("liveMosaicStats",["EventManager","MosaicService",function(EventManager,MosaicService){"use strict";return{templateUrl:"/templates/Bof500/mosaic_stats_default",restrict:"E",replace:!0,scope:{id:"@"},link:function(scope,element,attrs){var hoursAgo=parseInt(attrs.hoursAgo,10)||24,filters={hours_ago:hoursAgo};scope.stats=null,scope.loadStats=function(){MosaicService.getStatsCollection(scope.id,filters).then(function(res){scope.stats=res.data})},scope.loadStats()}}}]),angular.module("app.profile").component("profileFilter",{templateUrl:function($element,$attrs){return"/templates/Bof500/"+($attrs.template||"search_"+$attrs.filter)},bindings:{filter:"@",limit:"@",switchFilter:"@",disabled:"@",hideReset:"@",hideTitle:"@",hideCount:"@",preventSwitchReset:"@"},controller:["_","EventManager","ProfileEvents","DataService","ArrayService","ProfileService","ProfileEvent","EventManagerUtility","ProfileConfig","InputUtil",function(_,EventManager,ProfileEvents,DataService,ArrayService,ProfileService,ProfileEvent,EventManagerUtility,ProfileConfig,InputUtil){"use strict";var ctrl=this,listeners=[],minItems=ctrl.limit?parseInt(ctrl.limit,10):1e3,changeChannel=ProfileEvent.CHANGE,injectChannel=ProfileEvent.INJECT,initChannel=ProfileEvent.INIT,switchChannel=ProfileEvent.SWITCH,bootstrapChannel=ProfileEvent.BOOTSTRAP;ctrl.items=null,ctrl.filterKey=ctrl.filter,ctrl.itemLimit=minItems,ctrl.viewOpen=!1,ctrl.showFilter=!InputUtil.toBoolean(ctrl.disabled),ctrl.hideResetButton=InputUtil.toBoolean(ctrl.hideReset),ctrl.hideTitleBlock=InputUtil.toBoolean(ctrl.hideTitle),ctrl.hideCountBlock=InputUtil.toBoolean(ctrl.hideCount),ctrl.preventSwitch=InputUtil.toBoolean(ctrl.preventSwitchReset),ctrl.toggle=function(item,e){e&&(e.preventDefault(),e.stopPropagation()),item.status=!item.status,ctrl.emitUpdate()},ctrl.toggleView=function(){ctrl.viewOpen=!ctrl.viewOpen,ctrl.itemLimit=ctrl.viewOpen?1e3:minItems},ctrl.reset=function(e){e&&(e.preventDefault(),e.stopPropagation()),ArrayService.replace(ctrl.items,{status:!1}),ctrl.emitUpdate()},ctrl.resetAndSwitch=function(e){e&&(e.preventDefault(),e.stopPropagation()),ctrl.emitSwitch(!0),ctrl.preventSwitch||ctrl.reset()},ctrl.emitSwitch=function(){ctrl.showFilter=!1,switchChannel.onNext({id:ctrl.filter,data:{}})},ctrl.emitUpdate=function(){var data=ArrayService.selectAll(ctrl.items,"status",!0);changeChannel.onNext({id:ProfileConfig.FILTER_COMPONENT,data:_.zipObject([ctrl.filter],[data])})},listeners.push(initChannel.subscribe(function(data){data&&(ctrl.items=data.all[ctrl.filter],_.isEmpty(data.selected)||data.selected[ctrl.filter].length&&!ctrl.showFilter&&ctrl.emitSwitch(!1))})),listeners.push(injectChannel.filter(function(res){return res.id===ProfileConfig.FILTER_COMPONENT}).subscribe(function(res){DataService.mergeAggregations(ctrl.items,res.data.aggregations[ctrl.filter])})),listeners.push(changeChannel.filter(function(res){return res.id===ProfileConfig.TAG_COMPONENT&&res.data.group===ctrl.filter}).subscribe(function(res){_.find(ctrl.items,{id:res.data.id}).status=!1})),listeners.push(switchChannel.filter(function(res){return res.id!==ctrl.filter}).subscribe(function(){ctrl.showFilter=!0})),ctrl.$onInit=function(){bootstrapChannel.notify(ProfileConfig.FILTER_COMPONENT)},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileSearch",{templateUrl:"/templates/Bof500/search",bindings:{collection:"@",inputPresent:"@"},controller:["_","ProfileService","EventManager","StreamService","ProfileEvents","ProfileEvent","ProfileConfig","DataService","PaginationService","UiEvents","UrlService","$timeout","AgentService","EventManagerUtility","InputUtil",function(_,ProfileService,EventManager,StreamService,ProfileEvents,ProfileEvent,ProfileConfig,DataService,PaginationService,UiEvents,UrlService,$timeout,AgentService,EventManagerUtility,InputUtil){"use strict";var ctrl=this,listeners=[],lock=!1,filters={offset:0,limit:12,categories:ctrl.categories,collections:[],countries:[],nationalities:[],tags:[],query:"",sort:[]},omitFilters=["limit","offset"],fromDefault=(ctrl.collection&&parseInt(ctrl.collection,10),!1),injectChannel=ProfileEvent.INJECT,initChannel=ProfileEvent.INIT,bootstrapChannel=ProfileEvent.BOOTSTRAP,bootstrapStream=null,changeChannel=StreamService.merge([ProfileEvent.CHANGE,ProfileEvent.LOAD_MORE]),paginationChannel=ProfileEvent.UPDATE_PAGINATION,bootstrapComponents=[ProfileConfig.FILTER_COMPONENT,ProfileConfig.FILTER_COMPONENT,ProfileConfig.FILTER_COMPONENT,ProfileConfig.FILTER_COMPONENT,ProfileConfig.TAG_COMPONENT,ProfileConfig.SELECT_COMPONENT,ProfileConfig.RENDER_COMPONENT],componentId=[ProfileConfig.LOAD_MORE,ProfileConfig.FILTER_COMPONENT,ProfileConfig.INPUT_COMPONENT,ProfileConfig.TAG_COMPONENT,ProfileConfig.SELECT_COMPONENT],componentActions=_.zipObject(componentId,[function(data){PaginationService.nextPage(filters),handleSearch(data.status)},function(data){filters=_.assign(filters,data),injectChannel.onNext({id:ProfileConfig.TAG_COMPONENT,data:filters}),handleSearch()},function(data){_.isEmpty(data.query)?filters.query="":filters.query=_.head(data.query).id,handleSearch()},function(data){_.remove(filters[data.group],function(item){return item.id===data.id}),injectChannel.onNext({id:ProfileConfig.TAG_COMPONENT,data:filters}),handleSearch()},function(data){filters.order=data.id,handleSearch()}]);ctrl.items=[],ctrl.count=0,ctrl.showCountries=!0,ctrl.channel=ProfileConfig.GLOBAL_CHANNEL,ctrl.accordionCloseOthers=!1;var handleSearch=function(loadMore){if(!lock){lock=!0,loadMore||PaginationService.reset(filters);var searchFilters=DataService.sanitiseDataForQuerystring(filters),newFilters=_.omit(searchFilters,omitFilters);UrlService.setQueryParams(newFilters),ProfileService.search(searchFilters).then(function(res){injectChannel.onNext({id:ProfileConfig.RENDER_COMPONENT,data:{results:res.data.results,append:loadMore,count:res.data.count,filters:newFilters}}),injectChannel.onNext({id:ProfileConfig.FILTER_COMPONENT,data:{aggregations:res.data.aggregations}}),ctrl.count=res.data.count,searchFilters.query&&!(searchFilters.collections||searchFilters.countries||searchFilters.nationalities||searchFilters.tags)&&"2014"===searchFilters.query.trim()&&(ctrl.count=500),handleFilters(res.data.aggregations),lock=!1,paginationChannel.onNext({page:PaginationService.getPage(filters),limit:filters.limit,total:res.data.count})})}},handleFilters=function(filters){EventManager.emit(ProfileEvents.TO_FILTER,filters,!1)};listeners.push(changeChannel.filter(function(res){return _.includes(componentId,res.id)}).subscribe(function(res){componentActions[res.id](res.data)}));var init=function(res){var urlData=UrlService.parseQuery(),selectedFilters=DataService.rebuildDataFromQuerystring(urlData,res.data);if(!selectedFilters.collections.length){var selected=_.find(res.data.collections,["id",parseInt(ctrl.collection,10)]);selected&&(selected.status=!0,selectedFilters.collections.push(selected),fromDefault=!0)}urlData.query&&(selectedFilters.query=[{id:urlData.query,title:urlData.query}]),filters=angular.extend(filters,selectedFilters),initChannel.onNext({all:res.data,selected:selectedFilters,rebuild:!_.isEmpty(urlData)||fromDefault}),handleSearch()};ctrl.$onInit=function(){ctrl.inputPresent&&InputUtil.toBoolean(ctrl.inputPresent)&&bootstrapComponents.push(ProfileConfig.INPUT_COMPONENT),bootstrapStream=bootstrapChannel.init(bootstrapComponents,[StreamService.fromPromise(ProfileService.getFilters())]),ctrl.accordionCloseOthers=!AgentService.isDesktop()},ctrl.$postLink=function(){bootstrapStream.subscribe(function(result){init(_.head(result))})},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileSearchFilter",{templateUrl:"/templates/Bof500/search_filters",transclude:!0,bindings:{id:"@",filter:"@",showLimit:"@",disabled:"@",subchannel:"@",order:"@",iconClass:"@"},controller:["_","EventManager","ProfileEvents","DataService","ArrayService","ProfileService","ProfileEvent","ChannelManager","UiEvents","EventManagerUtility","AgentService","ProfileConfig","InputUtil",function(_,EventManager,ProfileEvents,DataService,ArrayService,ProfileService,ProfileEvent,ChannelManager,UiEvents,EventManagerUtility,AgentService,ProfileConfig,InputUtil){"use strict";var ctrl=this,listeners=[],minItems=ctrl.limit?parseInt(ctrl.limit,10):1e3,changeChannel=ProfileEvent.CHANGE,injectChannel=ProfileEvent.INJECT,initChannel=ProfileEvent.INIT,bootstrapChannel=ProfileEvent.BOOTSTRAP,checkboxChannelManager=ChannelManager.subscribe(ctrl.subchannel);ctrl.items=null,ctrl.filterKey=ctrl.filter,ctrl.itemLimit=minItems,ctrl.viewOpen=!1,ctrl.showFilter=!InputUtil.toBoolean(ctrl.disabled),ctrl.hideResetButton=InputUtil.toBoolean(ctrl.hideReset),ctrl.hideTitleBlock=InputUtil.toBoolean(ctrl.hideTitle),ctrl.hideCountBlock=InputUtil.toBoolean(ctrl.hideCount),ctrl.preventSwitch=InputUtil.toBoolean(ctrl.preventSwitchReset),ctrl.accordionOpen=!1,ctrl.showMore=!1,ctrl.limit=ctrl.showLimit?InputUtil.toInt(ctrl.showLimit):0;var getItemById=function(id){return _.find(ctrl.items,{id:InputUtil.toInt(id)})},setStatusById=function(id,value,emit){setStatus(getItemById(id),value,emit)},setStatus=function(item,value,emit){item.status!=value&&(item.status=value,checkboxChannelManager.emit(UiEvents.INJECT_CHECKBOX,{id:item.id.toString(),value:value}),!1!==emit&&ctrl.emitUpdate())};ctrl.open=function(item,$event){$event&&($event.stopPropagation(),$event.preventDefault()),setStatus(item,!0)},ctrl.emitUpdate=function(){var data=ArrayService.selectAll(ctrl.items,"status",!0);changeChannel.onNext({id:ProfileConfig.FILTER_COMPONENT,data:_.zipObject([ctrl.filter],[data])})},ctrl.toggleMoreLess=function(){ctrl.showMore=!ctrl.showMore,ctrl.showMore?ctrl.limit=ctrl.items.length:ctrl.limit=InputUtil.toInt(ctrl.showLimit)},listeners.push(initChannel.subscribe(function(data){data&&(ctrl.items=data.all[ctrl.filter],ctrl.limit=ctrl.showLimit?InputUtil.toInt(ctrl.showLimit):ctrl.items.count)})),listeners.push(injectChannel.filter(function(res){return res.id===ProfileConfig.FILTER_COMPONENT}).subscribe(function(res){DataService.mergeAggregations(ctrl.items,res.data.aggregations[ctrl.filter])})),listeners.push(changeChannel.filter(function(res){return res.id===ProfileConfig.TAG_COMPONENT&&res.data.group===ctrl.filter}).subscribe(function(res){setStatusById(res.data.id,!1)})),listeners.push(checkboxChannelManager.on(UiEvents.CHANGE_CHECKBOX,function(data){setStatusById(data.id,data.value)},!0)),ctrl.$onInit=function(){bootstrapChannel.notify(ProfileConfig.FILTER_COMPONENT),ctrl.accordionOpen=!AgentService.isMobile()},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileSearchInput",{templateUrl:"/templates/Bof500/search_input",bindings:{filter:"@"},controller:["ProfileEvents","DataService","ArrayService","ProfileService","ProfileEvent","ProfileConfig","EventManagerUtility",function(ProfileEvents,DataService,ArrayService,ProfileService,ProfileEvent,ProfileConfig,EventManagerUtility){"use strict";var ctrl=this,listeners=[],initChannel=ProfileEvent.INIT,changeChannel=ProfileEvent.CHANGE,bootstrapChannel=ProfileEvent.BOOTSTRAP,injectChannel=ProfileEvent.INJECT;ctrl.items=[],ctrl.query=null,ctrl.getSuggestions=function(query){return ProfileService.getSuggestions(query)},ctrl.update=function(event){13===event.keyCode&&ctrl.emitUpdate()},ctrl.emitUpdate=function(){ctrl.query&&ctrl.query.length>0&&ctrl.query.length<2||changeChannel.onNext({id:ProfileConfig.INPUT_COMPONENT,data:{query:[{id:ctrl.query,title:ctrl.query}]}})},listeners.push(initChannel.subscribe(function(data){data.selected.hasOwnProperty(ctrl.filter)&&(ctrl.query=data.selected[ctrl.filter][0].id)})),listeners.push(injectChannel.filter(function(res){return res.id===ProfileConfig.INPUT_COMPONENT}).subscribe(function(data){ctrl.query="",ctrl.items=[]})),ctrl.$onInit=function(){bootstrapChannel.notify(ProfileConfig.INPUT_COMPONENT)},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").directive("profileSearchNavigation",["_","ProfileService","EventManager","ProfileEvents","ProfileEvent","DataService","PaginationService","UrlService","$timeout","ShuffleService","ProfileConfig",function(_,ProfileService,EventManager,ProfileEvents,ProfileEvent,DataService,PaginationService,UrlService,$timeout,ShuffleService,ProfileConfig){"use strict";return{templateUrl:"/templates/Bof500/search_navigation",replace:!0,restrict:"E",scope:{collectionId:"@",redirect:"@"},link:function(scope){var listeners=[],initChannel=ProfileEvent.INIT,changeChannel=ProfileEvent.CHANGE,filters={countries:[],tags:[]},omitFilters=["limit","offset"];scope.items=[],scope.count=0,scope.showCountries=!0,scope.handlePreSearch=function(){var searchFilters=DataService.sanitiseDataForQuerystring(filters),newFilters=_.omit(searchFilters,omitFilters),queryString=UrlService.getQueryString(newFilters);UrlService.changeUrl(scope.redirect+queryString)},listeners.push(changeChannel.filter(function(res){return res.id===ProfileConfig.FILTER_COMPONENT}).subscribe(function(res){filters=angular.extend(filters,res.data),scope.handlePreSearch()})),ProfileService.getFilters().then(function(res){var selectedFilters=DataService.rebuildDataFromQuerystring({collections:scope.collectionId},res.data);filters=angular.extend(filters,selectedFilters),initChannel.onNext({all:res.data,selected:[]})})}}}]),angular.module("app.profile").component("profileSearchResults",{templateUrl:"/templates/Bof500/search_results",bindings:{loadMoreIfEmpty:"@",offset:"@",arrangementClasses:"@"},controller:["EventManager","DomService","ProfileEvents","$timeout","ShuffleService","ProfileService","ProfileEvent","AgentService","UrlService","EventManagerUtility","ProfileConfig","$element",function(EventManager,DomService,ProfileEvents,$timeout,ShuffleService,ProfileService,ProfileEvent,AgentService,UrlService,EventManagerUtility,ProfileConfig,$element){"use strict";var $ctrl=this,listeners=[],injectChannel=($element[0],$ctrl.loadMoreIfEmpty,$ctrl.offset&&parseInt($ctrl.offset,10),ProfileEvent.INJECT),bootstrapChannel=ProfileEvent.BOOTSTRAP;$ctrl.items=[],$ctrl.count=0,$ctrl.arrangementClasses=$ctrl.arrangementClasses||"col-xs-24  col-sm-12  col-md-6",$ctrl.handleClick=function(item,e){AgentService.isTouch()&&(e.preventDefault(),e.stopPropagation(),UrlService.changeUrl(item.url))},listeners.push(injectChannel.filter(function(data){return data.id===ProfileConfig.RENDER_COMPONENT}).subscribe(function(res){var data=res.data;data.results&&(data.append?(ShuffleService.manipulateUrl(data.results,$ctrl.items.length,data.filters),$ctrl.items=$ctrl.items.concat(data.results)):(ShuffleService.manipulateUrl(data.results,0),$ctrl.items=data.results),$ctrl.count=data.count)})),$ctrl.$onInit=function(){bootstrapChannel.notify(ProfileConfig.RENDER_COMPONENT)},$ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileSearchSmall",{templateUrl:"/templates/Bof500/search_small",bindings:{collectionId:"@",tag:"@",nationality:"@",redirect:"@",hackHideCount:"@"},controller:["_","ProfileService","EventManager","ProfileEvents","DataService","PaginationService","UrlService","$timeout","ShuffleService","ProfileConfig","ProfileEvent","StreamService","EventManagerUtility",function(_,ProfileService,EventManager,ProfileEvents,DataService,PaginationService,UrlService,$timeout,ShuffleService,ProfileConfig,ProfileEvent,StreamService,EventManagerUtility){"use strict";var ctrl=this,filters={offset:0,limit:12,collections:[],countries:[],nationalities:[],tags:[],query:"",sort:[]},omitFilters=["limit","offset"],listeners=[],bootstrapComponents=[ProfileConfig.FILTER_COMPONENT,ProfileConfig.FILTER_COMPONENT,ProfileConfig.FILTER_COMPONENT],injectChannel=ProfileEvent.INJECT,initChannel=ProfileEvent.INIT,bootstrapChannel=ProfileEvent.BOOTSTRAP,changeChannel=ProfileEvent.CHANGE,componentId=[ProfileConfig.FILTER_COMPONENT],componentActions=_.zipObject(componentId,[function(data){filters=angular.extend(filters,data),ctrl.handlePreSearch()}]);ctrl.items=[],ctrl.count=0,ctrl.showCountries=!0,ctrl.handleSearch=function(){var searchFilters=DataService.sanitiseDataForQuerystring(filters);ProfileService.search(searchFilters).then(function(res){injectChannel.onNext({id:ProfileConfig.FILTER_COMPONENT,data:{aggregations:res.data.aggregations}})})},ctrl.handlePreSearch=function(){var searchFilters=DataService.sanitiseDataForQuerystring(filters),newFilters=_.omit(searchFilters,omitFilters),queryString=UrlService.getQueryString(newFilters);UrlService.changeUrl(ctrl.redirect+queryString)},listeners.push(changeChannel.filter(function(res){return _.includes(componentId,res.id)}).subscribe(function(res){componentActions[res.id](res.data)}));var init=function(res){var selectedFilters=DataService.rebuildDataFromQuerystring({collections:ctrl.collectionId,tags:ctrl.tag,nationalities:ctrl.nationality},res.data);filters=angular.extend(filters,selectedFilters),initChannel.onNext({all:res.data,selected:[]}),ctrl.handleSearch()};ctrl.$onInit=function(){bootstrapChannel.init(bootstrapComponents,[StreamService.fromPromise(ProfileService.getFilters())]).subscribe(function(res){init(_.head(res))})},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileSearchSort",{template:'<select class="{[{$ctrl.inputClass}]} form-control color-base background-white" ng-change="$ctrl.handleChange()" ng-options="item.label for item in $ctrl.options track by item.id" ng-model="$ctrl.selected"></select>',bindings:{filter:"@",default:"@",inputClass:"@"},controller:["ProfileEvents","DataService","ArrayService","ProfileEvent","ProfileConfig","EventManagerUtility",function(ProfileEvents,DataService,ArrayService,ProfileEvent,ProfileConfig,EventManagerUtility){"use strict";var ctrl=this,listeners=[],bootstrapChannel=ProfileEvent.BOOTSTRAP,initChannel=ProfileEvent.INIT,changeChannel=ProfileEvent.CHANGE;ctrl.selected=null,ctrl.options=[],ctrl.handleChange=function(){changeChannel.onNext({id:ProfileConfig.SELECT_COMPONENT,data:ctrl.selected})},listeners.push(initChannel.subscribe(function(data){data.all.hasOwnProperty(ctrl.filter)&&(ctrl.options=data.all[ctrl.filter]),data.selected.hasOwnProperty(ctrl.filter)&&(data.selected[ctrl.filter].length?ctrl.selected=ArrayService.select(ctrl.options,"id",data.selected[ctrl.filter][0].id):ctrl.selected=ArrayService.select(ctrl.options,"id",ctrl.default))})),ctrl.$onInit=function(){bootstrapChannel.notify(ProfileConfig.SELECT_COMPONENT)},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileSearchTagList",{templateUrl:"/templates/Bof500/search_tag_list",bindings:{filter:"@",exclude:"@"},controller:["_","EventManager","ProfileEvents","DataService","ArrayService","EventManagerUtility","ProfileEvent","ProfileConfig",function(_,EventManager,ProfileEvents,DataService,ArrayService,EventManagerUtility,ProfileEvent,ProfileConfig){"use strict";var ctrl=this,listeners=[],bootstrapChannel=ProfileEvent.BOOTSTRAP,excludeArray=ctrl.exclude.split(","),changeChannel=ProfileEvent.CHANGE,injectChannel=ProfileEvent.INJECT,initChannel=ProfileEvent.INIT;ctrl.items=[],ctrl.natAndLoc=!1,ctrl.removeTag=function(item){changeChannel.onNext({id:ProfileConfig.TAG_COMPONENT,data:item})},ctrl.handleData=function(data){var newData=DataService.flattenMultipleCollections(_.cloneDeep(data),excludeArray);ctrl.items=newData,ctrl.natAndLoc=!_.isEmpty(data.nationalities)&&!_.isEmpty(data.countries)},listeners.push(injectChannel.filter(function(res){return res.id===ProfileConfig.TAG_COMPONENT}).subscribe(function(res){ctrl.handleData(res.data)})),listeners.push(initChannel.subscribe(function(data){ctrl.handleData(data.selected)})),ctrl.$onInit=function(){bootstrapChannel.notify(ProfileConfig.TAG_COMPONENT)},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileShuffle",{templateUrl:"/assets-access-layer/js/site/Profile/templates/profile-shuffle.template.html",bindings:{collectionId:"@",redirect:"@"},controller:["_","ProfileService","ProfileEvent","ProfileConfig","UrlService","ShuffleService","EventManagerUtility",function(_,ProfileService,ProfileEvent,ProfileConfig,UrlService,ShuffleService,EventManagerUtility){"use strict";var ctrl=this,listeners=[],searchFilters={},changeChannel=ProfileEvent.CHANGE,bootstrapChannel=ProfileEvent.BOOTSTRAP,injectChannel=ProfileEvent.INJECT,bootstrapComponents=[ProfileConfig.SHUFFLE_BUTTON,ProfileConfig.SHUFFLE_BUTTON],componentActions=_.zipObject([ProfileConfig.SHUFFLE_BUTTON],[function(data){ShuffleService.setOffset(searchFilters,data.index),UrlService.changeUrl(data.url+UrlService.getQueryString(searchFilters))}]);ctrl.enabled=!1,ctrl.handlePreSearch=function(){if(searchFilters=UrlService.parseQuery(),searchFilters.offset=parseInt(searchFilters.offset,10),searchFilters.offset>=0){var newFilters=angular.copy(searchFilters),firstElement=ShuffleService.centerSearch(newFilters);ProfileService.search(newFilters).then(function(res){firstElement&&res.data.results.unshift({}),injectChannel.onNext({id:ProfileConfig.SHUFFLE_BUTTON,data:{results:res.data.results,count:res.data.count}}),ctrl.count=res.data.count,res.data.count&&(ctrl.enabled=!0)})}},listeners.push(changeChannel.subscribe(function(data){componentActions[data.id](data.data)})),ctrl.$onInit=function(){bootstrapChannel.init(bootstrapComponents).subscribe(function(){ctrl.handlePreSearch()})},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.profile").component("profileShuffleButton",{templateUrl:"/assets-access-layer/js/site/Profile/templates/profile-shuffle-button.template.html",bindings:{index:"@"},controller:["ProfileEvent","ProfileConfig","UrlService","ShuffleService","EventManagerUtility",function(ProfileEvent,ProfileConfig,UrlService,ShuffleService,EventManagerUtility){"use strict";var ctrl=this,listeners=[],bootstrapChannel=ProfileEvent.BOOTSTRAP,changeChannel=ProfileEvent.CHANGE,injectChannel=ProfileEvent.INJECT;ctrl.resIndex=parseInt(ctrl.index,10),ctrl.goToProfile=function(){changeChannel.onNext({id:ProfileConfig.SHUFFLE_BUTTON,data:{url:ctrl.item.url,index:ctrl.resIndex}})},listeners.push(injectChannel.filter(function(res){return res.id===ProfileConfig.SHUFFLE_BUTTON}).subscribe(function(res){var item=res.data.results[ctrl.resIndex];item&&(ctrl.item=item)})),ctrl.$onInit=function(){bootstrapChannel.notify(ProfileConfig.SHUFFLE_BUTTON)},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),function(){"use strict";function MosaicApi($resource){return $resource("/xhr/mosaic/:action/:id",{action:"@action",id:"@id"},{getProfileStats:{method:"GET",params:{action:"stats"}},getCollectionStats:{method:"GET",params:{action:"collectionstats"}},getProfileMosaic:{method:"GET",params:{action:"profile"}},getCollectionMosaic:{method:"GET",params:{action:"collection"}}})}MosaicApi.$inject=["$resource"],angular.module("app.profile").factory("MosaicApi",MosaicApi)}(),function(){"use strict";function ProfileApi($resource){return $resource("/xhr/profiles/:action",{action:"@action"},{getAll:{method:"GET"},getFilters:{method:"GET",params:{action:"filters"}},getSuggestions:{method:"GET",params:{action:"suggest"}},search:{method:"GET",params:{action:"search"}},volatileSearch:{method:"GET",params:{action:"search"}}})}ProfileApi.$inject=["$resource"],angular.module("app.profile").factory("ProfileApi",ProfileApi)}(),angular.module("app.profile").service("MosaicService",["_","DataService","MosaicApi","ProfileEvents",function(_,DataService,MosaicApi,ProfileEvents){this.getCollectionImages=function(id,filters){var newFilters=DataService.createFilters(filters,{id:id});return MosaicApi.getCollectionMosaic(newFilters).$promise},this.getProfileImages=function(id,filters){var newFilters=DataService.createFilters(filters,{id:id});return MosaicApi.getProfileMosaic(newFilters).$promise},this.randomiseTemplates=function(combinations,singleBlock){return singleBlock?[this.selectTemplate(combinations)]:[this.selectTemplate(combinations),this.selectTemplate(combinations)]},this.selectTemplate=function(combinations){return Math.floor(Math.random()*combinations.length)},this.splitData=function(combinations,data){var res=[],start=0;return angular.forEach(combinations,function(i){res.push({template:i,items:_.slice(data,start,start+i)}),start+=i}),res},this.getTotalItems=function(combinations){return combinations.reduce(function(prev,cur){return prev+cur})},this.remap=function(combinations,indexes){return indexes.map(function(i){return combinations[i]})},this.getStatsCollection=function(id,filters){var newFilters=DataService.createFilters(filters,{id:id});return MosaicApi.getCollectionStats(newFilters).$promise}}]),angular.module("app.profile").service("ProfileEvent",["ChannelManager","UiEvents","ProfileConfig","AuthEvents","EventManager","CoreEvents","Stream","BootstrapStream","LazyStream",function(ChannelManager,UiEvents,ProfileConfig,AuthEvents,EventManager,CoreEvents,Stream,BootstrapStream,LazyStream){"use strict";var EventDispatcher=ChannelManager.subscribe(ProfileConfig.GLOBAL_CHANNEL);return{INJECT:new Stream,CHANGE:new Stream,INIT:new LazyStream,SWITCH:new Stream,BOOTSTRAP:new BootstrapStream,USER_CHANGED:EventManager.get(AuthEvents.USER_CHANGED).getSubject(!0),WINDOW_SCROLL:EventManager.get(UiEvents.WINDOW_SCROLL).getSubject(),LOAD_MORE:EventDispatcher.get(UiEvents.LOAD_MORE).getSubject(),UPDATE_PAGINATION:EventDispatcher.get(UiEvents.UPDATE_PAGINATION).getSubject(!0)}}]),angular.module("app.profile").service("ProfileService",["DataService","ProfileApi","ProfileEvents",function(DataService,ProfileApi,ProfileEvents){var defaultFilters={limit:4,offset:0,attributes:"all",order:"rand"};this.getAll=function(filters,removePrefix){return filters=DataService.createFilters(defaultFilters,filters),filters.attributes="all",ProfileApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,!1),res})},this.getSearchAll=function(collectionId,limit){var filters={collections:collectionId,order:"random",limit:limit};return this.search(filters).then(function(res){return{data:res.data.results}})},this.getRoles=function(){return ProfileApi.getRoles().$promise},this.getFilters=function(){return ProfileApi.getFilters().$promise},this.getSuggestions=function(query){return ProfileApi.getSuggestions({query:query}).$promise.then(function(res){return res.data.hasOwnProperty("search_results")?res.data.search_results:[]})},this.search=function(filters,volatile){return(volatile?ProfileApi.volatileSearch:ProfileApi.search)(filters).$promise},this.trackSearch=function(searchFilters,label){label=label||"Search"}}]),angular.module("app.profile").service("ShuffleService",["_","UrlService","$window",function(_,UrlService,$window){this.centerSearch=function(filters){var first=!1;return filters.offset=filters.offset-1,filters.offset<0?(first=!0,this.sanitise(filters,2)):this.sanitise(filters),first},this.setOffset=function(filters,index){filters.offset=index<1.5?filters.offset-1:filters.offset+1,this.sanitise(filters)},this.sanitise=function(filters,newRange){newRange=newRange||3,filters.offset<0&&(filters.offset=0),filters.limit=newRange},this.manipulateUrl=function(items,offset,params){params=params||UrlService.parseQuery(),_.map(items,function(item){params.offset=offset;var itemRef=_.merge(item,{url:item.url+UrlService.getQueryString(params)});return offset+=1,itemRef})}}]),angular.module("app.search").controller("SearchTypeAheadController",["$scope","$window","$modalInstance","SearchService","modalData",function($scope,$window,$modalInstance,SearchService,modalData){"use strict";var lock=!1;$scope.data={query:modalData.query},$scope.items=[],$scope.close=function(){$modalInstance.dismiss()},$scope.openSearch=function(){$window.location.href="/search/?q="+$scope.data.query},$scope.spyEnter=function(event){13!==event.keyCode&&"click"!==event.type||$scope.openSearch()},$scope.link=function(href){$window.location.href=href},$scope.$watch("data.query",function(n,o){!lock&&$scope.data.query.length>1?(lock=!0,SearchService.getAll({query:$scope.data.query}).then(function(res){$scope.items=res.results,lock=!1},function(){$scope.items=[]})):$scope.items=[]})}]),angular.module("app.search").directive("searchTypeAhead",["EventManager","AuthEvents","modalService",function(EventManager,AuthEvents,modalService){"use strict";return{template:'<a fast-click href="javascript:void(0)" title="Search" class="nav-icon-link" ng-click="openModal()"><span ng-transclude></span><i class="icon-search"></i></a>',replace:!0,restrict:"E",transclude:!0,scope:{},link:function(scope,element,attrs){scope.openModal=function(){EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0}),modalService.open({templateUrl:"/templates/Framework/search_type_ahead",controller:"SearchTypeAheadController",size:"lg",backdrop:!1,windowClass:"modal-search",resolve:{modalData:function(){return{query:""}}}},!0).result.finally(function(res){EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!1})})}}}}]),function(){"use strict";function SearchApi($resource){return $resource("/xhr/search/legacy",{id:"@id"},{getAll:{method:"GET"}})}SearchApi.$inject=["$resource"],angular.module("app.search").factory("SearchApi",SearchApi)}(),angular.module("app.search").service("SearchService",["DataService","SearchApi",function(DataService,SearchApi){var defaultFilters={limit:6,offset:0};this.getAll=function(filters,removePrefix){return filters=DataService.createFilters(defaultFilters,filters),SearchApi.getAll(filters).$promise.then(function(res){return res.data=DataService.normalise(res.data,removePrefix),res})}}]),function(){"use strict";function AdvertsApi(GenericApiFactory,Routes){function get(zoneName){var data={zonename:zoneName};return advertsApi.get(data)}var advertsApi=new GenericApiFactory(Routes.ADVERT);return{get:get}}AdvertsApi.$inject=["GenericApiFactory","Routes"],angular.module("app.ads").factory("advertsApi",AdvertsApi)}(),function(){"use strict";function AdvertLoaderController($q,advertsApi,wallStream,EventManagerUtility){function $onInit(){readyDeferred=$q.defer(),initWaitFor(),advertsApi.get($ctrl.zoneName).then(function(result){return prepareAd(result.data)})}function initWaitFor(){if(!$ctrl.waitFor)return void setReady();"article-loaded"===$ctrl.waitFor&&listeners.push(wallStream.ARTICLE_LOADED.subscribe(setReady))}function prepareAd(data){return data.advert?($ctrl.advert=data.advert,$ctrl.zoneName=$ctrl.zoneName.replace(/\./g,"").replace(/[A-Z]/g,"-$&").toLowerCase().replace(/^-+/,""),$ctrl.multipleInstances&&($ctrl.zoneMultipleInstanceId="-"+currentCount),$q.resolve()):$q.reject()}function setReady(){$ctrl.ready=!0,readyDeferred.resolve()}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}var $ctrl=this,listeners=[],readyDeferred=null;adsCount++;var currentCount=adsCount;$ctrl.ready=!1,$ctrl.advert=!1,$ctrl.zoneMultipleInstanceId="",$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var advertLoaderComponent={templateUrl:"/assets-access-layer/js/site/Ads/templates/advert-loader.template.html",bindings:{tag:"@",zoneName:"@",classExtra:"@",waitFor:"@",multipleInstances:"@"},controller:AdvertLoaderController},adsCount=0;angular.module("app.ads").component("advertLoader",advertLoaderComponent)}(),function(){"use strict";function AdvertController($element,doubleClickService,$log,adsStream){function $onInit(){$ctrl.isEnabled=!1,$ctrl.adText=$ctrl.adText||"advertising",listener=adsStream.AD_UNIT_DISPLAY_CHANGE.subscribe(onAdUnitDisplayChanged);try{var zoneSizes=JSON.parse($ctrl.zoneSizes);doubleClickService.displayAd($element[0],$ctrl.zoneCode,$ctrl.zoneId,zoneSizes)}catch(e){}}function $onDestroy(){listener&&listener.dispose()}function onAdUnitDisplayChanged(event){$log.debug("Ads::advert::onAdUnitDisplayChanged::",$ctrl.zoneCode,$ctrl.zoneId,event),event.zoneId===$ctrl.zoneId&&($ctrl.isEnabled=event.success)}var listener,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var advertComponent={templateUrl:"/assets-access-layer/js/site/Ads/templates/advert.template.html",bindings:{zoneId:"@",zoneCode:"@",zoneName:"@",zoneSizes:"@",tag:"@",classExtra:"@",adText:"@"},controller:AdvertController};angular.module("app.ads").component("advert",advertComponent)}(),function(){"use strict";var articleAdPositions=[{minWordCount:400,minParagraphCount:4,zoneName:"Article.InText.First.Mobile",tag:"article_single"},{minWordCount:800,minParagraphCount:8,zoneName:"Article.InText.Second.Mobile",tag:"article_single"}];angular.module("app.article").constant("ARTICLE_AD_POSITIONS",articleAdPositions)}(),angular.module("app.ads").constant("ADS_DFP",{ACCOUNT_ID:6599739}),angular.module("app.ads").directive("loadAdvertise",["$log","DomService",function($log,DomService){"use strict";return{template:'<div class="row" ng-show="image"><a ng-href="{[{href}]}" target="_blank"><img ng-src="{[{image}]}"/></a></div>',replace:!0,restrict:"E",scope:{src:"@",href:"@"},link:function(scope,element){scope.image=null,scope.href=scope.href||"http://bit.ly/1EIX9g7";var banners={290:"300x290",970:"970.jpg"},width=DomService.getParentWidth(element),selected=null;$log.debug("Load Advertise, size:",width),angular.forEach(banners,function(img,size){size<=width&&(selected=img)}),selected&&(scope.image="http://cdn.businessoffashion.com/assets-access-layer/images/ads/asdasdas?sz="+selected)}}}]),angular.module("app.ads").directive("loadAdvertise",["$log","DomService",function($log,DomService){"use strict";return{template:'<div class="row" ng-show="image"><a ng-href="{[{href}]}" target="_blank"><img ng-src="{[{image}]}"/></a></div>',replace:!0,restrict:"E",scope:{src:"@",href:"@"},link:function(scope,element){scope.image=null,scope.href=scope.href||"http://bit.ly/1EIX9g7";var banners={290:"300x290",970:"970.jpg"},width=DomService.getParentWidth(element),selected=null;$log.debug("Load Advertise, size:",width),angular.forEach(banners,function(img,size){size<=width&&(selected=img)}),selected&&(scope.image="http://cdn.businessoffashion.com/assets-access-layer/images/ads/asdasdas?sz="+selected)}}}]),function(){"use strict";function injectAds(_,ARTICLE_AD_POSITIONS){function compile($element,$attrs){classExtra=$attrs.injectAdsClass,waitFor=$attrs.injectAdsWaitFor||null,adPositions=getAdPositions($element[0],$attrs);var totalWordCount=0,paragraphCount=0;_.toArray($element.children()).filter(isApplicableElement).forEach(function(element){totalWordCount+=getElementWordCount(element),paragraphCount++,appendAdsToPositions(totalWordCount,paragraphCount,element)})}function getAdPositions(element,attrs){var positions=attrs.injectAdsPositions?angular.fromJson(attrs.injectAdsPositions):angular.copy(ARTICLE_AD_POSITIONS);return Array.prototype.slice.call(element.querySelectorAll("p > advert-loader")).forEach(function(el){el.attributes["wait-for"]||el.setAttribute("wait-for",waitFor),positions.splice(_.findIndex({zoneName:el.attributes["zone-name"].value}),1)}),positions}function isApplicableElement(element){return applicableTags.indexOf(element.tagName.toLowerCase())>-1}function getElementWordCount(element){var text=element.innerText.toLowerCase().replace(/<[^>]+>/gm,"").replace(/[^a-z0-9 ]/gm,"");return _.words(text).length}function appendAdsToPositions(totalWordCount,paragraphCount,element){adPositions.filter(function(adPosition){return totalWordCount>=adPosition.minWordCount&&paragraphCount>=adPosition.minParagraphCount}).forEach(function(adPosition){appendAd(element,adPosition),adPositions.splice(adPositions.indexOf(adPosition),1)})}function appendAd(element,adPosition){var ad=angular.element(createAdvertComponent(adPosition));angular.element(element).after(ad)}function createAdvertComponent(adPosition){var ad="<advert-loader";return ad+=' zone-name="'+adPosition.zoneName+'"',adPosition.tag&&(ad+=' tag="'+adPosition.tag+'"'),classExtra&&(ad+=' class-extra="'+classExtra+'"'),waitFor&&(ad+=' wait-for="'+waitFor+'"'),ad+="></advert-loader>"}var adPositions=[],applicableTags=["p","blockquote"],classExtra="",waitFor=null;return{restrict:"A",compile:compile}}injectAds.$inject=["_","ARTICLE_AD_POSITIONS"],angular.module("app.ads").directive("injectAds",injectAds)}(),function(){"use strict";function doubleClickService(_,$log,$q,$timeout,$window,DomService,EventManager,CoreEvents,googletag,ADS_DFP,adsStream,membershipProductVariantService){function init(){function initPublisherAds(){function onAdSlotRendered(event){var slotId=event.slot.getSlotElementId(),slot=DomService.getElementById(slotId);adsStream.AD_UNIT_DISPLAY_CHANGE.onNext({zoneId:slotId,success:!event.isEmpty}),EventManager.emit(CoreEvents.REPAINT,{status:!0}),event.isEmpty||slot.attr("ad-size",+event.size[0]+"x"+event.size[1])}var publisherAdsService=googletag.pubads();publisherAdsService.enableSingleRequest(),publisherAdsService.collapseEmptyDivs(),publisherAdsService.setTargeting("host",[location.host]),pageType&&publisherAdsService.setTargeting("page_type",pageType),articleCategory&&publisherAdsService.setTargeting("article_category",articleCategory),publisherAdsService.addEventListener("slotRenderEnded",onAdSlotRendered)}var bodyElement=DomService.getBody()[0],pageType=bodyElement.getAttribute("data-page-type"),articleCategory=bodyElement.getAttribute("data-page-category");$log.debug("Ads::doubleClickService::init::"),googletag=googletag||{},googletag.cmd=googletag.cmd||[],googletag.cmd.push(initPublisherAds)}function refreshAdvert(zoneDivId){if(slots[zoneDivId])return $log.debug("Ads::doubleClickService::refreshAdvert:: Refreshing slot [%s]",zoneDivId),void googletag.pubads().refresh([slots[zoneDivId]]);$log.debug("Ads::doubleClickService::refreshAdvert:: Slot [%s] not found!",zoneDivId)}function onUserChanged(user){function updateTargets(){$log.debug("Ads::doubleClickService::onUserChanged::updateTargets::");var publisherAdsService=googletag.pubads(),companyData=user.getCompanyData(),membershipTypeKey=user.isLoggedIn()?membershipProductVariantService.getAdsTargetingKey(user):"anonymous";publisherAdsService.setTargeting("user_type",membershipTypeKey),publisherAdsService.setTargeting("city_id",[user.city_id]),publisherAdsService.setTargeting("country_id",[user.country_id]),publisherAdsService.setTargeting("job_responsibility_id",[companyData.job_responsibility_id]),publisherAdsService.setTargeting("job_level_id",[companyData.job_level_id])}googletag.cmd.push(updateTargets)}function displayAd(element,zoneCode,zoneDivId,adUnitSizes){function displayAdSlot(){var publisherAdsService=googletag.pubads(),adUnitPath="/"+ADS_DFP.ACCOUNT_ID+"/"+zoneCode,size=[adUnitSizes.mobile];slots[zoneDivId]=googletag.defineSlot(adUnitPath,size,zoneDivId),$log.debug("Ads::doubleClickService::displayAd::displayAdSlot::",slots[zoneDivId]),slots[zoneDivId]&&(slots[zoneDivId].defineSizeMapping(getAdSlotSizeMapping(adUnitSizes)).addService(publisherAdsService),googletag.enableServices(),$timeout(function(){googletag.display(zoneDivId)}))}function getAdSlotSizeMapping(adUnitSizes){return googletag.sizeMapping().addSize(sizeThresholds.desktop,adUnitSizes.desktop).addSize(sizeThresholds.mobile,adUnitSizes.mobile).addSize([0,0],[]).build()}$log.debug("Ads::doubleClickService::displayAd::",arguments),!adUnitSizes||0===adUnitSizes.desktop.length&&0===adUnitSizes.mobile.length||googletag.cmd.push(displayAdSlot)}var sizeThresholds={desktop:[1050,0],mobile:[320,0]},slots={};return{init:_.once(init),onUserChanged:onUserChanged,displayAd:displayAd,refreshAdvert:refreshAdvert}}doubleClickService.$inject=["_","$log","$q","$timeout","$window","DomService","EventManager","CoreEvents","googletag","ADS_DFP","adsStream","membershipProductVariantService"],angular.module("app.ads").factory("doubleClickService",doubleClickService)}(),function(){"use strict";function adsStream(LazyStream,EventManagerUtility){return{AD_UNIT_DISPLAY_CHANGE:new LazyStream}}adsStream.$inject=["LazyStream","EventManagerUtility"],angular.module("app.ads").factory("adsStream",adsStream)}(),angular.module("app.youtube").constant("YoutubeEvents",{PLAYER_STATUS_CHANGED:"videoPlayerChanged"}),angular.module("app.youtube").directive("youtubePlayer",["DomService","YoutubeService","AgentService","EventManager","authModalService","$q","$timeout","AuthEvents","YoutubeEvents","DataService","TrackerService","InputUtil",function(DomService,YoutubeService,AgentService,EventManager,authModalService,$q,$timeout,AuthEvents,YoutubeEvents,DataService,TrackerService,InputUtil){"use strict";return{restrict:"E",scope:{id:"@",width:"@",height:"@",firewall:"@",animation:"@",autoPlay:"@"},template:'<div class="container-fill video-player {[{isPlaying ? \'active\' : \'inactive\'}]}"><div ng-show="ready" ng-style="containerStyle"><div></div><div class="player-header" ng-show="!isMobile"><div class="pull-right" ng-click="removeVideo($event)"><i class="icon icon-close"></i></div></div></div><div ng-show="!ready" class="relative container-fill"><div ng-transclude class="transcluded {[{isPlaying ? \'active\' : \'inactive\'}]}"></div><div ng-show="!disabled" class="player-controls"><i ng-click="playVideo($event)" class="icon icon-play"></i></div><div></div>',replace:!0,transclude:!0,link:function(scope,element,attrs){var player=null,videoId=scope.id||null,containerElement=element[0],videoElement=(element.children()[0],element.children().children()[0]),user=(element.children().children()[1],null),firewall="true"===scope.firewall,animation="true"===scope.animation,autoPlay=InputUtil.toBoolean(scope.autoPlay);EventManager.on(AuthEvents.USER_CHANGED,function(data){user=data,!user.id&&firewall&&scope.removeVideo()}),scope.ready=!1,scope.isPlaying=!1,scope.init=!1,scope.disabled=!1,scope.containerStyle={},scope.isMobile=AgentService.isMobile(),videoId?YoutubeService.loadApi():scope.disabled=!0,scope.playVideo=function(event){if(event.stopPropagation(),event.preventDefault(),YoutubeService.stopAll(),!user.id&&firewall)return authModalService.setSubscribeSource("RestrictedContent"),void authModalService.openLogin("restrictedContent",{firewall:!0}).then(function(){scope.playVideo(event)});scope.setStatus(!0).then(function(){scope.initPlayer()})},scope.initPlayer=function(){if(!player){var height=DomService.getHeight(containerElement),width=DomService.getWidth(containerElement);player=YoutubeService.createPlayer(videoElement,videoId,width,height),scope.containerStyle={height:height+"px",width:width+"px"}}scope.trackEvent(),scope.init?(scope.ready=!0,player.play()):player.init().then(function(res){scope.init=!0,scope.ready=!0,autoPlay&&player.play()},function(res){scope.ready=!1})},scope.trackEvent=function(){var trackerParameters=DataService.buildDataFromAttributes(attrs,"tracker");TrackerService.track(attrs.tracker,trackerParameters.Clk,trackerParameters)},scope.removeVideo=function(event){event&&(event.stopPropagation(),event.preventDefault()),scope.setStatus(!1),player.stop(),scope.ready=!1},scope.setStatus=function(status){var promise=null,deferred=$q.defer();return scope.isPlaying=status,EventManager.emit(YoutubeEvents.PLAYER_STATUS_CHANGED,{status:status,id:scope.id}),animation&&status?promise=$timeout(function(){return!0},1e3):(deferred.resolve(!0),promise=deferred.promise),promise}}}}]),angular.module("app.youtube").directive("youtubePlayerHide",["EventManager","YoutubeEvents",function(EventManager,YoutubeEvents){"use strict";return{restrict:"E",template:'<div class="animate-show" ng-class="{\'ng-show\': status}" ng-transclude></div>',replace:!0,scope:{id:"@"},transclude:!0,link:function(scope,element,attrs){scope.status=!0,EventManager.on(YoutubeEvents.PLAYER_STATUS_CHANGED,function(data){scope.id!==data.id&&scope.id||(scope.status=!data.status)})}}}]),angular.module("app.youtube").factory("YoutubeService",["$window","$q",function($window,$q){"use strict";function YoutubePlayer(tagId,videoId,width,height){this.tagId=tagId,this.videoId=videoId,this.width=width,this.height=height,this.player=null,this.ready=!1;var self=this;this.onPlayerReady=function(event){self.ready=!0},this.onPlayerStateChange=function(event){},this.getQuality=function(levels){return this.width>1280?"hd720":this.width>853?"large":this.width>640?"medium":"small"},this.play=function(){this.ready&&this.player.playVideo()},this.stop=function(){this.ready&&this.player.stopVideo()},this.destroy=function(){this.player&&this.player.destroy()},this.init=function(){var deferred=$q.defer();return $window.YT&&ready?this.player=new $window.YT.Player(this.tagId,{height:this.height,width:this.width,videoId:this.videoId,playerVars:{autoplay:!1,html5:!0},events:{onReady:function(event){deferred.resolve({status:!0}),self.onPlayerReady(event)},onStateChange:function(event){self.onPlayerStateChange(event)}}}):deferred.reject({status:!1}),deferred.promise}}var players=[],initialised=!1,ready=!1;return $window.onYouTubeIframeAPIReady=function(){ready=!0},{createPlayer:function(tagId,videoId,width,height){var player=new YoutubePlayer(tagId,videoId,width,height);return players.push(player),player},stopAll:function(){angular.forEach(players,function(player){player.stop()})},loadApi:function(){if(!initialised){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),initialised=!0}}}}]),angular.module("app.show").constant("ShowsTemplates",{DYNAMIC_SEARCH:"/assets-access-layer/js/site/Show/templates/shows_dynamic_search.html"}),angular.module("app.show").constant("ShowEvents",{BASE:"showFilter",COLORS_CHANGED:"showFilterColors",TAGS_CHANGED:"showFilterTags",REVIEW_READ_LIMIT:"ShowReviewReadLimit"}).constant("CollectionEvent",{LOADED:"loaded",URL_CHANGED:"urlChanged",VIEW_CHANGED:"viewChanged",LOOK_CHANGED:"lookChanged",PAGE_CHANGED:"pageChanged",REQUEST_NEXT_LOOK:"requestNextLook",REQUEST_PREVIOUS_LOOK:"requestPreviousLook",REQUEST_SPECIFIC_LOOK:"requestSpecficLook",ZOOMED_IN:"zoomedIn",ZOOMED_OUT:"zoomedOut",SHOW_LOADED:"showLoaded",NEXT_SHOW_LOADED:"nextShowLoaded",LAYOUT_COLUMNS_CHANGED:"layoutColumnsChanged",MOBILE_AD_DISPLAY_CHANGE:"mobileAdDisplayChange",MOBILE_AD_BEFORE_UPDATE:"mobileAdBeforeUpdate",MOBILE_AD_UPDATED:"mobileAdUpdated",DESKTOP_AD_UPDATED:"desktopAdUpdated",NEXT_SHOW_DISPLAY_CHANGE:"nextShowDisplayChange",INPUT_KEY_LEFT:"inputKeyLeft",INPUT_KEY_RIGHT:"inputKeyRight",INPUT_KEY_SPACE:"inputKeySpace",INPUT_KEY_ESCAPE:"inputKeyEscape",INPUT_KEY_UP:"inputKeyUp",INPUT_KEY_DOWN:"inputKeyDown",SLIDESHOW_STARTED:"slideshowStarted",SLIDESHOW_ENDED:"slideshowEnded"}),angular.module("app.show").controller("ShowsCollectionController",["$scope","EventManager","AuthEvents","CollectionEvent","CollectionService","CollectionPageManagerService","CollectionViewService","CollectionAdMobileService","CollectionAdDesktopService","CollectionImageLoaderService","CollectionSlideshowService","CollectionZoomService","CollectionUrlService","CollectionSingleColumnService","CollectionKeyboardNavigationService","CollectionNextShowService",function($scope,EventManager,AuthEvents,CollectionEvent,CollectionService,CollectionPageManagerService,CollectionViewService,CollectionAdMobileService,CollectionAdDesktopService,CollectionImageLoaderService,CollectionSlideshowService,CollectionZoomService,CollectionUrlService,CollectionSingleColumnService,CollectionKeyboardNavigationService,CollectionNextShowService){"use strict";var mobileAdEnabled="false"!==$scope.mobileAdEnabled;$scope.baseTitle=$scope.baseTitle||"",$scope.initialView=$scope.initialView||"slideshow",$scope.initialLook=$scope.initialLook||null,$scope.profileId=$scope.profileId||null,$scope.seasonKey=$scope.seasonKey||null,$scope.seasonUrl=$scope.seasonUrl||null,$scope.seasonTitle=$scope.seasonTitle||null,$scope.weekKey=$scope.weekKey||null,$scope.brandKey=$scope.brandKey||null,$scope.brandUrl=$scope.brandUrl||null,$scope.brandTitle=$scope.brandTitle||null,$scope.useUrlManipulation=$scope.useUrlManipulation||"true",$scope.slideshowDelayMs=$scope.slideshowDelayMs||5e3,$scope.isLoaded=!1,$scope.isSlideshow=!1,$scope.isGrid=!1,$scope.nextShow=null,$scope.totalLooks=0,CollectionUrlService.useUrlManipulation("true"===$scope.useUrlManipulation),EventManager.on(CollectionEvent.LOADED,function(){$scope.isLoaded=!0,$scope.totalLooks=CollectionService.getHighestLookNumber(),CollectionUrlService.update()}),EventManager.on(CollectionEvent.VIEW_CHANGED,function(data){$scope.isSlideshow=CollectionViewService.isSlideshow(),$scope.isGrid=CollectionViewService.isGrid(),$scope.isGallery=CollectionViewService.isGallery(),CollectionSlideshowService.stop(),CollectionAdDesktopService.hasFetchedAd()||CollectionAdDesktopService.update()}),EventManager.on(CollectionEvent.LOOK_CHANGED,function(data){$scope.activeLook=data.activeLook,$scope.isLastLook=data.isLastLook,$scope.isFirstLook=data.isFirstLook,CollectionNextShowService.update(),CollectionAdDesktopService.update(),mobileAdEnabled&&CollectionAdMobileService.update()}),EventManager.on(CollectionEvent.PAGE_CHANGED,function(data){CollectionUrlService.update()}),EventManager.on(CollectionEvent.SHOW_LOADED,function(show){$scope.show=show}),EventManager.on(CollectionEvent.NEXT_SHOW_LOADED,function(nextShow){$scope.nextShow=nextShow}),EventManager.on(CollectionEvent.LAYOUT_COLUMNS_CHANGED,function(data){$scope.isSingleColumn=data.isSingleColumn}),EventManager.on(CollectionEvent.INPUT_KEY_LEFT,function(){EventManager.emit(CollectionEvent.REQUEST_PREVIOUS_LOOK,{})}),EventManager.on(CollectionEvent.INPUT_KEY_RIGHT,function(){EventManager.emit(CollectionEvent.REQUEST_NEXT_LOOK,{})}),EventManager.on(CollectionEvent.REQUEST_NEXT_LOOK,function(){return CollectionSingleColumnService.isSingleColumn()&&CollectionAdMobileService.isDisplayingAd()?void CollectionAdMobileService.closeAd():CollectionSingleColumnService.isSingleColumn()&&CollectionService.isLastLook()?void CollectionNextShowService.showInSingleColumnMode(!0):void CollectionPageManagerService.changeToNextLook()}),EventManager.on(CollectionEvent.REQUEST_PREVIOUS_LOOK,function(){return CollectionSingleColumnService.isSingleColumn()&&CollectionAdMobileService.isDisplayingAd()?void CollectionAdMobileService.closeAd():CollectionNextShowService.isShowingInSingleColumnMode()?void CollectionNextShowService.showInSingleColumnMode(!1):void CollectionPageManagerService.changeToPreviousLook()}),EventManager.on(CollectionEvent.REQUEST_SPECIFIC_LOOK,function(index){CollectionPageManagerService.changeLookIndexTo(index)}),EventManager.on(CollectionEvent.INPUT_KEY_SPACE,function(){CollectionZoomService.isZoomed()?CollectionZoomService.zoomOut():(CollectionViewService.isSlideshow()||CollectionViewService.isGallery())&&CollectionZoomService.zoomIn()}),EventManager.on(CollectionEvent.INPUT_KEY_ESCAPE,function(){CollectionZoomService.zoomOut()}),EventManager.on(CollectionEvent.MOBILE_AD_DISPLAY_CHANGE,function(data){$scope.isDisplayingMobileAd=data.isDisplayingAd}),EventManager.on(CollectionEvent.NEXT_SHOW_DISPLAY_CHANGE,function(data){$scope.isDisplayingNextShowComponent=data.isDisplaying&&$scope.nextShow}),CollectionUrlService.setBaseTitle($scope.baseTitle),CollectionUrlService.setLookPath($scope.baseUrlLook),CollectionUrlService.setGridPath($scope.baseUrlGrid),CollectionUrlService.setGalleryPath($scope.baseUrlGallery),CollectionAdDesktopService.getUrlFromDom($scope.adUnitDesktopClass),CollectionAdMobileService.getUrlFromDom($scope.adUnitMobileClass),CollectionImageLoaderService.addSizeContainerMapping("default",".js-standard-image-size-measurement-anchor"),CollectionImageLoaderService.addSizeContainerMapping("zoom","body"),CollectionPageManagerService.changeViewTo($scope.initialView),CollectionSlideshowService.setDuration($scope.slideshowDelayMs),CollectionService.initialise($scope.profileId,$scope.seasonKey,$scope.weekKey,$scope.brandKey,$scope.initialLook,$scope.previewKey,$scope.previewId)}]),angular.module("app.show").directive("showGridSearch",["ShowSearchService","EventManager","ShowEvents","DataService","PaginationService",function(ShowSearchService,EventManager,ShowEvents,DataService,PaginationService){"use strict";return{templateUrl:"/templates/Shows/show_grid_search",replace:!0,restrict:"E",scope:{isolate:"@"},link:function(scope){var lock=!1,filters={offset:0,limit:10,sort:"DESC",colors:[{id:1,color:"#FF0000",selected:!0},{id:2,color:"#FFFF00",selected:!1}],tags:[]},allowedEventFilters=["tags","colors"];scope.handleSearch=function(loadMore){var filtersCopy={};lock||(lock=!0,loadMore||PaginationService.reset(filters),filtersCopy=angular.copy(filters),filtersCopy.colors=DataService.filterExtract(filtersCopy.colors,"selected","id"),filtersCopy.tags=DataService.filterExtract(filtersCopy.tags,"selected","id"),ShowSearchService.search(filtersCopy).then(function(data){scope.result=loadMore?scope.result.concat(data.result):data.result,filters=angular.extend(filters,data.filters),ShowSearchService.dispatchFiltersData(data.filters,allowedEventFilters),lock=!1}))},scope.handleLoadMore=function(){PaginationService.nextPage(filters),scope.handleSearch(!0)},EventManager.on(ShowEvents.GENERIC,function(data){filters=angular.extend(filters,data),scope.handleSearch()}),scope.handleSearch()}}}]).directive("showGridColors",["EventManager","ShowEvents",function(EventManager,ShowEvents){"use strict";return{templateUrl:"/templates/Shows/show_grid_colors",replace:!0,restrict:"E",scope:{isolate:"@"},link:function(scope){scope.data=[],scope.toggle=function(item){item.status=!item.status,EventManager.emit(ShowEvents.BASE,{colors:scope.data},!0)},EventManager.on(ShowEvents.COLORS_CHANGED,function(data){scope.data=data})}}}]).directive("showGridTags",["EventManager","ShowEvents",function(EventManager,ShowEvents){"use strict";return{templateUrl:"/templates/Shows/show_grid_tags",replace:!0,restrict:"E",scope:{isolate:"@"},link:function(scope){scope.data=[],scope.toggle=function(item){item.status=!item.status,EventManager.emit(ShowEvents.BASE,{tags:scope.data},!0)},EventManager.on(ShowEvents.TAGS_CHANGED,function(data){scope.data=data})}}}]),angular.module("app.show").directive("showsCollection",["$document","$window",function($document,$window){"use strict";return{templateUrl:"/templates/Shows/collection",replace:!0,restrict:"E",scope:{profileId:"@",startDatetime:"@",seasonKey:"@",seasonUrl:"@",seasonTitle:"@",weekKey:"@",brandKey:"@",brandUrl:"@",brandTitle:"@",baseUrlLook:"@",baseUrlGrid:"@",baseUrlGallery:"@",baseTitle:"@",reviewUrl:"@",initialView:"@",initialLook:"@",slideshowDelayMs:"@",adUnitDesktopClass:"@",adUnitMobileClass:"@",previewKey:"@",previewId:"@",useUrlManipulation:"@",mobileAdEnabled:"@"},controller:"ShowsCollectionController"}}]),angular.module("app.show").directive("showsCollectionAdDesktop",["EventManager","CollectionEvent","CollectionViewService","CollectionAdDesktopService",function(EventManager,CollectionEvent,CollectionViewService,CollectionAdDesktopService){"use strict";return{templateUrl:"/templates/Shows/collection_ad_desktop",replace:!0,restrict:"E",scope:{adUnitZoneName:"@"},controller:["$scope",function($scope){var self=this;this.listenerIds=[],this.listenerIds.push(EventManager.on(CollectionEvent.DESKTOP_AD_UPDATED,function(data){var image=data.image,url=data.url;$scope.url=url,$scope.image=image})),$scope.$on("$destroy",function(){angular.forEach(self.listenerIds,function(removeListenerCallback){removeListenerCallback()})})}],link:function(scope,element,attrs){}}}]),angular.module("app.show").directive("showsCollectionAdMobile",["$sce","EventManager","CollectionEvent","CollectionAdMobileService",function($sce,EventManager,CollectionEvent,CollectionAdMobileService){"use strict";return{templateUrl:"/templates/Shows/collection_ad_mobile",replace:!0,restrict:"E",scope:{adUnitZoneName:"@"},controller:["$scope",function($scope){var self=this;this.listenerIds=[],this.listenerIds.push(EventManager.on(CollectionEvent.MOBILE_AD_UPDATED,function(data){var image=data.image,url=data.url;$scope.image=image,$scope.url=url})),this.listenerIds.push(EventManager.on(CollectionEvent.MOBILE_AD_BEFORE_UPDATE,function(){$scope.image="",$scope.url=""})),$scope.$on("$destroy",function(){angular.forEach(self.listenerIds,function(removeListenerCallback){removeListenerCallback()})})}],link:function(scope,element,attrs){}}}]),angular.module("app.show").directive("showsCollectionControls",["$timeout","EventManager","DomService","CollectionEvent","CollectionPageManagerService","CollectionService","CollectionViewService","CollectionSlideshowService",function($timeout,EventManager,DomService,CollectionEvent,CollectionPageManagerService,CollectionService,CollectionViewService,CollectionSlideshowService){"use strict";return{templateUrl:"/templates/Shows/collection_controls",replace:!0,restrict:"E",scope:{},controller:["$scope",function($scope){$scope.switchToGallery=function(){CollectionPageManagerService.changeViewTo("gallery")},$scope.switchToGrid=function(){CollectionPageManagerService.changeViewTo("grid")},$scope.switchToSlideshow=function(){CollectionPageManagerService.changeViewTo("slideshow")},$scope.toggleAutoPlayback=function(){CollectionViewService.isSlideshow()||CollectionPageManagerService.changeViewTo("slideshow"),CollectionSlideshowService.toggle()},EventManager.on(CollectionEvent.VIEW_CHANGED,function(data){$scope.isSlideshow=CollectionViewService.isSlideshow(),$scope.isGrid=CollectionViewService.isGrid(),$scope.isGallery=CollectionViewService.isGallery()}),EventManager.on(CollectionEvent.SLIDESHOW_STARTED,function(){$scope.isPlaying=!0}),EventManager.on(CollectionEvent.SLIDESHOW_ENDED,function(){$scope.isPlaying=!1})}],link:function(scope,element,attrs){var positionControls=(DomService.getElement(".js-shows-collection-meta-column"),DomService.getElement(".js-shows-collection-main-column"),function(){});DomService.bind("resize scroll",function(){$timeout(positionControls)}),EventManager.on(CollectionEvent.VIEW_CHANGED,function(){$timeout(positionControls)})}}}]),angular.module("app.show").directive("showsCollectionImagesGallery",["_","$timeout","DomService","EventManager","CollectionEvent","CollectionService","CollectionZoomService","CollectionDownloadService",function(_,$timeout,DomService,EventManager,CollectionEvent,CollectionService,CollectionZoomService,CollectionDownloadService){"use strict";return{templateUrl:"/templates/Shows/collection_images_gallery",replace:!0,restrict:"E",scope:{},link:function(scope,element,attrs){var imageWidth=0;scope.hasLaidOut=!1,scope.next=function(){EventManager.emit(CollectionEvent.REQUEST_NEXT_LOOK,{})},scope.previous=function(){EventManager.emit(CollectionEvent.REQUEST_PREVIOUS_LOOK,{})},scope.zoomIn=function(){CollectionZoomService.zoomIn()},scope.download=function(event){event.stopPropagation(),CollectionDownloadService.download()},scope.goToIndex=function(index){scope.index!=index&&EventManager.emit(CollectionEvent.REQUEST_SPECIFIC_LOOK,index)},DomService.setBodyScroll(0),DomService.setBodyScroll(0);var position=function(){var seasonBrandElement=DomService.getElement(".js-shows-collection-title"),metaColumnElement=DomService.getElement(".js-shows-collection-meta-column"),controlsElement=DomService.getElement(".js-shows-controls");if(_.isEmpty(controlsElement)||_.isEmpty(seasonBrandElement)||_.isEmpty(metaColumnElement)||!scope.show)return void setTimeout(position,300);var seasonBrandRect=DomService.getRect(seasonBrandElement[0]),metaColumnRect=DomService.getRect(metaColumnElement[0]),controlsRect=DomService.getRect(controlsElement[0]),scrollY=window.scrollY||window.pageYOffset,top=seasonBrandRect.bottom+scrollY,bottom=metaColumnRect.top+metaColumnRect.height-controlsRect.height+scrollY,height=Math.floor(bottom-top-50);imageWidth=Math.round(height/1.5),element.css({top:top+25+"px",height:height+"px"}),DomService.getElements(".shows-view-gallery__img").css({width:imageWidth+"px",height:height+"px"});var containerWidth=(imageWidth+40)*scope.show.images.length;DomService.getElement(".shows-view-gallery__items").css({width:containerWidth+"px"});var windowWidth=document.body.offsetWidth,centerUnderlayWidth=imageWidth+40,centerUnderlayOffset=Math.round(windowWidth/2-centerUnderlayWidth/2);DomService.getElement(".shows-view-gallery__underlay").css({width:centerUnderlayWidth+"px",height:height+150+"px",left:centerUnderlayOffset+"px"}),DomService.getElement(".shows-view-gallery__overlay").css({width:imageWidth+"px",height:height-40+"px",bottom:"40px"}),updateActiveLookOffset()},updateActiveLookOffset=function(){var underlayElm=DomService.getElement(".shows-view-gallery__underlay"),left=parseInt(underlayElm.css("left")),offsetFromLeftToCentreColumn=left+20,offsetForEachItem=(imageWidth+20)*scope.index,offset=offsetFromLeftToCentreColumn-offsetForEachItem,translateString="translate("+offset+"px)";DomService.getElement(".shows-view-gallery__items").css({"-webkit-transform":translateString,"-moz-transform":translateString,"-o-transform":translateString,"-ms-transform":translateString,transform:translateString}),scope.hasLaidOut=!0};scope.updateActiveLookOffset=updateActiveLookOffset,EventManager.on(CollectionEvent.SHOW_LOADED,function(show){scope.show=show,scope.totalLooks=CollectionService.getHighestLookNumber()}),EventManager.on(CollectionEvent.LOOK_CHANGED,function(show){scope.activeLook=show.activeLook,scope.index=show.indexNow,scope.isFirstLook=show.isFirstLook,scope.isLastLook=show.isLastLook,scope.updateActiveLookOffset()}),$timeout(position,300),DomService.bind("scroll resize",position)}}}]),angular.module("app.show").directive("showsCollectionImagesGrid",["$timeout","EventManager","DomService","CollectionEvent","CollectionPageManagerService","CollectionService","CollectionZoomService",function($timeout,EventManager,DomService,CollectionEvent,CollectionPageManagerService,CollectionService,CollectionZoomService){"use strict";return{templateUrl:"/templates/Shows/collection_images_grid",replace:!0,restrict:"E",scope:{},controller:["$scope",function($scope){$scope.gridToSlideshow=function(index){CollectionPageManagerService.changeViewAndIndexTo("slideshow",index)},$scope.gridToZoom=function(index){CollectionPageManagerService.changeLookIndexTo(index),CollectionZoomService.zoomIn()},EventManager.on(CollectionEvent.SHOW_LOADED,function(show){$scope.show=show})}],link:function(scope,element,attrs){!function(animate){$timeout(function(){var activeIndex=CollectionService.getLookIndex(),activeItemElm=DomService.getElementById("shows-grid-item-"+activeIndex);activeIndex>0&&DomService.scrollToElement(activeItemElm,100,0),animate&&activeItemElm.removeClass("fx-flash").addClass("fx-flash")})}(!0)}}}]),angular.module("app.show").directive("showsCollectionImagesSingle",["DomService","EventManager","CollectionEvent","CollectionService","CollectionZoomService","CollectionDownloadService",function(DomService,EventManager,CollectionEvent,CollectionService,CollectionZoomService,CollectionDownloadService){"use strict";return{templateUrl:"/templates/Shows/collection_images_single",replace:!0,restrict:"E",scope:{adUnitZoneName:"@"},link:function(scope,element,attrs){scope.next=function(){EventManager.emit(CollectionEvent.REQUEST_NEXT_LOOK,{})},scope.previous=function(){EventManager.emit(CollectionEvent.REQUEST_PREVIOUS_LOOK,{})},scope.zoomIn=function(){CollectionZoomService.zoomIn()},scope.download=function(event){event.stopPropagation(),CollectionDownloadService.download()},EventManager.on(CollectionEvent.LAYOUT_COLUMNS_CHANGED,function(data){scope.isSingleColumn=data.isSingleColumn}),EventManager.on(CollectionEvent.LOOK_CHANGED,function(data){scope.activeLook=data.activeLook,scope.isFirstLook=data.isFirstLook,scope.isLastLook=data.isLastLook}),EventManager.on(CollectionEvent.MOBILE_AD_DISPLAY_CHANGE,function(data){scope.isDisplayingMobileAd=data.isDisplayingAd}),EventManager.on(CollectionEvent.SHOW_LOADED,function(show){scope.show=show}),EventManager.on(CollectionEvent.NEXT_SHOW_LOADED,function(nextShow){scope.nextShow=nextShow}),EventManager.on(CollectionEvent.NEXT_SHOW_DISPLAY_CHANGE,function(data){scope.isDisplayingNextShow=data.isDisplaying}),DomService.setBodyScroll(0)}}}]),angular.module("app.show").directive("showsCollectionNext",function(){"use strict";return{templateUrl:"/templates/Shows/collection_next",replace:!0,restrict:"E",scope:!0,controller:["$scope",function($scope){}],link:function(scope,element,attrs){}}}),angular.module("app.show").directive("showsCollectionShare",function(){"use strict";return{templateUrl:"/templates/Shows/collection_share",replace:!0,restrict:"E",scope:{},controller:["$scope","ImageService","EventManager","CollectionEvent","CollectionService","CollectionViewService","CollectionUrlService",function($scope,ImageService,EventManager,CollectionEvent,CollectionService,CollectionViewService,CollectionUrlService){this.assignShareImage=function(){var look=null,image=null;look=CollectionViewService.isGrid()?CollectionService.getLook(0):CollectionService.getActiveLook(),look&&(image=ImageService.getOpenRossImage(look.path,800,1200)),$scope.currentImage=image},EventManager.on(CollectionEvent.VIEW_CHANGED,this.assignShareImage),EventManager.on(CollectionEvent.LOOK_CHANGED,this.assignShareImage),EventManager.on(CollectionEvent.URL_CHANGED,function(data){$scope.currentUrl=data.url,$scope.currentTitle=data.title,$scope.currentCaption=data.caption}),EventManager.on(CollectionEvent.SHOW_LOADED,function(show){$scope.show=show})}],link:function(scope,element,attrs){}}}),angular.module("app.show").directive("showsCollectionSource",["_","EventManager","CollectionEvent","CollectionService","CollectionViewService",function(_,EventManager,CollectionEvent,CollectionService,CollectionViewService){"use strict";return{templateUrl:"/templates/Shows/collection_source",replace:!0,restrict:"E",scope:{showDate:"@"},controller:["$scope",function($scope){this.updateSource=function(){var prefixPlural=!1,source="",url=null;if(CollectionViewService.isGrid()){var show=CollectionService.getShow();source=show?show.asset_source:"",prefixPlural=!0}else{var look=CollectionService.getActiveLook();source=look?look.source:"",prefixPlural=!1}!_.isUndefined(source)&&source.match(/indigital/i)&&($scope.showDate<"2016-01-09 00:00:00"?(url="http://www.indigitalimages.com/",source="InDigital"):(url="http://www.indigital.tv/",source="INDIGITAL")),$scope.sourceTitle=source,$scope.sourcePrefixPlural=prefixPlural,$scope.sourceUrl=url},EventManager.on(CollectionEvent.VIEW_CHANGED,this.updateSource),EventManager.on(CollectionEvent.LOOK_CHANGED,this.updateSource)}],link:function(scope,element,attrs){}}}]),angular.module("app.show").directive("showsCollectionZoom",["EventManager","CollectionEvent","CollectionService","CollectionViewService","CollectionZoomService",function(EventManager,CollectionEvent,CollectionService,CollectionViewService,CollectionZoomService){"use strict";return{templateUrl:"/templates/Shows/collection_zoom",replace:!0,restrict:"E",scope:{},controller:["$scope","$element",function($scope,$element){var doScroll=function(offset){var elm=$element[0];elm.scrollTop=elm.scrollTop+offset};$scope.zoomOut=function(){CollectionZoomService.zoomOut()},$scope.next=function(){EventManager.emit(CollectionEvent.REQUEST_NEXT_LOOK,{})},$scope.previous=function(){EventManager.emit(CollectionEvent.REQUEST_PREVIOUS_LOOK,{})},EventManager.on(CollectionEvent.SHOW_LOADED,function(show){$scope.show=show,$scope.totalLooks=CollectionService.getHighestLookNumber()}),EventManager.on(CollectionEvent.LOOK_CHANGED,function(data){$scope.activeLook=data.activeLook,CollectionZoomService.loadZoomedImage()}),EventManager.on(CollectionEvent.ZOOMED_IN,function(){$scope.isZoomed=!0}),EventManager.on(CollectionEvent.ZOOMED_OUT,function(){$scope.isZoomed=!1}),EventManager.on(CollectionEvent.INPUT_KEY_UP,function(){CollectionZoomService.isZoomed()&&doScroll(-200)}),EventManager.on(CollectionEvent.INPUT_KEY_DOWN,function(){CollectionZoomService.isZoomed()&&doScroll(200)})}],link:function(scope,element,attrs){}}}]),angular.module("app.show").directive("showsDynamicSearch",["_","$window","ShowsTemplates","ShowDataApiFactory","DataService",function(_,$window,ShowsTemplates,ShowDataApiFactory,DataService){"use strict";return{templateUrl:ShowsTemplates.DYNAMIC_SEARCH,replace:!0,restrict:"E",scope:{seasonSlug:"@",brandSlug:"@"},link:function(scope,element,attrs){var showDataService=new ShowDataApiFactory;scope.season=null,scope.brand=null,scope.brands=[],scope.seasons=[],showDataService.getGroupedSeasonsAndBrandsGrouped().then(function(res){return _.map(res.data.seasons,function(item){item.showItem=!0}),_.map(res.data.brands,function(item){item.showItem=!0}),scope.seasons=res.data.seasons,scope.brands=res.data.brands,res}).then(function(){scope.seasonSlug&&!scope.brandSlug?(scope.season=_.find(scope.seasons,["slug",scope.seasonSlug]),scope.filterBrands()):!scope.seasonSlug&&scope.brandSlug?(scope.brand=_.find(scope.brands,["slug",scope.brandSlug]),scope.filterSeasons()):scope.seasonSlug&&scope.brandSlug&&(scope.season=_.find(scope.seasons,["slug",scope.seasonSlug]),scope.brand=_.find(scope.brands,["slug",scope.brandSlug]),scope.filterBrands())}),scope.goToSearch=function(){var urlQuery="";scope.season&&!scope.brand?urlQuery="season/"+scope.season.slug:!scope.season&&scope.brand?urlQuery="brand/"+scope.brand.slug:scope.season&&scope.brand&&(urlQuery=scope.season.slug+"/"+scope.brand.slug),$window.location.href="/fashion-week/"+urlQuery},scope.filterSeasons=function(){var id=scope.brand?scope.brand.id:0;DataService.filterCollectionBy(scope.seasons,"brands",id)},scope.filterBrands=function(){var id=scope.season?scope.season.id:0;DataService.filterCollectionBy(scope.brands,"seasons",id)}}}}]),angular.module("app.show").directive("showsLoadMore",["ShowService","PaginationService",function(ShowService,PaginationService){"use strict";return{templateUrl:"/templates/Shows/show_event",replace:!0,restrict:"E",scope:{season:"@",week:"@",label:"@",offset:"@",limit:"@",type:"@",gridClass:"@"},link:function(scope,element,attrs){var lock=!1,selectedType=scope.type||"week",filters={offset:parseInt(scope.offset)||6,limit:parseInt(scope.limit)||6};scope.items=[],scope.enabled=!0,scope.loading=!1,scope.gridCss=scope.gridClass||"col-md-4 col-xs-12",scope.loadMore=function(){lock||(lock=!0,scope.loading=!0,ShowService.getByType(selectedType)(scope.season,scope.week,filters).then(function(res){var items=[],item=null;for(var key in res.data)item=res.data[key],items.push(item);scope.enabled=PaginationService.isEnabled(filters,items.length),scope.items=scope.items.concat(items),PaginationService.nextPage(filters),scope.loading=!1,lock=!1}))}}}}]),angular.module("app.show").directive("showsReviewReadLimit",["EventManager","ShowsReviewReadLimit","ShowEvents",function(EventManager,ShowsReviewReadLimit,ShowEvents){"use strict";return{restrict:"E",template:'<div class="relative"><div ng-transclude ng-class="{\'article-locked\': !status}"></div><div ng-if="!status" class="article-locked-overlay"></div></div>',transclude:!0,replace:!0,scope:{store:"@",limit:"@",source:"@",text:"@"},link:function(scope){var currentUser=null,limit=parseInt(scope.limit,10)||3,store=scope.store||"show_hide_token",views=ShowsReviewReadLimit.getMonthlyViews(store);scope.status=!0,scope.emitChange=function(status){scope.status=status,EventManager.emit(ShowEvents.REVIEW_READ_LIMIT,{status:status})},EventManager.on("userDataChanged",function(user){currentUser=user,views<=limit||user.id?scope.emitChange(!0):scope.emitChange(!1)})}}}]).directive("showsReviewReadLimitButton",["EventManager","authModalService","ShowEvents",function(EventManager,authModalService,ShowEvents){"use strict";return{restrict:"E",template:'<div ng-show="!status" class="article-locked-button"><button class="btn btn-danger" ng-click="authorise($event)">{[{text}]}</button></div>',replace:!0,scope:{text:"@",source:"@"},link:function(scope){scope.status=!1,scope.authorise=function(event){authModalService.setSubscribeSource(scope.source),authModalService.openLogin("contentLimit",{firewall:!0}).then(function(){},function(){})},EventManager.on(ShowEvents.REVIEW_READ_LIMIT,function(res){scope.status=res.status})}}}]),angular.module("app.show").directive("showsSiteMenuItems",["$document","$window",function($document,$window){"use strict";return{template:'<li ng-repeat="show in items"><a menu-injector active="{{ $first }}" container="shows" categories="shows" view="featured-shows" season="{{ show.season }}" week="{{ show.week }}" class="no-uppercase" href="{{ show.url }}">{{ show.title }}</a></li>',replace:!0,restrict:"E",scope:{},link:function(scope,element,attrs){scope.items=[{title:"Spring 2016: New York",url:"/fashion-week/season/2016ss",season:"2016ss",week:"new-york-fashion-week"}]}}}]),function(){"use strict";function BrandApi($resource){return $resource("/xhr/shows/brand/:id",{id:"@id"},{getAll:{method:"GET"}})}BrandApi.$inject=["$resource"],angular.module("app.show").factory("BrandApi",BrandApi)}(),function(){"use strict";function SeasonApi($resource){return $resource("/xhr/shows/season/:id",{id:"@id"},{getAll:{method:"GET"}})}SeasonApi.$inject=["$resource"],angular.module("app.show").factory("SeasonApi",SeasonApi)}(),angular.module("app.show").factory("ShowDataApi",["$resource",function($resource){"use strict";return $resource("/xhr/shows/:action",{action:"@action"},{getAll:{method:"GET"}})}]).factory("ShowDataApiFactory",["_","ShowDataApi","DataService",function(_,ShowDataApi,DataService){"use strict";function Factory(params){var apiParams=params;this.getGroupedSeasonsAndBrandsGrouped=function(filters){return ShowDataApi.getAll(_.assign({action:"grouped-seasons-and-brands"},apiParams)).$promise}}return Factory}]),function(){"use strict";function ShowApi($resource){return $resource("/xhr/shows/season/:season/brand/:brand/:previewKey/:previewId",{},{getNextShow:{method:"GET",url:"/xhr/shows/:profileId/next"},getBySeasonWeek:{method:"GET",url:"/xhr/shows/season/:season/week/:week"},getFeaturedShows:{method:"GET",url:"/xhr/shows/featured",params:{season:"season",week:"week"}},getAll:{method:"GET",url:"/xhr/shows"}})}ShowApi.$inject=["$resource"],angular.module("app.show").factory("ShowApi",ShowApi)}(),function(){"use strict";function ShowSearchApi($resource){return $resource("/xhr/shows/search",{},{getAll:{method:"GET"}})}ShowSearchApi.$inject=["$resource"],angular.module("app.show").factory("ShowSearchApi",ShowSearchApi)}(),angular.module("app.show").service("BrandService",["DataService","BrandApi",function(DataService,BrandApi){"use strict";this.getAll=function(removePrefix){return BrandApi.getAll().$promise.then(function(res){return res.data=DataService.normalise(res.data,removePrefix),res})}}]),angular.module("app.show").service("CollectionAdDesktopService",["$http","EventManager","CollectionEvent","CollectionService","CollectionViewService","CollectionSingleColumnService","CollectionAdService","doubleClickService",function($http,EventManager,CollectionEvent,CollectionService,CollectionViewService,CollectionSingleColumnService,CollectionAdService,doubleClickService){"use strict";var self=this;this._url=null,this._hasFetchedAd=!1,this.getUrlFromDom=function(cls){this._url=CollectionAdService.extractUrlFromDom(cls)},this.hasFetchedAd=function(){return self._hasFetchedAd},this.update=function(){var isSlideshow="slideshow"==CollectionViewService.getView(),isNotMobileMode=!CollectionSingleColumnService.isSingleColumn(),isNotLastLookAndHasNextShow=!(CollectionService.isLastLook()&&CollectionService.getNextShow());isSlideshow&&isNotMobileMode&&isNotLastLookAndHasNextShow&&self._refresh()},this._refresh=function(){this._hasFetchedAd=!0,doubleClickService.refreshAdvert("div-gpt-ad-shows-collection-look-right")}}]),angular.module("app.show").service("CollectionAdMobileService",["$http","EventManager","CollectionEvent","CollectionService","CollectionViewService","CollectionAdService","CollectionSingleColumnService","doubleClickService",function($http,EventManager,CollectionEvent,CollectionService,CollectionViewService,CollectionAdService,CollectionSingleColumnService,doubleClickService){"use strict";var self=this;this.url=null,this._isDisplayingAd=!1,this.getUrlFromDom=function(cls){this.url=CollectionAdService.extractUrlFromDom(cls)},this._refresh=function(){EventManager.emit(CollectionEvent.MOBILE_AD_BEFORE_UPDATE,{}),doubleClickService.refreshAdvert("div-gpt-ad-shows-collection-look-mobile")},this.isDisplayingAd=function(){return self._isDisplayingAd},this.closeAd=function(){self._isDisplayingAd=!1,EventManager.emit(CollectionEvent.MOBILE_AD_DISPLAY_CHANGE,{isDisplayingAd:self.isDisplayingAd()})},this.update=function(){var previous=self._isDisplayingAd;return CollectionSingleColumnService.isSingleColumn()&&CollectionViewService.isSlideshow()?((CollectionService.getLookIndex()+1)%5!=0||CollectionService.isLastLook()?self._isDisplayingAd=!1:(self._refresh(),self._isDisplayingAd=!0),void(previous!=self._isDisplayingAd&&EventManager.emit(CollectionEvent.MOBILE_AD_DISPLAY_CHANGE,{isDisplayingAd:self.isDisplayingAd()}))):void(self._isDisplayingAd=!1)}}]),angular.module("app.show").service("CollectionAdService",["$http","DomService","$q",function($http,DomService,$q){"use strict";this.extractUrlFromDom=function(cls){return DomService.getElement("."+cls+" [data-ad-url]").attr("data-ad-url")},this.requestNewAd=function(url){if(url){var cachebust=1e18*Math.random();return url=url.replace("INSERT_RANDOM_NUMBER_HERE",cachebust),$http.get(url)}return $q.defer().promise}}]),angular.module("app.show").service("CollectionDownloadService",["_","$rootScope","EventManager","DomService","CollectionEvent","CollectionService","CollectionImageLoaderService","CollectionViewService","ImageService","$window","DownloadService","UrlService","$base64",function(_,$rootScope,EventManager,DomService,CollectionEvent,CollectionService,CollectionImageLoaderService,CollectionViewService,ImageService,$window,DownloadService,UrlService,$base64){"use strict";var current=null,show=null;this.download=function(){var imageUrl,fileType,uniqueId,fileName,downloadFilename;current=CollectionService.getActiveLook(),show=CollectionService.getShow(),current&&(imageUrl=ImageService.getOpenRossImage(current.path,1200,1800,"magic"),fileType=_.last(current.path.split(".")),uniqueId=_.snakeCase(show.brand)+"_"+_.snakeCase(current.caption)+"_"+_.snakeCase(show.season_slug),downloadFilename=uniqueId+"."+fileType,fileName=imageUrl+"&dl="+downloadFilename,DownloadService.downloadFile(fileName,downloadFilename))}}]),angular.module("app.show").service("CollectionImageLoaderService",["ImageService","DomService","$window","$timeout",function(ImageService,DomService,$window,$timeout){"use strict";var _sizeContainers={},images={};this.addSizeContainerMapping=function(size,containerSelector){_sizeContainers[size]=$window.document.querySelector(containerSelector)},this.load=function(path,size,callback){if(!this.isValidSize(size))throw new Error("Invalid size:",size);var image=this._getImage(path,size);if(image)return void(image.loaded&&$timeout(angular.bind(this,function(){callback(this._getImage(path,size).src)})));var src=ImageService.getOpenRossImage(path,10,15,"magic"),sizedSrc=ImageService.getImage(src,this._getSize(size));path in images||(images[path]={}),images[path][size]={src:sizedSrc,loaded:!1};var img=new Image;img.onload=function(){images[path][size].loaded=!0,callback(sizedSrc)},img.src=sizedSrc},this.isValidSize=function(size){return size in _sizeContainers},this.hasImageLoaded=function(path,size){if(!this.isValidSize(size))throw new Error("Invalid size:",size);var image=this._getImage(path,size);return!(!image||!image.loaded)},this._getImage=function(path,size){return images[path]&&images[path][size]?images[path][size]:null},this._getSize=function(size){var containerWidth=DomService.getWidth(_sizeContainers[size]);return containerWidth=100*Math.ceil(containerWidth/100),containerWidth=Math.min(containerWidth,3e3)}}]),angular.module("app.show").service("CollectionKeyboardNavigationService",["$evalAsync","DomService","EventManager","CollectionEvent",function($evalAsync,DomService,EventManager,CollectionEvent){"use strict";DomService.bind("keydown",function(event){switch(event.keyCode){case 37:$evalAsync(function(){EventManager.emit(CollectionEvent.INPUT_KEY_LEFT,{})});break;case 39:$evalAsync(function(){EventManager.emit(CollectionEvent.INPUT_KEY_RIGHT,{})});break;case 38:$evalAsync(function(){EventManager.emit(CollectionEvent.INPUT_KEY_UP,{})});break;case 40:$evalAsync(function(){EventManager.emit(CollectionEvent.INPUT_KEY_DOWN,{})});break;case 32:$evalAsync(function(){EventManager.emit(CollectionEvent.INPUT_KEY_SPACE,{})});break;case 27:$evalAsync(function(){EventManager.emit(CollectionEvent.INPUT_KEY_ESCAPE,{})});break;default:return}event.preventDefault()})}]),angular.module("app.show").service("CollectionNextShowService",["EventManager","CollectionEvent","CollectionService","CollectionViewService","CollectionSingleColumnService",function(EventManager,CollectionEvent,CollectionService,CollectionViewService,CollectionSingleColumnService){"use strict";var self=this;this._isShowing=!1,this._isShowingInSingleColumnMode=!1,this.isShowingInSingleColumnMode=function(){return self._isShowingInSingleColumnMode},this.showInSingleColumnMode=function(bool){self._isShowingInSingleColumnMode=bool,self.update()},this.update=function(){var previous=self._isShowing,next=!1;CollectionViewService.isSlideshow()&&CollectionService.getNextShow()||(next=!1),next=CollectionSingleColumnService.isSingleColumn()?self._isShowingInSingleColumnMode:CollectionService.isLastLook(),self._isShowing=next,previous!=self._isShowing&&EventManager.emit(CollectionEvent.NEXT_SHOW_DISPLAY_CHANGE,{isDisplaying:self._isShowing})}}]),angular.module("app.show").service("CollectionPageManagerService",["EventManager","CollectionEvent","CollectionService","CollectionViewService",function(EventManager,CollectionEvent,CollectionService,CollectionViewService){"use strict";var self=this;this.lastIndex=null,this.lastView=null,this.changeLookIndexTo=function(index){self.lastIndex!==index&&(self.lastIndex=index,CollectionService.setLookIndex(index,!0),self._emitChangeEvent())},this.changeViewTo=function(view){self.lastView!=view&&(self.lastView=view,CollectionViewService.setView(view),self._emitChangeEvent())},this.changeViewAndIndexTo=function(view,index){self.lastIndex===index&&self.lastView===view||(CollectionViewService.setView(view),CollectionService.setLookIndex(index,!0),self.lastIndex=index,self.lastView=view,self._emitChangeEvent())},this.changeToNextLook=function(){CollectionService.setNextLook(!0),self._emitChangeEvent()},this.changeToPreviousLook=function(){CollectionService.setPreviousLook(!0),self._emitChangeEvent()},this._emitChangeEvent=function(){EventManager.emit(CollectionEvent.PAGE_CHANGED,{index:CollectionService.getLookIndex(),view:CollectionViewService.getView()})}}]),angular.module("app.show").service("CollectionService",["$rootScope","$log","DomService","EventManager","ShowService","CollectionEvent","CollectionImageLoaderService","CollectionSingleColumnService",function($rootScope,$log,DomService,EventManager,ShowService,CollectionEvent,CollectionImageLoaderService,CollectionSingleColumnService){"use strict";var self=this;this.show=null,this.images=[],this.nextShow=null,this.lookIndex=null,this._showNextShowInSingleColumnMode=!1,this.initialise=function(profileId,seasonKey,weekKey,brandKey,activeLook,previewKey,previewId){ShowService.getShow(seasonKey,brandKey,previewKey,previewId).then(function(res){if(res&&!res.error){var data=res.data,images=res.data.assets.filter(function(image){return"show-look"==image.type}),show={images:images,profile_id:data.profile_id,profile_title:data.profile_title,asset_source:data.show_asset_source,tags:data.tags,is_reviewed:data.is_reviewed,review_author:data.show_review_author,brand:data.show_brand_title,season_slug:data.show_season_slug};self.setShowData(show),self.setLookIndex(activeLook,!0);for(var descIndex=self.lookIndex,ascIndex=descIndex+1,optimisedImageOrder=[],i=0,ilen=images.length;i<ilen&&!(descIndex<0&&ascIndex>ilen);i++)descIndex>=0&&(optimisedImageOrder.push(images[descIndex]),descIndex--),ascIndex<ilen&&(optimisedImageOrder.push(images[ascIndex]),ascIndex++);optimisedImageOrder.forEach(function(image){CollectionImageLoaderService.load(image.path,"default",function(src){$rootScope.$apply(function(){image.standardSrc=src})})}),EventManager.emit(CollectionEvent.LOADED,{})}}),ShowService.getNextShow(profileId,seasonKey,weekKey).then(function(res){if(res&&!res.error&&res.data){var nextShow=res.data;self.setNextShowData(nextShow),CollectionImageLoaderService.load(nextShow.thumbnail.path,"default",function(src){$rootScope.$apply(function(){nextShow.standardThumbnailSrc=src})})}})},this.getActiveLook=function(){return self.images&&self.images.length&&null!==self.lookIndex?self.images[self.lookIndex]:null},this.getLook=function(index){return null!==self.lookIndex&&self.images.length&&index<self.images.length?self.images[index]:null},this.getActiveCaption=function(){var look=self.getActiveLook();return look?look.caption:""},this.getActiveLookNumber=function(){var look=self.getActiveLook();if(look)return parseInt(look.index,10)},this.getHighestLookNumber=function(){return self.images&&self.images.length?self.images[self.images.length-1].index:null},this.isFirstLook=function(){return 0===self.lookIndex},this.isLastLook=function(){return self.lookIndex===self.images.length-1},this.setNextShowData=function(nextShow){self.nextShow=nextShow,EventManager.emit(CollectionEvent.NEXT_SHOW_LOADED,nextShow)},this.getNextShow=function(){return self.nextShow},this.setLookIndex=function(index,iDefinitelyDontWantToUseThePageManagerServiceToDoThis){if(!iDefinitelyDontWantToUseThePageManagerServiceToDoThis)return void $log.warn("Attempted CollectionService index change without override. Should you be using CollectionPageManagerService?");var previous=self.lookIndex;self.lookIndex=parseInt(index,10),self.lookIndex>self.images.length-1&&(self.lookIndex=self.images.length-1),self.lookIndex<0&&(self.lookIndex=0),previous!=self.lookIndex&&EventManager.emit(CollectionEvent.LOOK_CHANGED,{activeLook:self.getActiveLook(),indexNow:self.lookIndex,indexPrevious:previous,isLastLook:self.isLastLook(),isFirstLook:self.isFirstLook()})},this.setNextLook=function(iDefinitelyDontWantToUseThePageManagerServiceToDoThis){this.setLookIndex(self.lookIndex+1,iDefinitelyDontWantToUseThePageManagerServiceToDoThis)},this.setPreviousLook=function(iDefinitelyDontWantToUseThePageManagerServiceToDoThis){this.setLookIndex(self.lookIndex-1,iDefinitelyDontWantToUseThePageManagerServiceToDoThis)},this.getLookIndex=function(){return self.lookIndex},this.setShowData=function(show){self.show=show,self.images=show.images,EventManager.emit(CollectionEvent.SHOW_LOADED,show)},this.getShow=function(){return self.show}}]),angular.module("app.show").service("CollectionSingleColumnService",["DomService","EventManager","CollectionEvent",function(DomService,EventManager,CollectionEvent){"use strict";var self=this;this._isSingleColumn=!1,this.isSingleColumn=function(){return self._isSingleColumn};var checkIfColumnNumberHasChanged=function(){var previous=self._isSingleColumn,now=DomService.getWidth()<=729;previous!=now&&(self._isSingleColumn=now,EventManager.emit(CollectionEvent.LAYOUT_COLUMNS_CHANGED,{isSingleColumn:now}))};DomService.bind("resize",checkIfColumnNumberHasChanged),checkIfColumnNumberHasChanged()}]),angular.module("app.show").service("CollectionSlideshowService",["$window","$interval","EventManager","CollectionEvent","CollectionPageManagerService","CollectionService","CollectionZoomService","CollectionViewService",function($window,$interval,EventManager,CollectionEvent,CollectionPageManagerService,CollectionService,CollectionZoomService,CollectionViewService){"use strict";var self=this;this._slideshowDuration=5e3,this._isPlaying=!1,this._autoPlayInterval=null,this.setDuration=function(durationMs){self._slideshowDuration=durationMs},this.isPlaying=function(){return self._isPlaying},this.start=function(){self.isPlaying()||(self._isPlaying=!0,self._autoPlayInterval=$interval(function(){if(!CollectionViewService.isSlideshow()||CollectionService.isLastLook())return void self.stop();CollectionZoomService.isZoomed()||(CollectionPageManagerService.changeToNextLook(),CollectionService.isLastLook()&&self.stop())},self._slideshowDuration),EventManager.emit(CollectionEvent.SLIDESHOW_STARTED,{}))},this.stop=function(){self.isPlaying()&&($interval.cancel(self._autoPlayInterval),self._isPlaying=!1,EventManager.emit(CollectionEvent.SLIDESHOW_ENDED,{}))},this.toggle=function(){self.isPlaying()?self.stop():self.start()}}]),angular.module("app.show").service("CollectionUrlService",["$window","DomService","EventManager","CollectionEvent","CollectionPageManagerService","CollectionService","CollectionViewService","CollectionZoomService","legacyTrackService",function($window,DomService,EventManager,CollectionEvent,CollectionPageManagerService,CollectionService,CollectionViewService,CollectionZoomService,legacyTrackService){"use strict";var self=this;this.baseTitle="",this.lookPath=null,this.galleryPath=null,this.gridPath=null,this.useManipulator=!0,this.lastView=null,this.lastLook=null,this.lastChangeWasPopState=!1,DomService.bind("popstate",function(event){if(event&&event.state){var view=event.state.view;event.state.look;self.lastChangeWasPopState=!0,CollectionPageManagerService.changeViewTo(view),CollectionZoomService.zoomOut()}}),this.getCurrentUrl=function(){return $window.location.toString()},this.setLookPath=function(path){self.lookPath=path},this.setGridPath=function(path){self.gridPath=path},this.setGalleryPath=function(path){self.galleryPath=path},this.setBaseTitle=function(title){self.baseTitle=title},this.getCurrentTitle=function(){var title=self.baseTitle;return(CollectionViewService.isSlideshow()||CollectionViewService.isGallery())&&(title+=" | "+self.getCurrentCaption()),title.trim()},this.getCurrentCaption=function(){return CollectionViewService.isSlideshow()||CollectionViewService.isGallery()?CollectionService.getActiveCaption():""},this.update=function(){var path,url,view=CollectionViewService.getView(),title=self.getCurrentTitle(),lookNumber=CollectionService.getActiveLookNumber();if((self.lastView!=view||self.lastLook!=lookNumber)&&("grid"==view||lookNumber)){path="grid"==view?self.gridPath:"gallery"==view?self.galleryPath+lookNumber:self.lookPath+lookNumber,url=$window.location.protocol+"//"+$window.location.host+path,$window.document.title=title;var method="replaceState";!self.lastChangeWasPopState&&self.lastView&&self.lastView!=view&&(method="pushState");var data={view:view,look:lookNumber};this.useManipulator&&$window.history[method](data,title,path),legacyTrackService.pageView(),EventManager.emit(CollectionEvent.URL_CHANGED,{title:title,url:url,caption:self.getCurrentCaption()}),self.lastChangeWasPopState=!1,self.lastView=view,self.lastLook=lookNumber}},this.useUrlManipulation=function(value){this.useManipulator=value}}]),angular.module("app.show").service("CollectionViewService",["EventManager","CollectionEvent","CollectionService","CollectionSingleColumnService",function(EventManager,CollectionEvent,CollectionService,CollectionSingleColumnService){"use strict";var self=this;this.view=null,this.setView=function(view){var previous=self.view,next=view;CollectionSingleColumnService.isSingleColumn()&&(next="slideshow"),self.view=next,previous!=self.view&&EventManager.emit(CollectionEvent.VIEW_CHANGED,{view:self.view,viewPrevious:previous,timestamp:Date.now(),sanityTimestamp:Math.random(0,9999)})},this.getView=function(){return self.view},this.isSlideshow=function(){return"slideshow"==self.view},this.isGrid=function(){return"grid"==self.view},this.isGallery=function(){return"gallery"==self.view}}]),angular.module("app.show").service("CollectionZoomService",["$rootScope","EventManager","DomService","CollectionEvent","CollectionService","CollectionImageLoaderService","CollectionViewService",function($rootScope,EventManager,DomService,CollectionEvent,CollectionService,CollectionImageLoaderService,CollectionViewService){"use strict";var self=this;this._isZoomed=!1,this.lastScrollPosition=null,this.isZoomed=function(){return self._isZoomed},this.zoomIn=function(){self.isZoomed()||(self.lastScrollPosition=DomService.getBodyScroll(),self._isZoomed=!0,DomService.bodyScrollable(!1),this.loadZoomedImage(),EventManager.emit(CollectionEvent.ZOOMED_IN,{}))},this.zoomOut=function(){self.isZoomed()&&(DomService.bodyScrollable(!0),DomService.setBodyScroll(self.lastScrollPosition),DomService.getElement(".shows-zoom")[0].scrollTop=0,self._isZoomed=!1,EventManager.emit(CollectionEvent.ZOOMED_OUT,{}))},this.loadZoomedImage=function(){if(self.isZoomed()){var image=CollectionService.getActiveLook();CollectionImageLoaderService.load(image.path,"zoom",function(src){$rootScope.$apply(function(){image.zoomSrc=src})})}}}]),angular.module("app.show").service("SeasonService",["DataService","SeasonApi",function(DataService,SeasonApi){"use strict";this.getAll=function(removePrefix){return SeasonApi.getAll().$promise.then(function(res){return res.data=DataService.normalise(res.data,removePrefix),res})}}]),angular.module("app.show").service("ShowSearchService",["DataService","ShowSearchApi","ArrayService","EventManager","ShowEvents",function(DataService,ShowSearchApi,ArrayService,EventManager,ShowEvents){"use strict";var defaultFilters={limit:10,offset:0};this.search=function(filters){return filters=DataService.createFilters(defaultFilters,filters),ShowSearchApi.getAll(filters).$promise.then(function(res){return res})},this.dispatchFiltersData=function(data,allowed){angular.forEach(data,function(value,key){ArrayService.inArray(allowed,key)&&EventManager.emit(ShowEvents.BASE+(key.charAt(0).toUpperCase()+key.substr(1).toLowerCase()),value,!0)})}}]),angular.module("app.show").service("ShowService",["DataService","ShowApi",function(DataService,ShowApi){"use strict";var defaultFilters={};this.getByType=function(type){return this.services[type]},this.getShow=function(season,brand,previewKey,previewId){return ShowApi.get({season:season,brand:brand,previewKey:previewKey,previewId:previewId}).$promise.then(function(res){return res})},this.getFeaturedShows=function(season,week,filters){var params=DataService.createFilters(defaultFilters,filters);return params.season=season,params.week=week,ShowApi.getFeaturedShows(params).$promise.then(function(res){return res})},this.getNextShow=function(profileId,sessonKey,weekKey){return ShowApi.getNextShow({profileId:profileId,season:sessonKey,week:weekKey}).$promise.then(function(res){return res})},this.getBySeasonWeek=function(season,week,filters){var params=DataService.createFilters(defaultFilters,filters);return params.season=season,params.week=week,ShowApi.getBySeasonWeek(params).$promise.then(function(res){return res})},this.services={week:this.getBySeasonWeek,featured:this.getFeaturedShows}}]),function(){"use strict";function legacyTrackService(_,$window){function addEvent(data){$window.dataLayer.push(data)}function pageView(path){path=path||"";var url=$window.location.pathname;"/"===url.slice(-1)&&(url=url.slice(-1));var data={event:"virtualPage",category:url,value:url+path};$window.dataLayer.push(data)}return{addEvent:addEvent,pageView:pageView}}legacyTrackService.$inject=["_","$window"],angular.module("app.legacy-track").service("legacyTrackService",legacyTrackService)}(),angular.module("app.subscription").constant("SubscriptionCaches",{SUBSCRIPTION_CACHE:"SubscriptionCache",SUBSCRIPTION_DATA_KEY:"data"}),angular.module("app.subscription").constant("SubscriptionEvents",{SUBSCRIPTION_CHANGED:"subscriptionDataChanged",SUBSCRIPTION_UPDATE_OF_ID:"subscriptionUpdateOfId"}),angular.module("app.subscription").factory("SubscriptionApi",["$resource",function($resource){"use strict";return $resource("/xhr/profiles/subscriptions/:action",{action:"@action"},{getAll:{method:"GET",cache:!1,params:{}},subscribe:{method:"POST",cache:!1,params:{action:"subscribe"}},unsubscribe:{method:"POST",cache:!1,params:{action:"unsubscribe"}}})}]),angular.module("app.subscription").service("SubscriptionService",["_","SubscriptionApi","CacheService","$q","EventManager","SubscriptionEvents",function(_,SubscriptionApi,CacheService,$q,EventManager,SubscriptionEvents){"use strict";this.update=function(id,status){return(status?SubscriptionApi.subscribe:SubscriptionApi.unsubscribe)({profiles:[id]}).$promise.then(function(res){return EventManager.emit(SubscriptionEvents.SUBSCRIPTION_CHANGED,res.data.profiles),EventManager.emit(SubscriptionEvents.SUBSCRIPTION_UPDATE_OF_ID,{id:id,status:status}),res.data.profiles})},this.init=function(){return SubscriptionApi.getAll().$promise.then(function(res){return res.data.profiles}).then(function(profiles){EventManager.emit(SubscriptionEvents.SUBSCRIPTION_CHANGED,profiles)})},this.getAll=function(filters){return SubscriptionApi.getAll(_.assign({spa:!0},filters)).$promise}}]),function(){"use strict";function intercom($log,intercomService,DataService){function link(scope,element,attrs){$log.warn("Intercom::intercom:: Warning, remove Legacy intercom directive and use tracker for sending events to intercom!");var data=DataService.buildDataFromAttributes(attrs,"intercom");"load"===data.Trigger.toLowerCase()?intercomService.addEvent(data):element.on("click",function(e){intercomService.addEvent(data,!0)})}return{restrict:"A",link:link}}intercom.$inject=["$log","intercomService","DataService"],angular.module("app.intercom").directive("intercom",intercom)}(),function(){"use strict";function intercomService(_,$log,$window,ScriptLoadService,GlobalParams){function init(){function onIntercomScriptLoaded(){$log.debug("Intercom::intercomService::init::onIntercomScriptLoaded::")}return $log.debug("Intercom::intercomService::init::"),ScriptLoadService.addScriptTag(INTERCOM_SCRIPT_SRC).then(onIntercomScriptLoaded)}function isIntercomBooted(){return intercomBooted}function bootIntercom(userParams){var intercomBootParams=_.assign(userParams,{app_id:GlobalParams.INTERCOM_APP_ID,hide_default_launcher:!$window.IntercomShowLauncher});$log.debug("Intercom::intercomService::bootIntercom::",intercomBootParams),$window.Intercom("boot",intercomBootParams),intercomBooted=!0,sendEventQueueToIntercom()}function shutDownIntercom(){$log.debug("Intercom::intercomService::shutDownIntercom::"),$window.Intercom("shutdown")}function trackIntercomEvent(eventName,eventMetadata){$log.debug("Intercom::intercomService::trackIntercomEvent::",eventName,eventMetadata),$window.Intercom("trackEvent",eventName,eventMetadata)}function onUserChanged(user){if(!$window.Intercom)return $log.error("Intercom::intercomService::onUserChanged:: called before Intercom has been booted!");isIntercomBooted()&&shutDownIntercom(),bootIntercom(extractIntercomUser(user))}function extractIntercomUser(user){var currentUser={};return user.isLoggedIn()&&(currentUser.user_id=user.id,currentUser.email=user.email,currentUser.name=user.displayname,user.company_id&&(currentUser.company={id:user.company_id,name:user.company_title,company_size_id:user.company_size_id})),currentUser}function addEvent(eventPayload){$log.debug("Intercom::intercomService::addEvent::",eventPayload),intercomEventsQueue.push(eventPayload),sendEventQueueToIntercom()}function sendEventQueueToIntercom(){isIntercomBooted()&&!_.isEmpty(intercomEventsQueue)&&(_.each(intercomEventsQueue,function(e){var metadata={};_.each(_.omit(e,["Event","Trigger"]),function(val,key){metadata[_.snakeCase(key)]=val}),trackIntercomEvent(e.Event.toLowerCase(),metadata)}),intercomEventsQueue=[])}var INTERCOM_SCRIPT_SRC="https://widget.intercom.io/widget/nbe7uql4",intercomBooted=!1,intercomEventsQueue=[];return{init:_.once(init),onUserChanged:onUserChanged,addEvent:addEvent}}intercomService.$inject=["_","$log","$window","ScriptLoadService","GlobalParams"],angular.module("app.intercom").factory("intercomService",intercomService)}(),angular.module("app.crypt").factory("CryptFactory",["CryptoJS",function(CryptoJS){function CryptFactory(secret){this.setSecret=function(newSecret){secret=newSecret},this.encrypt=function(message){return message?CryptoJS.AES.encrypt(message,secret).toString():null},this.decrypt=function(message){return message?CryptoJS.AES.decrypt(message,secret).toString(CryptoJS.enc.Utf8):null},this.encryptJson=function(message){return this.encrypt(angular.toJson(message))},this.decryptJson=function(message){var res=this.decrypt(message);return res?angular.fromJson(res):{}}}return CryptFactory}]).provider("CryptService",function(){"use strict";var SECRET="";this.setSecret=function(secret){SECRET=secret},this.$get=["CryptFactory","CryptoJS",function(CryptFactory,CryptoJS){return new CryptFactory(SECRET)}]}),function(){"use strict";function communityFeaturedModuleApi(_,$http,Routes){function get(layout,title,listId,profiles){function onSuccess(res){return _.get(res,"data.data")||{}}var params={layout:layout,title:title,listId:listId,profiles:profiles};return $http({method:"GET",url:Routes.COMMUNITY.FEATURED_MODULE,params:params}).then(onSuccess)}return{get:get}}communityFeaturedModuleApi.$inject=["_","$http","Routes"],angular.module("app.community").factory("communityFeaturedModuleApi",communityFeaturedModuleApi)}(),function(){"use strict";function CommunityFeaturedModuleController(_,communityFeaturedModuleApi,wallStream){function $onInit(){$ctrl.loaded=!1,wallStream.ARTICLE_LOADED.subscribe(onArticleLoaded),communityFeaturedModuleApi.get($ctrl.layout,$ctrl.title,$ctrl.listId,$ctrl.profiles).then(onDataLoaded)}function onArticleLoaded(){wallRulesPassed=!0,$ctrl.data&&($ctrl.loaded=!0)}function onDataLoaded(data){$ctrl.data=data,$ctrl.data.profiles=_.map(data.profiles,function(profile){return _.isArray(profile.sub_title)||(profile.sub_title=[profile.sub_title]),"bof500"===profile.type&&(profile.url+="?from=community"),profile}),$ctrl.label="Community.FeaturedModule.InArticle.List["+$ctrl.listId+"].Layout["+$ctrl.data.layout+"].Profiles["+$ctrl.profiles+"]",$ctrl.loaded=wallRulesPassed}var $ctrl=this,wallRulesPassed=!1;$ctrl.$onInit=$onInit}var communityFeaturedModuleComponent={templateUrl:"/assets-access-layer/js/site/Community/community-featured-module.html",bindings:{layout:"@",title:"@moduleTitle",listId:"@",profiles:"@"},controller:CommunityFeaturedModuleController};angular.module("app.community").component("communityFeaturedModule",communityFeaturedModuleComponent)}(),angular.module("app.conference").component("voicesLiveBanner",{bindings:{location:"@"},templateUrl:function(AgentService,ConferenceTemplates){return AgentService.isMobilePhone()?ConferenceTemplates.VOICES_LIVE_BANNER_MOBILE:ConferenceTemplates.VOICES_LIVE_BANNER},controller:function(){"use strict"}}),angular.module("app.conference").constant("ConferenceTemplates",{VOICES_LIVE_BANNER:"/templates/Voices/voices_live_banner",VOICES_LIVE_BANNER_MOBILE:"/templates/Voices/voices_live_banner_mobile",LIVE_HELP:{controller:"ModalGenericController",template:"/templates/Voices/voices_live_help",backdrop:!1,size:"sm",css:"modal-fixed-bottom modal-fixed-bottom-right s_modal-fixed-desktop"}}),angular.module("app.conference").controller("VoicesLiveController",["$scope","$q","ConferenceTemplates",function($scope,$q,ConferenceTemplates){"use strict"}]),angular.module("app.conference").directive("conferenceRegisterButton",["authModalService","EventManager","AuthEvents",function(authModalService,EventManager,AuthEvents){"use strict";return{templateUrl:"/templates/Conferences/register_button",replace:!0,restrict:"E",scope:{showProfileId:"@",collectionUrl:"@"},link:function(scope){scope.create=function(){authModalService.setSubscribeSource("Conferences"),authModalService.openSignup("conferences",{},!0,!0,!0,!0)},scope.show_button=!1,EventManager.on(AuthEvents.USER_CHANGED,function(user){scope.show_button=!user.roles.hasRole("ROLE_CONF_VOICES")})}}}]),angular.module("app.board").constant("BoardTemplates",{BOARDS_FORM:{controller:"ShareGenericController",template:"/templates/Message/boards_form"}}),angular.module("app.recurly").constant("RecurlyConfig",{SCRIPT:"https://js.recurly.com/v4/recurly.js",DEFAULT_CONFIG:function(customConfig){return _.assign({style:{all:{fontSize:"14px",fontColor:"#000",fontFamily:'Roboto, Arial, "Open Sans"'},number:{placeholder:"Credit card number"},cvv:{placeholder:"CVV"},month:{placeholder:"MM"},year:{placeholder:"YY"}}},customConfig||{})}}),angular.module("app.recurly").factory("RecurlyServiceFactory",["_","$window","$log","$q","ScriptLoadService","RecurlyConfig",function(_,$window,$log,$q,ScriptLoadService,RecurlyConfig){"use strict";function RecurlyServiceFactory(recurlyPublicKey){function getRecurly(){var recurly=$window.recurly;if(!recurly)throw"RecurlyServiceFactory::getRecurly:: Recurly not loaded!";return recurly}function configureRecurly(customConfig){var recurly=getRecurly();if(!recurlyPublicKey)throw"RecurlyServiceFactory::configureRecurly:: Cannot configure Recurly without a Public Key!";var recurlyConfig=RecurlyConfig.DEFAULT_CONFIG(customConfig);recurlyConfig.publicKey=recurlyPublicKey,recurly.configure(recurlyConfig)}var self=this,loadedPromise=null;this.getToken=function(data){var deferred=$q.defer();return getRecurly().token(data,function(err,token){if(err||!token.id)return deferred.reject({error:err||"Missing Token from recurly response!"});deferred.resolve(token.id)},deferred.reject),deferred.promise},this.initRecurlyListeners=function(onFormSubmit,onFieldChange){$log.debug("RecurlyServiceFactory::initRecurlyListeners::");var recurly=getRecurly();_.isFunction(onFormSubmit)&&recurly.on("field:submit",onFormSubmit),_.isFunction(onFieldChange)&&recurly.on("change",onFieldChange)},this.initRecurly=function(customConfig,onFormSubmit,onFieldChange){function onRecurlyLoaded(){configureRecurly(customConfig),(onFormSubmit||onFieldChange)&&self.initRecurlyListeners(onFormSubmit,onFieldChange)}if(loadedPromise)return loadedPromise.then(onRecurlyLoaded);var deferred=$q.defer();return ScriptLoadService.addScriptTag(RecurlyConfig.SCRIPT).then(function(){onRecurlyLoaded(),deferred.resolve()},deferred.reject),loadedPromise=deferred.promise}}return RecurlyServiceFactory}]).provider("RecurlyServiceLegacy",function(){"use strict";var recurlyPublicKey=null;this.setPublicKey=function(publicKey){recurlyPublicKey=publicKey},this.$get=["RecurlyServiceFactory",function(RecurlyServiceFactory){return new RecurlyServiceFactory(recurlyPublicKey)}]}),function(){"use strict";function recurlyDownModalService(_,$log,$timeout,UiModalService,recurlyStream){function init(){recurlyStream.API.subscribe(onRecurlyApi)}function onRecurlyApi(payload){if($log.debug("recurlyDownModalService::onRecurlyApi::",payload),payload.completed){var keepModalOpen="api-error"===_.get(payload,"response.code");resetTimer(payload.key,keepModalOpen),keepModalOpen&&openModal()}else startTimer(payload.key)}function startTimer(key){stopTimer(),timerKeys[key]=!0,timer=$timeout(openModal,MODAL_OPEN_AFTER_MS),$log.debug("recurlyDownModalService::startTimer:: Timer started",timerKeys)}function resetTimer(key,keepOpen){delete timerKeys[key],stopTimer(!0),!keepOpen&&_.isEmpty(timerKeys)&&closeModal(),$log.debug("recurlyDownModalService::resetTimer:: Timer stopped",timerKeys)}function closeModal(){function onModalOpen(){modalInstance.close(),modalOpen=!1,modalInstance=null,$log.debug("recurlyDownModalService::resetTimer:: Modal closed")}modalOpen&&modalInstance&&modalInstance.opened.then(onModalOpen)}function openModal(){function onModalClosed(){modalOpen=!1}if($log.debug("recurlyDownModalService::openModal::",modalOpen),!modalOpen){modalOpen=!0;var modalConfig={controller:"ModalGenericController",template:"/assets-access-layer/js/shared/Recurly/templates/connection-down-modal.html",backdrop:"static"};modalInstance=UiModalService.openModal(modalConfig,{},!0),modalInstance.result.then(onModalClosed)}}function stopTimer(keyCheck){var canReset=!keyCheck||_.isEmpty(timerKeys);timer&&canReset&&$timeout.cancel(timer)}var timer,modalInstance,MODAL_OPEN_AFTER_MS=1e4,timerKeys={},modalOpen=!1;return{init:_.once(init)}}recurlyDownModalService.$inject=["_","$log","$timeout","UiModalService","recurlyStream"],angular.module("app.recurly").factory("recurlyDownModalService",recurlyDownModalService)}(),function(){"use strict";function recurlyServiceProvider(){function setPublicKey(publicKey){recurlyPublicKey=publicKey}function recurlyService($window,$log,$q,$evalAsync,_,ScriptLoadService,RecurlyConfig){function getRecurly(){var recurly=$window.recurly;if(!recurly)throw"recurlyService::getRecurly:: Recurly not loaded!";return recurly}function getRecurlyService(){function onRecurlyLoaded(){recurly=getRecurly(),deferred.resolve(recurly)}if(recurly)return $q.resolve(recurly);var deferred=$q.defer();return initRecurly().then(onRecurlyLoaded,deferred.reject),deferred.promise}function configureRecurly(customConfig){$log.debug("recurlyService::configureRecurly::",arguments);var recurly=getRecurly();if(!recurlyPublicKey)throw"recurlyService::configureRecurly:: Cannot configure Recurly without a Public Key!";var recurlyConfig=RecurlyConfig.DEFAULT_CONFIG(customConfig);recurlyConfig.publicKey=recurlyPublicKey,recurly.configure(recurlyConfig)}function initRecurlyListeners(onFormSubmit,onFieldChange){function executeAsync(callable){return function(data){$evalAsync(function(){callable(data)})}}$log.debug("recurlyService::initRecurlyListeners::",arguments);var recurly=getRecurly();_.isFunction(onFormSubmit)&&recurly.on("field:submit",executeAsync(onFormSubmit)),_.isFunction(onFieldChange)&&recurly.on("change",executeAsync(onFieldChange))}function initRecurly(customConfig,onFormSubmit,onFieldChange){function onRecurlyScriptLoadSuccess(){onRecurlyLoaded(),deferred.resolve()}function onRecurlyLoaded(){configureRecurlyOnce(customConfig),(onFormSubmit||onFieldChange)&&initRecurlyListeners(onFormSubmit,onFieldChange)}if($log.debug("recurlyService::initRecurly::",arguments),loadedPromise)return loadedPromise.then(onRecurlyLoaded);var deferred=$q.defer();return ScriptLoadService.addScriptTag(RecurlyConfig.SCRIPT).then(onRecurlyScriptLoadSuccess,deferred.reject),loadedPromise=deferred.promise}var loadedPromise=null,recurly=null,configureRecurlyOnce=_.once(configureRecurly);return{initRecurly:initRecurly,initRecurlyListeners:initRecurlyListeners,getRecurlyService:getRecurlyService}}recurlyService.$inject=["$window","$log","$q","$evalAsync","_","ScriptLoadService","RecurlyConfig"];var recurlyPublicKey=null;return{setPublicKey:setPublicKey,$get:recurlyService}}angular.module("app.recurly").provider("recurlyService",recurlyServiceProvider)}(),function(){"use strict";function recurlyCouponApi(_,$log,$q,recurlyService,recurlyStream){function get(planCode,couponCode){function onRecurlyLoaded(recurly){function onCouponGet(error,coupon){if(error)return onCouponError(error);onCouponSuccess(coupon)}function onCouponSuccess(coupon){pushToApiStream(!0,coupon),deferred.resolve(coupon)}return pushToApiStream(!1),recurly.coupon({plan:planCode,coupon:couponCode},onCouponGet),deferred.promise}function onCouponError(error){return pushToApiStream(!0,error),recurlyStream.ERROR.onNext(error),deferred.reject(error)}function pushToApiStream(completed,response){recurlyStream.API.onNext({key:"COUPON_API",completed:!!completed,response:response||null})}if($log.debug("recurlyCouponApi::get:: ",arguments),_.isEmpty(planCode)||_.isEmpty(couponCode))return $q.reject({});var deferred=$q.defer();return recurlyService.getRecurlyService().then(onRecurlyLoaded,onCouponError),deferred.promise}return{get:get}}recurlyCouponApi.$inject=["_","$log","$q","recurlyService","recurlyStream"],angular.module("app.recurly").factory("recurlyCouponApi",recurlyCouponApi)}(),function(){"use strict";function recurlyPricingApi($q,$log,recurlyService,recurlyStream){function get(planCode,countryISOCode,currencyISOCode,couponCode,vatNumber,addon){function onRecurlyLoaded(recurly){recurlyPricing=recurlyPricing||recurly.Pricing(),pushToApiStream(!1),addon?recurlyPricing.plan(planCode,{quantity:1}).tax({tax_code:"digital",vat_number:vatNumber}).addon(addon.name,addon.options).coupon(couponCode).currency(currencyISOCode).address({country:countryISOCode}).done(onPricingSuccess,onPricingError):recurlyPricing.plan(planCode,{quantity:1}).tax({tax_code:"digital",vat_number:vatNumber}).coupon(couponCode).currency(currencyISOCode).address({country:countryISOCode}).done(onPricingSuccess,onPricingError)}function onPricingError(error){return $log.debug("recurlyPricingApi::onPricingError::",error),pushToApiStream(!0,error),recurlyStream.ERROR.onNext(error),deferred.reject(error)}function onPricingSuccess(response){return $log.debug("recurlyPricingApi::onPricingSuccess::",response),pushToApiStream(!0,response),deferred.resolve(response)}function pushToApiStream(completed,response){recurlyStream.API.onNext({key:"PRICING_API",completed:!!completed,response:response||null})}$log.debug("recurlyPricingApi::get:: ",arguments);var recurlyPricing,deferred=$q.defer();return recurlyService.getRecurlyService().then(onRecurlyLoaded,onPricingError),deferred.promise}return{get:get}}recurlyPricingApi.$inject=["$q","$log","recurlyService","recurlyStream"],angular.module("app.recurly").factory("recurlyPricingApi",recurlyPricingApi)}(),function(){"use strict";function recurlyTokenApi(_,$log,$q,recurlyService,recurlyStream){function get(billingFormData){function onRecurlyLoaded(recurly){function onGetToken(error,token){if(error||!token.id)return onGetTokenError(error||{error:{code:"Missing recurly token"}});onGetTokenSuccess(token.id)}function onGetTokenSuccess(tokenId){return deferred.resolve(tokenId)}return recurly.token(billingFormData,onGetToken)}function onGetTokenError(error){return recurlyStream.ERROR.onNext(error),deferred.reject(error)}billingFormData=_.pick(billingFormData,["first_name","last_name","address1","address2","city","state","postal_code","country","phone","vat_number"]),$log.debug("recurlyTokenApi::get::",billingFormData);var deferred=$q.defer();return recurlyService.getRecurlyService().then(onRecurlyLoaded,onGetTokenError),deferred.promise}return{get:get}}recurlyTokenApi.$inject=["_","$log","$q","recurlyService","recurlyStream"],angular.module("app.recurly").factory("recurlyTokenApi",recurlyTokenApi)}(),function(){"use strict";function CountryMismatchNotificationController(){}var countryMismatchNotificationComponent={templateUrl:"/assets-access-layer/js/site/Membership/templates/country-mismatch-notification.html",bindings:{billingCountryCode:"<",defaultCountryCode:"<"},controller:CountryMismatchNotificationController};angular.module("app.recurly").component("countryMismatchNotification",countryMismatchNotificationComponent)}(),function(){"use strict";function FormErrorController(_,DomService,authModalService){function $onChanges(){_.isUndefined($ctrl.error)||_.isUndefined($ctrl.error.type)||scrollToError()}function isFatal(){return $ctrl.error&&$ctrl.error.message&&_.startsWith($ctrl.error.message,"FATAL")}function isNonPaymentError(){var nonPaymentErrors=["INVALID_CONSENT_VERSION","MALFORMED_EMAIL","GENERIC_FE_ERROR"];return $ctrl.error&&$ctrl.error.message&&_.indexOf(nonPaymentErrors,$ctrl.error.message)>=0}function openLogin(event){event.preventDefault(),authModalService.setSubscribeSource($ctrl.loginSubscriberSource),authModalService.openLogin("default",{},!0)}function scrollToError(){DomService.scrollToElement(DomService.getElement("#form-error"),100)}var $ctrl=this;$ctrl.$onChanges=$onChanges,$ctrl.openLogin=openLogin,$ctrl.isFatal=isFatal,$ctrl.isNonPaymentError=isNonPaymentError}var formErrorComponent={templateUrl:"/assets-access-layer/js/shared/Recurly/components/form-error.html",bindings:{loginSubscriberSource:"@",error:"<"},controller:FormErrorController};angular.module("app.recurly").component("formError",formErrorComponent)}(),function(){"use strict";function PaymentPlanDetailsController(_,moment,journeyContextService){function $onInit(){$ctrl.printDate=$ctrl.planPrintIssueDate?moment($ctrl.planPrintIssueDate,"DD-MM-YYYY").format("MMMM YYYY"):null,$ctrl.ctaUrl=journeyContextService.generatePaymentPlanUrl($ctrl.planChangeUrl),reloadData()}function $onChanges(){reloadData()}function reloadData(){var planTrialLengthDays=_.parseInt($ctrl.planTrialLengthDays)||0;$ctrl.data={currency_code:$ctrl.currencyCode||"",currency_symbol:$ctrl.currencySymbol||"",start_date:planTrialLengthDays?moment().add(planTrialLengthDays,"days").format("MMMM Do YYYY"):"today",plan_interval_months:_.parseInt($ctrl.planIntervalMonths)}}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges}var paymentPlanDetailsComponent={templateUrl:"/assets-access-layer/js/shared/Recurly/templates/payment-plan-details.html",bindings:{planTitle:"@",planIntervalMonths:"@",planChangeUrl:"@",currencyCode:"<",currencySymbol:"<",membershipType:"@"},controller:PaymentPlanDetailsController};angular.module("app.recurly").component("paymentPlanDetails",paymentPlanDetailsComponent)}(),function(){"use strict";function PaymentPlanDisclaimerController(_,moment){function $onInit(){$ctrl.printDate=$ctrl.planPrintIssueDate?moment($ctrl.planPrintIssueDate,"DD-MM-YYYY").format("MMMM YYYY"):null,reloadData()}function $onChanges(){reloadData()}function reloadData(){var planTrialLengthDays=_.parseInt($ctrl.planTrialLengthDays)||0;$ctrl.data={price_tax_next:$ctrl.priceTaxNext&&"0.00"!=$ctrl.priceTaxNext?$ctrl.priceTaxNext:0,price_total_next:$ctrl.priceTotalNext,currency_code:$ctrl.currencyCode||"",currency_symbol:$ctrl.currencySymbol||"",start_date:planTrialLengthDays?moment().add(planTrialLengthDays,"days").format("MMMM Do YYYY"):"today",plan_trial_length_days:planTrialLengthDays,plan_interval_months:_.parseInt($ctrl.planIntervalMonths)}}var $ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges}var paymentPlanDisclaimerComponent={templateUrl:"/assets-access-layer/js/shared/Recurly/templates/payment-plan-disclaimer.html",bindings:{planTitle:"@",planIntervalMonths:"@",currencyCode:"<",currencySymbol:"<",priceTotalNext:"<",priceTaxNext:"<",membershipType:"@"},controller:PaymentPlanDisclaimerController};angular.module("app.recurly").component("paymentPlanDisclaimer",paymentPlanDisclaimerComponent)}(),function(){"use strict";function RecurlyBillingFormController($log,_,InputUtil,recurlyService,recurlyStream,RecurlyConfig,FormServiceFactory){function $onInit(){$ctrl.form={ref:null,data:formData,recurly:{}},formData.country=$ctrl.defaultCountryCode,$ctrl.countryDisabledBool=InputUtil.toBoolean($ctrl.countryDisabled)||"",$ctrl.status={number:{},cvv:{},month:{},year:{}},FormService=new FormServiceFactory($ctrl.form)}function $postLink(){initRecurly()}function $onChanges(changesObj){changesObj.enableValidation&&changesObj.enableValidation.currentValue&&FormService&&FormService.canSubmit(),changesObj.firstName&&changesObj.firstName.currentValue&&(formData.first_name=changesObj.firstName.currentValue),changesObj.lastName&&changesObj.lastName.currentValue&&(formData.last_name=changesObj.lastName.currentValue),changesObj.errors&&changesObj.errors.currentValue&&onRecurlyErrors()}function onRecurlyErrors(){var errorCode=_.get($ctrl,"errors.code");if(_.includes(["validation","invalid-parameter"],errorCode)){var fields=_.get($ctrl,"errors.fields")||[];if(!_.isEmpty(fields)){var newStatus=_.cloneDeep($ctrl.status);_.each(fields,function(fieldError){"postal_code"===fieldError?setPostalCodeValidity(!1):_.isObject(newStatus[fieldError])&&(newStatus[fieldError].isValid=!1,newStatus[fieldError].isServerError=!0)}),$ctrl.status=newStatus}}}function setPostalCodeValidity(validity){$ctrl.form.ref.postal_code.$setValidity("server",validity)}function onFormFieldChange(){var formChangedPayload={formData:_.clone(formData),isValid:FormService.isValid()},payloadHash=angular.toJson(formChangedPayload);payloadHash!==emittedPayloadHash&&(emittedPayloadHash=payloadHash,recurlyStream.BILLING_FORM_CHANGED.onNext(formChangedPayload))}function onCountryFieldChange(newValue){recurlyStream.BILLING_COUNTRY_CHANGED.onNext({newValue:newValue}),setPostalCodeValidity(!0),formData.country=newValue?newValue.country_code:DEFAULT_VALUE,$ctrl.billingCountry=newValue,onFormFieldChange()}function onFormSubmit(){}function onRecurlyInitError(error){recurlyStream.ERROR.onNext({error:error})}function getRecurlyConfig(){var customConfig=RecurlyConfig.DEFAULT_CONFIG();return $ctrl.cardPlaceholder&&_.set(customConfig,"style.number.placeholder",$ctrl.cardPlaceholder),$ctrl.cvvPlaceholder&&_.set(customConfig,"style.cvv.placeholder",$ctrl.cvvPlaceholder),$ctrl.monthPlaceholder&&_.set(customConfig,"style.month.placeholder",$ctrl.monthPlaceholder),$ctrl.yearPlaceholder&&_.set(customConfig,"style.year.placeholder",$ctrl.yearPlaceholder),customConfig}function initRecurly(){function onRecurlyChange(data){$ctrl.status=data.fields}return $log.debug("RecurlyBillingFormController::initRecurly::"),recurlyService.initRecurly(getRecurlyConfig(),onFormSubmit,onRecurlyChange).catch(onRecurlyInitError)}var FormService,DEFAULT_VALUE,$ctrl=this,emittedPayloadHash=null,formData={first_name:$ctrl.firstName,last_name:$ctrl.lastName,postal_code:DEFAULT_VALUE,country:DEFAULT_VALUE};$ctrl.onFormFieldChange=onFormFieldChange,$ctrl.onCountryFieldChange=onCountryFieldChange,$ctrl.$onChanges=$onChanges,$ctrl.$onInit=$onInit,$ctrl.$postLink=$postLink}var recurlyBillingFormComponent={templateUrl:"/assets-access-layer/js/shared/Recurly/templates/recurly-billing-form.html",bindings:{cardPlaceholder:"@",cvvPlaceholder:"@",monthPlaceholder:"@",yearPlaceholder:"@",firstNamePlaceholder:"@",lastNamePlaceholder:"@",zipPlaceholder:"@",postalCode:"@",countryDisabled:"@",defaultCountryCode:"@",firstName:"<",lastName:"<",billingCountryCode:"<",enableValidation:"<",errors:"<"},controller:RecurlyBillingFormController};angular.module("app.recurly").component("recurlyBillingForm",recurlyBillingFormComponent)}(),function(){"use strict";function RecurlyFatalErrorNotificationController(_,recurlyStream){function $onInit(){$ctrl.isVisible=!1,listener=recurlyStream.ERROR.subscribe(onRecurlyError)}function onRecurlyError(error){error&&error.code&&_.includes(["not-found","validation","invalid-parameter"],error.code)||($ctrl.isVisible=!0)}function $onDestroy(){listener.dispose()}function closeNotification(){$ctrl.isVisible=!1}var listener,$ctrl=this;$ctrl.closeNotification=closeNotification,$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var recurlyFatalErrorNotificationComponent={templateUrl:"/assets-access-layer/js/shared/Recurly/templates/recurly-fatal-error-notification.html",controller:RecurlyFatalErrorNotificationController};angular.module("app.recurly").component("recurlyFatalErrorNotification",recurlyFatalErrorNotificationComponent)}(),function(){"use strict";function RecurlyInputCouponController(_,$q,$log,recurlyCouponApi,recurlyStream){function $onInit(){function applyDefaultCoupon(coupon){$log.debug("inputRecurlyCoupon::$onInit::applyDefaultCoupon::",coupon),coupon&&recurlyStream.COUPON_CHANGED.onNext(coupon)}if($ctrl.showCoupon=!1,$ctrl.alert=null,$ctrl.newCouponCode=null,$ctrl.couponApplied=!1,$ctrl.defaultCouponCode)return recurlyCouponApi.get($ctrl.planCode,$ctrl.defaultCouponCode).then(applyDefaultCoupon)}function toggleCoupon(showCoupon){$ctrl.showCoupon=showCoupon}function canApplyCoupon(){return!_.isEmpty($ctrl.newCouponCode)}function applyCouponCode(){function onRecurlyCouponSuccess(coupon){$log.debug("RecurlyInputCouponController::applyCouponCode",coupon),recurlyStream.COUPON_CHANGED.onNext(coupon),$ctrl.couponApplied=!0}function onRecurlyCouponError(error){return error.coupon_code=$ctrl.newCouponCode,$ctrl.alert=error,$ctrl.newCouponCode=null,$q.reject()}return $ctrl.alert=null,recurlyCouponApi.get($ctrl.planCode,$ctrl.newCouponCode).then(onRecurlyCouponSuccess,onRecurlyCouponError)}function canRemoveCoupon(){return!0}function removeCouponCode(){function removeCoupon(coupon){return $log.debug("inputRecurlyCoupon::removeCouponCode",coupon),recurlyStream.COUPON_CHANGED.onNext(coupon||{}),$ctrl.newCouponCode=null,$ctrl.couponApplied=!1,$q.resolve()}return $ctrl.defaultCouponCode?recurlyCouponApi.get($ctrl.planCode,$ctrl.defaultCouponCode).then(removeCoupon):removeCoupon()}var $ctrl=this;$ctrl.toggleCoupon=toggleCoupon,$ctrl.canRemoveCoupon=canRemoveCoupon,$ctrl.canApplyCoupon=canApplyCoupon,$ctrl.applyCouponCode=applyCouponCode,$ctrl.removeCouponCode=removeCouponCode,$ctrl.$onInit=$onInit}var recurlyInputCouponComponent={templateUrl:"/assets-access-layer/js/shared/Recurly/templates/recurly-input-coupon.html",bindings:{planCode:"@",defaultCouponCode:"@"},controller:RecurlyInputCouponController};angular.module("app.recurly").component("recurlyInputCoupon",recurlyInputCouponComponent)}(),function(){"use strict";function RecurlyInputController(_,$log,$attrs,$timeout){function $onChanges(changesObj){_.isEmpty(changesObj.status)||_.isEmpty(changesObj.status.currentValue)||onRecurlyInputChange(changesObj.status.currentValue),_.isEmpty(changesObj.linkedStatus)||_.isEmpty(changesObj.linkedStatus.currentValue)||onRecurlyLinkedInputChange(changesObj.linkedStatus.currentValue)}function $onInit(){function checkIsValid(){return status.isValid||status.isFocused&&status.firstTimeModified}$ctrl.linkedStatus||($ctrl.ngModel.$validators.checkIsValid=checkIsValid),$ctrl.formGroup.setField($ctrl.ngModel,$attrs.id),$ctrl.ngModel.$timedout=!0}function onRecurlyInputChange(newStatus){status.isValid=newStatus.valid,status.isFocused=newStatus.focus,status.isEmpty=newStatus.empty,status.isFocused||status.isEmpty||(status.firstTimeModified=!1),newStatus.isServerError&&$ctrl.ngModel.$setValidity("server",!1),newStatus.length!=status.lastLength&&$ctrl.ngModel.$setValidity("server",!0),newStatus.length&&$ctrl.ngModel.$setValidity("required",!0),status.lastLength=newStatus.length,status.isEmpty||($ctrl.ngModel.$setTouched(),$ctrl.ngModel.$setDirty(),$ctrl.ngModel.$setViewValue(Math.random())),$ctrl.linkedStatus&&$timeout(setNgModelValidity)}function onRecurlyLinkedInputChange(newStatus){linkedStatus.isValid=newStatus.valid,linkedStatus.isFocused=newStatus.focus,linkedStatus.isEmpty=newStatus.empty,newStatus.length!=linkedStatus.lastLength&&($ctrl.ngModel.$setValidity("server",!0),newStatus.length&&$ctrl.ngModel.$setValidity("required",!0)),linkedStatus.lastLength=newStatus.length,linkedStatus.isFocused||newStatus.empty||(linkedStatus.isLinkedFirstTimeModified=!1),$timeout(setNgModelValidity)}function setNgModelValidity(){var validity=status.isValid||linkedStatus.isValid||!status.lastLength||!linkedStatus.lastLength||linkedStatus.isFocused&&linkedStatus.isFirstTimeModified||status.isFocused&&status.isFirstTimeModified;$ctrl.ngModel.$setValidity("areBothFieldsNotInvalid",validity)}var $ctrl=this,DEFAULT_STATUS={isValid:!1,isFocused:!1,isEmpty:!0,isFirstTimeModified:!0,lastLength:0},status=_.clone(DEFAULT_STATUS),linkedStatus=_.clone(DEFAULT_STATUS);$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges}var recurlyInputComponent={template:'<div data-recurly="{{::($ctrl.name)}}" id="{{::($ctrl.name)}}"></div>',require:{ngModel:"ngModel",formGroup:"^formGroup"},bindings:{name:"@",status:"<",linkedStatus:"<"},controller:RecurlyInputController};angular.module("app.recurly").component("recurlyInput",recurlyInputComponent)}(),function(){"use strict";function RecurlyPricingBreakdownController(_,$log,recurlyPricingApi,recurlyStream){function $onInit(){$ctrl.isLoading=!1,$ctrl.hasCountryChanged=!1,$ctrl.data={nowTotal:null,nowSubTotal:null,nowDiscount:null,nowTax:null,nextTotal:null,nextSubTotal:null,nextTax:null,planPrice:null,currencySymbol:"",currencyCode:"",taxPercentage:0}}function $onChanges(changesObj){$log.debug("RecurlyPricingBreakdownController::$onChanges::",changesObj),(changesObj.planCode||changesObj.billingCountryCode||changesObj.couponCode||changesObj.currency||changesObj.numberOfSeats||changesObj.vatNumber)&&reloadPricing()}function reloadPricing(defaultCountryCode,defaultCurrency){function onPricingLoadedSuccess(data){$ctrl.isLoading=!1,handlePriceChange(data),recurlyStream.PRICING_RELOADED.onNext({planCode:$ctrl.planCode,countryCode:defaultCountryCode,currency:defaultCurrency,pricingData:data})}defaultCountryCode=$ctrl.billingCountryCode||defaultCountryCode,defaultCurrency=$ctrl.currency||defaultCurrency;var defaultAddon={name:DEFAULT_PLAN_ADDON,options:{quantity:$ctrl.numberOfSeats}},addon=$ctrl.numberOfSeats?defaultAddon:null;$ctrl.planCode&&defaultCountryCode&&defaultCurrency&&(pricingInit=!0,$ctrl.isLoading=!0,recurlyPricingApi.get($ctrl.planCode,defaultCountryCode,defaultCurrency,$ctrl.couponCode,$ctrl.vatNumber,addon).then(onPricingLoadedSuccess,onPricingLoadedError))}function onPricingLoadedError(data){$ctrl.isLoading=!1}function handlePriceChange(recurlyData){$ctrl.data={nowTotal:_.get(recurlyData,"now.total"),nowSubTotal:_.get(recurlyData,"now.subtotal"),nowDiscount:_.get(recurlyData,"now.discount"),nowTax:_.get(recurlyData,"now.tax"),nextTotal:_.get(recurlyData,"next.total"),nextSubTotal:_.get(recurlyData,"next.subtotal"),nextTax:_.get(recurlyData,"next.tax"),planPrice:parseFloat(_.get(recurlyData,"next.plan"))+parseFloat(_.get(recurlyData,"next.addons")),currencySymbol:_.get(recurlyData,"currency.symbol"),currencyCode:_.get(recurlyData,"currency.code"),taxPercentage:100*_.get(recurlyData,"taxes[0].rate",0)},originalCountryCode||(originalCountryCode=$ctrl.billingCountryCode),$ctrl.hasCountryChanged=originalCountryCode!==$ctrl.billingCountryCode}var originalCountryCode,$ctrl=this,pricingInit=!1,DEFAULT_PLAN_ADDON="licence_1";$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges}var recurlyPricingBreakdownComponent={templateUrl:"/assets-access-layer/js/shared/Recurly/templates/recurly-pricing-breakdown.html",bindings:{planCode:"<",planTrialLengthDays:"<",hasUsedFreeTrial:"<",couponCode:"<",couponName:"<",billingCountryCode:"<",currency:"<",numberOfSeats:"<",vatNumber:"<"},controller:RecurlyPricingBreakdownController};angular.module("app.recurly").component("recurlyPricingBreakdown",recurlyPricingBreakdownComponent)}(),function(){"use strict";function recurlyStream(LazyStream,Stream){return{BILLING_FORM_CHANGED:new LazyStream,FIELD_CHANGED:new LazyStream,BILLING_COUNTRY_CHANGED:new LazyStream,INPUT_RECURLY:new LazyStream,RELOAD_PRICING:new LazyStream,PRICING_RELOADED:new LazyStream,COUPON_CHANGED:new LazyStream,ERROR:new LazyStream,API:new Stream,RECURLY_LOADED:new LazyStream}}recurlyStream.$inject=["LazyStream","Stream"],angular.module("app.recurly").factory("recurlyStream",recurlyStream)}(),angular.module("app.news").component("newsGroupDisplay",{template:'<div class="s_site-news-title-separator background-white"><div class="s_site-news-title-separator__line"><hr class="hr margin-xs-0"></div><div class="s_site-news-title-separator__block"><h3 class="b_reset-h1-6 small-font inline-block sans-serif valign-middle">{[{$ctrl.date | date:\'fullDate\'}]}</h3></div></div>',bindings:{id:"@",expander:"@"},controller:["EventManagerUtility","ChannelManager","UiEvents","NewsHeaderService","NewsConfig","InputUtil","$scope",function(EventManagerUtility,ChannelManager,UiEvents,NewsHeaderService,NewsConfig,InputUtil,$scope){"use strict";var ctrl=this,listeners=[];InputUtil.toBoolean(ctrl.expander);ctrl.date=null,listeners.push(NewsHeaderService.subscribe(function(data){ctrl.date!==data.date&&$scope.$apply(function(){ctrl.date=data.date})})),ctrl.$onInit=function(){},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.news").component("newsGroupLoader",{template:'<div><div class="s_site-news-title-separator"><div class="s_site-news-title-separator__block {[{ ::($ctrl.isLast ? \'s_site-news-title-separator__block--primary box-shadow-light padding-vertical-xs-3\':\'\') }]}"><h3 class="b_reset-h1-6 small-font inline-block sans-serif valign-middle" ><div class="t_text-bold {[{ ::($ctrl.isLast ? \'margin-bottom-xs-2\': \'\') }]}" ng-if="::$ctrl.isLast">Date of Last Read</div>{[{::$ctrl.id | date:\'fullDate\'}]}</h3></div><div class="s_site-news-title-separator__line"><hr class="hr margin-xs-0"></div></div><div class="text-center cursor-pointer" ng-if="$ctrl.canExpand" ng-click="$ctrl.handleClick()"><i class="icon icon-dropdown"></i></div></div>',bindings:{id:"@",collapsed:"@",last:"@"},controller:["EventManagerUtility","DomService","$element","NewsHeaderService","NewsConfig","InputUtil","NewsEvent",function(EventManagerUtility,DomService,$element,NewsHeaderService,NewsConfig,InputUtil,NewsEvent){"use strict";var ctrl=this,listeners=[],elRef=$element[0],ChangeChannel=NewsEvent.CHANGE,InjectChannel=NewsEvent.LAZY_INJECT;ctrl.canExpand=InputUtil.toBoolean(ctrl.collapsed),ctrl.isLast=InputUtil.toBoolean(ctrl.last);var handleScrollTo=function(){DomService.scrollToElement(elRef,NewsConfig.TIME_MACHINE_OFFSET)};ctrl.handleClick=function(item){ctrl.canExpand&&(ChangeChannel.onNext({id:NewsConfig.NEWS_GROUP_LOADER,data:{date:ctrl.id}}),ctrl.canExpand=!1)},ctrl.$onInit=function(){listeners.push(NewsHeaderService.scrollSubscribe(elRef,ctrl.id)),ctrl.isLast&&listeners.push(InjectChannel.filter(function(data){return data.id===NewsConfig.NEWS_GROUP_LOADER}).subscribe(function(data){handleScrollTo()}))},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.news").component("newsItem",{templateUrl:function(NewsTemplate,AgentService){return AgentService.isMobile()?NewsTemplate.ITEM_MOBILE:NewsTemplate.ITEM},transclude:!0,bindings:{item:"<",flagClass:"@"},controller:["DomService","$element","NewsConfig","$timeout","EventManagerUtility","UrlService","NewsEvent",function(DomService,$element,NewsConfig,$timeout,EventManagerUtility,UrlService,NewsEvent){"use strict";var ctrl=this,ChangeChannel=NewsEvent.CHANGE,InjectChannel=NewsEvent.INJECT,flagSet=!1,listeners=[],itemId=NewsConfig.ITEM_PREFIX+ctrl.item.id,eRef=$element[0],handleFlag=function(){flagSet||(flagSet=!0,eRef.classList.add(ctrl.flagClass))};ctrl.handleClick=function(data,event){event.stopPropagation(),event.metaKey?UrlService.openNewTab(data.url):ChangeChannel.onNext({id:NewsConfig.NEWS_ITEM,data:ctrl.item})},ctrl.handleTopic=function(item,event){event.stopPropagation(),UrlService.openNewTab(item.url)},listeners.push(InjectChannel.filter(function(data){return data.id===itemId}).subscribe(function(data){data.id===itemId&&handleFlag()})),ctrl.$onInit=function(){ctrl.item.flag&&handleFlag()},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.news").component("newsList",{templateUrl:function(AgentService,NewsTemplate){return AgentService.isMobile()?NewsTemplate.LIST_MOBILE:NewsTemplate.LIST},bindings:{id:"@",expander:"@"},controller:["EventManagerUtility","DomService","NewsConfig","NewsEvent",function(EventManagerUtility,DomService,NewsConfig,NewsEvent){"use strict";var ctrl=this,InjectChannel=NewsEvent.INJECT,listeners=[];ctrl.items=[],listeners.push(InjectChannel.filter(function(data){return data.id===NewsConfig.NEWS_RENDERER}).subscribe(function(data){ctrl.items=data.data})),ctrl.$onInit=function(){},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.news").component("newsLoadMore",{template:'<div><button class="{[{::$ctrl.componentClass}]}" ng-click="$ctrl.handleClick()" ng-if="!loadLimit">{[{::$ctrl.label}]} <i class="inline-block icon-small-arrow icon-rotate-90"></i></button></div>',bindings:{label:"@",componentClass:"@",infiniteScrolling:"@"},controller:["ChannelManager","UiEvents","EventManagerUtility","DomService","$element","NewsConfig","InputUtil","NewsEvent",function(ChannelManager,UiEvents,EventManagerUtility,DomService,$element,NewsConfig,InputUtil,NewsEvent){"use strict";var ctrl=this,infiniteScrolling=InputUtil.toBoolean(ctrl.infiniteScrolling),InjectChannel=NewsEvent.INJECT,ChangeChannel=NewsEvent.CHANGE,listeners=[],elRef=$element[0],scrollObservable=Rx.Observable.fromEvent(document,"scroll").pausable();ctrl.status=null,ctrl.loadLimit=!1,ctrl.handleClick=function(){ChangeChannel.onNext({id:NewsConfig.NEWS_LOAD_MORE,data:!0})},listeners.push(InjectChannel.filter(function(data){return data.id===NewsConfig.NEWS_LOAD_MORE}).subscribe(function(data){scrollObservable.resume()})),ctrl.refresh=function(){DomService.getAbsoluteBottom(elRef)<NewsConfig.LOAD_MORE_THRESHOLD&&(scrollObservable.pause(),ctrl.handleClick())},ctrl.$onInit=function(){infiniteScrolling&&scrollObservable.throttle(10).subscribe(function(){ctrl.refresh()})},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners),scrollObservable.dispose()}}]}),angular.module("app.news").component("newsLoader",{templateUrl:function(NewsTemplate){return NewsTemplate.LOADER},bindings:{},controller:["EventManagerUtility","UiEvents","AuthEvents","NewsConfig","$element","AnimateFactory","$timeout","UrlService","NewsEvent",function(EventManagerUtility,UiEvents,AuthEvents,NewsConfig,$element,AnimateFactory,$timeout,UrlService,NewsEvent){"use strict";var ctrl=this,InjectChannel=($element[0].children[0].children[0],NewsEvent.INJECT),RepaintChannel=NewsEvent.REPAINT,ProtectContentChannel=NewsEvent.PROTECT_CONTENT,LinkChannel=NewsEvent.PREVENT_LINK_DEFAULT,listeners=[];ctrl.show=!1,ctrl.item=null,ctrl.channel=NewsConfig.GLOBAL_CHANNEL;var handleAnchors=function(status){LinkChannel.onNext({status:status})};listeners.push(InjectChannel.filter(function(data){return data.id===NewsConfig.NEWS_LOADER}).subscribe(function(data){ctrl.item=data.data,ctrl.show||(ProtectContentChannel.onNext({status:!0,preventBlur:!0}),ctrl.show=!0),RepaintChannel.onNext({status:!0}),UrlService.setAbsolutePath({},null,ctrl.item.url),handleAnchors(!0)})),ctrl.handleClose=function(){ctrl.show=!1,ctrl.item=null,ProtectContentChannel.onNext({status:!1}),UrlService.setAbsolutePath({},null,NewsConfig.BASE_URL),handleAnchors(!1)},ctrl.$onInit=function(){},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.news").component("newsMain",{templateUrl:function(NewsTemplate){"use strict";return NewsTemplate.MAIN},bindings:{},controller:["_","moment","GenericApiFactory","NewsApiRoute","EventManagerUtility","UiEvents","NewsService","CoreEvents","NewsConfig","NewsStore","$timeout","NewsPusherService","DomService","UrlService","legacyTrackService","NewsHeaderService","NewsEvent","StreamService","AntiCacheService",function(_,moment,GenericApiFactory,NewsApiRoute,EventManagerUtility,UiEvents,NewsService,CoreEvents,NewsConfig,NewsStore,$timeout,NewsPusherService,DomService,UrlService,legacyTrackService,NewsHeaderService,NewsEvent,StreamService,AntiCacheService){"use strict";var ctrl=this,InjectChannel=NewsEvent.INJECT,LazyInjectChannel=NewsEvent.LAZY_INJECT,ChangeChannel=StreamService.merge([NewsEvent.CHANGE,NewsEvent.IN_VIEW]),UserChannel=NewsEvent.USER_CHANGED,GlobalRepaintChannel=NewsEvent.GLOBAL_REPAINT,listeners=[],currentArticle=null,NewsConfigApi=new GenericApiFactory(NewsApiRoute.CONFIG,{}),dataRepos={list:new GenericApiFactory(NewsApiRoute.NEWS,{decorate:"articles"}),expander:new GenericApiFactory(NewsApiRoute.NEWS,{decorate:"none"})},dataStore=null,componentId=[NewsConfig.NEWS_LOAD_MORE,NewsConfig.NEWS_GROUP_LOADER,NewsConfig.NEWS_ITEM,NewsConfig.NEWS_PUSH,NewsConfig.NEWS_NAVIGATION,NewsConfig.NEWS_TIME_MACHINE,NewsConfig.NEWS_IN_VIEW],componentActions=_.zipObject(componentId,[function(){var filters=NewsService.toPrevious(dataStore.getFilters(),NewsConfig.BUFFER);return dataStore.setFilters(filters),dataRepos.list.get(dataStore.getFilters()).then(function(res){return dataStore.append(res.data),handleRender(dataStore.get()),ctrl.handleUnlock(),handleTimeMachine(0),res})},function(data){var filters=NewsService.addAntiCache(NewsService.toNext({to:null,from:data.date}));return dataRepos.list.get(filters).then(function(res){return dataStore.replace(res.data),handleRender(dataStore.get()),res})},function(data){currentArticle=data.id,handleItemFlag(data.id),handleDisplay(data)},function(data){_.map(data,function(x){componentActions[NewsConfig.NEWS_GROUP_LOADER]({date:x})}),handleResetPushNew()},function(data){var item=dataStore.getItem(currentArticle,data);item&&componentActions[NewsConfig.NEWS_ITEM](item)},function(data){data.lock?handleScrollTo():loadExpander().then(function(){handleScrollTo()})},function(data){UrlService.setQueryParams({})}]);ctrl.isUserLoggedIn=!1;var loadNew=function(){var filters=NewsService.fromPrevious(dataStore.getFilters(),NewsConfig.BUFFER);return dataStore.setFilters(filters),dataRepos.list.get(dataStore.getFilters()).then(function(res){return dataStore.append(res.data),handleRender(dataStore.get()),ctrl.handleUnlock(),res})},loadExpander=function(){var filters=NewsService.expanderExtremes(dataStore.getFilters(),dataStore.getLastDate());return dataStore.setFilters(filters),dataRepos.expander.get(dataStore.getFilters()).then(function(res){return dataStore.append(res.data),handleRender(dataStore.get()),res}).then(function(res){return componentActions[NewsConfig.NEWS_LOAD_MORE]()})},handleRender=function(items,prepend){InjectChannel.onNext({id:NewsConfig.NEWS_RENDERER,data:items}),GlobalRepaintChannel.onNext({})},handleResetPushNew=function(){DomService.resetScroll(),InjectChannel.onNext({id:NewsConfig.NEWS_PUSH,data:!0})},handleTimeMachine=function(count){InjectChannel.onNext({id:NewsConfig.NEWS_TIME_MACHINE,data:{count:count}})},handleDisplay=function(data){InjectChannel.onNext({id:NewsConfig.NEWS_LOADER,data:data}),legacyTrackService.pageView(data.url),handleTimeMachine(0,!1)},handleScrollTo=function(){LazyInjectChannel.onNext({id:NewsConfig.NEWS_GROUP_LOADER,data:!0})},handleItemFlag=function(itemId){ctrl.isUserLoggedIn&&InjectChannel.onNext({id:NewsConfig.ITEM_PREFIX+itemId,data:!0})};ctrl.offset=NewsConfig.OFFSET,ctrl.loadLatest=!1,ctrl.handleUnlock=function(){InjectChannel.onNext({id:NewsConfig.NEWS_LOAD_MORE,data:!0})},ctrl.handleReset=function(force){if(DomService.resetScroll(),dataStore=NewsStore.rebuild(),force&&UrlService.setQueryParams({}),handleTimeMachine(0,!1),ctrl.isUserLoggedIn){var filters=UrlService.parseQuery();_.isEmpty(filters)?ctrl.loadLatest=!1:(dataStore.setFilters(filters),ctrl.loadLatest=!0),NewsConfigApi.get(AntiCacheService.add()).then(function(res){var count=parseInt(res.data.unread_count,10)||0;_.isEmpty(res.data)&&(res.data={last_activity_date:moment().format("YYYY-MM-DD"),last_read_article_id:0,unread_count:0,visited:[]}),dataStore.setVisited(res.data.visited),dataStore.setLastDate(res.data.last_activity_date),dataStore.setLastId(res.data.last_read_article_id),_.isEmpty(filters)&&handleTimeMachine(count),loadNew()}),NewsPusherService.create()}else NewsPusherService.destroy(),loadNew()},listeners.push(ChangeChannel.subscribe(function(data){componentActions[data.id](data.data)})),listeners.push(NewsHeaderService.subscribe(function(data){ctrl.date=data.date,UrlService.setQueryParams(NewsService.toPrevious({from:data.date,to:null}))})),ctrl.$onInit=function(){listeners.push(UserChannel.subscribe(function(user){ctrl.isUserLoggedIn=user.isLoggedIn(),ctrl.handleReset()})),DomService.resetScrollOnOnload()},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.news").component("newsNavigation",{template:'<div ><i class="inline-block larger-font icon icon-slider icon-rotate-180 padding-horizontal-xs-3" ng-click="$ctrl.handleClick(-1)" fast-click></i><i class="inline-block larger-font icon icon-slider padding-horizontal-xs-3" ng-click="$ctrl.handleClick(1)" fast-click></i></div>',bindings:{},controller:["EventManagerUtility","ChannelManager","UiEvents","NewsHeaderService","NewsConfig","NewsEvent",function(EventManagerUtility,ChannelManager,UiEvents,NewsHeaderService,NewsConfig,NewsEvent){"use strict";var ctrl=this,listeners=[],keyboardListener=null,keys={37:-1,39:1},ChangeChannel=NewsEvent.CHANGE;ctrl.handleClick=function(direction){ChangeChannel.onNext({id:NewsConfig.NEWS_NAVIGATION,data:direction})},ctrl.$onInit=function(){keyboardListener=Rx.Observable.fromEvent(window,"keydown"),keyboardListener.map(function(x){return x.keyCode}).debounce(250).filter(function(x){return keys[x]}).subscribe(function(x){ctrl.handleClick(keys[x])})},ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners),keyboardListener.dispose()}}]}),function(){"use strict";function NewsPushComponentController(_,PusherService,EventManagerUtility,NewsConfig,NewsStore,NewsService,NewsPusherService,NewsEvent,authStream){function $onInit(){$ctrl.counter=0,authStreamSub=authStream.USER_CHANGED.subscribe(onUserChanged),InjectChannel.filter(function(data){return data.id===NewsConfig.NEWS_PUSH}).subscribe(handleClear)}function $onDestroy(){NewsPusherService.removeListener(pusherListener),authStreamSub.dispose()}function handleClear(){$ctrl.counter=0,stack=[]}function onUserChanged(user){user.isLoggedIn()?pusherListener=NewsPusherService.on(function(data){stack=_.union(stack,data),$ctrl.counter=stack.length}):(NewsPusherService.removeListener(pusherListener),handleClear())}function handleClick(){ChangeChannel.onNext({id:NewsConfig.NEWS_PUSH,data:NewsService.flattenPusherData(stack)})}var authStreamSub,$ctrl=this,stack=[],pusherListener=null,ChangeChannel=NewsEvent.CHANGE,InjectChannel=NewsEvent.INJECT;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleClick=handleClick}var newsPushComponent={bindings:{},template:'   <div class="cursor-pointer"         ng-class="{\'fadeInDown animated\': $ctrl.counter}">       <div ng-if="$ctrl.counter"             ng-click="$ctrl.handleClick()"             class="label label-primary sans-serif color-brand-white">            Click here to view {[{$ctrl.counter}]} new Posts       </div>   </div>',transclude:!0,controller:NewsPushComponentController};angular.module("app.news").component("newsPush",newsPushComponent)}(),angular.module("app.news").component("newsTimemachine",{template:'<div class="row"><p class="sans-serif" ng-if="!$ctrl.isUserLoggedIn">Stay informed with the latest fashion news in a simple live-feed.<br/><span class="text-anchor--set-3" auth-action-wrapper source="latest">Login</span> to unlock catch-up features.</p><p class="sans-serif" ng-if="$ctrl.isUserLoggedIn">Welcome back {[{$ctrl.firstname}]}</p><div class="text-center col-xs-24" ng-click="$ctrl.handleClick()" ng-if="$ctrl.newsCount"><div class="margin-bottom-xs-3">There are <b>{[{$ctrl.newsCount}]} new posts</b> since your last visit.<br/>Jump to the date of your last read.</div><div class="align-center"><div class="img-circle cursor-pointer background-brand-primary align-center t_width-xs-3 t_height-xs-3"><i class="very-large-font inline-block color-brand-white icon icon-large-arrow icon-rotate-90"></i></div></div></div></div>',bindings:{id:"@"},controller:["EventManagerUtility","NewsConfig","$document","NewsEvent",function(EventManagerUtility,NewsConfig,$document,NewsEvent){var InjectChannel=NewsEvent.INJECT,ChangeChannel=NewsEvent.CHANGE,UserChannel=NewsEvent.USER_CHANGED,listeners=[],ctrl=this;ctrl.lock=!1,ctrl.newsCount=0,ctrl.isUserLoggedIn=!1,ctrl.firstname="",ctrl.handleClick=function(){ctrl.lock&&(ctrl.lock=!0),ChangeChannel.onNext({id:NewsConfig.NEWS_TIME_MACHINE,data:{lock:ctrl.lock}}),ctrl.newsCount=0},ctrl.$onInit=function(){listeners.push(InjectChannel.filter(function(data){return data.id===NewsConfig.NEWS_TIME_MACHINE}).subscribe(function(data){ctrl.newsCount=data.data.count})),listeners.push(UserChannel.subscribe(function(user){ctrl.isUserLoggedIn=user.isLoggedIn(),ctrl.firstname=user.firstname}))},ctrl.$onDestroy=function(){EventManagerUtility.removeListener(listeners)}}]}),angular.module("app.news").constant("NewsConfig",{PUSHER_CHANNEL:"News",GLOBAL_CHANNEL:"News",UPDATE_EVENT:"Update",ITEM_PREFIX:"Item",OFFSET:45,SAMPLE:150,BUFFER:5,BASE_URL:"/news",MAX_BLOCK_HEIGHT:1e4,LOAD_MORE_THRESHOLD:500,SCROLL_TOP_THRESHOLD:2e3,TIME_MACHINE_OFFSET:200,NEWS_LOAD_MORE:"NewsLoadMore",NEWS_LOADER:"NewsLoader",NEWS_PUSH:"NewsPush",NEWS_SCROLL_TOP:"NewsScrollTop",NEWS_TIME_MACHINE:"NewsTimeMachine",NEWS_NAVIGATION:"NewsNavigation",NEWS_GROUP_LOADER:"NewsGroupLoader",NEWS_IN_VIEW:"NewsInView"}),angular.module("app.news").constant("NewsTemplate",{MAIN:"/templates/News/Component:main",LIST:"/templates/News/Component:list",LIST_MOBILE:"/templates/News/Component:list_mobile",LOADER:"/templates/News/Component:loader",ITEM:"/templates/News/Component:item",ITEM_MOBILE:"/templates/News/Component:item_mobile",HELP:{controller:"ModalGenericController",template:"/templates/News/Component:help",backdrop:!1,size:"sm",css:"modal-fixed-bottom modal-fixed-bottom-right s_modal-fixed-desktop"}}),angular.module("app.news").constant("NewsApiRoute",{NEWS:"/xhr/news/feed",CONFIG:"/xhr/news/settings"}),angular.module("app.news").service("NewsEvent",["ChannelManager","UiEvents","CoreEvents","NewsConfig","AuthEvents","EventManager","Stream","LazyStream",function(ChannelManager,UiEvents,CoreEvents,NewsConfig,AuthEvents,EventManager,Stream,LazyStream){"use strict";var EventDispatcher=ChannelManager.subscribe(NewsConfig.GLOBAL_CHANNEL);return{INJECT:new Stream,LAZY_INJECT:new LazyStream,CHANGE:new Stream,INIT:new Stream,REPAINT:EventDispatcher.get(UiEvents.REPAINT).getSubject(),GLOBAL_REPAINT:EventManager.get(CoreEvents.REPAINT).getSubject(),IN_VIEW:EventDispatcher.get(UiEvents.CHANGE_IN_VIEW).getSubject(),PROTECT_CONTENT:EventManager.get(AuthEvents.PROTECT_CONTENT).getSubject(!0),PREVENT_LINK_DEFAULT:EventManager.get(CoreEvents.PREVENT_LINK_DEFAULT).getSubject(!0),USER_CHANGED:EventManager.get(AuthEvents.USER_CHANGED).getSubject(!0),WINDOW_SCROLL:EventManager.get(UiEvents.WINDOW_SCROLL).getSubject()}}]),angular.module("app.news").service("NewsHeaderService",["_","$rootScope","NewsConfig","DomService",function(_,$rootScope,NewsConfig,DomService){"use strict";var self=this,subject=new Rx.Subject,scroll=Rx.Observable.fromEvent(document,"scroll").throttle(50),newValue=null;this.emit=function(data){subject.onNext(data)},this.subscribe=function(callBack){var subscription=subject.bufferWithTime(NewsConfig.SAMPLE).subscribe(function(x){(newValue=_.min(x))&&callBack({date:newValue})});return function(){subscription.dispose()}},this.scrollSubscribe=function(element,label){var subscriber=scroll.subscribe(function(x){var top=DomService.getTop(element);top>-NewsConfig.MAX_BLOCK_HEIGHT&&top<NewsConfig.OFFSET&&self.emit(label)});return function(){subscriber.dispose()}}}]),angular.module("app.news").service("NewsPusherService",["_","PusherService","NewsConfig","EventManagerUtility",function(_,PusherService,NewsConfig,EventManagerUtility){"use strict";var init=!1,PusherInstance=null;this.create=function(){init||(init=!0,PusherService.init(window.PusherKey,"/auth/pusher"),PusherInstance=PusherService.subscribe(NewsConfig.PUSHER_CHANNEL))},this.destroy=function(){PusherInstance&&(PusherInstance=null,PusherService.destroy(),init=!1)},this.on=function(callback){return PusherInstance||this.create(),PusherInstance.onFresh(NewsConfig.UPDATE_EVENT,callback)},this.removeListener=function(x){_.isFunction(x)&&x()}}]),angular.module("app.news").service("NewsService",["_","moment",function(_,moment){"use strict";this.formatDate=function(date){return date.format("YYYY-MM-DD")},this.fromNow=function(filters){return _.assign(filters,{from:this.formatDate(moment()),to:filters.from})},this.fromPrevious=function(filters,days){days=days||1;var toDate=filters.to?moment(filters.to):moment(),fromDate=moment(toDate).subtract(days,"days");return _.assign(filters,{from:this.formatDate(fromDate),to:this.formatDate(toDate)})},this.toPrevious=function(filters,days){days=days||1;var fromDate=moment(filters.from).subtract(days,"days");return _.assign(filters,{from:this.formatDate(fromDate),to:filters.from})},this.toNext=function(filters){var toDate=moment(filters.from).add(1,"day");return _.assign(filters,{from:filters.from,to:this.formatDate(toDate)})},this.expanderExtremes=function(filters,lastDate){if(moment(filters.from)>moment(lastDate)){var fromDate=moment(lastDate).add(1,"day");return{from:this.formatDate(fromDate),to:filters.from}}return{}},this.flattenPusherData=function(data){var collection=_(data).map(function(x){return x.date=moment(x.article_date).format("YYYY-MM-DD"),x}).value();return _(collection).orderBy("date").map("date").uniq().value()},this.addAntiCache=function(filters){return _.assign({ts:moment().format("YYYYMMDDHHmmss")},filters)},this.getVisited=function(data){return _.map(data,function(x){x.date=x.read.split(" ")[0]}),{visited:_.map(data,"id"),lastRead:_.sortBy(data,["date"]).pop()}}}]),angular.module("app.news").factory("NewsStore",["_","DataService","moment",function(_,DataService,moment){"use strict";function Store(){var self=this,struct={config:{visited:[],lastArticleId:0,lastActivityDate:""},filters:{from:null,to:moment().add(1,"day").format("YYYY-MM-DD")},items:[],articleList:[]},version=moment().format("XX");this.setVisited=function(data){struct.config.visited=_.union(struct.config.visited,data)},this.setLastId=function(id){struct.config.lastId=id},this.setLastDate=function(date){struct.config.lastActivityDate=date},this.getLastDate=function(date){return struct.config.lastActivityDate},this.getFilters=function(){return _.assign({},struct.filters)},this.setFilters=function(filters){return _.assign(struct.filters,filters)},this.get=function(){return struct.items},this.append=function(data){data=this.mergeVisited(data),DataService.addTrackBy(data,"date",version);var dates=_.map(struct.items,"date");_.map(data,function(x){_.includes(dates,x.date)||struct.items.push(x||[])}),self.updateArticleList()},this.replace=function(data){data=this.mergeVisited(data),DataService.addTrackBy(data,"date",version);var selected=null;_.map(data,function(x){selected=_.find(struct.items,["date",x.date]),selected?selected.articles=x.articles:struct.items.unshift(x||[])}),self.updateArticleList()},this.updateArticleList=function(data){struct.articleList=_(struct.items).map("articles").flatten().value()},this.mergeVisited=function(data){return _.map(data,function(collection){collection.last=struct.config.lastActivityDate===collection.date,_.map(collection.articles,function(article){return article.flag=_.includes(struct.config.visited,article.id),article.last=struct.config.lastId===article.id,article})}),data},this.getItem=function(articleId,direction){var currentIndex=_.findIndex(struct.articleList,["id",articleId]),newId=direction>0?currentIndex+1:currentIndex-1;return newId>=0&&newId<struct.articleList.length?(struct.articleList[newId].flag=!0,struct.articleList[newId]):null}}var currentStore=null;return{get:function(){return currentStore||(currentStore=new Store),currentStore},rebuild:function(){return currentStore=new Store}}}]),function(){function NewsScrollTopController($scope,DomService,NewsConfig,NewsEvent){function $onInit(){function onScroll(){(current=DomService.getBodyScroll()>NewsConfig.SCROLL_TOP_THRESHOLD)!==previous&&(previous=current,$scope.$apply(function(){$ctrl.show=current}))}$ctrl.show=!1,scrollListener=ScrollChannel.subscribe(onScroll)}function $onDestroy(){scrollListener&&scrollListener.dispose()}function handleClick(){DomService.resetScroll()}var $ctrl=this,ScrollChannel=NewsEvent.WINDOW_SCROLL,current=null,previous=null,scrollListener=null;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleClick=handleClick}var newsScrollTopComponent={templateUrl:"/assets-access-layer/js/site/News/components/news-scroll-top.component.html",bindings:{wrapperClass:"@",componentClass:"@"},controller:NewsScrollTopController};angular.module("app.news").component("newsScrollTop",newsScrollTopComponent)}(),angular.module("app.payment").constant("PaymentModals",{FATAL_ERROR:"/templates/Accounts/Modal:fatal_error"}),angular.module("app.payment").constant("StripeConfig",{BASE_LIB:"https://js.stripe.com/v2/"}),angular.module("app.payment").service("PaymentApi",["GenericApiFactory","Routes",function(GenericApiFactory,Routes){"use strict";var PaymentApi;this.init=function(uri){PaymentApi||(PaymentApi=new GenericApiFactory(uri))},this.create=function(data){return PaymentApi.post(data)}}]),angular.module("app.payment").service("PaymentStream",["$window","LazyStream","Stream",function($window,LazyStream,Stream){"use strict";return{USER_DATA_CHANGED:new LazyStream,CARD_DATA_CHANGED:new LazyStream,COUPON_CHANGED:new LazyStream,STRIPE_LOADED:new LazyStream,STRIPE_ERROR:new LazyStream,FORM_SUBMIT_ATTEMPT:new Stream}}]),angular.module("app.payment").service("StripeService",["_","$log","$q","StripeConfig","PaymentStream","ScriptLoadService",function(_,$log,$q,StripeConfig,PaymentStream,ScriptLoadService){"use strict";this.init=function(publishableKey){var deferred=$q.defer();return _.isEmpty(publishableKey)?(deferred.reject("Stripe publishable key is not set!"),deferred.promise):(ScriptLoadService.addScriptTag(StripeConfig.BASE_LIB).then(function(){$log.debug("StripeService::setStripeKey:: Setting publishable key: %s ",publishableKey),deferred.resolve(),Stripe.setPublishableKey(publishableKey),PaymentStream.STRIPE_LOADED.onNext()}).catch(function(e){deferred.reject(e),PaymentStream.STRIPE_ERROR.onNext(e),PaymentStream.STRIPE_ERROR.onCompleted()}),deferred.promise)},this.createToken=function(cardData){var deferred=$q.defer();return Stripe.card.createToken(cardData,function(status,response){200==status?($log.debug("StripeService::createToken:: Data Received: ",null,response),deferred.resolve(response)):($log.debug("StripeService::createToken:: Error: ",null,response),deferred.reject(response))}),deferred.promise}}]),function(){"use strict";function PaymentFormController(_,$timeout,FormServiceFactory){function $onInit(){$ctrl.form={ref:null,data:formData,isValid:!1}}function $onChanges(changesObj){changesObj.triggerSubmit&&!changesObj.triggerSubmit.isFirstChange()&&onFormSubmitAttempt()}function $postLink(){FormService=new FormServiceFactory($ctrl.form)}function onFormFieldChange(){$timeout(function(){var formChangedPayload={formData:_.clone(formData),isValid:FormService.isValid()};_.isEqual(formChangedPayload,lastEmittedPayload)||(lastEmittedPayload=formChangedPayload,$ctrl.onChange({$event:formChangedPayload}))})}function onFormSubmitAttempt(){FormService.canSubmit()}var lastEmittedPayload,FormService,$ctrl=this,formData={};$ctrl.$onInit=$onInit,$ctrl.$postLink=$postLink,$ctrl.$onChanges=$onChanges,$ctrl.onFormFieldChange=onFormFieldChange}var paymentFormComponent={templateUrl:"/assets-access-layer/js/shared/Payment/templates/payment-form.template.html",bindings:{defaultFirstName:"<",defaultLastName:"<",triggerSubmit:"<",onChange:"&"},controller:PaymentFormController};angular.module("app.payment").component("paymentForm",paymentFormComponent)}(),function(){"use strict";function PaymentWrapperController(_,$log,$q,$timeout,authStream,courseEnrolmentService,EventManagerUtility,StripeService,PaymentApi,PaymentStream,TrackerService,EDUCATION_EVENT,PaymentModals,UiModalService,UiTemplates,storageService,UrlService,CONSENT_JOURNEY,userPermissionsApi,trackService){function $onInit(){$ctrl.userIsAllowedToPay=!1,$ctrl.payWithCoupon=!1,$ctrl.error={type:null,message:null},listeners.push(authStream.USER_CHANGED.subscribe(onUserChanged),PaymentStream.COUPON_CHANGED.subscribe(onCouponChanged),PaymentStream.STRIPE_LOADED.subscribe(onStripeLoaded)),StripeService.init($ctrl.stripePublishableKey).catch(function(e){fatalErrorAction(e),$log.error(e)}),PaymentApi.init($ctrl.createUrl)}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function onCouponChanged(data){$ctrl.coupon=data,$ctrl.payWithCoupon=0===_.get(data,"price",null),form.coupon.code=_.get(data,"code","")}function onStripeLoaded(){$ctrl.isLoaded=!0}function onUserFormChanged(data){form.user=data.formData,userFormValid=data.isValid}function onPaymentFormChanged(data){form.card=data.formData,cardDataFormValid=data.isValid}function canSubmit(){$ctrl.triggerSubmit=!$ctrl.triggerSubmit;var isValid,isUserFormValid=!0===$ctrl.userData.isLoggedIn||userFormValid;return isValid=$ctrl.payWithCoupon?isUserFormValid:cardDataFormValid&&isUserFormValid,isValid=isValid&&form.consents.isValid,$log.debug("paymentWrapperController::canSubmit::isValid[%s]",isValid,form),isValid||(showFormValidationError(),form.consents.isValid||($ctrl.consentErrors=form.consents)),isValid&&$ctrl.hasEssentialCourseAccess&&(showHasEssentialCourseAccessError(),isValid=!1),TrackerService.track(EDUCATION_EVENT.DOMAIN,"CourseEnrollment.CoursePaymentPage",{Label:["PaymentButton","MainColumn","Static","CTAButton","Course["+$ctrl.courseTranslationId+"]",isValid?"PaymentValidFormSubmit":"PaymentInvalidFormSubmit"].join(".")},"click"),isValid}function executeCardPayment(){function onStripeSuccess(response){return $log.debug("CreateStripeToken:: Got token",response,form),createPayment({token:response.id,card:response.card,coupons:form.coupon.code?[form.coupon.code]:[],firstname:form.user.firstname,lastname:form.user.lastname,email:form.user.email,password:form.user.password,consents:_.get(form,"consents.formData"),journey_id:$ctrl.consentJourneyId})}function onStripeError(response){return $log.error("PaymentForm::createStripeToken:: Error",response),TrackerService.track(EDUCATION_EVENT.DOMAIN,"CourseEnrollment.CoursePaymentPage",{Label:["PaymentButton","MainColumn","Static","CTAButton","Course["+$ctrl.courseTranslationId+"]","PaymentSubmitCardTokenError"].join(".")},"click"),fatalErrorAction(response),$q.reject()}return StripeService.createToken({number:form.card.number,cvc:form.card.cvc,exp_month:form.card.exp_month,exp_year:form.card.exp_year}).then(onStripeSuccess,onStripeError)}function executeCouponPayment(){return createPayment({email:form.user.email,password:form.user.password,firstname:form.user.firstname,lastname:form.user.lastname,coupons:form.coupon.code?[form.coupon.code]:[],consents:_.get(form,"consents.formData"),journey_id:$ctrl.consentJourneyId})}function createPayment(response){function onPaymentSuccess(paymentResponse){$log.debug("PaymentForm::createPayment:: Payment successful",paymentResponse),TrackerService.track(EDUCATION_EVENT.DOMAIN,"CourseEnrollment.CoursePaymentPage",{Label:["PaymentButton","MainColumn","Static","CTAButton","Course["+$ctrl.courseTranslationId+"]","PaymentSuccessful"].join("."),courseTranslationId:$ctrl.courseTranslationId,courseName:$ctrl.productTitle},"click"),trackService.track({subject:"user",action:"purchase",object:"course",objectId:$ctrl.courseId}),paymentConfirmed(paymentResponse)}function onPaymentError(paymentResponse){return $log.debug("PaymentForm::createPayment:: Payment failed",paymentResponse),showServerError(paymentResponse.data.message),$q.reject()}function paymentConfirmed(response){$log.debug("PaymentForm::paymentConfirmed::redirect",response,response.data.redirect_url),storageService.set(storageService.KEY.USER_REGISTRATION_EMAIL,form.user.email),response.data.activation_redirect_url&&UrlService.setUrlToCache(response.data.activation_redirect_url),$timeout(function(){UrlService.changeUrl(response.data.redirect_url)},1e3)}return PaymentApi.create(response).then(onPaymentSuccess,onPaymentError)}function submit(){return $ctrl.payWithCoupon?executeCouponPayment():executeCardPayment()}function clearErrors(){$ctrl.error={type:null,message:null}}function showFormValidationError(){$ctrl.error.type="FORM_VALIDATION_ERROR"}function showServerError(message){$ctrl.error.type="SERVER_ERROR",$ctrl.error.message=message}function showHasEssentialCourseAccessError(){$ctrl.error.type="HAS_ESSENTIAL_COURSE_ACCESS_ERROR",$ctrl.error.courseKey=$ctrl.courseKey}function fatalErrorAction(data){UiModalService.openModal({controller:"ModalGenericController",template:PaymentModals.FATAL_ERROR,backdrop:"static",keyboard:!1}),TrackerService.track(EDUCATION_EVENT.DOMAIN,"CourseEnrollment.CoursePaymentPage",{Label:["PaymentButton","MainColumn","Static","CTAButton","Course["+$ctrl.courseTranslationId+"]","PaymentFatalErrorModalOpen"].join(".")},"click")}function onUserChanged(user){clearErrors(),$ctrl.userData.isLoggedIn=user.isLoggedIn(),$ctrl.userData.email=user.email,$ctrl.userData.firstName=user.firstname,$ctrl.userData.lastName=user.lastname,checkForCourseEnrolments(user),checkForCourseAvailability(user),$ctrl.buyingGift?$ctrl.consentJourneyId=$ctrl.userData.isLoggedIn?CONSENT_JOURNEY.CoursePurchaseLoggedinPurchaseGift:CONSENT_JOURNEY.CoursePurchaseAnonymousPurchaseGift:$ctrl.consentJourneyId=$ctrl.userData.isLoggedIn?CONSENT_JOURNEY.CoursePurchaseLoggedinPurchase:CONSENT_JOURNEY.CoursePurchaseAnonymousPurchase}function checkForCourseEnrolments(user){function onEnrolmentStatusReceived(res){res.enrolled?($ctrl.userIsAllowedToPay=!1,UiModalService.openModal({controller:"redirectModalController",template:UiTemplates.REDIRECT_MODAL,backdrop:"static",keyboard:!1},{redirectUrl:res.url,title:"You are already enrolled",message:"You are already enrolled to this course."})):$ctrl.userIsAllowedToPay=!0}$ctrl.buyingGift?$ctrl.userIsAllowedToPay=!0:user.isLoggedIn()?courseEnrolmentService.isUserEnroled($ctrl.redirectUrl).then(onEnrolmentStatusReceived):$ctrl.userIsAllowedToPay=!0}function checkForCourseAvailability(user){function onUserPermissionsResponse(res){_.forEach(res,function(permissions){_.indexOf(permissions,"memberships.essential-courses-access")>=0&&($ctrl.hasEssentialCourseAccess=!0,showHasEssentialCourseAccessError())})}user.isLoggedIn()&&userPermissionsApi.get().then(onUserPermissionsResponse)}function onConsentsChange(event){form.consents=event}var $ctrl=this,listeners=[],form={card:{number:null,cvc:null,exp_month:null,exp_year:null},user:{firstname:null,lastname:null,email:null,password:null},coupon:{code:null},consents:{}},userFormValid=!1,cardDataFormValid=!1;$ctrl.userData={},$ctrl.triggerSubmit=!1,$ctrl.hasEssentialCourseAccess=!1,$ctrl.consentErrors=[],$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.onUserFormChanged=onUserFormChanged,$ctrl.onPaymentFormChanged=onPaymentFormChanged,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,$ctrl.onConsentsChange=onConsentsChange}var paymentWraperComponent={templateUrl:"/assets-access-layer/js/shared/Payment/components/payment-wrapper.html",transclude:!0,bindings:{createUrl:"@",currencySymbol:"@",currencyCode:"@",price:"@",productTitle:"@",redirectUrl:"@",buyingGift:"<",showCoupons:"<",stripePublishableKey:"@",courseTranslationId:"@",courseId:"@",courseKey:"@"},controller:PaymentWrapperController};angular.module("app.payment").component("paymentWrapper",paymentWraperComponent)}(),function(){"use strict";function CouponFormController($log,$q,EventManagerUtility,FormServiceFactory,PaymentStream,CouponApi,TrackerService,PAYMENT_EVENT){function $onInit(){$ctrl.form={ref:null,data:{coupon:null}},$ctrl.isCouponWrapperOpen=!0,FormService=new FormServiceFactory($ctrl.form)}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function canSubmit(){var valid=FormService.canSubmit();return TrackerService.track(PAYMENT_EVENT.DOMAIN,valid?"PaymentCouponValid":"PaymentCouponInvalid"),valid}function submit(){var deferred=$q.defer();return CouponApi.get({coupon:$ctrl.form.data.coupon}).then(function(data){data.discount=calculateDiscount(data,$ctrl.price),data.price=$ctrl.price-data.discount,PaymentStream.COUPON_CHANGED.onNext(data),$log.debug("CouponForm::submit:: Coupon data recieved",data),0===data.price&&($ctrl.isCouponWrapperOpen=!1),deferred.resolve(data)},function(){$log.debug("CouponForm::submit:: Invalid coupon"),deferred.reject()}),deferred.promise}function calculateDiscount(coupon,price){var discount=0,couponAmount=parseFloat(coupon.amount);switch(price=parseFloat(price),coupon.type){case"percentage":discount=price*couponAmount/100;break;case"fixed_amount":discount=couponAmount}return handlePaymentMinAmount(discount,price)}function handlePaymentMinAmount(discount,price){var difference=price-discount;return 0<difference&&difference<.5?discount-(.5-difference):discount}var FormService,$ctrl=this,listeners=[];$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit}var couponFormComponent={templateUrl:function(CouponTemplates){return CouponTemplates.COUPON_FORM},bindings:{price:"<"},controller:CouponFormController};angular.module("app.coupon").component("couponForm",couponFormComponent)}(),angular.module("app.coupon").constant("CouponTemplates",{COUPON_FORM:"/templates/Coupons/coupon_form"}),angular.module("app.coupon").service("CouponApi",["_","GenericApiFactory","Routes","DataService",function(_,GenericApiFactory,Routes,DataService){"use strict";var CouponApi=new GenericApiFactory(Routes.COUPON.ROOT);this.get=function(data){return CouponApi.get(data).then(function(response){return _.pick(DataService.remapObject(response.data,{coupon_code:"code",coupon_amount:"amount",coupon_description:"description",coupon_discount_type_key:"type"}),["code","amount","description","type"])})}}]),function(){"use strict";function EducationBackToCourseButton(GenericApiFactory,EducationApiConstants,UrlService,courseStream){function onCourseEnrollmentData(courseData){$ctrl.isVisible=0===parseInt(courseData.is_expired,10)}var $ctrl=this,ThinkificApi=null;$ctrl.$onInit=function(){$ctrl.isVisible=!1,ThinkificApi=new GenericApiFactory(EducationApiConstants.PROXY_URL,{courseTranslationId:$ctrl.id,state:"started-active"}),courseStream.COURSE_ENROLLMENT_DATA.subscribe(onCourseEnrollmentData)},$ctrl.handleClick=function(){ThinkificApi.get().then(function(response){UrlService.changeUrl(response.data.url)})}}EducationBackToCourseButton.$inject=["GenericApiFactory","EducationApiConstants","UrlService","courseStream"],angular.module("app.shared.education").component("educationBackToCourseButton",{template:'<button ng-if="$ctrl.isVisible" class="btn btn-danger btn-lg valign-middle" ng-click="$ctrl.handleClick()" ng-transclude=""></button>',transclude:!0,bindings:{id:"@"},controller:EducationBackToCourseButton})}(),angular.module("app.shared.education").component("educationGuardComponent",{template:'<education-main-component id="{{ $ctrl.id }}" slug="{{ $ctrl.courseKey }}"></education-main-component><auth-firewall status="{{ $ctrl.status }}" source="{{ $ctrl.source }}"></auth-firewall>',bindings:{id:"@",courseKey:"@",allowedStates:"@",source:"@",status:"@"},controller:["_","ChannelManager","EducationService","UiEvents","UrlService","Routes","EventManager","AuthEvents","EventManagerUtility",function(_,ChannelManager,EducationService,UiEvents,UrlService,Routes,EventManager,AuthEvents,EventManagerUtility){var ctrl=this,ChannelEventManager=ChannelManager.subscribe(EducationService.CHANNEL),listeners=[];listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){user.isLoggedIn()&&listeners.push(ChannelEventManager.on(UiEvents.INJECT_STATE,function(data){0===ctrl.allowedStates.split(",").map(_.trim).filter(function(permission){return!_.isEmpty(permission)&&permission===data.state}).length&&(UrlService.getCurrentPath()==data.url?UrlService.changeUrl(Routes.EDUCATION.EDUCATION_HOME_URL):UrlService.changeUrl(data.url))}))})),ctrl.$onDestroy=function(){EventManagerUtility.removeListeners(listeners)}}]}),angular.module("app.shared.education").component("educationMainComponent",{template:"<div></div>",bindings:{id:"@",slug:"@",name:"@",price:"@",primaryPrice:"@",userBillingCurrency:"@",labelModal:"@",labelDirect:"@"},controller:["_","EducationUrlService","UrlService","EventManager","AuthEvents","EventManagerUtility","authModalService","EducationService","ChannelManager","UiEvents","$http","EducationCourseProxyState","genericApi","intercomService",function(_,EducationUrlService,UrlService,EventManager,AuthEvents,EventManagerUtility,authModalService,EducationService,ChannelManager,UiEvents,$http,EducationCourseProxyState,genericApi,intercomService){var ctrl=this,ChannelEventManager=ChannelManager.subscribe(EducationService.CHANNEL),listener=null,listeners=[],userLoggedIn=!1,currentData=null,windowInstance=null,loadUrl=function(instantRedirect){return ChannelEventManager.emit(UiEvents.INIT_STATE,{}),instantRedirect=instantRedirect||!1,EducationUrlService.getUrl(ctrl.id).then(function(res){currentData=res.data,instantRedirect?UrlService.changeUrl(currentData.url):ChannelEventManager.emit(UiEvents.INJECT_STATE,_.assign({id:ctrl.id,label:res.data.enrolled?ctrl.labelDirect:"not_enrolled_course_library_access_paid"===res.data.state?"Enrol Now":ctrl.labelModal,price:res.data.enrolled?"":ctrl.price,primaryPrice:res.data.enrolled?"":ctrl.primaryPrice,userBillingCurrency:res.data.enrolled?"":ctrl.userBillingCurrency,name:ctrl.name,slug:ctrl.slug},res.data)),EducationUrlService.autoOpenPayment&&(autoOpen(),EducationUrlService.autoOpenPayment=!1)})},autoOpen=function(){ChannelEventManager.emit(UiEvents.CHANGE_STATE,{id:ctrl.id})},messageListener=function(e){switch(e.data.event){case"CLOSE":_.has(e.data,"redirectTo")?UrlService.changeUrl(e.data.redirectTo):loadUrl();break;case"RELOAD_SSO":loadUrl();break;case"REOPEN_MODAL":windowInstance&&windowInstance.close(),ChannelEventManager.emit(UiEvents.CHANGE_STATE,{id:ctrl.id});break;case"PAYMENT_SUCCESSFUL":hideModalCloseButton();break;case"LOGGED_IN":ChannelEventManager.emit(UiEvents.MODAL_CHANGE_URL,{url:currentData.url}),currentData.state!==EducationCourseProxyState.NOT_COMPLETED_PROFILE&&currentData.state!==EducationCourseProxyState.NOT_ENROLLED_FREE||hideModalCloseButton(),windowInstance.result.catch(function(){loadUrl(),EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!1})});break;case"NOT_LOGGED_IN":UrlService.changeUrl(currentData.login_loopback+encodeURIComponent(UrlService.getCurrentUrl()+"?action="+EducationService.MODAL_ACTION))}},hideModalCloseButton=function(){ChannelEventManager.emit(UiEvents.MODAL_TOGGLE_CLOSE_BUTTON,{enabled:!1})},courseEnrollment=function(apiUrl){function onEnrollmentSuccess(){loadUrl(!0)}genericApi.post(apiUrl,{course_translation_id:_.toInteger(ctrl.id)}).then(onEnrollmentSuccess)};listeners.push(ChannelEventManager.onFresh(UiEvents.CHANGE_STATE,function(data){currentData.state===EducationCourseProxyState.NOT_ENROLLED_COURSE_LIBRARY_ACCESS_PAID?courseEnrollment(currentData.url):UrlService.changeUrl(currentData.url)})),ctrl.$onInit=function(){listener=window.addEventListener("message",messageListener,!1),listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){userLoggedIn=user.isLoggedIn(),loadUrl()}))},ctrl.$onDestroy=function(){window.removeEventListener("message",messageListener,!1),EventManagerUtility.removeListeners(listeners)}}]}),function(){"use strict";function EducationAllCoursesCardController(_,$q,authStream,membershipPlanApi,CurrencyConversionService,MembershipTypes,MembershipConfig,$element){function $onInit(){$ctrl.planCode="v1_yearly",$ctrl.showCard=!1,$ctrl.url=$ctrl.paymentPagePath,authListener=authStream.USER_DATA_CHANGED.subscribe(onUserChanged)}function onUserChanged(user){function onDataSuccess(response){var plan=response[0],prices=response[1];$ctrl.currency=_.get(plan,"currency"),$ctrl.currencySymbol=_.get(plan,"plan_data.prices.symbol"),$ctrl.yearlyPrice=_.get(plan,"plan_data.prices.original_yearly_price"),$ctrl.showCard=!$ctrl.isMember;var price=_.find(prices,["currency",$ctrl.currency]);$ctrl.singleCoursePrice=price.price,$ctrl.showCard?$element.addClass($ctrl.styling):$element.removeClass($ctrl.styling)}$ctrl.membershipPlan=user.getMembershipType(),$ctrl.isMember=user.hasMembership();var promises=[membershipPlanApi.get($ctrl.planCode),CurrencyConversionService.convert(MembershipConfig.SINGLE_COURSE_PRICE,MembershipConfig.SINGLE_COURSE_PRICE_CURRENCY)];$q.all(promises).then(onDataSuccess)}function $onDestroy(){authListener.dispose()}var authListener,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.displayPrice=function(price,showVATForEur){showVATForEur=!!_.isUndefined(showVATForEur)||showVATForEur;var formattedPrice="USD"===$ctrl.currency?"USD "+$ctrl.currencySymbol+price:$ctrl.currencySymbol+price;return"EUR"===$ctrl.currency&&showVATForEur&&(formattedPrice+=" + VAT"),formattedPrice}}var educationAllCoursesCardComponent={templateUrl:"/assets-access-layer/js/shared/Education/Component/education-all-courses-card.template.html",bindings:{styling:"@",paymentPagePath:"@"},controller:EducationAllCoursesCardController};angular.module("app.shared.education").component("educationAllCoursesCard",educationAllCoursesCardComponent)}(),function(){"use strict";function EducationEnrollButtonController(_,EventManagerUtility,ChannelManager,EducationService,UiEvents,InputUtil,trackService){function $onInit(){$ctrl.label="",$ctrl.camelCaseLabel="",$ctrl.price="",$ctrl.primaryPrice="",$ctrl.priceVisible=InputUtil.toBoolean($ctrl.showPrice),$ctrl.showPrimaryPrice=!1,$ctrl.userBillingCurrency="",$ctrl.trackerDataLoaded=!1,$ctrl.responseData={},channelEventManager=ChannelManager.subscribe(EducationService.CHANNEL),listeners=[],listeners.push(channelEventManager.on(UiEvents.INIT_STATE,function(){$ctrl.trackerDataLoaded=!1})),listeners.push(channelEventManager.on(UiEvents.INJECT_STATE,function(data){data.id===$ctrl.id&&($ctrl.label=data.label,$ctrl.camelCaseLabel=_.camelCase(data.label),$ctrl.price=$ctrl.primaryPrice="",""!==data.price&&($ctrl.price=data.price),$ctrl.priceCurrencySymbol="$",$ctrl.priceCurrencyTextSymbol="USD",""!==data.primaryPrice&&($ctrl.primaryPrice=data.primaryPrice),$ctrl.primaryPriceCurrencySymbol="",$ctrl.showPrimaryPrice="GBP"===data.userBillingCurrency,$ctrl.userBillingCurrency="GBP"===data.userBillingCurrency?"GBP":"USD",$ctrl.trackerDataLoaded=!0,$ctrl.responseData=data)}))}function $onDestroy(){EventManagerUtility.removeListeners(listeners)}function handleClick(){"enrolNow"===$ctrl.camelCaseLabel&&trackService.track({subject:"user",action:"enroll",object:"course",objectId:$ctrl.id}),channelEventManager.emit(UiEvents.CHANGE_STATE,{id:$ctrl.id}),$ctrl.trackerDataLoaded=!1}var listeners,channelEventManager,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.handleClick=handleClick}EducationEnrollButtonController.$inject=["_","EventManagerUtility","ChannelManager","EducationService","UiEvents","InputUtil","trackService"];var educationEnrollButtonComponent={templateUrl:"/assets-access-layer/js/shared/Education/Component/education-enroll-button.html",controller:EducationEnrollButtonController,bindings:{id:"@",showPrice:"@",priceClass:"@",buttonLocation:"@"}};angular.module("app.shared.education").component("educationEnrollButton",educationEnrollButtonComponent)}(),angular.module("app.shared.education").constant("EducationApiConstants",{PROXY_URL:"/xhr/education/courses/:courseTranslationId/proxy"}),angular.module("app.shared.education").constant("EducationService",{CHANNEL:"EducationChannel",ENROLLMENT_REGISTER_SOURCE:"education-enrollment",MODAL_ACTION:"enroll"}).constant("EducationApiRoute",{PROXY_URL:"/xhr/education/courses/:courseId/proxy"}),function(){"use strict";angular.module("app.shared.education").constant("EducationCourseProxyState",{NOT_ENROLLED_COURSE_LIBRARY_ACCESS_PAID:"not_enrolled_course_library_access_paid",NOT_ENROLLED_FREE:"not_enrolled_free",NOT_COMPLETED_PROFILE:"not_completed_profile"})}(),angular.module("app.shared.education").service("EducationUrlService",["UiModalService","EducationApiConstants","GenericApiFactory",function(UiModalService,EducationApiConstants,GenericApiFactory){"use strict";var EducationApi=new GenericApiFactory(EducationApiConstants.PROXY_URL,{});this.getUrl=function(courseTranslationId){return EducationApi.get({courseTranslationId:courseTranslationId})},this.autoOpenPayment=!1}]),angular.module("app.shared.education").service("courseStream",["LazyStream",function(LazyStream){"use strict";return{COURSE_ENROLLMENT_DATA:new LazyStream}}]),function(){"use strict";function LocalStorageUserEmailController(storageService){function $onInit(){$ctrl.email=storageService.get(storageService.KEY.USER_REGISTRATION_EMAIL)}function $onDestroy(){}var $ctrl=this;$ctrl.$onDestroy=$onDestroy,$ctrl.$onInit=$onInit}var localStorageUserEmailComponent={template:'<span ng-if="$ctrl.email">{[{ $ctrl.email }]}</span>',controller:LocalStorageUserEmailController};angular.module("app.site.user").component("localStorageUserEmail",localStorageUserEmailComponent)}(),function(){"use strict";function UserConsentJobAlertsController(_,storageService,$q,authStream,QueryFilterApi,UrlService,userConsentApi,jobAlertsCriteriaApi,CONSENT_JOURNEY,FormServiceFactory,registrationApi,UiModalService,TrackerService,CAREERS_EVENT){function $onInit(){function onJobAlertsCriteriaSuccess(data){$ctrl.jobAlertsCriteria=data}$ctrl.form={ref:null},$ctrl.formModel={},$ctrl.userData={},$ctrl.userJobAlerts=[],$ctrl.jobAlertsCriteria={},$ctrl.filtersValid=!0,$ctrl.submitted=!1,$ctrl.hasJobAlerts=!1,$ctrl.consentsForm={},$ctrl.requestLocation=UrlService.parseQuery().location?UrlService.parseQuery().location:"NoLocation";var initialFilters=storageService.get(storageService.KEY.JOB_ALERTS_FILTERS);$ctrl.filters=_.assign({countries:[],functions:[],levels:[],cities:[]},initialFilters),authSubscription=authStream.USER_DATA_CHANGED.subscribe(onUserDataChanged),jobAlertsCriteriaApi.get().then(onJobAlertsCriteriaSuccess),FormService=new FormServiceFactory($ctrl.form)}function $onDestroy(){authSubscription.dispose()}function onUserDataChanged(user){function onQueryFilterGetSuccess(response){$ctrl.hasJobAlerts=response.data&&!_.isEmpty(response.data)}user.isLoggedIn()?($ctrl.consentJourneyId=CONSENT_JOURNEY.JobAlertsSubscribe,$ctrl.userEmail=user.email,$ctrl.userLoggedIn=user.isLoggedIn(),QueryFilterApi.get().then(onQueryFilterGetSuccess)):$ctrl.consentJourneyId=CONSENT_JOURNEY.JobAlertsSubscribeWithRegistration}function canSubmit(){return validateFilters(),$ctrl.submitted=!0,$ctrl.filtersValid&&FormService.canSubmit()}function submit(){function postFilters(){return QueryFilterApi.post({filters:filters})}function onSuccess(){storageService.remove(storageService.KEY.JOB_ALERTS_FILTERS),UrlService.changeUrl(buildRedirectLink())}function onError(error){return $ctrl.errors={type:"SERVER_ERROR",message:error.data.message},$q.reject(error)}if($ctrl.triggerTracking=!0,$ctrl.userLoggedIn){var filters=buildFilters();return TrackerService.track(CAREERS_EVENT.DOMAIN,"JobAlert",{Label:"JobAlertConfirmation.ConsentsPage.From"+$ctrl.requestLocation+".CreateJobAlert"}),updateConsents().then(postFilters).then(onSuccess,onError)}return TrackerService.track(CAREERS_EVENT.DOMAIN,"JobAlert",{Label:"JobAlertConfirmation.ConsentsPage.From"+$ctrl.requestLocation+".NewUser.CreateJobAlert"}),registerUserWithJobAlerts().then(onRegistrationSuccess,onError)}function registerUserWithJobAlerts(){return registrationFormData=_.pick($ctrl.formModel,["firstname","lastname","email","password","title","location_country_id"]),registrationFormData.location_city_id=_.get($ctrl.formModel,"location_city.id"),registrationFormData.location_city_title=_.get($ctrl.formModel,"location_city.title"),registrationFormData.job_alerts=[],_.forEach(_.keys(filterSubmitMappings),function(filterType){_.forEach($ctrl.filters[filterType],function(filter){registrationFormData.job_alerts.push({filter_type_key:filterSubmitMappings[filterType],filter_value:parseInt(filter.id,10)})})}),registrationFormData.journey_id=$ctrl.consentJourneyId,registrationFormData.consents=$ctrl.consentsForm.formData,registrationFormData.source="JobAlertsRegistration",registrationFormData.source_params=null,registrationApi.register(registrationFormData)}function onRegistrationSuccess(response){function redirectToJobSearchPage(){storageService.remove(storageService.KEY.JOB_ALERTS_FILTERS),UrlService.changeUrl(buildRedirectLink())}authStream.USER_SIGNUP.onNext(response.data),UiModalService.openModal({controller:"ModalGenericController",template:"/assets-access-layer/js/shared/Auth/templates/complete-registration-check-email.html",backdrop:"static",keyboard:!1}).then(redirectToJobSearchPage)}function buildFilters(){function reduceFilters(filters,filter,key){var filterId=filterKeyMappings[key];return _.forEach(filter,function(item){filters.push({filter_type_id:filterId,filter_value:parseInt(item.id)})}),filters}return _.reduce($ctrl.filters,reduceFilters,[])}function addLocation(value){var locationType=allowedLocationTypes[value.type]||!1;locationType&&_.includes(allowedLocationTypes,locationType)&&($ctrl.filters[locationType].push({id:value.id,title:value.title}),validateFilters())}function removeLocation($item,locationType){_.includes(allowedLocationTypes,locationType)&&(_.remove($ctrl.filters[locationType],function(location){return location.id===$item.id}),validateFilters())}function onFunctionChange(){$ctrl.filters.functions.push($ctrl.selectedFunction),_.remove($ctrl.jobAlertsCriteria.functions,{id:$ctrl.selectedFunction.id}),$ctrl.selectedFunction=null,validateFilters()}function removeFunction($item){_.remove($ctrl.filters.functions,{id:$item.id}),$ctrl.jobAlertsCriteria.functions.push({id:$item.id,title:$item.title}),validateFilters()}function onLevelChange(){$ctrl.filters.levels.push($ctrl.selectedLevel),_.remove($ctrl.jobAlertsCriteria.levels,{id:$ctrl.selectedLevel.id}),$ctrl.selectedLevel=null,validateFilters()}function removeLevel($item){_.remove($ctrl.filters.levels,{id:$item.id}),$ctrl.jobAlertsCriteria.levels.push({id:$item.id,title:$item.title}),validateFilters()}function validateFilters(){$ctrl.submitted=!1,$ctrl.filtersValid=$ctrl.filters.functions.length||$ctrl.filters.levels.length||$ctrl.filters.countries.length||$ctrl.filters.cities.length}function buildRedirectLink(){function mapId(item){return item.id}redirectUrl="/careers/jobs/search";var params={};return _.isEmpty($ctrl.filters.functions)||(params.function_type_ids=$ctrl.filters.functions.map(mapId).join(",")),_.isEmpty($ctrl.filters.cities)||(params.city_ids=$ctrl.filters.cities.map(mapId).join(",")),_.isEmpty($ctrl.filters.countries)||(params.country_ids=$ctrl.filters.countries.map(mapId).join(",")),_.isEmpty($ctrl.filters.levels)||(params.level_type_ids=$ctrl.filters.levels.map(mapId).join(",")),redirectUrl+UrlService.getQueryString(params)}function onConsentsChange(event){$ctrl.consentsForm=event}function updateConsents(){return userConsentApi.update($ctrl.consentsForm.formData,$ctrl.consentJourneyId)}var authSubscription,FormService,redirectUrl,$ctrl=this,allowedLocationTypes={country:"countries",city:"cities"},filterKeyMappings={cities:4,countries:1,functions:2,levels:3},filterSubmitMappings={cities:"city",countries:"country",levels:"level",functions:"function"},registrationFormData={};$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,$ctrl.addLocation=addLocation,$ctrl.removeLocation=removeLocation,$ctrl.onFunctionChange=onFunctionChange,$ctrl.removeFunction=removeFunction,$ctrl.onLevelChange=onLevelChange,$ctrl.removeLevel=removeLevel,$ctrl.onConsentsChange=onConsentsChange,$ctrl.consentErrors=[],$ctrl.triggerTracking=!1}var userConsentJobAlertsComponent={templateUrl:"/assets-access-layer/js/site/User/components/user-consent-job-alerts.html",controller:UserConsentJobAlertsController};angular.module("app.site.user").component("userConsentJobAlerts",userConsentJobAlertsComponent)}();!function(){"use strict";function UserPaymentConsentFormController(_,$q,authStream,FormServiceFactory,userProfileApi,UrlService,userConsentApi,CONSENT_JOURNEY){function $onInit(){$ctrl.showBanner=!1,$ctrl.userData={},$ctrl.isLoaded=!1,$ctrl.membershipType=null,$ctrl.form={ref:null,data:{email:null,title:null,firstname:null,lastname:null,job:null,company:null,location_country_id:null,location_city:null}},$ctrl.consentsForm={},FormService=new FormServiceFactory($ctrl.form),userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged)}function updateProfileData(){return userProfileApi.update($ctrl.form.data)}function onUserChanged(user){$ctrl.membershipType=user.getMembershipType(),loadUserData()}function loadUserData(){function onProfileApiGetSuccess(response){$ctrl.form.data.email=response.data.email,$ctrl.form.data.title=response.data.title,$ctrl.form.data.firstname=response.data.firstname,$ctrl.form.data.lastname=response.data.lastname,$ctrl.form.data.job=response.data.job,$ctrl.form.data.company=response.data.company,$ctrl.form.data.location_country_id=response.data.location_country_id,$ctrl.form.data.location_city=response.data.location_city,$ctrl.consentJourneyId="individual-yearly"===$ctrl.membershipType?CONSENT_JOURNEY.MembershipsPurchaseAnnualLoggedinConfigure:CONSENT_JOURNEY.MembershipsPurchaseMonthlyLoggedinConfigure,$ctrl.isLoaded=!0}return userProfileApi.get().then(onProfileApiGetSuccess)}function canSubmit(){return $ctrl.consentsForm.isValid||($ctrl.consentErrors=$ctrl.consentsForm),FormService.canSubmit()&&$ctrl.consentsForm.isValid}function submit(){function onSuccess(){deferred.resolve(),$ctrl.showConfirmation=!0}function onError(error){$ctrl.errors={type:"SERVER_ERROR",message:error.data.message},deferred.reject()}$ctrl.triggerTracking=!0;var deferred=$q.defer();return $q.all([updateProfileData(),updateConsents()]).then(onSuccess).catch(onError),deferred.promise}function onConsentsChange(event){$ctrl.consentsForm=event}function updateConsents(){return userConsentApi.update($ctrl.consentsForm.formData,$ctrl.consentJourneyId)}function $onDestroy(){userChangedSub&&userChangedSub.dispose()}var userChangedSub,FormService,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit,$ctrl.onConsentsChange=onConsentsChange,$ctrl.consentErrors=[],$ctrl.triggerTracking=!1,$ctrl.showConfirmation=!1}var userPaymentConsentFormComponent={templateUrl:"/assets-access-layer/js/site/User/components/user-payment-consent-form.html",transclude:{confirmationMessage:"confirmationMessage"},bindings:{orderNumber:"@",journeyContextId:"@"},controller:UserPaymentConsentFormController};angular.module("app.site.user").component("userPaymentConsentForm",userPaymentConsentFormComponent)}(),function(){"use strict";function UserRegistrationConfirmationFormController(_,$q,authStream,registrationApi,FormServiceFactory,authRegistrationService,userProfileApi,UrlService,userConsentApi,authService,MembershipTypes,CONSENT_JOURNEY){function $onInit(){$ctrl.token||UrlService.gotoHomepage(),$ctrl.showBanner=!1,$ctrl.userData={},$ctrl.isLoaded=!1,$ctrl.showStep="CONFIRMATION_FORM",$ctrl.membershipType=null,$ctrl.journeyContext=null,$ctrl.form={ref:null,data:{email:null,title:null,firstname:null,lastname:null,location_country_id:null,location_city:null}},$ctrl.consentsForm={},FormService=new FormServiceFactory($ctrl.form),userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged)}function canSubmit(){return $ctrl.consentsForm.isValid||($ctrl.consentErrors=$ctrl.consentsForm),FormService.canSubmit()&&$ctrl.consentsForm.isValid}function handleSave(){function authRegistrationServiceSuccess(){var deferred=$q.defer();return $q.all([updateProfileData(),updateConsents()]).then(function(){$ctrl.showStep="SUCCESS",deferred.resolve()}).catch(function(){deferred.reject()}),deferred.promise}function authRegistrationServiceError(){}return $ctrl.triggerTracking=!0,authRegistrationService.activateAccount($ctrl.token).then(authRegistrationServiceSuccess,authRegistrationServiceError)}function updateProfileData(){return userProfileApi.update($ctrl.form.data)}function onUserChanged(user){function registrationApiSuccess(response){$ctrl.form.data.firstname=response.firstname,$ctrl.form.data.lastname=response.lastname,$ctrl.form.data.title=response.title,$ctrl.form.data.email=response.email,$ctrl.form.data.location_country_id=response.location_country_id,$ctrl.membershipType=response.membership_variant_key,$ctrl.journeyContext=response.journey_context,$ctrl.consentJourneyId=$ctrl.membershipType===MembershipTypes.INDIVIDUAL_YEARLY_KEY?CONSENT_JOURNEY.MembershipsPurchaseAnnualAnonymousConfigure:CONSENT_JOURNEY.MembershipsPurchaseMonthlyAnonymousConfigure,$ctrl.isLoaded=!0}function registrationApiError(response){$ctrl.showStep=response.data.message,$ctrl.isLoaded=!0}!user.isLoggedIn()&&$ctrl.token&&(firstCheck=!1,$ctrl.membershipType=user.getMembershipType(),registrationApi.getUser({token:$ctrl.token}).then(registrationApiSuccess,registrationApiError)),user.isLoggedIn()&&firstCheck&&(firstCheck=!1,authService.logout())}function onConsentsChange(event){$ctrl.consentsForm=event}function updateConsents(){return userConsentApi.update($ctrl.consentsForm.formData,$ctrl.consentJourneyId)}function $onDestroy(){userChangedSub&&userChangedSub.dispose()}var userChangedSub,FormService,$ctrl=this,firstCheck=!0;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.canSubmit=canSubmit,$ctrl.handleSave=handleSave,$ctrl.onConsentsChange=onConsentsChange,$ctrl.consentErrors=[],$ctrl.triggerTracking=!1}var userRegistrationConfirmationFormComponent={templateUrl:"/assets-access-layer/js/site/User/components/user-registration-confirmation-form.html",bindings:{token:"@"},controller:UserRegistrationConfirmationFormController};angular.module("app.site.user").component("userRegistrationConfirmationForm",userRegistrationConfirmationFormComponent)}(),function(){"use strict";function userTypeGroupBeaconDirective(AuthEvents,EventManager,TrackerService,EventManagerUtility,USER_EVENT){function postLink(scope){function dispatchUserTypeGroupBeacon(user){var userTypeGroup=user.isLoggedIn()?user.hasMembership()?"Member":"NonMember":"Anonymous";TrackerService.track(USER_EVENT.DOMAIN,"Users.Impression",{Page:scope.page,Label:"UserTypeGroup."+userTypeGroup},"impression")}var listeners=[];listeners.push(EventManager.on(AuthEvents.USER_CHANGED,dispatchUserTypeGroupBeacon)),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}return{scope:{page:"@"},link:postLink}}userTypeGroupBeaconDirective.$inject=["AuthEvents","EventManager","TrackerService","EventManagerUtility","USER_EVENT"],angular.module("app.site.user").directive("userTypeGroupBeacon",userTypeGroupBeaconDirective)}(),angular.module("app.sticky_header").directive("stickyHeader",["Rx","$log","$window","$timeout","EventManager","StickyHeaderManager","DomService","AgentService","CoreEvents","UiEvents","EventManagerUtility","InputUtil","stickyStream","AuthEvents",function(Rx,$log,$window,$timeout,EventManager,StickyHeaderManager,DomService,AgentService,CoreEvents,UiEvents,EventManagerUtility,InputUtil,stickyStream,AuthEvents){"use strict";return{restrict:"E",template:'           <div class="sticky-container force-static-xs force-static-sm relative"                 ng-style="containerStyle">               <div class="sticky"                     ng-show="isVisible"                     ng-style="blockStyle"                     ng-class="blockClass" ng-transclude></div>           </div>',transclude:!0,scope:{id:"@",offset:"@",offsetMobile:"@",autoHide:"@",stackable:"@",lazy:"@",resizable:"@",fixedHeight:"@",fixedZIndex:"@",excludeDevice:"@",inactiveOnMobile:"@",dynamicOffset:"@",showOnTopOffset:"<"},replace:!0,link:function(scope,element){var isDeviceExcluded="mobile"===scope.excludeDevice&&AgentService.isMobilePhone(),listeners=[],defaultOffset=InputUtil.toInt(scope.offset),mobileOffset=InputUtil.toInt(scope.offsetMobile),el=element[0],box=el.children[0],boxTop=DomService.getAbsoluteTop(el),boxLeft=DomService.getLeft(box),containerHeight=scope.fixedHeight?parseInt(scope.fixedHeight):DomService.getHeight(el),containerWidth=DomService.getWidth(el),height=DomService.getHeight(box),newStatus=-1,oldStatus=-1,offset=AgentService.isMobile()&&mobileOffset?mobileOffset:defaultOffset,autoHide=scope.autoHide?parseInt(scope.autoHide,10):0,lazy="true"===scope.lazy,dynamicOffset="true"===scope.dynamicOffset,stackable="false"!==scope.stackable,resizable="true"===scope.resizable,zindex=void 0!==scope.fixedZIndex?scope.fixedZIndex:StickyHeaderManager.getZIndex(),id=scope.id||StickyHeaderManager.generateContainerId(),enabled=!0,lock=!1,stopper=null,topOffset=(document.documentElement,null);if(scope.blockStyle={},scope.blockClass={},stickyStream.BOF_PROFESSIONAL_STICKY_CHANGED.subscribe(function(data){dynamicOffset&&(offset=(AgentService.isMobile()&&mobileOffset?mobileOffset:defaultOffset)+data.offset)}),scope.containerStyle=isDeviceExcluded?{}:{width:"100%"},scope.showOnTopOffset){element.addClass("ng-hide");var subscription=Rx.Observable.fromEvent(document,"scroll").map(function(){return $window.scrollY<=scope.showOnTopOffset}).distinctUntilChanged().subscribe(function(toggle){toggle?element.addClass("ng-hide"):element.removeClass("ng-hide")});listeners.push(subscription)}scope.init=function(forceDigest){forceDigest=void 0===forceDigest||forceDigest,scope.setNewDimensions(!0),containerWidth=DomService.getWidth(el),oldStatus=-1,DomService.requestAnimationFrame(scope.refresh)},scope.setStatus=function(status){scope.isFixed!=status&&(scope.isFixed=status,stickyStream.STICKY_HEADER_CHANGED.onNext({id:id,fixed:scope.isFixed}),"mainNav"===id&&stickyStream.NAVIGATION_STICKY_HEADER_CHANGED.onNext({fixed:scope.isFixed}))},scope.isResetRequired=function(){return DomService.getWidth(!1)<=768&&"true"===scope.inactiveOnMobile},scope.resetStyling=function(){scope.blockStyle={},scope.blockClass="",newStatus=-1,oldStatus=-1,angular.extend(scope.containerStyle,{height:"auto",minHeight:height+"px"}),scope.$apply()},scope.refresh=function(event){if(scope.isResetRequired())return void scope.resetStyling();if(!lock){if(!enabled)return;resizable&&(height=DomService.getHeight(box)),stopper=StickyHeaderManager.getStopper(id,height+offset),topOffset=DomService.getTop(el),stopper&&scope.ifPositionedRelativeToBottomWouldItOverlapTop()?scope.postionRelativeToBottom():!stopper&&DomService.getTop(el)-offset+autoHide<=0?scope.positionFixedToTop():scope.positionRelativeToTop(),oldStatus!==newStatus&&(event&&scope.$apply(),oldStatus=newStatus),lock=!1}DomService.requestAnimationFrame(scope.refresh)},scope.ifPositionedRelativeToBottomWouldItOverlapTop=function(){return stopper-boxTop-height+topOffset-offset+DomService.getBodyScroll()>boxTop},scope.positionFixedToTop=function(){scope.isVisible=!0,isDeviceExcluded||(scope.blockStyle={position:"fixed",zIndex:zindex,width:containerWidth+"px",top:offset+"px",left:boxLeft},scope.showOnTopOffset&&(scope.blockStyle.width="100%")),scope.blockClass="sticky-fixed",scope.setStatus(!0),newStatus=2},scope.postionRelativeToBottom=function(){var paddingFromTopToSitToBottom=stopper-boxTop-height;scope.isVisible=!0,scope.setStatus(!1),scope.blockStyle={position:"relative",zIndex:zindex,width:containerWidth+"px",top:paddingFromTopToSitToBottom+"px",left:boxLeft},newStatus=1},scope.positionRelativeToTop=function(){scope.blockStyle={position:"relative",zIndex:zindex,width:containerWidth+"px",top:"0px"},scope.blockClass="",scope.setStatus(!1),newStatus=3,autoHide&&(scope.isVisible=!1)},scope.setNewDimensions=function(force){if((resizable||force)&&!isDeviceExcluded){if(boxTop=DomService.getAbsoluteTop(el),containerHeight=DomService.getHeight(el),containerWidth=DomService.getWidth(el),height=DomService.getHeight(box),boxLeft=DomService.getLeft(el),0===containerHeight)return;angular.extend(scope.containerStyle,{height:containerHeight+"px"})}},scope.isVisible=!autoHide,lazy?(enabled=!1,$timeout(function(){enabled=!0,scope.init(!0)},500)):scope.init(!0),stackable&&StickyHeaderManager.addContainer(id,el),scope.setStatus(!0),DomService.bind("resize",scope.init),listeners.push(EventManager.on(CoreEvents.REPAINT,function(data){scope.resetStyling(),$timeout(function(){scope.init(!1)},100)})),listeners.push(EventManager.on(UiEvents.REPAINT,function(data){scope.init(!1)},!1)),listeners.push(EventManager.on(AuthEvents.USER_CHANGED,function(user){scope.init(!1)})),scope.$on("$destroy",function(){EventManagerUtility.removeListeners(listeners)})}}}]),angular.module("app.sticky_header").service("StickyHeaderManager",["$log","DomService","ArrayService",function($log,DomService,ArrayService){"use strict";this.stoppers=[],this.containers=[],this.zindex=998,this.addStopperIfUnique=function(id,ref){var selected=ArrayService.select(this.stoppers,"id",id);selected?selected.ref=ref:(this.stoppers.push({id:id,ref:ref}),$log.debug("Adding stopper:"+id))},this.addStopper=function(id,ref){if(id)this.addStopperIfUnique(id,ref);else{var prev=this.getLastContainer();prev&&this.addStopperIfUnique(prev.id,ref)}},this.getStopper=function(id,height){var selected=null;return angular.forEach(this.stoppers,function(i){if(i.id===id&&DomService.getTop(i.ref)<height)return selected=DomService.getAbsoluteTop(i.ref),!1}),selected},this.addContainer=function(id,ref){var selected=(this.getLastContainer(),ArrayService.select(this.containers,"id",id));selected?selected.ref=ref:(this.containers.push({id:id,ref:ref}),$log.debug("Adding container:"+id))},this.getLastContainer=function(){return this.containers.slice(-1)[0]},this.generateContainerId=function(){return"container-"+this.containers.length},this.getZIndex=function(){return this.zindex-=1,this.zindex}}]),angular.module("app.sticky_header").directive("stickyHeaderStopper",["$log","StickyHeaderManager",function($log,StickyHeaderManager){"use strict";return{restrict:"E",link:function(scope,element,attrs){StickyHeaderManager.addStopper(attrs.id,element[0]),element.addClass("background-danger")}}}]),angular.module("app.sticky_header").directive("showWhenFixed",["stickyStream",function(stickyStream){"use strict";return{restrict:"A",scope:{id:"@showWhenFixed"},link:function(scope,element){function onStickyHeaderChanged(data){"mainNav"===data.id&&data.id===scope.id&&status!==data.fixed&&scope.changeStatus(data.fixed)}var status=null;element.addClass("show-when-fixed"),scope.changeStatus=function(fixedStatus){status=fixedStatus,status?element.addClass("show"):element.removeClass("show")},stickyStream.STICKY_HEADER_CHANGED.subscribe(onStickyHeaderChanged)}}}]),function(){"use strict";function stickyStream(LazyStream){return{STICKY_HEADER_CHANGED:new LazyStream,NAVIGATION_STICKY_HEADER_CHANGED:new LazyStream,BOF_PROFESSIONAL_STICKY_CHANGED:new LazyStream}}stickyStream.$inject=["LazyStream"],angular.module("app.sticky_header").factory("stickyStream",stickyStream)}(),angular.module("app.ui").constant("OwlCarouselConstant",{LIB:{JQUERY:"https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js",OWL_CAROUSEL:"https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.2.1/owl.carousel.min.js"},CONFIG:{loop:!1,margin:10,responsiveClass:!0,responsive:{0:{items:1,nav:!0},730:{items:3,nav:!0},1024:{items:4,nav:!0}},nav:!0,navText:['<a class="left carousel-control"><span class="icon-slider icon-rotate-180"></span></a>','<a class="right carousel-control"><span class="icon-slider"></span></a>']}}),function(){"use strict";function owlCarousel(_,$log,$q,owlCarouselService,OwlCarouselConstant){function postLink(scope,element,attrs){function getMergedConfigs(){var config=JSON.parse(JSON.stringify(OwlCarouselConstant.CONFIG));if(!_.isUndefined(scope.owlCarouselConfig)){var owlCarouselConfig=angular.fromJson(scope.owlCarouselConfig);_.each(owlCarouselConfig,function(attrname){config[attrname]=owlCarouselConfig[attrname]})}return config}owlCarouselService.init();var owlLibLoaded=owlCarouselService.ready();if(owlLibLoaded.then(function(){$log.debug("init owlCarousel"),void 0===scope.contentLoaded&&jQuery(element).owlCarousel(getMergedConfigs())}),void 0!==scope.contentLoaded){var contentLoaded=$q.defer();scope.$watch("contentLoaded",function(changes){changes&&contentLoaded.resolve()}),$q.all([owlLibLoaded,contentLoaded.promise]).then(function(results){jQuery(element).owlCarousel(getMergedConfigs())})}}return{restrict:"A",scope:{owlCarouselConfig:"@",contentLoaded:"<"},link:postLink}}owlCarousel.$inject=["_","$log","$q","owlCarouselService","OwlCarouselConstant"],angular.module("app.ui").directive("owlCarousel",owlCarousel)}(),function(){"use strict";function owlCarouselService(_,$log,$q,ScriptLoadService,OwlCarouselConstant){function init(){ScriptLoadService.addScriptTag(OwlCarouselConstant.LIB.JQUERY).then(function(){ScriptLoadService.addScriptTag(OwlCarouselConstant.LIB.OWL_CAROUSEL).then(function(){$log.debug("owlCarouselService and libraries initialized"),owlCarouselPromise.resolve()})})}function ready(){return owlCarouselPromise.promise}var owlCarouselPromise=$q.defer();return{init:_.once(init),ready:ready}}owlCarouselService.$inject=["_","$log","$q","ScriptLoadService","OwlCarouselConstant"],angular.module("app.ui").factory("owlCarouselService",owlCarouselService)}(),function(){"use strict";function BofProfessionalPromoModuleController(_,authStream,TrackerService,CacheService,journeyContextService,MEMBERSHIP_EVENT){function $onInit(){$ctrl.sampleArticleLabel=$ctrl.isSampleArticle&&"1"===$ctrl.isSampleArticle?".sampleArticle":"",userChangedSub=authStream.USER_CHANGED.subscribe(onUserChanged.bind($ctrl))}function $onDestroy(){userChangedSub.dispose()}function onUserChanged(user){$ctrl.marketingPageVisited=CacheService.getData(CacheService.KEY.MARKETING_PAGE_VIEW),$ctrl.isLoggedIn=user.isLoggedIn(),$ctrl.isMember=user.hasMembership(),$ctrl.isLoggedIn&&$ctrl.isMember?($ctrl.userLoginStatus="LoggedIn",$ctrl.subtitle="Get ahead of the competition with Member Exclusive Articles and Analysis",$ctrl.ctaLabel="VIEW THE ARCHIVE",$ctrl.ctaLink="/education"):($ctrl.userLoginStatus="LoggedOut",$ctrl.subtitle="Get ahead of the competition with Member Exclusive Articles and Analysis",$ctrl.ctaLabel="JOIN NOW",$ctrl.ctaLink=journeyContextService.generatePaymentPlanUrl("/memberships/packages?int_source=category-page&int_medium=staticad&int_campaign=permanent-professional&int_content=nonmemberpro",{articleSlug:$ctrl.articleSlug})),$ctrl.promo="pro-brain","ArticleListingPage"!==$ctrl.page||$ctrl.isMember||!$ctrl.marketingPageVisited&&!$ctrl.isLoggedIn?"ArticleListingPage"===$ctrl.page&&$ctrl.isLoggedIn?$ctrl.promo=null:($ctrl.trackerDesign="ProfBrainCTA",$ctrl.promo="pro-brain"):($ctrl.trackerDesign="AnnualCard",$ctrl.promo="pro-card"),$ctrl.promo&&currentLoggedIn!==$ctrl.isLoggedIn&&(currentLoggedIn=$ctrl.isLoggedIn,trackImpression())}function trackImpression(){TrackerService.track(MEMBERSHIP_EVENT.DOMAIN,"Memberships.Marketing."+$ctrl.page,{Label:"PromotionalBanner.RightSidebar."+$ctrl.userLoginStatus+"."+$ctrl.trackerDesign+$ctrl.sampleArticleLabel},"impression")}var currentLoggedIn,userChangedSub,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}BofProfessionalPromoModuleController.$inject=["_","authStream","TrackerService","CacheService","journeyContextService","MEMBERSHIP_EVENT"];var bofProfessionalPromoModuleComponent={bindings:{page:"@",source:"@",medium:"@",campaign:"@",isSampleArticle:"@",articleSlug:"@"},templateUrl:"/assets-access-layer/js/site/Promos/components/bof-professional-promo-module.html",controller:BofProfessionalPromoModuleController};angular.module("app.site.promos").component("bofProfessionalPromoModule",bofProfessionalPromoModuleComponent)}(),function(){"use strict";function ImagePromoModuleController(authStream,TrackerService){function $onInit(){userChangedSubscription=authStream.USER_CHANGED.subscribe(onUserChanged.bind($ctrl))}function $onDestroy(){userChangedSubscription.dispose()}function setNonMemberPromo(){$ctrl.promoImage=$ctrl.nonMemberImage,$ctrl.ctaLink=$ctrl.nonMemberLink,$ctrl.eventLabel="ImagePromoMocule.RightSidebar.NonMember.ImageLink"}function setMemberPromo(){$ctrl.promoImage=$ctrl.memberImage,$ctrl.ctaLink=$ctrl.memberLink,$ctrl.eventLabel="ImagePromoMocule.RightSidebar.Member.ImageLink"}function onUserChanged(user){$ctrl.isMember=user.hasMembership(),$ctrl.isMember?setMemberPromo():setNonMemberPromo(),trackImpression()}function trackImpression(){TrackerService.track($ctrl.eventDomain,$ctrl.impressionEvent,{Label:$ctrl.eventLabel},"impression")}var userChangedSubscription,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.promoImage=!1}ImagePromoModuleController.$inject=["authStream","TrackerService"];var imagePromoModuleComponent={bindings:{nonMemberImage:"@",nonMemberLink:"@",memberImage:"@",memberLink:"@",eventDomain:"@",page:"@",category:"@",clickEvent:"@",impressionEvent:"@",title:"@"},templateUrl:"/assets-access-layer/js/site/Promos/templates/image-promo-module.html",controller:ImagePromoModuleController};angular.module("app.site.promos").component("imagePromoModule",imagePromoModuleComponent)}(),function(){"use strict";var bofPrintEditionModuleComponent={bindings:{page:"@",ctaLabel:"@",header:"@?"},templateUrl:"/assets-access-layer/js/site/Promos/templates/print-edition-module.html"};angular.module("app.site.promos").component("printEditionModule",bofPrintEditionModuleComponent)}(),function(){"use strict";function captchaInterceptor($log,captchaService){function requestInterceptor(config){if(!config.validateCaptcha)return config;var captchaToken=captchaService.getCaptchaToken();return captchaToken&&($log.debug("Captcha::captchaInterceptor::"),config.headers=config.headers||{},config.headers[CAPTCHA_HEADER]=captchaToken),config}var CAPTCHA_HEADER="X-Captcha";return{request:requestInterceptor}}captchaInterceptor.$inject=["$log","captchaService"],angular.module("app.captcha").factory("captchaInterceptor",captchaInterceptor)}(),function(){"use strict";function inputCaptchaService(_,$q,$log,$window,$timeout,$injector,UrlService,ScriptLoadService){function setCaptchaToken(token){currentCaptchaToken=token}function getCaptchaToken(){return currentCaptchaToken}function getGrecaptcha(){function onLocation(res){var countryCode=_.toUpper(_.get(res,"data.country_code")),scriptUrl=_.includes(PROXY_URL_COUNTRIES,countryCode)?UrlService.getCurrentBaseUrl()+CAPTCHA_SCRIPT_URL_PROXY:CAPTCHA_SCRIPT_URL;$window.onloadCallback=onCaptchaLoadedCallback,ScriptLoadService.addScriptTag(scriptUrl+"?onload=onloadCallback&render=explicit")}function onCaptchaLoadedCallback(){$log.info("captchaService::onloadcallback"),deferred.resolve($window.grecaptcha)}$log.debug("Captcha::captchaService::getGrecaptcha::");var deferred=$q.defer();return _.isUndefined($window.grecaptcha)?$injector.get("locationApi").get().then(onLocation):$timeout(onCaptchaLoadedCallback),deferred.promise}var CAPTCHA_SCRIPT_URL="https://www.google.com/recaptcha/api.js",CAPTCHA_SCRIPT_URL_PROXY="/recaptcha/api.js",PROXY_URL_COUNTRIES=["CN"],currentCaptchaToken=null;return{getGrecaptcha:getGrecaptcha,setCaptchaToken:setCaptchaToken,getCaptchaToken:getCaptchaToken}}inputCaptchaService.$inject=["_","$q","$log","$window","$timeout","$injector","UrlService","ScriptLoadService"],angular.module("app.input").factory("captchaService",inputCaptchaService)}(),function(){"use strict";function InputCaptchaController($document,$log,$evalAsync,GlobalParams,captchaService,formStream,$window){function $onInit(){$log.debug("Captcha::inputCaptcha::$onInit::"),$ctrl.captchaId=$ctrl.captchaId||"_captcha",$ctrl.captcha=null,formErrorSubscription=formStream.FORM_ERROR.subscribe(onFormError),captchaService.getGrecaptcha().then(onCaptchaLoaded)}function onCaptchaLoaded(grecaptcha){grecaptcha.render($document[0].getElementById($ctrl.captchaId),{sitekey:GlobalParams.CAPTCHA_SITE_KEY,callback:onCaptchaSet})}function onCaptchaSet(captchaToken){$evalAsync(function(){$ctrl.captcha=captchaToken?"ok":null,captchaService.setCaptchaToken(captchaToken)})}function onFormError(data){$log.debug("Captcha::inputCaptcha::onFormError::","reload captcha",data),$ctrl.captcha=null,$window.grecaptcha&&$window.grecaptcha.reset()}function $onDestroy(){$ctrl.captcha=null,captchaService.setCaptchaToken(null),formErrorSubscription.dispose()}var formErrorSubscription,$ctrl=this;$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy}var inputCaptchaComponent={template:'<form-group help="Please check the captcha checkbox" class="text-center"><div form-control align="center" class="g-recaptcha" id="{[{ ::$ctrl.captchaId }]}" name="_captcha" ng-model="$ctrl.captcha" ng-required="true" help="Please check the captcha checkbox"></div></form-group>',bindings:{captchaId:"@?"},controller:InputCaptchaController};angular.module("app.captcha").component("inputCaptcha",inputCaptchaComponent)}(),function(){"use strict";function InputInvisibleCaptchaController(_,$document,$log,GlobalParams,captchaService,$timeout,TrackerService,$q){function $onInit(){function onCaptchaLoaded(grecaptcha){widgetId=grecaptcha.render($document[0].getElementById("_captcha"),{sitekey:GlobalParams.CAPTCHA_SITE_KEY,callback:onCaptchaSet,size:"invisible",badge:_.get($ctrl,"position","inline")}),TrackerService.track("User","SignUpModalCaptchaLoaded",{Label:"CaptchaLoaded"},"impression")}function onCaptchaSet(captchaToken){captchaChallengeObserver&&captchaChallengeObserver.disconnect(),$ctrl.captcha=captchaToken?"ok":null,captchaService.setCaptchaToken(captchaToken),$ctrl.onReady({$event:{token:captchaToken}}),TrackerService.track("User","SignUpModalCaptchaSolved",{Label:"CaptchaSolved"},"impression")}$ctrl.captcha=null,$log.debug("Captcha::inputInvisibleCaptcha::$onInit::"),captchaService.getGrecaptcha().then(onCaptchaLoaded)}function $onChanges(changeObj){changeObj.execute&&!changeObj.execute.isFirstChange()&&onExecute(),changeObj.reload&&!changeObj.reload.isFirstChange()&&onReload()}function onExecute(){onCaptchaClose(),captchaService.getGrecaptcha().then(function(grecaptcha){TrackerService.track("User","SignUpModalCaptchaExecuted",{Label:"CaptchaExecuted"},"click"),grecaptcha.execute(widgetId)})}function onCaptchaClose(){function setupObserver(captchaIframe){var container=captchaIframe.parentNode.parentNode;captchaChallengeObserver=new MutationObserver(function(){container&&"hidden"===container.style.visibility&&($log.debug("Captcha::inputInvisibleCaptcha::onCaptchaClose::","captcha challenge closed"),TrackerService.track("User","SignUpModalCaptchaClosed",{Label:"CaptchaClosed"},"click"),captchaService.setCaptchaToken(null),$ctrl.onReady({$event:{token:null}}),captchaChallengeObserver.disconnect())}),captchaChallengeObserver.observe(container,{attributes:!0,attributeFilter:["style"]})}function captchaIframeError(msg){$log.debug("Captcha::inputInvisibleCaptcha::getRecaptchaIframe::",msg),captchaService.setCaptchaToken(null),$ctrl.onReady({$event:{token:null}})}getRecaptchaIframe().then(setupObserver,captchaIframeError)}function getRecaptchaIframe(){function getIframe(){iframe=document.querySelector(iframeQuerySelector),iframe?deferred.resolve(iframe):i<20?(i++,recaptchaIframeTimeout=$timeout(getIframe,200)):deferred.reject("Couldn't find recaptcha challenge iframe")}var iframe,deferred=$q.defer(),i=0;return getIframe(),deferred.promise}function onReload(){$log.debug("Captcha::inputInvisibleCaptcha::onFormError::","reload captcha"),TrackerService.track("User","SignUpModalCaptchaReloaded",{Label:"CaptchaReloaded"},"click"),$timeout.cancel(recaptchaIframeTimeout),$ctrl.captcha=null,captchaService.getGrecaptcha().then(function(grecaptcha){captchaService.setCaptchaToken(null),grecaptcha.reset(widgetId)})}function $onDestroy(){$ctrl.captcha=null,captchaService.setCaptchaToken(null);var challengeView=document.querySelector(iframeQuerySelector);challengeView&&challengeView.parentNode.parentNode.remove()}var captchaChallengeObserver,recaptchaIframeTimeout,$ctrl=this,iframeQuerySelector='iframe[src^="https://www.google.com/recaptcha"][src*="bframe"]';$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$onDestroy=$onDestroy}var widgetId,inputInvisibleCaptchaComponent={template:'<div align="center" class="g-recaptcha" id="_captcha" name="_captcha" ng-model="$ctrl.captcha"></div>',bindings:{reload:"<",execute:"<",onReady:"&",position:"<"},controller:InputInvisibleCaptchaController};angular.module("app.captcha").component("inputInvisibleCaptcha",inputInvisibleCaptchaComponent)}(),function(){"use strict";function browserEventUtility(_,BrowserEventConstant){function isNewTab(event){var meta=event.metaKey||event.ctrlKey||_.has(event.currentTarget.attributes,"target");return event.which?event.which===BrowserEventConstant.MOUSE.MIDDLE||event.which===BrowserEventConstant.MOUSE.LEFT&&meta:!!event.button&&(event.button===BrowserEventConstant.MOUSE.FOURTH||event.button===BrowserEventConstant.MOUSE.LEFT&&meta)}return{isNewTab:isNewTab}}browserEventUtility.$inject=["_","BrowserEventConstant"],angular.module("app.browser_event").factory("browserEventUtility",browserEventUtility)}(),function(){"use strict";angular.module("app.browser_event").constant("BrowserEventConstant",{MOUSE:{NO_BUTTON:0,LEFT:1,MIDDLE:2,RIGHT:3,FOURTH:4,FIFTH:5}})}(),function(){"use strict";function PodcastController($sce,PodcastConstants){function $onInit(){var frameParameters=$ctrl.podbeanUrl?"?":"&";frameParameters=frameParameters+"from=yiiadmin&btn-skin=107&skin=1&fonts=Helvetica&auto=0&download=0&share="+("listing"==$ctrl.widgetType?"1":"0"),$ctrl.iframeSrc=$sce.trustAsResourceUrl(($ctrl.podbeanUrl||PodcastConstants.DEFAULT.PODBEAN)+frameParameters)}var $ctrl=this;$ctrl.PodcastConstants=PodcastConstants,$ctrl.$onInit=$onInit}PodcastController.$inject=["$sce","PodcastConstants"],angular.module("app.site.podcast").component("podcast",{bindings:{podbeanUrl:"@",itunesUrl:"@",soundcloudUrl:"@",tuneinUrl:"@",stitcherUrl:"@",spotifyUrl:"@",widgetType:"@"},templateUrl:"/assets-access-layer/js/site/Podcast/templates/podcast.template.html",controller:PodcastController})}(),function(){"use strict";angular.module("app.site.podcast").constant("PodcastConstants",{DEFAULT:{PODBEAN:"https://www.podbean.com/media/player/multi?playlist=http%3A%2F%2Fplaylist.podbean.com%2F1965286%2Fplaylist_multi.xml&vjs=1&size=315",SOUNDCLOUD:"https://soundcloud.com/businessoffashion",ITUNES:"https://itunes.apple.com/gb/podcast/the-business-of-fashion/id1225204588?mt=2",TUNEIN:"https://tunein.com/radio/The-Business-of-Fashion-Podcast-p1021982/",STITCHER:"https://www.stitcher.com/podcast/the-business-of-fashion-2/the-business-of-fashion-podcast"}})}(),angular.module("app.voices.animation").directive("animateBackground",["DomService",function(DomService){return{replace:!1,restrict:"A",scope:{speed:"@",direction:"@"},link:function(scope,element,attrs){var elRef=element[0],speed=parseFloat(scope.speed,10);scope.updatePosition=function(){elRef.style.backgroundPositionX=DomService.getTop(elRef)*speed+"%",DomService.requestAnimationFrame(function(){scope.updatePosition()})},scope.updatePosition()}}}]),angular.module("app.shared.job").service("QueryFilterApi",["GenericApiFactory","Routes",function(GenericApiFactory,Routes){"use strict";var QueryFilterApi=new GenericApiFactory(Routes.JOB.QUERY_FILTER);this.get=function(){return QueryFilterApi.get()},this.put=function(data){return QueryFilterApi.put(data)},this.post=function(data){return QueryFilterApi.post(data)}}]),function(){"use strict";function jobAlertsCriteriaApi(_,$log,$http,Routes){function get(){function resolveResponse(response){return _.get(response,"data.data")}$log.debug("Job::jobAlertsCriteria::get");var request={method:"GET",url:Routes.JOB.ALERTS.CRITERIA};return $http(request).then(resolveResponse)}return{get:get}}jobAlertsCriteriaApi.$inject=["_","$log","$http","Routes"],angular.module("app.shared.job").factory("jobAlertsCriteriaApi",jobAlertsCriteriaApi)}(),function(){"use strict";function jobApplicationApi(_,$http,$log,GenericApiFactory,messageApi,MessageConstants,Routes){function getAll(userId,params){return params=_.pick(params,["job_ids","status_type_ids","status_type_keys","attributes"]),$log.debug("Job::jobApplicationApi::getAll::",userId,params),$http({method:"GET",cache:!0,timeout:1e4,url:_.replace(Routes.JOB.APPLICATION.ROOT,":userId",userId),params:params}).then(function(res){return _.get(res,"data.data")})}function recordOpenExternal(userId,jobApplicationTypeId,jobId){var data={userId:userId,job_application_type_id:jobApplicationTypeId,job_id:jobId};return $log.debug("jobApplicationApi::recordOpenExternal::",data),jobApplicationApi.post(data)}function storeJobApplicationStatus(userId,jobApplicationId,statusId){var data={userId:userId,jobApplicationId:jobApplicationId,job_application_status_type_id:statusId};return $log.debug("jobApplicationApi::storeJobApplicationStatus::",data),jobApplicationApi.put(data)}function sendHiredTestimonial(message,jobTitle,company,jobId,jobApplicationId){var data={job_title:jobTitle,company_title:company,job_id:jobId,application_id:jobApplicationId};return $log.debug("jobApplicationApi::sendHiredTestimonial::",message,data),messageApi.submit(MessageConstants.MESSAGE_TYPE.EJAT_HIRED.ID,message,data)}var jobApplicationApi=new GenericApiFactory(Routes.JOB.APPLICATION.BASE);return{recordOpenExternal:recordOpenExternal,storeJobApplicationStatus:storeJobApplicationStatus,sendHiredTestimonial:sendHiredTestimonial,getAll:getAll}}jobApplicationApi.$inject=["_","$http","$log","GenericApiFactory","messageApi","MessageConstants","Routes"],angular.module("app.shared.job").factory("jobApplicationApi",jobApplicationApi)}(),function(){"use strict";angular.module("app.shared.job").constant("JobApplicationConfig",{EXTERNAL_CONFIRMATION_MODAL_DELAY:2e3})}(),function(){"use strict";angular.module("app.shared.job").constant("JobApplicationStatus",{CLICKED:1,APPLIED:2,NOT_APPLIED:3,SAVED:4,HIRED:5,ARCHIVED:6})}(),function(){"use strict";angular.module("app.shared.job").constant("JobApplicationType",{INTERNAL:1,EXTERNAL:2})}(),function(){"use strict";function ExternalApplicationConfirmationModalController($scope,$modalInstance,modalParams,JobApplicationStatus){$scope.jobId=modalParams.jobId,$scope.jobTitle=modalParams.jobTitle,$scope.submit=function(response){return"yes"===response?$modalInstance.close(JobApplicationStatus.APPLIED):"no"===response?$modalInstance.close(JobApplicationStatus.ARCHIVED):$modalInstance.close(JobApplicationStatus.SAVED)}}ExternalApplicationConfirmationModalController.$inject=["$scope","$modalInstance","modalParams","JobApplicationStatus"],angular.module("app.shared.job").controller("ExternalApplicationConfirmationModalController",ExternalApplicationConfirmationModalController)}(),angular.module("app.shared.newsletter").constant("NewsletterConstant",{NEWSLETTER_LIST:{CONTENT_DAILY_NEWSLETTER:1,CONTENT_WEEKLY_NEWSLETTER:2,JOB_ALERTS:3,CAREERS_WEEKLY_NEWSLETTER:4,CONTENT_CHINA_NEWSLETTER:5,BOF_STAFF_NEWSLETTER:6,DLABS_STAFF_NEWSLETTER:7,FASHION_SHOWS_NEWSLETTER:8,KPI_REPORT_NEWSLETTER:9,BOF_PROFESSIONAL_DAILY_NEWSLETTER:10,BOF_PROFESSIONAL_WEEKLY_NEWSLETTER:11},NEWSLETTER_GROUP:{CONTENT:1,CAREERS:2,SHOWS:3,KPIS:4,BOF_PROFESSIONAL:5,OTHER:6}}),angular.module("app.shared.newsletter").service("NewsletterListApi",["GenericApiFactory","Routes",function(GenericApiFactory,Routes){"use strict";var NewsletterListApi=new GenericApiFactory(Routes.NEWSLETTER.LIST);this.get=function(){return NewsletterListApi.get()}}]),function(){"use strict";function messageApi(_,$http,$log,GenericApiFactory,Routes){function fetchPollAnswers(pollTypeIds){var payload={poll_type_ids:pollTypeIds};return $log.debug("MessageApi::fetchPollAnswers::",payload),poolAnswersApi.get(payload)}function submit(messageTypeId,message,parameters){var data=_.isPlainObject(parameters)?parameters:{};return data.type_id=messageTypeId,data.message=message,$log.debug("MessageApi::submit::",data),$http({method:"POST",url:Routes.MESSAGE.SUBMIT,data:data})}var poolAnswersApi=new GenericApiFactory(Routes.MESSAGE.POOL_ANSWERS);return{fetchPollAnswers:fetchPollAnswers,submit:submit}}messageApi.$inject=["_","$http","$log","GenericApiFactory","Routes"],angular.module("app.shared.message").factory("messageApi",messageApi)}(),angular.module("app.shared.message").constant("MessageConstants",{MESSAGE_TYPE:{FEEDBACK:{ID:1},SUBMISSION:{ID:2},EDUCATION_UPSELL:{ID:3},SPONSORSHIP:{ID:5},FEEDBACK_CAREERS:{ID:6},CAREER_COMPANY_REQ:{ID:7},BOARDS_APPLICATION:{ID:8},COURSE_SUGGESTION:{ID:9},MUA_LICENCE_REQUEST:{ID:10},LATEST_NEWS:{ID:11},MODIFY_MEMBERSHIP_SUBSCRIPTION:{ID:12},GROUP_MEMBERSHIP_ENQUIRY:{ID:13},MEMBERSHIP_QUESTION:{ID:14},MEMBERSHIP_PAYMENT_QUESTION:{ID:15},MEMBERSHIP_STUDENT_QUESTION:{ID:16},MEMBERSHIP_GROUP_QUESTION:{ID:17},VOICES_LIVE_QUESTION:{ID:18},MEMBERSHIP_CANCELLATION:{ID:19},MOBILE_APP_FEEDBACK:{ID:20},EJAT_HIRED:{ID:21},PRE_CANCELLATION_QUESTION:{ID:24},CANCELLATION_REQUEST:{ID:25},PAYMENT_DETAILS_QUESTION:{ID:26},CANCEL_MEMBERSHIP_QUESTION:{ID:27},CANCEL_MEMBERSHIP_MODIFY_SUBSCRIPTION:{ID:28},MEMBERSHIP_CHANGE_PACKAGE:{ID:29},MEMBERSHIP_SPA_QUESTION:{ID:30},MEMBERSHIP_REACTIVATE_SUBSCRIPTION:{ID:31},MEDIA:{ID:32}}}),function(){"use strict";function swiperCarousel(){function link(scope,element,attrs){if(!attrs.id||-1!==carouselIds.indexOf(attrs.id))throw new Error("Element id missing from app.shared.swiperCarousel");carouselIds.push(attrs.id);new Swiper("#"+attrs.id,{init:!0,direction:"horizontal",loop:!0,grabCursor:!0,spaceBetween:30,slidesPerView:4,breakpoints:{1024:{slidesPerView:4,spaceBetween:40},768:{slidesPerView:3,spaceBetween:30},640:{slidesPerView:2,spaceBetween:20},320:{slidesPerView:1,spaceBetween:10}},pagination:{clickable:!0,el:".swiper-pagination"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}return{link:link,templateUrl:"/assets-access-layer/js/shared/SwiperCarousel/swiper-carousel.html",transclude:!0,replace:!0,restrict:"A"}}var carouselIds=[];angular.module("app.shared.swiperCarousel").directive("swiperCarousel",swiperCarousel)}(),function(){"use strict";function consentJourneyApi(_,$http,$log,Routes){function get(journeyId,language,type){function resolveConsentJourneyResponse(response){return _.get(response,"data.data")}if($log.debug("User::consentJourneyApi::get"),!journeyId)throw new Error("User::consentJourneyApi::get::Missing journeyId");var params={journey_id__eq:journeyId,language:language||"en"};_.isString(type)&&(params.type=type);var request={method:"GET",url:Routes.USER.CONSENT_JOURNEY_ENDPOINT,params:params};return $http(request).then(resolveConsentJourneyResponse)}return{get:get}}consentJourneyApi.$inject=["_","$http","$log","Routes"],angular.module("app.shared.consentJourney").factory("consentJourneyApi",consentJourneyApi)}(),function(){"use strict";function userBofUsageApi(_,$http,$log,Routes){function get(){return $http({method:"GET",url:Routes.CURRENT_USER.BOF_USAGE}).then(function(response){return _.get(response,"data")})}return{get:get}}userBofUsageApi.$inject=["_","$http","$log","Routes"],angular.module("app.shared.consentJourney").factory("userBofUsageApi",userBofUsageApi)}(),function(){"use strict";function userConsentApi(_,$http,$log,Routes){function update(consents,journeyId,additionalData){function addToPayload(value,key){payload[key]=value}$log.debug("User::userConsentApi::update");var payload={consents:consents,journey_id:journeyId};return additionalData&&_.forOwn(additionalData,addToPayload),$http({method:"POST",url:Routes.CURRENT_USER.CONSENTS,data:payload})}function getUserConsents(){return $http({method:"GET",url:Routes.CURRENT_USER.CONSENTS}).then(function(response){return _.get(response,"data")})}return{update:update,getUserConsents:getUserConsents}}userConsentApi.$inject=["_","$http","$log","Routes"],angular.module("app.shared.consentJourney").factory("userConsentApi",userConsentApi)}(),function(){"use strict";function ConsentRepaperingConfirmationController($interval,UrlService,RepaperingSettings){function $onInit(){startCounter()}function startCounter(seconds){redirectIntervalPromise&&$interval.cancel(redirectIntervalPromise),$ctrl.counter=seconds||RepaperingSettings.CONFIRMATION_REDIRECT_TIMEOUT_SECONDS,redirectIntervalPromise=$interval(incrementCounter,1e3)}function incrementCounter(){if(0===$ctrl.counter)return onRedirectClick(),void(redirectIntervalPromise&&$interval.cancel(redirectIntervalPromise));$ctrl.counter=$ctrl.counter>0?$ctrl.counter-1:0}function onRedirectClick(){var currentUrlParams=UrlService.parseQuery(),referer=currentUrlParams[URLKEYS.REFERER]||"/";UrlService.changeUrl(referer)}var redirectIntervalPromise,$ctrl=this,URLKEYS={ACTION:"_act",REFERER:"_rfr",SOURCE:"_src",TYPE:"_t"};$ctrl.$onInit=$onInit,$ctrl.onRedirectClick=onRedirectClick}var ConsentRepaperingConfirmationComponent={templateUrl:"/assets-access-layer/js/shared/ConsentJourney/components/consent-repapering-confirmation.html",bindings:{step:"@"},controller:ConsentRepaperingConfirmationController};angular.module("app.shared.consentJourney").component("consentRepaperingConfirmation",ConsentRepaperingConfirmationComponent)}(),function(){"use strict";function ConsentRepaperingWizardController(_,$window,authStream,userConsentApi,consentJourneyApi,userBofUsageApi,CONSENT_JOURNEY,UrlService,GlobalParams,storageService,RepaperingSettings,moment){function $onInit(){switch($ctrl.language=$ctrl.language||"en",$ctrl.showUserInfo=!!_.isNil($ctrl.showUserInfo)||$ctrl.showUserInfo,$ctrl.showBofUsageInfo=!!_.isNil($ctrl.showBofUsageInfo)||$ctrl.showBofUsageInfo,$ctrl.isLoaded=!1,$ctrl.step=_.toInteger($ctrl.step),$ctrl.step){case 1:$ctrl.stepCopy="StepOne",$ctrl.dataLabel="NewsletterConsents";break;case 2:$ctrl.stepCopy="StepTwo",$ctrl.dataLabel="DataConsents";break;default:$ctrl.stepCopy="Step",$ctrl.dataLabel="Static"}userDataChanged=authStream.USER_DATA_CHANGED.subscribe(onUserDataChanged),$ctrl.consentJourneyId=1===$ctrl.step?CONSENT_JOURNEY.RepaperingNewsletters:CONSENT_JOURNEY.RepaperingData}function $onDestroy(){userDataChanged.dispose()}function onUserDataChanged(user){function onBofUsageSuccess(response){$ctrl.bofUsage=response.data}user.isLoggedIn()&&($ctrl.email=user.email,$ctrl.showBofUsageInfo&&userBofUsageApi.get().then(onBofUsageSuccess))}function onConsentsChange($event){$ctrl.isLoaded=!0,$ctrl.consentsForm=$event}function canSubmit(){return $ctrl.consentsForm.isValid||($ctrl.consentErrors=$ctrl.consentsForm),$ctrl.consentsForm.isValid}function submit(){function onSuccess(){function onConsentJourneyStepTwoLoaded(response){_.isEmpty(response.groups)&&(url=nextStepMapping[2]+$window.location.search),UrlService.changeUrl(url)}skipsRemaining=storageService.get(storageService.KEY.REPAPERING_SKIP_COUNT),(_.isNil(skipsRemaining)||skipsRemaining>RepaperingSettings.MAX_SKIP_COUNT)&&(skipsRemaining=RepaperingSettings.MAX_SKIP_COUNT),storageService.set(storageService.KEY.REPAPERING_SKIP_COUNT,skipsRemaining),storageService.set(storageService.KEY.LAST_REPAPERING_SKIP,moment.utc().format());var url=nextStepMapping[$ctrl.step]+$window.location.search;1===_.toInteger($ctrl.step)?consentJourneyApi.get(JOURNEY_STEP_2,$ctrl.language,"usage").then(onConsentJourneyStepTwoLoaded):UrlService.changeUrl(url)}return updateConsents().then(onSuccess)}function updateConsents(){return userConsentApi.update($ctrl.consentsForm.formData,$ctrl.consentJourneyId)}var skipsRemaining,$ctrl=this,userDataChanged=null,JOURNEY_STEP_2=71,nextStepMapping={1:GlobalParams.AL_ROUTING["user.user_consent.repapering_wizard_2"],2:GlobalParams.AL_ROUTING["user.user_consent.repapering_wizard_confirmation"]};$ctrl.$onInit=$onInit,$ctrl.$onDestroy=$onDestroy,$ctrl.onConsentsChange=onConsentsChange,$ctrl.canSubmit=canSubmit,$ctrl.submit=submit}var ConsentRepaperingWizardComponent={templateUrl:"/assets-access-layer/js/shared/ConsentJourney/components/consent-repapering-wizard.html",bindings:{step:"@",showUserInfo:"<",showBofUsageInfo:"<",language:"<"},controller:ConsentRepaperingWizardController};angular.module("app.shared.consentJourney").component("consentRepaperingWizard",ConsentRepaperingWizardComponent)}(),function(){"use strict";function ConsentsFormWrapperController(_,$q,authStream,consentJourneyApi,FormServiceFactory,userConsentApi,UserSubscriptionApi,consentJourneyTrackerService,consentStream,consentJourneyService){function $onInit(){$ctrl.consentFetchType=$ctrl.consentFetchType||"detection",$ctrl.language=$ctrl.language||"en",$ctrl.showSubscriptionInfo=$ctrl.showSubscriptionInfo||!1,$ctrl.repapering=$ctrl.repapering||!1,$ctrl.form={ref:null},FormService=new FormServiceFactory($ctrl.form),userDataChangedSubscription=authStream.USER_DATA_CHANGED.first().subscribe(onUserChanged),consentStream.RESET_CONSENT_CHANGES.subscribe(resetConsentChanges)}function $onChanges(changes){changes.errors&&!changes.errors.isFirstChange()&&(changes.errors.currentValue.isValid||FormService.canSubmit()),changes.journeyId&&!changes.journeyId.isFirstChange()&&initJourneyData(),changes.trackingTrigger&&!0===changes.trackingTrigger.currentValue&&sendTracking(),changes.consentsChangeTrigger&&!changes.consentsChangeTrigger.isFirstChange()&&(reloadConsentChanges=!0,buildConsentsData()),changes.preselectUserConsents&&!changes.preselectUserConsents.isFirstChange()&&changes.preselectUserConsents.currentValue!==changes.preselectUserConsents.previousValue&&setPreselectedUserConsents(changes.preselectUserConsents.currentValue)}function $onDestroy(){userDataChangedSubscription.dispose()}function initJourneyData(){function handleJourneyData(data){function setSubscriptionInfo(userSubscriptions,group){var groupConsentIds=_.map(group._items,"consent_id");group.subscriptions=_.filter(userSubscriptions,function(userSubscription){return!_.isEmpty(_.intersection(userSubscription.consent_ids,groupConsentIds))})}var journeyData=data[0];if($ctrl.groups=journeyData.groups,$ctrl.journeyFooterTitle=journeyData.journey_footer_title,$ctrl.journeyFooterDescription=journeyData.journey_footer_description,$ctrl.sections=_.groupBy($ctrl.groups,"consent_section_key"),$ctrl.showSubscriptionInfo){var userSubscriptions=data[1];userSubscriptions=_.filter(userSubscriptions,function(sub){return"14"!==sub.list_id}),$ctrl.groups.forEach(setSubscriptionInfo.bind(null,userSubscriptions))}$ctrl.preselectUserConsents?setPreselectedUserConsents(!0):(setDefaultValuesForAllGroups(),emitChange())}var promises=[getJourneyData()];if($ctrl.showSubscriptionInfo){var promise=UserSubscriptionApi.get({decorate:"newsletter_consent"}).then(function(response){return response.data});promises.push(promise)}$q.all(promises).then(handleJourneyData)}function setPreselectedUserConsents(loadUserConsents){loadUserConsents?userConsentApi.getUserConsents().then(onUserConsentsSuccess).catch(onUserConsentsFailure).finally(onUserConsentsFinally):(resetValuesForAllGroups(),setDefaultValuesForAllGroups(),emitChange())}function onUserConsentsSuccess(userConsents){userConsentGroupSelections=consentJourneyService.getConsentGroupSelectionsFromUserConsents($ctrl.groups,userConsents.data),setDefaultValuesForAllGroups(),$ctrl.groups.forEach(setUserValues)}function onUserConsentsFailure(){setDefaultValuesForAllGroups()}function onUserConsentsFinally(){emitChange()}function resetValuesForAllGroups(){$ctrl.groups.forEach(resetValues)}function setDefaultValuesForAllGroups(){$ctrl.doNotLoadDefaults||$ctrl.groups.forEach(setDefaultValues)}function setDefaultValues(group){_.isUndefined(group.default_preset)||(group.is_enabled=group.default_preset)}function resetValues(group){group.is_enabled=void 0}function setUserValues(group){_.isUndefined(userConsentGroupSelections[group.consent_group_id])||(group.is_enabled=userConsentGroupSelections[group.consent_group_id])}function onUserChanged(){initJourneyData()}function emitChange(){var consentsData=buildConsentsData();$ctrl.onChange({$event:{consentChanges:consentsData.consentChanges,formData:consentsData.acceptedConsents,isValid:isDataValid(consentsData.acceptedConsents)}})}function getJourneyData(){return consentJourneyApi.get($ctrl.journeyId,$ctrl.language,$ctrl.consentFetchType)}function hasSectionTitle(section){return section&&section.length&&!!section[0].consent_section_title}function getSectionTitle(section){return _.get(section,"[0].consent_section_title")}function hasSectionDescription(section){return section&&section.length&&!!section[0].consent_section_description}function getSectionDescription(section){return _.get(section,"[0].consent_section_description")}function hasMultipleItems(section){return section&&section.length>1}function hasOptionalItems(section){return!(!section||!section.length)&&!section[0].is_required}function enableAllConsents(section,key){section.forEach(function(group){group.is_enabled=!0}),$ctrl.enabledAllConsents[key]=!0,enableAllChangesTrackingRecords={},enableAllTrackingRecords[key]=!0,emitChange()}function isRequired(group){return group.is_required}function isOptional(group){return!group.is_required}function isHidden(groupKey){return!!$ctrl.hideGroupsByKey&&_.includes($ctrl.hideGroupsByKey,groupKey)}function onConsentChange($event,group,section,sectionKey){function evaluateGroups(all,group){return all&&!!group.is_enabled}group.is_enabled=$event.value,$ctrl.enabledAllConsents[sectionKey]=section.reduce(evaluateGroups,!0),emitChange(),enableAllChangesTrackingRecords[sectionKey]||(enableAllChangesTrackingRecords[sectionKey]={}),enableAllChangesTrackingRecords[sectionKey][$event.id]=$event.value}function buildConsentsData(){acceptedConsents=[],$ctrl.groups.forEach(function(group){group._items.forEach(function(consent){acceptedConsents.push({consent_id:consent.consent_id,consent_version_major:consent.consent_version_major,consent_version_minor:consent.consent_version_minor,is_enabled:!!group.is_required||group.is_enabled,subscribe:!!group.is_required||group.is_enabled})})}),initialConsents&&!reloadConsentChanges||(initialConsents=acceptedConsents,reloadConsentChanges=!1);var consentChanges=_.differenceWith(acceptedConsents,initialConsents,_.isEqual);return{acceptedConsents:acceptedConsents,consentChanges:consentChanges}}function isDataValid(consentData){function isSet(consent){return!_.isUndefined(consent.is_enabled)}return _.every(consentData,isSet)}function recordSeeMoreClick(trackingData){_.get(seeMoreTrackingRecords,trackingData.consent_group_id)||(seeMoreTrackingRecords[trackingData.consent_group_id]=!0)}function sendTracking(){_.each(seeMoreTrackingRecords,function(value,key){value&&consentJourneyTrackerService.trackSeeMore($ctrl.journeyId,key)}),_.each(enableAllTrackingRecords,function(value,key){value&&consentJourneyTrackerService.trackEnableAll($ctrl.journeyId,key)}),_.each(enableAllChangesTrackingRecords,function(sectionConsents,sectionKey){_.each(sectionConsents,function(value,key){consentJourneyTrackerService.trackEnableAllChange($ctrl.journeyId,sectionKey,key,enableAllTrackingRecords[sectionKey],value)})})}function trackOptOutBoxShown(trackingData){consentJourneyTrackerService.trackOptOutBoxShown($ctrl.journeyId,trackingData.consent_section_key,trackingData.consent_group_id)}function resetConsentChanges(){initialConsents=_.cloneDeep(acceptedConsents),emitChange()}var FormService,userDataChangedSubscription,userConsentGroupSelections,initialConsents,acceptedConsents,$ctrl=this,enableAllTrackingRecords={},enableAllChangesTrackingRecords={},seeMoreTrackingRecords={},reloadConsentChanges=!1;$ctrl.enabledAllConsents=[],$ctrl.$onInit=$onInit,$ctrl.$onChanges=$onChanges,$ctrl.$onDestroy=$onDestroy,$ctrl.hasSectionTitle=hasSectionTitle,$ctrl.getSectionTitle=getSectionTitle,$ctrl.hasSectionDescription=hasSectionDescription,$ctrl.getSectionDescription=getSectionDescription,$ctrl.hasMultipleItems=hasMultipleItems,$ctrl.hasOptionalItems=hasOptionalItems,$ctrl.enableAllConsents=enableAllConsents,$ctrl.isRequired=isRequired,$ctrl.isOptional=isOptional,$ctrl.isHidden=isHidden,$ctrl.onConsentChange=onConsentChange,$ctrl.recordSeeMoreClick=recordSeeMoreClick,$ctrl.trackOptOutBoxShown=trackOptOutBoxShown,$ctrl.isLoggedIn=!1}var consentsFormWrapperComponent={templateUrl:"/assets-access-layer/js/shared/ConsentJourney/components/consents-form-wrapper.html",bindings:{journeyId:"<",language:"<",errors:"<",showSubscriptionInfo:"<",trackingTrigger:"<",onChange:"&",preselectUserConsents:"<?",doNotLoadDefaults:"<?",hideGroupsByKey:"<?",consentsChangeTrigger:"<?",consentFetchType:"@"},controller:ConsentsFormWrapperController};angular.module("app.shared.consentJourney").component("consentsFormWrapper",consentsFormWrapperComponent)}(),function(){"use strict";function OptionalConsentGroupController($sce){function $onInit(){$ctrl.yesText=$ctrl.group.consent_yes_text||"Yes",$ctrl.noText=$ctrl.group.consent_no_text||"No",$ctrl.hasExtraDetails=!!$ctrl.group.consent_help_text,$ctrl.showSubscriptionInfo=$ctrl.showSubscriptionInfo||!1,$ctrl.consentOptoutText=$sce.trustAsHtml($ctrl.consentOptoutText)}function emitChange(){$ctrl.onChange({$event:{id:$ctrl.group.consent_group_id,value:$ctrl.value}})}function toggleDetails(){$ctrl.showExtraDetails=!$ctrl.showExtraDetails,$ctrl.onSeeMoreClick({trackingData:{consent_group_id:$ctrl.group.consent_group_id}})}function trackOptOutBoxShown(){$ctrl.onOptOutBoxShown({trackingData:{consent_section_key:$ctrl.group.consent_section_key,consent_group_id:$ctrl.group.consent_group_id}})}var $ctrl=this;$ctrl.hasExtraDetails=!1,$ctrl.showExtraDetails=!1,$ctrl.$onInit=$onInit,$ctrl.emitChange=emitChange,$ctrl.toggleDetails=toggleDetails,$ctrl.trackOptOutBoxShown=trackOptOutBoxShown}var optionalConsentGroupComponent={templateUrl:"/assets-access-layer/js/shared/ConsentJourney/components/optional-consent-group.html",bindings:{group:"<",value:"<",name:"<",hideExtraDetails:"<",consentOptoutText:"<",consentOptoutColor:"<",onSeeMoreClick:"&",onOptOutBoxShown:"&",showSubscriptionInfo:"<",onChange:"&"},controller:OptionalConsentGroupController};angular.module("app.shared.consentJourney").component("optionalConsentGroup",optionalConsentGroupComponent)}(),function(){"use strict";function RequiredConsentGroupController(_,$sce){function $onInit(){_.isNil($ctrl.group.consent_group_footer_text)||($ctrl.footerHtml=$sce.trustAsHtml($ctrl.group.consent_group_footer_text))}var $ctrl=this;$ctrl.footerHtml=null,$ctrl.$onInit=$onInit}var requiredConsentGroupComponent={templateUrl:"/assets-access-layer/js/shared/ConsentJourney/components/required-consent-group.html",bindings:{group:"<"},controller:RequiredConsentGroupController};angular.module("app.shared.consentJourney").component("requiredConsentGroup",requiredConsentGroupComponent)}(),function(){"use strict";angular.module("app.shared.consentJourney").constant("CONSENT_JOURNEY",{ConsentRepaper:9,CoursePurchaseAnonymousConfigure:41,CoursePurchaseAnonymousPurchase:40,CoursePurchaseLoggedinConfigure:43,CoursePurchaseLoggedinPurchase:42,CoursePurchaseAnonymousPurchaseGift:44,CoursePurchaseLoggedinPurchaseGift:45,JobAlertsSubscribe:8,JobAlertsSubscribeWithRegistration:10,JobApply:7,MembershipsPurchaseAnnualAnonymousConfigure:1,MembershipsPurchaseAnnualAnonymousPayment:2,MembershipsPurchaseAnnualLoggedinConfigure:33,MembershipsPurchaseAnnualLoggedinPayment:32,MembershipsPurchaseMonthlyAnonymousConfigure:6,MembershipsPurchaseMonthlyAnonymousPayment:5,MembershipsPurchaseMonthlyLoggedinConfigure:37,MembershipsPurchaseMonthlyLoggedinPayment:36,NewslettersSubscribe:4,Register:3,RegisterCareers:11,RegisterEducation:12,TalentPool:37,RepaperingNewsletters:70,RepaperingData:71,SpaNewsletterSubscriptions:50,MembershipsPurchaseStudent:80})}(),function(){"use strict";angular.module("app.shared.consentJourney").constant("RepaperingSettings",{MAX_SKIP_COUNT:3,MAX_CONSENT_SKIP_HOURS:24,CONFIRMATION_REDIRECT_TIMEOUT_SECONDS:5})}(),function(){"use strict";function ConsentRepaperingModalController(_,moment,$scope,$modalInstance,modalParams,storageService,RepaperingSettings,UrlService,EventManager,AuthEvents){function onUpdateSettingsClick(){UrlService.changeUrl(modalParams.url)}function onSkipClick(){$scope.skipsRemaining-=1,storageService.set(storageService.KEY.REPAPERING_SKIP_COUNT,$scope.skipsRemaining),storageService.set(storageService.KEY.LAST_REPAPERING_SKIP,moment.utc().format()),$modalInstance.close(),EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!1})}function onStorageChange(event){event.storageKey===storageService.KEY.REPAPERING_SKIP_COUNT&&($scope.skipsRemaining=event.newValue)}$scope.onUpdateSettingsClick=onUpdateSettingsClick,$scope.onSkipClick=onSkipClick,function(){$scope.skipsRemaining=storageService.get(storageService.KEY.REPAPERING_SKIP_COUNT),(_.isNil($scope.skipsRemaining)||$scope.skipsRemaining>RepaperingSettings.MAX_SKIP_COUNT)&&($scope.skipsRemaining=RepaperingSettings.MAX_SKIP_COUNT),storageService.STORAGE_STREAM.subscribe(onStorageChange)}()}ConsentRepaperingModalController.$inject=["_","moment","$scope","$modalInstance","modalParams","storageService","RepaperingSettings","UrlService","EventManager","AuthEvents"],angular.module("app.shared.consentJourney").controller("ConsentRepaperingModalController",ConsentRepaperingModalController)}(),function(){"use strict";function consentJourneyTrackerService(TrackerService,USER_EVENT){function trackSeeMore(journeyId,groupId){TrackerService.track(USER_EVENT.DOMAIN,"User.Consents",{Label:"ConsentsFormWrapper.EndOfGroupDescriptionCopy.Journey["+journeyId+"].Group["+groupId+"].SeeMoreLink"},"click")}function trackEnableAll(journeyId,sectionKey){TrackerService.track(USER_EVENT.DOMAIN,"User.Consents",{Label:"ConsentsFormWrapper.TopSection.Journey["+journeyId+"].Section["+sectionKey+"].EnableAllButton"},"click")}function trackEnableAllChange(journeyId,sectionKey,consentId,enableAllClicked,enabled){TrackerService.track(USER_EVENT.DOMAIN,"User.Consents",{Label:"ConsentsFormWrapper.InConsent.Journey["+journeyId+"].Section["+sectionKey+"].Group["+consentId+"].EnableAllClicked["+(enableAllClicked?"true":"false")+"]."+(enabled?"RadioButtonTrue":"RadioButtonFalse")},"click")}function trackOptOutBoxShown(journeyId,sectionKey,consentId){TrackerService.track(USER_EVENT.DOMAIN,"User.Consents",{Label:"ConsentsFormWrapper.InConsent.Journey["+journeyId+"].Section["+sectionKey+"].Group["+consentId+"].OptOutBoxShown"},"click")}return{trackSeeMore:trackSeeMore,trackEnableAll:trackEnableAll,trackEnableAllChange:trackEnableAllChange,trackOptOutBoxShown:trackOptOutBoxShown}}consentJourneyTrackerService.$inject=["TrackerService","USER_EVENT"],angular.module("app.shared.consentJourney").factory("consentJourneyTrackerService",consentJourneyTrackerService)}(),function(){"use strict";function consentJourneyService(_){function getConsentGroupSelectionsFromUserConsents(consentJourneyGroups,userConsents){var consentGroupSelections={};return _.forEach(consentJourneyGroups,function(group){_.forEach(group._items,function(groupItem){var userConsent=_.find(userConsents,{consent_id:groupItem.consent_id});if(userConsent){var consGroupSel=consentGroupSelections[group.consent_group_id];consentGroupSelections[group.consent_group_id]=consGroupSel===userConsent.is_enabled||_.isUndefined(consGroupSel)?userConsent.is_enabled:null}})}),consentGroupSelections}return{getConsentGroupSelectionsFromUserConsents:getConsentGroupSelectionsFromUserConsents}}consentJourneyService.$inject=["_"],angular.module("app.shared.consentJourney").factory("consentJourneyService",consentJourneyService)}(),function(){"use strict";function consentRepaperingService(_,$q,UiModalService,RepaperingSettings,storageService,moment,authStream,EventManager,AuthEvents,UrlService,AgentService,utmService,featureFlagStream,consentStream,MembershipTypes,GlobalParams){function init(){Rx.Observable.combineLatest(featureFlagStream.FEATURE_FLAGS_CHANGED,authStream.USER_DATA_CHANGED).subscribe(onUserAndFeatureFlagsLoaded)}function onUserAndFeatureFlagsLoaded(data){featureFlags=data[0],user=data[1],repaperingStep=user.getRepaperingStep(),stepUrl=getStepUrl(),isIndividualProfessionalAndInRepapering()?consentStream.SHOW_MEMBERSHIP_REPAPERING.onNext({is_visible:!0,url:buildUrl(stepUrl)}):(consentStream.SHOW_MEMBERSHIP_REPAPERING.onNext({is_visible:!1,url:null}),featureFlags.isEnabled("REPAPERING")&&shouldShowModal()&&initModal())}function isIndividualProfessionalAndInRepapering(){var membershipType=user.getMembershipType();return user.hasMembership()&&(membershipType===MembershipTypes.INDIVIDUAL_MONTHLY_KEY||membershipType===MembershipTypes.INDIVIDUAL_YEARLY_KEY)&&featureFlags.isEnabled("INDIVIDUAL_MEMBERSHIP_REPAPERING")&&!_.isNull(repaperingStep)}function shouldShowModal(){if(AgentService.isMobilePhone())return!1;var utmParams=utmService.parseUTMParamsFromURL(),medium=_.lowerCase(_.get(utmParams,"utm_medium","")),source=_.lowerCase(_.get(utmParams,"utm_source",""));if("email"===medium&&"subscribers"===source)return!1;var path=UrlService.getCurrentPath();return _.some(ACCEPTED_URLS,_.startsWith.bind(null,path))}function initModal(){var lastRepaperingSkip=storageService.get(storageService.KEY.LAST_REPAPERING_SKIP);(_.isNil(lastRepaperingSkip)||moment().isAfter(moment(lastRepaperingSkip).add(RepaperingSettings.MAX_CONSENT_SKIP_HOURS,"hours")))&&showRepaperingModal()}function showRepaperingModal(){user.isLoggedIn()&&(_.isNull(repaperingStep)||(EventManager.emit(AuthEvents.PROTECT_CONTENT,{status:!0}),UiModalService.openModal({template:"/assets-access-layer/js/shared/ConsentJourney/components/consent-repapering-modal.html",controller:"ConsentRepaperingModalController",backdrop:"static",keyboard:!1},{url:buildUrl(stepUrl)},!0)))}function getStepUrl(){return GlobalParams.AL_ROUTING[1===_.toInteger(repaperingStep)?"user.user_consent.repapering_wizard_1":"user.user_consent.repapering_wizard_2"]}function buildUrl(path,options){options=parseOptions(options);var urlParams=UrlService.parseQuery(path);return!1!==options.referer&&(urlParams[URLKEYS.REFERER]=options.referer||getDefaultReferer()),options.action&&(urlParams[URLKEYS.ACTION]=options.action),options.source&&(urlParams[URLKEYS.SOURCE]=options.source),UrlService.getPath(path)+UrlService.getQueryString(urlParams)}function parseOptions(options){options=options||{};var currentUrlParams=UrlService.parseQuery();return!1!==options.referer&&(options.referer=options.referer||currentUrlParams[URLKEYS.REFERER]||getDefaultReferer()),options.action=options.action||currentUrlParams[URLKEYS.ACTION]||null,options.source=options.source||currentUrlParams[URLKEYS.SOURCE]||null,options.type=options.type||currentUrlParams[URLKEYS.TYPE]||null,options}function getDefaultReferer(){return UrlService.getCurrentUrl()}var featureFlags,stepUrl,user,ACCEPTED_URLS=["/articles/"],URLKEYS={ACTION:"_act",REFERER:"_rfr",SOURCE:"_src",TYPE:"_t"},repaperingStep=null;return{init:init}}consentRepaperingService.$inject=["_","$q","UiModalService","RepaperingSettings","storageService","moment","authStream","EventManager","AuthEvents","UrlService","AgentService","utmService","featureFlagStream","consentStream","MembershipTypes","GlobalParams"],angular.module("app.shared.consentJourney").factory("consentRepaperingService",consentRepaperingService)}(),angular.module("app.shared.consentJourney").service("consentStream",["$window","Stream","LazyStream",function($window,Stream,LazyStream){"use strict";return{SHOW_MEMBERSHIP_REPAPERING:new LazyStream,RESET_CONSENT_CHANGES:new LazyStream}}]),function(){"use strict";angular.module("app.shared.account").constant("MembershipTypes",{INDIVIDUAL_YEARLY_KEY:"individual-yearly",INDIVIDUAL_MONTHLY_KEY:"individual-monthly",INDIVIDUAL_STUDENT_KEY:"individual-student",GROUPS_PARTNER_KEY:"groups_partner"})}(),function(){"use strict";function MembershipLinksController(){}var membershipLinksComponent={templateUrl:"/assets-access-layer/js/shared/Membership/components/membership-links.html",controller:MembershipLinksController,bindings:{}};angular.module("app.shared.membership").component("membershipLinks",membershipLinksComponent)}(),function(){"use strict";function organisationApi(_,$http,Routes){function get(params){function onGetSuggestionsSuccess(response){return _.get(response,"data.results")}var request={method:"GET",url:Routes.ORGANISATION.SUGGESTION,params:params||{}};return $http(request).then(onGetSuggestionsSuccess)}return{get:get}}organisationApi.$inject=["_","$http","Routes"],angular.module("app.shared.organisation").factory("organisationApi",organisationApi)}(),angular.module("app.salesforce").constant("Salesforce",{default_url:"/xhr/salesforce/data/submit",default_action:"POST"}),function(){"use strict";function SalesforceService(Salesforce,$http,GlobalParams){function submitMessage(data,routeUrl,routeAction,oid){return data||(data={}),data.oid=oid||GlobalParams.SALESFORCE_UID,$http({url:routeUrl||Salesforce.default_url,method:routeAction||Salesforce.default_action,data:data,validateCaptcha:!0})}return{submitMessage:submitMessage}}SalesforceService.$inject=["Salesforce","$http","GlobalParams"],angular.module("app.salesforce").service("SalesforceService",SalesforceService)}();var angularModules=["ngResource","ngTouch","ngStorage","ngAnimate","ngCookies","ngSanitize","pusher-angular","base64","app.sentry","ui.bootstrap.tpls","ui.bootstrap","satellizer","duScroll","chart.js","angular-jwt","angular-cache","angularMoment","720kb.socialshare","credit-cards","rzModule","app.templates","app.shared.feature_flag","app.core","app.banner","app.input","app.permission","app.auth","app.sign","app.user","app.mua","app.wall","app.god_bar","app.data","app.company","app.tracker","app.track","app.ui","app.bootstrap","app.ratelimit","app.shared.error_handler","app.shared.article","app.shared.saved_article","app.bof500","app.disqus","app.membership","app.share","app.pusher","app.nav","app.home","app.discussion","app.daily_digest","app.article","app.education","app.newsletter","app.menu","app.career","app.profile","app.search","app.ads","app.youtube","app.show","app.legacy-track","app.subscription","app.intercom","app.crypt","app.community","app.conference","app.board","app.recurly","app.news","app.payment","app.coupon","app.shared.education","app.site.user","app.sticky_header","app.owl_carousel","app.site.promos","app.captcha","app.browser_event","ngDisqus","app.site.podcast","app.voices.animation","app.shared.job","app.shared.newsletter","app.shared.message","app.shared.swiperCarousel","app.shared.consentJourney","app.shared.account","app.shared.membership","app.shared.organisation","app.salesforce"];!function(){"use strict";function config(_,$interpolateProvider,$locationProvider,$disqusProvider,$compileProvider,$logProvider,$provide,CryptServiceProvider,HistoryServiceProvider,$httpProvider,$localStorageProvider,GlobalParams){$logProvider.debugEnabled(GlobalParams.DEV_ENABLED),$compileProvider.debugInfoEnabled(GlobalParams.DEV_ENABLED),GlobalParams.DEV_ENABLED||$provide.decorator("$log",["$delegate",function($delegate){return $delegate.debug=_.noop,$delegate.warn=_.noop,$delegate.info=_.noop,$delegate}]),$interpolateProvider.startSymbol("{[{").endSymbol("}]}"),$disqusProvider.setShortname(GlobalParams.DISQS_SHORTNAME),$locationProvider.html5Mode(!1),$provide.decorator("$browser",["$delegate",function($delegate){return $delegate.onUrlChange=_.noop,$delegate.url=function(){return""},$delegate}]),CryptServiceProvider.setSecret(GlobalParams.CRYPT_SECRET),HistoryServiceProvider.setApp(GlobalParams.APP_NAME),$localStorageProvider.setKeyPrefix(GlobalParams.LOCALSTORAGE_PREFIX)}function run(PageCountService,QuerystringRouter,HistoryService){PageCountService.increase(),HistoryService.pushState(),QuerystringRouter.init();for(var stickyElements=document.querySelectorAll(".position-sticky, .position-sticky-desktop"),i=stickyElements.length-1;i>=0;i--)window.Stickyfill.add(stickyElements[i])}config.$inject=["_","$interpolateProvider","$locationProvider","$disqusProvider","$compileProvider","$logProvider","$provide","CryptServiceProvider","HistoryServiceProvider","$httpProvider","$localStorageProvider","GlobalParams"],run.$inject=["PageCountService","QuerystringRouter","HistoryService"],angular.module("app",angularModules).config(config).run(run)}();